
/* /web/static/lib/datejs/core.js defined in bundle 'web.assets_backend' */
(function(){var $D=Date,$P=$D.prototype,p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);}else if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;}else{throw new TypeError(date1+" - "+date2);}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);};$D.getDayNumberFromName=function(name){var n=$D.CultureInfo.dayNames,m=$D.CultureInfo.abbreviatedDayNames,o=$D.CultureInfo.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;}}
return-1;};$D.getMonthNumberFromName=function(name){var n=$D.CultureInfo.monthNames,m=$D.CultureInfo.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];};$D.getTimezoneAbbreviation=function(offset){var z=$D.CultureInfo.timezones,p;for(var i=0;i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}
return null;};$D.getTimezoneOffset=function(name){var z=$D.CultureInfo.timezones,p;for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;}}
return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);};$P.isToday=$P.isSameDay=function(date){return this.clone().clearTime().equals((date||new Date()).clone().clearTime());};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value*1);return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);};$P.addDays=function(value){this.setDate(this.getDate()+value*1);return this;};$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value*1);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;return this;}
var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);}
if(x.seconds){this.addSeconds(x.seconds);}
if(x.minutes){this.addMinutes(x.minutes);}
if(x.hours){this.addHours(x.hours);}
if(x.weeks){this.addWeeks(x.weeks);}
if(x.months){this.addMonths(x.months);}
if(x.years){this.addYears(x.years);}
if(x.days){this.addDays(x.days);}
return this;};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;f=$d+((153*($m-3)+2)/5)+58+s;}
g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);}else if(n>364+s){w=1;}else{w=(n/7|0)+1;}
$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());};var validate=function(n,min,max,name){if(typeof n=="undefined"){return false;}else if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");}
return true;};$D.validateMillisecond=function(value){return validate(value,0,999,"millisecond");};$D.validateSecond=function(value){return validate(value,0,59,"second");};$D.validateMinute=function(value){return validate(value,0,59,"minute");};$D.validateHour=function(value){return validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return validate(value,1,$D.getDaysInMonth(year,month),"day");};$D.validateMonth=function(value){return validate(value,0,11,"month");};$D.validateYear=function(value){return validate(value,0,9999,"year");};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());}
if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());}
if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());}
if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}
if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());}
if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());}
if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());}
if(config.timezone){this.setTimezone(config.timezone);}
if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);}
if(config.week&&validate(config.week,0,53,"week")){this.setWeek(config.week);}
return this;};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;}
else if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);}
return this;}
return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset();};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);}};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?'0'+n:n;}
return'"'+this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z"';};}
$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$D.CultureInfo.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);}}
var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");}
x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $D.CultureInfo.dayNames[x.getDay()];case"ddd":return $D.CultureInfo.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $D.CultureInfo.monthNames[x.getMonth()];case"MMM":return $D.CultureInfo.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));case"M":return x.getMonth()+1;case"t":return x.h()<12?$D.CultureInfo.amDesignator.substring(0,1):$D.CultureInfo.pmDesignator.substring(0,1);case"tt":return x.h()<12?$D.CultureInfo.amDesignator:$D.CultureInfo.pmDesignator;case"S":return ord(x.getDate());default:return m;}}):this._toString();};}());;

/* /web/static/lib/datejs/parser.js defined in bundle 'web.assets_backend' */
(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'";}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)]);}else{throw new $P.Exception(s);}};},token:function(s){return function(s){return _.rtoken(new RegExp("^\s*"+s+"\s*"))(s);};},stoken:function(s){return _.rtoken(new RegExp("^"+s));},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s);}catch(e){qx.push(rx[0]);s=rx[1];continue;}
break;}
return[qx,s];};},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s);}catch(e){return[rx,s];}
rx.push(r[0]);s=r[1];}
return[rx,s];};},optional:function(p){return function(s){var r=null;try{r=p.call(this,s);}catch(e){return[null,s];}
return[r[0],r[1]];};},not:function(p){return function(s){try{p.call(this,s);}catch(e){return[null,s];}
throw new $P.Exception(s);};},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]];}:null;},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx));}
return rx;},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s));}catch(e){r=cache[s]=e;}
if(r instanceof $P.Exception){throw r;}else{return r;}};},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){r=null;}
if(r){return r;}}
throw new $P.Exception(s);};},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){throw new $P.Exception(s);}
rx.push(r[0]);s=r[1];}
return[rx,s];};},all:function(){var px=arguments,_=_;return _.each(_.optional(px));},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0];}
return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s);}catch(e){break;}
rx.push(r[0]);try{q=d.call(this,r[1]);}catch(ex){q=null;break;}
s=q[1];}
if(!r){throw new $P.Exception(s);}
if(q){throw new $P.Exception(q[1]);}
if(c){try{r=c.call(this,r[1]);}catch(ey){throw new $P.Exception(r[1]);}}
return[rx,(r?r[1]:s)];};},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]];};},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)));},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s);}catch(e){continue;}
rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1]);}catch(ex){last=true;}}else{last=true;}
if(!last&&q[1].length===0){last=true;}
if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j]);}}
p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1];}}
if(rx[1].length<best[1].length){best=rx;}
if(best[1].length===0){break;}}
if(best[0].length===0){return best;}
if(c){try{q=c.call(this,best[1]);}catch(ey){throw new $P.Exception(best[1]);}
best[1]=q[1];}
return best;};},forward:function(gr,fname){return function(s){return gr[fname].call(this,s);};},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]];};},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]];};},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s);}
return rx;};}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments);}else if(arguments[0]instanceof Array){args=arguments[0];}
if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx;}}else{return op.apply(null,arguments);}};};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]]);}
var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0]);}else{return op.apply(null,arguments);}};};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]]);}}());(function(){var $D=Date,$P=$D.prototype;var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]));}else{if(ax[i]){rx.push(ax[i]);}}}
return rx;};$D.Grammar={};$D.Translator={hour:function(s){return function(){this.hour=Number(s);};},minute:function(s){return function(){this.minute=Number(s);};},second:function(s){return function(){this.second=Number(s);};},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase();};},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n);}else{this.timezone=s.toLowerCase();}};},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0]);};},month:function(s){return function(){this.month=(s.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1;};},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<$D.CultureInfo.twoDigitYearMax)?2000:1900)));};},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(x){x=(x instanceof Array)?x:[x];for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this);}}
var now=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=now.getDate();}
if(!this.year){this.year=now.getFullYear();}
if(!this.month&&this.month!==0){this.month=now.getMonth();}
if(!this.day){this.day=1;}
if(!this.hour){this.hour=0;}
if(!this.minute){this.minute=0;}
if(!this.second){this.second=0;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.day>$D.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}
var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone});}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset});}
return r;},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null;}
for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this);}}
var today=$D.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else if(this.now){today=new Date();}
var expression=!!(this.days&&this.days!==null||this.orient||this.operator);var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){today.setTimeToNow();}
if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;expression=true;}}
if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(!this.month){this.month=temp.getMonth();}
this.year=temp.getFullYear();}
if(expression&&this.weekday&&this.unit!="month"){this.unit="day";gap=($D.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod);}
if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}
if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}
if(this.month&&!this.day&&this.value){today.set({day:this.value*1});if(!expression){this.day=this.value*1;}}
if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;expression=true;}
if(expression&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null;}
if(!this.unit){this.unit="day";}
if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*orient;}else if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}
this[this.unit+"s"]=this.value*orient;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(temp.getMonth()!==today.getMonth()){this.month=temp.getMonth();}}
if((this.month||this.month===0)&&!this.day){this.day=1;}
if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}
if(expression&&this.timezone&&this.day&&this.days){this.day=this.days;}
return(expression)?today.add(this):today.set(this);}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$D.CultureInfo.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));}
fn=_C[keys]=_.any.apply(null,px);}
return fn;};g.ctoken2=function(key){return _.rtoken($D.CultureInfo.regexPatterns[key]);};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s;};}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")));};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s;};});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s;};});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s;};});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"");};});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter);};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[$D.CultureInfo.dateElementOrder]||g.mdy).call(this,s));};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt];}else{throw $D.Parsing.Exception(fmt);}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s));}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact);});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0]);};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]));}
return _.any.apply(null,rx);}else{return _get(fx);}};g._formats=g.formats(["\"yyyy-MM-ddTHH:mm:ssZ\"","yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r;}}catch(e){}
return g._start.call({},s);};$D._parse=$D.parse;$D.parse=function(s){var r=null;if(!s){return null;}
if(s instanceof Date){return s;}
try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};};$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s);};}());;

/* /web/static/lib/datejs/sugarpak.js defined in bundle 'web.assets_backend' */
(function(){var $D=Date,$P=$D.prototype,$N=Number.prototype;$P._orient=+1;$P._nth=null;$P._is=false;$P._same=false;$P._isSecond=false;$N._dateElement="day";$P.next=function(){this._orient=+1;return this;};$D.next=function(){return $D.today().next();};$P.last=$P.prev=$P.previous=function(){this._orient=-1;return this;};$D.last=$D.prev=$D.previous=function(){return $D.today().last();};$P.is=function(){this._is=true;return this;};$P.same=function(){this._same=true;this._isSecond=false;return this;};$P.today=function(){return this.same().day();};$P.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}
return false;};$P.at=function(time){return(typeof time==="string")?$D.parse(this.toString("d")+" "+time):this.set(time);};$N.fromNow=$N.after=function(date){var c={};c[this._dateElement]=this;return((!date)?new Date():date.clone()).add(c);};$N.ago=$N.before=function(date){var c={};c[this._dateElement]=this*-1;return((!date)?new Date():date.clone()).add(c);};var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),pxf=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),nth=("final first second third fourth fifth").split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++){o[px[i].toLowerCase()]=this["get"+pxf[i]]();}
return o;};$D.fromObject=function(config){config.week=null;return Date.today().set(config);};var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n;}
if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}
this._isSecond=false;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp){throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");}
return this;}
return this.moveToDayOfWeek(n,this._orient);};};var sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();if(n===0&&$D.CultureInfo.firstDayOfWeek===1&&t.getDay()!==0){shift=shift+7;}
return t.addDays(shift);};};for(var i=0;i<dx.length;i++){$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i;$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i);$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);}
var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n;}
return this.moveToMonth(n,this._orient);};};var smf=function(n){return function(){return $D.today().set({month:n,day:1});};};for(var j=0;j<mx.length;j++){$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j;$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j);$P[mx[j]]=$P[mx[j].substring(0,3)]=mf(j);}
var ef=function(j){return function(){if(this._isSecond){this._isSecond=false;return this;}
if(this._same){this._same=this._is=false;var o1=this.toObject(),o2=(arguments[0]||new Date()).toObject(),v="",k=j.toLowerCase();for(var m=(px.length-1);m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v]){return false;}
if(k==v){break;}}
return true;}
if(j.substring(j.length-1)!="s"){j+="s";}
return this["add"+j](this._orient);};};var nf=function(n){return function(){this._dateElement=n;return this;};};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$P[de]=$P[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de);}
$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){if(this._same){return this._ss(arguments[0]);}
if(dayOfWeek||dayOfWeek===0){return this.moveToNthOccurrence(dayOfWeek,n);}
this._nth=n;if(n===2&&(dayOfWeek===undefined||dayOfWeek===null)){this._isSecond=true;return this.addSeconds(this._orient);}
return this;};};for(var l=0;l<nth.length;l++){$P[nth[l]]=(l===0)?nthfn(-1):nthfn(l);}}());;

/* /web/static/lib/datejs/extras.js defined in bundle 'web.assets_backend' */
(function(){var $D=Date,$P=$D.prototype,$f=[],p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$D.normalizeFormat=function(format){$f=[];var t=new Date().$format(format);return $f.join("");};$D.strftime=function(format,time){return new Date(time*1000).$format(format);};$D.strtotime=function(time){var d=$D.parse(time);d.addMinutes(d.getTimezoneOffset()*-1);return Math.round($D.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds())/1000);};$P.$format=function(format){var x=this,y,t=function(v){$f.push(v);return x.toString(v);};return format?format.replace(/(%|\\)?.|%%/g,function(m){if(m.charAt(0)==="\\"||m.substring(0,2)==="%%"){return m.replace("\\","").replace("%%","%");}
switch(m){case"d":case"%d":return t("dd");case"D":case"%a":return t("ddd");case"j":case"%e":return t("d");case"l":case"%A":return t("dddd");case"N":case"%u":return x.getDay()+1;case"S":return t("S");case"w":case"%w":return x.getDay();case"z":return x.getOrdinalNumber();case"%j":return p(x.getOrdinalNumber(),3);case"%U":var d1=x.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),d2=x.clone().addDays(1).moveToDayOfWeek(0,-1);return(d2<d1)?"00":p((d2.getOrdinalNumber()-d1.getOrdinalNumber())/7+1);case"W":case"%V":return x.getISOWeek();case"%W":return p(x.getWeek());case"F":case"%B":return t("MMMM");case"m":case"%m":return t("MM");case"M":case"%b":case"%h":return t("MMM");case"n":return t("M");case"t":return $D.getDaysInMonth(x.getFullYear(),x.getMonth());case"L":return($D.isLeapYear(x.getFullYear()))?1:0;case"o":case"%G":return x.setWeek(x.getISOWeek()).toString("yyyy");case"%g":return x.$format("%G").slice(-2);case"Y":case"%Y":return t("yyyy");case"y":case"%y":return t("yy");case"a":case"%p":return t("tt").toLowerCase();case"A":return t("tt").toUpperCase();case"g":case"%I":return t("h");case"G":return t("H");case"h":return t("hh");case"H":case"%H":return t("HH");case"i":case"%M":return t("mm");case"s":case"%S":return t("ss");case"u":return p(x.getMilliseconds(),3);case"I":return(x.isDaylightSavingTime())?1:0;case"O":return x.getUTCOffset();case"P":y=x.getUTCOffset();return y.substring(0,y.length-2)+":"+y.substring(y.length-2);case"e":case"T":case"%z":case"%Z":return x.getTimezone();case"Z":return x.getTimezoneOffset()*-60;case"B":var now=new Date();return Math.floor(((now.getHours()*3600)+(now.getMinutes()*60)+now.getSeconds()+(now.getTimezoneOffset()+60)*60)/86.4);case"c":return x.toISOString().replace(/\"/g,"");case"U":return $D.strtotime("now");case"%c":return t("d")+" "+t("t");case"%C":return Math.floor(x.getFullYear()/100+1);case"%D":return t("MM/dd/yy");case"%n":return"\\n";case"%t":return"\\t";case"%r":return t("hh:mm tt");case"%R":return t("H:mm");case"%T":return t("H:mm:ss");case"%x":return t("d");case"%X":return t("t");default:$f.push(m);return m;}}):this._toString();};if(!$P.format){$P.format=$P.$format;}}());;

/* /web/static/lib/jquery.validate/jquery.validate.js defined in bundle 'web.assets_backend' */
(function($){$.extend($.fn,{validate:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return;}
var validator=$.data(this[0],'validator');if(validator){return validator;}
validator=new $.validator(options,this[0]);$.data(this[0],'validator',validator);if(validator.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){validator.cancelSubmit=true;});if(validator.settings.submitHandler){this.find("input, button").filter(":submit").click(function(){validator.submitButton=this;});}
this.submit(function(event){if(validator.settings.debug)
event.preventDefault();function handle(){if(validator.settings.submitHandler){if(validator.submitButton){var hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val(validator.submitButton.value).appendTo(validator.currentForm);}
validator.settings.submitHandler.call(validator,validator.currentForm);if(validator.submitButton){hidden.remove();}
return false;}
return true;}
if(validator.cancelSubmit){validator.cancelSubmit=false;return handle();}
if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false;}
return handle();}else{validator.focusInvalid();return false;}});}
return validator;},valid:function(){if($(this[0]).is('form')){return this.validate().form();}else{var valid=true;var validator=$(this[0].form).validate();this.each(function(){valid&=validator.element(this);});return valid;}},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value);});return result;},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,'validator').settings;var staticRules=settings.rules;var existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));staticRules[element.name]=existingRules;if(argument.messages)
settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);break;case"remove":if(!argument){delete staticRules[element.name];return existingRules;}
var filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method];});return filtered;}}
var data=$.validator.normalizeRules($.extend({},$.validator.metadataRules(element),$.validator.classRules(element),$.validator.attributeRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required;data=$.extend({required:param},data);}
return data;}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+a.value);},filled:function(a){return!!$.trim(""+a.value);},unchecked:function(a){return!a.checked;}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init();};$.validator.format=function(source,params){if(arguments.length==1)
return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args);};if(arguments.length>2&&params.constructor!=Array){params=$.makeArray(arguments).slice(1);}
if(params.constructor!=Array){params=[params];}
$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),n);});return source;};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(element){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(element)).hide();}},onfocusout:function(element){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element);}},onkeyup:function(element){if(element.name in this.submitted||element==this.lastElement){this.element(element);}},onclick:function(element){if(element.name in this.submitted)
this.element(element);else if(element.parentNode.name in this.submitted)
this.element(element.parentNode);},highlight:function(element,errorClass,validClass){if(element.type==='radio'){this.findByName(element.name).addClass(errorClass).removeClass(validClass);}else{$(element).addClass(errorClass).removeClass(validClass);}},unhighlight:function(element,errorClass,validClass){if(element.type==='radio'){this.findByName(element.name).removeClass(errorClass).addClass(validClass);}else{$(element).removeClass(errorClass).addClass(validClass);}}},setDefaults:function(settings){$.extend($.validator.defaults,settings);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=(this.groups={});$.each(this.settings.groups,function(key,value){$.each(value.split(/\s/),function(index,name){groups[name]=key;});});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value);});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,"");validator.settings[eventType]&&validator.settings[eventType].call(validator,this[0]);}
$(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",delegate).validateDelegate(":radio, :checkbox, select, option","click",delegate);if(this.settings.invalidHandler)
$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid())
$(this.currentForm).triggerHandler("invalid-form",[this]);this.showErrors();return this.valid();},checkForm:function(){this.prepareForm();for(var i=0,elements=(this.currentElements=this.elements());elements[i];i++){this.check(elements[i]);}
return this.valid();},element:function(element){element=this.clean(element);this.lastElement=element;this.prepareElement(element);this.currentElements=$(element);var result=this.check(element);if(result){delete this.invalid[element.name];}else{this.invalid[element.name]=true;}
if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers);}
this.showErrors();return result;},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]});}
this.successList=$.grep(this.successList,function(element){return!(element.name in errors);});}
this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors();},resetForm:function(){if($.fn.resetForm)
$(this.currentForm).resetForm();this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass);},numberOfInvalids:function(){return this.objectLength(this.invalid);},objectLength:function(obj){var count=0;for(var i in obj)
count++;return count;},hideErrors:function(){this.addWrapper(this.toHide).hide();},valid:function(){return this.size()==0;},size:function(){return this.errorList.length;},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin");}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name==lastActive.name;}).length==1&&lastActive;},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&validator.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in rulesCache||!validator.objectLength($(this).rules()))
return false;rulesCache[this.name]=true;return true;});},clean:function(selector){return $(selector)[0];},errors:function(){return $(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext);},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([]);},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers);},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element);},check:function(element){element=this.clean(element);if(this.checkable(element)){element=this.findByName(element.name).not(this.settings.ignore)[0];}
var rules=$(element).rules();var dependencyMismatch=false;for(var method in rules){var rule={method:method,parameters:rules[method]};try{var result=$.validator.methods[method].call(this,element.value.replace(/\r/g,""),element,rule.parameters);if(result=="dependency-mismatch"){dependencyMismatch=true;continue;}
dependencyMismatch=false;if(result=="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return;}
if(!result){this.formatAndAdd(element,rule);return false;}}catch(e){this.settings.debug&&window.console&&console.log("exception occured when checking element "+element.id
+", check the '"+rule.method+"' method",e);throw e;}}
if(dependencyMismatch)
return;if(this.objectLength(rules))
this.successList.push(element);return true;},customMetaMessage:function(element,method){if(!$.metadata)
return;var meta=this.settings.meta?$(element).metadata()[this.settings.meta]:$(element).metadata();return meta&&meta.messages&&meta.messages[method];},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor==String?m:m[method]);},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined)
return arguments[i];}
return undefined;},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customMetaMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>");},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message=="function"){message=message.call(this,rule.parameters,element);}else if(theregex.test(message)){message=jQuery.format(message.replace(theregex,'{$1}'),rule.parameters);}
this.errorList.push({message:message,element:element});this.errorMap[element.name]=message;this.submitted[element.name]=message;},addWrapper:function(toToggle){if(this.settings.wrapper)
toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));return toToggle;},defaultShowErrors:function(){for(var i=0;this.errorList[i];i++){var error=this.errorList[i];this.settings.highlight&&this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);this.showLabel(error.element,error.message);}
if(this.errorList.length){this.toShow=this.toShow.add(this.containers);}
if(this.settings.success){for(var i=0;this.successList[i];i++){this.showLabel(this.successList[i]);}}
if(this.settings.unhighlight){for(var i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);}}
this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show();},validElements:function(){return this.currentElements.not(this.invalidElements());},invalidElements:function(){return $(this.errorList).map(function(){return this.element;});},showLabel:function(element,message){var label=this.errorsFor(element);if(label.length){label.removeClass().addClass(this.settings.errorClass);label.attr("generated")&&label.html(message);}else{label=$("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(element),generated:true}).addClass(this.settings.errorClass).html(message||"");if(this.settings.wrapper){label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();}
if(!this.labelContainer.append(label).length)
this.settings.errorPlacement?this.settings.errorPlacement(label,$(element)):label.insertAfter(element);}
if(!message&&this.settings.success){label.text("");typeof this.settings.success=="string"?label.addClass(this.settings.success):this.settings.success(label);}
this.toShow=this.toShow.add(label);},errorsFor:function(element){var name=this.idOrName(element);return this.errors().filter(function(){return $(this).attr('for')==name;});},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name);},checkable:function(element){return/radio|checkbox/i.test(element.type);},findByName:function(name){var form=this.currentForm;return $(document.getElementsByName(name)).map(function(index,element){return element.form==form&&element.name==name&&element||null;});},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case'select':return $("option:selected",element).length;case'input':if(this.checkable(element))
return this.findByName(element.name).filter(':checked').length;}
return value.length;},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true;},dependTypes:{"boolean":function(param,element){return param;},"string":function(param,element){return!!$(param,element.form).length;},"function":function(param,element){return param(element);}},optional:function(element){return!$.validator.methods.required.call(this,$.trim(element.value),element)&&"dependency-mismatch";},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true;}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0)
this.pendingRequest=0;delete this.pending[element.name];if(valid&&this.pendingRequest==0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false;}else if(!valid&&this.pendingRequest==0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false;}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")});}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){className.constructor==String?this.classRuleSettings[className]=rules:$.extend(this.classRuleSettings,className);},classRules:function(element){var rules={};var classes=$(element).attr('class');classes&&$.each(classes.split(' '),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this]);}});return rules;},attributeRules:function(element){var rules={};var $element=$(element);for(var method in $.validator.methods){var value=$element.attr(method);if(value){rules[method]=value;}}
if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength;}
return rules;},metadataRules:function(element){if(!$.metadata)return{};var meta=$.data(element.form,'validator').settings.meta;return meta?$(element).metadata()[meta]:$(element).metadata();},staticRules:function(element){var rules={};var validator=$.data(element.form,'validator');if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{};}
return rules;},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return;}
if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break;}
if(keepRule){rules[prop]=val.param!==undefined?val.param:true;}else{delete rules[prop];}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter;});$.each(['minlength','maxlength','min','max'],function(){if(rules[this]){rules[this]=Number(rules[this]);}});$.each(['rangelength','range'],function(){if(rules[this]){rules[this]=[Number(rules[this][0]),Number(rules[this][1])];}});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max;}
if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength;}}
if(rules.messages){delete rules.messages;}
return rules;},normalizeRule:function(data){if(typeof data=="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true;});data=transformed;}
return data;},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!=undefined?message:$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name));}},methods:{required:function(value,element,param){if(!this.depend(param,element))
return"dependency-mismatch";switch(element.nodeName.toLowerCase()){case'select':var val=$(element).val();return val&&val.length>0;case'input':if(this.checkable(element))
return this.getLength(value,element)>0;default:return $.trim(value).length>0;}},remote:function(value,element,param){if(this.optional(element))
return"dependency-mismatch";var previous=this.previousValue(element);if(!this.settings.messages[element.name])
this.settings.messages[element.name]={};previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param=="string"&&{url:param}||param;if(this.pending[element.name]){return"pending";}
if(previous.old===value){return previous.valid;}
previous.old=value;var validator=this;this.startRequest(element);var data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){validator.settings.messages[element.name].remote=previous.originalMessage;var valid=response===true;if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);validator.showErrors();}else{var errors={};var message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.showErrors(errors);}
previous.valid=valid;validator.stopRequest(element,valid);}},param));return"pending";},minlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)>=param;},maxlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)<=param;},rangelength:function(value,element,param){var length=this.getLength($.trim(value),element);return this.optional(element)||(length>=param[0]&&length<=param[1]);},min:function(value,element,param){return this.optional(element)||value>=param;},max:function(value,element,param){return this.optional(element)||value<=param;},range:function(value,element,param){return this.optional(element)||(value>=param[0]&&value<=param[1]);},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(value);},url:function(value,element){return this.optional(element)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value));},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(value);},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(value);},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value);},creditcard:function(value,element){if(this.optional(element))
return"dependency-mismatch";if(/[^0-9-]+/.test(value))
return false;var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);var nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9)
nDigit-=9;}
nCheck+=nDigit;bEven=!bEven;}
return(nCheck%10)==0;},accept:function(value,element,param){param=typeof param=="string"?param.replace(/,/g,'|'):"png|jpe?g|gif";return this.optional(element)||value.match(new RegExp(".("+param+")$","i"));},equalTo:function(value,element,param){var target=$(param).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid();});return value==target.val();}}});$.format=$.validator.format;})(jQuery);;(function($){var pendingRequests={};if($.ajaxPrefilter){$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode=="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=xhr;}});}else{var ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode=="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
return(pendingRequests[port]=ajax.apply(this,arguments));}
return ajax.apply(this,arguments);};}})(jQuery);;(function($){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){$.each({focus:'focusin',blur:'focusout'},function(original,fix){$.event.special[fix]={setup:function(){this.addEventListener(original,handler,true);},teardown:function(){this.removeEventListener(original,handler,true);},handler:function(e){arguments[0]=$.event.fix(e);arguments[0].type=fix;return $.event.handle.apply(this,arguments);}};function handler(e){e=$.event.fix(e);e.type=fix;return $.event.handle.call(this,e);}});};$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments);}});}});})(jQuery);;

/* /web/static/lib/jquery.autosize/jquery.autosize.js defined in bundle 'web.assets_backend' */
(function($){var
hidden='hidden',borderBox='border-box',lineHeight='lineHeight',copy='<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden">',copyStyle=['fontFamily','fontSize','fontWeight','fontStyle','letterSpacing','textTransform','wordSpacing','textIndent'],oninput='oninput',onpropertychange='onpropertychange',test=$(copy)[0];test.setAttribute(oninput,"return");if($.isFunction(test[oninput])||onpropertychange in test){$(test).css(lineHeight,'99px');if($(test).css(lineHeight)==='99px'){copyStyle.push(lineHeight);}
$.fn.autosize=function(className){return this.each(function(){var
ta=this,$ta=$(ta),mirror,minHeight=$ta.height(),maxHeight=parseInt($ta.css('maxHeight'),10),active,i=copyStyle.length,resize,boxOffset=0;if($ta.css('box-sizing')===borderBox||$ta.css('-moz-box-sizing')===borderBox||$ta.css('-webkit-box-sizing')===borderBox){boxOffset=$ta.outerHeight()-$ta.height();}
if($ta.data('mirror')||$ta.data('ismirror')){return;}else{mirror=$(copy).data('ismirror',true).addClass(className||'autosizejs')[0];if($ta.attr('disabled')){$ta.css('resize','none');}
resize=$ta.css('resize')==='none'?'none':'vertical';$ta.data('mirror',$(mirror)).css({overflow:hidden,overflowY:hidden,wordWrap:'break-word',resize:resize});}
maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4;function adjust(){var height,overflow;if(!active){active=true;mirror.value=ta.value;mirror.style.overflowY=ta.style.overflowY;mirror.style.width=$ta.css('width');mirror.scrollTop=0;mirror.scrollTop=9e4;height=mirror.scrollTop;overflow=hidden;if(height>maxHeight){height=maxHeight;overflow='scroll';}else if(height<minHeight){height=minHeight;}
ta.style.overflowY=overflow;ta.style.height=height+boxOffset+'px';setTimeout(function(){active=false;},1);}}
while(i--){mirror.style[copyStyle[i]]=$ta.css(copyStyle[i]);}
$('body').append(mirror);if(onpropertychange in ta){if(oninput in ta){ta[oninput]=ta.onkeyup=adjust;}else{ta[onpropertychange]=adjust;}}else{ta[oninput]=adjust;}
$(window).resize(adjust);$ta.bind('autosize',adjust);adjust();});};}else{$.fn.autosize=function(){return this;};}}(jQuery));;

/* /web/static/lib/jquery.scrollTo/jquery.scrollTo-min.js defined in bundle 'web.assets_backend' */
;(function(d){var k=d.scrollTo=function(a,i,e){d(window).scrollTo(a,i,e)};k.defaults={axis:'xy',duration:parseFloat(d.fn.jquery)>=1.3?0:1};k.window=function(a){return d(window)._scrollable()};d.fn._scrollable=function(){return this.map(function(){var a=this,i=!a.nodeName||d.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!i)return a;var e=(a.contentWindow||a).document||a.ownerDocument||a;return d.browser.safari||e.compatMode=='BackCompat'?e.body:e.documentElement})};d.fn.scrollTo=function(n,j,b){if(typeof j=='object'){b=j;j=0}if(typeof b=='function')b={onAfter:b};if(n=='max')n=9e9;b=d.extend({},k.defaults,b);j=j||b.speed||b.duration;b.queue=b.queue&&b.axis.length>1;if(b.queue)j/=2;b.offset=p(b.offset);b.over=p(b.over);return this._scrollable().each(function(){var q=this,r=d(q),f=n,s,g={},u=r.is('html,body');switch(typeof f){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(f)){f=p(f);break}f=d(f,this);case'object':if(f.is||f.style)s=(f=d(f)).offset()}d.each(b.axis.split(''),function(a,i){var e=i=='x'?'Left':'Top',h=e.toLowerCase(),c='scroll'+e,l=q[c],m=k.max(q,i);if(s){g[c]=s[h]+(u?0:l-r.offset()[h]);if(b.margin){g[c]-=parseInt(f.css('margin'+e))||0;g[c]-=parseInt(f.css('border'+e+'Width'))||0}g[c]+=b.offset[h]||0;if(b.over[h])g[c]+=f[i=='x'?'width':'height']()*b.over[h]}else{var o=f[h];g[c]=o.slice&&o.slice(-1)=='%'?parseFloat(o)/100*m:o}if(/^\d+$/.test(g[c]))g[c]=g[c]<=0?0:Math.min(g[c],m);if(!a&&b.queue){if(l!=g[c])t(b.onAfterFirst);delete g[c]}});t(b.onAfter);function t(a){r.animate(g,j,b.easing,a&&function(){a.call(this,n,b)})}}).end()};k.max=function(a,i){var e=i=='x'?'Width':'Height',h='scroll'+e;if(!d(a).is('html,body'))return a[h]-d(a)[e.toLowerCase()]();var c='client'+e,l=a.ownerDocument.documentElement,m=a.ownerDocument.body;return Math.max(l[h],m[h])-Math.min(l[c],m[c])};function p(a){return typeof a=='object'?a:{top:a,left:a}}})(jQuery);;

/* /web/static/lib/cleditor/jquery.cleditor.js defined in bundle 'web.assets_backend' */
﻿
(function($){$.cleditor={defaultOptions:{width:'auto',height:250,controls:"bold italic underline strikethrough subscript superscript | font size "+"style | color highlight removeformat | bullets numbering | outdent "+"indent | alignleft center alignright justify | undo redo | "+"rule image link unlink | cut copy paste pastetext | print source",colors:"FFF FCC FC9 FF9 FFC 9F9 9FF CFF CCF FCF "+"CCC F66 F96 FF6 FF3 6F9 3FF 6FF 99F F9F "+"BBB F00 F90 FC6 FF0 3F3 6CC 3CF 66C C6C "+"999 C00 F60 FC3 FC0 3C0 0CC 36F 63F C3C "+"666 900 C60 C93 990 090 399 33F 60C 939 "+"333 600 930 963 660 060 366 009 339 636 "+"000 300 630 633 330 030 033 006 309 303",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Narrow,Garamond,"+"Georgia,Impact,Sans Serif,Serif,Tahoma,Trebuchet MS,Verdana",sizes:"1,2,3,4,5,6,7",styles:[["Paragraph","<p>"],["Header 1","<h1>"],["Header 2","<h2>"],["Header 3","<h3>"],["Header 4","<h4>"],["Header 5","<h5>"],["Header 6","<h6>"]],useCSS:true,docType:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',docCSSFile:"",bodyStyle:"margin:4px; color:#4c4c4c; font-size:13px; font-family:\"Lucida Grande\",Helvetica,Verdana,Arial,sans-serif; cursor:text"},buttons:{init:"bold,,|"+"italic,,|"+"underline,,|"+"strikethrough,,|"+"subscript,,|"+"superscript,,|"+"font,,fontname,|"+"size,Font Size,fontsize,|"+"style,,formatblock,|"+"color,Font Color,forecolor,|"+"highlight,Text Highlight Color,hilitecolor,color|"+"removeformat,Remove Formatting,|"+"bullets,,insertunorderedlist|"+"numbering,,insertorderedlist|"+"outdent,,|"+"indent,,|"+"alignleft,Align Text Left,justifyleft|"+"center,,justifycenter|"+"alignright,Align Text Right,justifyright|"+"justify,,justifyfull|"+"undo,,|"+"redo,,|"+"rule,Insert Horizontal Rule,inserthorizontalrule|"+"image,Insert Image,insertimage,url|"+"link,Insert Hyperlink,createlink,url|"+"unlink,Remove Hyperlink,|"+"cut,,|"+"copy,,|"+"paste,,|"+"pastetext,Paste as Text,inserthtml,|"+"print,,|"+"source,Show Source"},imagesPath:function(){return imagesPath();}};$.fn.cleditor=function(options){var $result=$([]);this.each(function(idx,elem){if(elem.tagName.toUpperCase()==="TEXTAREA"){var data=$.data(elem,CLEDITOR);if(!data)data=new cleditor(elem,options);$result=$result.add(data);}});return $result;};var
BACKGROUND_COLOR="backgroundColor",BLURRED="blurred",BUTTON="button",BUTTON_NAME="buttonName",CHANGE="change",CLEDITOR="cleditor",CLICK="click",DISABLED="disabled",DIV_TAG="<div>",FOCUSED="focused",TRANSPARENT="transparent",UNSELECTABLE="unselectable",MAIN_CLASS="cleditorMain",TOOLBAR_CLASS="cleditorToolbar",GROUP_CLASS="cleditorGroup",BUTTON_CLASS="cleditorButton",DISABLED_CLASS="cleditorDisabled",DIVIDER_CLASS="cleditorDivider",POPUP_CLASS="cleditorPopup",LIST_CLASS="cleditorList",COLOR_CLASS="cleditorColor",PROMPT_CLASS="cleditorPrompt",MSG_CLASS="cleditorMsg",ua=navigator.userAgent.toLowerCase(),ie=/msie/.test(ua),ie6=/msie\s6/.test(ua),iege11=/(trident)(?:.*rv:([\w.]+))?/.test(ua),webkit=/webkit/.test(ua),iOS=/iphone|ipad|ipod/i.test(ua),popups={},documentClickAssigned,buttons=$.cleditor.buttons;$.each(buttons.init.split("|"),function(idx,button){var items=button.split(","),name=items[0];buttons[name]={stripIndex:idx,name:name,title:items[1]===""?name.charAt(0).toUpperCase()+name.substr(1):items[1],command:items[2]===""?name:items[2],popupName:items[3]===""?name:items[3]};});delete buttons.init;cleditor=function(area,options){var editor=this;editor.options=options=$.extend({},$.cleditor.defaultOptions,options);var $area=editor.$area=$(area).hide().data(CLEDITOR,editor).blur(function(){updateFrame(editor,true);});var $main=editor.$main=$(DIV_TAG).addClass(MAIN_CLASS).width(options.width).height(options.height);var $toolbar=editor.$toolbar=$(DIV_TAG).addClass(TOOLBAR_CLASS).appendTo($main);var $group=$(DIV_TAG).addClass(GROUP_CLASS).appendTo($toolbar);var groupWidth=0;$.each(options.controls.split(" "),function(idx,buttonName){if(buttonName==="")return true;if(buttonName==="|"){var $div=$(DIV_TAG).addClass(DIVIDER_CLASS).appendTo($group);$group.width(groupWidth+1);groupWidth=0;$group=$(DIV_TAG).addClass(GROUP_CLASS).appendTo($toolbar);}
else{var button=buttons[buttonName];var $buttonDiv=$(DIV_TAG).data(BUTTON_NAME,button.name).addClass(BUTTON_CLASS).attr("title",button.title).bind(CLICK,$.proxy(buttonClick,editor)).appendTo($group).hover(hoverEnter,hoverLeave);groupWidth+=24;$group.width(groupWidth+1);var map={};if(button.css)map=button.css;else if(button.image)map.backgroundImage=imageUrl(button.image);if(button.stripIndex)map.backgroundPosition=button.stripIndex*-24;$buttonDiv.css(map);if(ie)
$buttonDiv.attr(UNSELECTABLE,"on");if(button.popupName)
createPopup(button.popupName,options,button.popupClass,button.popupContent,button.popupHover);}});$main.insertBefore($area).append($area);if(!documentClickAssigned){$(document).click(function(e){var $target=$(e.target);if(!$target.add($target.parents()).is("."+PROMPT_CLASS))
hidePopups();});documentClickAssigned=true;}
if(/auto|%/.test(""+options.width+options.height))
$(window).bind('resize.cleditor',function(){var contentWindow=editor.$frame[0].contentWindow;if(!$.browser.mozilla&&contentWindow){$(contentWindow).trigger('blur');}
if(editor.$main.parent().parent().size()){refresh(editor);}});refresh(editor);};var fn=cleditor.prototype,methods=[["clear",clear],["disable",disable],["execCommand",execCommand],["focus",focus],["hidePopups",hidePopups],["sourceMode",sourceMode,true],["refresh",refresh],["select",select],["selectedHTML",selectedHTML,true],["selectedText",selectedText,true],["showMessage",showMessage],["updateFrame",updateFrame],["updateTextArea",updateTextArea]];$.each(methods,function(idx,method){fn[method[0]]=function(){var editor=this,args=[editor];for(var x=0;x<arguments.length;x++){args.push(arguments[x]);}
var result=method[1].apply(editor,args);if(method[2])return result;return editor;};});fn.blurred=function(handler){var $this=$(this);return handler?$this.bind(BLURRED,handler):$this.trigger(BLURRED);};fn.change=function change(handler){var $this=$(this);return handler?$this.bind(CHANGE,handler):$this.trigger(CHANGE);};fn.focused=function(handler){var $this=$(this);return handler?$this.bind(FOCUSED,handler):$this.trigger(FOCUSED);};function buttonClick(e){var editor=this,buttonDiv=e.target,buttonName=$.data(buttonDiv,BUTTON_NAME),button=buttons[buttonName],popupName=button.popupName,popup=popups[popupName];if(editor.disabled||$(buttonDiv).attr(DISABLED)===DISABLED)
return;var data={editor:editor,button:buttonDiv,buttonName:buttonName,popup:popup,popupName:popupName,command:button.command,useCSS:editor.options.useCSS};if(button.buttonClick&&button.buttonClick(e,data)===false)
return false;if(buttonName==="source"){if(sourceMode(editor)){delete editor.range;editor.$area.hide();editor.$frame.show();buttonDiv.title=button.title;}
else{editor.$frame.hide();editor.$area.show();buttonDiv.title="Show Rich Text";}
setTimeout(function(){refreshButtons(editor);},100);}
else if(!sourceMode(editor)){if(popupName){var $popup=$(popup);if(popupName==="url"){if(buttonName==="link"&&selectedText(editor)===""){showMessage(editor,"A selection is required when inserting a link.",buttonDiv);return false;}
$popup.children(":button").unbind(CLICK).bind(CLICK,function(){var $text=$popup.find(":text"),url=$.trim($text.val());if(url!=="")
execCommand(editor,data.command,url,null,data.button);$text.val("http://");hidePopups();focus(editor);});}
else if(popupName==="pastetext"){$popup.children(":button").unbind(CLICK).bind(CLICK,function(){var $textarea=$popup.find("textarea"),text=$textarea.val().replace(/\n/g,"<br />");if(text!=="")
execCommand(editor,data.command,text,null,data.button);$textarea.val("");hidePopups();focus(editor);});}
if(buttonDiv!==$.data(popup,BUTTON)){showPopup(editor,popup,buttonDiv);return false;}
return;}
else if(buttonName==="print")
editor.$frame[0].contentWindow.print();else if(!execCommand(editor,data.command,data.value,data.useCSS,buttonDiv))
return false;}
focus(editor);}
function hoverEnter(e){var $div=$(e.target).closest("div");$div.css(BACKGROUND_COLOR,$div.data(BUTTON_NAME)?"#FFF":"#FFC");}
function hoverLeave(e){$(e.target).closest("div").css(BACKGROUND_COLOR,"transparent");}
function popupClick(e){var editor=this,popup=e.data.popup,target=e.target;if(popup===popups.msg||$(popup).hasClass(PROMPT_CLASS))
return;var buttonDiv=$.data(popup,BUTTON),buttonName=$.data(buttonDiv,BUTTON_NAME),button=buttons[buttonName],command=button.command,value,useCSS=editor.options.useCSS;if(buttonName==="font")
value=target.style.fontFamily.replace(/"/g,"");else if(buttonName==="size"){if(target.tagName.toUpperCase()==="DIV")
target=target.children[0];value=target.innerHTML;}
else if(buttonName==="style")
value="<"+target.tagName+">";else if(buttonName==="color")
value=hex(target.style.backgroundColor);else if(buttonName==="highlight"){value=hex(target.style.backgroundColor);if(ie)command='backcolor';else useCSS=true;}
var data={editor:editor,button:buttonDiv,buttonName:buttonName,popup:popup,popupName:button.popupName,command:command,value:value,useCSS:useCSS};if(button.popupClick&&button.popupClick(e,data)===false)
return;if(data.command&&!execCommand(editor,data.command,data.value,data.useCSS,buttonDiv))
return false;hidePopups();focus(editor);}
function checksum(text)
{var a=1,b=0;for(var index=0;index<text.length;++index){a=(a+text.charCodeAt(index))%65521;b=(b+a)%65521;}
return(b<<16)|a;}
function clear(editor){editor.$area.val("");updateFrame(editor);}
function createPopup(popupName,options,popupTypeClass,popupContent,popupHover){if(popups[popupName])
return popups[popupName];var $popup=$(DIV_TAG).hide().addClass(POPUP_CLASS).appendTo("body");if(popupContent)
$popup.html(popupContent);else if(popupName==="color"){var colors=options.colors.split(" ");if(colors.length<10)
$popup.width("auto");$.each(colors,function(idx,color){$(DIV_TAG).appendTo($popup).css(BACKGROUND_COLOR,"#"+color);});popupTypeClass=COLOR_CLASS;}
else if(popupName==="font")
$.each(options.fonts.split(","),function(idx,font){$(DIV_TAG).appendTo($popup).css("fontFamily",font).html(font);});else if(popupName==="size")
$.each(options.sizes.split(","),function(idx,size){$(DIV_TAG).appendTo($popup).html('<font size="'+size+'">'+size+'</font>');});else if(popupName==="style")
$.each(options.styles,function(idx,style){$(DIV_TAG).appendTo($popup).html(style[1]+style[0]+style[1].replace("<","</"));});else if(popupName==="url"){$popup.html('Enter URL:<br /><input type="text" value="http://" size="35" /><br /><input type="button" value="Submit" />');popupTypeClass=PROMPT_CLASS;}
else if(popupName==="pastetext"){$popup.html('Paste your content here and click submit.<br /><textarea cols="40" rows="3"></textarea><br /><input type="button" value="Submit" />');popupTypeClass=PROMPT_CLASS;}
if(!popupTypeClass&&!popupContent)
popupTypeClass=LIST_CLASS;$popup.addClass(popupTypeClass);if(ie){$popup.attr(UNSELECTABLE,"on").find("div,font,p,h1,h2,h3,h4,h5,h6").attr(UNSELECTABLE,"on");}
if($popup.hasClass(LIST_CLASS)||popupHover===true)
$popup.children().hover(hoverEnter,hoverLeave);popups[popupName]=$popup[0];return $popup[0];}
function disable(editor,disabled){if(disabled){editor.$area.attr(DISABLED,DISABLED);editor.disabled=true;}
else{editor.$area.removeAttr(DISABLED);delete editor.disabled;}
try{if(ie)editor.doc.body.contentEditable=!disabled;else editor.doc.designMode=!disabled?"on":"off";}
catch(err){}
refreshButtons(editor);}
function execCommand(editor,command,value,useCSS,button){restoreRange(editor);if(!ie){if(useCSS===undefined||useCSS===null)
useCSS=editor.options.useCSS;editor.doc.execCommand("styleWithCSS",0,useCSS.toString());}
var success=true,message;if(ie&&command.toLowerCase()==="inserthtml")
getRange(editor).pasteHTML(value);else{try{success=editor.doc.execCommand(command,0,value||null);}
catch(err){message=err.message;success=false;}
if(!success){if("cutcopypaste".indexOf(command)>-1)
showMessage(editor,"For security reasons, your browser does not support the "+
command+" command. Try using the keyboard shortcut or context menu instead.",button);else
showMessage(editor,(message?message:"Error executing the "+command+" command."),button);}}
refreshButtons(editor);updateTextArea(editor,true);return success;}
function focus(editor){setTimeout(function(){if(sourceMode(editor))editor.$area.focus();else editor.$frame[0].contentWindow.focus();refreshButtons(editor);},0);}
function getRange(editor){if(ie)return getSelection(editor).createRange();return getSelection(editor).getRangeAt(0);}
function getSelection(editor){if(ie)return editor.doc.selection;return editor.$frame[0].contentWindow.getSelection();}
function hex(s){var m=/rgba?\((\d+), (\d+), (\d+)/.exec(s);if(m){s=(m[1]<<16|m[2]<<8|m[3]).toString(16);while(s.length<6)
s="0"+s;return"#"+s;}
var c=s.split("");if(s.length===4)
return"#"+c[1]+c[1]+c[2]+c[2]+c[3]+c[3];return s;}
function hidePopups(){$.each(popups,function(idx,popup){$(popup).hide().unbind(CLICK).removeData(BUTTON);});}
function imagesPath(){var href=$("link[href*=cleditor]").attr("href");return href.replace(/^(.*\/)[^\/]+$/,'$1')+"images/";}
function imageUrl(filename){return"url("+imagesPath()+filename+")";}
function refresh(editor){var $main=editor.$main,options=editor.options;if(editor.$frame)
editor.$frame.remove();var $frame=editor.$frame=$('<iframe frameborder="0" src="javascript:true;" />').hide().appendTo($main);var contentWindow=$frame[0].contentWindow,doc=editor.doc=contentWindow.document,$doc=$(doc);doc.open();doc.write(options.docType+'<html>'+
((options.docCSSFile==='')?'':'<head><link rel="stylesheet" type="text/css" href="'+options.docCSSFile+'" /></head>')+'<body style="'+options.bodyStyle+'"></body></html>');doc.close();if(ie||iege11)
$doc.click(function(){focus(editor);});updateFrame(editor);if(ie||iege11){$doc.bind("beforedeactivate beforeactivate selectionchange keypress",function(e){if(e.type==="beforedeactivate")
editor.inactive=true;else if(e.type==="beforeactivate"){if(!editor.inactive&&editor.range&&editor.range.length>1)
editor.range.shift();delete editor.inactive;}
else if(!editor.inactive){if(!editor.range)
editor.range=[];editor.range.unshift(getRange(editor));while(editor.range.length>2)
editor.range.pop();}});$frame.focus(function(){restoreRange(editor);$(editor).triggerHandler(FOCUSED);});$frame.blur(function(){$(editor).triggerHandler(BLURRED);});}
else{$(editor.$frame[0].contentWindow).focus(function(){$(editor).triggerHandler(FOCUSED);}).blur(function(){$(editor).triggerHandler(BLURRED);});}
$doc.click(hidePopups).bind("keyup mouseup",function(){refreshButtons(editor);updateTextArea(editor,true);});if(iOS)editor.$area.show();else $frame.show();$(function(){var $toolbar=editor.$toolbar,$group=$toolbar.children("div:last"),wid=/%/.test(""+options.width)?options.width:$main.width();var hgt=$group.offset().top+$group.outerHeight()-$toolbar.offset().top+1;$toolbar.height(hgt);hgt=(/%/.test(""+options.height)?$main.height():parseInt(options.height,10))-hgt;$frame.width(wid).height(hgt);editor.$area.width(wid).height(ie6?hgt-2:hgt);disable(editor,editor.disabled);refreshButtons(editor);});}
function refreshButtons(editor){if(!iOS&&webkit&&!editor.focused){editor.$frame[0].contentWindow.focus();window.focus();editor.focused=true;}
var queryObj=editor.doc;if(ie)queryObj=getRange(editor);var inSourceMode=sourceMode(editor);$.each(editor.$toolbar.find("."+BUTTON_CLASS),function(idx,elem){var $elem=$(elem),button=$.cleditor.buttons[$.data(elem,BUTTON_NAME)],command=button.command,enabled=true;if(editor.disabled)
enabled=false;else if(button.getEnabled){var data={editor:editor,button:elem,buttonName:button.name,popup:popups[button.popupName],popupName:button.popupName,command:button.command,useCSS:editor.options.useCSS};enabled=button.getEnabled(data);if(enabled===undefined)
enabled=true;}
else if(((inSourceMode||iOS)&&button.name!=="source")||(ie&&(command==="undo"||command==="redo")))
enabled=false;else if(command&&command!=="print"){if(ie&&command==="hilitecolor")
command="backcolor";if(!ie||command!=="inserthtml"){try{enabled=queryObj.queryCommandEnabled(command);}
catch(err){enabled=false;}}}
if(enabled){$elem.removeClass(DISABLED_CLASS);$elem.removeAttr(DISABLED);}
else{$elem.addClass(DISABLED_CLASS);$elem.attr(DISABLED,DISABLED);}});}
function restoreRange(editor){if(editor.range){if(ie)
editor.range[0].select();else if(iege11)
getSelection(editor).addRange(editor.range[0]);}}
function select(editor){setTimeout(function(){if(sourceMode(editor))editor.$area.select();else execCommand(editor,"selectall");},0);}
function selectedHTML(editor){restoreRange(editor);var range=getRange(editor);if(ie)
return range.htmlText;var layer=$("<layer>")[0];layer.appendChild(range.cloneContents());var html=layer.innerHTML;layer=null;return html;}
function selectedText(editor){restoreRange(editor);if(ie)return getRange(editor).text;return getSelection(editor).toString();}
function showMessage(editor,message,button){var popup=createPopup("msg",editor.options,MSG_CLASS);popup.innerHTML=message;showPopup(editor,popup,button);}
function showPopup(editor,popup,button){var offset,left,top,$popup=$(popup);if(button){var $button=$(button);offset=$button.offset();left=--offset.left;top=offset.top+$button.height();}
else{var $toolbar=editor.$toolbar;offset=$toolbar.offset();left=Math.floor(($toolbar.width()-$popup.width())/2)+offset.left;top=offset.top+$toolbar.height()-2;}
hidePopups();$popup.css({left:left,top:top}).show();if(button){$.data(popup,BUTTON,button);$popup.bind(CLICK,{popup:popup},$.proxy(popupClick,editor));}
setTimeout(function(){$popup.find(":text,textarea").eq(0).focus().select();},100);}
function sourceMode(editor){return editor.$area.is(":visible");}
function updateFrame(editor,checkForChange){var code=editor.$area.val(),options=editor.options,updateFrameCallback=options.updateFrame,$body=$(editor.doc.body);if(updateFrameCallback){var sum=checksum(code);if(checkForChange&&editor.areaChecksum===sum)
return;editor.areaChecksum=sum;}
var html=updateFrameCallback?updateFrameCallback(code):code;html=html.replace(/<(?=\/?script)/ig,"&lt;");if(options.updateTextArea)
editor.frameChecksum=checksum(html);if(html!==$body.html()){$body.html(html);$(editor).triggerHandler(CHANGE);}}
function updateTextArea(editor,checkForChange){var html=$(editor.doc.body).html(),options=editor.options,updateTextAreaCallback=options.updateTextArea,$area=editor.$area;if(updateTextAreaCallback){var sum=checksum(html);if(checkForChange&&editor.frameChecksum===sum)
return;editor.frameChecksum=sum;}
var code=updateTextAreaCallback?updateTextAreaCallback(html):html;if(options.updateFrame)
editor.areaChecksum=checksum(code);if(code!==$area.val()){$area.val(code);$(editor).triggerHandler(CHANGE);}}})(jQuery);;

/* /web/static/lib/jquery.textext/jquery.textext.js defined in bundle 'web.assets_backend' */
;(function($,undefined)
{function TextExt(){};function ItemManager(){};function TextExtPlugin(){};var stringify=(JSON||{}).stringify,slice=Array.prototype.slice,UNDEFINED='undefined',OPT_ITEM_MANAGER='item.manager',OPT_PLUGINS='plugins',OPT_EXT='ext',OPT_HTML_WRAP='html.wrap',OPT_HTML_HIDDEN='html.hidden',OPT_KEYS='keys',EVENT_PRE_INVALIDATE='preInvalidate',EVENT_POST_INVALIDATE='postInvalidate',EVENT_GET_FORM_DATA='getFormData',EVENT_SET_FORM_DATA='setFormData',EVENT_SET_INPUT_DATA='setInputData',EVENT_POST_INIT='postInit',EVENT_READY='ready',DEFAULT_OPTS={itemManager:ItemManager,plugins:[],ext:{},html:{wrap:'<div class="text-core"><div class="text-wrap"/></div>',hidden:'<input type="hidden" />'},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter'}};if(!stringify)
throw new Error('JSON.stringify() not found');function getProperty(source,name)
{if(typeof(name)==='string')
name=name.split('.');var fullCamelCaseName=name.join('.').replace(/\.(\w)/g,function(match,letter){return letter.toUpperCase()}),nestedName=name.shift(),result;if(typeof(result=source[fullCamelCaseName])!=UNDEFINED)
result=result;else if(typeof(result=source[nestedName])!=UNDEFINED&&name.length>0)
result=getProperty(result,name);return result;};function hookupEvents()
{var args=slice.apply(arguments),self=this,target=args.length===1?self:args.shift(),event;args=args[0]||{};function bind(event,handler)
{target.bind(event,function()
{return handler.apply(self,arguments);});}
for(event in args)
bind(event,args[event]);};function formDataObject(input,form)
{return{'input':input,'form':form};};p=ItemManager.prototype;p.init=function(core)
{};p.filter=function(list,query)
{var result=[],i,item;for(i=0;i<list.length;i++)
{item=list[i];if(this.itemContains(item,query))
result.push(item);}
return result;};p.itemContains=function(item,needle)
{return this.itemToString(item).toLowerCase().indexOf(needle.toLowerCase())==0;};p.stringToItem=function(str)
{return str;};p.itemToString=function(item)
{return item;};p.compareItems=function(item1,item2)
{return item1==item2;};p=TextExt.prototype;p.init=function(input,opts)
{var self=this,hiddenInput,itemManager,container;self._defaults=$.extend({},DEFAULT_OPTS);self._opts=opts||{};self._plugins={};self._itemManager=itemManager=new(self.opts(OPT_ITEM_MANAGER))();input=$(input);container=$(self.opts(OPT_HTML_WRAP));hiddenInput=$(self.opts(OPT_HTML_HIDDEN));input.wrap(container).keydown(function(e){return self.onKeyDown(e)}).keyup(function(e){return self.onKeyUp(e)}).data('textext',self);$(self).data({'hiddenInput':hiddenInput,'wrapElement':input.parents('.text-wrap').first(),'input':input});hiddenInput.attr('name',input.attr('name'));input.attr('name',null);hiddenInput.insertAfter(input);$.extend(true,itemManager,self.opts(OPT_EXT+'.item.manager'));$.extend(true,self,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.core'));self.originalWidth=input.outerWidth();self.invalidateBounds();itemManager.init(self);self.initPatches();self.initPlugins(self.opts(OPT_PLUGINS),$.fn.textext.plugins);self.on({setFormData:self.onSetFormData,getFormData:self.onGetFormData,setInputData:self.onSetInputData,anyKeyUp:self.onAnyKeyUp});self.trigger(EVENT_POST_INIT);self.trigger(EVENT_READY);self.getFormData(0);};p.initPatches=function()
{var list=[],source=$.fn.textext.patches,name;for(name in source)
list.push(name);this.initPlugins(list,source);};p.initPlugins=function(plugins,source)
{var self=this,ext,name,plugin,initList=[],i;if(typeof(plugins)=='string')
plugins=plugins.split(/\s*,\s*|\s+/g);for(i=0;i<plugins.length;i++)
{name=plugins[i];plugin=source[name];if(plugin)
{self._plugins[name]=plugin=new plugin();self[name]=(function(plugin){return function(){return plugin;}})(plugin);initList.push(plugin);$.extend(true,plugin,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.'+name));}}
initList.sort(function(p1,p2)
{p1=p1.initPriority();p2=p2.initPriority();return p1===p2?0:p1<p2?1:-1;});for(i=0;i<initList.length;i++)
initList[i].init(self);};p.hasPlugin=function(name)
{return!!this._plugins[name];};p.on=hookupEvents;p.bind=function(event,handler)
{this.input().bind(event,handler);};p.trigger=function()
{var args=arguments;this.input().trigger(args[0],slice.call(args,1));};p.itemManager=function()
{return this._itemManager;};p.input=function()
{return $(this).data('input');};p.opts=function(name)
{var result=getProperty(this._opts,name);return typeof(result)=='undefined'?getProperty(this._defaults,name):result;};p.wrapElement=function()
{return $(this).data('wrapElement');};p.invalidateBounds=function()
{var self=this,input=self.input(),wrap=self.wrapElement(),container=wrap.parent(),width=self.originalWidth,height;self.trigger(EVENT_PRE_INVALIDATE);height=input.outerHeight();input.width(width);wrap.width(width).height(height);container.height(height);self.trigger(EVENT_POST_INVALIDATE);};p.focusInput=function()
{this.input()[0].focus();};p.serializeData=stringify;p.hiddenInput=function(value)
{return $(this).data('hiddenInput');};p.getWeightedEventResponse=function(event,args)
{var self=this,data={},maxWeight=0;self.trigger(event,data,args);for(var weight in data)
maxWeight=Math.max(maxWeight,weight);return data[maxWeight];};p.getFormData=function(keyCode)
{var self=this,data=self.getWeightedEventResponse(EVENT_GET_FORM_DATA,keyCode||0);self.trigger(EVENT_SET_FORM_DATA,data['form']);self.trigger(EVENT_SET_INPUT_DATA,data['input']);};p.onAnyKeyUp=function(e,keyCode)
{this.getFormData(keyCode);};p.onSetInputData=function(e,data)
{this.input().val(data);};p.onSetFormData=function(e,data)
{var self=this;self.hiddenInput().val(self.serializeData(data));};p.onGetFormData=function(e,data)
{var val=this.input().val();data[0]=formDataObject(val,val);};$(['Down','Up']).each(function()
{var type=this.toString();p['onKey'+type]=function(e)
{var self=this,keyName=self.opts(OPT_KEYS)[e.keyCode],defaultResult=true;if(keyName)
{defaultResult=keyName.substr(-1)!='!';keyName=keyName.replace('!','');self.trigger(keyName+'Key'+type);if(type=='Up'&&self._lastKeyDown==e.keyCode)
{self._lastKeyDown=null;self.trigger(keyName+'KeyPress');}
if(type=='Down')
self._lastKeyDown=e.keyCode;}
self.trigger('anyKey'+type,e.keyCode);return defaultResult;};});p=TextExtPlugin.prototype;p.on=hookupEvents;p.formDataObject=formDataObject;p.init=function(core){throw new Error('Not implemented')};p.baseInit=function(core,defaults)
{var self=this;core._defaults=$.extend(true,core._defaults,defaults);self._core=core;self._timers={};};p.startTimer=function(name,delay,callback)
{var self=this;self.stopTimer(name);self._timers[name]=setTimeout(function()
{delete self._timers[name];callback.apply(self);},delay*1000);};p.stopTimer=function(name)
{clearTimeout(this._timers[name]);};p.core=function()
{return this._core;};p.opts=function(name)
{return this.core().opts(name);};p.itemManager=function()
{return this.core().itemManager();};p.input=function()
{return this.core().input();};p.val=function(value)
{var input=this.input();if(typeof(value)===UNDEFINED)
return input.val();else
input.val(value);};p.trigger=function()
{var core=this.core();core.trigger.apply(core,arguments);};p.bind=function(event,handler)
{this.core().bind(event,handler);};p.initPriority=function()
{return 0;};var cssInjected=false;var textext=$.fn.textext=function(opts)
{var css;if(!cssInjected&&(css=$.fn.textext.css)!=null)
{$('head').append('<style>'+css+'</style>');cssInjected=true;}
return this.map(function()
{var self=$(this);if(opts==null)
return self.data('textext');var instance=new TextExt();instance.init(self,opts);self.data('textext',instance);return instance.input()[0];});};textext.addPlugin=function(name,constructor)
{textext.plugins[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.addPatch=function(name,constructor)
{textext.patches[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.TextExt=TextExt;textext.TextExtPlugin=TextExtPlugin;textext.ItemManager=ItemManager;textext.plugins={};textext.patches={};})(jQuery);(function($)
{function TextExtIE9Patches(){};$.fn.textext.TextExtIE9Patches=TextExtIE9Patches;$.fn.textext.addPatch('ie9',TextExtIE9Patches);var p=TextExtIE9Patches.prototype;p.init=function(core)
{if(navigator.userAgent.indexOf('MSIE 9')==-1)
return;var self=this;core.on({postInvalidate:self.onPostInvalidate});};p.onPostInvalidate=function()
{var self=this,input=self.input(),val=input.val();input.val(Math.random());input.val(val);};})(jQuery);;(function($)
{function TextExtAjax(){};$.fn.textext.TextExtAjax=TextExtAjax;$.fn.textext.addPlugin('ajax',TextExtAjax);var p=TextExtAjax.prototype,OPT_DATA_CALLBACK='ajax.data.callback',OPT_CACHE_RESULTS='ajax.cache.results',OPT_LOADING_DELAY='ajax.loading.delay',OPT_LOADING_MESSAGE='ajax.loading.message',OPT_TYPE_DELAY='ajax.type.delay',EVENT_SET_SUGGESTION='setSuggestions',EVENT_SHOW_DROPDOWN='showDropdown',TIMER_LOADING='loading',DEFAULT_OPTS={ajax:{typeDelay:0.5,loadingMessage:'Loading...',loadingDelay:0.5,cacheResults:false,dataCallback:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions});self._suggestions=null;};p.load=function(query)
{var self=this,dataCallback=self.opts(OPT_DATA_CALLBACK)||function(query){return{q:query}},opts;opts=$.extend(true,{data:dataCallback(query),success:function(data){self.onComplete(data,query)},error:function(jqXHR,message){console.error(message,query)}},self.opts('ajax'));$.ajax(opts);};p.onComplete=function(data,query)
{var self=this,result=data;self.dontShowLoading();if(self.opts(OPT_CACHE_RESULTS)==true)
{self._suggestions=data;result=self.itemManager().filter(data,query);}
self.trigger(EVENT_SET_SUGGESTION,{result:result});};p.dontShowLoading=function()
{this.stopTimer(TIMER_LOADING);};p.showLoading=function()
{var self=this;self.dontShowLoading();self.startTimer(TIMER_LOADING,self.opts(OPT_LOADING_DELAY),function()
{self.trigger(EVENT_SHOW_DROPDOWN,function(autocomplete)
{autocomplete.clearItems();var node=autocomplete.addDropdownItem(self.opts(OPT_LOADING_MESSAGE));node.addClass('text-loading');});});};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions,query=(data||{}).query||'';if(suggestions&&self.opts(OPT_CACHE_RESULTS)===true)
return self.onComplete(suggestions,query);self.startTimer('ajax',self.opts(OPT_TYPE_DELAY),function()
{self.showLoading();self.load(query);});};})(jQuery);;(function($)
{function TextExtArrow(){};$.fn.textext.TextExtArrow=TextExtArrow;$.fn.textext.addPlugin('arrow',TextExtArrow);var p=TextExtArrow.prototype,OPT_HTML_ARROW='html.arrow',DEFAULT_OPTS={html:{arrow:'<div class="text-arrow"/>'}};p.init=function(core)
{var self=this,arrow;self.baseInit(core,DEFAULT_OPTS);self._arrow=arrow=$(self.opts(OPT_HTML_ARROW));self.core().wrapElement().append(arrow);arrow.bind('click',function(e){self.onArrowClick(e);});};p.onArrowClick=function(e)
{this.trigger('toggleDropdown');this.core().focusInput();};})(jQuery);;(function($)
{function TextExtAutocomplete(){};$.fn.textext.TextExtAutocomplete=TextExtAutocomplete;$.fn.textext.addPlugin('autocomplete',TextExtAutocomplete);var p=TextExtAutocomplete.prototype,CSS_DOT='.',CSS_SELECTED='text-selected',CSS_DOT_SELECTED=CSS_DOT+CSS_SELECTED,CSS_SUGGESTION='text-suggestion',CSS_DOT_SUGGESTION=CSS_DOT+CSS_SUGGESTION,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,OPT_ENABLED='autocomplete.enabled',OPT_POSITION='autocomplete.dropdown.position',OPT_MAX_HEIGHT='autocomplete.dropdown.maxHeight',OPT_RENDER='autocomplete.render',OPT_HTML_DROPDOWN='html.dropdown',OPT_HTML_SUGGESTION='html.suggestion',EVENT_HIDE_DROPDOWN='hideDropdown',EVENT_SHOW_DROPDOWN='showDropdown',EVENT_GET_SUGGESTIONS='getSuggestions',EVENT_GET_FORM_DATA='getFormData',EVENT_TOGGLE_DROPDOWN='toggleDropdown',POSITION_ABOVE='above',POSITION_BELOW='below',DATA_MOUSEDOWN_ON_AUTOCOMPLETE='mousedownOnAutocomplete',DEFAULT_OPTS={autocomplete:{enabled:true,dropdown:{position:POSITION_BELOW,maxHeight:'100px'}},html:{dropdown:'<div class="text-dropdown"><div class="text-list"/></div>',suggestion:'<div class="text-suggestion"><span class="text-label"/></div>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);var input=self.input(),container;if(self.opts(OPT_ENABLED)===true)
{self.on({blur:self.onBlur,anyKeyUp:self.onAnyKeyUp,deleteKeyUp:self.onAnyKeyUp,backspaceKeyPress:self.onBackspaceKeyPress,enterKeyPress:self.onEnterKeyPress,escapeKeyPress:self.onEscapeKeyPress,setSuggestions:self.onSetSuggestions,showDropdown:self.onShowDropdown,hideDropdown:self.onHideDropdown,toggleDropdown:self.onToggleDropdown,postInvalidate:self.positionDropdown,getFormData:self.onGetFormData,downKeyDown:self.onDownKeyDown,upKeyDown:self.onUpKeyDown});container=$(self.opts(OPT_HTML_DROPDOWN));container.insertAfter(input);self.on(container,{mouseover:self.onMouseOver,mousedown:self.onMouseDown,click:self.onClick});container.css('maxHeight',self.opts(OPT_MAX_HEIGHT)).addClass('text-position-'+self.opts(OPT_POSITION));$(self).data('container',container);$(document.body).click(function(e)
{if(self.isDropdownVisible()&&!self.withinWrapElement(e.target))
self.trigger(EVENT_HIDE_DROPDOWN);});self.positionDropdown();}};p.containerElement=function()
{return $(this).data('container');};p.onMouseOver=function(e)
{var self=this,target=$(e.target);if(target.is(CSS_DOT_SUGGESTION))
{self.clearSelected();target.addClass(CSS_SELECTED);}};p.onMouseDown=function(e)
{this.containerElement().data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE,true);};p.onClick=function(e)
{var self=this,target=$(e.target);if($(CSS_DOT_SUGGESTION).has(target[0])||$(CSS_DOT_LABEL).has(target[0]))
self.trigger('enterKeyPress');if(self.core().hasPlugin('tags'))
self.val('');};p.onBlur=function(e)
{var self=this,container=self.containerElement(),isBlurByMousedown=container.data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE)===true;if(self.isDropdownVisible())
isBlurByMousedown?self.core().focusInput():self.trigger(EVENT_HIDE_DROPDOWN);container.removeData(DATA_MOUSEDOWN_ON_AUTOCOMPLETE);};p.onBackspaceKeyPress=function(e)
{var self=this,isEmpty=self.val().length>0;if(isEmpty||self.isDropdownVisible())
self.getSuggestions();};p.onAnyKeyUp=function(e,keyCode)
{var self=this,isFunctionKey=self.opts('keys.'+keyCode)!=null;if(self.val().length>0&&!isFunctionKey)
self.getSuggestions();};p.onDownKeyDown=function(e)
{var self=this;self.isDropdownVisible()?self.toggleNextSuggestion():self.getSuggestions();};p.onUpKeyDown=function(e)
{this.togglePreviousSuggestion();};p.onEnterKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.selectFromDropdown();};p.onEscapeKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.trigger(EVENT_HIDE_DROPDOWN);};p.positionDropdown=function()
{var self=this,container=self.containerElement(),direction=self.opts(OPT_POSITION),height=self.core().wrapElement().outerHeight(),css={};css[direction===POSITION_ABOVE?'bottom':'top']=height+'px';container.css(css);};p.suggestionElements=function()
{return this.containerElement().find(CSS_DOT_SUGGESTION);};p.setSelectedSuggestion=function(suggestion)
{if(!suggestion)
return;var self=this,all=self.suggestionElements(),target=all.first(),item,i;self.clearSelected();for(i=0;i<all.length;i++)
{item=$(all[i]);if(self.itemManager().compareItems(item.data(CSS_SUGGESTION),suggestion))
{target=item.addClass(CSS_SELECTED);break;}}
target.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(target);};p.selectedSuggestionElement=function()
{return this.suggestionElements().filter(CSS_DOT_SELECTED).first();};p.isDropdownVisible=function()
{return this.containerElement().is(':visible')===true;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue=val;data[100]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 200;};p.onHideDropdown=function(e)
{this.hideDropdown();};p.onToggleDropdown=function(e)
{var self=this;self.trigger(self.containerElement().is(':visible')?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.onShowDropdown=function(e,renderCallback)
{var self=this,current=self.selectedSuggestionElement().data(CSS_SUGGESTION),suggestions=self._suggestions;if(!suggestions)
return self.trigger(EVENT_GET_SUGGESTIONS);if($.isFunction(renderCallback))
{renderCallback(self);}
else
{self.renderSuggestions(self._suggestions);self.toggleNextSuggestion();}
self.showDropdown(self.containerElement());self.setSelectedSuggestion(current);};p.onSetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions=data.result;if(data.showHideDropdown!==false)
self.trigger(suggestions===null||suggestions.length===0?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.getSuggestions=function()
{var self=this,val=self.val();if(self._previousInputValue==val)
return;if(val=='')
current=null;self._previousInputValue=val;self.trigger(EVENT_GET_SUGGESTIONS,{query:val});};p.clearItems=function()
{this.containerElement().find('.text-list').children().remove();};p.renderSuggestions=function(suggestions)
{var self=this;self.clearItems();$.each(suggestions||[],function(index,item)
{self.addSuggestion(item);});};p.showDropdown=function()
{this.containerElement().show();};p.hideDropdown=function()
{var self=this,dropdown=self.containerElement();self._previousInputValue=null;dropdown.hide();};p.addSuggestion=function(suggestion)
{var self=this,renderer=self.opts(OPT_RENDER),node=self.addDropdownItem(renderer?renderer.call(self,suggestion):self.itemManager().itemToString(suggestion));node.data(CSS_SUGGESTION,suggestion);};p.addDropdownItem=function(html)
{var self=this,container=self.containerElement().find('.text-list'),node=$(self.opts(OPT_HTML_SUGGESTION));node.find('.text-label').html(html);container.append(node);return node;};p.clearSelected=function()
{this.suggestionElements().removeClass(CSS_SELECTED);};p.toggleNextSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),next;if(selected.length>0)
{next=selected.next();if(next.length>0)
selected.removeClass(CSS_SELECTED);}
else
{next=self.suggestionElements().first();}
next.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(next);};p.togglePreviousSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),prev=selected.prev();if(prev.length==0)
return;self.clearSelected();prev.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(prev);};p.scrollSuggestionIntoView=function(item)
{var itemHeight=item.outerHeight(),dropdown=this.containerElement(),dropdownHeight=dropdown.innerHeight(),scrollPos=dropdown.scrollTop(),itemTop=(item.position()||{}).top,scrollTo=null,paddingTop=parseInt(dropdown.css('paddingTop'));if(itemTop==null)
return;if(itemTop+itemHeight>dropdownHeight)
scrollTo=itemTop+scrollPos+itemHeight-dropdownHeight+paddingTop;if(itemTop<0)
scrollTo=itemTop+scrollPos-paddingTop;if(scrollTo!=null)
dropdown.scrollTop(scrollTo);};p.selectFromDropdown=function()
{var self=this,suggestion=self.selectedSuggestionElement().data(CSS_SUGGESTION);if(suggestion)
{self.val(self.itemManager().itemToString(suggestion));self.core().getFormData();}
self.trigger(EVENT_HIDE_DROPDOWN);};p.withinWrapElement=function(element)
{return this.core().wrapElement().find(element).size()>0;}})(jQuery);;(function($)
{function TextExtFilter(){};$.fn.textext.TextExtFilter=TextExtFilter;$.fn.textext.addPlugin('filter',TextExtFilter);var p=TextExtFilter.prototype,OPT_ENABLED='filter.enabled',OPT_ITEMS='filter.items',DEFAULT_OPTS={filter:{enabled:true,items:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getFormData:self.onGetFormData,isTagAllowed:self.onIsTagAllowed,setSuggestions:self.onSetSuggestions});self._suggestions=null;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue='';if(!self.core().hasPlugin('tags'))
{if(self.isValueAllowed(inputValue))
formValue=val;data[300]=self.formDataObject(inputValue,formValue);}};p.isValueAllowed=function(value)
{var self=this,list=self.opts('filterItems')||self._suggestions||[],itemManager=self.itemManager(),result=!self.opts(OPT_ENABLED),i;for(i=0;i<list.length&&!result;i++)
if(itemManager.compareItems(value,list[i]))
result=true;return result;};p.onIsTagAllowed=function(e,data)
{data.result=this.isValueAllowed(data.tag);};p.onSetSuggestions=function(e,data)
{this._suggestions=data.result;};})(jQuery);;(function($)
{function TextExtFocus(){};$.fn.textext.TextExtFocus=TextExtFocus;$.fn.textext.addPlugin('focus',TextExtFocus);var p=TextExtFocus.prototype,OPT_HTML_FOCUS='html.focus',DEFAULT_OPTS={html:{focus:'<div class="text-focus"/>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.core().wrapElement().append(self.opts(OPT_HTML_FOCUS));self.on({blur:self.onBlur,focus:self.onFocus});self._timeoutId=0;};p.onBlur=function(e)
{var self=this;clearTimeout(self._timeoutId);self._timeoutId=setTimeout(function()
{self.getFocus().hide();},100);};p.onFocus=function(e)
{var self=this;clearTimeout(self._timeoutId);self.getFocus().show();};p.getFocus=function()
{return this.core().wrapElement().find('.text-focus');};})(jQuery);;(function($)
{function TextExtPrompt(){};$.fn.textext.TextExtPrompt=TextExtPrompt;$.fn.textext.addPlugin('prompt',TextExtPrompt);var p=TextExtPrompt.prototype,CSS_HIDE_PROMPT='text-hide-prompt',OPT_PROMPT='prompt',OPT_HTML_PROMPT='html.prompt',DEFAULT_OPTS={prompt:'Awaiting input...',html:{prompt:'<div class="text-prompt"/>'}};p.init=function(core)
{var self=this,placeholderKey='placeholder',container,prompt;self.baseInit(core,DEFAULT_OPTS);container=$(self.opts(OPT_HTML_PROMPT));$(self).data('container',container);self.core().wrapElement().append(container);self.setPrompt(self.opts(OPT_PROMPT));prompt=core.input().attr(placeholderKey);if(!prompt)
prompt=self.opts(OPT_PROMPT);core.input().attr(placeholderKey,'');if(prompt)
self.setPrompt(prompt);if($.trim(self.val()).length>0)
self.hidePrompt();self.on({blur:self.onBlur,focus:self.onFocus,postInvalidate:self.onPostInvalidate,postInit:self.onPostInit});};p.onPostInit=function(e)
{this.invalidateBounds();};p.onPostInvalidate=function(e)
{this.invalidateBounds();};p.invalidateBounds=function()
{var self=this,input=self.input();self.containerElement().css({paddingLeft:input.css('paddingLeft'),paddingTop:input.css('paddingTop')});};p.onBlur=function(e)
{var self=this;self.startTimer('prompt',0.1,function()
{self.showPrompt();});};p.showPrompt=function()
{var self=this,input=self.input();if($.trim(self.val()).length===0&&!input.is(':focus'))
self.containerElement().removeClass(CSS_HIDE_PROMPT);};p.hidePrompt=function()
{this.stopTimer('prompt');this.containerElement().addClass(CSS_HIDE_PROMPT);};p.onFocus=function(e)
{this.hidePrompt();};p.setPrompt=function(str)
{this.containerElement().text(str);};p.containerElement=function()
{return $(this).data('container');};})(jQuery);;(function($)
{function TextExtSuggestions(){};$.fn.textext.TextExtSuggestions=TextExtSuggestions;$.fn.textext.addPlugin('suggestions',TextExtSuggestions);var p=TextExtSuggestions.prototype,OPT_SUGGESTIONS='suggestions',DEFAULT_OPTS={suggestions:null};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions,postInit:self.onPostInit});};p.setSuggestions=function(suggestions,showHideDropdown)
{this.trigger('setSuggestions',{result:suggestions,showHideDropdown:showHideDropdown!=false});};p.onPostInit=function(e)
{var self=this;self.setSuggestions(self.opts(OPT_SUGGESTIONS),false);};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self.opts(OPT_SUGGESTIONS);suggestions.sort();self.setSuggestions(self.itemManager().filter(suggestions,data.query));};})(jQuery);;(function($)
{function TextExtTags(){};$.fn.textext.TextExtTags=TextExtTags;$.fn.textext.addPlugin('tags',TextExtTags);var p=TextExtTags.prototype,CSS_DOT='.',CSS_TAGS_ON_TOP='text-tags-on-top',CSS_DOT_TAGS_ON_TOP=CSS_DOT+CSS_TAGS_ON_TOP,CSS_TAG='text-tag',CSS_DOT_TAG=CSS_DOT+CSS_TAG,CSS_TAGS='text-tags',CSS_DOT_TAGS=CSS_DOT+CSS_TAGS,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,CSS_REMOVE='text-remove',CSS_DOT_REMOVE=CSS_DOT+CSS_REMOVE,OPT_ENABLED='tags.enabled',OPT_ITEMS='tags.items',OPT_HTML_TAG='html.tag',OPT_HTML_TAGS='html.tags',EVENT_IS_TAG_ALLOWED='isTagAllowed',EVENT_TAG_CLICK='tagClick',DEFAULT_OPTS={tags:{enabled:true,items:null},html:{tags:'<div class="text-tags"/>',tag:'<div class="text-tag"><div class="text-button"><span class="text-label"/><a class="text-remove"/></div></div>'}};p.init=function(core)
{this.baseInit(core,DEFAULT_OPTS);var self=this,input=self.input(),container;if(self.opts(OPT_ENABLED))
{container=$(self.opts(OPT_HTML_TAGS));input.after(container);$(self).data('container',container);self.on({enterKeyPress:self.onEnterKeyPress,backspaceKeyDown:self.onBackspaceKeyDown,preInvalidate:self.onPreInvalidate,postInit:self.onPostInit,getFormData:self.onGetFormData});self.on(container,{click:self.onClick,mousemove:self.onContainerMouseMove});self.on(input,{mousemove:self.onInputMouseMove});}
self._originalPadding={left:parseInt(input.css('paddingLeft')||0),top:parseInt(input.css('paddingTop')||0)};self._paddingBox={left:0,top:0};self.updateFormCache();};p.containerElement=function()
{return $(this).data('container');};p.onPostInit=function(e)
{var self=this;self.addTags(self.opts(OPT_ITEMS));};p.onGetFormData=function(e,data,keyCode)
{var self=this,inputValue=keyCode===13?'':self.val(),formValue=self._formData;data[200]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 100;};p.onInputMouseMove=function(e)
{this.toggleZIndex(e);};p.onContainerMouseMove=function(e)
{this.toggleZIndex(e);};p.onBackspaceKeyDown=function(e)
{var self=this,lastTag=self.tagElements().last();if(self.val().length==0)
self.removeTag(lastTag);};p.onPreInvalidate=function(e)
{var self=this,lastTag=self.tagElements().last(),pos=lastTag.position();if(lastTag.length>0)
pos.left+=lastTag.innerWidth();else
pos=self._originalPadding;self._paddingBox=pos;self.input().css({paddingLeft:pos.left,paddingTop:pos.top});};p.onClick=function(e)
{var self=this,core=self.core(),source=$(e.target),focus=0,tag;if(source.is(CSS_DOT_TAGS))
{focus=1;}
else if(source.is(CSS_DOT_REMOVE))
{self.removeTag(source.parents(CSS_DOT_TAG+':first'));focus=1;}
else if(source.is(CSS_DOT_LABEL))
{tag=source.parents(CSS_DOT_TAG+':first');self.trigger(EVENT_TAG_CLICK,tag,tag.data(CSS_TAG),tagClickCallback);}
function tagClickCallback(newValue,refocus)
{tag.data(CSS_TAG,newValue);tag.find(CSS_DOT_LABEL).text(self.itemManager().itemToString(newValue));self.updateFormCache();core.getFormData();core.invalidateBounds();if(refocus)
core.focusInput();}
if(focus)
core.focusInput();};p.onEnterKeyPress=function(e)
{var self=this,val=self.val(),tag=self.itemManager().stringToItem(val);if(self.isTagAllowed(tag))
{self.addTags([tag]);self.core().focusInput();}};p.updateFormCache=function()
{var self=this,result=[];self.tagElements().each(function()
{result.push($(this).data(CSS_TAG));});self._formData=result;};p.toggleZIndex=function(e)
{var self=this,offset=self.input().offset(),mouseX=e.clientX-offset.left,mouseY=e.clientY-offset.top,box=self._paddingBox,container=self.containerElement(),isOnTop=container.is(CSS_DOT_TAGS_ON_TOP),isMouseOverText=mouseX>box.left&&mouseY>box.top;if(!isOnTop&&!isMouseOverText||isOnTop&&isMouseOverText)
container[(!isOnTop?'add':'remove')+'Class'](CSS_TAGS_ON_TOP);};p.tagElements=function()
{return this.containerElement().find(CSS_DOT_TAG);};p.isTagAllowed=function(tag)
{var opts={tag:tag,result:true};this.trigger(EVENT_IS_TAG_ALLOWED,opts);return opts.result===true;};p.addTags=function(tags)
{if(!tags||tags.length==0)
return;var self=this,core=self.core(),container=self.containerElement(),i,tag;for(i=0;i<tags.length;i++)
{tag=tags[i];if(tag&&self.isTagAllowed(tag))
container.append(self.renderTag(tag));}
self.updateFormCache();core.getFormData();core.invalidateBounds();};p.getTagElement=function(tag)
{var self=this,list=self.tagElements(),i,item;for(i=0;i<list.length,item=$(list[i]);i++)
if(self.itemManager().compareItems(item.data(CSS_TAG),tag))
return item;};p.removeTag=function(tag)
{var self=this,core=self.core(),element;if(tag instanceof $)
{element=tag;tag=tag.data(CSS_TAG);}
else
{element=self.getTagElement(tag);}
element.remove();self.updateFormCache();core.getFormData();core.invalidateBounds();};p.renderTag=function(tag)
{var self=this,node=$(self.opts(OPT_HTML_TAG));node.find('.text-label').text(self.itemManager().itemToString(tag));node.data(CSS_TAG,tag);return node;};})(jQuery);;

/* /web/static/lib/select2/select2.js defined in bundle 'web.assets_backend' */
(function($){if(typeof $.fn.each2=="undefined"){$.extend($.fn,{each2:function(c){var j=$([0]),i=-1,l=this.length;while(++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==false);return this;}});}})(jQuery);(function($,undefined){"use strict";if(window.Select2!==undefined){return;}
var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,lastMousePosition={x:0,y:0},$document,scrollBarDimensions,KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){k=k.which?k.which:k;switch(k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return true;}
return false;},isControl:function(e){var k=e.which;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return true;}
if(e.metaKey)return true;return false;},isFunctionKey:function(k){k=k.which?k.which:k;return k>=112&&k<=123;}},MEASURE_SCROLLBAR_TEMPLATE="<div class='select2-measure-scrollbar'></div>",DIACRITICS={"\u24B6":"A","\uFF21":"A","\u00C0":"A","\u00C1":"A","\u00C2":"A","\u1EA6":"A","\u1EA4":"A","\u1EAA":"A","\u1EA8":"A","\u00C3":"A","\u0100":"A","\u0102":"A","\u1EB0":"A","\u1EAE":"A","\u1EB4":"A","\u1EB2":"A","\u0226":"A","\u01E0":"A","\u00C4":"A","\u01DE":"A","\u1EA2":"A","\u00C5":"A","\u01FA":"A","\u01CD":"A","\u0200":"A","\u0202":"A","\u1EA0":"A","\u1EAC":"A","\u1EB6":"A","\u1E00":"A","\u0104":"A","\u023A":"A","\u2C6F":"A","\uA732":"AA","\u00C6":"AE","\u01FC":"AE","\u01E2":"AE","\uA734":"AO","\uA736":"AU","\uA738":"AV","\uA73A":"AV","\uA73C":"AY","\u24B7":"B","\uFF22":"B","\u1E02":"B","\u1E04":"B","\u1E06":"B","\u0243":"B","\u0182":"B","\u0181":"B","\u24B8":"C","\uFF23":"C","\u0106":"C","\u0108":"C","\u010A":"C","\u010C":"C","\u00C7":"C","\u1E08":"C","\u0187":"C","\u023B":"C","\uA73E":"C","\u24B9":"D","\uFF24":"D","\u1E0A":"D","\u010E":"D","\u1E0C":"D","\u1E10":"D","\u1E12":"D","\u1E0E":"D","\u0110":"D","\u018B":"D","\u018A":"D","\u0189":"D","\uA779":"D","\u01F1":"DZ","\u01C4":"DZ","\u01F2":"Dz","\u01C5":"Dz","\u24BA":"E","\uFF25":"E","\u00C8":"E","\u00C9":"E","\u00CA":"E","\u1EC0":"E","\u1EBE":"E","\u1EC4":"E","\u1EC2":"E","\u1EBC":"E","\u0112":"E","\u1E14":"E","\u1E16":"E","\u0114":"E","\u0116":"E","\u00CB":"E","\u1EBA":"E","\u011A":"E","\u0204":"E","\u0206":"E","\u1EB8":"E","\u1EC6":"E","\u0228":"E","\u1E1C":"E","\u0118":"E","\u1E18":"E","\u1E1A":"E","\u0190":"E","\u018E":"E","\u24BB":"F","\uFF26":"F","\u1E1E":"F","\u0191":"F","\uA77B":"F","\u24BC":"G","\uFF27":"G","\u01F4":"G","\u011C":"G","\u1E20":"G","\u011E":"G","\u0120":"G","\u01E6":"G","\u0122":"G","\u01E4":"G","\u0193":"G","\uA7A0":"G","\uA77D":"G","\uA77E":"G","\u24BD":"H","\uFF28":"H","\u0124":"H","\u1E22":"H","\u1E26":"H","\u021E":"H","\u1E24":"H","\u1E28":"H","\u1E2A":"H","\u0126":"H","\u2C67":"H","\u2C75":"H","\uA78D":"H","\u24BE":"I","\uFF29":"I","\u00CC":"I","\u00CD":"I","\u00CE":"I","\u0128":"I","\u012A":"I","\u012C":"I","\u0130":"I","\u00CF":"I","\u1E2E":"I","\u1EC8":"I","\u01CF":"I","\u0208":"I","\u020A":"I","\u1ECA":"I","\u012E":"I","\u1E2C":"I","\u0197":"I","\u24BF":"J","\uFF2A":"J","\u0134":"J","\u0248":"J","\u24C0":"K","\uFF2B":"K","\u1E30":"K","\u01E8":"K","\u1E32":"K","\u0136":"K","\u1E34":"K","\u0198":"K","\u2C69":"K","\uA740":"K","\uA742":"K","\uA744":"K","\uA7A2":"K","\u24C1":"L","\uFF2C":"L","\u013F":"L","\u0139":"L","\u013D":"L","\u1E36":"L","\u1E38":"L","\u013B":"L","\u1E3C":"L","\u1E3A":"L","\u0141":"L","\u023D":"L","\u2C62":"L","\u2C60":"L","\uA748":"L","\uA746":"L","\uA780":"L","\u01C7":"LJ","\u01C8":"Lj","\u24C2":"M","\uFF2D":"M","\u1E3E":"M","\u1E40":"M","\u1E42":"M","\u2C6E":"M","\u019C":"M","\u24C3":"N","\uFF2E":"N","\u01F8":"N","\u0143":"N","\u00D1":"N","\u1E44":"N","\u0147":"N","\u1E46":"N","\u0145":"N","\u1E4A":"N","\u1E48":"N","\u0220":"N","\u019D":"N","\uA790":"N","\uA7A4":"N","\u01CA":"NJ","\u01CB":"Nj","\u24C4":"O","\uFF2F":"O","\u00D2":"O","\u00D3":"O","\u00D4":"O","\u1ED2":"O","\u1ED0":"O","\u1ED6":"O","\u1ED4":"O","\u00D5":"O","\u1E4C":"O","\u022C":"O","\u1E4E":"O","\u014C":"O","\u1E50":"O","\u1E52":"O","\u014E":"O","\u022E":"O","\u0230":"O","\u00D6":"O","\u022A":"O","\u1ECE":"O","\u0150":"O","\u01D1":"O","\u020C":"O","\u020E":"O","\u01A0":"O","\u1EDC":"O","\u1EDA":"O","\u1EE0":"O","\u1EDE":"O","\u1EE2":"O","\u1ECC":"O","\u1ED8":"O","\u01EA":"O","\u01EC":"O","\u00D8":"O","\u01FE":"O","\u0186":"O","\u019F":"O","\uA74A":"O","\uA74C":"O","\u01A2":"OI","\uA74E":"OO","\u0222":"OU","\u24C5":"P","\uFF30":"P","\u1E54":"P","\u1E56":"P","\u01A4":"P","\u2C63":"P","\uA750":"P","\uA752":"P","\uA754":"P","\u24C6":"Q","\uFF31":"Q","\uA756":"Q","\uA758":"Q","\u024A":"Q","\u24C7":"R","\uFF32":"R","\u0154":"R","\u1E58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1E5A":"R","\u1E5C":"R","\u0156":"R","\u1E5E":"R","\u024C":"R","\u2C64":"R","\uA75A":"R","\uA7A6":"R","\uA782":"R","\u24C8":"S","\uFF33":"S","\u1E9E":"S","\u015A":"S","\u1E64":"S","\u015C":"S","\u1E60":"S","\u0160":"S","\u1E66":"S","\u1E62":"S","\u1E68":"S","\u0218":"S","\u015E":"S","\u2C7E":"S","\uA7A8":"S","\uA784":"S","\u24C9":"T","\uFF34":"T","\u1E6A":"T","\u0164":"T","\u1E6C":"T","\u021A":"T","\u0162":"T","\u1E70":"T","\u1E6E":"T","\u0166":"T","\u01AC":"T","\u01AE":"T","\u023E":"T","\uA786":"T","\uA728":"TZ","\u24CA":"U","\uFF35":"U","\u00D9":"U","\u00DA":"U","\u00DB":"U","\u0168":"U","\u1E78":"U","\u016A":"U","\u1E7A":"U","\u016C":"U","\u00DC":"U","\u01DB":"U","\u01D7":"U","\u01D5":"U","\u01D9":"U","\u1EE6":"U","\u016E":"U","\u0170":"U","\u01D3":"U","\u0214":"U","\u0216":"U","\u01AF":"U","\u1EEA":"U","\u1EE8":"U","\u1EEE":"U","\u1EEC":"U","\u1EF0":"U","\u1EE4":"U","\u1E72":"U","\u0172":"U","\u1E76":"U","\u1E74":"U","\u0244":"U","\u24CB":"V","\uFF36":"V","\u1E7C":"V","\u1E7E":"V","\u01B2":"V","\uA75E":"V","\u0245":"V","\uA760":"VY","\u24CC":"W","\uFF37":"W","\u1E80":"W","\u1E82":"W","\u0174":"W","\u1E86":"W","\u1E84":"W","\u1E88":"W","\u2C72":"W","\u24CD":"X","\uFF38":"X","\u1E8A":"X","\u1E8C":"X","\u24CE":"Y","\uFF39":"Y","\u1EF2":"Y","\u00DD":"Y","\u0176":"Y","\u1EF8":"Y","\u0232":"Y","\u1E8E":"Y","\u0178":"Y","\u1EF6":"Y","\u1EF4":"Y","\u01B3":"Y","\u024E":"Y","\u1EFE":"Y","\u24CF":"Z","\uFF3A":"Z","\u0179":"Z","\u1E90":"Z","\u017B":"Z","\u017D":"Z","\u1E92":"Z","\u1E94":"Z","\u01B5":"Z","\u0224":"Z","\u2C7F":"Z","\u2C6B":"Z","\uA762":"Z","\u24D0":"a","\uFF41":"a","\u1E9A":"a","\u00E0":"a","\u00E1":"a","\u00E2":"a","\u1EA7":"a","\u1EA5":"a","\u1EAB":"a","\u1EA9":"a","\u00E3":"a","\u0101":"a","\u0103":"a","\u1EB1":"a","\u1EAF":"a","\u1EB5":"a","\u1EB3":"a","\u0227":"a","\u01E1":"a","\u00E4":"a","\u01DF":"a","\u1EA3":"a","\u00E5":"a","\u01FB":"a","\u01CE":"a","\u0201":"a","\u0203":"a","\u1EA1":"a","\u1EAD":"a","\u1EB7":"a","\u1E01":"a","\u0105":"a","\u2C65":"a","\u0250":"a","\uA733":"aa","\u00E6":"ae","\u01FD":"ae","\u01E3":"ae","\uA735":"ao","\uA737":"au","\uA739":"av","\uA73B":"av","\uA73D":"ay","\u24D1":"b","\uFF42":"b","\u1E03":"b","\u1E05":"b","\u1E07":"b","\u0180":"b","\u0183":"b","\u0253":"b","\u24D2":"c","\uFF43":"c","\u0107":"c","\u0109":"c","\u010B":"c","\u010D":"c","\u00E7":"c","\u1E09":"c","\u0188":"c","\u023C":"c","\uA73F":"c","\u2184":"c","\u24D3":"d","\uFF44":"d","\u1E0B":"d","\u010F":"d","\u1E0D":"d","\u1E11":"d","\u1E13":"d","\u1E0F":"d","\u0111":"d","\u018C":"d","\u0256":"d","\u0257":"d","\uA77A":"d","\u01F3":"dz","\u01C6":"dz","\u24D4":"e","\uFF45":"e","\u00E8":"e","\u00E9":"e","\u00EA":"e","\u1EC1":"e","\u1EBF":"e","\u1EC5":"e","\u1EC3":"e","\u1EBD":"e","\u0113":"e","\u1E15":"e","\u1E17":"e","\u0115":"e","\u0117":"e","\u00EB":"e","\u1EBB":"e","\u011B":"e","\u0205":"e","\u0207":"e","\u1EB9":"e","\u1EC7":"e","\u0229":"e","\u1E1D":"e","\u0119":"e","\u1E19":"e","\u1E1B":"e","\u0247":"e","\u025B":"e","\u01DD":"e","\u24D5":"f","\uFF46":"f","\u1E1F":"f","\u0192":"f","\uA77C":"f","\u24D6":"g","\uFF47":"g","\u01F5":"g","\u011D":"g","\u1E21":"g","\u011F":"g","\u0121":"g","\u01E7":"g","\u0123":"g","\u01E5":"g","\u0260":"g","\uA7A1":"g","\u1D79":"g","\uA77F":"g","\u24D7":"h","\uFF48":"h","\u0125":"h","\u1E23":"h","\u1E27":"h","\u021F":"h","\u1E25":"h","\u1E29":"h","\u1E2B":"h","\u1E96":"h","\u0127":"h","\u2C68":"h","\u2C76":"h","\u0265":"h","\u0195":"hv","\u24D8":"i","\uFF49":"i","\u00EC":"i","\u00ED":"i","\u00EE":"i","\u0129":"i","\u012B":"i","\u012D":"i","\u00EF":"i","\u1E2F":"i","\u1EC9":"i","\u01D0":"i","\u0209":"i","\u020B":"i","\u1ECB":"i","\u012F":"i","\u1E2D":"i","\u0268":"i","\u0131":"i","\u24D9":"j","\uFF4A":"j","\u0135":"j","\u01F0":"j","\u0249":"j","\u24DA":"k","\uFF4B":"k","\u1E31":"k","\u01E9":"k","\u1E33":"k","\u0137":"k","\u1E35":"k","\u0199":"k","\u2C6A":"k","\uA741":"k","\uA743":"k","\uA745":"k","\uA7A3":"k","\u24DB":"l","\uFF4C":"l","\u0140":"l","\u013A":"l","\u013E":"l","\u1E37":"l","\u1E39":"l","\u013C":"l","\u1E3D":"l","\u1E3B":"l","\u017F":"l","\u0142":"l","\u019A":"l","\u026B":"l","\u2C61":"l","\uA749":"l","\uA781":"l","\uA747":"l","\u01C9":"lj","\u24DC":"m","\uFF4D":"m","\u1E3F":"m","\u1E41":"m","\u1E43":"m","\u0271":"m","\u026F":"m","\u24DD":"n","\uFF4E":"n","\u01F9":"n","\u0144":"n","\u00F1":"n","\u1E45":"n","\u0148":"n","\u1E47":"n","\u0146":"n","\u1E4B":"n","\u1E49":"n","\u019E":"n","\u0272":"n","\u0149":"n","\uA791":"n","\uA7A5":"n","\u01CC":"nj","\u24DE":"o","\uFF4F":"o","\u00F2":"o","\u00F3":"o","\u00F4":"o","\u1ED3":"o","\u1ED1":"o","\u1ED7":"o","\u1ED5":"o","\u00F5":"o","\u1E4D":"o","\u022D":"o","\u1E4F":"o","\u014D":"o","\u1E51":"o","\u1E53":"o","\u014F":"o","\u022F":"o","\u0231":"o","\u00F6":"o","\u022B":"o","\u1ECF":"o","\u0151":"o","\u01D2":"o","\u020D":"o","\u020F":"o","\u01A1":"o","\u1EDD":"o","\u1EDB":"o","\u1EE1":"o","\u1EDF":"o","\u1EE3":"o","\u1ECD":"o","\u1ED9":"o","\u01EB":"o","\u01ED":"o","\u00F8":"o","\u01FF":"o","\u0254":"o","\uA74B":"o","\uA74D":"o","\u0275":"o","\u01A3":"oi","\u0223":"ou","\uA74F":"oo","\u24DF":"p","\uFF50":"p","\u1E55":"p","\u1E57":"p","\u01A5":"p","\u1D7D":"p","\uA751":"p","\uA753":"p","\uA755":"p","\u24E0":"q","\uFF51":"q","\u024B":"q","\uA757":"q","\uA759":"q","\u24E1":"r","\uFF52":"r","\u0155":"r","\u1E59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1E5B":"r","\u1E5D":"r","\u0157":"r","\u1E5F":"r","\u024D":"r","\u027D":"r","\uA75B":"r","\uA7A7":"r","\uA783":"r","\u24E2":"s","\uFF53":"s","\u00DF":"s","\u015B":"s","\u1E65":"s","\u015D":"s","\u1E61":"s","\u0161":"s","\u1E67":"s","\u1E63":"s","\u1E69":"s","\u0219":"s","\u015F":"s","\u023F":"s","\uA7A9":"s","\uA785":"s","\u1E9B":"s","\u24E3":"t","\uFF54":"t","\u1E6B":"t","\u1E97":"t","\u0165":"t","\u1E6D":"t","\u021B":"t","\u0163":"t","\u1E71":"t","\u1E6F":"t","\u0167":"t","\u01AD":"t","\u0288":"t","\u2C66":"t","\uA787":"t","\uA729":"tz","\u24E4":"u","\uFF55":"u","\u00F9":"u","\u00FA":"u","\u00FB":"u","\u0169":"u","\u1E79":"u","\u016B":"u","\u1E7B":"u","\u016D":"u","\u00FC":"u","\u01DC":"u","\u01D8":"u","\u01D6":"u","\u01DA":"u","\u1EE7":"u","\u016F":"u","\u0171":"u","\u01D4":"u","\u0215":"u","\u0217":"u","\u01B0":"u","\u1EEB":"u","\u1EE9":"u","\u1EEF":"u","\u1EED":"u","\u1EF1":"u","\u1EE5":"u","\u1E73":"u","\u0173":"u","\u1E77":"u","\u1E75":"u","\u0289":"u","\u24E5":"v","\uFF56":"v","\u1E7D":"v","\u1E7F":"v","\u028B":"v","\uA75F":"v","\u028C":"v","\uA761":"vy","\u24E6":"w","\uFF57":"w","\u1E81":"w","\u1E83":"w","\u0175":"w","\u1E87":"w","\u1E85":"w","\u1E98":"w","\u1E89":"w","\u2C73":"w","\u24E7":"x","\uFF58":"x","\u1E8B":"x","\u1E8D":"x","\u24E8":"y","\uFF59":"y","\u1EF3":"y","\u00FD":"y","\u0177":"y","\u1EF9":"y","\u0233":"y","\u1E8F":"y","\u00FF":"y","\u1EF7":"y","\u1E99":"y","\u1EF5":"y","\u01B4":"y","\u024F":"y","\u1EFF":"y","\u24E9":"z","\uFF5A":"z","\u017A":"z","\u1E91":"z","\u017C":"z","\u017E":"z","\u1E93":"z","\u1E95":"z","\u01B6":"z","\u0225":"z","\u0240":"z","\u2C6C":"z","\uA763":"z","\u0386":"\u0391","\u0388":"\u0395","\u0389":"\u0397","\u038A":"\u0399","\u03AA":"\u0399","\u038C":"\u039F","\u038E":"\u03A5","\u03AB":"\u03A5","\u038F":"\u03A9","\u03AC":"\u03B1","\u03AD":"\u03B5","\u03AE":"\u03B7","\u03AF":"\u03B9","\u03CA":"\u03B9","\u0390":"\u03B9","\u03CC":"\u03BF","\u03CD":"\u03C5","\u03CB":"\u03C5","\u03B0":"\u03C5","\u03C9":"\u03C9","\u03C2":"\u03C3"};$document=$(document);nextUid=(function(){var counter=1;return function(){return counter++;};}());function reinsertElement(element){var placeholder=$(document.createTextNode(''));element.before(placeholder);placeholder.before(element);placeholder.remove();}
function stripDiacritics(str){function match(a){return DIACRITICS[a]||a;}
return str.replace(/[^\u0000-\u007E]/g,match);}
function indexOf(value,array){var i=0,l=array.length;for(;i<l;i=i+1){if(equal(value,array[i]))return i;}
return-1;}
function measureScrollbar(){var $template=$(MEASURE_SCROLLBAR_TEMPLATE);$template.appendTo('body');var dim={width:$template.width()-$template[0].clientWidth,height:$template.height()-$template[0].clientHeight};$template.remove();return dim;}
function equal(a,b){if(a===b)return true;if(a===undefined||b===undefined)return false;if(a===null||b===null)return false;if(a.constructor===String)return a+''===b+'';if(b.constructor===String)return b+''===a+'';return false;}
function splitVal(string,separator){var val,i,l;if(string===null||string.length<1)return[];val=string.split(separator);for(i=0,l=val.length;i<l;i=i+1)val[i]=$.trim(val[i]);return val;}
function getSideBorderPadding(element){return element.outerWidth(false)-element.width();}
function installKeyUpChangeEvent(element){var key="keyup-change-value";element.on("keydown",function(){if($.data(element,key)===undefined){$.data(element,key,element.val());}});element.on("keyup",function(){var val=$.data(element,key);if(val!==undefined&&element.val()!==val){$.removeData(element,key);element.trigger("keyup-change");}});}
function installFilteredMouseMove(element){element.on("mousemove",function(e){var lastpos=lastMousePosition;if(lastpos===undefined||lastpos.x!==e.pageX||lastpos.y!==e.pageY){$(e.target).trigger("mousemove-filtered",e);}});}
function debounce(quietMillis,fn,ctx){ctx=ctx||undefined;var timeout;return function(){var args=arguments;window.clearTimeout(timeout);timeout=window.setTimeout(function(){fn.apply(ctx,args);},quietMillis);};}
function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e);});element.on("scroll",function(e){if(indexOf(e.target,element.get())>=0)notify(e);});}
function focus($el){if($el[0]===document.activeElement)return;window.setTimeout(function(){var el=$el[0],pos=$el.val().length,range;$el.focus();var isVisible=(el.offsetWidth>0||el.offsetHeight>0);if(isVisible&&el===document.activeElement){if(el.setSelectionRange)
{el.setSelectionRange(pos,pos);}
else if(el.createTextRange){range=el.createTextRange();range.collapse(false);range.select();}}},0);}
function getCursorInfo(el){el=$(el)[0];var offset=0;var length=0;if('selectionStart'in el){offset=el.selectionStart;length=el.selectionEnd-offset;}else if('selection'in document){el.focus();var sel=document.selection.createRange();length=document.selection.createRange().text.length;sel.moveStart('character',-el.value.length);offset=sel.text.length-length;}
return{offset:offset,length:length};}
function killEvent(event){event.preventDefault();event.stopPropagation();}
function killEventImmediately(event){event.preventDefault();event.stopImmediatePropagation();}
function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"});sizer.attr("class","select2-sizer");$("body").append(sizer);}
sizer.text(e.val());return sizer.width();}
function syncCssClasses(dest,src,adapter){var classes,replacements=[],adapted;classes=$.trim(dest.attr("class"));if(classes){classes=''+classes;$(classes.split(/\s+/)).each2(function(){if(this.indexOf("select2-")===0){replacements.push(this);}});}
classes=$.trim(src.attr("class"));if(classes){classes=''+classes;$(classes.split(/\s+/)).each2(function(){if(this.indexOf("select2-")!==0){adapted=adapter(this);if(adapted){replacements.push(adapted);}}});}
dest.attr("class",replacements.join(" "));}
function markMatch(text,term,markup,escapeMarkup){var match=stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())),tl=term.length;if(match<0){markup.push(escapeMarkup(text));return;}
markup.push(escapeMarkup(text.substring(0,match)));markup.push("<span class='select2-match'>");markup.push(escapeMarkup(text.substring(match,match+tl)));markup.push("</span>");markup.push(escapeMarkup(text.substring(match+tl,text.length)));}
function defaultEscapeMarkup(markup){var replace_map={'\\':'&#92;','&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;',"/":'&#47;'};return String(markup).replace(/[&<>"'\/\\]/g,function(match){return replace_map[match];});}
function ajax(options){var timeout,handler=null,quietMillis=options.quietMillis||100,ajaxUrl=options.url,self=this;return function(query){window.clearTimeout(timeout);timeout=window.setTimeout(function(){var data=options.data,url=ajaxUrl,transport=options.transport||$.fn.select2.ajaxDefaults.transport,deprecated={type:options.type||'GET',cache:options.cache||false,jsonpCallback:options.jsonpCallback||undefined,dataType:options.dataType||"json"},params=$.extend({},$.fn.select2.ajaxDefaults.params,deprecated);data=data?data.call(self,query.term,query.page,query.context):null;url=(typeof url==='function')?url.call(self,query.term,query.page,query.context):url;if(handler&&typeof handler.abort==="function"){handler.abort();}
if(options.params){if($.isFunction(options.params)){$.extend(params,options.params.call(self));}else{$.extend(params,options.params);}}
$.extend(params,{url:url,dataType:options.dataType,data:data,success:function(data){var results=options.results(data,query.page,query);query.callback(results);},error:function(jqXHR,textStatus,errorThrown){var results={hasError:true,jqXHR:jqXHR,textStatus:textStatus,errorThrown:errorThrown,};query.callback(results);}});handler=transport.call(self,params);},quietMillis);};}
function local(options){var data=options,dataText,tmp,text=function(item){return""+item.text;};if($.isArray(data)){tmp=data;data={results:tmp};}
if($.isFunction(data)===false){tmp=data;data=function(){return tmp;};}
var dataItem=data();if(dataItem.text){text=dataItem.text;if(!$.isFunction(text)){dataText=dataItem.text;text=function(item){return item[dataText];};}}
return function(query){var t=query.term,filtered={results:[]},process;if(t===""){query.callback(data());return;}
process=function(datum,collection){var group,attr;datum=datum[0];if(datum.children){group={};for(attr in datum){if(datum.hasOwnProperty(attr))group[attr]=datum[attr];}
group.children=[];$(datum.children).each2(function(i,childDatum){process(childDatum,group.children);});if(group.children.length||query.matcher(t,text(group),datum)){collection.push(group);}}else{if(query.matcher(t,text(datum),datum)){collection.push(datum);}}};$(data().results).each2(function(i,datum){process(datum,filtered.results);});query.callback(filtered);};}
function tags(data){var isFunc=$.isFunction(data);return function(query){var t=query.term,filtered={results:[]};var result=isFunc?data(query):data;if($.isArray(result)){$(result).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;if(t===""||query.matcher(t,text)){filtered.results.push(isObject?this:{id:this,text:this});}});query.callback(filtered);}};}
function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return true;if(!formatter)return false;if(typeof(formatter)==='string')return true;throw new Error(formatterName+" must be a string, function, or falsy value");}
function evaluate(val,context){if($.isFunction(val)){var args=Array.prototype.slice.call(arguments,2);return val.apply(context,args);}
return val;}
function countResults(results){var count=0;$.each(results,function(i,item){if(item.children){count+=countResults(item.children);}else{count++;}});return count;}
function defaultTokenizer(input,selection,selectCallback,opts){var original=input,dupe=false,token,index,i,l,separator;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;while(true){index=-1;for(i=0,l=opts.tokenSeparators.length;i<l;i++){separator=opts.tokenSeparators[i];index=input.indexOf(separator);if(index>=0)break;}
if(index<0)break;token=input.substring(0,index);input=input.substring(index+separator.length);if(token.length>0){token=opts.createSearchChoice.call(this,token,selection);if(token!==undefined&&token!==null&&opts.id(token)!==undefined&&opts.id(token)!==null){dupe=false;for(i=0,l=selection.length;i<l;i++){if(equal(opts.id(token),opts.id(selection[i]))){dupe=true;break;}}
if(!dupe)selectCallback(token);}}}
if(original!==input)return input;}
function cleanupJQueryElements(){var self=this;$.each(arguments,function(i,element){self[element].remove();self[element]=null;});}
function clazz(SuperClass,methods){var constructor=function(){};constructor.prototype=new SuperClass;constructor.prototype.constructor=constructor;constructor.prototype.parent=SuperClass.prototype;constructor.prototype=$.extend(constructor.prototype,methods);return constructor;}
AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments);};},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts);this.id=opts.id;if(opts.element.data("select2")!==undefined&&opts.element.data("select2")!==null){opts.element.data("select2").destroy();}
this.container=this.createContainer();this.liveRegion=$("<span>",{role:"status","aria-live":"polite"}).addClass("select2-hidden-accessible").appendTo(document.body);this.containerId="s2id_"+(opts.element.attr("id")||"autogen"+nextUid());this.containerEventName=this.containerId.replace(/([.])/g,'_').replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,'\\$1');this.container.attr("id",this.containerId);this.container.attr("title",opts.element.attr("title"));this.body=$("body");syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.attr("style",opts.element.attr("style"));this.container.css(evaluate(opts.containerCss,this.opts.element));this.container.addClass(evaluate(opts.containerCssClass,this.opts.element));this.elementTabIndex=this.opts.element.attr("tabindex");this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",killEvent);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(evaluate(opts.dropdownCssClass,this.opts.element));this.dropdown.data("select2",this);this.dropdown.on("click",killEvent);this.results=results=this.container.find(resultsSelector);this.search=search=this.container.find("input.select2-input");this.queryCount=0;this.resultsPage=0;this.context=null;this.initContainer();this.container.on("click",killEvent);installFilteredMouseMove(this.results);this.dropdown.on("mousemove-filtered",resultsSelector,this.bind(this.highlightUnderEvent));this.dropdown.on("touchstart touchmove touchend",resultsSelector,this.bind(function(event){this._touchEvent=true;this.highlightUnderEvent(event);}));this.dropdown.on("touchmove",resultsSelector,this.bind(this.touchMoved));this.dropdown.on("touchstart touchend",resultsSelector,this.bind(this.clearTouchMoved));this.dropdown.on('click',this.bind(function(event){if(this._touchEvent){this._touchEvent=false;this.selectHighlighted();}}));installDebouncedScroll(80,this.results);this.dropdown.on("scroll-debounced",resultsSelector,this.bind(this.loadMoreIfNeeded));$(this.container).on("change",".select2-input",function(e){e.stopPropagation();});$(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation();});if($.fn.mousewheel){results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop();if(deltaY>0&&top-deltaY<=0){results.scrollTop(0);killEvent(e);}else if(deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()){results.scrollTop(results.get(0).scrollHeight-results.height());killEvent(e);}});}
installKeyUpChangeEvent(search);search.on("keyup-change input paste",this.bind(this.updateResults));search.on("focus",function(){search.addClass("select2-focused");});search.on("blur",function(){search.removeClass("select2-focused");});this.dropdown.on("mouseup",resultsSelector,this.bind(function(e){if($(e.target).closest(".select2-result-selectable").length>0){this.highlightUnderEvent(e);this.selectHighlighted(e);}}));this.dropdown.on("click mouseup mousedown touchstart touchend focusin",function(e){e.stopPropagation();});this.nextSearchTerm=undefined;if($.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource();}
if(opts.maximumInputLength!==null){this.search.attr("maxlength",opts.maximumInputLength);}
var disabled=opts.element.prop("disabled");if(disabled===undefined)disabled=false;this.enable(!disabled);var readonly=opts.element.prop("readonly");if(readonly===undefined)readonly=false;this.readonly(readonly);scrollBarDimensions=scrollBarDimensions||measureScrollbar();this.autofocus=opts.element.prop("autofocus");opts.element.prop("autofocus",false);if(this.autofocus)this.focus();this.search.attr("placeholder",opts.searchInputPlaceholder);},destroy:function(){var element=this.opts.element,select2=element.data("select2"),self=this;this.close();if(element.length&&element[0].detachEvent){element.each(function(){this.detachEvent("onpropertychange",self._sync);});}
if(this.propertyObserver){this.propertyObserver.disconnect();this.propertyObserver=null;}
this._sync=null;if(select2!==undefined){select2.container.remove();select2.liveRegion.remove();select2.dropdown.remove();element.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||false);if(this.elementTabIndex){element.attr({tabindex:this.elementTabIndex});}else{element.removeAttr("tabindex");}
element.show();}
cleanupJQueryElements.call(this,"container","liveRegion","dropdown","results","search");},optionToData:function(element){if(element.is("option")){return{id:element.prop("value"),text:element.text(),element:element.get(),css:element.attr("class"),disabled:element.prop("disabled"),locked:equal(element.attr("locked"),"locked")||equal(element.data("locked"),true)};}else if(element.is("optgroup")){return{text:element.attr("label"),children:[],element:element.get(),css:element.attr("class")};}},prepareOpts:function(opts){var element,select,idKey,ajaxUrl,self=this;element=opts.element;if(element.get(0).tagName.toLowerCase()==="select"){this.select=select=opts.element;}
if(select){$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.");}});}
opts=$.extend({},{populateResults:function(container,results,query){var populate,id=this.opts.id,liveRegion=this.liveRegion;populate=function(results,container,depth){var i,l,result,selectable,disabled,compound,node,label,innerContainer,formatted;results=opts.sortResults(results,container,query);var nodes=[];for(i=0,l=results.length;i<l;i=i+1){result=results[i];disabled=(result.disabled===true);selectable=(!disabled)&&(id(result)!==undefined);compound=result.children&&result.children.length>0;node=$("<li></li>");node.addClass("select2-results-dept-"+depth);node.addClass("select2-result");node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable");if(disabled){node.addClass("select2-disabled");}
if(compound){node.addClass("select2-result-with-children");}
node.addClass(self.opts.formatResultCssClass(result));node.attr("role","presentation");label=$(document.createElement("div"));label.addClass("select2-result-label");label.attr("id","select2-result-label-"+nextUid());label.attr("role","option");formatted=opts.formatResult(result,label,query,self.opts.escapeMarkup);if(formatted!==undefined){label.html(formatted);node.append(label);}
if(compound){innerContainer=$("<ul></ul>");innerContainer.addClass("select2-result-sub");populate(result.children,innerContainer,depth+1);node.append(innerContainer);}
node.data("select2-data",result);nodes.push(node[0]);}
container.append(nodes);liveRegion.text(opts.formatMatches(results.length));};populate(results,container,0);}},$.fn.select2.defaults,opts);if(typeof(opts.id)!=="function"){idKey=opts.id;opts.id=function(e){return e[idKey];};}
if($.isArray(opts.element.data("select2Tags"))){if("tags"in opts){throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+opts.element.attr("id");}
opts.tags=opts.element.data("select2Tags");}
if(select){opts.query=this.bind(function(query){var data={results:[],more:false},term=query.term,children,placeholderOption,process;process=function(element,collection){var group;if(element.is("option")){if(query.matcher(term,element.text(),element)){collection.push(self.optionToData(element));}}else if(element.is("optgroup")){group=self.optionToData(element);element.children().each2(function(i,elm){process(elm,group.children);});if(group.children.length>0){collection.push(group);}}};children=element.children();if(this.getPlaceholder()!==undefined&&children.length>0){placeholderOption=this.getPlaceholderOption();if(placeholderOption){children=children.not(placeholderOption);}}
children.each2(function(i,elm){process(elm,data.results);});query.callback(data);});opts.id=function(e){return e.id;};}else{if(!("query"in opts)){if("ajax"in opts){ajaxUrl=opts.element.data("ajax-url");if(ajaxUrl&&ajaxUrl.length>0){opts.ajax.url=ajaxUrl;}
opts.query=ajax.call(opts.element,opts.ajax);}else if("data"in opts){opts.query=local(opts.data);}else if("tags"in opts){opts.query=tags(opts.tags);if(opts.createSearchChoice===undefined){opts.createSearchChoice=function(term){return{id:$.trim(term),text:$.trim(term)};};}
if(opts.initSelection===undefined){opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var obj={id:this,text:this},tags=opts.tags;if($.isFunction(tags))tags=tags();$(tags).each(function(){if(equal(this.id,obj.id)){obj=this;return false;}});data.push(obj);});callback(data);};}}}}
if(typeof(opts.query)!=="function"){throw"query function not defined for Select2 "+opts.element.attr("id");}
if(opts.createSearchChoicePosition==='top'){opts.createSearchChoicePosition=function(list,item){list.unshift(item);};}
else if(opts.createSearchChoicePosition==='bottom'){opts.createSearchChoicePosition=function(list,item){list.push(item);};}
else if(typeof(opts.createSearchChoicePosition)!=="function"){throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";}
return opts;},monitorSource:function(){var el=this.opts.element,observer,self=this;el.on("change.select2",this.bind(function(e){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection();}}));this._sync=this.bind(function(){var disabled=el.prop("disabled");if(disabled===undefined)disabled=false;this.enable(!disabled);var readonly=el.prop("readonly");if(readonly===undefined)readonly=false;this.readonly(readonly);syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.addClass(evaluate(this.opts.containerCssClass,this.opts.element));syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(evaluate(this.opts.dropdownCssClass,this.opts.element));});if(el.length&&el[0].attachEvent){el.each(function(){this.attachEvent("onpropertychange",self._sync);});}
observer=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(observer!==undefined){if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null;}
this.propertyObserver=new observer(function(mutations){$.each(mutations,self._sync);});this.propertyObserver.observe(el.get(0),{attributes:true,subtree:false});}},triggerSelect:function(data){var evt=$.Event("select2-selecting",{val:this.id(data),object:data,choice:data});this.opts.element.trigger(evt);return!evt.isDefaultPrevented();},triggerChange:function(details){details=details||{};details=$.extend({},details,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(details);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();if(this.opts.blurOnChange)
this.opts.element.blur();},isInterfaceEnabled:function()
{return this.enabledInterface===true;},enableInterface:function(){var enabled=this._enabled&&!this._readonly,disabled=!enabled;if(enabled===this.enabledInterface)return false;this.container.toggleClass("select2-container-disabled",disabled);this.close();this.enabledInterface=enabled;return true;},enable:function(enabled){if(enabled===undefined)enabled=true;if(this._enabled===enabled)return;this._enabled=enabled;this.opts.element.prop("disabled",!enabled);this.enableInterface();},disable:function(){this.enable(false);},readonly:function(enabled){if(enabled===undefined)enabled=false;if(this._readonly===enabled)return;this._readonly=enabled;this.opts.element.prop("readonly",enabled);this.enableInterface();},opened:function(){return(this.container)?this.container.hasClass("select2-dropdown-open"):false;},positionDropdown:function(){var $dropdown=this.dropdown,offset=this.container.offset(),height=this.container.outerHeight(false),width=this.container.outerWidth(false),dropHeight=$dropdown.outerHeight(false),$window=$(window),windowWidth=$window.width(),windowHeight=$window.height(),viewPortRight=$window.scrollLeft()+windowWidth,viewportBottom=$window.scrollTop()+windowHeight,dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=(offset.top-dropHeight)>=$window.scrollTop(),dropWidth=$dropdown.outerWidth(false),enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight,aboveNow=$dropdown.hasClass("select2-drop-above"),bodyOffset,above,changeDirection,css,resultsListNode;if(aboveNow){above=true;if(!enoughRoomAbove&&enoughRoomBelow){changeDirection=true;above=false;}}else{above=false;if(!enoughRoomBelow&&enoughRoomAbove){changeDirection=true;above=true;}}
if(changeDirection){$dropdown.hide();offset=this.container.offset();height=this.container.outerHeight(false);width=this.container.outerWidth(false);dropHeight=$dropdown.outerHeight(false);viewPortRight=$window.scrollLeft()+windowWidth;viewportBottom=$window.scrollTop()+windowHeight;dropTop=offset.top+height;dropLeft=offset.left;dropWidth=$dropdown.outerWidth(false);enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight;$dropdown.show();this.focusSearch();}
if(this.opts.dropdownAutoWidth){resultsListNode=$('.select2-results',$dropdown)[0];$dropdown.addClass('select2-drop-auto-width');$dropdown.css('width','');dropWidth=$dropdown.outerWidth(false)+(resultsListNode.scrollHeight===resultsListNode.clientHeight?0:scrollBarDimensions.width);dropWidth>width?width=dropWidth:dropWidth=width;dropHeight=$dropdown.outerHeight(false);enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight;}
else{this.container.removeClass('select2-drop-auto-width');}
if(this.body.css('position')!=='static'){bodyOffset=this.body.offset();dropTop-=bodyOffset.top;dropLeft-=bodyOffset.left;}
if(!enoughRoomOnRight){dropLeft=offset.left+this.container.outerWidth(false)-dropWidth;}
css={left:dropLeft,width:width};if(above){css.top=offset.top-dropHeight;css.bottom='auto';this.container.addClass("select2-drop-above");$dropdown.addClass("select2-drop-above");}
else{css.top=dropTop;css.bottom='auto';this.container.removeClass("select2-drop-above");$dropdown.removeClass("select2-drop-above");}
css=$.extend(css,evaluate(this.opts.dropdownCss,this.opts.element));$dropdown.css(css);},shouldOpen:function(){var event;if(this.opened())return false;if(this._enabled===false||this._readonly===true)return false;event=$.Event("select2-opening");this.opts.element.trigger(event);return!event.isDefaultPrevented();},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");},open:function(){if(!this.shouldOpen())return false;this.opening();$document.on("mousemove.select2Event",function(e){lastMousePosition.x=e.pageX;lastMousePosition.y=e.pageY;});return true;},opening:function(){var cid=this.containerEventName,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid,mask;this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.clearDropdownAlignmentPreference();if(this.dropdown[0]!==this.body.children().last()[0]){this.dropdown.detach().appendTo(this.body);}
mask=$("#select2-drop-mask");if(mask.length==0){mask=$(document.createElement("div"));mask.attr("id","select2-drop-mask").attr("class","select2-drop-mask");mask.hide();mask.appendTo(this.body);mask.on("mousedown touchstart click",function(e){reinsertElement(mask);var dropdown=$("#select2-drop"),self;if(dropdown.length>0){self=dropdown.data("select2");if(self.opts.selectOnBlur){self.selectHighlighted({noFocus:true});}
self.close();e.preventDefault();e.stopPropagation();}});}
if(this.dropdown.prev()[0]!==mask[0]){this.dropdown.before(mask);}
$("#select2-drop").removeAttr("id");this.dropdown.attr("id","select2-drop");mask.show();this.positionDropdown();this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");var that=this;this.container.parents().add(window).each(function(){$(this).on(resize+" "+scroll+" "+orient,function(e){if(that.opened())that.positionDropdown();});});},close:function(){if(!this.opened())return;var cid=this.containerEventName,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid;this.container.parents().add(window).each(function(){$(this).off(scroll).off(resize).off(orient);});this.clearDropdownAlignmentPreference();$("#select2-drop-mask").hide();this.dropdown.removeAttr("id");this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();$document.off("mousemove.select2Event");this.clearSearch();this.search.removeClass("select2-active");this.opts.element.trigger($.Event("select2-close"));},externalSearch:function(term){this.open();this.search.val(term);this.updateResults(false);},clearSearch:function(){},getMaximumSelectionSize:function(){return evaluate(this.opts.maximumSelectionSize,this.opts.element);},ensureHighlightVisible:function(){var results=this.results,children,index,child,hb,rb,y,more,topOffset;index=this.highlight();if(index<0)return;if(index==0){results.scrollTop(0);return;}
children=this.findHighlightableChoices().find('.select2-result-label');child=$(children[index]);topOffset=(child.offset()||{}).top||0;hb=topOffset+child.outerHeight(true);if(index===children.length-1){more=results.find("li.select2-more-results");if(more.length>0){hb=more.offset().top+more.outerHeight(true);}}
rb=results.offset().top+results.outerHeight(true);if(hb>rb){results.scrollTop(results.scrollTop()+(hb-rb));}
y=topOffset-results.offset().top;if(y<0&&child.css('display')!='none'){results.scrollTop(results.scrollTop()+y);}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)");},moveHighlight:function(delta){var choices=this.findHighlightableChoices(),index=this.highlight();while(index>-1&&index<choices.length){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")&&!choice.hasClass("select2-selected")){this.highlight(index);break;}}},highlight:function(index){var choices=this.findHighlightableChoices(),choice,data;if(arguments.length===0){return indexOf(choices.filter(".select2-highlighted")[0],choices.get());}
if(index>=choices.length)index=choices.length-1;if(index<0)index=0;this.removeHighlight();choice=$(choices[index]);choice.addClass("select2-highlighted");this.search.attr("aria-activedescendant",choice.find(".select2-result-label").attr("id"));this.ensureHighlightVisible();this.liveRegion.text(choice.text());data=choice.data("select2-data");if(data){this.opts.element.trigger({type:"select2-highlight",val:this.id(data),choice:data});}},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted");},touchMoved:function(){this._touchMoved=true;},clearTouchMoved:function(){this._touchMoved=false;},countSelectableResults:function(){return this.findHighlightableChoices().length;},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.findHighlightableChoices();this.highlight(choices.index(el));}else if(el.length==0){this.removeHighlight();}},loadMoreIfNeeded:function(){var results=this.results,more=results.find("li.select2-more-results"),below,page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;if(more.length===0)return;below=more.offset().top-results.offset().top-results.height();if(below<=this.opts.loadMorePadding){more.addClass("select2-active");this.opts.query({element:this.opts.element,term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){if(!self.opened())return;self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context});self.postprocessResults(data,false,false);if(data.more===true){more.detach().appendTo(results).text(evaluate(self.opts.formatLoadMore,self.opts.element,page+1));window.setTimeout(function(){self.loadMoreIfNeeded();},10);}else{more.remove();}
self.positionDropdown();self.resultsPage=page;self.context=data.context;this.opts.element.trigger({type:"select2-loaded",items:data});})});}},tokenize:function(){},updateResults:function(initial){var search=this.search,results=this.results,opts=this.opts,data,self=this,input,term=search.val(),lastTerm=$.data(this.container,"select2-last-term"),queryNumber;if(initial!==true&&lastTerm&&equal(term,lastTerm))return;$.data(this.container,"select2-last-term",term);if(initial!==true&&(this.showSearchInput===false||!this.opened())){return;}
function postRender(){search.removeClass("select2-active");self.positionDropdown();if(results.find('.select2-no-results,.select2-selection-limit,.select2-searching').length){self.liveRegion.text(results.text());}
else{self.liveRegion.text(self.opts.formatMatches(results.find('.select2-result-selectable').length));}}
function render(html){results.html(html);postRender();}
queryNumber=++this.queryCount;var maxSelSize=this.getMaximumSelectionSize();if(maxSelSize>=1){data=this.data();if($.isArray(data)&&data.length>=maxSelSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")){render("<li class='select2-selection-limit'>"+evaluate(opts.formatSelectionTooBig,opts.element,maxSelSize)+"</li>");return;}}
if(search.val().length<opts.minimumInputLength){if(checkFormatter(opts.formatInputTooShort,"formatInputTooShort")){render("<li class='select2-no-results'>"+evaluate(opts.formatInputTooShort,opts.element,search.val(),opts.minimumInputLength)+"</li>");}else{render("");}
if(initial&&this.showSearch)this.showSearch(true);return;}
if(opts.maximumInputLength&&search.val().length>opts.maximumInputLength){if(checkFormatter(opts.formatInputTooLong,"formatInputTooLong")){render("<li class='select2-no-results'>"+evaluate(opts.formatInputTooLong,opts.element,search.val(),opts.maximumInputLength)+"</li>");}else{render("");}
return;}
if(opts.formatSearching&&this.findHighlightableChoices().length===0){render("<li class='select2-searching'>"+evaluate(opts.formatSearching,opts.element)+"</li>");}
search.addClass("select2-active");this.removeHighlight();input=this.tokenize();if(input!=undefined&&input!=null){search.val(input);}
this.resultsPage=1;opts.query({element:opts.element,term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;if(queryNumber!=this.queryCount){return;}
if(!this.opened()){this.search.removeClass("select2-active");return;}
if(data.hasError!==undefined&&checkFormatter(opts.formatAjaxError,"formatAjaxError")){render("<li class='select2-ajax-error'>"+evaluate(opts.formatAjaxError,opts.element,data.jqXHR,data.textStatus,data.errorThrown)+"</li>");return;}
this.context=(data.context===undefined)?null:data.context;if(this.opts.createSearchChoice&&search.val()!==""){def=this.opts.createSearchChoice.call(self,search.val(),data.results);if(def!==undefined&&def!==null&&self.id(def)!==undefined&&self.id(def)!==null){if($(data.results).filter(function(){return equal(self.id(this),self.id(def));}).length===0){this.opts.createSearchChoicePosition(data.results,def);}}}
if(data.results.length===0&&checkFormatter(opts.formatNoMatches,"formatNoMatches")){render("<li class='select2-no-results'>"+evaluate(opts.formatNoMatches,opts.element,search.val())+"</li>");return;}
results.empty();self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null});if(data.more===true&&checkFormatter(opts.formatLoadMore,"formatLoadMore")){results.append("<li class='select2-more-results'>"+opts.escapeMarkup(evaluate(opts.formatLoadMore,opts.element,this.resultsPage))+"</li>");window.setTimeout(function(){self.loadMoreIfNeeded();},10);}
this.postprocessResults(data,initial);postRender();this.opts.element.trigger({type:"select2-loaded",items:data});})});},cancel:function(){this.close();},blur:function(){if(this.opts.selectOnBlur)
this.selectHighlighted({noFocus:true});this.close();this.container.removeClass("select2-container-active");if(this.search[0]===document.activeElement){this.search.blur();}
this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");},focusSearch:function(){focus(this.search);},selectHighlighted:function(options){if(this._touchMoved){this.clearTouchMoved();return;}
var index=this.highlight(),highlighted=this.results.find(".select2-highlighted"),data=highlighted.closest('.select2-result').data("select2-data");if(data){this.highlight(index);this.onSelect(data,options);}else if(options&&options.noFocus){this.close();}},getPlaceholder:function(){var placeholderOption;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((placeholderOption=this.getPlaceholderOption())!==undefined?placeholderOption.text():undefined);},getPlaceholderOption:function(){if(this.select){var firstOption=this.select.children('option').first();if(this.opts.placeholderOption!==undefined){return(this.opts.placeholderOption==="first"&&firstOption)||(typeof this.opts.placeholderOption==="function"&&this.opts.placeholderOption(this.select));}else if($.trim(firstOption.text())===""&&firstOption.val()===""){return firstOption;}}},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l,attr;if(this.opts.width==="off"){return null;}else if(this.opts.width==="element"){return this.opts.element.outerWidth(false)===0?'auto':this.opts.element.outerWidth(false)+'px';}else if(this.opts.width==="copy"||this.opts.width==="resolve"){style=this.opts.element.attr('style');if(style!==undefined){attrs=style.split(';');for(i=0,l=attrs.length;i<l;i=i+1){attr=attrs[i].replace(/\s/g,'');matches=attr.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);if(matches!==null&&matches.length>=1)
return matches[1];}}
if(this.opts.width==="resolve"){style=this.opts.element.css('width');if(style.indexOf("%")>0)return style;return(this.opts.element.outerWidth(false)===0?'auto':this.opts.element.outerWidth(false)+'px');}
return null;}else if($.isFunction(this.opts.width)){return this.opts.width();}else{return this.opts.width;}};var width=resolveContainerWidth.call(this);if(width!==null){this.container.css("width",width);}}});SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='select2-offscreen'></label>","<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <label for='' class='select2-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='select2-results' role='listbox'>","   </ul>","</div>"].join(""));return container;},enableInterface:function(){if(this.parent.enableInterface.apply(this,arguments)){this.focusser.prop("disabled",!this.isInterfaceEnabled());}},opening:function(){var el,range,len;if(this.opts.minimumResultsForSearch>=0){this.showSearch(true);}
this.parent.opening.apply(this,arguments);if(this.showSearchInput!==false){this.search.val(this.focusser.val());}
if(this.opts.shouldFocusInput(this)){this.search.focus();el=this.search.get(0);if(el.createTextRange){range=el.createTextRange();range.collapse(false);range.select();}else if(el.setSelectionRange){len=this.search.val().length;el.setSelectionRange(len,len);}}
if(this.search.val()===""){if(this.nextSearchTerm!=undefined){this.search.val(this.nextSearchTerm);this.search.select();}}
this.focusser.prop("disabled",true).val("");this.updateResults(true);this.opts.element.trigger($.Event("select2-open"));},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);this.focusser.prop("disabled",false);if(this.opts.shouldFocusInput(this)){this.focusser.focus();}},focus:function(){if(this.opened()){this.close();}else{this.focusser.prop("disabled",false);if(this.opts.shouldFocusInput(this)){this.focusser.focus();}}},isFocused:function(){return this.container.hasClass("select2-container-active");},cancel:function(){this.parent.cancel.apply(this,arguments);this.focusser.prop("disabled",false);if(this.opts.shouldFocusInput(this)){this.focusser.focus();}},destroy:function(){$("label[for='"+this.focusser.attr('id')+"']").attr('for',this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments);cleanupJQueryElements.call(this,"selection","focusser");},initContainer:function(){var selection,container=this.container,dropdown=this.dropdown,idSuffix=nextUid(),elementLabel;if(this.opts.minimumResultsForSearch<0){this.showSearch(false);}else{this.showSearch(true);}
this.selection=selection=container.find(".select2-choice");this.focusser=container.find(".select2-focusser");selection.find(".select2-chosen").attr("id","select2-chosen-"+idSuffix);this.focusser.attr("aria-labelledby","select2-chosen-"+idSuffix);this.results.attr("id","select2-results-"+idSuffix);this.search.attr("aria-owns","select2-results-"+idSuffix);this.focusser.attr("id","s2id_autogen"+idSuffix);elementLabel=$("label[for='"+this.opts.element.attr("id")+"']");this.focusser.prev().text(elementLabel.text()).attr('for',this.focusser.attr('id'));var originalTitle=this.opts.element.attr("title");this.opts.element.attr("title",(originalTitle||elementLabel.text()));this.focusser.attr("tabindex",this.elementTabIndex);this.search.attr("id",this.focusser.attr('id')+'_search');this.search.prev().text($("label[for='"+this.focusser.attr('id')+"']").text()).attr('for',this.search.attr('id'));this.search.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;if(229==e.keyCode)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.TAB:this.selectHighlighted({noFocus:true});return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}));this.search.on("blur",this.bind(function(e){if(document.activeElement===this.body.get(0)){window.setTimeout(this.bind(function(){if(this.opened()){this.search.focus();}}),0);}}));this.focusser.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){killEvent(e);return;}
if(e.which==KEY.DOWN||e.which==KEY.UP||(e.which==KEY.ENTER&&this.opts.openOnEnter)){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;this.open();killEvent(e);return;}
if(e.which==KEY.DELETE||e.which==KEY.BACKSPACE){if(this.opts.allowClear){this.clear();}
killEvent(e);return;}}));installKeyUpChangeEvent(this.focusser);this.focusser.on("keyup-change input",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){e.stopPropagation();if(this.opened())return;this.open();}}));selection.on("mousedown touchstart","abbr",this.bind(function(e){if(!this.isInterfaceEnabled())return;this.clear();killEventImmediately(e);this.close();this.selection.focus();}));selection.on("mousedown touchstart",this.bind(function(e){reinsertElement(selection);if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
if(this.opened()){this.close();}else if(this.isInterfaceEnabled()){this.open();}
killEvent(e);}));dropdown.on("mousedown touchstart",this.bind(function(){if(this.opts.shouldFocusInput(this)){this.search.focus();}}));selection.on("focus",this.bind(function(e){killEvent(e);}));this.focusser.on("focus",this.bind(function(){if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.container.addClass("select2-container-active");})).on("blur",this.bind(function(){if(!this.opened()){this.container.removeClass("select2-container-active");this.opts.element.trigger($.Event("select2-blur"));}}));this.search.on("focus",this.bind(function(){if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.container.addClass("select2-container-active");}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.setPlaceholder();},clear:function(triggerChange){var data=this.selection.data("select2-data");if(data){var evt=$.Event("select2-clearing");this.opts.element.trigger(evt);if(evt.isDefaultPrevented()){return;}
var placeholderOption=this.getPlaceholderOption();this.opts.element.val(placeholderOption?placeholderOption.val():"");this.selection.find(".select2-chosen").empty();this.selection.removeData("select2-data");this.setPlaceholder();if(triggerChange!==false){this.opts.element.trigger({type:"select2-removed",val:this.id(data),choice:data});this.triggerChange({removed:data});}}},initSelection:function(){var selected;if(this.isPlaceholderOptionSelected()){this.updateSelection(null);this.close();this.setPlaceholder();}else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){if(selected!==undefined&&selected!==null){self.updateSelection(selected);self.close();self.setPlaceholder();self.nextSearchTerm=self.opts.nextSearchTerm(selected,self.search.val());}});}},isPlaceholderOptionSelected:function(){var placeholderOption;if(this.getPlaceholder()===undefined)return false;return((placeholderOption=this.getPlaceholderOption())!==undefined&&placeholderOption.prop("selected"))||(this.opts.element.val()==="")||(this.opts.element.val()===undefined)||(this.opts.element.val()===null);},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var selected=element.find("option").filter(function(){return this.selected&&!this.disabled});callback(self.optionToData(selected));};}else if("data"in opts){opts.initSelection=opts.initSelection||function(element,callback){var id=element.val();var match=null;opts.query({matcher:function(term,text,el){var is_match=equal(id,opts.id(el));if(is_match){match=el;}
return is_match;},callback:!$.isFunction(callback)?$.noop:function(){callback(match);}});};}
return opts;},getPlaceholder:function(){if(this.select){if(this.getPlaceholderOption()===undefined){return undefined;}}
return this.parent.getPlaceholder.apply(this,arguments);},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&placeholder!==undefined){if(this.select&&this.getPlaceholderOption()===undefined)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(placeholder));this.selection.addClass("select2-default");this.container.removeClass("select2-allowclear");}},postprocessResults:function(data,initial,noHighlightUpdate){var selected=0,self=this,showSearchInput=true;this.findHighlightableChoices().each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val())){selected=i;return false;}});if(noHighlightUpdate!==false){if(initial===true&&selected>=0){this.highlight(selected);}else{this.highlight(0);}}
if(initial===true){var min=this.opts.minimumResultsForSearch;if(min>=0){this.showSearch(countResults(data.results)>=min);}}},showSearch:function(showSearchInput){if(this.showSearchInput===showSearchInput)return;this.showSearchInput=showSearchInput;this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!showSearchInput);this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!showSearchInput);$(this.dropdown,this.container).toggleClass("select2-with-searchbox",showSearchInput);},onSelect:function(data,options){if(!this.triggerSelect(data)){return;}
var old=this.opts.element.val(),oldData=this.data();this.opts.element.val(this.id(data));this.updateSelection(data);this.opts.element.trigger({type:"select2-selected",val:this.id(data),choice:data});this.nextSearchTerm=this.opts.nextSearchTerm(data,this.search.val());this.close();if((!options||!options.noFocus)&&this.opts.shouldFocusInput(this)){this.focusser.focus();}
if(!equal(old,this.id(data))){this.triggerChange({added:data,removed:oldData});}},updateSelection:function(data){var container=this.selection.find(".select2-chosen"),formatted,cssClass;this.selection.data("select2-data",data);container.empty();if(data!==null){formatted=this.opts.formatSelection(data,container,this.opts.escapeMarkup);}
if(formatted!==undefined){container.append(formatted);}
cssClass=this.opts.formatSelectionCssClass(data,container);if(cssClass!==undefined){container.addClass(cssClass);}
this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==undefined){this.container.addClass("select2-allowclear");}},val:function(){var val,triggerChange=false,data=null,self=this,oldData=this.data();if(arguments.length===0){return this.opts.element.val();}
val=arguments[0];if(arguments.length>1){triggerChange=arguments[1];}
if(this.select){this.select.val(val).find("option").filter(function(){return this.selected}).each2(function(i,elm){data=self.optionToData(elm);return false;});this.updateSelection(data);this.setPlaceholder();if(triggerChange){this.triggerChange({added:data,removed:oldData});}}else{if(!val&&val!==0){this.clear(triggerChange);return;}
if(this.opts.initSelection===undefined){throw new Error("cannot call val() if initSelection() is not defined");}
this.opts.element.val(val);this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(!data?"":self.id(data));self.updateSelection(data);self.setPlaceholder();if(triggerChange){self.triggerChange({added:data,removed:oldData});}});}},clearSearch:function(){this.search.val("");this.focusser.val("");},data:function(value){var data,triggerChange=false;if(arguments.length===0){data=this.selection.data("select2-data");if(data==undefined)data=null;return data;}else{if(arguments.length>1){triggerChange=arguments[1];}
if(!value){this.clear(triggerChange);}else{data=this.data();this.opts.element.val(!value?"":this.id(value));this.updateSelection(value);if(triggerChange){this.triggerChange({added:value,removed:data});}}}}});MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <label for='' class='select2-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var data=[];element.find("option").filter(function(){return this.selected&&!this.disabled}).each2(function(i,elm){data.push(self.optionToData(elm));});callback(data);};}else if("data"in opts){opts.initSelection=opts.initSelection||function(element,callback){var ids=splitVal(element.val(),opts.separator);var matches=[];opts.query({matcher:function(term,text,el){var is_match=$.grep(ids,function(id){return equal(id,opts.id(el));}).length;if(is_match){matches.push(el);}
return is_match;},callback:!$.isFunction(callback)?$.noop:function(){var ordered=[];for(var i=0;i<ids.length;i++){var id=ids[i];for(var j=0;j<matches.length;j++){var match=matches[j];if(equal(id,opts.id(match))){ordered.push(match);matches.splice(j,1);break;}}}
callback(ordered);}});};}
return opts;},selectChoice:function(choice){var selected=this.container.find(".select2-search-choice-focus");if(selected.length&&choice&&choice[0]==selected[0]){}else{if(selected.length){this.opts.element.trigger("choice-deselected",selected);}
selected.removeClass("select2-search-choice-focus");if(choice&&choice.length){this.close();choice.addClass("select2-search-choice-focus");this.opts.element.trigger("choice-selected",choice);}}},destroy:function(){$("label[for='"+this.search.attr('id')+"']").attr('for',this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments);cleanupJQueryElements.call(this,"searchContainer","selection");},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field");this.selection=selection=this.container.find(selector);var _this=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(e){_this.search[0].focus();_this.selectChoice($(this));});this.search.attr("id","s2id_autogen"+nextUid());this.search.prev().text($("label[for='"+this.opts.element.attr("id")+"']").text()).attr('for',this.search.attr('id'));this.search.on("input paste",this.bind(function(){if(this.search.attr('placeholder')&&this.search.val().length==0)return;if(!this.isInterfaceEnabled())return;if(!this.opened()){this.open();}}));this.search.attr("tabindex",this.elementTabIndex);this.keydowns=0;this.search.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;++this.keydowns;var selected=selection.find(".select2-search-choice-focus");var prev=selected.prev(".select2-search-choice:not(.select2-locked)");var next=selected.next(".select2-search-choice:not(.select2-locked)");var pos=getCursorInfo(this.search);if(selected.length&&(e.which==KEY.LEFT||e.which==KEY.RIGHT||e.which==KEY.BACKSPACE||e.which==KEY.DELETE||e.which==KEY.ENTER)){var selectedChoice=selected;if(e.which==KEY.LEFT&&prev.length){selectedChoice=prev;}
else if(e.which==KEY.RIGHT){selectedChoice=next.length?next:null;}
else if(e.which===KEY.BACKSPACE){if(this.unselect(selected.first())){this.search.width(10);selectedChoice=prev.length?prev:next;}}else if(e.which==KEY.DELETE){if(this.unselect(selected.first())){this.search.width(10);selectedChoice=next.length?next:null;}}else if(e.which==KEY.ENTER){selectedChoice=null;}
this.selectChoice(selectedChoice);killEvent(e);if(!selectedChoice||!selectedChoice.length){this.open();}
return;}else if(((e.which===KEY.BACKSPACE&&this.keydowns==1)||e.which==KEY.LEFT)&&(pos.offset==0&&!pos.length)){this.selectChoice(selection.find(".select2-search-choice:not(.select2-locked)").last());killEvent(e);return;}else{this.selectChoice(null);}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.TAB:this.selectHighlighted({noFocus:true});this.close();return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.BACKSPACE||e.which===KEY.ESC){return;}
if(e.which===KEY.ENTER){if(this.opts.openOnEnter===false){return;}else if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return;}}
this.open();if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);}
if(e.which===KEY.ENTER){killEvent(e);}}));this.search.on("keyup",this.bind(function(e){this.keydowns=0;this.resizeSearch();}));this.search.on("blur",this.bind(function(e){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");this.selectChoice(null);if(!this.opened())this.clearSearch();e.stopImmediatePropagation();this.opts.element.trigger($.Event("select2-blur"));}));this.container.on("click",selector,this.bind(function(e){if(!this.isInterfaceEnabled())return;if($(e.target).closest(".select2-search-choice").length>0){return;}
this.selectChoice(null);this.clearPlaceholder();if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.open();this.focusSearch();e.preventDefault();}));this.container.on("focus",selector,this.bind(function(){if(!this.isInterfaceEnabled())return;if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder();}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.clearSearch();},enableInterface:function(){if(this.parent.enableInterface.apply(this,arguments)){this.search.prop("disabled",!this.isInterfaceEnabled());}},initSelection:function(){var data;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.updateSelection([]);this.close();this.clearSearch();}
if(this.select||this.opts.element.val()!==""){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){if(data!==undefined&&data!==null){self.updateSelection(data);self.close();self.clearSearch();}});}},clearSearch:function(){var placeholder=this.getPlaceholder(),maxWidth=this.getMaxSearchWidth();if(placeholder!==undefined&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(placeholder).addClass("select2-default");this.search.width(maxWidth>0?maxWidth:this.container.css("width"));}else{this.search.val("").width(10);}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default");}},opening:function(){this.clearPlaceholder();this.resizeSearch();this.parent.opening.apply(this,arguments);this.focusSearch();if(this.search.val()===""){if(this.nextSearchTerm!=undefined){this.search.val(this.nextSearchTerm);this.search.select();}}
this.updateResults(true);if(this.opts.shouldFocusInput(this)){this.search.focus();}
this.opts.element.trigger($.Event("select2-open"));},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);},focus:function(){this.close();this.search.focus();},isFocused:function(){return this.search.hasClass("select2-focused");},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){if(indexOf(self.id(this),ids)<0){ids.push(self.id(this));filtered.push(this);}});data=filtered;this.selection.find(".select2-search-choice").remove();$(data).each(function(){self.addSelectedChoice(this);});self.postprocessResults();},tokenize:function(){var input=this.search.val();input=this.opts.tokenizer.call(this,input,this.data(),this.bind(this.onSelect),this.opts);if(input!=null&&input!=undefined){this.search.val(input);if(input.length>0){this.open();}}},onSelect:function(data,options){if(!this.triggerSelect(data)||data.text===""){return;}
this.addSelectedChoice(data);this.opts.element.trigger({type:"selected",val:this.id(data),choice:data});this.nextSearchTerm=this.opts.nextSearchTerm(data,this.search.val());this.clearSearch();this.updateResults();if(this.select||!this.opts.closeOnSelect)this.postprocessResults(data,false,this.opts.closeOnSelect===true);if(this.opts.closeOnSelect){this.close();this.search.width(10);}else{if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();if(this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()){this.updateResults(true);}else{if(this.nextSearchTerm!=undefined){this.search.val(this.nextSearchTerm);this.updateResults();this.search.select();}}
this.positionDropdown();}else{this.close();this.search.width(10);}}
this.triggerChange({added:data});if(!options||!options.noFocus)
this.focusSearch();},cancel:function(){this.close();this.focusSearch();},addSelectedChoice:function(data){var enableChoice=!data.locked,enabledItem=$("<li class='select2-search-choice'>"+"    <div></div>"+"    <a href='#' class='select2-search-choice-close' tabindex='-1'></a>"+"</li>"),disabledItem=$("<li class='select2-search-choice select2-locked'>"+"<div></div>"+"</li>");var choice=enableChoice?enabledItem:disabledItem,id=this.id(data),val=this.getVal(),formatted,cssClass;formatted=this.opts.formatSelection(data,choice.find("div"),this.opts.escapeMarkup);if(formatted!=undefined){choice.find("div").replaceWith("<div>"+formatted+"</div>");}
cssClass=this.opts.formatSelectionCssClass(data,choice.find("div"));if(cssClass!=undefined){choice.addClass(cssClass);}
if(enableChoice){choice.find(".select2-search-choice-close").on("mousedown",killEvent).on("click dblclick",this.bind(function(e){if(!this.isInterfaceEnabled())return;this.unselect($(e.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");killEvent(e);this.close();this.focusSearch();})).on("focus",this.bind(function(){if(!this.isInterfaceEnabled())return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");}));}
choice.data("select2-data",data);choice.insertBefore(this.searchContainer);val.push(id);this.setVal(val);},unselect:function(selected){var val=this.getVal(),data,index;selected=selected.closest(".select2-search-choice");if(selected.length===0){throw"Invalid argument: "+selected+". Must be .select2-search-choice";}
data=selected.data("select2-data");if(!data){return;}
var evt=$.Event("select2-removing");evt.val=this.id(data);evt.choice=data;this.opts.element.trigger(evt);if(evt.isDefaultPrevented()){return false;}
while((index=indexOf(this.id(data),val))>=0){val.splice(index,1);this.setVal(val);if(this.select)this.postprocessResults();}
selected.remove();this.opts.element.trigger({type:"select2-removed",val:this.id(data),choice:data});this.triggerChange({removed:data});return true;},postprocessResults:function(data,initial,noHighlightUpdate){var val=this.getVal(),choices=this.results.find(".select2-result"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));if(indexOf(id,val)>=0){choice.addClass("select2-selected");choice.find(".select2-result-selectable").addClass("select2-selected");}});compound.each2(function(i,choice){if(!choice.is('.select2-result-selectable')&&choice.find(".select2-result-selectable:not(.select2-selected)").length===0){choice.addClass("select2-selected");}});if(this.highlight()==-1&&noHighlightUpdate!==false){self.highlight(0);}
if(!this.opts.createSearchChoice&&!choices.filter('.select2-result:not(.select2-selected)').length>0){if(!data||data&&!data.more&&this.results.find(".select2-no-results").length===0){if(checkFormatter(self.opts.formatNoMatches,"formatNoMatches")){this.results.append("<li class='select2-no-results'>"+evaluate(self.opts.formatNoMatches,self.opts.element,self.search.val())+"</li>");}}}},getMaxSearchWidth:function(){return this.selection.width()-getSideBorderPadding(this.search);},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10;left=this.search.offset().left;maxWidth=this.selection.width();containerLeft=this.selection.offset().left;searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding;if(searchWidth<minimumWidth){searchWidth=maxWidth-sideBorderPadding;}
if(searchWidth<40){searchWidth=maxWidth-sideBorderPadding;}
if(searchWidth<=0){searchWidth=minimumWidth;}
this.search.width(Math.floor(searchWidth));},getVal:function(){var val;if(this.select){val=this.select.val();return val===null?[]:val;}else{val=this.opts.element.val();return splitVal(val,this.opts.separator);}},setVal:function(val){var unique;if(this.select){this.select.val(val);}else{unique=[];$(val).each(function(){if(indexOf(this,unique)<0)unique.push(this);});this.opts.element.val(unique.length===0?"":unique.join(this.opts.separator));}},buildChangeDetails:function(old,current){var current=current.slice(0),old=old.slice(0);for(var i=0;i<current.length;i++){for(var j=0;j<old.length;j++){if(equal(this.opts.id(current[i]),this.opts.id(old[j]))){current.splice(i,1);if(i>0){i--;}
old.splice(j,1);j--;}}}
return{added:current,removed:old};},val:function(val,triggerChange){var oldData,self=this;if(arguments.length===0){return this.getVal();}
oldData=this.data();if(!oldData.length)oldData=[];if(!val&&val!==0){this.opts.element.val("");this.updateSelection([]);this.clearSearch();if(triggerChange){this.triggerChange({added:this.data(),removed:oldData});}
return;}
this.setVal(val);if(this.select){this.opts.initSelection(this.select,this.bind(this.updateSelection));if(triggerChange){this.triggerChange(this.buildChangeDetails(oldData,this.data()));}}else{if(this.opts.initSelection===undefined){throw new Error("val() cannot be called if initSelection() is not defined");}
this.opts.initSelection(this.opts.element,function(data){var ids=$.map(data,self.id);self.setVal(ids);self.updateSelection(data);self.clearSearch();if(triggerChange){self.triggerChange(self.buildChangeDetails(oldData,self.data()));}});}
this.clearSearch();},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");}
this.search.width(0);this.searchContainer.hide();},onSortEnd:function(){var val=[],self=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")));});this.setVal(val);this.triggerChange();},data:function(values,triggerChange){var self=this,ids,old;if(arguments.length===0){return this.selection.children(".select2-search-choice").map(function(){return $(this).data("select2-data");}).get();}else{old=this.data();if(!values){values=[];}
ids=$.map(values,function(e){return self.opts.id(e);});this.setVal(ids);this.updateSelection(values);this.clearSearch();if(triggerChange){this.triggerChange(this.buildChangeDetails(old,this.data()));}}}});$.fn.select2=function(){var args=Array.prototype.slice.call(arguments,0),opts,select2,method,value,multiple,allowedMethods=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],valueMethods=["opened","isFocused","container","dropdown"],propertyMethods=["val","data"],methodsMap={search:"externalSearch"};this.each(function(){if(args.length===0||typeof(args[0])==="object"){opts=args.length===0?{}:$.extend({},args[0]);opts.element=$(this);if(opts.element.get(0).tagName.toLowerCase()==="select"){multiple=opts.element.prop("multiple");}else{multiple=opts.multiple||false;if("tags"in opts){opts.multiple=multiple=true;}}
select2=multiple?new window.Select2["class"].multi():new window.Select2["class"].single();select2.init(opts);}else if(typeof(args[0])==="string"){if(indexOf(args[0],allowedMethods)<0){throw"Unknown method: "+args[0];}
value=undefined;select2=$(this).data("select2");if(select2===undefined)return;method=args[0];if(method==="container"){value=select2.container;}else if(method==="dropdown"){value=select2.dropdown;}else{if(methodsMap[method])method=methodsMap[method];value=select2[method].apply(select2,args.slice(1));}
if(indexOf(args[0],valueMethods)>=0||(indexOf(args[0],propertyMethods)>=0&&args.length==1)){return false;}}else{throw"Invalid arguments to select2 plugin: "+args;}});return(value===undefined)?this:value;};$.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:true,openOnEnter:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query,escapeMarkup){var markup=[];markMatch(result.text,query.term,markup,escapeMarkup);return markup.join("");},formatSelection:function(data,container,escapeMarkup){return data?escapeMarkup(data.text):undefined;},sortResults:function(results,container,query){return results;},formatResultCssClass:function(data){return data.css;},formatSelectionCssClass:function(data,container){return undefined;},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e==undefined?null:e.id;},matcher:function(term,text){return stripDiacritics(''+text).toUpperCase().indexOf(stripDiacritics(''+term).toUpperCase())>=0;},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:defaultEscapeMarkup,blurOnChange:false,selectOnBlur:false,adaptContainerCssClass:function(c){return c;},adaptDropdownCssClass:function(c){return null;},nextSearchTerm:function(selectedObject,currentSearchTerm){return undefined;},searchInputPlaceholder:'',createSearchChoicePosition:'top',shouldFocusInput:function(instance){var supportsTouchEvents=(('ontouchstart'in window)||(navigator.msMaxTouchPoints>0));if(!supportsTouchEvents){return true;}
if(instance.opts.minimumResultsForSearch<0){return false;}
return true;}};$.fn.select2.locales=[];$.fn.select2.locales['en']={formatMatches:function(matches){if(matches===1){return"One result is available, press enter to select it.";}return matches+" results are available, use up and down arrow keys to navigate.";},formatNoMatches:function(){return"No matches found";},formatAjaxError:function(jqXHR,textStatus,errorThrown){return"Loading failed";},formatInputTooShort:function(input,min){var n=min-input.length;return"Please enter "+n+" or more character"+(n==1?"":"s");},formatInputTooLong:function(input,max){var n=input.length-max;return"Please delete "+n+" character"+(n==1?"":"s");},formatSelectionTooBig:function(limit){return"You can only select "+limit+" item"+(limit==1?"":"s");},formatLoadMore:function(pageNumber){return"Loading more results…";},formatSearching:function(){return"Searching…";},};$.extend($.fn.select2.defaults,$.fn.select2.locales['en']);$.fn.select2.ajaxDefaults={transport:$.ajax,params:{type:"GET",cache:false,dataType:"json"}};window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch,escapeMarkup:defaultEscapeMarkup,stripDiacritics:stripDiacritics},"class":{"abstract":AbstractSelect2,"single":SingleSelect2,"multi":MultiSelect2}};}(jQuery));;

/* /web/static/lib/bootstrap/js/bootstrap.js defined in bundle 'web.assets_backend' */
if(typeof jQuery==='undefined'){throw new Error('Bootstrap\'s JavaScript requires jQuery')}
+function($){'use strict';function transitionEnd(){var el=document.createElement('bootstrap')
var transEndEventNames={WebkitTransition:'webkitTransitionEnd',MozTransition:'transitionend',OTransition:'oTransitionEnd otransitionend',transition:'transitionend'}
for(var name in transEndEventNames){if(el.style[name]!==undefined){return{end:transEndEventNames[name]}}}
return false}
$.fn.emulateTransitionEnd=function(duration){var called=false
var $el=this
$(this).one('bsTransitionEnd',function(){called=true})
var callback=function(){if(!called)$($el).trigger($.support.transition.end)}
setTimeout(callback,duration)
return this}
$(function(){$.support.transition=transitionEnd()
if(!$.support.transition)return
$.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){if($(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}}})}(jQuery);+function($){'use strict';var dismiss='[data-dismiss="alert"]'
var Alert=function(el){$(el).on('click',dismiss,this.close)}
Alert.VERSION='3.2.0'
Alert.prototype.close=function(e){var $this=$(this)
var selector=$this.attr('data-target')
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
var $parent=$(selector)
if(e)e.preventDefault()
if(!$parent.length){$parent=$this.hasClass('alert')?$this:$this.parent()}
$parent.trigger(e=$.Event('close.bs.alert'))
if(e.isDefaultPrevented())return
$parent.removeClass('in')
function removeElement(){$parent.detach().trigger('closed.bs.alert').remove()}
$.support.transition&&$parent.hasClass('fade')?$parent.one('bsTransitionEnd',removeElement).emulateTransitionEnd(150):removeElement()}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.alert')
if(!data)$this.data('bs.alert',(data=new Alert(this)))
if(typeof option=='string')data[option].call($this)})}
var old=$.fn.alert
$.fn.alert=Plugin
$.fn.alert.Constructor=Alert
$.fn.alert.noConflict=function(){$.fn.alert=old
return this}
$(document).on('click.bs.alert.data-api',dismiss,Alert.prototype.close)}(jQuery);+function($){'use strict';var Button=function(element,options){this.$element=$(element)
this.options=$.extend({},Button.DEFAULTS,options)
this.isLoading=false}
Button.VERSION='3.2.0'
Button.DEFAULTS={loadingText:'loading...'}
Button.prototype.setState=function(state){var d='disabled'
var $el=this.$element
var val=$el.is('input')?'val':'html'
var data=$el.data()
state=state+'Text'
if(data.resetText==null)$el.data('resetText',$el[val]())
$el[val](data[state]==null?this.options[state]:data[state])
setTimeout($.proxy(function(){if(state=='loadingText'){this.isLoading=true
$el.addClass(d).attr(d,d)}else if(this.isLoading){this.isLoading=false
$el.removeClass(d).removeAttr(d)}},this),0)}
Button.prototype.toggle=function(){var changed=true
var $parent=this.$element.closest('[data-toggle="buttons"]')
if($parent.length){var $input=this.$element.find('input')
if($input.prop('type')=='radio'){if($input.prop('checked')&&this.$element.hasClass('active'))changed=false
else $parent.find('.active').removeClass('active')}
if(changed)$input.prop('checked',!this.$element.hasClass('active')).trigger('change')}
if(changed)this.$element.toggleClass('active')}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.button')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.button',(data=new Button(this,options)))
if(option=='toggle')data.toggle()
else if(option)data.setState(option)})}
var old=$.fn.button
$.fn.button=Plugin
$.fn.button.Constructor=Button
$.fn.button.noConflict=function(){$.fn.button=old
return this}
$(document).on('click.bs.button.data-api','[data-toggle^="button"]',function(e){var $btn=$(e.target)
if(!$btn.hasClass('btn'))$btn=$btn.closest('.btn')
Plugin.call($btn,'toggle')
e.preventDefault()})}(jQuery);+function($){'use strict';var Carousel=function(element,options){this.$element=$(element).on('keydown.bs.carousel',$.proxy(this.keydown,this))
this.$indicators=this.$element.find('.carousel-indicators')
this.options=options
this.paused=this.sliding=this.interval=this.$active=this.$items=null
this.options.pause=='hover'&&this.$element.on('mouseenter.bs.carousel',$.proxy(this.pause,this)).on('mouseleave.bs.carousel',$.proxy(this.cycle,this))}
Carousel.VERSION='3.2.0'
Carousel.DEFAULTS={interval:5000,pause:'hover',wrap:true}
Carousel.prototype.keydown=function(e){switch(e.which){case 37:this.prev();break
case 39:this.next();break
default:return}
e.preventDefault()}
Carousel.prototype.cycle=function(e){e||(this.paused=false)
this.interval&&clearInterval(this.interval)
this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval))
return this}
Carousel.prototype.getItemIndex=function(item){this.$items=item.parent().children('.item')
return this.$items.index(item||this.$active)}
Carousel.prototype.to=function(pos){var that=this
var activeIndex=this.getItemIndex(this.$active=this.$element.find('.item.active'))
if(pos>(this.$items.length-1)||pos<0)return
if(this.sliding)return this.$element.one('slid.bs.carousel',function(){that.to(pos)})
if(activeIndex==pos)return this.pause().cycle()
return this.slide(pos>activeIndex?'next':'prev',$(this.$items[pos]))}
Carousel.prototype.pause=function(e){e||(this.paused=true)
if(this.$element.find('.next, .prev').length&&$.support.transition){this.$element.trigger($.support.transition.end)
this.cycle(true)}
this.interval=clearInterval(this.interval)
return this}
Carousel.prototype.next=function(){if(this.sliding)return
return this.slide('next')}
Carousel.prototype.prev=function(){if(this.sliding)return
return this.slide('prev')}
Carousel.prototype.slide=function(type,next){var $active=this.$element.find('.item.active')
var $next=next||$active[type]()
var isCycling=this.interval
var direction=type=='next'?'left':'right'
var fallback=type=='next'?'first':'last'
var that=this
if(!$next.length){if(!this.options.wrap)return
$next=this.$element.find('.item')[fallback]()}
if($next.hasClass('active'))return(this.sliding=false)
var relatedTarget=$next[0]
var slideEvent=$.Event('slide.bs.carousel',{relatedTarget:relatedTarget,direction:direction})
this.$element.trigger(slideEvent)
if(slideEvent.isDefaultPrevented())return
this.sliding=true
isCycling&&this.pause()
if(this.$indicators.length){this.$indicators.find('.active').removeClass('active')
var $nextIndicator=$(this.$indicators.children()[this.getItemIndex($next)])
$nextIndicator&&$nextIndicator.addClass('active')}
var slidEvent=$.Event('slid.bs.carousel',{relatedTarget:relatedTarget,direction:direction})
if($.support.transition&&this.$element.hasClass('slide')){$next.addClass(type)
$next[0].offsetWidth
$active.addClass(direction)
$next.addClass(direction)
$active.one('bsTransitionEnd',function(){$next.removeClass([type,direction].join(' ')).addClass('active')
$active.removeClass(['active',direction].join(' '))
that.sliding=false
setTimeout(function(){that.$element.trigger(slidEvent)},0)}).emulateTransitionEnd($active.css('transition-duration').slice(0,-1)*1000)}else{$active.removeClass('active')
$next.addClass('active')
this.sliding=false
this.$element.trigger(slidEvent)}
isCycling&&this.cycle()
return this}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.carousel')
var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=='object'&&option)
var action=typeof option=='string'?option:options.slide
if(!data)$this.data('bs.carousel',(data=new Carousel(this,options)))
if(typeof option=='number')data.to(option)
else if(action)data[action]()
else if(options.interval)data.pause().cycle()})}
var old=$.fn.carousel
$.fn.carousel=Plugin
$.fn.carousel.Constructor=Carousel
$.fn.carousel.noConflict=function(){$.fn.carousel=old
return this}
$(document).on('click.bs.carousel.data-api','[data-slide], [data-slide-to]',function(e){var href
var $this=$(this)
var $target=$($this.attr('data-target')||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''))
if(!$target.hasClass('carousel'))return
var options=$.extend({},$target.data(),$this.data())
var slideIndex=$this.attr('data-slide-to')
if(slideIndex)options.interval=false
Plugin.call($target,options)
if(slideIndex){$target.data('bs.carousel').to(slideIndex)}
e.preventDefault()})
$(window).on('load',function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this)
Plugin.call($carousel,$carousel.data())})})}(jQuery);+function($){'use strict';var Collapse=function(element,options){this.$element=$(element)
this.options=$.extend({},Collapse.DEFAULTS,options)
this.transitioning=null
if(this.options.parent)this.$parent=$(this.options.parent)
if(this.options.toggle)this.toggle()}
Collapse.VERSION='3.2.0'
Collapse.DEFAULTS={toggle:true}
Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass('width')
return hasWidth?'width':'height'}
Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass('in'))return
var startEvent=$.Event('show.bs.collapse')
this.$element.trigger(startEvent)
if(startEvent.isDefaultPrevented())return
var actives=this.$parent&&this.$parent.find('> .panel > .in')
if(actives&&actives.length){var hasData=actives.data('bs.collapse')
if(hasData&&hasData.transitioning)return
Plugin.call(actives,'hide')
hasData||actives.data('bs.collapse',null)}
var dimension=this.dimension()
this.$element.removeClass('collapse').addClass('collapsing')[dimension](0)
this.transitioning=1
var complete=function(){this.$element.removeClass('collapsing').addClass('collapse in')[dimension]('')
this.transitioning=0
this.$element.trigger('shown.bs.collapse')}
if(!$.support.transition)return complete.call(this)
var scrollSize=$.camelCase(['scroll',dimension].join('-'))
this.$element.one('bsTransitionEnd',$.proxy(complete,this)).emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize])}
Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass('in'))return
var startEvent=$.Event('hide.bs.collapse')
this.$element.trigger(startEvent)
if(startEvent.isDefaultPrevented())return
var dimension=this.dimension()
this.$element[dimension](this.$element[dimension]())[0].offsetHeight
this.$element.addClass('collapsing').removeClass('collapse').removeClass('in')
this.transitioning=1
var complete=function(){this.transitioning=0
this.$element.trigger('hidden.bs.collapse').removeClass('collapsing').addClass('collapse')}
if(!$.support.transition)return complete.call(this)
this.$element
[dimension](0).one('bsTransitionEnd',$.proxy(complete,this)).emulateTransitionEnd(350)}
Collapse.prototype.toggle=function(){this[this.$element.hasClass('in')?'hide':'show']()}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.collapse')
var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=='object'&&option)
if(!data&&options.toggle&&option=='show')option=!option
if(!data)$this.data('bs.collapse',(data=new Collapse(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.collapse
$.fn.collapse=Plugin
$.fn.collapse.Constructor=Collapse
$.fn.collapse.noConflict=function(){$.fn.collapse=old
return this}
$(document).on('click.bs.collapse.data-api','[data-toggle="collapse"]',function(e){var href
var $this=$(this)
var target=$this.attr('data-target')||e.preventDefault()||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,'')
var $target=$(target)
var data=$target.data('bs.collapse')
var option=data?'toggle':$this.data()
var parent=$this.attr('data-parent')
var $parent=parent&&$(parent)
if(!data||!data.transitioning){if($parent)$parent.find('[data-toggle="collapse"][data-parent="'+parent+'"]').not($this).addClass('collapsed')
$this[$target.hasClass('in')?'addClass':'removeClass']('collapsed')}
Plugin.call($target,option)})}(jQuery);+function($){'use strict';var backdrop='.dropdown-backdrop'
var toggle='[data-toggle="dropdown"]'
var Dropdown=function(element){$(element).on('click.bs.dropdown',this.toggle)}
Dropdown.VERSION='3.2.0'
Dropdown.prototype.toggle=function(e){var $this=$(this)
if($this.is('.disabled, :disabled'))return
var $parent=getParent($this)
var isActive=$parent.hasClass('open')
clearMenus()
if(!isActive){if('ontouchstart'in document.documentElement&&!$parent.closest('.navbar-nav').length){$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on('click',clearMenus)}
var relatedTarget={relatedTarget:this}
$parent.trigger(e=$.Event('show.bs.dropdown',relatedTarget))
if(e.isDefaultPrevented())return
$this.trigger('focus')
$parent.toggleClass('open').trigger('shown.bs.dropdown',relatedTarget)}
return false}
Dropdown.prototype.keydown=function(e){if(!/(38|40|27)/.test(e.keyCode))return
var $this=$(this)
e.preventDefault()
e.stopPropagation()
if($this.is('.disabled, :disabled'))return
var $parent=getParent($this)
var isActive=$parent.hasClass('open')
if(!isActive||(isActive&&e.keyCode==27)){if(e.which==27)$parent.find(toggle).trigger('focus')
return $this.trigger('click')}
var desc=' li:not(.divider):visible a'
var $items=$parent.find('[role="menu"]'+desc+', [role="listbox"]'+desc)
if(!$items.length)return
var index=$items.index($items.filter(':focus'))
if(e.keyCode==38&&index>0)index--
if(e.keyCode==40&&index<$items.length-1)index++
if(!~index)index=0
$items.eq(index).trigger('focus')}
function clearMenus(e){if(e&&e.which===3)return
$(backdrop).remove()
$(toggle).each(function(){var $parent=getParent($(this))
var relatedTarget={relatedTarget:this}
if(!$parent.hasClass('open'))return
$parent.trigger(e=$.Event('hide.bs.dropdown',relatedTarget))
if(e.isDefaultPrevented())return
$parent.removeClass('open').trigger('hidden.bs.dropdown',relatedTarget)})}
function getParent($this){var selector=$this.attr('data-target')
if(!selector){selector=$this.attr('href')
selector=selector&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,'')}
var $parent=selector&&$(selector)
return $parent&&$parent.length?$parent:$this.parent()}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.dropdown')
if(!data)$this.data('bs.dropdown',(data=new Dropdown(this)))
if(typeof option=='string')data[option].call($this)})}
var old=$.fn.dropdown
$.fn.dropdown=Plugin
$.fn.dropdown.Constructor=Dropdown
$.fn.dropdown.noConflict=function(){$.fn.dropdown=old
return this}
$(document).on('click.bs.dropdown.data-api',clearMenus).on('click.bs.dropdown.data-api','.dropdown form',function(e){e.stopPropagation()}).on('click.bs.dropdown.data-api',toggle,Dropdown.prototype.toggle).on('keydown.bs.dropdown.data-api',toggle+', [role="menu"], [role="listbox"]',Dropdown.prototype.keydown)}(jQuery);+function($){'use strict';var Modal=function(element,options){this.options=options
this.$body=$(document.body)
this.$element=$(element)
this.$backdrop=this.isShown=null
this.scrollbarWidth=0
if(this.options.remote){this.$element.find('.modal-content').load(this.options.remote,$.proxy(function(){this.$element.trigger('loaded.bs.modal')},this))}}
Modal.VERSION='3.2.0'
Modal.DEFAULTS={backdrop:true,keyboard:true,show:true}
Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)}
Modal.prototype.show=function(_relatedTarget){var that=this
var e=$.Event('show.bs.modal',{relatedTarget:_relatedTarget})
this.$element.trigger(e)
if(this.isShown||e.isDefaultPrevented())return
this.isShown=true
this.checkScrollbar()
this.$body.addClass('modal-open')
this.setScrollbar()
this.escape()
this.$element.on('click.dismiss.bs.modal','[data-dismiss="modal"]',$.proxy(this.hide,this))
this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass('fade')
if(!that.$element.parent().length){that.$element.appendTo(that.$body)}
that.$element.show().scrollTop(0)
if(transition){that.$element[0].offsetWidth}
that.$element.addClass('in').attr('aria-hidden',false)
that.enforceFocus()
var e=$.Event('shown.bs.modal',{relatedTarget:_relatedTarget})
transition?that.$element.find('.modal-dialog').one('bsTransitionEnd',function(){that.$element.trigger('focus').trigger(e)}).emulateTransitionEnd(300):that.$element.trigger('focus').trigger(e)})}
Modal.prototype.hide=function(e){if(e)e.preventDefault()
e=$.Event('hide.bs.modal')
this.$element.trigger(e)
if(!this.isShown||e.isDefaultPrevented())return
this.isShown=false
this.$body.removeClass('modal-open')
this.resetScrollbar()
this.escape()
$(document).off('focusin.bs.modal')
this.$element.removeClass('in').attr('aria-hidden',true).off('click.dismiss.bs.modal')
$.support.transition&&this.$element.hasClass('fade')?this.$element.one('bsTransitionEnd',$.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal()}
Modal.prototype.enforceFocus=function(){$(document).off('focusin.bs.modal').on('focusin.bs.modal',$.proxy(function(e){if(this.$element[0]!==e.target&&!this.$element.has(e.target).length){this.$element.trigger('focus')}},this))}
Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard){this.$element.on('keyup.dismiss.bs.modal',$.proxy(function(e){e.which==27&&this.hide()},this))}else if(!this.isShown){this.$element.off('keyup.dismiss.bs.modal')}}
Modal.prototype.hideModal=function(){var that=this
this.$element.hide()
this.backdrop(function(){that.$element.trigger('hidden.bs.modal')})}
Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove()
this.$backdrop=null}
Modal.prototype.backdrop=function(callback){var that=this
var animate=this.$element.hasClass('fade')?'fade':''
if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate
this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(this.$body)
this.$element.on('click.dismiss.bs.modal',$.proxy(function(e){if(e.target!==e.currentTarget)return
this.options.backdrop=='static'?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this))
if(doAnimate)this.$backdrop[0].offsetWidth
this.$backdrop.addClass('in')
if(!callback)return
doAnimate?this.$backdrop.one('bsTransitionEnd',callback).emulateTransitionEnd(150):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass('in')
var callbackRemove=function(){that.removeBackdrop()
callback&&callback()}
$.support.transition&&this.$element.hasClass('fade')?this.$backdrop.one('bsTransitionEnd',callbackRemove).emulateTransitionEnd(150):callbackRemove()}else if(callback){callback()}}
Modal.prototype.checkScrollbar=function(){if(document.body.clientWidth>=window.innerWidth)return
this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar()}
Modal.prototype.setScrollbar=function(){var bodyPad=parseInt((this.$body.css('padding-right')||0),10)
if(this.scrollbarWidth)this.$body.css('padding-right',bodyPad+this.scrollbarWidth)}
Modal.prototype.resetScrollbar=function(){this.$body.css('padding-right','')}
Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement('div')
scrollDiv.className='modal-scrollbar-measure'
this.$body.append(scrollDiv)
var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth
this.$body[0].removeChild(scrollDiv)
return scrollbarWidth}
function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this)
var data=$this.data('bs.modal')
var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=='object'&&option)
if(!data)$this.data('bs.modal',(data=new Modal(this,options)))
if(typeof option=='string')data[option](_relatedTarget)
else if(options.show)data.show(_relatedTarget)})}
var old=$.fn.modal
$.fn.modal=Plugin
$.fn.modal.Constructor=Modal
$.fn.modal.noConflict=function(){$.fn.modal=old
return this}
$(document).on('click.bs.modal.data-api','[data-toggle="modal"]',function(e){var $this=$(this)
var href=$this.attr('href')
var $target=$($this.attr('data-target')||(href&&href.replace(/.*(?=#[^\s]+$)/,'')))
var option=$target.data('bs.modal')?'toggle':$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data())
if($this.is('a'))e.preventDefault()
$target.one('show.bs.modal',function(showEvent){if(showEvent.isDefaultPrevented())return
$target.one('hidden.bs.modal',function(){$this.is(':visible')&&$this.trigger('focus')})})
Plugin.call($target,option,this)})}(jQuery);+function($){'use strict';var Tooltip=function(element,options){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null
this.init('tooltip',element,options)}
Tooltip.VERSION='3.2.0'
Tooltip.DEFAULTS={animation:true,placement:'top',selector:false,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:'hover focus',title:'',delay:0,html:false,container:false,viewport:{selector:'body',padding:0}}
Tooltip.prototype.init=function(type,element,options){this.enabled=true
this.type=type
this.$element=$(element)
this.options=this.getOptions(options)
this.$viewport=this.options.viewport&&$(this.options.viewport.selector||this.options.viewport)
var triggers=this.options.trigger.split(' ')
for(var i=triggers.length;i--;){var trigger=triggers[i]
if(trigger=='click'){this.$element.on('click.'+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!='manual'){var eventIn=trigger=='hover'?'mouseenter':'focusin'
var eventOut=trigger=='hover'?'mouseleave':'focusout'
this.$element.on(eventIn+'.'+this.type,this.options.selector,$.proxy(this.enter,this))
this.$element.on(eventOut+'.'+this.type,this.options.selector,$.proxy(this.leave,this))}}
this.options.selector?(this._options=$.extend({},this.options,{trigger:'manual',selector:''})):this.fixTitle()}
Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS}
Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options)
if(options.delay&&typeof options.delay=='number'){options.delay={show:options.delay,hide:options.delay}}
return options}
Tooltip.prototype.getDelegateOptions=function(){var options={}
var defaults=this.getDefaults()
this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value})
return options}
Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data('bs.'+this.type)
if(!self){self=new this.constructor(obj.currentTarget,this.getDelegateOptions())
$(obj.currentTarget).data('bs.'+this.type,self)}
clearTimeout(self.timeout)
self.hoverState='in'
if(!self.options.delay||!self.options.delay.show)return self.show()
self.timeout=setTimeout(function(){if(self.hoverState=='in')self.show()},self.options.delay.show)}
Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data('bs.'+this.type)
if(!self){self=new this.constructor(obj.currentTarget,this.getDelegateOptions())
$(obj.currentTarget).data('bs.'+this.type,self)}
clearTimeout(self.timeout)
self.hoverState='out'
if(!self.options.delay||!self.options.delay.hide)return self.hide()
self.timeout=setTimeout(function(){if(self.hoverState=='out')self.hide()},self.options.delay.hide)}
Tooltip.prototype.show=function(){var e=$.Event('show.bs.'+this.type)
if(this.hasContent()&&this.enabled){this.$element.trigger(e)
var inDom=$.contains(document.documentElement,this.$element[0])
if(e.isDefaultPrevented()||!inDom)return
var that=this
var $tip=this.tip()
var tipId=this.getUID(this.type)
this.setContent()
$tip.attr('id',tipId)
this.$element.attr('aria-describedby',tipId)
if(this.options.animation)$tip.addClass('fade')
var placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement
var autoToken=/\s?auto?\s?/i
var autoPlace=autoToken.test(placement)
if(autoPlace)placement=placement.replace(autoToken,'')||'top'
$tip.detach().css({top:0,left:0,display:'block'}).addClass(placement).data('bs.'+this.type,this)
this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element)
var pos=this.getPosition()
var actualWidth=$tip[0].offsetWidth
var actualHeight=$tip[0].offsetHeight
if(autoPlace){var orgPlacement=placement
var $parent=this.$element.parent()
var parentDim=this.getPosition($parent)
placement=placement=='bottom'&&pos.top+pos.height+actualHeight-parentDim.scroll>parentDim.height?'top':placement=='top'&&pos.top-parentDim.scroll-actualHeight<0?'bottom':placement=='right'&&pos.right+actualWidth>parentDim.width?'left':placement=='left'&&pos.left-actualWidth<parentDim.left?'right':placement
$tip.removeClass(orgPlacement).addClass(placement)}
var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight)
this.applyPlacement(calculatedOffset,placement)
var complete=function(){that.$element.trigger('shown.bs.'+that.type)
that.hoverState=null}
$.support.transition&&this.$tip.hasClass('fade')?$tip.one('bsTransitionEnd',complete).emulateTransitionEnd(150):complete()}}
Tooltip.prototype.applyPlacement=function(offset,placement){var $tip=this.tip()
var width=$tip[0].offsetWidth
var height=$tip[0].offsetHeight
var marginTop=parseInt($tip.css('margin-top'),10)
var marginLeft=parseInt($tip.css('margin-left'),10)
if(isNaN(marginTop))marginTop=0
if(isNaN(marginLeft))marginLeft=0
offset.top=offset.top+marginTop
offset.left=offset.left+marginLeft
$.offset.setOffset($tip[0],$.extend({using:function(props){$tip.css({top:Math.round(props.top),left:Math.round(props.left)})}},offset),0)
$tip.addClass('in')
var actualWidth=$tip[0].offsetWidth
var actualHeight=$tip[0].offsetHeight
if(placement=='top'&&actualHeight!=height){offset.top=offset.top+height-actualHeight}
var delta=this.getViewportAdjustedDelta(placement,offset,actualWidth,actualHeight)
if(delta.left)offset.left+=delta.left
else offset.top+=delta.top
var arrowDelta=delta.left?delta.left*2-width+actualWidth:delta.top*2-height+actualHeight
var arrowPosition=delta.left?'left':'top'
var arrowOffsetPosition=delta.left?'offsetWidth':'offsetHeight'
$tip.offset(offset)
this.replaceArrow(arrowDelta,$tip[0][arrowOffsetPosition],arrowPosition)}
Tooltip.prototype.replaceArrow=function(delta,dimension,position){this.arrow().css(position,delta?(50*(1-delta/dimension)+'%'):'')}
Tooltip.prototype.setContent=function(){var $tip=this.tip()
var title=this.getTitle()
$tip.find('.tooltip-inner')[this.options.html?'html':'text'](title)
$tip.removeClass('fade in top bottom left right')}
Tooltip.prototype.hide=function(){var that=this
var $tip=this.tip()
var e=$.Event('hide.bs.'+this.type)
this.$element.removeAttr('aria-describedby')
function complete(){if(that.hoverState!='in')$tip.detach()
that.$element.trigger('hidden.bs.'+that.type)}
this.$element.trigger(e)
if(e.isDefaultPrevented())return
$tip.removeClass('in')
$.support.transition&&this.$tip.hasClass('fade')?$tip.one('bsTransitionEnd',complete).emulateTransitionEnd(150):complete()
this.hoverState=null
return this}
Tooltip.prototype.fixTitle=function(){var $e=this.$element
if($e.attr('title')||typeof($e.attr('data-original-title'))!='string'){$e.attr('data-original-title',$e.attr('title')||'').attr('title','')}}
Tooltip.prototype.hasContent=function(){return this.getTitle()}
Tooltip.prototype.getPosition=function($element){$element=$element||this.$element
var el=$element[0]
var isBody=el.tagName=='BODY'
return $.extend({},(typeof el.getBoundingClientRect=='function')?el.getBoundingClientRect():null,{scroll:isBody?document.documentElement.scrollTop||document.body.scrollTop:$element.scrollTop(),width:isBody?$(window).width():$element.outerWidth(),height:isBody?$(window).height():$element.outerHeight()},isBody?{top:0,left:0}:$element.offset())}
Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return placement=='bottom'?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=='top'?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=='left'?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}}
Tooltip.prototype.getViewportAdjustedDelta=function(placement,pos,actualWidth,actualHeight){var delta={top:0,left:0}
if(!this.$viewport)return delta
var viewportPadding=this.options.viewport&&this.options.viewport.padding||0
var viewportDimensions=this.getPosition(this.$viewport)
if(/right|left/.test(placement)){var topEdgeOffset=pos.top-viewportPadding-viewportDimensions.scroll
var bottomEdgeOffset=pos.top+viewportPadding-viewportDimensions.scroll+actualHeight
if(topEdgeOffset<viewportDimensions.top){delta.top=viewportDimensions.top-topEdgeOffset}else if(bottomEdgeOffset>viewportDimensions.top+viewportDimensions.height){delta.top=viewportDimensions.top+viewportDimensions.height-bottomEdgeOffset}}else{var leftEdgeOffset=pos.left-viewportPadding
var rightEdgeOffset=pos.left+viewportPadding+actualWidth
if(leftEdgeOffset<viewportDimensions.left){delta.left=viewportDimensions.left-leftEdgeOffset}else if(rightEdgeOffset>viewportDimensions.width){delta.left=viewportDimensions.left+viewportDimensions.width-rightEdgeOffset}}
return delta}
Tooltip.prototype.getTitle=function(){var title
var $e=this.$element
var o=this.options
title=$e.attr('data-original-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title)
return title}
Tooltip.prototype.getUID=function(prefix){do prefix+=~~(Math.random()*1000000)
while(document.getElementById(prefix))
return prefix}
Tooltip.prototype.tip=function(){return(this.$tip=this.$tip||$(this.options.template))}
Tooltip.prototype.arrow=function(){return(this.$arrow=this.$arrow||this.tip().find('.tooltip-arrow'))}
Tooltip.prototype.validate=function(){if(!this.$element[0].parentNode){this.hide()
this.$element=null
this.options=null}}
Tooltip.prototype.enable=function(){this.enabled=true}
Tooltip.prototype.disable=function(){this.enabled=false}
Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled}
Tooltip.prototype.toggle=function(e){var self=this
if(e){self=$(e.currentTarget).data('bs.'+this.type)
if(!self){self=new this.constructor(e.currentTarget,this.getDelegateOptions())
$(e.currentTarget).data('bs.'+this.type,self)}}
self.tip().hasClass('in')?self.leave(self):self.enter(self)}
Tooltip.prototype.destroy=function(){clearTimeout(this.timeout)
this.hide().$element.off('.'+this.type).removeData('bs.'+this.type)}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.tooltip')
var options=typeof option=='object'&&option
if(!data&&option=='destroy')return
if(!data)$this.data('bs.tooltip',(data=new Tooltip(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.tooltip
$.fn.tooltip=Plugin
$.fn.tooltip.Constructor=Tooltip
$.fn.tooltip.noConflict=function(){$.fn.tooltip=old
return this}}(jQuery);+function($){'use strict';var Popover=function(element,options){this.init('popover',element,options)}
if(!$.fn.tooltip)throw new Error('Popover requires tooltip.js')
Popover.VERSION='3.2.0'
Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:'right',trigger:'click',content:'',template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})
Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype)
Popover.prototype.constructor=Popover
Popover.prototype.getDefaults=function(){return Popover.DEFAULTS}
Popover.prototype.setContent=function(){var $tip=this.tip()
var title=this.getTitle()
var content=this.getContent()
$tip.find('.popover-title')[this.options.html?'html':'text'](title)
$tip.find('.popover-content').empty()[this.options.html?(typeof content=='string'?'html':'append'):'text'](content)
$tip.removeClass('fade top bottom left right in')
if(!$tip.find('.popover-title').html())$tip.find('.popover-title').hide()}
Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()}
Popover.prototype.getContent=function(){var $e=this.$element
var o=this.options
return $e.attr('data-content')||(typeof o.content=='function'?o.content.call($e[0]):o.content)}
Popover.prototype.arrow=function(){return(this.$arrow=this.$arrow||this.tip().find('.arrow'))}
Popover.prototype.tip=function(){if(!this.$tip)this.$tip=$(this.options.template)
return this.$tip}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.popover')
var options=typeof option=='object'&&option
if(!data&&option=='destroy')return
if(!data)$this.data('bs.popover',(data=new Popover(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.popover
$.fn.popover=Plugin
$.fn.popover.Constructor=Popover
$.fn.popover.noConflict=function(){$.fn.popover=old
return this}}(jQuery);+function($){'use strict';function ScrollSpy(element,options){var process=$.proxy(this.process,this)
this.$body=$('body')
this.$scrollElement=$(element).is('body')?$(window):$(element)
this.options=$.extend({},ScrollSpy.DEFAULTS,options)
this.selector=(this.options.target||'')+' .nav li > a'
this.offsets=[]
this.targets=[]
this.activeTarget=null
this.scrollHeight=0
this.$scrollElement.on('scroll.bs.scrollspy',process)
this.refresh()
this.process()}
ScrollSpy.VERSION='3.2.0'
ScrollSpy.DEFAULTS={offset:10}
ScrollSpy.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)}
ScrollSpy.prototype.refresh=function(){var offsetMethod='offset'
var offsetBase=0
if(!$.isWindow(this.$scrollElement[0])){offsetMethod='position'
offsetBase=this.$scrollElement.scrollTop()}
this.offsets=[]
this.targets=[]
this.scrollHeight=this.getScrollHeight()
var self=this
this.$body.find(this.selector).map(function(){var $el=$(this)
var href=$el.data('target')||$el.attr('href')
var $href=/^#./.test(href)&&$(href)
return($href&&$href.length&&$href.is(':visible')&&[[$href[offsetMethod]().top+offsetBase,href]])||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){self.offsets.push(this[0])
self.targets.push(this[1])})}
ScrollSpy.prototype.process=function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset
var scrollHeight=this.getScrollHeight()
var maxScroll=this.options.offset+scrollHeight-this.$scrollElement.height()
var offsets=this.offsets
var targets=this.targets
var activeTarget=this.activeTarget
var i
if(this.scrollHeight!=scrollHeight){this.refresh()}
if(scrollTop>=maxScroll){return activeTarget!=(i=targets[targets.length-1])&&this.activate(i)}
if(activeTarget&&scrollTop<=offsets[0]){return activeTarget!=(i=targets[0])&&this.activate(i)}
for(i=offsets.length;i--;){activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(!offsets[i+1]||scrollTop<=offsets[i+1])&&this.activate(targets[i])}}
ScrollSpy.prototype.activate=function(target){this.activeTarget=target
$(this.selector).parentsUntil(this.options.target,'.active').removeClass('active')
var selector=this.selector+'[data-target="'+target+'"],'+
this.selector+'[href="'+target+'"]'
var active=$(selector).parents('li').addClass('active')
if(active.parent('.dropdown-menu').length){active=active.closest('li.dropdown').addClass('active')}
active.trigger('activate.bs.scrollspy')}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.scrollspy')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.scrollspy',(data=new ScrollSpy(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.scrollspy
$.fn.scrollspy=Plugin
$.fn.scrollspy.Constructor=ScrollSpy
$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old
return this}
$(window).on('load.bs.scrollspy.data-api',function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this)
Plugin.call($spy,$spy.data())})})}(jQuery);+function($){'use strict';var Tab=function(element){this.element=$(element)}
Tab.VERSION='3.2.0'
Tab.prototype.show=function(){var $this=this.element
var $ul=$this.closest('ul:not(.dropdown-menu)')
var selector=$this.data('target')
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
if($this.parent('li').hasClass('active'))return
var previous=$ul.find('.active:last a')[0]
var e=$.Event('show.bs.tab',{relatedTarget:previous})
$this.trigger(e)
if(e.isDefaultPrevented())return
var $target=$(selector)
this.activate($this.closest('li'),$ul)
this.activate($target,$target.parent(),function(){$this.trigger({type:'shown.bs.tab',relatedTarget:previous})})}
Tab.prototype.activate=function(element,container,callback){var $active=container.find('> .active')
var transition=callback&&$.support.transition&&$active.hasClass('fade')
function next(){$active.removeClass('active').find('> .dropdown-menu > .active').removeClass('active')
element.addClass('active')
if(transition){element[0].offsetWidth
element.addClass('in')}else{element.removeClass('fade')}
if(element.parent('.dropdown-menu')){element.closest('li.dropdown').addClass('active')}
callback&&callback()}
transition?$active.one('bsTransitionEnd',next).emulateTransitionEnd(150):next()
$active.removeClass('in')}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.tab')
if(!data)$this.data('bs.tab',(data=new Tab(this)))
if(typeof option=='string')data[option]()})}
var old=$.fn.tab
$.fn.tab=Plugin
$.fn.tab.Constructor=Tab
$.fn.tab.noConflict=function(){$.fn.tab=old
return this}
$(document).on('click.bs.tab.data-api','[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault()
Plugin.call($(this),'show')})}(jQuery);+function($){'use strict';var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options)
this.$target=$(this.options.target).on('scroll.bs.affix.data-api',$.proxy(this.checkPosition,this)).on('click.bs.affix.data-api',$.proxy(this.checkPositionWithEventLoop,this))
this.$element=$(element)
this.affixed=this.unpin=this.pinnedOffset=null
this.checkPosition()}
Affix.VERSION='3.2.0'
Affix.RESET='affix affix-top affix-bottom'
Affix.DEFAULTS={offset:0,target:window}
Affix.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset
this.$element.removeClass(Affix.RESET).addClass('affix')
var scrollTop=this.$target.scrollTop()
var position=this.$element.offset()
return(this.pinnedOffset=position.top-scrollTop)}
Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1)}
Affix.prototype.checkPosition=function(){if(!this.$element.is(':visible'))return
var scrollHeight=$(document).height()
var scrollTop=this.$target.scrollTop()
var position=this.$element.offset()
var offset=this.options.offset
var offsetTop=offset.top
var offsetBottom=offset.bottom
if(typeof offset!='object')offsetBottom=offsetTop=offset
if(typeof offsetTop=='function')offsetTop=offset.top(this.$element)
if(typeof offsetBottom=='function')offsetBottom=offset.bottom(this.$element)
var affix=this.unpin!=null&&(scrollTop+this.unpin<=position.top)?false:offsetBottom!=null&&(position.top+this.$element.height()>=scrollHeight-offsetBottom)?'bottom':offsetTop!=null&&(scrollTop<=offsetTop)?'top':false
if(this.affixed===affix)return
if(this.unpin!=null)this.$element.css('top','')
var affixType='affix'+(affix?'-'+affix:'')
var e=$.Event(affixType+'.bs.affix')
this.$element.trigger(e)
if(e.isDefaultPrevented())return
this.affixed=affix
this.unpin=affix=='bottom'?this.getPinnedOffset():null
this.$element.removeClass(Affix.RESET).addClass(affixType).trigger($.Event(affixType.replace('affix','affixed')))
if(affix=='bottom'){this.$element.offset({top:scrollHeight-this.$element.height()-offsetBottom})}}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.affix')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.affix',(data=new Affix(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.affix
$.fn.affix=Plugin
$.fn.affix.Constructor=Affix
$.fn.affix.noConflict=function(){$.fn.affix=old
return this}
$(window).on('load',function(){$('[data-spy="affix"]').each(function(){var $spy=$(this)
var data=$spy.data()
data.offset=data.offset||{}
if(data.offsetBottom)data.offset.bottom=data.offsetBottom
if(data.offsetTop)data.offset.top=data.offsetTop
Plugin.call($spy,data)})})}(jQuery);;

/* <inline asset> defined in bundle 'web.assets_backend' */
$.fn.bstooltip=$.fn.tooltip;$.fn.bsbutton=$.fn.button;;

/* /web/static/lib/jquery.ui/js/jquery-ui-1.9.1.custom.js defined in bundle 'web.assets_backend' */
(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};if($.ui.version){return;}
$.extend($.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):this._focus.apply(this,arguments);},scrollParent:function(){var scrollParent;if(($.ui.ie&&(/(static|relative)/).test(this.css('position')))||(/absolute/).test(this.css('position'))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.css(this,'position'))&&(/(auto|scroll)/).test($.css(this,'overflow')+$.css(this,'overflow-y')+$.css(this,'overflow-x'));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.css(this,'overflow')+$.css(this,'overflow-y')+$.css(this,'overflow-x'));}).eq(0);}
return(/fixed/).test(this.css('position'))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id");}});}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}
if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});}
function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}
return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().andSelf().filter(function(){return $.css(this,"visibility")==="hidden";}).length;}
$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));div.offsetHeight;$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});$.support.minHeight=div.offsetHeight===100;$.support.selectstart="onselectstart"in div;body.removeChild(div).style.display="none";});(function(){var uaMatch=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];$.ui.ie=uaMatch.length?true:false;$.ui.ie6=parseFloat(uaMatch[1],10)===6;})();$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},contains:$.contains,hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},isOverAxis:function(x,reference,size){return(x>reference)&&(x<(reference+size));},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width);}});})(jQuery);(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove");}catch(e){}}
_cleanData(elems);};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if($.isFunction(value)){prototype[prop]=(function(){var _super=function(){return base.prototype[prop].apply(this,arguments);},_superApply=function(args){return base.prototype[prop].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();}});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:basePrototype.widgetEventPrefix||name},prototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetBaseClass:fullName,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init();}else{new object(options,this);}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetName,this);$.data(element,this.widgetFullName,this);this._on(this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this._create();this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(value===undefined){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(value===undefined){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");}
return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_on:function(element,handlers){var delegateElement,instance=this;if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(instance.options.disabled===true||$(this).hasClass("ui-state-disabled")){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy);}else{element.bind(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName);},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover");},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus");},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&($.effects.effect[effectName]||$.uiBackCompat!==false&&$.effects[effectName])){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});if($.uiBackCompat!==false){$.Widget.prototype._getCreateOptions=function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName];};}})(jQuery);(function($,undefined){var mouseHandled=false;$(document).mouseup(function(e){mouseHandled=false;});$.widget("ui.mouse",{version:"1.9.1",options:{cancel:'input,textarea,button,select,option',distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind('mousedown.'+this.widgetName,function(event){return that._mouseDown(event);}).bind('click.'+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+'.preventClickEvent')){$.removeData(event.target,that.widgetName+'.preventClickEvent');event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind('.'+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind('mousemove.'+this.widgetName,this._mouseMoveDelegate).unbind('mouseup.'+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+'.preventClickEvent')){$.removeData(event.target,this.widgetName+'.preventClickEvent');}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};$(document).bind('mousemove.'+this.widgetName,this._mouseMoveDelegate).bind('mouseup.'+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.ui.ie&&!(document.documentMode>=9)&&!event.button){return this._mouseUp(event);}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind('mousemove.'+this.widgetName,this._mouseMoveDelegate).unbind('mouseup.'+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+'.preventClickEvent',true);}
this._mouseStop(event);}
return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(event){return this.mouseDelayMet;},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return true;}});})(jQuery);(function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseInt(offsets[0],10)*(rpercent.test(offsets[0])?width/100:1),parseInt(offsets[1],10)*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow?"":within.element.css("overflow-x"),overflowY=within.isWindow?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowX?$.position.scrollbarWidth():0,height:hasOverflowY?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]);return{element:withinElement,isWindow:isWindow,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),targetElem=target[0],collision=(options.collision||"flip").split(" "),offsets={};if(targetElem.nodeType===9){targetWidth=target.width();targetHeight=target.height();targetOffset={top:0,left:0};}else if($.isWindow(targetElem)){targetWidth=target.width();targetHeight=target.height();targetOffset={top:target.scrollTop(),left:target.scrollLeft()};}else if(targetElem.preventDefault){options.at="left top";targetWidth=targetHeight=0;targetOffset={top:targetElem.pageY,left:targetElem.pageX};}else{targetWidth=target.outerWidth();targetHeight=target.outerHeight();targetOffset=target.offset();}
basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top);}
collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if($.fn.bgiframe){elem.bgiframe();}
if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}
else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if((position.top+myOffset+atOffset+offset)>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset;}}
else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if((position.top+myOffset+atOffset+offset)>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});}
for(i in testElementStyle){testElement.style[i]=testElementStyle[i];}
testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement);})();if($.uiBackCompat!==false){(function($){var _position=$.fn.position;$.fn.position=function(options){if(!options||!options.offset){return _position.call(this,options);}
var offset=options.offset.split(" "),at=options.at.split(" ");if(offset.length===1){offset[1]=offset[0];}
if(/^\d/.test(offset[0])){offset[0]="+"+offset[0];}
if(/^\d/.test(offset[1])){offset[1]="+"+offset[1];}
if(at.length===1){if(/left|center|right/.test(at[0])){at[1]="center";}else{at[1]=at[0];at[0]="center";}}
return _position.call(this,$.extend(options,{at:at[0]+offset[0]+" "+at[1]+offset[1],offset:undefined}));};}(jQuery));}}(jQuery));(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=='original'&&!(/^(?:r|a|f)/).test(this.element.css("position")))
this.element[0].style.position='relative';(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit();},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).is('.ui-resizable-handle'))
return false;this.handle=this._getHandle(event);if(!this.handle)
return false;$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body");});return true;},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager)
$.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));if(o.containment)
this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this._mouseDrag(event,true);if($.ui.ddmanager)$.ui.ddmanager.dragStart(this,event);return true;},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger('drag',event,ui)===false){this._mouseUp({});return false;}
this.position=ui.position;}
if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);return false;},_mouseStop:function(event){var dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour)
dropped=$.ui.ddmanager.drop(this,event);if(this.dropped){dropped=this.dropped;this.dropped=false;}
var element=this.element[0],elementInDom=false;while(element&&(element=element.parentNode)){if(element==document){elementInDom=true;}}
if(!elementInDom&&this.options.helper==="original")
return false;if((this.options.revert=="invalid"&&!dropped)||(this.options.revert=="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){var that=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);});if($.ui.ddmanager)$.ui.ddmanager.dragStop(this,event);return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({});}else{this._clear();}
return this;},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?true:false;$(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==event.target)handle=true;});return handle;},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):(o.helper=='clone'?this.element.clone().removeAttr('id'):this.element);if(!helper.parents('body').length)
helper.appendTo((o.appendTo=='parent'?this.element[0].parentNode:o.appendTo));if(helper[0]!=this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position")))
helper.css("position","absolute");return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.ui.ie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[o.containment=='document'?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=='document'?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=='document'?0:$(window).scrollLeft())+$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=='document'?0:$(window).scrollTop())+($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment);var ce=c[0];if(!ce)return;var co=c.offset();var over=($(ce).css("overflow")!='hidden');this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c;}else if(o.containment.constructor==Array){this.containment=o.containment;}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}
else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0])pageX=containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<containment[1])pageY=containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>containment[2])pageX=containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>containment[3])pageY=containment[3]+this.offset.click.top;}
if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?(!(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top:(!(top-this.offset.click.top<containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?(!(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left:(!(left-this.offset.click.left<containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval)this.helper.remove();this.helper=null;this.cancelHelperRemoval=false;},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type=="drag")this.positionAbs=this._convertPositionTo("absolute");return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,'sortable');if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper=='original')
this.instance.currentItem.css({top:'auto',left:'auto'});}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui){var inst=$(this).data("draggable"),that=this;var checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left;var itemHeight=o.height,itemWidth=o.width;var itemTop=o.top,itemLeft=o.left;return $.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth);};$.each(inst.sortables,function(i){var innermostIntersecting=false;var thisSortable=this;this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){innermostIntersecting=true;$.each(inst.sortables,function(){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this!=thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.ui.contains(thisSortable.instance.element[0],this.instance.element[0]))
innermostIntersecting=false;return innermostIntersecting;});}
if(innermostIntersecting){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(that).clone().removeAttr('id').appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0];};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst;}
if(this.instance.currentItem)this.instance._mouseDrag(event);}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger('out',event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder)this.instance.placeholder.remove();inst._trigger("fromSortable",event);inst.dropped=false;}};});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$('body'),o=$(this).data('draggable').options;if(t.css("cursor"))o._cursor=t.css("cursor");t.css("cursor",o.cursor);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._cursor)$('body').css("cursor",o._cursor);}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data('draggable').options;if(t.css("opacity"))o._opacity=t.css("opacity");t.css('opacity',o.opacity);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._opacity)$(ui.helper).css('opacity',o._opacity);}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML')i.overflowOffset=i.scrollParent.offset();},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML'){if(!o.axis||o.axis!='x'){if((i.overflowOffset.top+i.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed;}
if(!o.axis||o.axis!='y'){if((i.overflowOffset.left+i.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(!o.axis||o.axis!='x'){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}
if(!o.axis||o.axis!='y'){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(i,event);}});$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!=String?(o.snap.items||':data(draggable)'):o.snap).each(function(){var $t=$(this);var $o=$t.offset();if(this!=i.element[0])i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});});},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options;var d=o.snapTolerance;var x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!((l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d)||(l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d)||(l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d)||(l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d))){if(inst.snapElements[i].snapping)(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!='inner'){var ts=Math.abs(t-y2)<=d;var bs=Math.abs(b-y1)<=d;var ls=Math.abs(l-x2)<=d;var rs=Math.abs(r-x1)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left;}
var first=(ts||bs||ls||rs);if(o.snapMode!='outer'){var ts=Math.abs(t-y1)<=d;var bs=Math.abs(b-y2)<=d;var ls=Math.abs(l-x1)<=d;var rs=Math.abs(r-x2)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left;}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first))
(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=(ts||bs||ls||rs||first);};}});$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options;var group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i;});this[0].style.zIndex=min+group.length;}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;if(t.css("zIndex"))o._zIndex=t.css("zIndex");t.css('zIndex',o.zIndex);},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._zIndex)$(ui.helper).css('zIndex',o._zIndex);}});})(jQuery);(function($,undefined){$.widget("ui.droppable",{version:"1.9.1",widgetEventPrefix:"drop",options:{accept:'*',activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:'default',tolerance:'intersect'},_create:function(){var o=this.options,accept=o.accept;this.isover=0;this.isout=1;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept);};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);(o.addClasses&&this.element.addClass("ui-droppable"));},_destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];for(var i=0;i<drop.length;i++)
if(drop[i]==this)
drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled");},_setOption:function(key,value){if(key=='accept'){this.accept=$.isFunction(value)?value:function(d){return d.is(value);};}
$.Widget.prototype._setOption.apply(this,arguments);},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.addClass(this.options.activeClass);(draggable&&this._trigger('activate',event,this.ui(draggable)));},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.removeClass(this.options.activeClass);(draggable&&this._trigger('deactivate',event,this.ui(draggable)));},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.addClass(this.options.hoverClass);this._trigger('over',event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('out',event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return false;var childrenIntersection=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,'droppable');if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope==draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=true;return false;}});if(childrenIntersection)return false;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('drop',event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};}});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return false;var x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height;var l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case'fit':return(l<=x1&&x2<=r&&t<=y1&&y2<=b);break;case'intersect':return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);break;case'pointer':var draggableLeft=((draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left),draggableTop=((draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top),isOver=$.ui.isOver(draggableTop,draggableLeft,t,l,droppable.proportions.height,droppable.proportions.width);return isOver;break;case'touch':return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));break;default:return false;break;}};$.ui.ddmanager={current:null,droppables:{'default':[]},prepareOffsets:function(t,event){var m=$.ui.ddmanager.droppables[t.options.scope]||[];var type=event?event.type:null;var list=(t.currentItem||t.element).find(":data(droppable)").andSelf();droppablesLoop:for(var i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element))))continue;for(var j=0;j<list.length;j++){if(list[j]==m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop;}};m[i].visible=m[i].element.css("display")!="none";if(!m[i].visible)continue;if(type=="mousedown")m[i]._activate.call(m[i],event);m[i].offset=m[i].element.offset();m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight};}},drop:function(draggable,event){var dropped=false;$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options)return;if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance))
dropped=this._drop.call(this,event)||dropped;if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=1;this.isover=0;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);});},drag:function(draggable,event){if(draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var intersects=$.ui.intersect(draggable,this,this.options.tolerance);var c=!intersects&&this.isover==1?'isout':(intersects&&this.isover==0?'isover':null);if(!c)return;var parentInstance;if(this.options.greedy){var scope=this.options.scope;var parent=this.element.parents(':data(droppable)').filter(function(){return $.data(this,'droppable').options.scope===scope;});if(parent.length){parentInstance=$.data(parent[0],'droppable');parentInstance.greedyChild=(c=='isover'?1:0);}}
if(parentInstance&&c=='isover'){parentInstance['isover']=0;parentInstance['isout']=1;parentInstance._out.call(parentInstance,event);}
this[c]=1;this[c=='isout'?'isover':'isout']=0;this[c=="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c=='isout'){parentInstance['isout']=0;parentInstance['isover']=1;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);}};})(jQuery);(function($,undefined){$.widget("ui.resizable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var that=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||'ui-resizable-helper':null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){this.element.wrap($('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css('position'),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css('top'),left:this.element.css('left')}));this.element=this.element.parent().data("resizable",this.element.data('resizable'));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css('resize');this.originalElement.css('resize','none');this._proportionallyResizeElements.push(this.originalElement.css({position:'static',zoom:1,display:'block'}));this.originalElement.css({margin:this.originalElement.css('margin')});this._proportionallyResize();}
this.handles=o.handles||(!$('.ui-resizable-handle',this.element).length?"e,s,se":{n:'.ui-resizable-n',e:'.ui-resizable-e',s:'.ui-resizable-s',w:'.ui-resizable-w',se:'.ui-resizable-se',sw:'.ui-resizable-sw',ne:'.ui-resizable-ne',nw:'.ui-resizable-nw'});if(this.handles.constructor==String){if(this.handles=='all')this.handles='n,e,s,w,se,sw,ne,nw';var n=this.handles.split(",");this.handles={};for(var i=0;i<n.length;i++){var handle=$.trim(n[i]),hname='ui-resizable-'+handle;var axis=$('<div class="ui-resizable-handle '+hname+'"></div>');axis.css({zIndex:o.zIndex});if('se'==handle){axis.addClass('ui-icon ui-icon-gripsmall-diagonal-se');};this.handles[handle]='.ui-resizable-'+handle;this.element.append(axis);}}
this._renderAxis=function(target){target=target||this.element;for(var i in this.handles){if(this.handles[i].constructor==String)
this.handles[i]=$(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var axis=$(this.handles[i],this.element),padWrapper=0;padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();var padPos=['padding',/ne|nw|n/.test(i)?'Top':/se|sw|s/.test(i)?'Bottom':/^e$/.test(i)?'Right':'Left'].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
if(!$(this.handles[i]).length)
continue;}};this._renderAxis(this.element);this._handles=$('.ui-resizable-handle',this.element).disableSelection();this._handles.mouseover(function(){if(!that.resizing){if(this.className)
var axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);that.axis=axis&&axis[1]?axis[1]:'se';}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(o.disabled)return;$(this).removeClass("ui-resizable-autohide");that._handles.show();}).mouseleave(function(){if(o.disabled)return;if(!that.resizing){$(this).addClass("ui-resizable-autohide");that._handles.hide();}});}
this._mouseInit();},_destroy:function(){this._mouseDestroy();var _destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find('.ui-resizable-handle').remove();};if(this.elementIsWrapper){_destroy(this.element);var wrapper=this.element;this.originalElement.css({position:wrapper.css('position'),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css('top'),left:wrapper.css('left')}).insertAfter(wrapper);wrapper.remove();}
this.originalElement.css('resize',this.originalResizeStyle);_destroy(this.originalElement);return this;},_mouseCapture:function(event){var handle=false;for(var i in this.handles){if($(this.handles[i])[0]==event.target){handle=true;}}
return!this.options.disabled&&handle;},_mouseStart:function(event){var o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=true;this.documentScroll={top:$(document).scrollTop(),left:$(document).scrollLeft()};if(el.is('.ui-draggable')||(/absolute/).test(el.css('position'))){el.css({position:'absolute',top:iniPos.top,left:iniPos.left});}
this._renderProxy();var curleft=num(this.helper.css('left')),curtop=num(this.helper.css('top'));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio=='number')?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var cursor=$('.ui-resizable-'+this.axis).css('cursor');$('body').css('cursor',cursor=='auto'?this.axis+'-resize':cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var el=this.helper,o=this.options,props={},that=this,smp=this.originalMousePosition,a=this.axis;var dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0;var trigger=this._change[a];if(!trigger)return false;var data=trigger.apply(this,[event,dx,dy]);this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey)
data=this._updateRatio(data,event);data=this._respectSize(data,event);this._propagate("resize",event);el.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length)
this._proportionallyResize();this._updateCache(data);this._trigger('resize',event,this.ui());return false;},_mouseStop:function(event){this.resizing=false;var o=this.options,that=this;if(this._helper){var pr=this._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width;var s={width:(that.helper.width()-soffsetw),height:(that.helper.height()-soffseth)},left=(parseInt(that.element.css('left'),10)+(that.position.left-that.originalPosition.left))||null,top=(parseInt(that.element.css('top'),10)+(that.position.top-that.originalPosition.top))||null;if(!o.animate)
this.element.css($.extend(s,{top:top,left:left}));that.helper.height(that.size.height);that.helper.width(that.size.width);if(this._helper&&!o.animate)this._proportionallyResize();}
$('body').css('cursor','auto');this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper)this.helper.remove();return false;},_updateVirtualBoundaries:function(forceAspectRatio){var o=this.options,pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b;b={minWidth:isNumber(o.minWidth)?o.minWidth:0,maxWidth:isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:isNumber(o.minHeight)?o.minHeight:0,maxHeight:isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth)b.minWidth=pMinWidth;if(pMinHeight>b.minHeight)b.minHeight=pMinHeight;if(pMaxWidth<b.maxWidth)b.maxWidth=pMaxWidth;if(pMaxHeight<b.maxHeight)b.maxHeight=pMaxHeight;}
this._vBoundaries=b;},_updateCache:function(data){var o=this.options;this.offset=this.helper.offset();if(isNumber(data.left))this.position.left=data.left;if(isNumber(data.top))this.position.top=data.top;if(isNumber(data.height))this.size.height=data.height;if(isNumber(data.width))this.size.width=data.width;},_updateRatio:function(data,event){var o=this.options,cpos=this.position,csize=this.size,a=this.axis;if(isNumber(data.height))data.width=(data.height*this.aspectRatio);else if(isNumber(data.width))data.height=(data.width/this.aspectRatio);if(a=='sw'){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a=='nw'){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data,event){var el=this.helper,o=this._vBoundaries,pRatio=this._aspectRatio||event.shiftKey,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height);if(isminw)data.width=o.minWidth;if(isminh)data.height=o.minHeight;if(ismaxw)data.width=o.maxWidth;if(ismaxh)data.height=o.maxHeight;var dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height;var cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw&&cw)data.left=dw-o.minWidth;if(ismaxw&&cw)data.left=dw-o.maxWidth;if(isminh&&ch)data.top=dh-o.minHeight;if(ismaxh&&ch)data.top=dh-o.maxHeight;var isNotwh=!data.width&&!data.height;if(isNotwh&&!data.left&&data.top)data.top=null;else if(isNotwh&&!data.top&&data.left)data.left=null;return data;},_proportionallyResize:function(){var o=this.options;if(!this._proportionallyResizeElements.length)return;var element=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var prel=this._proportionallyResizeElements[i];if(!this.borderDif){var b=[prel.css('borderTopWidth'),prel.css('borderRightWidth'),prel.css('borderBottomWidth'),prel.css('borderLeftWidth')],p=[prel.css('paddingTop'),prel.css('paddingRight'),prel.css('paddingBottom'),prel.css('paddingLeft')];this.borderDif=$.map(b,function(v,i){var border=parseInt(v,10)||0,padding=parseInt(p[i],10)||0;return border+padding;});}
prel.css({height:(element.height()-this.borderDif[0]-this.borderDif[2])||0,width:(element.width()-this.borderDif[1]-this.borderDif[3])||0});};},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div style="overflow:hidden;"></div>');var ie6offset=($.ui.ie6?1:0),pxyoffset=($.ui.ie6?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+pxyoffset,height:this.element.outerHeight()+pxyoffset,position:'absolute',left:this.elementOffset.left-ie6offset+'px',top:this.elementOffset.top-ie6offset+'px',zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx,dy){return{width:this.originalSize.width+dx};},w:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.ui.plugin.add("resizable","alsoResize",{start:function(event,ui){var that=$(this).data("resizable"),o=that.options;var _store=function(exp){$(exp).each(function(){var el=$(this);el.data("resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css('left'),10),top:parseInt(el.css('top'),10)});});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.parentNode){if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize);}
else{$.each(o.alsoResize,function(exp){_store(exp);});}}else{_store(o.alsoResize);}},resize:function(event,ui){var that=$(this).data("resizable"),o=that.options,os=that.originalSize,op=that.originalPosition;var delta={height:(that.size.height-os.height)||0,width:(that.size.width-os.width)||0,top:(that.position.top-op.top)||0,left:(that.position.left-op.left)||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?['width','height']:['width','height','top','left'];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0)
style[prop]=sum||null;});el.css(style);});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c);});}else{_alsoResize(o.alsoResize);}},stop:function(event,ui){$(this).removeData("resizable-alsoresize");}});$.ui.plugin.add("resizable","animate",{stop:function(event,ui){var that=$(this).data("resizable"),o=that.options;var pr=that._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width;var style={width:(that.size.width-soffsetw),height:(that.size.height-soffseth)},left=(parseInt(that.element.css('left'),10)+(that.position.left-that.originalPosition.left))||null,top=(parseInt(that.element.css('top'),10)+(that.position.top-that.originalPosition.top))||null;that.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(that.element.css('width'),10),height:parseInt(that.element.css('height'),10),top:parseInt(that.element.css('top'),10),left:parseInt(that.element.css('left'),10)};if(pr&&pr.length)$(pr[0]).css({width:data.width,height:data.height});that._updateCache(data);that._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(event,ui){var that=$(this).data("resizable"),o=that.options,el=that.element;var oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce)return;that.containerElement=$(ce);if(/document/.test(oc)||oc==document){that.containerOffset={left:0,top:0};that.containerPosition={left:0,top:0};that.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}
else{var element=$(ce),p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name));});that.containerOffset=element.offset();that.containerPosition=element.position();that.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};var co=that.containerOffset,ch=that.containerSize.height,cw=that.containerSize.width,width=($.ui.hasScroll(ce,"left")?ce.scrollWidth:cw),height=($.ui.hasScroll(ce)?ce.scrollHeight:ch);that.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event,ui){var that=$(this).data("resizable"),o=that.options,ps=that.containerSize,co=that.containerOffset,cs=that.size,cp=that.position,pRatio=that._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=that.containerElement;if(ce[0]!=document&&(/static/).test(ce.css('position')))cop=co;if(cp.left<(that._helper?co.left:0)){that.size.width=that.size.width+(that._helper?(that.position.left-co.left):(that.position.left-cop.left));if(pRatio)that.size.height=that.size.width/that.aspectRatio;that.position.left=o.helper?co.left:0;}
if(cp.top<(that._helper?co.top:0)){that.size.height=that.size.height+(that._helper?(that.position.top-co.top):that.position.top);if(pRatio)that.size.width=that.size.height*that.aspectRatio;that.position.top=that._helper?co.top:0;}
that.offset.left=that.parentData.left+that.position.left;that.offset.top=that.parentData.top+that.position.top;var woset=Math.abs((that._helper?that.offset.left-cop.left:(that.offset.left-cop.left))+that.sizeDiff.width),hoset=Math.abs((that._helper?that.offset.top-cop.top:(that.offset.top-co.top))+that.sizeDiff.height);var isParent=that.containerElement.get(0)==that.element.parent().get(0),isOffsetRelative=/relative|absolute/.test(that.containerElement.css('position'));if(isParent&&isOffsetRelative)woset-=that.parentData.left;if(woset+that.size.width>=that.parentData.width){that.size.width=that.parentData.width-woset;if(pRatio)that.size.height=that.size.width/that.aspectRatio;}
if(hoset+that.size.height>=that.parentData.height){that.size.height=that.parentData.height-hoset;if(pRatio)that.size.width=that.size.height*that.aspectRatio;}},stop:function(event,ui){var that=$(this).data("resizable"),o=that.options,cp=that.position,co=that.containerOffset,cop=that.containerPosition,ce=that.containerElement;var helper=$(that.helper),ho=helper.offset(),w=helper.outerWidth()-that.sizeDiff.width,h=helper.outerHeight()-that.sizeDiff.height;if(that._helper&&!o.animate&&(/relative/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});if(that._helper&&!o.animate&&(/static/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}});$.ui.plugin.add("resizable","ghost",{start:function(event,ui){var that=$(this).data("resizable"),o=that.options,cs=that.size;that.ghost=that.originalElement.clone();that.ghost.css({opacity:.25,display:'block',position:'relative',height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass('ui-resizable-ghost').addClass(typeof o.ghost=='string'?o.ghost:'');that.ghost.appendTo(that.helper);},resize:function(event,ui){var that=$(this).data("resizable"),o=that.options;if(that.ghost)that.ghost.css({position:'relative',height:that.size.height,width:that.size.width});},stop:function(event,ui){var that=$(this).data("resizable"),o=that.options;if(that.ghost&&that.helper)that.helper.get(0).removeChild(that.ghost.get(0));}});$.ui.plugin.add("resizable","grid",{resize:function(event,ui){var that=$(this).data("resizable"),o=that.options,cs=that.size,os=that.originalSize,op=that.originalPosition,a=that.axis,ratio=o._aspectRatio||event.shiftKey;o.grid=typeof o.grid=="number"?[o.grid,o.grid]:o.grid;var ox=Math.round((cs.width-os.width)/(o.grid[0]||1))*(o.grid[0]||1),oy=Math.round((cs.height-os.height)/(o.grid[1]||1))*(o.grid[1]||1);if(/^(se|s|e)$/.test(a)){that.size.width=os.width+ox;that.size.height=os.height+oy;}
else if(/^(ne)$/.test(a)){that.size.width=os.width+ox;that.size.height=os.height+oy;that.position.top=op.top-oy;}
else if(/^(sw)$/.test(a)){that.size.width=os.width+ox;that.size.height=os.height+oy;that.position.left=op.left-ox;}
else{that.size.width=os.width+ox;that.size.height=os.height+oy;that.position.top=op.top-oy;that.position.left=op.left-ox;}}});var num=function(v){return parseInt(v,10)||0;};var isNumber=function(value){return!isNaN(parseInt(value,10));};})(jQuery);(function($,undefined){$.widget("ui.selectable",$.ui.mouse,{version:"1.9.1",options:{appendTo:'body',autoRefresh:true,distance:0,filter:'*',tolerance:'touch'},_create:function(){var that=this;this.element.addClass("ui-selectable");this.dragged=false;var selectees;this.refresh=function(){selectees=$(that.options.filter,that.element[0]);selectees.addClass("ui-selectee");selectees.each(function(){var $this=$(this);var pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass('ui-selected'),selecting:$this.hasClass('ui-selecting'),unselecting:$this.hasClass('ui-unselecting')});});};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>");},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled");this._mouseDestroy();},_mouseStart:function(event){var that=this;this.opos=[event.pageX,event.pageY];if(this.options.disabled)
return;var options=this.options;this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({"left":event.clientX,"top":event.clientY,"width":0,"height":0});if(options.autoRefresh){this.refresh();}
this.selectees.filter('.ui-selected').each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey&&!event.ctrlKey){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}});$(event.target).parents().andSelf().each(function(){var selectee=$.data(this,"selectable-item");if(selectee){var doSelect=(!event.metaKey&&!event.ctrlKey)||!selectee.$element.hasClass('ui-selected');selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){that._trigger("selecting",event,{selecting:selectee.element});}else{that._trigger("unselecting",event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){var that=this;this.dragged=true;if(this.options.disabled)
return;var options=this.options;var x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){var tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){var tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item");if(!selectee||selectee.element==that.element[0])
return;var hit=false;if(options.tolerance=='touch'){hit=(!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1));}else if(options.tolerance=='fit'){hit=(selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2);}
if(hit){if(selectee.selected){selectee.$element.removeClass('ui-selected');selectee.selected=false;}
if(selectee.unselecting){selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;}
if(!selectee.selecting){selectee.$element.addClass('ui-selecting');selectee.selecting=true;that._trigger("selecting",event,{selecting:selectee.element});}}else{if(selectee.selecting){if((event.metaKey||event.ctrlKey)&&selectee.startselected){selectee.$element.removeClass('ui-selecting');selectee.selecting=false;selectee.$element.addClass('ui-selected');selectee.selected=true;}else{selectee.$element.removeClass('ui-selecting');selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;}
that._trigger("unselecting",event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!event.ctrlKey&&!selectee.startselected){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var that=this;this.dragged=false;var options=this.options;$('.ui-unselecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;selectee.startselected=false;that._trigger("unselected",event,{unselected:selectee.element});});$('.ui-selecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-selecting').addClass('ui-selected');selectee.selecting=false;selectee.selected=true;selectee.startselected=true;that._trigger("selected",event,{selected:selectee.element});});this._trigger("stop",event);this.helper.remove();return false;}});})(jQuery);(function($,undefined){$.widget("ui.sortable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:'auto',cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:'> *',opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==='x'||(/left|right/).test(this.items[0].item.css('float'))||(/inline|table-cell/).test(this.items[0].item.css('display')):false;this.offset=this.element.offset();this._mouseInit();this.ready=true},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)
this.items[i].item.removeData(this.widgetName+"-item");return this;},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget().toggleClass("ui-sortable-disabled",!!value);}else{$.Widget.prototype._setOption.apply(this,arguments);}},_mouseCapture:function(event,overrideHandle){var that=this;if(this.reverting){return false;}
if(this.options.disabled||this.options.type=='static')return false;this._refreshItems(event);var currentItem=null,nodes=$(event.target).parents().each(function(){if($.data(this,that.widgetName+'-item')==that){currentItem=$(this);return false;}});if($.data(event.target,that.widgetName+'-item')==that)currentItem=$(event.target);if(!currentItem)return false;if(this.options.handle&&!overrideHandle){var validHandle=false;$(this.options.handle,currentItem).find("*").andSelf().each(function(){if(this==event.target)validHandle=true;});if(!validHandle)return false;}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment)
this._setContainment();if(o.cursor){if($('body').css("cursor"))this._storedCursor=$('body').css("cursor");$('body').css("cursor",o.cursor);}
if(o.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML')
this.overflowOffset=this.scrollParent.offset();this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions)
this._cacheHelperProportions();if(!noActivation){for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this));}}
if($.ui.ddmanager)
$.ui.ddmanager.current=this;if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){var o=this.options,scrolled=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML'){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(!intersection)continue;if(item.instance!==this.currentContainer)continue;if(itemElement!=this.currentItem[0]&&this.placeholder[intersection==1?"next":"prev"]()[0]!=itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type=='semi-dynamic'?!$.contains(this.element[0],itemElement):true)){this.direction=intersection==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);this._trigger('sort',event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event)return;if($.ui.ddmanager&&!this.options.dropBehaviour)
$.ui.ddmanager.drop(this,event);if(this.options.revert){var that=this;var cur=this.placeholder.offset();this.reverting=true;$(this.helper).animate({left:cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){that._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original")
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else
this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||'id')||'').match(o.expression||(/(.+)[-=_](.+)/));if(res)str.push((o.key||res[1]+'[]')+'='+(o.key&&o.expression?res[1]:res[2]));});if(!str.length&&o.key){str.push(o.key+'=');}
return str.join('&');},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||'id')||'');});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height;var l=item.left,r=l+item.width,t=item.top,b=t+item.height;var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var isOverElement=(y1+dyClick)>t&&(y1+dyClick)<b&&(x1+dxClick)>l&&(x1+dxClick)<r;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?'width':'height']>item[this.floating?'width':'height'])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=(this.options.axis==='x')||$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=(this.options.axis==='y')||$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement)
return false;return this.floating?(((horizontalDirection&&horizontalDirection=="right")||verticalDirection=="down")?2:1):(verticalDirection&&(verticalDirection=="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection=="right"&&isOverRightHalf)||(horizontalDirection=="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection=="down"&&isOverBottomHalf)||(verticalDirection=="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!=0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!=0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var items=[];var queries=[];var connectWith=this._connectWith();if(connectWith&&connected){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],this.widgetName);if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),inst]);}};};}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),this]);for(var i=queries.length-1;i>=0;i--){queries[i][0].each(function(){items.push(this);});};return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]==item.item[0])
return false;};return true;});},_refreshItems:function(event){this.items=[];this.containers=[this];var items=this.items;var queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]];var connectWith=this._connectWith();if(connectWith&&this.ready){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],this.widgetName);if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}};};}
for(var i=queries.length-1;i>=0;i--){var targetData=queries[i][1];var _queries=queries[i][0];for(var j=0,queriesLength=_queries.length;j<queriesLength;j++){var item=$(_queries[j]);item.data(this.widgetName+'-item',targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});};};},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];if(item.instance!=this.currentContainer&&this.currentContainer&&item.item[0]!=this.currentItem[0])
continue;var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
var p=t.offset();item.left=p.left;item.top=p.top;};if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();};}
return this;},_createPlaceholder:function(that){that=that||this;var o=that.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(that.currentItem[0].nodeName)).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!className)
el.style.visibility="hidden";return el;},update:function(container,p){if(className&&!o.forcePlaceholderSize)return;if(!p.height()){p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css('paddingTop')||0,10)-parseInt(that.currentItem.css('paddingBottom')||0,10));};if(!p.width()){p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css('paddingLeft')||0,10)-parseInt(that.currentItem.css('paddingRight')||0,10));};}};}
that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder);},_contactContainers:function(event){var innermostContainer=null,innermostIndex=null;for(var i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0]))
continue;if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0]))
continue;innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer)return;if(this.containers.length===1){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}else{var dist=10000;var itemWithLeastDistance=null;var posProperty=this.containers[innermostIndex].floating?'left':'top';var sizeProperty=this.containers[innermostIndex].floating?'width':'height';var base=this.positionAbs[posProperty]+this.offset.click[posProperty];for(var j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0]))continue;if(this.items[j].item[0]==this.currentItem[0])continue;var cur=this.items[j].item.offset()[posProperty];var nearBottom=false;if(Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)){nearBottom=true;cur+=this.items[j][sizeProperty];}
if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down";}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty)
return;this.currentContainer=this.containers[innermostIndex];itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper=='clone'?this.currentItem.clone():this.currentItem);if(!helper.parents('body').length)
$(o.appendTo!='parent'?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);if(helper[0]==this.currentItem[0])
this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(helper[0].style.width==''||o.forceHelperSize)helper.width(this.currentItem.width());if(helper[0].style.height==''||o.forceHelperSize)helper.height(this.currentItem.height());return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.ui.ie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)){var ce=$(o.containment)[0];var co=$(o.containment).offset();var over=($(ce).css("overflow")!='hidden');this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition=='relative'&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0])pageX=this.containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<this.containment[1])pageY=this.containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>this.containment[2])pageX=this.containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>this.containment[3])pageY=this.containment[3]+this.offset.click.top;}
if(o.grid){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?(!(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top:(!(top-this.offset.click.top<this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?(!(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left:(!(left-this.offset.click.left<this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=='down'?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter==this.counter)this.refreshPositions(!hardRefresh);});},_clear:function(event,noPropagation){this.reverting=false;var delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=='auto'||this._storedCSS[i]=='static')this._storedCSS[i]='';}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation)delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!noPropagation)delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.currentContainer));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.currentContainer));}}
for(var i=this.containers.length-1;i>=0;i--){if(!noPropagation)delayedTriggers.push((function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this));};}).call(this,this.containers[i]));if(this.containers[i].containerCache.over){delayedTriggers.push((function(c){return function(event){c._trigger("out",event,this._uiHash(this));};}).call(this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this._storedCursor)$('body').css("cursor",this._storedCursor);if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=='auto'?'':this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return false;}
if(!noPropagation)this._trigger("beforeStop",event,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0])this.helper.remove();this.helper=null;if(!noPropagation){for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return true;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null};}});})(jQuery);(function($,undefined){var uid=0,hideProps={},showProps={};hideProps.height=hideProps.paddingTop=hideProps.paddingBottom=hideProps.borderTopWidth=hideProps.borderBottomWidth="hide";showProps.height=showProps.paddingTop=showProps.paddingBottom=showProps.borderTopWidth=showProps.borderBottomWidth="show";$.widget("ui.accordion",{version:"1.9.1",options:{active:0,animate:{},collapsible:false,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var accordionId=this.accordionId="ui-accordion-"+
(this.element.attr("id")||++uid),options=this.options;this.prevShow=this.prevHide=$();this.element.addClass("ui-accordion ui-widget ui-helper-reset");this.headers=this.element.find(options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all");this._hoverable(this.headers);this._focusable(this.headers);this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").hide();if(!options.collapsible&&(options.active===false||options.active==null)){options.active=0;}
if(options.active<0){options.active+=this.headers.length;}
this.active=this._findActive(options.active).addClass("ui-accordion-header-active ui-state-active").toggleClass("ui-corner-all ui-corner-top");this.active.next().addClass("ui-accordion-content-active").show();this._createIcons();this.refresh();this.element.attr("role","tablist");this.headers.attr("role","tab").each(function(i){var header=$(this),headerId=header.attr("id"),panel=header.next(),panelId=panel.attr("id");if(!headerId){headerId=accordionId+"-header-"+i;header.attr("id",headerId);}
if(!panelId){panelId=accordionId+"-panel-"+i;panel.attr("id",panelId);}
header.attr("aria-controls",panelId);panel.attr("aria-labelledby",headerId);}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide();if(!this.active.length){this.headers.eq(0).attr("tabIndex",0);}else{this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"});}
this._on(this.headers,{keydown:"_keydown"});this._on(this.headers.next(),{keydown:"_panelKeyDown"});this._setupEvents(options.event);},_getCreateEventData:function(){return{header:this.active,content:!this.active.length?$():this.active.next()};},_createIcons:function(){var icons=this.options.icons;if(icons){$("<span>").addClass("ui-accordion-header-icon ui-icon "+icons.header).prependTo(this.headers);this.active.children(".ui-accordion-header-icon").removeClass(icons.header).addClass(icons.activeHeader);this.headers.addClass("ui-accordion-icons");}},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove();},_destroy:function(){var contents;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){if(/^ui-accordion/.test(this.id)){this.removeAttribute("id");}});this._destroyIcons();contents=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){if(/^ui-accordion/.test(this.id)){this.removeAttribute("id");}});if(this.options.heightStyle!=="content"){contents.css("height","");}},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
if(key==="event"){if(this.options.event){this._off(this.headers,this.options.event);}
this._setupEvents(value);}
this._super(key,value);if(key==="collapsible"&&!value&&this.options.active===false){this._activate(0);}
if(key==="icons"){this._destroyIcons();if(value){this._createIcons();}}
if(key==="disabled"){this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!value);}},_keydown:function(event){if(event.altKey||event.ctrlKey){return;}
var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._eventHandler(event);break;case keyCode.HOME:toFocus=this.headers[0];break;case keyCode.END:toFocus=this.headers[length-1];break;}
if(toFocus){$(event.target).attr("tabIndex",-1);$(toFocus).attr("tabIndex",0);toFocus.focus();event.preventDefault();}},_panelKeyDown:function(event){if(event.keyCode===$.ui.keyCode.UP&&event.ctrlKey){$(event.currentTarget).prev().focus();}},refresh:function(){var maxHeight,overflow,heightStyle=this.options.heightStyle,parent=this.element.parent();if(heightStyle==="fill"){if(!$.support.minHeight){overflow=parent.css("overflow");parent.css("overflow","hidden");}
maxHeight=parent.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});if(overflow){parent.css("overflow",overflow);}
this.headers.each(function(){maxHeight-=$(this).outerHeight(true);});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(heightStyle==="auto"){maxHeight=0;this.headers.next().each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}},_activate:function(index){var active=this._findActive(index)[0];if(active===this.active[0]){return;}
active=active||this.active[0];this._eventHandler({target:active,currentTarget:active,preventDefault:$.noop});},_findActive:function(selector){return typeof selector==="number"?this.headers.eq(selector):$();},_setupEvents:function(event){var events={};if(!event){return;}
$.each(event.split(" "),function(index,eventName){events[eventName]="_eventHandler";});this._on(this.headers,events);},_eventHandler:function(event){var options=this.options,active=this.active,clicked=$(event.currentTarget),clickedIsActive=clicked[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():clicked.next(),toHide=active.next(),eventData={oldHeader:active,oldPanel:toHide,newHeader:collapsing?$():clicked,newPanel:toShow};event.preventDefault();if((clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.headers.index(clicked);this.active=clickedIsActive?$():clicked;this._toggle(eventData);active.removeClass("ui-accordion-header-active ui-state-active");if(options.icons){active.children(".ui-accordion-header-icon").removeClass(options.icons.activeHeader).addClass(options.icons.header);}
if(!clickedIsActive){clicked.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top");if(options.icons){clicked.children(".ui-accordion-header-icon").removeClass(options.icons.header).addClass(options.icons.activeHeader);}
clicked.next().addClass("ui-accordion-content-active");}},_toggle:function(data){var toShow=data.newPanel,toHide=this.prevShow.length?this.prevShow:data.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=toShow;this.prevHide=toHide;if(this.options.animate){this._animate(toShow,toHide,data);}else{toHide.hide();toShow.show();this._toggleComplete(data);}
toHide.attr({"aria-expanded":"false","aria-hidden":"true"});toHide.prev().attr("aria-selected","false");if(toShow.length&&toHide.length){toHide.prev().attr("tabIndex",-1);}else if(toShow.length){this.headers.filter(function(){return $(this).attr("tabIndex")===0;}).attr("tabIndex",-1);}
toShow.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0});},_animate:function(toShow,toHide,data){var total,easing,duration,that=this,adjust=0,down=toShow.length&&(!toHide.length||(toShow.index()<toHide.index())),animate=this.options.animate||{},options=down&&animate.down||animate,complete=function(){that._toggleComplete(data);};if(typeof options==="number"){duration=options;}
if(typeof options==="string"){easing=options;}
easing=easing||options.easing||animate.easing;duration=duration||options.duration||animate.duration;if(!toHide.length){return toShow.animate(showProps,duration,easing,complete);}
if(!toShow.length){return toHide.animate(hideProps,duration,easing,complete);}
total=toShow.show().outerHeight();toHide.animate(hideProps,{duration:duration,easing:easing,step:function(now,fx){fx.now=Math.round(now);}});toShow.hide().animate(showProps,{duration:duration,easing:easing,complete:complete,step:function(now,fx){fx.now=Math.round(now);if(fx.prop!=="height"){adjust+=fx.now;}else if(that.options.heightStyle!=="content"){fx.now=Math.round(total-toHide.outerHeight()-adjust);adjust=0;}}});},_toggleComplete:function(data){var toHide=data.oldPanel;toHide.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all");if(toHide.length){toHide.parent()[0].className=toHide.parent()[0].className;}
this._trigger("activate",null,data);}});if($.uiBackCompat!==false){(function($,prototype){$.extend(prototype.options,{navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase();}});var _create=prototype._create;prototype._create=function(){if(this.options.navigation){var that=this,headers=this.element.find(this.options.header),content=headers.next(),current=headers.add(content).find("a").filter(this.options.navigationFilter)
[0];if(current){headers.add(content).each(function(index){if($.contains(this,current)){that.options.active=Math.floor(index/2);return false;}});}}
_create.call(this);};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options,{heightStyle:null,autoHeight:true,clearStyle:false,fillSpace:false});var _create=prototype._create,_setOption=prototype._setOption;$.extend(prototype,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle();_create.call(this);},_setOption:function(key){if(key==="autoHeight"||key==="clearStyle"||key==="fillSpace"){this.options.heightStyle=this._mergeHeightStyle();}
_setOption.apply(this,arguments);},_mergeHeightStyle:function(){var options=this.options;if(options.fillSpace){return"fill";}
if(options.clearStyle){return"content";}
if(options.autoHeight){return"auto";}}});}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});var _createIcons=prototype._createIcons;prototype._createIcons=function(){if(this.options.icons){this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected;}
_createIcons.call(this);};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){prototype.activate=prototype._activate;var _findActive=prototype._findActive;prototype._findActive=function(index){if(index===-1){index=false;}
if(index&&typeof index!=="number"){index=this.headers.index(this.headers.filter(index));if(index===-1){index=false;}}
return _findActive.call(this,index);};}(jQuery,jQuery.ui.accordion.prototype));jQuery.ui.accordion.prototype.resize=jQuery.ui.accordion.prototype.refresh;(function($,prototype){$.extend(prototype.options,{change:null,changestart:null});var _trigger=prototype._trigger;prototype._trigger=function(type,event,data){var ret=_trigger.apply(this,arguments);if(!ret){return false;}
if(type==="beforeActivate"){ret=_trigger.call(this,"changestart",event,{oldHeader:data.oldHeader,oldContent:data.oldPanel,newHeader:data.newHeader,newContent:data.newPanel});}else if(type==="activate"){ret=_trigger.call(this,"change",event,{oldHeader:data.oldHeader,oldContent:data.oldPanel,newHeader:data.newHeader,newContent:data.newPanel});}
return ret;};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options,{animate:null,animated:"slide"});var _create=prototype._create;prototype._create=function(){var options=this.options;if(options.animate===null){if(!options.animated){options.animate=false;}else if(options.animated==="slide"){options.animate=300;}else if(options.animated==="bounceslide"){options.animate={duration:200,down:{easing:"easeOutBounce",duration:1000}};}else{options.animate=options.animated;}}
_create.call(this);};}(jQuery,jQuery.ui.accordion.prototype));}})(jQuery);(function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{version:"1.9.1",defaultElement:"<input>",options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var suppressKeyPress,suppressKeyPressRepeat,suppressInput;this.isMultiLine=this._isMultiLine();this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"];this.isNewMenu=true;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off");this._on(this.element,{keydown:function(event){if(this.element.prop("readOnly")){suppressKeyPress=true;suppressInput=true;suppressKeyPressRepeat=true;return;}
suppressKeyPress=false;suppressInput=false;suppressKeyPressRepeat=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=true;this._move("previousPage",event);break;case keyCode.PAGE_DOWN:suppressKeyPress=true;this._move("nextPage",event);break;case keyCode.UP:suppressKeyPress=true;this._keyEvent("previous",event);break;case keyCode.DOWN:suppressKeyPress=true;this._keyEvent("next",event);break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(this.menu.active){suppressKeyPress=true;event.preventDefault();this.menu.select(event);}
break;case keyCode.TAB:if(this.menu.active){this.menu.select(event);}
break;case keyCode.ESCAPE:if(this.menu.element.is(":visible")){this._value(this.term);this.close(event);event.preventDefault();}
break;default:suppressKeyPressRepeat=true;this._searchTimeout(event);break;}},keypress:function(event){if(suppressKeyPress){suppressKeyPress=false;event.preventDefault();return;}
if(suppressKeyPressRepeat){return;}
var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:this._move("previousPage",event);break;case keyCode.PAGE_DOWN:this._move("nextPage",event);break;case keyCode.UP:this._keyEvent("previous",event);break;case keyCode.DOWN:this._keyEvent("next",event);break;}},input:function(event){if(suppressInput){suppressInput=false;event.preventDefault();return;}
this._searchTimeout(event);},focus:function(){this.selectedItem=null;this.previous=this._value();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
clearTimeout(this.searching);this.close(event);this._change(event);}});this._initSource();this.menu=$("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:$(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu");this._on(this.menu.element,{mousedown:function(event){event.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;});var menuElement=this.menu.element[0];if(!$(event.target).closest(".ui-menu-item").length){this._delay(function(){var that=this;this.document.one("mousedown",function(event){if(event.target!==that.element[0]&&event.target!==menuElement&&!$.contains(menuElement,event.target)){that.close();}});});}},menufocus:function(event,ui){if(this.isNewMenu){this.isNewMenu=false;if(event.originalEvent&&/^mouse/.test(event.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){$(event.target).trigger(event.originalEvent);});return;}}
var item=ui.item.data("ui-autocomplete-item")||ui.item.data("item.autocomplete");if(false!==this._trigger("focus",event,{item:item})){if(event.originalEvent&&/^key/.test(event.originalEvent.type)){this._value(item.value);}}else{this.liveRegion.text(item.value);}},menuselect:function(event,ui){var item=ui.item.data("ui-autocomplete-item")||ui.item.data("item.autocomplete"),previous=this.previous;if(this.element[0]!==this.document[0].activeElement){this.element.focus();this.previous=previous;this._delay(function(){this.previous=previous;this.selectedItem=item;});}
if(false!==this._trigger("select",event,{item:item})){this._value(item.value);}
this.term=this._value();this.close(event);this.selectedItem=item;}});this.liveRegion=$("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element);if($.fn.bgiframe){this.menu.element.bgiframe();}
this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove();},_setOption:function(key,value){this._super(key,value);if(key==="source"){this._initSource();}
if(key==="appendTo"){this.menu.element.appendTo(this.document.find(value||"body")[0]);}
if(key==="disabled"&&value&&this.xhr){this.xhr.abort();}},_isMultiLine:function(){if(this.element.is("textarea")){return true;}
if(this.element.is("input")){return false;}
return this.element.prop("isContentEditable");},_initSource:function(){var array,url,that=this;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(that.xhr){that.xhr.abort();}
that.xhr=$.ajax({url:url,data:request,dataType:"json",success:function(data){response(data);},error:function(){response([]);}});};}else{this.source=this.options.source;}},_searchTimeout:function(event){clearTimeout(this.searching);this.searching=this._delay(function(){if(this.term!==this._value()){this.selectedItem=null;this.search(null,event);}},this.options.delay);},search:function(value,event){value=value!=null?value:this._value();this.term=this._value();if(value.length<this.options.minLength){return this.close(event);}
if(this._trigger("search",event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this.element.addClass("ui-autocomplete-loading");this.cancelSearch=false;this.source({term:value},this._response());},_response:function(){var that=this,index=++requestIndex;return function(content){if(index===requestIndex){that.__response(content);}
that.pending--;if(!that.pending){that.element.removeClass("ui-autocomplete-loading");}};},__response:function(content){if(content){content=this._normalize(content);}
this._trigger("response",null,{content:content});if(!this.options.disabled&&content&&content.length&&!this.cancelSearch){this._suggest(content);this._trigger("open");}else{this._close();}},close:function(event){this.cancelSearch=true;this._close(event);},_close:function(event){if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger("close",event);}},_change:function(event){if(this.previous!==this._value()){this._trigger("change",event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};}
return $.extend({label:item.label||item.value,value:item.value||item.label},item);});},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items);this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next();}},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth()+1,this.element.outerWidth()));},_renderMenu:function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item);});},_renderItemData:function(ul,item){return this._renderItem(ul,item).data("ui-autocomplete-item",item);},_renderItem:function(ul,item){return $("<li>").append($("<a>").text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.isFirstItem()&&/^previous/.test(direction)||this.menu.isLastItem()&&/^next/.test(direction)){this._value(this.term);this.menu.blur();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;},_value:function(){return this.valueMethod.apply(this.element,arguments);},_keyEvent:function(keyEvent,event){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(keyEvent,event);event.preventDefault();}}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});$.widget("ui.autocomplete",$.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(amount){return amount+(amount>1?" results are":" result is")+" available, use up and down arrow keys to navigate.";}}},__response:function(content){var message;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return;}
if(content&&content.length){message=this.options.messages.results(content.length);}else{message=this.options.messages.noResults;}
this.liveRegion.text(message);}});}(jQuery));(function($,undefined){var lastActive,startXPos,startYPos,clickDragged,baseClasses="ui-button ui-widget ui-state-default ui-corner-all",stateClasses="ui-state-hover ui-state-active ",typeClasses="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",formResetHandler=function(){var buttons=$(this).find(":ui-button");setTimeout(function(){buttons.button("refresh");},1);},radioGroup=function(radio){var name=radio.name,form=radio.form,radios=$([]);if(name){if(form){radios=$(form).find("[name='"+name+"']");}else{radios=$("[name='"+name+"']",radio.ownerDocument).filter(function(){return!this.form;});}}
return radios;};$.widget("ui.button",{version:"1.9.1",defaultElement:"<button>",options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,formResetHandler);if(typeof this.options.disabled!=="boolean"){this.options.disabled=!!this.element.prop("disabled");}else{this.element.prop("disabled",this.options.disabled);}
this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var that=this,options=this.options,toggleButton=this.type==="checkbox"||this.type==="radio",hoverClass="ui-state-hover"+(!toggleButton?" ui-state-active":""),focusClass="ui-state-focus";if(options.label===null){options.label=(this.type==="input"?this.buttonElement.val():this.buttonElement.html());}
this.buttonElement.addClass(baseClasses).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(options.disabled){return;}
$(this).addClass("ui-state-hover");if(this===lastActive){$(this).addClass("ui-state-active");}}).bind("mouseleave"+this.eventNamespace,function(){if(options.disabled){return;}
$(this).removeClass(hoverClass);}).bind("click"+this.eventNamespace,function(event){if(options.disabled){event.preventDefault();event.stopImmediatePropagation();}});this.element.bind("focus"+this.eventNamespace,function(){that.buttonElement.addClass(focusClass);}).bind("blur"+this.eventNamespace,function(){that.buttonElement.removeClass(focusClass);});if(toggleButton){this.element.bind("change"+this.eventNamespace,function(){if(clickDragged){return;}
that.refresh();});this.buttonElement.bind("mousedown"+this.eventNamespace,function(event){if(options.disabled){return;}
clickDragged=false;startXPos=event.pageX;startYPos=event.pageY;}).bind("mouseup"+this.eventNamespace,function(event){if(options.disabled){return;}
if(startXPos!==event.pageX||startYPos!==event.pageY){clickDragged=true;}});}
if(this.type==="checkbox"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(options.disabled||clickDragged){return false;}
$(this).toggleClass("ui-state-active");that.buttonElement.attr("aria-pressed",that.element[0].checked);});}else if(this.type==="radio"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(options.disabled||clickDragged){return false;}
$(this).addClass("ui-state-active");that.buttonElement.attr("aria-pressed","true");var radio=that.element[0];radioGroup(radio).not(radio).map(function(){return $(this).button("widget")[0];}).removeClass("ui-state-active").attr("aria-pressed","false");});}else{this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(options.disabled){return false;}
$(this).addClass("ui-state-active");lastActive=this;that.document.one("mouseup",function(){lastActive=null;});}).bind("mouseup"+this.eventNamespace,function(){if(options.disabled){return false;}
$(this).removeClass("ui-state-active");}).bind("keydown"+this.eventNamespace,function(event){if(options.disabled){return false;}
if(event.keyCode===$.ui.keyCode.SPACE||event.keyCode===$.ui.keyCode.ENTER){$(this).addClass("ui-state-active");}}).bind("keyup"+this.eventNamespace,function(){$(this).removeClass("ui-state-active");});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(event){if(event.keyCode===$.ui.keyCode.SPACE){$(this).click();}});}}
this._setOption("disabled",options.disabled);this._resetButton();},_determineButtonType:function(){var ancestor,labelSelector,checked;if(this.element.is("[type=checkbox]")){this.type="checkbox";}else if(this.element.is("[type=radio]")){this.type="radio";}else if(this.element.is("input")){this.type="input";}else{this.type="button";}
if(this.type==="checkbox"||this.type==="radio"){ancestor=this.element.parents().last();labelSelector="label[for='"+this.element.attr("id")+"']";this.buttonElement=ancestor.find(labelSelector);if(!this.buttonElement.length){ancestor=ancestor.length?ancestor.siblings():this.element.siblings();this.buttonElement=ancestor.filter(labelSelector);if(!this.buttonElement.length){this.buttonElement=ancestor.find(labelSelector);}}
this.element.addClass("ui-helper-hidden-accessible");checked=this.element.is(":checked");if(checked){this.buttonElement.addClass("ui-state-active");}
this.buttonElement.prop("aria-pressed",checked);}else{this.buttonElement=this.element;}},widget:function(){return this.buttonElement;},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass(baseClasses+" "+stateClasses+" "+typeClasses).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());if(!this.hasTitle){this.buttonElement.removeAttr("title");}},_setOption:function(key,value){this._super(key,value);if(key==="disabled"){if(value){this.element.prop("disabled",true);}else{this.element.prop("disabled",false);}
return;}
this._resetButton();},refresh:function(){var isDisabled=this.element.is(":disabled")||this.element.hasClass("ui-button-disabled");if(isDisabled!==this.options.disabled){this._setOption("disabled",isDisabled);}
if(this.type==="radio"){radioGroup(this.element[0]).each(function(){if($(this).is(":checked")){$(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true");}else{$(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false");}});}else if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true");}else{this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false");}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label);}
return;}
var buttonElement=this.buttonElement.removeClass(typeClasses),buttonText=$("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(buttonElement.empty()).text(),icons=this.options.icons,multipleIcons=icons.primary&&icons.secondary,buttonClasses=[];if(icons.primary||icons.secondary){if(this.options.text){buttonClasses.push("ui-button-text-icon"+(multipleIcons?"s":(icons.primary?"-primary":"-secondary")));}
if(icons.primary){buttonElement.prepend("<span class='ui-button-icon-primary ui-icon "+icons.primary+"'></span>");}
if(icons.secondary){buttonElement.append("<span class='ui-button-icon-secondary ui-icon "+icons.secondary+"'></span>");}
if(!this.options.text){buttonClasses.push(multipleIcons?"ui-button-icons-only":"ui-button-icon-only");if(!this.hasTitle){buttonElement.attr("title",$.trim(buttonText));}}}else{buttonClasses.push("ui-button-text-only");}
buttonElement.addClass(buttonClasses.join(" "));}});$.widget("ui.buttonset",{version:"1.9.1",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset");},_init:function(){this.refresh();},_setOption:function(key,value){if(key==="disabled"){this.buttons.button("option",key,value);}
this._super(key,value);},refresh:function(){var rtl=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(rtl?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(rtl?"ui-corner-left":"ui-corner-right").end().end();},_destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");}});}(jQuery));(function($,undefined){$.extend($.ui,{datepicker:{version:"1.9.1"}});var PROP_NAME='datepicker';var dpuuid=new Date().getTime();var instActive;function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId='ui-datepicker-div';this._inlineClass='ui-datepicker-inline';this._appendClass='ui-datepicker-append';this._triggerClass='ui-datepicker-trigger';this._dialogClass='ui-datepicker-dialog';this._disableClass='ui-datepicker-disabled';this._unselectableClass='ui-datepicker-unselectable';this._currentClass='ui-datepicker-current-day';this._dayOverClass='ui-datepicker-days-cell-over';this.regional=[];this.regional['']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'mm/dd/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};this._defaults={showOn:'focus',showAnim:'fadeIn',showOptions:{},defaultDate:null,appendText:'',buttonText:'...',buttonImage:'',buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:'c-10:c+10',showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:'+10',minDate:null,maxDate:null,duration:'fast',beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:'',altFormat:'',constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional['']);this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'));}
$.extend(Datepicker.prototype,{markerClassName:'hasDatepicker',maxRows:4,log:function(){if(this.debug)
console.log.apply('',arguments);},_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute('date:'+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=='div'||nodeName=='span');if(!target.id){this.uuid+=1;target.id='dp'+this.uuid;}
var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=='input'){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,'\\\\$1');return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName))
return;this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});this._autoSize(inst);$.data(target,PROP_NAME,inst);if(inst.settings.disabled){this._disableDatepicker(target);}},_attachments:function(input,inst){var appendText=this._get(inst,'appendText');var isRTL=this._get(inst,'isRTL');if(inst.append)
inst.append.remove();if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+'</span>');input[isRTL?'before':'after'](inst.append);}
input.unbind('focus',this._showDatepicker);if(inst.trigger)
inst.trigger.remove();var showOn=this._get(inst,'showOn');if(showOn=='focus'||showOn=='both')
input.focus(this._showDatepicker);if(showOn=='button'||showOn=='both'){var buttonText=this._get(inst,'buttonText');var buttonImage=this._get(inst,'buttonImage');inst.trigger=$(this._get(inst,'buttonImageOnly')?$('<img/>').addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==''?buttonText:$('<img/>').attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?'before':'after'](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==input[0])
$.datepicker._hideDatepicker();else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!=input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0]);}else
$.datepicker._showDatepicker(input[0]);return false;});}},_autoSize:function(inst){if(this._get(inst,'autoSize')&&!inst.inline){var date=new Date(2009,12-1,20);var dateFormat=this._get(inst,'dateFormat');if(dateFormat.match(/[DM]/)){var findMax=function(names){var max=0;var maxI=0;for(var i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?'monthNames':'monthNamesShort'))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?'dayNames':'dayNamesShort')))+20-date.getDay());}
inst.input.attr('size',this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName))
return;divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target);}
inst.dpDiv.css("display","block");},_dialogDatepicker:function(input,date,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){this.uuid+=1;var id='dp'+this.uuid;this._dialogInput=$('<input type="text" id="'+id+'" style="position: absolute; top: -100px; width: 0px;"/>');this._dialogInput.keydown(this._doKeyDown);$('body').append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst);}
extendRemove(inst.settings,settings||{});date=(date&&date.constructor==Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=document.documentElement.clientWidth;var browserHeight=document.documentElement.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css('left',(this._pos[0]+20)+'px').css('top',this._pos[1]+'px');inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI)
$.blockUI(this.dpDiv);$.data(this._dialogInput[0],PROP_NAME,inst);return this;},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=='input'){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind('focus',this._showDatepicker).unbind('keydown',this._doKeyDown).unbind('keypress',this._doKeyPress).unbind('keyup',this._doKeyUp);}else if(nodeName=='div'||nodeName=='span')
$target.removeClass(this.markerClassName).empty();},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=false;inst.trigger.filter('button').each(function(){this.disabled=false;}).end().filter('img').css({opacity:'1.0',cursor:''});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().removeClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=true;inst.trigger.filter('button').each(function(){this.disabled=true;}).end().filter('img').css({opacity:'0.5',cursor:'default'});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().addClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target)
return true;}
return false;},_getInst:function(target){try{return $.data(target,PROP_NAME);}
catch(err){throw'Missing instance data for this datepicker';}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=='string'){return(name=='defaults'?$.extend({},$.datepicker._defaults):(inst?(name=='all'?$.extend({},inst.settings):this._get(inst,name)):null));}
var settings=name||{};if(typeof name=='string'){settings={};settings[name]=value;}
if(inst){if(this._curInst==inst){this._hideDatepicker();}
var date=this._getDateDatepicker(target,true);var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');extendRemove(inst.settings,settings);if(minDate!==null&&settings['dateFormat']!==undefined&&settings['minDate']===undefined)
inst.settings.minDate=this._formatDate(inst,minDate);if(maxDate!==null&&settings['dateFormat']!==undefined&&settings['maxDate']===undefined)
inst.settings.maxDate=this._formatDate(inst,maxDate);this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline)
this._setDateFromField(inst,noDefault);return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is('.ui-datepicker-rtl');inst._keyEvent=true;if($.datepicker._datepickerShowing)
switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:var sel=$('td.'+$.datepicker._dayOverClass+':not(.'+
$.datepicker._currentClass+')',inst.dpDiv);if(sel[0])
$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);var onSelect=$.datepicker._get(inst,'onSelect');if(onSelect){var dateStr=$.datepicker._formatDate(inst);onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}
else
$.datepicker._hideDatepicker();return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 35:if(event.ctrlKey||event.metaKey)$.datepicker._clearDate(event.target);handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey)$.datepicker._gotoToday(event.target);handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?+1:-1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 38:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,-7,'D');handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?-1:+1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 40:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,+7,'D');handled=event.ctrlKey||event.metaKey;break;default:handled=false;}
else if(event.keyCode==36&&event.ctrlKey)
$.datepicker._showDatepicker(this);else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,'constrainInput')){var chars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat'));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<' '||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var inst=$.datepicker._getInst(event.target);if(inst.input.val()!=inst.lastVal){try{var date=$.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}
catch(err){$.datepicker.log(err);}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!='input')
input=$('input',input.parentNode)[0];if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input)
return;var inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!=inst){$.datepicker._curInst.dpDiv.stop(true,true);if(inst&&$.datepicker._datepickerShowing){$.datepicker._hideDatepicker($.datepicker._curInst.input[0]);}}
var beforeShow=$.datepicker._get(inst,'beforeShow');var beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return;}
extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog)
input.value='';if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css('position')=='fixed';return!isFixed;});var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:'absolute',display:'block',top:'-1000px'});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?'static':(isFixed?'fixed':'absolute')),display:'none',left:offset.left+'px',top:offset.top+'px'});if(!inst.inline){var showAnim=$.datepicker._get(inst,'showAnim');var duration=$.datepicker._get(inst,'duration');var postProcess=function(){var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){var borders=$.datepicker._getBorders(inst.dpDiv);cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()});}};inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim]))
inst.dpDiv.show(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[showAnim||'show']((showAnim?duration:null),postProcess);if(!showAnim||!duration)
postProcess();if(inst.input.is(':visible')&&!inst.input.is(':disabled'))
inst.input.focus();$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){this.maxRows=4;var borders=$.datepicker._getBorders(inst.dpDiv);instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}
inst.dpDiv.find('.'+this._dayOverClass+' a').mouseover();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');if(cols>1)
inst.dpDiv.addClass('ui-datepicker-multi-'+cols).css('width',(width*cols)+'em');inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?'add':'remove')+'Class']('ui-datepicker-multi');inst.dpDiv[(this._get(inst,'isRTL')?'add':'remove')+'Class']('ui-datepicker-rtl');if(inst==$.datepicker._curInst&&$.datepicker._datepickerShowing&&inst.input&&inst.input.is(':visible')&&!inst.input.is(':disabled')&&inst.input[0]!=document.activeElement)
inst.input.focus();if(inst.yearshtml){var origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find('select.ui-datepicker-year:first').replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}},_getBorders:function(elem){var convert=function(value){return{thin:1,medium:2,thick:3}[value]||value;};return[parseFloat(convert(elem.css('border-left-width'))),parseFloat(convert(elem.css('border-top-width')))];},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=document.documentElement.clientWidth+(isFixed?0:$(document).scrollLeft());var viewHeight=document.documentElement.clientHeight+(isFixed?0:$(document).scrollTop());offset.left-=(this._get(inst,'isRTL')?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var inst=this._getInst(obj);var isRTL=this._get(inst,'isRTL');while(obj&&(obj.type=='hidden'||obj.nodeType!=1||$.expr.filters.hidden(obj))){obj=obj[isRTL?'previousSibling':'nextSibling'];}
var position=$(obj).offset();return[position.left,position.top];},_hideDatepicker:function(input){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME)))
return;if(this._datepickerShowing){var showAnim=this._get(inst,'showAnim');var duration=this._get(inst,'duration');var postProcess=function(){$.datepicker._tidyDialog(inst);};if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim]))
inst.dpDiv.hide(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[(showAnim=='slideDown'?'slideUp':(showAnim=='fadeIn'?'fadeOut':'hide'))]((showAnim?duration:null),postProcess);if(!showAnim)
postProcess();this._datepickerShowing=false;var onClose=this._get(inst,'onClose');if(onClose)
onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():''),inst]);this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:'absolute',left:'0',top:'-100px'});if($.blockUI){$.unblockUI();$('body').append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind('.ui-datepicker-calendar');},_checkExternalClick:function(event){if(!$.datepicker._curInst)
return;var $target=$(event.target),inst=$.datepicker._getInst($target[0]);if((($target[0].id!=$.datepicker._mainDivId&&$target.parents('#'+$.datepicker._mainDivId).length==0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)))||($target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=inst))
$.datepicker._hideDatepicker();},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset+
(period=='M'?this._get(inst,'showCurrentAtPos'):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,'gotoCurrent')&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}
else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst['selected'+(period=='M'?'Month':'Year')]=inst['draw'+(period=='M'?'Month':'Year')]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$('a',td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);this._selectDate(target,'');},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input)
inst.input.val(dateStr);this._updateAlternate(inst);var onSelect=this._get(inst,'onSelect');if(onSelect)
onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);else if(inst.input)
inst.input.trigger('change');if(inst.inline)
this._updateDatepicker(inst);else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!='object')
inst.input.focus();this._lastInput=null;}},_updateAlternate:function(inst){var altField=this._get(inst,'altField');if(altField){var altFormat=this._get(inst,'altFormat')||this._get(inst,'dateFormat');var date=this._getDate(inst);var dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),''];},iso8601Week:function(date){var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null)
throw'Invalid arguments';value=(typeof value=='object'?value.toString():value+'');if(value=='')
return null;var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var getNumber=function(match){var isDoubled=lookAhead(match);var size=(match=='@'?14:(match=='!'?20:(match=='y'&&isDoubled?4:(match=='o'?3:2))));var digits=new RegExp('^\\d{1,'+size+'}');var num=value.substring(iValue).match(digits);if(!num)
throw'Missing number at position '+iValue;iValue+=num[0].length;return parseInt(num[0],10);};var getName=function(match,shortNames,longNames){var names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});var index=-1;$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()==name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!=-1)
return index+1;else
throw'Unknown name at position '+iValue;};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat))
throw'Unexpected literal at position '+iValue;iValue++;};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
checkLiteral();else
switch(format.charAt(iFormat)){case'd':day=getNumber('d');break;case'D':getName('D',dayNamesShort,dayNames);break;case'o':doy=getNumber('o');break;case'm':month=getNumber('m');break;case'M':month=getName('M',monthNamesShort,monthNames);break;case'y':year=getNumber('y');break;case'@':var date=new Date(getNumber('@'));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case'!':var date=new Date((getNumber('!')-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'"))
checkLiteral();else
literal=true;break;default:checkLiteral();}}
if(iValue<value.length){var extra=value.substr(iValue);if(!/^\s+/.test(extra)){throw"Extra/unparsed characters found in date: "+extra;}}
if(year==-1)
year=new Date().getFullYear();else if(year<100)
year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim)
break;month++;day-=dim;}while(true);}
var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day)
throw'Invalid date';return date;},ATOM:'yy-mm-dd',COOKIE:'D, dd M yy',ISO_8601:'yy-mm-dd',RFC_822:'D, d M y',RFC_850:'DD, dd-M-y',RFC_1036:'D, d M y',RFC_1123:'D, d M yy',RFC_2822:'D, d M yy',RSS:'D, d M y',TICKS:'!',TIMESTAMP:'@',W3C:'yy-mm-dd',_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date)
return'';var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var formatNumber=function(match,value,len){var num=''+value;if(lookAhead(match))
while(num.length<len)
num='0'+num;return num;};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);};var output='';var literal=false;if(date)
for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
output+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':output+=formatNumber('d',date.getDate(),2);break;case'D':output+=formatName('D',date.getDay(),dayNamesShort,dayNames);break;case'o':output+=formatNumber('o',Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case'm':output+=formatNumber('m',date.getMonth()+1,2);break;case'M':output+=formatName('M',date.getMonth(),monthNamesShort,monthNames);break;case'y':output+=(lookAhead('y')?date.getFullYear():(date.getYear()%100<10?'0':'')+date.getYear()%100);break;case'@':output+=date.getTime();break;case'!':output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'"))
output+="'";else
literal=true;break;default:output+=format.charAt(iFormat);}}
return output;},_possibleChars:function(format){var chars='';var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};for(var iFormat=0;iFormat<format.length;iFormat++)
if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
chars+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':case'm':case'y':case'@':chars+='0123456789';break;case'D':case'M':return null;case"'":if(lookAhead("'"))
chars+="'";else
literal=true;break;default:chars+=format.charAt(iFormat);}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()==inst.lastVal){return;}
var dateFormat=this._get(inst,'dateFormat');var dates=inst.lastVal=inst.input?inst.input.val():null;var date,defaultDate;date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){this.log(event);dates=(noDefault?'':dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,'defaultDate'),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;};var offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),offset,$.datepicker._getFormatConfig(inst));}
catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||'d'){case'd':case'D':day+=parseInt(matches[1],10);break;case'w':case'W':day+=parseInt(matches[1],10)*7;break;case'm':case'M':month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case'y':case'Y':year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);};var newDate=(date==null||date===''?defaultDate:(typeof date=='string'?offsetString(date):(typeof date=='number'?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()=='Invalid Date'?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date)return null;date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date;var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;var newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!=inst.selectedMonth||origYear!=inst.selectedYear)&&!noChange)
this._notifyChange(inst);this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?'':this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=='')?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_attachHandlers:function(inst){var stepMonths=this._get(inst,'stepMonths');var id='#'+inst.id.replace(/\\\\/g,"\\");inst.dpDiv.find('[data-handler]').map(function(){var handler={prev:function(){window['DP_jQuery_'+dpuuid].datepicker._adjustDate(id,-stepMonths,'M');},next:function(){window['DP_jQuery_'+dpuuid].datepicker._adjustDate(id,+stepMonths,'M');},hide:function(){window['DP_jQuery_'+dpuuid].datepicker._hideDatepicker();},today:function(){window['DP_jQuery_'+dpuuid].datepicker._gotoToday(id);},selectDay:function(){window['DP_jQuery_'+dpuuid].datepicker._selectDay(id,+this.getAttribute('data-month'),+this.getAttribute('data-year'),this);return false;},selectMonth:function(){window['DP_jQuery_'+dpuuid].datepicker._selectMonthYear(id,this,'M');return false;},selectYear:function(){window['DP_jQuery_'+dpuuid].datepicker._selectMonthYear(id,this,'Y');return false;}};$(this).bind(this.getAttribute('data-event'),handler[this.getAttribute('data-handler')]);});},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,'isRTL');var showButtonPanel=this._get(inst,'showButtonPanel');var hideIfNoPrevNext=this._get(inst,'hideIfNoPrevNext');var navigationAsDateFormat=this._get(inst,'navigationAsDateFormat');var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,'showCurrentAtPos');var stepMonths=this._get(inst,'stepMonths');var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,'prevText');prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click"'+' title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>'));var nextText=this._get(inst,'nextText');nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click"'+' title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>'));var currentText=this._get(inst,'currentText');var gotoDate=(this._get(inst,'gotoCurrent')&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+
this._get(inst,'closeText')+'</button>':'');var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:'')+
(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click"'+'>'+currentText+'</button>':'')+(isRTL?'':controls)+'</div>':'';var firstDay=parseInt(this._get(inst,'firstDay'),10);firstDay=(isNaN(firstDay)?0:firstDay);var showWeek=this._get(inst,'showWeek');var dayNames=this._get(inst,'dayNames');var dayNamesShort=this._get(inst,'dayNamesShort');var dayNamesMin=this._get(inst,'dayNamesMin');var monthNames=this._get(inst,'monthNames');var monthNamesShort=this._get(inst,'monthNamesShort');var beforeShowDay=this._get(inst,'beforeShowDay');var showOtherMonths=this._get(inst,'showOtherMonths');var selectOtherMonths=this._get(inst,'selectOtherMonths');var calculateWeek=this._get(inst,'calculateWeek')||this.iso8601Week;var defaultDate=this._getDefaultDate(inst);var html='';for(var row=0;row<numMonths[0];row++){var group='';this.maxRows=4;for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=' ui-corner-all';var calender='';if(isMultiMonth){calender+='<div class="ui-datepicker-group';if(numMonths[1]>1)
switch(col){case 0:calender+=' ui-datepicker-group-first';cornerClass=' ui-corner-'+(isRTL?'right':'left');break;case numMonths[1]-1:calender+=' ui-datepicker-group-last';cornerClass=' ui-corner-'+(isRTL?'left':'right');break;default:calender+=' ui-datepicker-group-middle';cornerClass='';break;}
calender+='">';}
calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+
(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):'')+
(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):'')+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead>'+'<tr>';var thead=(showWeek?'<th class="ui-datepicker-week-col">'+this._get(inst,'weekHeader')+'</th>':'');for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+='<th'+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':'')+'>'+'<span title="'+dayNames[day]+'">'+dayNamesMin[day]+'</span></th>';}
calender+=thead+'</tr></thead><tbody>';var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth)
inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var curRows=Math.ceil((leadDays+daysInMonth)/7);var numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+='<tr>';var tbody=(!showWeek?'':'<td class="ui-datepicker-week-col">'+
this._get(inst,'calculateWeek')(printDate)+'</td>');for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,'']);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+
((dow+firstDay+6)%7>=5?' ui-datepicker-week-end':'')+
(otherMonth?' ui-datepicker-other-month':'')+
((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?' '+this._dayOverClass:'')+
(unselectable?' '+this._unselectableClass+' ui-state-disabled':'')+
(otherMonth&&!showOtherMonths?'':' '+daySettings[1]+
(printDate.getTime()==currentDate.getTime()?' '+this._currentClass:'')+
(printDate.getTime()==today.getTime()?' ui-datepicker-today':''))+'"'+
((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':'')+
(unselectable?'':' data-handler="selectDay" data-event="click" data-month="'+printDate.getMonth()+'" data-year="'+printDate.getFullYear()+'"')+'>'+
(otherMonth&&!showOtherMonths?'&#xa0;':(unselectable?'<span class="ui-state-default">'+printDate.getDate()+'</span>':'<a class="ui-state-default'+
(printDate.getTime()==today.getTime()?' ui-state-highlight':'')+
(printDate.getTime()==currentDate.getTime()?' ui-state-active':'')+
(otherMonth?' ui-priority-secondary':'')+'" href="#">'+printDate.getDate()+'</a>'))+'</td>';printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+'</tr>';}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+='</tbody></table>'+(isMultiMonth?'</div>'+
((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':''):'');group+=calender;}
html+=group;}
html+=buttonPanel+($.ui.ie6&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':'');inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var changeMonth=this._get(inst,'changeMonth');var changeYear=this._get(inst,'changeYear');var showMonthAfterYear=this._get(inst,'showMonthAfterYear');var html='<div class="ui-datepicker-title">';var monthHtml='';if(secondary||!changeMonth)
monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+'</span>';else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth()))
monthHtml+='<option value="'+month+'"'+
(month==drawMonth?' selected="selected"':'')+'>'+monthNamesShort[month]+'</option>';}
monthHtml+='</select>';}
if(!showMonthAfterYear)
html+=monthHtml+(secondary||!(changeMonth&&changeYear)?'&#xa0;':'');if(!inst.yearshtml){inst.yearshtml='';if(secondary||!changeYear)
html+='<span class="ui-datepicker-year">'+drawYear+'</span>';else{var years=this._get(inst,'yearRange').split(':');var thisYear=new Date().getFullYear();var determineYear=function(value){var year=(value.match(/c[+-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};var year=determineYear(years[0]);var endYear=Math.max(year,determineYear(years[1]||''));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';for(;year<=endYear;year++){inst.yearshtml+='<option value="'+year+'"'+
(year==drawYear?' selected="selected"':'')+'>'+year+'</option>';}
inst.yearshtml+='</select>';html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,'yearSuffix');if(showMonthAfterYear)
html+=(secondary||!(changeMonth&&changeYear)?'&#xa0;':'')+monthHtml;html+='</div>';return html;},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=='Y'?offset:0);var month=inst.drawMonth+(period=='M'?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+
(period=='D'?offset:0);var date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=='M'||period=='Y')
this._notifyChange(inst);},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var newDate=(minDate&&date<minDate?minDate:date);newDate=(maxDate&&newDate>maxDate?maxDate:newDate);return newDate;},_notifyChange:function(inst){var onChange=this._get(inst,'onChangeMonthYear');if(onChange)
onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,'numberOfMonths');return(numMonths==null?[1,1]:(typeof numMonths=='number'?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+'Date'),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0)
date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));return this._isInRange(inst,date);},_isInRange:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime()));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,'shortYearCutoff');shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,'dayNamesShort'),dayNames:this._get(inst,'dayNames'),monthNamesShort:this._get(inst,'monthNamesShort'),monthNames:this._get(inst,'monthNames')};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day=='object'?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,'dateFormat'),date,this._getFormatConfig(inst));}});function bindHover(dpDiv){var selector='button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a';return dpDiv.delegate(selector,'mouseout',function(){$(this).removeClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!=-1)$(this).removeClass('ui-datepicker-prev-hover');if(this.className.indexOf('ui-datepicker-next')!=-1)$(this).removeClass('ui-datepicker-next-hover');}).delegate(selector,'mouseover',function(){if(!$.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])){$(this).parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');$(this).addClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!=-1)$(this).addClass('ui-datepicker-prev-hover');if(this.className.indexOf('ui-datepicker-next')!=-1)$(this).addClass('ui-datepicker-next-hover');}});}
function extendRemove(target,props){$.extend(target,props);for(var name in props)
if(props[name]==null||props[name]==undefined)
target[name]=props[name];return target;};$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find(document.body).append($.datepicker.dpDiv);$.datepicker.initialized=true;}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=='string'&&(options=='isDisabled'||options=='getDate'||options=='widget'))
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));if(options=='option'&&arguments.length==2&&typeof arguments[1]=='string')
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));return this.each(function(){typeof options=='string'?$.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.9.1";window['DP_jQuery_'+dpuuid]=$;})(jQuery);(function($,undefined){var uiDialogClasses="ui-dialog ui-widget ui-widget-content ui-corner-all ",sizeRelatedOptions={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true};$.widget("ui.dialog",{version:"1.9.1",options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",of:window,collision:"fit",using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css("top",pos.top-topOffset);}}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string"){this.originalTitle="";}
this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)};this.options.title=this.options.title||this.originalTitle;var that=this,options=this.options,title=options.title||"&#160;",uiDialog,uiDialogTitlebar,uiDialogTitlebarClose,uiDialogTitle,uiDialogButtonPane;uiDialog=(this.uiDialog=$("<div>")).addClass(uiDialogClasses+options.dialogClass).css({display:"none",outline:0,zIndex:options.zIndex}).attr("tabIndex",-1).keydown(function(event){if(options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){that.close(event);event.preventDefault();}}).mousedown(function(event){that.moveToTop(false,event);}).appendTo("body");this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(uiDialog);uiDialogTitlebar=(this.uiDialogTitlebar=$("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  "+"ui-corner-all  ui-helper-clearfix").bind("mousedown",function(){uiDialog.focus();}).prependTo(uiDialog);uiDialogTitlebarClose=$("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(event){event.preventDefault();that.close(event);}).appendTo(uiDialogTitlebar);(this.uiDialogTitlebarCloseText=$("<span>")).addClass("ui-icon ui-icon-closethick").text(options.closeText).appendTo(uiDialogTitlebarClose);uiDialogTitle=$("<span>").uniqueId().addClass("ui-dialog-title").html(title).prependTo(uiDialogTitlebar);uiDialogButtonPane=(this.uiDialogButtonPane=$("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");(this.uiButtonSet=$("<div>")).addClass("ui-dialog-buttonset").appendTo(uiDialogButtonPane);uiDialog.attr({role:"dialog","aria-labelledby":uiDialogTitle.attr("id")});uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();this._hoverable(uiDialogTitlebarClose);this._focusable(uiDialogTitlebarClose);if(options.draggable&&$.fn.draggable){this._makeDraggable();}
if(options.resizable&&$.fn.resizable){this._makeResizable();}
this._createButtons(options.buttons);this._isOpen=false;if($.fn.bgiframe){uiDialog.bgiframe();}
this._on(uiDialog,{keydown:function(event){if(!options.modal||event.keyCode!==$.ui.keyCode.TAB){return;}
var tabbables=$(":tabbable",uiDialog),first=tabbables.filter(":first"),last=tabbables.filter(":last");if(event.target===last[0]&&!event.shiftKey){first.focus(1);return false;}else if(event.target===first[0]&&event.shiftKey){last.focus(1);return false;}}});},_init:function(){if(this.options.autoOpen){this.open();}},_destroy:function(){var next,oldPosition=this.oldPosition;if(this.overlay){this.overlay.destroy();}
this.uiDialog.hide();this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();if(this.originalTitle){this.element.attr("title",this.originalTitle);}
next=oldPosition.parent.children().eq(oldPosition.index);if(next.length&&next[0]!==this.element[0]){next.before(this.element);}else{oldPosition.parent.append(this.element);}},widget:function(){return this.uiDialog;},close:function(event){var that=this,maxZ,thisZ;if(!this._isOpen){return;}
if(false===this._trigger("beforeClose",event)){return;}
this._isOpen=false;if(this.overlay){this.overlay.destroy();}
if(this.options.hide){this._hide(this.uiDialog,this.options.hide,function(){that._trigger("close",event);});}else{this.uiDialog.hide();this._trigger("close",event);}
$.ui.dialog.overlay.resize();if(this.options.modal){maxZ=0;$(".ui-dialog").each(function(){if(this!==that.uiDialog[0]){thisZ=$(this).css("z-index");if(!isNaN(thisZ)){maxZ=Math.max(maxZ,thisZ);}}});$.ui.dialog.maxZ=maxZ;}
return this;},isOpen:function(){return this._isOpen;},moveToTop:function(force,event){var options=this.options,saveScroll;if((options.modal&&!force)||(!options.stack&&!options.modal)){return this._trigger("focus",event);}
if(options.zIndex>$.ui.dialog.maxZ){$.ui.dialog.maxZ=options.zIndex;}
if(this.overlay){$.ui.dialog.maxZ+=1;$.ui.dialog.overlay.maxZ=$.ui.dialog.maxZ;this.overlay.$el.css("z-index",$.ui.dialog.overlay.maxZ);}
saveScroll={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()};$.ui.dialog.maxZ+=1;this.uiDialog.css("z-index",$.ui.dialog.maxZ);this.element.attr(saveScroll);this._trigger("focus",event);return this;},open:function(){if(this._isOpen){return;}
var hasFocus,options=this.options,uiDialog=this.uiDialog;this._size();this._position(options.position);uiDialog.show(options.show);this.overlay=options.modal?new $.ui.dialog.overlay(this):null;this.moveToTop(true);hasFocus=this.element.find(":tabbable");if(!hasFocus.length){hasFocus=this.uiDialogButtonPane.find(":tabbable");if(!hasFocus.length){hasFocus=uiDialog;}}
hasFocus.eq(0).focus();this._isOpen=true;this._trigger("open");return this;},_createButtons:function(buttons){var that=this,hasButtons=false;this.uiDialogButtonPane.remove();this.uiButtonSet.empty();if(typeof buttons==="object"&&buttons!==null){$.each(buttons,function(){return!(hasButtons=true);});}
if(hasButtons){$.each(buttons,function(name,props){props=$.isFunction(props)?{click:props,text:name}:props;var button=$("<button type='button'></button>").attr(props,true).unbind("click").click(function(){props.click.apply(that.element[0],arguments);}).appendTo(that.uiButtonSet);if($.fn.button){button.button();}});this.uiDialog.addClass("ui-dialog-buttons");this.uiDialogButtonPane.appendTo(this.uiDialog);}else{this.uiDialog.removeClass("ui-dialog-buttons");}},_makeDraggable:function(){var that=this,options=this.options;function filteredUi(ui){return{position:ui.position,offset:ui.offset};}
this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(event,ui){$(this).addClass("ui-dialog-dragging");that._trigger("dragStart",event,filteredUi(ui));},drag:function(event,ui){that._trigger("drag",event,filteredUi(ui));},stop:function(event,ui){options.position=[ui.position.left-that.document.scrollLeft(),ui.position.top-that.document.scrollTop()];$(this).removeClass("ui-dialog-dragging");that._trigger("dragStop",event,filteredUi(ui));$.ui.dialog.overlay.resize();}});},_makeResizable:function(handles){handles=(handles===undefined?this.options.resizable:handles);var that=this,options=this.options,position=this.uiDialog.css("position"),resizeHandles=typeof handles==='string'?handles:"n,e,s,w,se,sw,ne,nw";function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size};}
this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:this._minHeight(),handles:resizeHandles,start:function(event,ui){$(this).addClass("ui-dialog-resizing");that._trigger("resizeStart",event,filteredUi(ui));},resize:function(event,ui){that._trigger("resize",event,filteredUi(ui));},stop:function(event,ui){$(this).removeClass("ui-dialog-resizing");options.height=$(this).height();options.width=$(this).width();that._trigger("resizeStop",event,filteredUi(ui));$.ui.dialog.overlay.resize();}}).css("position",position).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se");},_minHeight:function(){var options=this.options;if(options.height==="auto"){return options.minHeight;}else{return Math.min(options.minHeight,options.height);}},_position:function(position){var myAt=[],offset=[0,0],isVisible;if(position){if(typeof position==="string"||(typeof position==="object"&&"0"in position)){myAt=position.split?position.split(" "):[position[0],position[1]];if(myAt.length===1){myAt[1]=myAt[0];}
$.each(["left","top"],function(i,offsetPosition){if(+myAt[i]===myAt[i]){offset[i]=myAt[i];myAt[i]=offsetPosition;}});position={my:myAt[0]+(offset[0]<0?offset[0]:"+"+offset[0])+" "+
myAt[1]+(offset[1]<0?offset[1]:"+"+offset[1]),at:myAt.join(" ")};}
position=$.extend({},$.ui.dialog.prototype.options.position,position);}else{position=$.ui.dialog.prototype.options.position;}
isVisible=this.uiDialog.is(":visible");if(!isVisible){this.uiDialog.show();}
this.uiDialog.position(position);if(!isVisible){this.uiDialog.hide();}},_setOptions:function(options){var that=this,resizableOptions={},resize=false;$.each(options,function(key,value){that._setOption(key,value);if(key in sizeRelatedOptions){resize=true;}
if(key in resizableRelatedOptions){resizableOptions[key]=value;}});if(resize){this._size();}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",resizableOptions);}},_setOption:function(key,value){var isDraggable,isResizable,uiDialog=this.uiDialog;switch(key){case"buttons":this._createButtons(value);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+value);break;case"dialogClass":uiDialog.removeClass(this.options.dialogClass).addClass(uiDialogClasses+value);break;case"disabled":if(value){uiDialog.addClass("ui-dialog-disabled");}else{uiDialog.removeClass("ui-dialog-disabled");}
break;case"draggable":isDraggable=uiDialog.is(":data(draggable)");if(isDraggable&&!value){uiDialog.draggable("destroy");}
if(!isDraggable&&value){this._makeDraggable();}
break;case"position":this._position(value);break;case"resizable":isResizable=uiDialog.is(":data(resizable)");if(isResizable&&!value){uiDialog.resizable("destroy");}
if(isResizable&&typeof value==="string"){uiDialog.resizable("option","handles",value);}
if(!isResizable&&value!==false){this._makeResizable(value);}
break;case"title":$(".ui-dialog-title",this.uiDialogTitlebar).html(""+(value||"&#160;"));break;}
this._super(key,value);},_size:function(){var nonContentHeight,minContentHeight,autoHeight,options=this.options,isVisible=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(options.minWidth>options.width){options.width=options.minWidth;}
nonContentHeight=this.uiDialog.css({height:"auto",width:options.width}).outerHeight();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);if(options.height==="auto"){if($.support.minHeight){this.element.css({minHeight:minContentHeight,height:"auto"});}else{this.uiDialog.show();autoHeight=this.element.css("height","auto").height();if(!isVisible){this.uiDialog.hide();}
this.element.height(Math.max(autoHeight,minContentHeight));}}else{this.element.height(Math.max(options.height-nonContentHeight,0));}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight());}}});$.extend($.ui.dialog,{uuid:0,maxZ:0,getTitleId:function($el){var id=$el.attr("id");if(!id){this.uuid+=1;id=this.uuid;}
return"ui-dialog-title-"+id;},overlay:function(dialog){this.$el=$.ui.dialog.overlay.create(dialog);}});$.extend($.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:$.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(event){return event+".dialog-overlay";}).join(" "),create:function(dialog){if(this.instances.length===0){setTimeout(function(){if($.ui.dialog.overlay.instances.length){$(document).bind($.ui.dialog.overlay.events,function(event){if($(event.target).zIndex()<$.ui.dialog.overlay.maxZ&&$(event.target).closest('.ui-dialog').zIndex()<$.ui.dialog.overlay.maxZ){return false;}});}},1);$(window).bind("resize.dialog-overlay",$.ui.dialog.overlay.resize);}
var $el=(this.oldInstances.pop()||$("<div>").addClass("ui-widget-overlay"));$(document).bind("keydown.dialog-overlay",function(event){var instances=$.ui.dialog.overlay.instances;if(instances.length!==0&&instances[instances.length-1]===$el&&dialog.options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){dialog.close(event);event.preventDefault();}});$el.appendTo(document.body).css({width:this.width(),height:this.height()});if($.fn.bgiframe){$el.bgiframe();}
this.instances.push($el);return $el;},destroy:function($el){var indexOf=$.inArray($el,this.instances),maxZ=0;if(indexOf!==-1){this.oldInstances.push(this.instances.splice(indexOf,1)[0]);}
if(this.instances.length===0){$([document,window]).unbind(".dialog-overlay");}
$el.height(0).width(0).remove();$.each(this.instances,function(){maxZ=Math.max(maxZ,this.css("z-index"));});this.maxZ=maxZ;},height:function(){var scrollHeight,offsetHeight;if($.ui.ie){scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(scrollHeight<offsetHeight){return $(window).height()+"px";}else{return scrollHeight+"px";}}else{return $(document).height()+"px";}},width:function(){var scrollWidth,offsetWidth;if($.ui.ie){scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(scrollWidth<offsetWidth){return $(window).width()+"px";}else{return scrollWidth+"px";}}else{return $(document).width()+"px";}},resize:function(){var $overlays=$([]);$.each($.ui.dialog.overlay.instances,function(){$overlays=$overlays.add(this);});$overlays.css({width:0,height:0}).css({width:$.ui.dialog.overlay.width(),height:$.ui.dialog.overlay.height()});}});$.extend($.ui.dialog.overlay.prototype,{destroy:function(){$.ui.dialog.overlay.destroy(this.$el);}});}(jQuery));(function($,undefined){var mouseHandled=false;$.widget("ui.menu",{version:"1.9.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,$.proxy(function(event){if(this.options.disabled){event.preventDefault();}},this));if(this.options.disabled){this.element.addClass("ui-state-disabled").attr("aria-disabled","true");}
this._on({"mousedown .ui-menu-item > a":function(event){event.preventDefault();},"click .ui-state-disabled > a":function(event){event.preventDefault();},"click .ui-menu-item:has(a)":function(event){var target=$(event.target).closest(".ui-menu-item");if(!mouseHandled&&target.not(".ui-state-disabled").length){mouseHandled=true;this.select(event);if(target.has(".ui-menu").length){this.expand(event);}else if(!this.element.is(":focus")){this.element.trigger("focus",[true]);if(this.active&&this.active.parents(".ui-menu").length===1){clearTimeout(this.timer);}}}},"mouseenter .ui-menu-item":function(event){var target=$(event.currentTarget);target.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(event,target);},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(event,keepActiveItem){var item=this.active||this.element.children(".ui-menu-item").eq(0);if(!keepActiveItem){this.focus(event,item);}},blur:function(event){this._delay(function(){if(!$.contains(this.element[0],this.document[0].activeElement)){this.collapseAll(event);}});},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(event){if(!$(event.target).closest(".ui-menu").length){this.collapseAll(event);}
mouseHandled=false;}});},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var elem=$(this);if(elem.data("ui-menu-submenu-carat")){elem.remove();}});this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content");},_keydown:function(event){var match,prev,character,skip,regex,preventDefault=true;function escape(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}
switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);break;case $.ui.keyCode.HOME:this._move("first","first",event);break;case $.ui.keyCode.END:this._move("last","last",event);break;case $.ui.keyCode.UP:this.previous(event);break;case $.ui.keyCode.DOWN:this.next(event);break;case $.ui.keyCode.LEFT:this.collapse(event);break;case $.ui.keyCode.RIGHT:if(this.active&&!this.active.is(".ui-state-disabled")){this.expand(event);}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.SPACE:this._activate(event);break;case $.ui.keyCode.ESCAPE:this.collapse(event);break;default:preventDefault=false;prev=this.previousFilter||"";character=String.fromCharCode(event.keyCode);skip=false;clearTimeout(this.filterTimer);if(character===prev){skip=true;}else{character=prev+character;}
regex=new RegExp("^"+escape(character),"i");match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text());});match=skip&&match.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):match;if(!match.length){character=String.fromCharCode(event.keyCode);regex=new RegExp("^"+escape(character),"i");match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text());});}
if(match.length){this.focus(event,match);if(match.length>1){this.previousFilter=character;this.filterTimer=this._delay(function(){delete this.previousFilter;},1000);}else{delete this.previousFilter;}}else{delete this.previousFilter;}}
if(preventDefault){event.preventDefault();}},_activate:function(event){if(!this.active.is(".ui-state-disabled")){if(this.active.children("a[aria-haspopup='true']").length){this.expand(event);}else{this.select(event);}}},refresh:function(){var menus,icon=this.options.icons.submenu,submenus=this.element.find(this.options.menus+":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"});menus=submenus.add(this.element);menus.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()});menus.children(":not(.ui-menu-item)").each(function(){var item=$(this);if(!/[^\-—–\s]/.test(item.text())){item.addClass("ui-widget-content ui-menu-divider");}});menus.children(".ui-state-disabled").attr("aria-disabled","true");submenus.each(function(){var menu=$(this),item=menu.prev("a"),submenuCarat=$("<span>").addClass("ui-menu-icon ui-icon "+icon).data("ui-menu-submenu-carat",true);item.attr("aria-haspopup","true").prepend(submenuCarat);menu.attr("aria-labelledby",item.attr("id"));});if(this.active&&!$.contains(this.element[0],this.active[0])){this.blur();}},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role];},focus:function(event,item){var nested,focused;this.blur(event,event&&event.type==="focus");this._scrollIntoView(item);this.active=item.first();focused=this.active.children("a").addClass("ui-state-focus");if(this.options.role){this.element.attr("aria-activedescendant",focused.attr("id"));}
this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");if(event&&event.type==="keydown"){this._close();}else{this.timer=this._delay(function(){this._close();},this.delay);}
nested=item.children(".ui-menu");if(nested.length&&(/^mouse/.test(event.type))){this._startOpening(nested);}
this.activeMenu=item.parent();this._trigger("focus",event,{item:item});},_scrollIntoView:function(item){var borderTop,paddingTop,offset,scroll,elementHeight,itemHeight;if(this._hasScroll()){borderTop=parseFloat($.css(this.activeMenu[0],"borderTopWidth"))||0;paddingTop=parseFloat($.css(this.activeMenu[0],"paddingTop"))||0;offset=item.offset().top-this.activeMenu.offset().top-borderTop-paddingTop;scroll=this.activeMenu.scrollTop();elementHeight=this.activeMenu.height();itemHeight=item.height();if(offset<0){this.activeMenu.scrollTop(scroll+offset);}else if(offset+itemHeight>elementHeight){this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight);}}},blur:function(event,fromFocus){if(!fromFocus){clearTimeout(this.timer);}
if(!this.active){return;}
this.active.children("a").removeClass("ui-state-focus");this.active=null;this._trigger("blur",event,{item:this.active});},_startOpening:function(submenu){clearTimeout(this.timer);if(submenu.attr("aria-hidden")!=="true"){return;}
this.timer=this._delay(function(){this._close();this._open(submenu);},this.delay);},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(submenu.parents(".ui-menu")).hide().attr("aria-hidden","true");submenu.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(position);},collapseAll:function(event,all){clearTimeout(this.timer);this.timer=this._delay(function(){var currentMenu=all?this.element:$(event&&event.target).closest(this.element.find(".ui-menu"));if(!currentMenu.length){currentMenu=this.element;}
this._close(currentMenu);this.blur(event);this.activeMenu=currentMenu;},this.delay);},_close:function(startMenu){if(!startMenu){startMenu=this.active?this.active.parent():this.element;}
startMenu.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active");},collapse:function(event){var newItem=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(newItem&&newItem.length){this._close();this.focus(event,newItem);}},expand:function(event){var newItem=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();if(newItem&&newItem.length){this._open(newItem.parent());this._delay(function(){this.focus(event,newItem);});}},next:function(event){this._move("next","first",event);},previous:function(event){this._move("prev","last",event);},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},_move:function(direction,filter,event){var next;if(this.active){if(direction==="first"||direction==="last"){next=this.active
[direction==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1);}else{next=this.active
[direction+"All"](".ui-menu-item").eq(0);}}
if(!next||!next.length||!this.active){next=this.activeMenu.children(".ui-menu-item")[filter]();}
this.focus(event,next);},nextPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isLastItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base-height<0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.children(".ui-menu-item")
[!this.active?"first":"last"]());}},previousPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isFirstItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base+height>0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.children(".ui-menu-item").first());}},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight");},select:function(event){this.active=this.active||$(event.target).closest(".ui-menu-item");var ui={item:this.active};if(!this.active.has(".ui-menu").length){this.collapseAll(event,true);}
this._trigger("select",event,ui);}});}(jQuery));(function($,undefined){$.widget("ui.progressbar",{version:"1.9.1",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue();},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove();},value:function(newValue){if(newValue===undefined){return this._value();}
this._setOption("value",newValue);return this;},_setOption:function(key,value){if(key==="value"){this.options.value=value;this._refreshValue();if(this._value()===this.options.max){this._trigger("complete");}}
this._super(key,value);},_value:function(){var val=this.options.value;if(typeof val!=="number"){val=0;}
return Math.min(this.options.max,Math.max(this.min,val));},_percentage:function(){return 100*this._value()/this.options.max;},_refreshValue:function(){var value=this.value(),percentage=this._percentage();if(this.oldValue!==value){this.oldValue=value;this._trigger("change");}
this.valueDiv.toggle(value>this.min).toggleClass("ui-corner-right",value===this.options.max).width(percentage.toFixed(0)+"%");this.element.attr("aria-valuenow",value);}});})(jQuery);(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var i,handleCount,o=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handles=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+
(o.disabled?" ui-slider-disabled ui-disabled":""));this.range=$([]);if(o.range){if(o.range===true){if(!o.values){o.values=[this._valueMin(),this._valueMin()];}
if(o.values.length&&o.values.length!==2){o.values=[o.values[0],o.values[0]];}}
this.range=$("<div></div>").appendTo(this.element).addClass("ui-slider-range"+" ui-widget-header"+
((o.range==="min"||o.range==="max")?" ui-slider-range-"+o.range:""));}
handleCount=(o.values&&o.values.length)||1;for(i=existingHandles.length;i<handleCount;i++){handles.push(handle);}
this.handles=existingHandles.add($(handles.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(event){event.preventDefault();}).mouseenter(function(){if(!o.disabled){$(this).addClass("ui-state-hover");}}).mouseleave(function(){$(this).removeClass("ui-state-hover");}).focus(function(){if(!o.disabled){$(".ui-slider .ui-state-focus").removeClass("ui-state-focus");$(this).addClass("ui-state-focus");}else{$(this).blur();}}).blur(function(){$(this).removeClass("ui-state-focus");});this.handles.each(function(i){$(this).data("ui-slider-handle-index",i);});this._on(this.handles,{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;$(event.target).addClass("ui-state-active");allowed=this._start(event,index);if(allowed===false){return;}}
break;}
step=this.options.step;if(this.options.values&&this.options.values.length){curVal=newVal=this.values(index);}else{curVal=newVal=this.value();}
switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return;}
newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return;}
newVal=this._trimAlignValue(curVal-step);break;}
this._slide(event,index,newVal);},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);$(event.target).removeClass("ui-state-active");}}});this._refreshValue();this._animateOff=false;},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-slider-disabled"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy();},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false;}
this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if(distance>thisDistance){distance=thisDistance;closestHandle=$(this);index=i;}});if(o.range===true&&this.values(1)===o.min){index+=1;closestHandle=$(this.handles[index]);}
allowed=this._start(event,index);if(allowed===false){return false;}
this._mouseSliding=true;this._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-
(closestHandle.height()/2)-
(parseInt(closestHandle.css("borderTopWidth"),10)||0)-
(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+
(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}
this._animateOff=true;return true;},_mouseStart:function(){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);}
percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}
if(percentMouse<0){percentMouse=0;}
if(this.orientation==="vertical"){percentMouse=1-percentMouse;}
valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
return this._trigger("start",event,uiHash);},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal;}
if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true);}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal);}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("stop",event,uiHash);},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("change",event,uiHash);}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}
return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}
if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}
this._refreshValue();}else{if(this.options.values&&this.options.values.length){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if($.isArray(this.options.values)){valsLength=this.options.values.length;}
$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"disabled":if(value){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.prop("disabled",true);this.element.addClass("ui-disabled");}else{this.handles.prop("disabled",false);this.element.removeClass("ui-disabled");}
break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i);}
this._animateOff=false;break;case"min":case"max":this._animateOff=true;this._refreshValue();this._animateOff=false;break;}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else{vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}
return vals;}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}
if(val>=this._valueMax()){return this._valueMax();}
var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}
return parseFloat(alignValue.toFixed(5));},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.options.max;},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=(!this._animateOff)?o.animate:false,_set={};if(this.options.values&&this.options.values.length){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100;_set[that.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(that.options.range===true){if(that.orientation==="horizontal"){if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}
if(i===1){that.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}
if(i===1){that.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}
lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate});}
if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate});}}}});}(jQuery));(function($){function modifier(fn){return function(){var previous=this.element.val();fn.apply(this,arguments);this._refresh();if(previous!==this.element.val()){this._trigger("change");}};}
$.widget("ui.spinner",{version:"1.9.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:true,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max);this._setOption("min",this.options.min);this._setOption("step",this.options.step);this._value(this.element.val(),true);this._draw();this._on(this._events);this._refresh();this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_getCreateOptions:function(){var options={},element=this.element;$.each(["min","max","step"],function(i,option){var value=element.attr(option);if(value!==undefined&&value.length){options[option]=value;}});return options;},_events:{keydown:function(event){if(this._start(event)&&this._keydown(event)){event.preventDefault();}},keyup:"_stop",focus:function(){this.previous=this.element.val();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
this._refresh();if(this.previous!==this.element.val()){this._trigger("change",event);}},mousewheel:function(event,delta){if(!delta){return;}
if(!this.spinning&&!this._start(event)){return false;}
this._spin((delta>0?1:-1)*this.options.step,event);clearTimeout(this.mousewheelTimer);this.mousewheelTimer=this._delay(function(){if(this.spinning){this._stop(event);}},100);event.preventDefault();},"mousedown .ui-spinner-button":function(event){var previous;previous=this.element[0]===this.document[0].activeElement?this.previous:this.element.val();function checkFocus(){var isActive=this.element[0]===this.document[0].activeElement;if(!isActive){this.element.focus();this.previous=previous;this._delay(function(){this.previous=previous;});}}
event.preventDefault();checkFocus.call(this);this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;checkFocus.call(this);});if(this._start(event)===false){return;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(event){if(!$(event.currentTarget).hasClass("ui-state-active")){return;}
if(this._start(event)===false){return false;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var uiSpinner=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton");this.buttons=uiSpinner.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all");if(this.buttons.height()>Math.ceil(uiSpinner.height()*0.5)&&uiSpinner.height()>0){uiSpinner.height(uiSpinner.height());}
if(this.options.disabled){this.disable();}},_keydown:function(event){var options=this.options,keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.UP:this._repeat(null,1,event);return true;case keyCode.DOWN:this._repeat(null,-1,event);return true;case keyCode.PAGE_UP:this._repeat(null,options.page,event);return true;case keyCode.PAGE_DOWN:this._repeat(null,-options.page,event);return true;}
return false;},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>";},_buttonHtml:function(){return""+"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'>"+"<span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>";},_start:function(event){if(!this.spinning&&this._trigger("start",event)===false){return false;}
if(!this.counter){this.counter=1;}
this.spinning=true;return true;},_repeat:function(i,steps,event){i=i||500;clearTimeout(this.timer);this.timer=this._delay(function(){this._repeat(40,steps,event);},i);this._spin(steps*this.options.step,event);},_spin:function(step,event){var value=this.value()||0;if(!this.counter){this.counter=1;}
value=this._adjustValue(value+step*this._increment(this.counter));if(!this.spinning||this._trigger("spin",event,{value:value})!==false){this._value(value);this.counter++;}},_increment:function(i){var incremental=this.options.incremental;if(incremental){return $.isFunction(incremental)?incremental(i):Math.floor(i*i*i/50000-i*i/500+17*i/200+1);}
return 1;},_precision:function(){var precision=this._precisionOf(this.options.step);if(this.options.min!==null){precision=Math.max(precision,this._precisionOf(this.options.min));}
return precision;},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf(".");return decimal===-1?0:str.length-decimal-1;},_adjustValue:function(value){var base,aboveMin,options=this.options;base=options.min!==null?options.min:0;aboveMin=value-base;aboveMin=Math.round(aboveMin/options.step)*options.step;value=base+aboveMin;value=parseFloat(value.toFixed(this._precision()));if(options.max!==null&&value>options.max){return options.max;}
if(options.min!==null&&value<options.min){return options.min;}
return value;},_stop:function(event){if(!this.spinning){return;}
clearTimeout(this.timer);clearTimeout(this.mousewheelTimer);this.counter=0;this.spinning=false;this._trigger("stop",event);},_setOption:function(key,value){if(key==="culture"||key==="numberFormat"){var prevValue=this._parse(this.element.val());this.options[key]=value;this.element.val(this._format(prevValue));return;}
if(key==="max"||key==="min"||key==="step"){if(typeof value==="string"){value=this._parse(value);}}
this._super(key,value);if(key==="disabled"){if(value){this.element.prop("disabled",true);this.buttons.button("disable");}else{this.element.prop("disabled",false);this.buttons.button("enable");}}},_setOptions:modifier(function(options){this._super(options);this._value(this.element.val());}),_parse:function(val){if(typeof val==="string"&&val!==""){val=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(val,10,this.options.culture):+val;}
return val===""||isNaN(val)?null:val;},_format:function(value){if(value===""){return"";}
return window.Globalize&&this.options.numberFormat?Globalize.format(value,this.options.numberFormat,this.options.culture):value;},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())});},_value:function(value,allowAny){var parsed;if(value!==""){parsed=this._parse(value);if(parsed!==null){if(!allowAny){parsed=this._adjustValue(parsed);}
value=this._format(parsed);}}
this.element.val(value);this._refresh();},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",false).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.uiSpinner.replaceWith(this.element);},stepUp:modifier(function(steps){this._stepUp(steps);}),_stepUp:function(steps){this._spin((steps||1)*this.options.step);},stepDown:modifier(function(steps){this._stepDown(steps);}),_stepDown:function(steps){this._spin((steps||1)*-this.options.step);},pageUp:modifier(function(pages){this._stepUp((pages||1)*this.options.page);}),pageDown:modifier(function(pages){this._stepDown((pages||1)*this.options.page);}),value:function(newVal){if(!arguments.length){return this._parse(this.element.val());}
modifier(this._value).call(this,newVal);},widget:function(){return this.uiSpinner;}});}(jQuery));(function($,undefined){var tabId=0,rhash=/#.*$/;function getNextTabId(){return++tabId;}
function isLocal(anchor){return anchor.hash.length>1&&anchor.href.replace(rhash,"")===location.href.replace(rhash,"");}
$.widget("ui.tabs",{version:"1.9.1",delay:300,options:{active:null,collapsible:false,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var that=this,options=this.options,active=options.active,locationHash=location.hash.substring(1);this.running=false;this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",options.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(event){if($(this).is(".ui-state-disabled")){event.preventDefault();}}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){if($(this).closest("li").is(".ui-state-disabled")){this.blur();}});this._processTabs();if(active===null){if(locationHash){this.tabs.each(function(i,tab){if($(tab).attr("aria-controls")===locationHash){active=i;return false;}});}
if(active===null){active=this.tabs.index(this.tabs.filter(".ui-tabs-active"));}
if(active===null||active===-1){active=this.tabs.length?0:false;}}
if(active!==false){active=this.tabs.index(this.tabs.eq(active));if(active===-1){active=options.collapsible?false:0;}}
options.active=active;if(!options.collapsible&&options.active===false&&this.anchors.length){options.active=0;}
if($.isArray(options.disabled)){options.disabled=$.unique(options.disabled.concat($.map(this.tabs.filter(".ui-state-disabled"),function(li){return that.tabs.index(li);}))).sort();}
if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(this.options.active);}else{this.active=$();}
this._refresh();if(this.active.length){this.load(options.active);}},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?$():this._getPanelForTab(this.active)};},_tabKeydown:function(event){var focusedTab=$(this.document[0].activeElement).closest("li"),selectedIndex=this.tabs.index(focusedTab),goingForward=true;if(this._handlePageNav(event)){return;}
switch(event.keyCode){case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:selectedIndex++;break;case $.ui.keyCode.UP:case $.ui.keyCode.LEFT:goingForward=false;selectedIndex--;break;case $.ui.keyCode.END:selectedIndex=this.anchors.length-1;break;case $.ui.keyCode.HOME:selectedIndex=0;break;case $.ui.keyCode.SPACE:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex);return;case $.ui.keyCode.ENTER:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex===this.options.active?false:selectedIndex);return;default:return;}
event.preventDefault();clearTimeout(this.activating);selectedIndex=this._focusNextTab(selectedIndex,goingForward);if(!event.ctrlKey){focusedTab.attr("aria-selected","false");this.tabs.eq(selectedIndex).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",selectedIndex);},this.delay);}},_panelKeydown:function(event){if(this._handlePageNav(event)){return;}
if(event.ctrlKey&&event.keyCode===$.ui.keyCode.UP){event.preventDefault();this.active.focus();}},_handlePageNav:function(event){if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true;}
if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true;}},_findNextTab:function(index,goingForward){var lastTabIndex=this.tabs.length-1;function constrain(){if(index>lastTabIndex){index=0;}
if(index<0){index=lastTabIndex;}
return index;}
while($.inArray(constrain(),this.options.disabled)!==-1){index=goingForward?index+1:index-1;}
return index;},_focusNextTab:function(index,goingForward){index=this._findNextTab(index,goingForward);this.tabs.eq(index).focus();return index;},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
if(key==="disabled"){this._setupDisabled(value);return;}
this._super(key,value);if(key==="collapsible"){this.element.toggleClass("ui-tabs-collapsible",value);if(!value&&this.options.active===false){this._activate(0);}}
if(key==="event"){this._setupEvents(value);}
if(key==="heightStyle"){this._setupHeightStyle(value);}},_tabId:function(tab){return tab.attr("aria-controls")||"ui-tabs-"+getNextTabId();},_sanitizeSelector:function(hash){return hash?hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):"";},refresh:function(){var options=this.options,lis=this.tablist.children(":has(a[href])");options.disabled=$.map(lis.filter(".ui-state-disabled"),function(tab){return lis.index(tab);});this._processTabs();if(options.active===false||!this.anchors.length){options.active=false;this.active=$();}else if(this.active.length&&!$.contains(this.tablist[0],this.active[0])){if(this.tabs.length===options.disabled.length){options.active=false;this.active=$();}else{this._activate(this._findNextTab(Math.max(0,options.active-1),false));}}else{options.active=this.tabs.index(this.active);}
this._refresh();},_refresh:function(){this._setupDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"});if(!this.active.length){this.tabs.eq(0).attr("tabIndex",0);}else{this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0});this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"});}},_processTabs:function(){var that=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist");this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1});this.anchors=this.tabs.map(function(){return $("a",this)[0];}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1});this.panels=$();this.anchors.each(function(i,anchor){var selector,panel,panelId,anchorId=$(anchor).uniqueId().attr("id"),tab=$(anchor).closest("li"),originalAriaControls=tab.attr("aria-controls");if(isLocal(anchor)){selector=anchor.hash;panel=that.element.find(that._sanitizeSelector(selector));}else{panelId=that._tabId(tab);selector="#"+panelId;panel=that.element.find(selector);if(!panel.length){panel=that._createPanel(panelId);panel.insertAfter(that.panels[i-1]||that.tablist);}
panel.attr("aria-live","polite");}
if(panel.length){that.panels=that.panels.add(panel);}
if(originalAriaControls){tab.data("ui-tabs-aria-controls",originalAriaControls);}
tab.attr({"aria-controls":selector.substring(1),"aria-labelledby":anchorId});panel.attr("aria-labelledby",anchorId);});this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");},_getList:function(){return this.element.find("ol,ul").eq(0);},_createPanel:function(id){return $("<div>").attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",true);},_setupDisabled:function(disabled){if($.isArray(disabled)){if(!disabled.length){disabled=false;}else if(disabled.length===this.anchors.length){disabled=true;}}
for(var i=0,li;(li=this.tabs[i]);i++){if(disabled===true||$.inArray(i,disabled)!==-1){$(li).addClass("ui-state-disabled").attr("aria-disabled","true");}else{$(li).removeClass("ui-state-disabled").removeAttr("aria-disabled");}}
this.options.disabled=disabled;},_setupEvents:function(event){var events={click:function(event){event.preventDefault();}};if(event){$.each(event.split(" "),function(index,eventName){events[eventName]="_eventHandler";});}
this._off(this.anchors.add(this.tabs).add(this.panels));this._on(this.anchors,events);this._on(this.tabs,{keydown:"_tabKeydown"});this._on(this.panels,{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs);},_setupHeightStyle:function(heightStyle){var maxHeight,overflow,parent=this.element.parent();if(heightStyle==="fill"){if(!$.support.minHeight){overflow=parent.css("overflow");parent.css("overflow","hidden");}
maxHeight=parent.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});if(overflow){parent.css("overflow",overflow);}
this.element.children().not(this.panels).each(function(){maxHeight-=$(this).outerHeight(true);});this.panels.each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(heightStyle==="auto"){maxHeight=0;this.panels.each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}},_eventHandler:function(event){var options=this.options,active=this.active,anchor=$(event.currentTarget),tab=anchor.closest("li"),clickedIsActive=tab[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():this._getPanelForTab(tab),toHide=!active.length?$():this._getPanelForTab(active),eventData={oldTab:active,oldPanel:toHide,newTab:collapsing?$():tab,newPanel:toShow};event.preventDefault();if(tab.hasClass("ui-state-disabled")||tab.hasClass("ui-tabs-loading")||this.running||(clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.tabs.index(tab);this.active=clickedIsActive?$():tab;if(this.xhr){this.xhr.abort();}
if(!toHide.length&&!toShow.length){$.error("jQuery UI Tabs: Mismatching fragment identifier.");}
if(toShow.length){this.load(this.tabs.index(tab),event);}
this._toggle(event,eventData);},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel;this.running=true;function complete(){that.running=false;that._trigger("activate",event,eventData);}
function show(){eventData.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(toShow.length&&that.options.show){that._show(toShow,that.options.show,complete);}else{toShow.show();complete();}}
if(toHide.length&&this.options.hide){this._hide(toHide,this.options.hide,function(){eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");show();});}else{eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");toHide.hide();show();}
toHide.attr({"aria-expanded":"false","aria-hidden":"true"});eventData.oldTab.attr("aria-selected","false");if(toShow.length&&toHide.length){eventData.oldTab.attr("tabIndex",-1);}else if(toShow.length){this.tabs.filter(function(){return $(this).attr("tabIndex")===0;}).attr("tabIndex",-1);}
toShow.attr({"aria-expanded":"true","aria-hidden":"false"});eventData.newTab.attr({"aria-selected":"true",tabIndex:0});},_activate:function(index){var anchor,active=this._findActive(index);if(active[0]===this.active[0]){return;}
if(!active.length){active=this.active;}
anchor=active.find(".ui-tabs-anchor")[0];this._eventHandler({target:anchor,currentTarget:anchor,preventDefault:$.noop});},_findActive:function(index){return index===false?$():this.tabs.eq(index);},_getIndex:function(index){if(typeof index==="string"){index=this.anchors.index(this.anchors.filter("[href$='"+index+"']"));}
return index;},_destroy:function(){if(this.xhr){this.xhr.abort();}
this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible");this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role");this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeData("href.tabs").removeData("load.tabs").removeUniqueId();this.tabs.add(this.panels).each(function(){if($.data(this,"ui-tabs-destroy")){$(this).remove();}else{$(this).removeClass("ui-state-default ui-state-active ui-state-disabled "+"ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role");}});this.tabs.each(function(){var li=$(this),prev=li.data("ui-tabs-aria-controls");if(prev){li.attr("aria-controls",prev);}else{li.removeAttr("aria-controls");}});if(this.options.heightStyle!=="content"){this.panels.css("height","");}},enable:function(index){var disabled=this.options.disabled;if(disabled===false){return;}
if(index===undefined){disabled=false;}else{index=this._getIndex(index);if($.isArray(disabled)){disabled=$.map(disabled,function(num){return num!==index?num:null;});}else{disabled=$.map(this.tabs,function(li,num){return num!==index?num:null;});}}
this._setupDisabled(disabled);},disable:function(index){var disabled=this.options.disabled;if(disabled===true){return;}
if(index===undefined){disabled=true;}else{index=this._getIndex(index);if($.inArray(index,disabled)!==-1){return;}
if($.isArray(disabled)){disabled=$.merge([index],disabled).sort();}else{disabled=[index];}}
this._setupDisabled(disabled);},load:function(index,event){index=this._getIndex(index);var that=this,tab=this.tabs.eq(index),anchor=tab.find(".ui-tabs-anchor"),panel=this._getPanelForTab(tab),eventData={tab:tab,panel:panel};if(isLocal(anchor[0])){return;}
this.xhr=$.ajax(this._ajaxSettings(anchor,event,eventData));if(this.xhr&&this.xhr.statusText!=="canceled"){tab.addClass("ui-tabs-loading");panel.attr("aria-busy","true");this.xhr.success(function(response){setTimeout(function(){panel.html(response);that._trigger("load",event,eventData);},1);}).complete(function(jqXHR,status){setTimeout(function(){if(status==="abort"){that.panels.stop(false,true);}
tab.removeClass("ui-tabs-loading");panel.removeAttr("aria-busy");if(jqXHR===that.xhr){delete that.xhr;}},1);});}},_ajaxSettings:function(anchor,event,eventData){var that=this;return{url:anchor.attr("href"),beforeSend:function(jqXHR,settings){return that._trigger("beforeLoad",event,$.extend({jqXHR:jqXHR,ajaxSettings:settings},eventData));}};},_getPanelForTab:function(tab){var id=$(tab).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+id));}});if($.uiBackCompat!==false){$.ui.tabs.prototype._ui=function(tab,panel){return{tab:tab,panel:panel,index:this.anchors.index(tab)};};$.widget("ui.tabs",$.ui.tabs,{url:function(index,url){this.anchors.eq(index).attr("href",url);}});$.widget("ui.tabs",$.ui.tabs,{options:{ajaxOptions:null,cache:false},_create:function(){this._super();var that=this;this._on({tabsbeforeload:function(event,ui){if($.data(ui.tab[0],"cache.tabs")){event.preventDefault();return;}
ui.jqXHR.success(function(){if(that.options.cache){$.data(ui.tab[0],"cache.tabs",true);}});}});},_ajaxSettings:function(anchor,event,ui){var ajaxOptions=this.options.ajaxOptions;return $.extend({},ajaxOptions,{error:function(xhr,status){try{ajaxOptions.error(xhr,status,ui.tab.closest("li").index(),ui.tab[0]);}
catch(error){}}},this._superApply(arguments));},_setOption:function(key,value){if(key==="cache"&&value===false){this.anchors.removeData("cache.tabs");}
this._super(key,value);},_destroy:function(){this.anchors.removeData("cache.tabs");this._super();},url:function(index){this.anchors.eq(index).removeData("cache.tabs");this._superApply(arguments);}});$.widget("ui.tabs",$.ui.tabs,{abort:function(){if(this.xhr){this.xhr.abort();}}});$.widget("ui.tabs",$.ui.tabs,{options:{spinner:"<em>Loading&#8230;</em>"},_create:function(){this._super();this._on({tabsbeforeload:function(event,ui){if(event.target!==this.element[0]||!this.options.spinner){return;}
var span=ui.tab.find("span"),html=span.html();span.html(this.options.spinner);ui.jqXHR.complete(function(){span.html(html);});}});}});$.widget("ui.tabs",$.ui.tabs,{options:{enable:null,disable:null},enable:function(index){var options=this.options,trigger;if(index&&options.disabled===true||($.isArray(options.disabled)&&$.inArray(index,options.disabled)!==-1)){trigger=true;}
this._superApply(arguments);if(trigger){this._trigger("enable",null,this._ui(this.anchors[index],this.panels[index]));}},disable:function(index){var options=this.options,trigger;if(index&&options.disabled===false||($.isArray(options.disabled)&&$.inArray(index,options.disabled)===-1)){trigger=true;}
this._superApply(arguments);if(trigger){this._trigger("disable",null,this._ui(this.anchors[index],this.panels[index]));}}});$.widget("ui.tabs",$.ui.tabs,{options:{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},add:function(url,label,index){if(index===undefined){index=this.anchors.length;}
var doInsertAfter,panel,options=this.options,li=$(options.tabTemplate.replace(/#\{href\}/g,url).replace(/#\{label\}/g,label)),id=!url.indexOf("#")?url.replace("#",""):this._tabId(li);li.addClass("ui-state-default ui-corner-top").data("ui-tabs-destroy",true);li.attr("aria-controls",id);doInsertAfter=index>=this.tabs.length;panel=this.element.find("#"+id);if(!panel.length){panel=this._createPanel(id);if(doInsertAfter){if(index>0){panel.insertAfter(this.panels.eq(-1));}else{panel.appendTo(this.element);}}else{panel.insertBefore(this.panels[index]);}}
panel.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide();if(doInsertAfter){li.appendTo(this.tablist);}else{li.insertBefore(this.tabs[index]);}
options.disabled=$.map(options.disabled,function(n){return n>=index?++n:n;});this.refresh();if(this.tabs.length===1&&options.active===false){this.option("active",0);}
this._trigger("add",null,this._ui(this.anchors[index],this.panels[index]));return this;},remove:function(index){index=this._getIndex(index);var options=this.options,tab=this.tabs.eq(index).remove(),panel=this._getPanelForTab(tab).remove();if(tab.hasClass("ui-tabs-active")&&this.anchors.length>2){this._activate(index+(index+1<this.anchors.length?1:-1));}
options.disabled=$.map($.grep(options.disabled,function(n){return n!==index;}),function(n){return n>=index?--n:n;});this.refresh();this._trigger("remove",null,this._ui(tab.find("a")[0],panel[0]));return this;}});$.widget("ui.tabs",$.ui.tabs,{length:function(){return this.anchors.length;}});$.widget("ui.tabs",$.ui.tabs,{options:{idPrefix:"ui-tabs-"},_tabId:function(tab){var a=tab.is("li")?tab.find("a[href]"):tab;a=a[0];return $(a).closest("li").attr("aria-controls")||a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF\-]/g,"")||this.options.idPrefix+getNextTabId();}});$.widget("ui.tabs",$.ui.tabs,{options:{panelTemplate:"<div></div>"},_createPanel:function(id){return $(this.options.panelTemplate).attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",true);}});$.widget("ui.tabs",$.ui.tabs,{_create:function(){var options=this.options;if(options.active===null&&options.selected!==undefined){options.active=options.selected===-1?false:options.selected;}
this._super();options.selected=options.active;if(options.selected===false){options.selected=-1;}},_setOption:function(key,value){if(key!=="selected"){return this._super(key,value);}
var options=this.options;this._super("active",value===-1?false:value);options.selected=options.active;if(options.selected===false){options.selected=-1;}},_eventHandler:function(){this._superApply(arguments);this.options.selected=this.options.active;if(this.options.selected===false){this.options.selected=-1;}}});$.widget("ui.tabs",$.ui.tabs,{options:{show:null,select:null},_create:function(){this._super();if(this.options.active!==false){this._trigger("show",null,this._ui(this.active.find(".ui-tabs-anchor")[0],this._getPanelForTab(this.active)[0]));}},_trigger:function(type,event,data){var ret=this._superApply(arguments);if(!ret){return false;}
if(type==="beforeActivate"&&data.newTab.length){ret=this._super("select",event,{tab:data.newTab.find(".ui-tabs-anchor")[0],panel:data.newPanel[0],index:data.newTab.closest("li").index()});}else if(type==="activate"&&data.newTab.length){ret=this._super("show",event,{tab:data.newTab.find(".ui-tabs-anchor")[0],panel:data.newPanel[0],index:data.newTab.closest("li").index()});}
return ret;}});$.widget("ui.tabs",$.ui.tabs,{select:function(index){index=this._getIndex(index);if(index===-1){if(this.options.collapsible&&this.options.selected!==-1){index=this.options.selected;}else{return;}}
this.anchors.eq(index).trigger(this.options.event+this.eventNamespace);}});(function(){var listId=0;$.widget("ui.tabs",$.ui.tabs,{options:{cookie:null},_create:function(){var options=this.options,active;if(options.active==null&&options.cookie){active=parseInt(this._cookie(),10);if(active===-1){active=false;}
options.active=active;}
this._super();},_cookie:function(active){var cookie=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+(++listId))];if(arguments.length){cookie.push(active===false?-1:active);cookie.push(this.options.cookie);}
return $.cookie.apply(null,cookie);},_refresh:function(){this._super();if(this.options.cookie){this._cookie(this.options.active,this.options.cookie);}},_eventHandler:function(){this._superApply(arguments);if(this.options.cookie){this._cookie(this.options.active,this.options.cookie);}},_destroy:function(){this._super();if(this.options.cookie){this._cookie(null,this.options.cookie);}}});})();$.widget("ui.tabs",$.ui.tabs,{_trigger:function(type,event,data){var _data=$.extend({},data);if(type==="load"){_data.panel=_data.panel[0];_data.tab=_data.tab.find(".ui-tabs-anchor")[0];}
return this._super(type,event,_data);}});$.widget("ui.tabs",$.ui.tabs,{options:{fx:null},_getFx:function(){var hide,show,fx=this.options.fx;if(fx){if($.isArray(fx)){hide=fx[0];show=fx[1];}else{hide=show=fx;}}
return fx?{show:show,hide:hide}:null;},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel,fx=this._getFx();if(!fx){return this._super(event,eventData);}
that.running=true;function complete(){that.running=false;that._trigger("activate",event,eventData);}
function show(){eventData.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(toShow.length&&fx.show){toShow.animate(fx.show,fx.show.duration,function(){complete();});}else{toShow.show();complete();}}
if(toHide.length&&fx.hide){toHide.animate(fx.hide,fx.hide.duration,function(){eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");show();});}else{eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");toHide.hide();show();}}});}})(jQuery);(function($){var increments=0;function addDescribedBy(elem,id){var describedby=(elem.attr("aria-describedby")||"").split(/\s+/);describedby.push(id);elem.data("ui-tooltip-id",id).attr("aria-describedby",$.trim(describedby.join(" ")));}
function removeDescribedBy(elem){var id=elem.data("ui-tooltip-id"),describedby=(elem.attr("aria-describedby")||"").split(/\s+/),index=$.inArray(id,describedby);if(index!==-1){describedby.splice(index,1);}
elem.removeData("ui-tooltip-id");describedby=$.trim(describedby.join(" "));if(describedby){elem.attr("aria-describedby",describedby);}else{elem.removeAttr("aria-describedby");}}
$.widget("ui.tooltip",{version:"1.9.1",options:{content:function(){return $(this).attr("title");},hide:true,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flipfit"},show:true,tooltipClass:null,track:false,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};if(this.options.disabled){this._disable();}},_setOption:function(key,value){var that=this;if(key==="disabled"){this[value?"_disable":"_enable"]();this.options[key]=value;return;}
this._super(key,value);if(key==="content"){$.each(this.tooltips,function(id,element){that._updateContent(element);});}},_disable:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);});this.element.find(this.options.items).andSelf().each(function(){var element=$(this);if(element.is("[title]")){element.data("ui-tooltip-title",element.attr("title")).attr("title","");}});},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var element=$(this);if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));}});},open:function(event){var that=this,target=$(event?event.target:this.element).closest(this.options.items);if(!target.length){return;}
if(this.options.track&&target.data("ui-tooltip-id")){this._find(target).position($.extend({of:target},this.options.position));this._off(this.document,"mousemove");return;}
if(target.attr("title")){target.data("ui-tooltip-title",target.attr("title"));}
target.data("tooltip-open",true);if(event&&event.type==="mouseover"){target.parents().each(function(){var blurEvent;if($(this).data("tooltip-open")){blurEvent=$.Event("blur");blurEvent.target=blurEvent.currentTarget=this;that.close(blurEvent,true);}
if(this.title){$(this).uniqueId();that.parents[this.id]={element:this,title:this.title};this.title="";}});}
this._updateContent(target,event);},_updateContent:function(target,event){var content,contentOption=this.options.content,that=this;if(typeof contentOption==="string"){return this._open(event,target,contentOption);}
content=contentOption.call(target[0],function(response){if(!target.data("tooltip-open")){return;}
that._delay(function(){this._open(event,target,response);});});if(content){this._open(event,target,content);}},_open:function(event,target,content){var tooltip,events,delayedShow,positionOption=$.extend({},this.options.position);if(!content){return;}
tooltip=this._find(target);if(tooltip.length){tooltip.find(".ui-tooltip-content").html(content);return;}
if(target.is("[title]")){if(event&&event.type==="mouseover"){target.attr("title","");}else{target.removeAttr("title");}}
tooltip=this._tooltip(target);addDescribedBy(target,tooltip.attr("id"));tooltip.find(".ui-tooltip-content").html(content);function position(event){positionOption.of=event;if(tooltip.is(":hidden")){return;}
tooltip.position(positionOption);}
if(this.options.track&&event&&/^mouse/.test(event.originalEvent.type)){this._on(this.document,{mousemove:position});position(event);}else{tooltip.position($.extend({of:target},this.options.position));}
tooltip.hide();this._show(tooltip,this.options.show);if(this.options.show&&this.options.show.delay){delayedShow=setInterval(function(){if(tooltip.is(":visible")){position(positionOption.of);clearInterval(delayedShow);}},$.fx.interval);}
this._trigger("open",event,{tooltip:tooltip});events={keyup:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){var fakeEvent=$.Event(event);fakeEvent.currentTarget=target[0];this.close(fakeEvent,true);}},remove:function(){this._removeTooltip(tooltip);}};if(!event||event.type==="mouseover"){events.mouseleave="close";}
if(!event||event.type==="focusin"){events.focusout="close";}
this._on(target,events);},close:function(event){var that=this,target=$(event?event.currentTarget:this.element),tooltip=this._find(target);if(this.closing){return;}
if(target.data("ui-tooltip-title")){target.attr("title",target.data("ui-tooltip-title"));}
removeDescribedBy(target);tooltip.stop(true);this._hide(tooltip,this.options.hide,function(){that._removeTooltip($(this));});target.removeData("tooltip-open");this._off(target,"mouseleave focusout keyup");if(target[0]!==this.element[0]){this._off(target,"remove");}
this._off(this.document,"mousemove");if(event&&event.type==="mouseleave"){$.each(this.parents,function(id,parent){parent.element.title=parent.title;delete that.parents[id];});}
this.closing=true;this._trigger("close",event,{tooltip:tooltip});this.closing=false;},_tooltip:function(element){var id="ui-tooltip-"+increments++,tooltip=$("<div>").attr({id:id,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+
(this.options.tooltipClass||""));$("<div>").addClass("ui-tooltip-content").appendTo(tooltip);tooltip.appendTo(this.document[0].body);if($.fn.bgiframe){tooltip.bgiframe();}
this.tooltips[id]=element;return tooltip;},_find:function(target){var id=target.data("ui-tooltip-id");return id?$("#"+id):$();},_removeTooltip:function(tooltip){tooltip.remove();delete this.tooltips[tooltip.attr("id")];},_destroy:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);$("#"+id).remove();if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));element.removeData("ui-tooltip-title");}});}});}(jQuery));;(jQuery.effects||(function($,undefined){var backCompat=$.uiBackCompat!==false,dataSpace="ui-effects-";$.effects={effect:{}};(function(jQuery,undefined){var stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor".split(" "),rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},propTypes={"byte":{floor:true,max:255},"percent":{max:1},"degrees":{mod:360,floor:true}},support=color.support={},supportElem=jQuery("<p>")[0],colors,each=jQuery.each;supportElem.style.cssText="background-color:rgba(1,1,1,.5)";support.rgba=supportElem.style.backgroundColor.indexOf("rgba")>-1;each(spaces,function(spaceName,space){space.cache="_"+spaceName;space.props.alpha={idx:3,type:"percent",def:1};});function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}
value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}
if(type.mod){return(value+type.mod)%type.mod;}
return 0>value?0:type.max<value?type.max:value;}
function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba";if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==="0,0,0,0"){jQuery.extend(rgba,colors.transparent);}
return inst;}
return colors[string];}
color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}
if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}
var inst=this,type=jQuery.type(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type="array";}
if(type==="string"){return this.parse(stringParse(red)||colors._default);}
if(type==="array"){each(spaces.rgba.props,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}
if(type==="object"){if(red instanceof color){each(spaces,function(spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==="alpha"||red[key]==null){return;}
inst[cache]=space.to(inst._rgba);}
inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&$.inArray(null,inst[cache].slice(0,3))<0){inst[cache][3]=1;if(space.from){inst._rgba=space.from(inst[cache]);}}});}
return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}
return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color("transparent"):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}
if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod/2){startValue+=type.mod;}else if(startValue-endValue>type.mod/2){startValue-=type.mod;}}
result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}
var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return v==null?(i>2?1:0):v;});if(rgba[3]===1){rgba.pop();prefix="rgb(";}
return prefix+rgba.join()+")";},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}
if(i&&i<3){v=Math.round(v*100)+"%";}
return v;});if(hsla[3]===1){hsla.pop();prefix="hsl(";}
return prefix+hsla.join()+")";},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}
return"#"+jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?"0"+v:v;}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}
if(h*2<1){return q;}
if(h*3<2){return p+(q-p)*((2/3)-h)*6;}
return p;}
spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}
var r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/diff)+360;}else if(g===max){h=(60*(b-r)/diff)+120;}else{h=(60*(r-g)/diff)+240;}
if(l===0||l===1){s=l;}else if(l<=0.5){s=diff/add;}else{s=diff/(2-add);}
return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}
var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1/3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1/3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}
if(value===undefined){return this[cache].slice();}
var ret,type=jQuery.type(value),arr=(type==="array"||type==="object")?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==="object"?key:prop.idx];if(val==null){val=local[prop.idx];}
local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}
color.fn[key]=function(value){var vtype=jQuery.type(value),fn=(key==="alpha"?(this._hsla?"hsla":"rgba"):spaceName),local=this[fn](),cur=local[prop.idx],match;if(vtype==="undefined"){return cur;}
if(vtype==="function"){value=value.call(this,cur);vtype=jQuery.type(value);}
if(value==null&&prop.empty){return this;}
if(vtype==="string"){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==="+"?1:-1);}}
local[prop.idx]=value;return this[fn](local);};});});each(stepHooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor="";if(jQuery.type(value)!=="string"||(parsed=stringParse(value))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==="backgroundColor"?elem.parentNode:elem;while((backgroundColor===""||backgroundColor==="transparent")&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,"backgroundColor");curElem=curElem.parentNode;}catch(e){}}
value=value.blend(backgroundColor&&backgroundColor!=="transparent"?backgroundColor:"_default");}
value=value.toRgbaString();}
try{elem.style[hook]=value;}catch(error){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}
jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(["Top","Right","Bottom","Left"],function(i,part){expanded["border"+part+"Color"]=value;});return expanded;}};colors=jQuery.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};})(jQuery);(function(){var classAnimationActions=["add","remove","toggle"],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};$.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(_,prop){$.fx.step[prop]=function(fx){if(fx.end!=="none"&&!fx.setAttr||fx.pos===1&&!fx.setAttr){jQuery.style(fx.elem,prop,fx.end);fx.setAttr=true;}};});function getElementStyles(){var style=this.ownerDocument.defaultView?this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,newStyle={},key,len;if(style&&style.length&&style[0]&&style[style[0]]){len=style.length;while(len--){key=style[len];if(typeof style[key]==="string"){newStyle[$.camelCase(key)]=style[key];}}}else{for(key in style){if(typeof style[key]==="string"){newStyle[key]=style[key];}}}
return newStyle;}
function styleDifference(oldStyle,newStyle){var diff={},name,value;for(name in newStyle){value=newStyle[name];if(oldStyle[name]!==value){if(!shorthandStyles[name]){if($.fx.step[name]||!isNaN(parseFloat(value))){diff[name]=value;}}}}
return diff;}
$.effects.animateClass=function(value,duration,easing,callback){var o=$.speed(duration,easing,callback);return this.queue(function(){var animated=$(this),baseClass=animated.attr("class")||"",applyClassChange,allAnimations=o.children?animated.find("*").andSelf():animated;allAnimations=allAnimations.map(function(){var el=$(this);return{el:el,start:getElementStyles.call(this)};});applyClassChange=function(){$.each(classAnimationActions,function(i,action){if(value[action]){animated[action+"Class"](value[action]);}});};applyClassChange();allAnimations=allAnimations.map(function(){this.end=getElementStyles.call(this.el[0]);this.diff=styleDifference(this.start,this.end);return this;});animated.attr("class",baseClass);allAnimations=allAnimations.map(function(){var styleInfo=this,dfd=$.Deferred(),opts=jQuery.extend({},o,{queue:false,complete:function(){dfd.resolve(styleInfo);}});this.el.animate(this.diff,opts);return dfd.promise();});$.when.apply($,allAnimations.get()).done(function(){applyClassChange();$.each(arguments,function(){var el=this.el;$.each(this.diff,function(key){el.css(key,'');});});o.complete.call(animated[0]);});});};$.fn.extend({_addClass:$.fn.addClass,addClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{add:classNames},speed,easing,callback):this._addClass(classNames);},_removeClass:$.fn.removeClass,removeClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{remove:classNames},speed,easing,callback):this._removeClass(classNames);},_toggleClass:$.fn.toggleClass,toggleClass:function(classNames,force,speed,easing,callback){if(typeof force==="boolean"||force===undefined){if(!speed){return this._toggleClass(classNames,force);}else{return $.effects.animateClass.call(this,(force?{add:classNames}:{remove:classNames}),speed,easing,callback);}}else{return $.effects.animateClass.call(this,{toggle:classNames},force,speed,easing);}},switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.call(this,{add:add,remove:remove},speed,easing,callback);}});})();(function(){$.extend($.effects,{version:"1.9.1",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.data(dataSpace+set[i],element[0].style[set[i]]);}}},restore:function(element,set){var val,i;for(i=0;i<set.length;i++){if(set[i]!==null){val=element.data(dataSpace+set[i]);if(val===undefined){val="";}
element.css(set[i],val);}}},setMode:function(el,mode){if(mode==="toggle"){mode=el.is(":hidden")?"show":"hide";}
return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case"top":y=0;break;case"middle":y=0.5;break;case"bottom":y=1;break;default:y=origin[0]/original.height;}
switch(origin[1]){case"left":x=0;break;case"center":x=0.5;break;case"right":x=1;break;default:x=origin[1]/original.width;}
return{x:x,y:y};},createWrapper:function(element){if(element.parent().is(".ui-effects-wrapper")){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),"float":element.css("float")},wrapper=$("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),size={width:element.width(),height:element.height()},active=document.activeElement;try{active.id;}catch(e){active=document.body;}
element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}
wrapper=element.parent();if(element.css("position")==="static"){wrapper.css({position:"relative"});element.css({position:"relative"});}else{$.extend(props,{position:element.css("position"),zIndex:element.css("z-index")});$.each(["top","left","bottom","right"],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]="auto";}});element.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"});}
element.css(size);return wrapper.css(props).show();},removeWrapper:function(element){var active=document.activeElement;if(element.parent().is(".ui-effects-wrapper")){element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}}
return element;},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){var unit=element.cssUnit(x);if(unit[0]>0){value[x]=unit[0]*factor+unit[1];}});return value;}});function _normalizeArguments(effect,options,speed,callback){if($.isPlainObject(effect)){options=effect;effect=effect.effect;}
effect={effect:effect};if(options==null){options={};}
if($.isFunction(options)){callback=options;speed=null;options={};}
if(typeof options==="number"||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
if(options){$.extend(effect,options);}
speed=speed||options.duration;effect.duration=$.fx.off?0:typeof speed==="number"?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;effect.complete=callback||options.complete;return effect;}
function standardSpeed(speed){if(!speed||typeof speed==="number"||$.fx.speeds[speed]){return true;}
if(typeof speed==="string"&&!$.effects.effect[speed]){if(backCompat&&$.effects[speed]){return false;}
return true;}
return false;}
$.fn.extend({effect:function(){var args=_normalizeArguments.apply(this,arguments),mode=args.mode,queue=args.queue,effectMethod=$.effects.effect[args.effect],oldEffectMethod=!effectMethod&&backCompat&&$.effects[args.effect];if($.fx.off||!(effectMethod||oldEffectMethod)){if(mode){return this[mode](args.duration,args.complete);}else{return this.each(function(){if(args.complete){args.complete.call(this);}});}}
function run(next){var elem=$(this),complete=args.complete,mode=args.mode;function done(){if($.isFunction(complete)){complete.call(elem[0]);}
if($.isFunction(next)){next();}}
if(elem.is(":hidden")?mode==="hide":mode==="show"){done();}else{effectMethod.call(elem[0],args,done);}}
if(effectMethod){return queue===false?this.each(run):this.queue(queue||"fx",run);}else{return oldEffectMethod.call(this,{options:args,duration:args.duration,callback:args.complete,mode:args.mode});}},_show:$.fn.show,show:function(speed){if(standardSpeed(speed)){return this._show.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="show";return this.effect.call(this,args);}},_hide:$.fn.hide,hide:function(speed){if(standardSpeed(speed)){return this._hide.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="hide";return this.effect.call(this,args);}},__toggle:$.fn.toggle,toggle:function(speed){if(standardSpeed(speed)||typeof speed==="boolean"||$.isFunction(speed)){return this.__toggle.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="toggle";return this.effect.call(this,args);}},cssUnit:function(key){var style=this.css(key),val=[];$.each(["em","px","%","pt"],function(i,unit){if(style.indexOf(unit)>0){val=[parseFloat(style),unit];}});return val;}});})();(function(){var baseEasings={};$.each(["Quad","Cubic","Quart","Quint","Expo"],function(i,name){baseEasings[name]=function(p){return Math.pow(p,i+2);};});$.extend(baseEasings,{Sine:function(p){return 1-Math.cos(p*Math.PI/2);},Circ:function(p){return 1-Math.sqrt(1-p*p);},Elastic:function(p){return p===0||p===1?p:-Math.pow(2,8*(p-1))*Math.sin(((p-1)*80-7.5)*Math.PI/15);},Back:function(p){return p*p*(3*p-2);},Bounce:function(p){var pow2,bounce=4;while(p<((pow2=Math.pow(2,--bounce))-1)/11){}
return 1/Math.pow(4,3-bounce)-7.5625*Math.pow((pow2*3-2)/22-p,2);}});$.each(baseEasings,function(name,easeIn){$.easing["easeIn"+name]=easeIn;$.easing["easeOut"+name]=function(p){return 1-easeIn(1-p);};$.easing["easeInOut"+name]=function(p){return p<0.5?easeIn(p*2)/2:1-easeIn(p*-2+2)/2;};});})();})(jQuery));(function($,undefined){var rvertical=/up|down|vertical/,rpositivemotion=/up|left|vertical|horizontal/;$.effects.effect.blind=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),direction=o.direction||"up",vertical=rvertical.test(direction),ref=vertical?"height":"width",ref2=vertical?"top":"left",motion=rpositivemotion.test(direction),animation={},show=mode==="show",wrapper,distance,margin;if(el.parent().is(".ui-effects-wrapper")){$.effects.save(el.parent(),props);}else{$.effects.save(el,props);}
el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=wrapper[ref]();margin=parseFloat(wrapper.css(ref2))||0;animation[ref]=show?distance:0;if(!motion){el.css(vertical?"bottom":"right",0).css(vertical?"top":"left","auto").css({position:"absolute"});animation[ref2]=show?margin:distance+margin;}
if(show){wrapper.css(ref,0);if(!motion){wrapper.css(ref2,margin+distance);}}
wrapper.animate(animation,{duration:o.duration,easing:o.easing,queue:false,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.bounce=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),hide=mode==="hide",show=mode==="show",direction=o.direction||"up",distance=o.distance,times=o.times||5,anims=times*2+(show||hide?1:0),speed=o.duration/anims,easing=o.easing,ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left"),i,upAnim,downAnim,queue=el.queue(),queuelen=queue.length;if(show||hide){props.push("opacity");}
$.effects.save(el,props);el.show();$.effects.createWrapper(el);if(!distance){distance=el[ref==="top"?"outerHeight":"outerWidth"]()/3;}
if(show){downAnim={opacity:1};downAnim[ref]=0;el.css("opacity",0).css(ref,motion?-distance*2:distance*2).animate(downAnim,speed,easing);}
if(hide){distance=distance/Math.pow(2,times-1);}
downAnim={};downAnim[ref]=0;for(i=0;i<times;i++){upAnim={};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing).animate(downAnim,speed,easing);distance=hide?distance*2:distance/2;}
if(hide){upAnim={opacity:0};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing);}
el.queue(function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.clip=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"vertical",vert=direction==="vertical",size=vert?"height":"width",position=vert?"top":"left",animation={},wrapper,animate,distance;$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});animate=(el[0].tagName==="IMG")?wrapper:el;distance=animate[size]();if(show){animate.css(size,0);animate.css(position,distance/2);}
animation[size]=show?distance:0;animation[position]=show?0:distance/2;animate.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(!show){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.drop=function(o,done){var el=$(this),props=["position","top","bottom","left","right","opacity","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left")?"pos":"neg",animation={opacity:show?1:0},distance;$.effects.save(el,props);el.show();$.effects.createWrapper(el);distance=o.distance||el[ref==="top"?"outerHeight":"outerWidth"](true)/2;if(show){el.css("opacity",0).css(ref,motion==="pos"?-distance:distance);}
animation[ref]=(show?(motion==="pos"?"+=":"-="):(motion==="pos"?"-=":"+="))+
distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.explode=function(o,done){var rows=o.pieces?Math.round(Math.sqrt(o.pieces)):3,cells=rows,el=$(this),mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",offset=el.show().css("visibility","hidden").offset(),width=Math.ceil(el.outerWidth()/cells),height=Math.ceil(el.outerHeight()/rows),pieces=[],i,j,left,top,mx,my;function childComplete(){pieces.push(this);if(pieces.length===rows*cells){animComplete();}}
for(i=0;i<rows;i++){top=offset.top+i*height;my=i-(rows-1)/2;for(j=0;j<cells;j++){left=offset.left+j*width;mx=j-(cells-1)/2;el.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*width,top:-i*height}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:width,height:height,left:left+(show?mx*width:0),top:top+(show?my*height:0),opacity:show?0:1}).animate({left:left+(show?0:mx*width),top:top+(show?0:my*height),opacity:show?1:0},o.duration||500,o.easing,childComplete);}}
function animComplete(){el.css({visibility:"visible"});$(pieces).remove();if(!show){el.hide();}
done();}};})(jQuery);(function($,undefined){$.effects.effect.fade=function(o,done){var el=$(this),mode=$.effects.setMode(el,o.mode||"toggle");el.animate({opacity:mode},{queue:false,duration:o.duration,easing:o.easing,complete:done});};})(jQuery);(function($,undefined){$.effects.effect.fold=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",hide=mode==="hide",size=o.size||15,percent=/([0-9]+)%/.exec(size),horizFirst=!!o.horizFirst,widthFirst=show!==horizFirst,ref=widthFirst?["width","height"]:["height","width"],duration=o.duration/2,wrapper,distance,animation1={},animation2={};$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=widthFirst?[wrapper.width(),wrapper.height()]:[wrapper.height(),wrapper.width()];if(percent){size=parseInt(percent[1],10)/100*distance[hide?0:1];}
if(show){wrapper.css(horizFirst?{height:0,width:size}:{height:size,width:0});}
animation1[ref[0]]=show?distance[0]:size;animation2[ref[1]]=show?distance[1]:0;wrapper.animate(animation1,duration,o.easing).animate(animation2,duration,o.easing,function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});};})(jQuery);(function($,undefined){$.effects.effect.highlight=function(o,done){var elem=$(this),props=["backgroundImage","backgroundColor","opacity"],mode=$.effects.setMode(elem,o.mode||"show"),animation={backgroundColor:elem.css("backgroundColor")};if(mode==="hide"){animation.opacity=0;}
$.effects.save(elem,props);elem.show().css({backgroundImage:"none",backgroundColor:o.color||"#ffff99"}).animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){elem.hide();}
$.effects.restore(elem,props);done();}});};})(jQuery);(function($,undefined){$.effects.effect.pulsate=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"show"),show=mode==="show",hide=mode==="hide",showhide=(show||mode==="hide"),anims=((o.times||5)*2)+(showhide?1:0),duration=o.duration/anims,animateTo=0,queue=elem.queue(),queuelen=queue.length,i;if(show||!elem.is(":visible")){elem.css("opacity",0).show();animateTo=1;}
for(i=1;i<anims;i++){elem.animate({opacity:animateTo},duration,o.easing);animateTo=1-animateTo;}
elem.animate({opacity:animateTo},duration,o.easing);elem.queue(function(){if(hide){elem.hide();}
done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
elem.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.puff=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"hide"),hide=mode==="hide",percent=parseInt(o.percent,10)||150,factor=percent/100,original={height:elem.height(),width:elem.width()};$.extend(o,{effect:"scale",queue:false,fade:true,mode:mode,complete:done,percent:hide?percent:100,from:hide?original:{height:original.height*factor,width:original.width*factor}});elem.effect(o);};$.effects.effect.scale=function(o,done){var el=$(this),options=$.extend(true,{},o),mode=$.effects.setMode(el,o.mode||"effect"),percent=parseInt(o.percent,10)||(parseInt(o.percent,10)===0?0:(mode==="hide"?0:100)),direction=o.direction||"both",origin=o.origin,original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()},factor={y:direction!=="horizontal"?(percent/100):1,x:direction!=="vertical"?(percent/100):1};options.effect="size";options.queue=false;options.complete=done;if(mode!=="effect"){options.origin=origin||["middle","center"];options.restore=true;}
options.from=o.from||(mode==="show"?{height:0,width:0}:original);options.to={height:original.height*factor.y,width:original.width*factor.x,outerHeight:original.outerHeight*factor.y,outerWidth:original.outerWidth*factor.x};if(options.fade){if(mode==="show"){options.from.opacity=0;options.to.opacity=1;}
if(mode==="hide"){options.from.opacity=1;options.to.opacity=0;}}
el.effect(options);};$.effects.effect.size=function(o,done){var original,baseline,factor,el=$(this),props0=["position","top","bottom","left","right","width","height","overflow","opacity"],props1=["position","top","bottom","left","right","overflow","opacity"],props2=["width","height","overflow"],cProps=["fontSize"],vProps=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],hProps=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],mode=$.effects.setMode(el,o.mode||"effect"),restore=o.restore||mode!=="effect",scale=o.scale||"both",origin=o.origin||["middle","center"],position=el.css("position"),props=restore?props0:props1,zero={height:0,width:0};if(mode==="show"){el.show();}
original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()};if(o.mode==="toggle"&&mode==="show"){el.from=o.to||zero;el.to=o.from||original;}else{el.from=o.from||(mode==="show"?zero:original);el.to=o.to||(mode==="hide"?zero:original);}
factor={from:{y:el.from.height/original.height,x:el.from.width/original.width},to:{y:el.to.height/original.height,x:el.to.width/original.width}};if(scale==="box"||scale==="both"){if(factor.from.y!==factor.to.y){props=props.concat(vProps);el.from=$.effects.setTransition(el,vProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,vProps,factor.to.y,el.to);}
if(factor.from.x!==factor.to.x){props=props.concat(hProps);el.from=$.effects.setTransition(el,hProps,factor.from.x,el.from);el.to=$.effects.setTransition(el,hProps,factor.to.x,el.to);}}
if(scale==="content"||scale==="both"){if(factor.from.y!==factor.to.y){props=props.concat(cProps).concat(props2);el.from=$.effects.setTransition(el,cProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,cProps,factor.to.y,el.to);}}
$.effects.save(el,props);el.show();$.effects.createWrapper(el);el.css("overflow","hidden").css(el.from);if(origin){baseline=$.effects.getBaseline(origin,original);el.from.top=(original.outerHeight-el.outerHeight())*baseline.y;el.from.left=(original.outerWidth-el.outerWidth())*baseline.x;el.to.top=(original.outerHeight-el.to.outerHeight)*baseline.y;el.to.left=(original.outerWidth-el.to.outerWidth)*baseline.x;}
el.css(el.from);if(scale==="content"||scale==="both"){vProps=vProps.concat(["marginTop","marginBottom"]).concat(cProps);hProps=hProps.concat(["marginLeft","marginRight"]);props2=props0.concat(vProps).concat(hProps);el.find("*[width]").each(function(){var child=$(this),c_original={height:child.height(),width:child.width()};if(restore){$.effects.save(child,props2);}
child.from={height:c_original.height*factor.from.y,width:c_original.width*factor.from.x};child.to={height:c_original.height*factor.to.y,width:c_original.width*factor.to.x};if(factor.from.y!==factor.to.y){child.from=$.effects.setTransition(child,vProps,factor.from.y,child.from);child.to=$.effects.setTransition(child,vProps,factor.to.y,child.to);}
if(factor.from.x!==factor.to.x){child.from=$.effects.setTransition(child,hProps,factor.from.x,child.from);child.to=$.effects.setTransition(child,hProps,factor.to.x,child.to);}
child.css(child.from);child.animate(child.to,o.duration,o.easing,function(){if(restore){$.effects.restore(child,props2);}});});}
el.animate(el.to,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(el.to.opacity===0){el.css("opacity",el.from.opacity);}
if(mode==="hide"){el.hide();}
$.effects.restore(el,props);if(!restore){if(position==="static"){el.css({position:"relative",top:el.to.top,left:el.to.left});}else{$.each(["top","left"],function(idx,pos){el.css(pos,function(_,str){var val=parseInt(str,10),toRef=idx?el.to.left:el.to.top;if(str==="auto"){return toRef+"px";}
return val+toRef+"px";});});}}
$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.shake=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),direction=o.direction||"left",distance=o.distance||20,times=o.times||3,anims=times*2+1,speed=Math.round(o.duration/anims),ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),animation={},animation1={},animation2={},i,queue=el.queue(),queuelen=queue.length;$.effects.save(el,props);el.show();$.effects.createWrapper(el);animation[ref]=(positiveMotion?"-=":"+=")+distance;animation1[ref]=(positiveMotion?"+=":"-=")+distance*2;animation2[ref]=(positiveMotion?"-=":"+=")+distance*2;el.animate(animation,speed,o.easing);for(i=1;i<times;i++){el.animate(animation1,speed,o.easing).animate(animation2,speed,o.easing);}
el.animate(animation1,speed,o.easing).animate(animation,speed/2,o.easing).queue(function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.slide=function(o,done){var el=$(this),props=["position","top","bottom","left","right","width","height"],mode=$.effects.setMode(el,o.mode||"show"),show=mode==="show",direction=o.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),distance,animation={};$.effects.save(el,props);el.show();distance=o.distance||el[ref==="top"?"outerHeight":"outerWidth"](true);$.effects.createWrapper(el).css({overflow:"hidden"});if(show){el.css(ref,positiveMotion?(isNaN(distance)?"-"+distance:-distance):distance);}
animation[ref]=(show?(positiveMotion?"+=":"-="):(positiveMotion?"-=":"+="))+
distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.transfer=function(o,done){var elem=$(this),target=$(o.to),targetFixed=target.css("position")==="fixed",body=$("body"),fixTop=targetFixed?body.scrollTop():0,fixLeft=targetFixed?body.scrollLeft():0,endPosition=target.offset(),animation={top:endPosition.top-fixTop,left:endPosition.left-fixLeft,height:target.innerHeight(),width:target.innerWidth()},startPosition=elem.offset(),transfer=$('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(o.className).css({top:startPosition.top-fixTop,left:startPosition.left-fixLeft,height:elem.innerHeight(),width:elem.innerWidth(),position:targetFixed?"fixed":"absolute"}).animate(animation,o.duration,o.easing,function(){transfer.remove();done();});};})(jQuery);;

/* <inline asset> defined in bundle 'web.assets_backend' */
$.fn.tooltip=$.fn.bstooltip;$.fn.button=$.fn.bsbutton;;

/* /web/static/lib/jquery.ui.timepicker/js/jquery-ui-timepicker-addon.js defined in bundle 'web.assets_backend' */
(function($){$.extend($.ui,{timepicker:{version:"0.9.9"}});function Timepicker(){this.regional=[];this.regional['']={currentText:'Now',closeText:'Done',ampm:false,amNames:['AM','A'],pmNames:['PM','P'],timeFormat:'hh:mm tt',timeSuffix:'',timeOnlyTitle:'Choose Time',timeText:'Time',hourText:'Hour',minuteText:'Minute',secondText:'Second',millisecText:'Millisecond',timezoneText:'Time Zone'};this._defaults={showButtonPanel:true,timeOnly:false,showHour:true,showMinute:true,showSecond:false,showMillisec:false,showTimezone:false,showTime:true,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:'+0000',hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:true,separator:' ',altFieldTimeOnly:true,showTimepicker:true,timezoneIso8609:false,timezoneList:null,addSliderAccess:false,sliderAccessArgs:null};$.extend(this._defaults,this.regional['']);};$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:'+0000',hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:'',formattedDate:'',formattedTime:'',formattedDateTime:'',timezoneList:null,setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_newInst:function($input,o){var tp_inst=new Timepicker(),inlineSettings={};for(var attrName in this._defaults){var attrValue=$input.attr('time:'+attrName);if(attrValue){try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(input,dp_inst){if($.isFunction(o.beforeShow))
return o.beforeShow(input,dp_inst,tp_inst);},onChangeMonthYear:function(year,month,dp_inst){tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onChangeMonthYear))
o.onChangeMonthYear.call($input[0],year,month,dp_inst,tp_inst);},onClose:function(dateText,dp_inst){if(tp_inst.timeDefined===true&&$input.val()!='')
tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onClose))
o.onClose.call($input[0],dateText,dp_inst,tp_inst);},timepicker:tp_inst});tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(val){return val.toUpperCase()});tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(val){return val.toUpperCase()});if(tp_inst._defaults.timezoneList===null){var timezoneList=[];for(var i=-11;i<=12;i++)
timezoneList.push((i>=0?'+':'-')+('0'+Math.abs(i).toString()).slice(-2)+'00');if(tp_inst._defaults.timezoneIso8609)
timezoneList=$.map(timezoneList,function(val){return val=='+0000'?'Z':(val.substring(0,3)+':'+val.substring(3));});tp_inst._defaults.timezoneList=timezoneList;}
tp_inst.hour=tp_inst._defaults.hour;tp_inst.minute=tp_inst._defaults.minute;tp_inst.second=tp_inst._defaults.second;tp_inst.millisec=tp_inst._defaults.millisec;tp_inst.ampm='';tp_inst.$input=$input;if(o.altField)
tp_inst.$altInput=$(o.altField).css({cursor:'pointer'}).focus(function(){$input.trigger("focus");});if(tp_inst._defaults.minDate==0||tp_inst._defaults.minDateTime==0)
{tp_inst._defaults.minDate=new Date();}
if(tp_inst._defaults.maxDate==0||tp_inst._defaults.maxDateTime==0)
{tp_inst._defaults.maxDate=new Date();}
if(tp_inst._defaults.minDate!==undefined&&tp_inst._defaults.minDate instanceof Date)
tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime());if(tp_inst._defaults.minDateTime!==undefined&&tp_inst._defaults.minDateTime instanceof Date)
tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime());if(tp_inst._defaults.maxDate!==undefined&&tp_inst._defaults.maxDate instanceof Date)
tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime());if(tp_inst._defaults.maxDateTime!==undefined&&tp_inst._defaults.maxDateTime instanceof Date)
tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime());return tp_inst;},_addTimePicker:function(dp_inst){var currDT=(this.$altInput&&this._defaults.altFieldTimeOnly)?this.$input.val()+' '+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(currDT);this._limitMinMaxDateTime(dp_inst,false);this._injectTimePicker();},_parseTime:function(timeString,withDate){var regstr=this._defaults.timeFormat.toString().replace(/h{1,2}/ig,'(\\d?\\d)').replace(/m{1,2}/ig,'(\\d?\\d)').replace(/s{1,2}/ig,'(\\d?\\d)').replace(/l{1}/ig,'(\\d?\\d?\\d)').replace(/t{1,2}/ig,this._getPatternAmpm()).replace(/z{1}/ig,'(z|[-+]\\d\\d:?\\d\\d)?').replace(/\s/g,'\\s?')+this._defaults.timeSuffix+'$',order=this._getFormatPositions(),ampm='',treg;if(!this.inst)this.inst=$.datepicker._getInst(this.$input[0]);if(withDate||!this._defaults.timeOnly){var dp_dateFormat=$.datepicker._get(this.inst,'dateFormat');var specials=new RegExp("[.*+?|()\\[\\]{}\\\\]","g");regstr='^.{'+dp_dateFormat.length+',}?'+this._defaults.separator.replace(specials,"\\$&")+regstr;}
treg=timeString.match(new RegExp(regstr,'i'));if(treg){if(order.t!==-1){if(treg[order.t]===undefined||treg[order.t].length===0){ampm='';this.ampm='';}else{ampm=$.inArray(treg[order.t].toUpperCase(),this.amNames)!==-1?'AM':'PM';this.ampm=this._defaults[ampm=='AM'?'amNames':'pmNames'][0];}}
if(order.h!==-1){if(ampm=='AM'&&treg[order.h]=='12')
this.hour=0;else if(ampm=='PM'&&treg[order.h]!='12')
this.hour=(parseFloat(treg[order.h])+12).toFixed(0);else this.hour=Number(treg[order.h]);}
if(order.m!==-1)this.minute=Number(treg[order.m]);if(order.s!==-1)this.second=Number(treg[order.s]);if(order.l!==-1)this.millisec=Number(treg[order.l]);if(order.z!==-1&&treg[order.z]!==undefined){var tz=treg[order.z].toUpperCase();switch(tz.length){case 1:tz=this._defaults.timezoneIso8609?'Z':'+0000';break;case 5:if(this._defaults.timezoneIso8609)
tz=tz.substring(1)=='0000'?'Z':tz.substring(0,3)+':'+tz.substring(3);break;case 6:if(!this._defaults.timezoneIso8609)
tz=tz=='Z'||tz.substring(1)=='00:00'?'+0000':tz.replace(/:/,'');else if(tz.substring(1)=='00:00')
tz='Z';break;}
this.timezone=tz;}
return true;}
return false;},_getPatternAmpm:function(){var markers=[];o=this._defaults;if(o.amNames)
$.merge(markers,o.amNames);if(o.pmNames)
$.merge(markers,o.pmNames);markers=$.map(markers,function(val){return val.replace(/[.*+?|()\[\]{}\\]/g,'\\$&')});return'('+markers.join('|')+')?';},_getFormatPositions:function(){var finds=this._defaults.timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),orders={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(finds)
for(var i=0;i<finds.length;i++)
if(orders[finds[i].toString().charAt(0)]==-1)
orders[finds[i].toString().charAt(0)]=i+1;return orders;},_injectTimePicker:function(){var $dp=this.inst.dpDiv,o=this._defaults,tp_inst=this,hourMax=parseInt((o.hourMax-((o.hourMax-o.hourMin)%o.stepHour)),10),minMax=parseInt((o.minuteMax-((o.minuteMax-o.minuteMin)%o.stepMinute)),10),secMax=parseInt((o.secondMax-((o.secondMax-o.secondMin)%o.stepSecond)),10),millisecMax=parseInt((o.millisecMax-((o.millisecMax-o.millisecMin)%o.stepMillisec)),10),dp_id=this.inst.id.toString().replace(/([^A-Za-z0-9_])/g,'');if($dp.find("div#ui-timepicker-div-"+dp_id).length===0&&o.showTimepicker){var noDisplay=' style="display:none;"',html='<div class="ui-timepicker-div" id="ui-timepicker-div-'+dp_id+'"><dl>'+'<dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_'+dp_id+'"'+
((o.showTime)?'':noDisplay)+'>'+o.timeText+'</dt>'+'<dd class="ui_tpicker_time" id="ui_tpicker_time_'+dp_id+'"'+
((o.showTime)?'':noDisplay)+'></dd>'+'<dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_'+dp_id+'"'+
((o.showHour)?'':noDisplay)+'>'+o.hourText+'</dt>',hourGridSize=0,minuteGridSize=0,secondGridSize=0,millisecGridSize=0,size;html+='<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_'+dp_id+'"'+
((o.showHour)?'':noDisplay)+'></div>';if(o.showHour&&o.hourGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var h=o.hourMin;h<=hourMax;h+=parseInt(o.hourGrid,10)){hourGridSize++;var tmph=(o.ampm&&h>12)?h-12:h;if(tmph<10)tmph='0'+tmph;if(o.ampm){if(h==0)tmph=12+'a';else if(h<12)tmph+='a';else tmph+='p';}
html+='<td>'+tmph+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_'+dp_id+'"'+
((o.showMinute)?'':noDisplay)+'>'+o.minuteText+'</dt>'+'<dd class="ui_tpicker_minute"><div id="ui_tpicker_minute_'+dp_id+'"'+
((o.showMinute)?'':noDisplay)+'></div>';if(o.showMinute&&o.minuteGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var m=o.minuteMin;m<=minMax;m+=parseInt(o.minuteGrid,10)){minuteGridSize++;html+='<td>'+((m<10)?'0':'')+m+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_'+dp_id+'"'+
((o.showSecond)?'':noDisplay)+'>'+o.secondText+'</dt>'+'<dd class="ui_tpicker_second"><div id="ui_tpicker_second_'+dp_id+'"'+
((o.showSecond)?'':noDisplay)+'></div>';if(o.showSecond&&o.secondGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var s=o.secondMin;s<=secMax;s+=parseInt(o.secondGrid,10)){secondGridSize++;html+='<td>'+((s<10)?'0':'')+s+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_millisec_label" id="ui_tpicker_millisec_label_'+dp_id+'"'+
((o.showMillisec)?'':noDisplay)+'>'+o.millisecText+'</dt>'+'<dd class="ui_tpicker_millisec"><div id="ui_tpicker_millisec_'+dp_id+'"'+
((o.showMillisec)?'':noDisplay)+'></div>';if(o.showMillisec&&o.millisecGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var l=o.millisecMin;l<=millisecMax;l+=parseInt(o.millisecGrid,10)){millisecGridSize++;html+='<td>'+((l<10)?'0':'')+l+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_timezone_label" id="ui_tpicker_timezone_label_'+dp_id+'"'+
((o.showTimezone)?'':noDisplay)+'>'+o.timezoneText+'</dt>';html+='<dd class="ui_tpicker_timezone" id="ui_tpicker_timezone_'+dp_id+'"'+
((o.showTimezone)?'':noDisplay)+'></dd>';html+='</dl></div>';$tp=$(html);if(o.timeOnly===true){$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all">'+'<div class="ui-datepicker-title">'+o.timeOnlyTitle+'</div>'+'</div>');$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();}
this.hour_slider=$tp.find('#ui_tpicker_hour_'+dp_id).slider({orientation:"horizontal",value:this.hour,min:o.hourMin,max:hourMax,step:o.stepHour,slide:function(event,ui){tp_inst.hour_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.minute_slider=$tp.find('#ui_tpicker_minute_'+dp_id).slider({orientation:"horizontal",value:this.minute,min:o.minuteMin,max:minMax,step:o.stepMinute,slide:function(event,ui){tp_inst.minute_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.second_slider=$tp.find('#ui_tpicker_second_'+dp_id).slider({orientation:"horizontal",value:this.second,min:o.secondMin,max:secMax,step:o.stepSecond,slide:function(event,ui){tp_inst.second_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.millisec_slider=$tp.find('#ui_tpicker_millisec_'+dp_id).slider({orientation:"horizontal",value:this.millisec,min:o.millisecMin,max:millisecMax,step:o.stepMillisec,slide:function(event,ui){tp_inst.millisec_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.timezone_select=$tp.find('#ui_tpicker_timezone_'+dp_id).append('<select></select>').find("select");$.fn.append.apply(this.timezone_select,$.map(o.timezoneList,function(val,idx){return $("<option />").val(typeof val=="object"?val.value:val).text(typeof val=="object"?val.label:val);}));this.timezone_select.val((typeof this.timezone!="undefined"&&this.timezone!=null&&this.timezone!="")?this.timezone:o.timezone);this.timezone_select.change(function(){tp_inst._onTimeChange();});if(o.showHour&&o.hourGrid>0){size=100*hourGridSize*o.hourGrid/(hourMax-o.hourMin);$tp.find(".ui_tpicker_hour table").css({width:size+"%",marginLeft:(size/(-2*hourGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){var h=$(this).html();if(o.ampm){var ap=h.substring(2).toLowerCase(),aph=parseInt(h.substring(0,2),10);if(ap=='a'){if(aph==12)h=0;else h=aph;}else if(aph==12)h=12;else h=aph+12;}
tp_inst.hour_slider.slider("option","value",h);tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/hourGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showMinute&&o.minuteGrid>0){size=100*minuteGridSize*o.minuteGrid/(minMax-o.minuteMin);$tp.find(".ui_tpicker_minute table").css({width:size+"%",marginLeft:(size/(-2*minuteGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.minute_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/minuteGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showSecond&&o.secondGrid>0){$tp.find(".ui_tpicker_second table").css({width:size+"%",marginLeft:(size/(-2*secondGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.second_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/secondGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showMillisec&&o.millisecGrid>0){$tp.find(".ui_tpicker_millisec table").css({width:size+"%",marginLeft:(size/(-2*millisecGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.millisec_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/millisecGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
var $buttonPanel=$dp.find('.ui-datepicker-buttonpane');if($buttonPanel.length)$buttonPanel.before($tp);else $dp.append($tp);this.$timeObj=$tp.find('#ui_tpicker_time_'+dp_id);if(this.inst!==null){var timeDefined=this.timeDefined;this._onTimeChange();this.timeDefined=timeDefined;}
var onSelectDelegate=function(){tp_inst._onSelectHandler();};this.hour_slider.bind('slidestop',onSelectDelegate);this.minute_slider.bind('slidestop',onSelectDelegate);this.second_slider.bind('slidestop',onSelectDelegate);this.millisec_slider.bind('slidestop',onSelectDelegate);if(this._defaults.addSliderAccess){var sliderAccessArgs=this._defaults.sliderAccessArgs;setTimeout(function(){if($tp.find('.ui-slider-access').length==0){$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);var sliderAccessWidth=$tp.find('.ui-slider-access:eq(0)').outerWidth(true);if(sliderAccessWidth){$tp.find('table:visible').each(function(){var $g=$(this),oldWidth=$g.outerWidth(),oldMarginLeft=$g.css('marginLeft').toString().replace('%',''),newWidth=oldWidth-sliderAccessWidth,newMarginLeft=((oldMarginLeft*newWidth)/oldWidth)+'%';$g.css({width:newWidth,marginLeft:newMarginLeft});});}}},0);}}},_limitMinMaxDateTime:function(dp_inst,adjustSliders){var o=this._defaults,dp_date=new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay);if(!this._defaults.showTimepicker)return;if($.datepicker._get(dp_inst,'minDateTime')!==null&&$.datepicker._get(dp_inst,'minDateTime')!==undefined&&dp_date){var minDateTime=$.datepicker._get(dp_inst,'minDateTime'),minDateTimeDate=new Date(minDateTime.getFullYear(),minDateTime.getMonth(),minDateTime.getDate(),0,0,0,0);if(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null){this.hourMinOriginal=o.hourMin;this.minuteMinOriginal=o.minuteMin;this.secondMinOriginal=o.secondMin;this.millisecMinOriginal=o.millisecMin;}
if(dp_inst.settings.timeOnly||minDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMin=minDateTime.getHours();if(this.hour<=this._defaults.hourMin){this.hour=this._defaults.hourMin;this._defaults.minuteMin=minDateTime.getMinutes();if(this.minute<=this._defaults.minuteMin){this.minute=this._defaults.minuteMin;this._defaults.secondMin=minDateTime.getSeconds();}else if(this.second<=this._defaults.secondMin){this.second=this._defaults.secondMin;this._defaults.millisecMin=minDateTime.getMilliseconds();}else{if(this.millisec<this._defaults.millisecMin)
this.millisec=this._defaults.millisecMin;this._defaults.millisecMin=this.millisecMinOriginal;}}else{this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal;}}else{this._defaults.hourMin=this.hourMinOriginal;this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal;}}
if($.datepicker._get(dp_inst,'maxDateTime')!==null&&$.datepicker._get(dp_inst,'maxDateTime')!==undefined&&dp_date){var maxDateTime=$.datepicker._get(dp_inst,'maxDateTime'),maxDateTimeDate=new Date(maxDateTime.getFullYear(),maxDateTime.getMonth(),maxDateTime.getDate(),0,0,0,0);if(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null){this.hourMaxOriginal=o.hourMax;this.minuteMaxOriginal=o.minuteMax;this.secondMaxOriginal=o.secondMax;this.millisecMaxOriginal=o.millisecMax;}
if(dp_inst.settings.timeOnly||maxDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMax=maxDateTime.getHours();if(this.hour>=this._defaults.hourMax){this.hour=this._defaults.hourMax;this._defaults.minuteMax=maxDateTime.getMinutes();if(this.minute>=this._defaults.minuteMax){this.minute=this._defaults.minuteMax;this._defaults.secondMax=maxDateTime.getSeconds();}else if(this.second>=this._defaults.secondMax){this.second=this._defaults.secondMax;this._defaults.millisecMax=maxDateTime.getMilliseconds();}else{if(this.millisec>this._defaults.millisecMax)this.millisec=this._defaults.millisecMax;this._defaults.millisecMax=this.millisecMaxOriginal;}}else{this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal;}}else{this._defaults.hourMax=this.hourMaxOriginal;this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal;}}
if(adjustSliders!==undefined&&adjustSliders===true){var hourMax=parseInt((this._defaults.hourMax-((this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour)),10),minMax=parseInt((this._defaults.minuteMax-((this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute)),10),secMax=parseInt((this._defaults.secondMax-((this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond)),10),millisecMax=parseInt((this._defaults.millisecMax-((this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec)),10);if(this.hour_slider)
this.hour_slider.slider("option",{min:this._defaults.hourMin,max:hourMax}).slider('value',this.hour);if(this.minute_slider)
this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:minMax}).slider('value',this.minute);if(this.second_slider)
this.second_slider.slider("option",{min:this._defaults.secondMin,max:secMax}).slider('value',this.second);if(this.millisec_slider)
this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:millisecMax}).slider('value',this.millisec);}},_onTimeChange:function(){var hour=(this.hour_slider)?this.hour_slider.slider('value'):false,minute=(this.minute_slider)?this.minute_slider.slider('value'):false,second=(this.second_slider)?this.second_slider.slider('value'):false,millisec=(this.millisec_slider)?this.millisec_slider.slider('value'):false,timezone=(this.timezone_select)?this.timezone_select.val():false,o=this._defaults;if(typeof(hour)=='object')hour=false;if(typeof(minute)=='object')minute=false;if(typeof(second)=='object')second=false;if(typeof(millisec)=='object')millisec=false;if(typeof(timezone)=='object')timezone=false;if(hour!==false)hour=parseInt(hour,10);if(minute!==false)minute=parseInt(minute,10);if(second!==false)second=parseInt(second,10);if(millisec!==false)millisec=parseInt(millisec,10);var ampm=o[hour<12?'amNames':'pmNames'][0];var hasChanged=(hour!=this.hour||minute!=this.minute||second!=this.second||millisec!=this.millisec||(this.ampm.length>0&&(hour<12)!=($.inArray(this.ampm.toUpperCase(),this.amNames)!==-1))||timezone!=this.timezone);if(hasChanged){if(hour!==false)this.hour=hour;if(minute!==false)this.minute=minute;if(second!==false)this.second=second;if(millisec!==false)this.millisec=millisec;if(timezone!==false)this.timezone=timezone;if(!this.inst)this.inst=$.datepicker._getInst(this.$input[0]);this._limitMinMaxDateTime(this.inst,true);}
if(o.ampm)this.ampm=ampm;this.formattedTime=$.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults);if(this.$timeObj)this.$timeObj.text(this.formattedTime+o.timeSuffix);this.timeDefined=true;if(hasChanged)this._updateDateTime();},_onSelectHandler:function(){var onSelect=this._defaults.onSelect;var inputEl=this.$input?this.$input[0]:null;if(onSelect&&inputEl){onSelect.apply(inputEl,[this.formattedDateTime,this]);}},_formatTime:function(time,format){time=time||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var tmptime=(format||this._defaults.timeFormat).toString();tmptime=$.datepicker.formatTime(tmptime,time,this._defaults);if(arguments.length)return tmptime;else this.formattedTime=tmptime;},_updateDateTime:function(dp_inst){dp_inst=this.inst||dp_inst;var dt=$.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay)),dateFmt=$.datepicker._get(dp_inst,'dateFormat'),formatCfg=$.datepicker._getFormatConfig(dp_inst),timeAvailable=dt!==null&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(dateFmt,(dt===null?new Date():dt),formatCfg);var formattedDateTime=this.formattedDate;if(dp_inst.lastVal!==undefined&&(dp_inst.lastVal.length>0&&this.$input.val().length===0))
return;if(this._defaults.timeOnly===true){formattedDateTime=this.formattedTime;}else if(this._defaults.timeOnly!==true&&(this._defaults.alwaysSetTime||timeAvailable)){formattedDateTime+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix;}
this.formattedDateTime=formattedDateTime;if(!this._defaults.showTimepicker){this.$input.val(this.formattedDate);}else if(this.$altInput&&this._defaults.altFieldTimeOnly===true){this.$altInput.val(this.formattedTime);this.$input.val(this.formattedDate);}else if(this.$altInput){this.$altInput.val(formattedDateTime);this.$input.val(formattedDateTime);}else{this.$input.val(formattedDateTime);}
this.$input.trigger("change");}});$.fn.extend({timepicker:function(o){o=o||{};var tmp_args=arguments;if(typeof o=='object')tmp_args[0]=$.extend(o,{timeOnly:true});return $(this).each(function(){$.fn.datetimepicker.apply($(this),tmp_args);});},datetimepicker:function(o){o=o||{};var $input=this,tmp_args=arguments;if(typeof(o)=='string'){if(o=='getDate'||o=='widget')
return $.fn.datepicker.apply($(this[0]),tmp_args);else
return this.each(function(){var $t=$(this);$t.datepicker.apply($t,tmp_args);});}
else
return this.each(function(){var $t=$(this);$t.datepicker($.timepicker._newInst($t,o)._defaults);});}});$.datepicker.formatTime=function(format,time,options){options=options||{};options=$.extend($.timepicker._defaults,options);time=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:'+0000'},time);var tmptime=format;var ampmName=options['amNames'][0];var hour=parseInt(time.hour,10);if(options.ampm){if(hour>11){ampmName=options['pmNames'][0];if(hour>12)
hour=hour%12;}
if(hour===0)
hour=12;}
tmptime=tmptime.replace(/(?:hh?|mm?|ss?|[tT]{1,2}|[lz])/g,function(match){switch(match.toLowerCase()){case'hh':return('0'+hour).slice(-2);case'h':return hour;case'mm':return('0'+time.minute).slice(-2);case'm':return time.minute;case'ss':return('0'+time.second).slice(-2);case's':return time.second;case'l':return('00'+time.millisec).slice(-3);case'z':return time.timezone;case't':case'tt':if(options.ampm){if(match.length==1)
ampmName=ampmName.charAt(0);return match.charAt(0)=='T'?ampmName.toUpperCase():ampmName.toLowerCase();}
return'';}});tmptime=$.trim(tmptime);return tmptime;}
$.datepicker._base_selectDate=$.datepicker._selectDate;$.datepicker._selectDate=function(id,dateStr){var inst=this._getInst($(id)[0]),tp_inst=this._get(inst,'timepicker');if(tp_inst){tp_inst._limitMinMaxDateTime(inst,true);inst.inline=inst.stay_open=true;this._base_selectDate(id,dateStr);inst.inline=inst.stay_open=false;this._notifyChange(inst);this._updateDatepicker(inst);}
else this._base_selectDate(id,dateStr);};$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){var input=inst.input[0];if($.datepicker._curInst&&$.datepicker._curInst!=inst&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=input){return;}
if(typeof(inst.stay_open)!=='boolean'||inst.stay_open===false){this._base_updateDatepicker(inst);var tp_inst=this._get(inst,'timepicker');if(tp_inst)tp_inst._addTimePicker(inst);}};$.datepicker._base_doKeyPress=$.datepicker._doKeyPress;$.datepicker._doKeyPress=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,'timepicker');if(tp_inst){if($.datepicker._get(inst,'constrainInput')){var ampm=tp_inst._defaults.ampm,dateChars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat')),datetimeChars=tp_inst._defaults.timeFormat.toString().replace(/[hms]/g,'').replace(/TT/g,ampm?'APM':'').replace(/Tt/g,ampm?'AaPpMm':'').replace(/tT/g,ampm?'AaPpMm':'').replace(/T/g,ampm?'AP':'').replace(/tt/g,ampm?'apm':'').replace(/t/g,ampm?'ap':'')+" "+
tp_inst._defaults.separator+
tp_inst._defaults.timeSuffix+
(tp_inst._defaults.showTimezone?tp_inst._defaults.timezoneList.join(''):'')+
(tp_inst._defaults.amNames.join(''))+
(tp_inst._defaults.pmNames.join(''))+
dateChars,chr=String.fromCharCode(event.charCode===undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<' '||!dateChars||datetimeChars.indexOf(chr)>-1);}}
return $.datepicker._base_doKeyPress(event);};$.datepicker._base_doKeyUp=$.datepicker._doKeyUp;$.datepicker._doKeyUp=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,'timepicker');if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst);}
catch(err){$.datepicker.log(err);}}}
return $.datepicker._base_doKeyUp(event);};$.datepicker._base_gotoToday=$.datepicker._gotoToday;$.datepicker._gotoToday=function(id){var inst=this._getInst($(id)[0]),$dp=inst.dpDiv;this._base_gotoToday(id);var now=new Date();var tp_inst=this._get(inst,'timepicker');if(tp_inst&&tp_inst._defaults.showTimezone&&tp_inst.timezone_select){var tzoffset=now.getTimezoneOffset();var tzsign=tzoffset>0?'-':'+';tzoffset=Math.abs(tzoffset);var tzmin=tzoffset%60;tzoffset=tzsign+('0'+(tzoffset-tzmin)/60).slice(-2)+('0'+tzmin).slice(-2);if(tp_inst._defaults.timezoneIso8609)
tzoffset=tzoffset.substring(0,3)+':'+tzoffset.substring(3);tp_inst.timezone_select.val(tzoffset);}
this._setTime(inst,now);$('.ui-datepicker-today',$dp).click();};$.datepicker._disableTimepickerDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');$(target).datepicker('getDate');if(tp_inst){tp_inst._defaults.showTimepicker=false;tp_inst._updateDateTime(inst);}};$.datepicker._enableTimepickerDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');$(target).datepicker('getDate');if(tp_inst){tp_inst._defaults.showTimepicker=true;tp_inst._addTimePicker(inst);tp_inst._updateDateTime(inst);}};$.datepicker._setTime=function(inst,date){var tp_inst=this._get(inst,'timepicker');if(tp_inst){var defaults=tp_inst._defaults,hour=date?date.getHours():defaults.hour,minute=date?date.getMinutes():defaults.minute,second=date?date.getSeconds():defaults.second,millisec=date?date.getMilliseconds():defaults.millisec;if((hour<defaults.hourMin||hour>defaults.hourMax)||(minute<defaults.minuteMin||minute>defaults.minuteMax)||(second<defaults.secondMin||second>defaults.secondMax)||(millisec<defaults.millisecMin||millisec>defaults.millisecMax)){hour=defaults.hourMin;minute=defaults.minuteMin;second=defaults.secondMin;millisec=defaults.millisecMin;}
tp_inst.hour=hour;tp_inst.minute=minute;tp_inst.second=second;tp_inst.millisec=millisec;if(tp_inst.hour_slider)tp_inst.hour_slider.slider('value',hour);if(tp_inst.minute_slider)tp_inst.minute_slider.slider('value',minute);if(tp_inst.second_slider)tp_inst.second_slider.slider('value',second);if(tp_inst.millisec_slider)tp_inst.millisec_slider.slider('value',millisec);tp_inst._onTimeChange();tp_inst._updateDateTime(inst);}};$.datepicker._setTimeDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');if(tp_inst){this._setDateFromField(inst);var tp_date;if(date){if(typeof date=="string"){tp_inst._parseTime(date,withDate);tp_date=new Date();tp_date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec);}
else tp_date=new Date(date.getTime());if(tp_date.toString()=='Invalid Date')tp_date=undefined;this._setTime(inst,tp_date);}}};$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker;$.datepicker._setDateDatepicker=function(target,date){var inst=this._getInst(target),tp_date=(date instanceof Date)?new Date(date.getTime()):date;this._updateDatepicker(inst);this._base_setDateDatepicker.apply(this,arguments);this._setTimeDatepicker(target,tp_date,true);};$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker;$.datepicker._getDateDatepicker=function(target,noDefault){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');if(tp_inst){this._setDateFromField(inst,noDefault);var date=this._getDate(inst);if(date&&tp_inst._parseTime($(target).val(),tp_inst.timeOnly))date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec);return date;}
return this._base_getDateDatepicker(target,noDefault);};$.datepicker._base_parseDate=$.datepicker.parseDate;$.datepicker.parseDate=function(format,value,settings){var date;try{date=this._base_parseDate(format,value,settings);}catch(err){if(err.indexOf(":")>=0){date=this._base_parseDate(format,value.substring(0,value.length-(err.length-err.indexOf(':')-2)),settings);}else{throw err;}}
return date;};$.datepicker._base_formatDate=$.datepicker._formatDate;$.datepicker._formatDate=function(inst,day,month,year){var tp_inst=this._get(inst,'timepicker');if(tp_inst)
{if(day)
var b=this._base_formatDate(inst,day,month,year);tp_inst._updateDateTime(inst);return tp_inst.$input.val();}
return this._base_formatDate(inst);};$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker;$.datepicker._optionDatepicker=function(target,name,value){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');if(tp_inst){var min,max,onselect;if(typeof name=='string'){if(name==='minDate'||name==='minDateTime')
min=value;else if(name==='maxDate'||name==='maxDateTime')
max=value;else if(name==='onSelect')
onselect=value;}else if(typeof name=='object'){if(name.minDate)
min=name.minDate;else if(name.minDateTime)
min=name.minDateTime;else if(name.maxDate)
max=name.maxDate;else if(name.maxDateTime)
max=name.maxDateTime;}
if(min){if(min==0)
min=new Date();else
min=new Date(min);tp_inst._defaults.minDate=min;tp_inst._defaults.minDateTime=min;}else if(max){if(max==0)
max=new Date();else
max=new Date(max);tp_inst._defaults.maxDate=max;tp_inst._defaults.maxDateTime=max;}
else if(onselect)
tp_inst._defaults.onSelect=onselect;}
if(value===undefined)
return this._base_optionDatepicker(target,name);return this._base_optionDatepicker(target,name,value);};function extendRemove(target,props){$.extend(target,props);for(var name in props)
if(props[name]===null||props[name]===undefined)
target[name]=props[name];return target;};$.timepicker=new Timepicker();$.timepicker.version="0.9.9";})(jQuery);;

/* /web/static/lib/jquery.ui.notify/js/jquery.notify.js defined in bundle 'web.assets_backend' */
(function($){$.widget("ech.notify",{options:{speed:500,expires:5000,stack:'below',custom:false},_create:function(){var self=this;this.templates={};this.keys=[];this.element.addClass("ui-notify").children().addClass("ui-notify-message ui-notify-message-style").each(function(i){var key=this.id||i;self.keys.push(key);self.templates[key]=$(this).removeAttr("id").wrap("<div></div>").parent().html();}).end().empty().show();},create:function(template,msg,opts){if(typeof template==="object"){opts=msg;msg=template;template=null;}
var tpl=this.templates[template||this.keys[0]];if(opts&&opts.custom){tpl=$(tpl).removeClass("ui-notify-message-style").wrap("<div></div>").parent().html();}
return new $.ech.notify.instance(this)._create(msg,$.extend({},this.options,opts),tpl);}});$.extend($.ech.notify,{instance:function(widget){this.parent=widget;this.isOpen=false;}});$.extend($.ech.notify.instance.prototype,{_create:function(params,options,template){this.options=options;var self=this,html=template.replace(/#(?:\{|%7B)(.*?)(?:\}|%7D)/g,function($1,$2){return($2 in params)?params[$2]:'';}),m=(this.element=$(html)),closelink=m.find(".ui-notify-close");if(typeof this.options.click==="function"){m.addClass("ui-notify-click").bind("click",function(e){self._trigger("click",e,self);});}
if(closelink.length){closelink.bind("click",function(){self.close();return false;});}
this.open();if(typeof options.expires==="number"){window.setTimeout(function(){self.close();},options.expires);}
return this;},close:function(){var self=this,speed=this.options.speed;this.element.fadeTo(speed,0).slideUp(speed,function(){self._trigger("close");self.isOpen=false;});return this;},open:function(){if(this.isOpen||this._trigger("beforeopen")===false){return this;}
var self=this;this.element[this.options.stack==='above'?'prependTo':'appendTo'](this.parent.element).css({display:"none",opacity:""}).fadeIn(this.options.speed,function(){self._trigger("open");self.isOpen=true;});return this;},widget:function(){return this.element;},_trigger:function(type,e,instance){return this.parent._trigger.call(this,type,e,instance);}});})(jQuery);;

/* /web/static/lib/backbone/backbone.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/[?#].*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.slice(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||''));fragment=fragment.replace(pathStripper,'');if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===''&&url!=='/')url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);;

/* <inline asset> defined in bundle 'web.assets_backend' */
openerp._modules=["web","web_kanban","base","web_ckeditor4","base_setup","mail","email_template","tag_newsletter","edi","share","website","web_kanban_sparkline","sales_team","report","product","board","account","account_voucher","sale","payment","website_sale","web_tests","tag_disable_openerp_online","web_analytics","knowledge","sfp_birthday_wish","web_sheet_full_width","web_calendar","calendar","crm","notification_crm","tag_custom_blog","base_import","web_view_editor","web_menu","website_mail","document_page_adhoc","help_online","web_gantt","website_embed","entity_html_form","web_kanban_gauge","mass_mailing","point_of_sale","bus","im_chat","gantt_improvement","event","contacts","tag_custom_menu_bar","website_blog","website_blog_facebook_comment","payment_transfer","website_google_map","google_drive","google_spreadsheet","web_graph","tag_website_landing_pages","web_iframe","web_iframe_pages","document_page_extension","help_doc","google_calendar","web_searchbar_full_width","website_crm","tag_google_map","mass_mailing_extra","hr","cron_run_manually","im_odoo_support","web_diagram","project","fleet","event_sale","tag_support_branding","payment_paypal","account_accountant","tag_html_embed_form_generator","note","document","stock","project_issue","portal","portal_project_issue","hr_attendance","membership","restrict_db_mgr","purchase","builder","hr_timesheet_sheet","tko_mail_smtp_per_user"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^']*)'",'([uU])?"([^"]*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end=undefined;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');var initial=token[0];if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{unicode:!!(m[2]||m[4]),value:(m[3]!==undefined?m[3]:m[5])}));}else if(token in symbols){var symbol;if(token==='in'&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];kwargs={};}else if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}else if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.tuple;py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(PY_decode_string_literal(expr.value,expr.unicode));case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/src/js/boot.js defined in bundle 'web.assets_backend' */
(function(){openerp.web=_.clone(openerp);var inited=false;_.extend(openerp,{instances:{instance0:openerp},_openerp:openerp,_session_id:"instance0",_modules:openerp._modules||['web'],web_mobile:{},init:function(modules){if(modules===undefined){modules=openerp._modules;}
modules=_.without(modules,"web");if(inited)
throw new Error("OpenERP was already inited");inited=true;for(var i=0;i<modules.length;i++){var fct=openerp[modules[i]];if(typeof(fct)==="function"){openerp[modules[i]]={};for(var k in fct){openerp[modules[i]][k]=fct[k];}
fct(openerp,openerp[modules[i]]);}}
openerp._modules=['web'].concat(modules);return openerp;}});})();;

/* /web/static/src/js/testing.js defined in bundle 'web.assets_backend' */
openerp.testing={};(function(testing){var dependencies={pyeval:[],core:['pyeval'],data:['core'],dates:[],formats:['core','dates'],chrome:['core'],views:['core','data','chrome'],search:['views','formats'],list:['views','data'],form:['data','views','list','formats'],list_editable:['list','form','data'],};var initialized=[];function init(modules){if(!initialized.length){openerp.init(modules);initialized=openerp._modules.slice();return;}
var to_initialize=_.difference(modules,initialized);for(var i=0;i<to_initialize.length;i++){var modname=to_initialize[i];var fct=openerp[modname];if(typeof fct==='function'){var module=openerp[modname]={};for(var k in fct){if(!fct.hasOwnProperty(k)){continue;}
module[k]=fct[k];}
fct(openerp,module)}
initialized.push(modname);openerp._modules.push(modname);}}
testing.dependencies=window['oe_all_dependencies']||[];testing.current_module=null;testing.noop=function(){};testing.mockifyRPC=function(instance,responses){var session=instance.session;session.responses=responses||{};session.rpc=function(url,rparams,options){if(_.isString(url)){url={url:url};}
var fn,params;var needle=rparams.model+':'+rparams.method;if(url.url.substr(0,20)==='/web/dataset/call_kw'&&needle in this.responses){fn=this.responses[needle];params=[rparams.args||[],rparams.kwargs||{}];}else{fn=this.responses[url.url];params=[{params:rparams}];}
if(!fn){return $.Deferred().reject({},'failed',_.str.sprintf("Url %s not found in mock responses, with arguments %s",url.url,JSON.stringify(rparams))).promise();}
try{return $.when(fn.apply(null,params)).then(function(result){return result;});}catch(e){return $.Deferred().reject({},'failed',String(e));}};};var StackProto={execute:function(fn){var args=[].slice.call(arguments,1);var i=0,setups=this.setups,teardowns=this.teardowns;var d=$.Deferred();var succeeded,failed;var success=function(){succeeded=_.toArray(arguments);return teardown();};var failure=function(){if(!failed){failed=_.toArray(arguments);}
return teardown();};var setup=function(){if(i<setups.length){var f=setups[i]||testing.noop;$.when(f.apply(null,args)).then(function(){++i;setup();},failure);}else{$.when(fn.apply(null,args)).then(success,failure);}};var teardown=function(){if(i>0){var f=teardowns[--i]||testing.noop;$.when(f.apply(null,args)).then(teardown,failure);}else{if(failed){d.reject.apply(d,failed);}else if(succeeded){d.resolve.apply(d,succeeded);}else{throw new Error("Didn't succeed or fail?");}}};setup();return d;},push:function(setup,teardown){return _.extend(Object.create(StackProto),{setups:this.setups.concat([setup]),teardowns:this.teardowns.concat([teardown])});},unshift:function(setup,teardown){return _.extend(Object.create(StackProto),{setups:[setup].concat(this.setups),teardowns:[teardown].concat(this.teardowns)});}};testing.Stack=function(setup,teardown){return _.extend(Object.create(StackProto),{setups:setup?[setup]:[],teardowns:teardown?[teardown]:[]});};testing.section=function(name,options,body){if(_.isFunction(options)){body=options;options={};}
_.defaults(options,{setup:testing.noop,teardown:testing.noop});QUnit.module(name,{_oe:options});body(testing['case']);};testing['case']=function(name,options,callback){if(_.isFunction(options)){callback=options;options={};}
var module=testing.current_module;var module_index=_.indexOf(testing.dependencies,module);var module_deps=testing.dependencies.slice(0,module_index+1||undefined);var env=QUnit.config.currentModuleTestEnvironment;var case_stack=testing.Stack().push(env._oe.setup,env._oe.teardown).push(options.setup,options.teardown);var opts=_.defaults({},options,env._oe);QUnit.test(name,function(){var instance=openerp;init(module_deps);instance.session=new instance.web.Session();instance.session.uid=42;if(_.isNumber(opts.asserts)){expect(opts.asserts);}
var $fixture=$('#qunit-fixture');var mock,async=false;switch(opts.rpc){case'mock':async=true;testing.mockifyRPC(instance);mock=function(spec,handler){instance.session.responses[spec]=handler;};break;}
stop();var timeout;case_stack.execute(function(){var result=callback.apply(null,arguments);if(!(result&&_.isFunction(result.then))){if(async){ok(false,"asynchronous test cases must return a promise");}}else{if(!_.isNumber(opts.asserts)){ok(false,"asynchronous test cases must specify the "
+"number of assertions they expect");}}
return $.Deferred(function(d){$.when(result).then(function(){d.resolve.apply(d,arguments);},function(){d.reject.apply(d,arguments);});if(async||(result&&result.then)){timeout=setTimeout(function(){QUnit.config.semaphore=1;d.reject({message:"Test timed out"});},2000);}});},instance,$fixture,mock).always(function(){if(timeout){clearTimeout(timeout);}
start();}).fail(function(error){if(options.fail_on_rejection===false){return;}
var message;if(typeof error!=='object'||typeof error.message!=='string'){message=JSON.stringify([].slice.apply(arguments));}else{message=error.message;if(error.data&&error.data.debug){message+='\n\n'+error.data.debug;}}
ok(false,message);});});};})(openerp.testing);;

/* /web/static/src/js/pyeval.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;instance.web.pyeval={};var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var divmod=function(a,b,fn){var mod=a%b;if(mod>0&&b<0||mod<0&&b>0){mod+=b;}
return fn(Math.floor(a/b),mod);};var modf=function(x,fn){var mod=x%1;if(mod<0){mod+=1;}
return fn(mod,Math.floor(x));};var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
var is_leap=function(year){return year%4===0&&(year%100!==0||year%400===0);};var days_before_year=function(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);};var days_in_month=function(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];};var days_before_month=function(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]
+(post_leap_feb?1:0);};var ymd2ord=function(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)
+days_before_month(year,month)
+day;};var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);var assert=function(bool){if(!bool){throw new Error("AssertionError");}};var ord2ymd=function(n){--n;var n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};};var tmxxx=function(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};};datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=modf(days,function(dayfrac,days){d=days;if(dayfrac){return modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,function(seconds,microseconds){divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;divmod(this.seconds,60,function(m,s){divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},now:py.classmethod.fromJSON(function(){var d=new Date;return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return this.__add__(other.__neg__());}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date;return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});var context_today=function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);};datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day hour minute second microsecond '
+'years months weeks days hours minutes secondes microseconds '
+'weekday leakdays yearday nlyearday').split(' '),function(arg){return[arg,null];});args.unshift('*');var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);},__add__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=asJS(this.ops.year)||asJS(other.year);if(asJS(this.ops.years)){year+=asJS(this.ops.years);}
var month=asJS(this.ops.month)||asJS(other.month);if(asJS(this.ops.months)){month+=asJS(this.ops.months);while(month<1){year-=1;month+=12;}
while(month>12){year+=1;month-=12;}}
var lastMonthDay=new Date(year,month,0).getDate();var day=asJS(this.ops.day)||asJS(other.day);if(day>lastMonthDay){day=lastMonthDay;}
var days_offset=((asJS(this.ops.weeks)||0)*7)+(asJS(this.ops.days)||0);if(days_offset){day=new Date(year,month-1,day+days_offset).getDate();}
return py.PY_call(datetime.date,[py.float.fromJSON(year),py.float.fromJSON(month),py.float.fromJSON(day)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=asJS(this.ops.year)||asJS(other.year);if(asJS(this.ops.years)){year-=asJS(this.ops.years);}
var month=asJS(this.ops.month)||asJS(other.month);if(asJS(this.ops.months)){month-=asJS(this.ops.months);while(month<1){year-=1;month+=12;}
while(month>12){year+=1;month-=12;}}
var lastMonthDay=new Date(year,month,0).getDate();var day=asJS(this.ops.day)||asJS(other.day);if(day>lastMonthDay){day=lastMonthDay;}
var days_offset=((asJS(this.ops.weeks)||0)*7)+(asJS(this.ops.days)||0);if(days_offset){day=new Date(year,month-1,day-days_offset).getDate();}
return py.PY_call(datetime.date,[py.float.fromJSON(year),py.float.fromJSON(month),py.float.fromJSON(day)]);},__rsub__:function(other){return this.__sub__(other);}});var wrap=function(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);};var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});var wrap_context=function(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;};var eval_contexts=function(contexts,evaluation_context){evaluation_context=_.extend(instance.web.pyeval.context(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});};var eval_domains=function(domains,evaluation_context){evaluation_context=_.extend(instance.web.pyeval.context(),evaluation_context||{});var result_domain=[];_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;result_domain.push.apply(result_domain,py.eval(domain.__debug,wrap_context(evaluation_context)));break;case'compound_domain':var eval_context=eval_contexts([domain.__eval_context]);result_domain.push.apply(result_domain,eval_domains(domain.__domains,_.extend({},evaluation_context,eval_context)));break;default:result_domain.push.apply(result_domain,domain);}});return result_domain;};var eval_groupbys=function(contexts,evaluation_context){evaluation_context=_.extend(instance.web.pyeval.context(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;};instance.web.pyeval.context=function(){return _.extend({datetime:datetime,context_today:context_today,time:time,relativedelta:relativedelta,current_date:py.PY_call(time.strftime,[py.str.fromJSON('%Y-%m-%d')]),},instance.session.user_context);};instance.web.pyeval.eval=function(type,object,context,options){options=options||{};context=_.extend(instance.web.pyeval.context(),context||{});switch(type){case'context':case'contexts':if(type==='context')
object=[object];return eval_contexts((options.no_user_context?[]:[instance.session.user_context]).concat(object),context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);};var eval_arg=function(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':case'compound_domain':return instance.web.pyeval.eval('domains',[arg]);case'context':case'compound_context':return instance.web.pyeval.eval('contexts',[arg]);default:throw new Error(instance.web._t("Unknown nonliteral type "+arg.__ref));}};instance.web.pyeval.ensure_evaluated=function(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}};instance.web.pyeval.eval_domains_and_contexts=function(source){return new $.Deferred(function(d){setTimeout(function(){var result;try{result=instance.web.pyeval.sync_eval_domains_and_contexts(source);}
catch(e){result={error:{code:400,message:instance.web._t("Evaluation Error"),data:{type:'local_exception',debug:_.str.sprintf(instance.web._t("Local evaluation failure\n%s\n\n%s"),e.message,JSON.stringify(source))}}};}
d.resolve(result);},0);});};instance.web.pyeval.sync_eval_domains_and_contexts=function(source){var contexts=([instance.session.user_context]||[]).concat(source.contexts);return{context:instance.web.pyeval.eval('contexts',contexts),domain:instance.web.pyeval.eval('domains',source.domains),group_by:instance.web.pyeval.eval('groupbys',source.group_by_seq||[])};};})();;

/* /web/static/src/js/core.js defined in bundle 'web.assets_backend' */
(function(){if(typeof(console)==="undefined"){window.console={};('log error debug info warn assert clear dir dirxml trace group'
+' groupCollapsed groupEnd time timeEnd profile profileEnd count'
+' exception').split(/\s+/).forEach(function(property){console[property]=_.identity;});}
var instance=openerp;openerp.web.core={};var ControllerMixin={do_action:function(){var parent=this.getParent();if(parent){return parent.do_action.apply(parent,arguments);}
return false;},do_notify:function(){if(this.getParent()){return this.getParent().do_notify.apply(this,arguments);}
return false;},do_warn:function(){if(this.getParent()){return this.getParent().do_warn.apply(this,arguments);}
return false;},rpc:function(url,data,options){return this.alive(openerp.session.rpc(url,data,options));}};openerp.web.Controller=openerp.web.Class.extend(openerp.web.PropertiesMixin,ControllerMixin,{init:function(parent){openerp.web.PropertiesMixin.init.call(this);this.setParent(parent);this.session=openerp.session;},});openerp.web.Widget.include(_.extend({},ControllerMixin,{init:function(){this._super.apply(this,arguments);this.session=openerp.session;},}));instance.web.Registry=instance.web.Class.extend({init:function(mapping){this.parent=null;this.map=mapping||{};},get_object:function(key,silent_error){var path_string=this.map[key];if(path_string===undefined){if(this.parent){return this.parent.get_object(key,silent_error);}
if(silent_error){return void'nooo';}
return null;}
var object_match=instance;var path=path_string.split('.');for(var i=1;i<path.length;++i){object_match=object_match[path[i]];if(object_match===undefined){if(silent_error){return void'noooooo';}
return null;}}
return object_match;},contains:function(key){if(key===undefined){return false;}
if(key in this.map){return true;}
if(this.parent){return this.parent.contains(key);}
return false;},get_any:function(keys){for(var i=0;i<keys.length;++i){var key=keys[i];if(!this.contains(key)){continue;}
return this.get_object(key);}
return null;},add:function(key,object_path){this.map[key]=object_path;return this;},extend:function(mapping){var child=new instance.web.Registry(mapping);child.parent=this;return child;},clone:function(mapping){console.warn('Registry#clone is deprecated, use Registry#extend');return this.extend(mapping);}});instance.web.py_eval=function(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));};instance.web.JsonRPC=instance.web.Session;instance.web.Session.include({init:function(){this._super.apply(this,arguments);this.debug=($.deparam($.param.querystring()).debug!==undefined);this.name=instance._session_id;this.qweb_mutex=new $.Mutex();},session_bind:function(origin){var self=this;this.setup(origin);instance.web.qweb.default_dict['_s']=this.origin;this.uid=null;this.username=null;this.user_context={};this.db=null;this.module_list=instance._modules.slice();this.module_loaded={};_(this.module_list).each(function(mod){self.module_loaded[mod]=true;});this.active_id=null;return this.session_init();},session_init:function(){var self=this;return this.session_reload().then(function(result){var modules=instance._modules.join(',');var deferred=self.load_qweb(modules);if(self.session_is_valid()){return deferred.then(function(){return self.load_modules();});}
return $.when(deferred,self.rpc('/web/webclient/bootstrap_translations',{mods:instance._modules}).then(function(trans){instance.web._t.database.set_bundle(trans);}));});},session_is_valid:function(){var db=$.deparam.querystring().db;if(db&&this.db!==db){return false;}
return!!this.uid;},session_authenticate:function(){var self=this;return $.when(this._super.apply(this,arguments)).then(function(){return self.load_modules();});},session_logout:function(){$.bbq.removeState();return this.rpc("/web/session/destroy",{});},get_cookie:function(name){if(!this.name){return null;}
var nameEQ=this.name+'|'+name+'=';var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;++i){var cookie=cookies[i].replace(/^\s*/,'');if(cookie.indexOf(nameEQ)===0){try{return JSON.parse(decodeURIComponent(cookie.substring(nameEQ.length)));}catch(err){this.set_cookie(name,'',-1);}}}
return null;},set_cookie:function(name,value,ttl){if(!this.name){return;}
ttl=ttl||24*60*60*365;document.cookie=[this.name+'|'+name+'='+encodeURIComponent(JSON.stringify(value)),'path=/','max-age='+ttl,'expires='+new Date(new Date().getTime()+ttl*1000).toGMTString()].join(';');},load_modules:function(){var self=this;return this.rpc('/web/session/modules',{}).then(function(result){var all_modules=_.uniq(self.module_list.concat(result));var to_load=_.difference(result,self.module_list).join(',');self.module_list=all_modules;var loaded=self.load_translations();var datejs_locale="/web/static/lib/datejs/globalization/"+self.user_context.lang.replace("_","-")+".js";var file_list=[datejs_locale];if(to_load.length){loaded=$.when(loaded,self.rpc('/web/webclient/csslist',{mods:to_load}).done(self.load_css.bind(self)),self.load_qweb(to_load),self.rpc('/web/webclient/jslist',{mods:to_load}).done(function(files){file_list=file_list.concat(files);}));}
return loaded.then(function(){return self.load_js(file_list);}).done(function(){self.on_modules_loaded();self.trigger('module_loaded');if(!Date.CultureInfo.pmDesignator){Date.CultureInfo.amDesignator='AM';Date.CultureInfo.pmDesignator='PM';}});});},load_translations:function(){return instance.web._t.database.load_translations(this,this.module_list,this.user_context.lang);},load_css:function(files){var self=this;_.each(files,function(file){openerp.loadCSS(self.url(file,null));});},load_js:function(files){var self=this;var d=$.Deferred();if(files.length!==0){var file=files.shift();var url=self.url(file,null);openerp.loadJS(url).done(d.resolve);}else{d.resolve();}
return d;},load_qweb:function(mods){var self=this;self.qweb_mutex.exec(function(){return self.rpc('/web/proxy/load',{path:'/web/webclient/qweb?mods='+mods}).then(function(xml){if(!xml){return;}
instance.web.qweb.add_template(_.str.trim(xml));});});return self.qweb_mutex.def;},on_modules_loaded:function(){for(var j=0;j<this.module_list.length;j++){var mod=this.module_list[j];if(this.module_loaded[mod])
continue;instance[mod]={};var fct=instance._openerp[mod];if(typeof(fct)==="function"){instance._openerp[mod]={};for(var k in fct){instance._openerp[mod][k]=fct[k];}
fct(instance,instance._openerp[mod]);}
this.module_loaded[mod]=true;}},get_file:function(options){var timer,token=new Date().getTime(),cookie_name='fileToken',cookie_length=cookie_name.length,CHECK_INTERVAL=1000,id=_.uniqueId('get_file_frame'),remove_form=false;if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){var params=_.extend({},options.data||{},{token:token});var url=this.url(options.url,params);instance.web.unblockUI();return window.open(url);}
var $form,$form_data=$('<div>');var complete=function(){if(options.complete){options.complete();}
clearTimeout(timer);$form_data.remove();$target.remove();if(remove_form&&$form){$form.remove();}};var $target=$('<iframe style="display: none;">').attr({id:id,name:id}).appendTo(document.body).load(function(){try{if(options.error){var body=this.contentDocument.body;var nodes=body.children.length===0?body.childNodes:body.children;var node=nodes[1]||nodes[0];options.error(JSON.parse(node.textContent));}}finally{complete();}});if(options.form){$form=$(options.form);}else{remove_form=true;$form=$('<form>',{action:options.url,method:'POST'}).appendTo(document.body);}
var hparams=_.extend({},options.data||{},{token:token});if(this.override_session)
hparams.session_id=this.session_id;_.each(hparams,function(value,key){var $input=$form.find('[name='+key+']');if(!$input.length){$input=$('<input type="hidden" name="'+key+'">').appendTo($form_data);}
$input.val(value);});$form.append($form_data).attr('target',id).get(0).submit();var waitLoop=function(){var cookies=document.cookie.split(';');timer=setTimeout(waitLoop,CHECK_INTERVAL);for(var i=0;i<cookies.length;++i){var cookie=cookies[i].replace(/^\s*/,'');if(!cookie.indexOf(cookie_name===0)){continue;}
var cookie_val=cookie.substring(cookie_length+1);if(parseInt(cookie_val,10)!==token){continue;}
document.cookie=_.str.sprintf("%s=;expires=%s;path=/",cookie_name,new Date().toGMTString());if(options.success){options.success();}
complete();return;}};timer=setTimeout(waitLoop,CHECK_INTERVAL);},synchronized_mode:function(to_execute){var synch=this.synch;this.synch=true;try{return to_execute();}finally{this.synch=synch;}}});instance.web.Bus=instance.web.Class.extend(instance.web.EventDispatcherMixin,{init:function(){instance.web.EventDispatcherMixin.init.call(this,parent);var self=this;_.each('click,dblclick,keydown,keypress,keyup'.split(','),function(evtype){$('html').on(evtype,function(ev){self.trigger(evtype,ev);});});_.each('resize,scroll'.split(','),function(evtype){$(window).on(evtype,function(ev){self.trigger(evtype,ev);});});}});instance.web.bus=new instance.web.Bus();instance.web.TranslationDataBase.include({set_bundle:function(translation_bundle){this._super(translation_bundle);if(translation_bundle.lang_parameters){this.parameters.grouping=py.eval(this.parameters.grouping);}},});$.browser=$.browser||{};if(navigator.appVersion.indexOf("MSIE")!==-1){$.browser.msie=1;}
$.fn.getAttributes=function(){var o={};if(this.length){for(var attr,i=0,attrs=this[0].attributes,l=attrs.length;i<l;i++){attr=attrs.item(i);o[attr.nodeName]=attr.nodeValue;}}
return o;};$.fn.openerpClass=function(additionalClass){additionalClass=additionalClass||'';if(!!$.browser.msie){additionalClass+=' openerp_ie';}
return this.each(function(){$(this).addClass('openerp '+additionalClass);});};$.fn.openerpBounce=function(){return this.each(function(){$(this).css('box-sizing','content-box').effect('bounce',{distance:18,times:5},250);});};$.Mutex=openerp.Mutex;$.async_when=function(){var async=false;var def=$.Deferred();$.when.apply($,arguments).done(function(){var args=arguments;var action=function(){def.resolve.apply(def,args);};if(async)
action();else
setTimeout(action,0);}).fail(function(){var args=arguments;var action=function(){def.reject.apply(def,args);};if(async)
action();else
setTimeout(action,0);});async=true;return def;};var old_async_when=$.async_when;$.async_when=function(){if(instance.session.synch)
return $.when.apply(this,arguments);else
return old_async_when.apply(this,arguments);};instance.session=new instance.web.Session();instance.web._lt=function(s){return{toString:function(){return instance.web._t(s);}};};instance.web.qweb.debug=instance.session.debug;_.extend(instance.web.qweb.default_dict,{'__debug__':instance.session.debug,});instance.web.qweb.preprocess_node=function(){switch(this.node.nodeType){case Node.TEXT_NODE:case Node.CDATA_SECTION_NODE:var translation=this.node.parentNode.attributes['t-translation'];if(translation&&translation.value==='off'){return;}
var match=/^(\s*)([\s\S]+?)(\s*)$/.exec(this.node.data);if(match){this.node.data=match[1]+instance.web._t(match[2])+match[3];}
break;case Node.ELEMENT_NODE:var attr,attrs=['label','title','alt','placeholder'];while((attr=attrs.pop())){if(this.attributes[attr]){this.attributes[attr]=instance.web._t(this.attributes[attr]);}}}};var _t=instance.web._t;{_t('less than a minute ago');_t('about a minute ago');_t('%d minutes ago');_t('about an hour ago');_t('%d hours ago');_t('a day ago');_t('%d days ago');_t('about a month ago');_t('%d months ago');_t('about a year ago');_t('%d years ago');}
instance.session.on('module_loaded',this,function(){$.timeago.settings.translator=instance.web._t;});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};instance.web.Throbber=instance.web.Widget.extend({template:"Throbber",start:function(){var opts={lines:13,length:7,width:4,radius:10,rotate:0,color:'#FFF',speed:1,trail:60,shadow:false,hwaccel:false,className:'spinner',zIndex:2e9,top:'auto',left:'auto'};this.spin=new Spinner(opts).spin(this.$el[0]);this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},destroy:function(){if(this.spin)
this.spin.stop();this._super();},});instance.web.Throbber.throbbers=[];instance.web.blockUI=function(){var tmp=$.blockUI.apply($,arguments);var throbber=new instance.web.Throbber();instance.web.Throbber.throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));return tmp;};instance.web.unblockUI=function(){_.each(instance.web.Throbber.throbbers,function(el){el.destroy();});return $.unblockUI.apply($,arguments);};$.fn.tooltip.Constructor.DEFAULTS.placement='auto top';$.fn.tooltip.Constructor.DEFAULTS.html=true;$.fn.tooltip.Constructor.DEFAULTS.trigger='hover focus click';$.fn.tooltip.Constructor.DEFAULTS.container='body';var bootstrap_show_function=$.fn.tooltip.Constructor.prototype.show;$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.tooltip.Constructor.prototype.show=function(){$('.tooltip').remove();var e=$.Event('show.bs.'+this.type);var inDom=$.contains(document.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!inDom)return;return bootstrap_show_function.call(this);};instance.web.client_actions=new instance.web.Registry();})();;

/* /web/static/src/js/formats.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.formats={};var _t=instance.web._t;instance.web.intersperse=function(str,indices,separator){separator=separator||'';var result=[],last=str.length;for(var i=0;i<indices.length;++i){var section=indices[i];if(section===-1||last<=0){break;}else if(section===0&&i===0){break;}else if(section===0){section=indices[--i];}
result.push(str.substring(last-section,last));last-=section;}
var s=str.substring(0,last);if(s){result.push(s);}
return result.reverse().join(separator);};instance.web.insert_thousand_seps=function(num){var negative=num[0]==='-';num=(negative?num.slice(1):num);return(negative?'-':'')+instance.web.intersperse(num,_t.database.parameters.grouping,_t.database.parameters.thousands_sep);};instance.web.strip_raw_chars=function(value){var isletter=/[a-zA-Z]/,output=[];for(var index=0;index<value.length;++index){var character=value[index];if(isletter.test(character)&&(index===0||value[index-1]!=='%')){continue;}
output.push(character);}
return output.join('');};var normalize_format=function(format){return Date.normalizeFormat(instance.web.strip_raw_chars(format));};instance.web.binary_to_binsize=function(value){if(!value){return instance.web.human_size(0);}
if(value.substr(0,10).indexOf(' ')==-1){return instance.web.human_size(value.length/1.37);}else{return value;}};instance.web.human_size=function(size){var units=_t("Bytes,Kb,Mb,Gb,Tb,Pb,Eb,Zb,Yb").split(',');var i=0;while(size>=1024){size/=1024;++i;}
return size.toFixed(2)+' '+units[i];};instance.web.format_value=function(value,descriptor,value_if_empty){if(typeof value==='number'&&isNaN(value)){value=false;}
switch(value){case'':if(descriptor.type==='char'||descriptor.type==='text'){return'';}
console.warn('Field',descriptor,'had an empty string as value, treating as false...');return value_if_empty===undefined?'':value_if_empty;case false:case undefined:case Infinity:case-Infinity:return value_if_empty===undefined?'':value_if_empty;}
var l10n=_t.database.parameters;switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'id':return value.toString();case'integer':return instance.web.insert_thousand_seps(_.str.sprintf('%d',value));case'float':var digits=descriptor.digits?descriptor.digits:[69,2];digits=typeof digits==="string"?py.eval(digits):digits;var precision=digits[1];var formatted=_.str.sprintf('%.'+precision+'f',value).split('.');formatted[0]=instance.web.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);case'float_time':var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min==60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);case'many2one':return value[1]?value[1].split("\n")[0]:value[1];case'one2many':case'many2many':if(typeof value==='string'){return value;}
return _.str.sprintf(_t("(%d records)"),value.length);case'datetime':if(typeof(value)=="string")
value=instance.web.auto_str_to_date(value);return value.toString(normalize_format(l10n.date_format)
+' '+normalize_format(l10n.time_format));case'date':if(typeof(value)=="string")
value=instance.web.auto_str_to_date(value);return value.toString(normalize_format(l10n.date_format));case'time':if(typeof(value)=="string")
value=instance.web.auto_str_to_date(value);return value.toString(normalize_format(l10n.time_format));case'selection':case'statusbar':if(_.isArray(value)){return value[1];}
var result=_(descriptor.selection).detect(function(choice){return choice[0]===value;});if(result){return result[1];}
return;default:return value;}};instance.web.parse_value=function(value,descriptor,value_if_empty){var date_pattern=normalize_format(_t.database.parameters.date_format),time_pattern=normalize_format(_t.database.parameters.time_format);switch(value){case false:case"":return value_if_empty===undefined?false:value_if_empty;}
var tmp;switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'integer':do{tmp=value;value=value.replace(instance.web._t.database.parameters.thousands_sep,"");}while(tmp!==value);tmp=Number(value);if(isNaN(tmp)||tmp%1)
throw new Error(_.str.sprintf(_t("'%s' is not a correct integer"),value));return tmp;case'float':tmp=Number(value);if(!isNaN(tmp))
return tmp;var tmp2=value;do{tmp=tmp2;tmp2=tmp.replace(instance.web._t.database.parameters.thousands_sep,"");}while(tmp!==tmp2);var reformatted_value=tmp.replace(instance.web._t.database.parameters.decimal_point,".");var parsed=Number(reformatted_value);if(isNaN(parsed))
throw new Error(_.str.sprintf(_t("'%s' is not a correct float"),value));return parsed;case'float_time':var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!=2)
return factor*instance.web.parse_value(value,{type:"float"});var hours=instance.web.parse_value(float_time_pair[0],{type:"integer"});var minutes=instance.web.parse_value(float_time_pair[1],{type:"integer"});return factor*(hours+(minutes/60));case'progressbar':return instance.web.parse_value(value,{type:"float"});case'datetime':var datetime=Date.parseExact(value,(date_pattern+' '+time_pattern));if(datetime!==null)
return instance.web.datetime_to_str(datetime);datetime=Date.parseExact(value,(date_pattern));if(datetime!==null)
return instance.web.datetime_to_str(datetime);var leading_zero_value=value.toString().replace(/\d+/g,function(m){return m.length===1?"0"+m:m;});datetime=Date.parseExact(leading_zero_value,(date_pattern+' '+time_pattern));if(datetime!==null)
return instance.web.datetime_to_str(datetime);datetime=Date.parseExact(leading_zero_value,(date_pattern));if(datetime!==null)
return instance.web.datetime_to_str(datetime);datetime=Date.parse(value);if(datetime!==null)
return instance.web.datetime_to_str(datetime);throw new Error(_.str.sprintf(_t("'%s' is not a correct datetime"),value));case'date':var date=Date.parseExact(value,date_pattern);if(date!==null)
return instance.web.date_to_str(date);date=Date.parseExact(value.toString().replace(/\d+/g,function(m){return m.length===1?"0"+m:m;}),date_pattern);if(date!==null)
return instance.web.date_to_str(date);date=Date.parse(value);if(date!==null)
return instance.web.date_to_str(date);throw new Error(_.str.sprintf(_t("'%s' is not a correct date"),value));case'time':var time=Date.parseExact(value,time_pattern);if(time!==null)
return instance.web.time_to_str(time);time=Date.parse(value);if(time!==null)
return instance.web.time_to_str(time);throw new Error(_.str.sprintf(_t("'%s' is not a correct time"),value));}
return value;};instance.web.auto_str_to_date=function(value,type){try{return instance.web.str_to_datetime(value);}catch(e){}
try{return instance.web.str_to_date(value);}catch(e){}
try{return instance.web.str_to_time(value);}catch(e){}
throw new Error(_.str.sprintf(_t("'%s' is not a correct date, datetime nor time"),value));};instance.web.auto_date_to_str=function(value,type){switch(type){case'datetime':return instance.web.datetime_to_str(value);case'date':return instance.web.date_to_str(value);case'time':return instance.web.time_to_str(value);default:throw new Error(_.str.sprintf(_t("'%s' is not convertible to date, datetime nor time"),type));}};instance.web.round_precision=function(value,precision){if(!value){return 0;}else if(!precision||precision<0){precision=1;}
var normalized_value=value/precision;var epsilon_magnitude=Math.log(Math.abs(normalized_value))/Math.log(2);var epsilon=Math.pow(2,epsilon_magnitude-53);normalized_value+=normalized_value>=0?epsilon:-epsilon;var rounded_value=Math.round(normalized_value);return rounded_value*precision;};instance.web.round_decimals=function(value,decimals){return instance.web.round_precision(value,Math.pow(10,-decimals));};instance.web.float_is_zero=function(value,decimals){epsilon=Math.pow(10,-decimals);return Math.abs(instance.web.round_precision(value,epsilon))<epsilon;};})();;

/* /web/static/src/js/chrome.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.chrome={};var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.Notification=instance.web.Widget.extend({template:'Notification',init:function(){this._super.apply(this,arguments);instance.web.notification=this;},start:function(){this._super.apply(this,arguments);this.$el.notify({speed:500,expires:2500});},notify:function(title,text,sticky){sticky=!!sticky;var opts={};if(sticky){opts.expires=false;}
return this.$el.notify('create',{title:title,text:text},opts);},warn:function(title,text,sticky){sticky=!!sticky;var opts={};if(sticky){opts.expires=false;}
return this.$el.notify('create','oe_notification_alert',{title:title,text:text},opts);}});var opened_modal=[];instance.web.action_notify=function(element,action){element.do_notify(action.params.title,action.params.text,action.params.sticky);};instance.web.client_actions.add("action_notify","instance.web.action_notify");instance.web.action_warn=function(element,action){element.do_warn(action.params.title,action.params.text,action.params.sticky);};instance.web.client_actions.add("action_warn","instance.web.action_warn");instance.web.Dialog=instance.web.Widget.extend({dialog_title:"",init:function(parent,options,content){var self=this;this._super(parent);this.content_to_set=content;this.dialog_options={destroy_on_close:true,size:'large',buttons:null,};if(options){_.extend(this.dialog_options,options);}
this.on("closing",this,this._closing);this.$buttons=$('<div class="modal-footer"><span class="oe_dialog_custom_buttons"/></div>');},renderElement:function(){if(this.content_to_set){this.setElement(this.content_to_set);}else if(this.template){this._super();}},open:function(){if(!this.dialog_inited){this.init_dialog();}
this.$buttons.insertAfter(this.$dialog_box.find(".modal-body"));$('.tooltip').remove();opened_modal.push(this.$dialog_box);return this;},_add_buttons:function(buttons){var self=this;var $customButons=this.$buttons.find('.oe_dialog_custom_buttons').empty();_.each(buttons,function(fn,text){var oe_link_class=fn.oe_link_class;if(!_.isFunction(fn)){text=fn.text;fn=fn.click;}
var $but=$(QWeb.render('WidgetButton',{widget:{string:text,node:{attrs:{'class':oe_link_class}}}}));$customButons.append($but);$but.on('click',function(ev){fn.call(self.$el,ev);});});},init_dialog:function(){var self=this;var options=_.extend({},this.dialog_options);options.title=options.title||this.dialog_title;if(options.buttons){this._add_buttons(options.buttons);delete(options.buttons);}
this.renderElement();this.$dialog_box=$(QWeb.render('Dialog',options)).appendTo("body");this.$el.modal({'backdrop':false,'keyboard':true,});if(options.size!=='large'){var dialog_class_size=this.$dialog_box.find('.modal-lg').removeClass('modal-lg');if(options.size==='small'){dialog_class_size.addClass('modal-sm');}}
this.$el.appendTo(this.$dialog_box.find(".modal-body"));var $dialog_content=this.$dialog_box.find('.modal-content');if(options.dialogClass){$dialog_content.find(".modal-body").addClass(options.dialogClass);}
$dialog_content.openerpClass();this.$dialog_box.on('hidden.bs.modal',this,function(){self.close();});this.$dialog_box.modal('show');this.dialog_inited=true;var res=this.start();return res;},close:function(reason){if(this.dialog_inited&&!this.__tmp_dialog_hiding){$('.tooltip').remove();if(this.$el.is(":data(bs.modal)")){this.__tmp_dialog_hiding=true;this.$dialog_box.modal('hide');this.__tmp_dialog_hiding=undefined;}
this.trigger("closing",reason);}},_closing:function(){if(this.__tmp_dialog_destroying)
return;if(this.dialog_options.destroy_on_close){this.__tmp_dialog_closing=true;this.destroy();this.__tmp_dialog_closing=undefined;}},destroy:function(reason){this.$buttons.remove();var self=this;_.each(this.getChildren(),function(el){el.destroy();});if(!this.__tmp_dialog_closing){this.__tmp_dialog_destroying=true;this.close(reason);this.__tmp_dialog_destroying=undefined;}
if(this.dialog_inited&&!this.isDestroyed()&&this.$el.is(":data(bs.modal)")){var $element=this.$dialog_box;setTimeout(function(){var modal_list_index=$.inArray($element,opened_modal);if(modal_list_index>-1){opened_modal.splice(modal_list_index,1)[0].remove();}
if(opened_modal.length>0){opened_modal[opened_modal.length-1].focus();$('body').addClass('modal-open');}},0);}
this._super();}});instance.web.CrashManager=instance.web.Class.extend({init:function(){this.active=true;},rpc_error:function(error){if(!this.active){return;}
var handler=instance.web.crash_manager_registry.get_object(error.data.name,true);if(handler){new(handler)(this,error).display();return;}
if(error.data.name==="openerp.http.SessionExpiredException"||error.data.name==="werkzeug.exceptions.Forbidden"){this.show_warning({type:"Session Expired",data:{message:_t("Your Odoo session expired. Please refresh the current web page.")}});return;}
if(error.data.exception_type==="except_osv"||error.data.exception_type==="warning"||error.data.exception_type==="access_error"){this.show_warning(error);}else{this.show_error(error);}},show_warning:function(error){if(!this.active){return;}
if(error.data.exception_type==="except_osv"){error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0]+"\n\n"+error.data.arguments[1]})});}
new instance.web.Dialog(this,{size:'medium',title:"Odoo "+(_.str.capitalize(error.type)||"Warning"),buttons:[{text:_t("Ok"),click:function(){this.parents('.modal').modal('hide');}}],},$('<div>'+QWeb.render('CrashManager.warning',{error:error})+'</div>')).open();},show_error:function(error){if(!this.active){return;}
var buttons={};buttons[_t("Ok")]=function(){this.parents('.modal').modal('hide');};new instance.web.Dialog(this,{title:"Odoo "+_.str.capitalize(error.type),buttons:buttons},QWeb.render('CrashManager.error',{session:instance.session,error:error})).open();},show_message:function(exception){this.show_error({type:_t("Client Error"),message:exception,data:{debug:""}});},});instance.web.ExceptionHandler={init:function(parent,error){},display:function(){},};instance.web.crash_manager_registry=new instance.web.Registry();instance.web.RedirectWarningHandler=instance.web.Dialog.extend(instance.web.ExceptionHandler,{init:function(parent,error){this._super(parent);this.error=error;},display:function(){var self=this;error=this.error;error.data.message=error.data.arguments[0];new instance.web.Dialog(this,{size:'medium',title:"Odoo "+(_.str.capitalize(error.type)||"Warning"),buttons:[{text:_t("Ok"),click:function(){self.$el.parents('.modal').modal('hide');self.destroy();}},{text:error.data.arguments[2],oe_link_class:'oe_link',click:function(){window.location.href='#action='+error.data.arguments[1];self.destroy();}}],},QWeb.render('CrashManager.warning',{error:error})).open();}});instance.web.crash_manager_registry.add('openerp.exceptions.RedirectWarning','instance.web.RedirectWarningHandler');instance.web.Loading=instance.web.Widget.extend({template:_t("Loading"),init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;this.session.on("request",this,this.request_call);this.session.on("response",this,this.response_call);this.session.on("response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;instance.web.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(instance.session.debug){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;instance.web.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});instance.web.DatabaseManager=instance.web.Widget.extend({init:function(parent){this._super(parent);this.unblockUIFunction=instance.web.unblockUI;$.validator.addMethod('matches',function(s,_,re){return new RegExp(re).test(s);},_t("Invalid database name"));},start:function(){var self=this;$('.oe_secondary_menus_container,.oe_user_menu_placeholder').empty();var fetch_db=this.rpc("/web/database/get_list",{}).then(function(result){self.db_list=result;},function(_,ev){ev.preventDefault();self.db_list=null;});var fetch_langs=this.rpc("/web/session/get_lang_list",{}).done(function(result){self.lang_list=result;});return $.when(fetch_db,fetch_langs).always(self.do_render);},do_render:function(){var self=this;instance.webclient.toggle_bars(true);self.$el.html(QWeb.render("DatabaseManager",{widget:self}));$('.oe_user_menu_placeholder').append(QWeb.render("DatabaseManager.user_menu",{widget:self}));$('.oe_secondary_menus_container').append(QWeb.render("DatabaseManager.menu",{widget:self}));$('ul.oe_secondary_submenu > li:first').addClass('active');$('ul.oe_secondary_submenu > li').bind('click',function(event){var menuitem=$(this);menuitem.addClass('active').siblings().removeClass('active');var form_id=menuitem.find('a').attr('href');$(form_id).show().siblings().hide();event.preventDefault();});$('#back-to-login').click(self.do_exit);self.$el.find("td").addClass("oe_form_group_cell");self.$el.find("tr td:first-child").addClass("oe_form_group_cell_label");self.$el.find("label").addClass("oe_form_label");self.$el.find("form[name=create_db_form]").validate({submitHandler:self.do_create});self.$el.find("form[name=duplicate_db_form]").validate({submitHandler:self.do_duplicate});self.$el.find("form[name=drop_db_form]").validate({submitHandler:self.do_drop});self.$el.find("form[name=backup_db_form]").validate({submitHandler:self.do_backup});self.$el.find("form[name=restore_db_form]").validate({submitHandler:self.do_restore});self.$el.find("form[name=change_pwd_form]").validate({messages:{old_pwd:_t("Please enter your previous password"),new_pwd:_t("Please enter your new password"),confirm_pwd:{required:_t("Please confirm your new password"),equalTo:_t("The confirmation does not match the password")}},submitHandler:self.do_change_password});},destroy:function(){this.$el.find('#db-create, #db-drop, #db-backup, #db-restore, #db-change-password, #back-to-login').unbind('click').end().empty();this._super();},blockUI:function(){instance.web.blockUI();instance.web.unblockUI=function(){};},unblockUI:function(){instance.web.unblockUI=this.unblockUIFunction;instance.web.unblockUI();},display_error:function(error){return new instance.web.Dialog(this,{size:'medium',title:error.title,buttons:[{text:_t("Ok"),click:function(){this.parents('.modal').modal('hide');}}]},$('<div>').html(error.error)).open();},do_create:function(form){var self=this;var fields=$(form).serializeArray();self.rpc("/web/database/create",{'fields':fields}).done(function(result){if(result){instance.web.redirect('/web');}else{alert("Failed to create database");}});},do_duplicate:function(form){var self=this;var fields=$(form).serializeArray();self.rpc("/web/database/duplicate",{'fields':fields}).then(function(result){if(result.error){self.display_error(result);return;}
self.do_notify(_t("Duplicating database"),_t("The database has been duplicated."));self.start();});},do_drop:function(form){var self=this;var $form=$(form),fields=$form.serializeArray(),$db_list=$form.find('[name=drop_db]'),db=$db_list.val();if(!db||!confirm(_.str.sprintf(_t("Do you really want to delete the database: %s ?"),db))){return;}
self.rpc("/web/database/drop",{'fields':fields}).done(function(result){if(result.error){self.display_error(result);return;}
self.do_notify(_t("Dropping database"),_.str.sprintf(_t("The database %s has been dropped"),db));self.start();});},do_backup:function(form){var self=this;self.blockUI();self.session.get_file({form:form,success:function(){self.do_notify(_t("Backed"),_t("Database backed up successfully"));},error:function(error){if(error&&error[1]){self.display_error(error[1][0]);}},complete:function(){self.unblockUI();}});},do_restore:function(form){var self=this;self.blockUI();$(form).ajaxSubmit({url:'/web/database/restore',type:'POST',resetForm:true,success:function(body){if(!body){return;}
if(body.indexOf('403 Forbidden')!==-1){self.display_error({title:_t("Access Denied"),error:_t("Incorrect super-administrator password")});}else{self.display_error({title:_t("Restore Database"),error:_t("Could not restore the database")});}},complete:function(){self.unblockUI();self.do_notify(_t("Restored"),_t("Database restored successfully"));}});},do_change_password:function(form){var self=this;self.rpc("/web/database/change_password",{'fields':$(form).serializeArray()}).done(function(result){if(result.error){self.display_error(result);return;}
self.unblockUI();self.do_notify(_t("Changed Password"),_t("Password has been changed successfully"));});},do_exit:function(){this.$el.remove();instance.web.redirect('/web');}});instance.web.client_actions.add("database_manager","instance.web.DatabaseManager");instance.web.login=function(){instance.web.redirect('/web/login');};instance.web.client_actions.add("login","instance.web.login");instance.web.logout=function(){instance.web.redirect('/web/session/logout');};instance.web.client_actions.add("logout","instance.web.logout");instance.web.redirect=function(url,wait){if(instance.client&&instance.client.crashmanager){instance.client.crashmanager.active=false;}
var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){instance.session.rpc("/web/webclient/version_info",{}).done(load).fail(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}};instance.web.Reload=function(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;instance.web.redirect(url,params.wait);};instance.web.client_actions.add("reload","instance.web.Reload");instance.web.ReloadContext=function(parent,action){instance.session.rpc("/web/session/get_session_info",{}).then(function(){instance.web.Reload(parent,action);});}
instance.web.client_actions.add("reload_context","instance.web.ReloadContext");instance.web.HistoryBack=function(parent){if(!parent.history_back()){instance.web.Home(parent);}};instance.web.client_actions.add("history_back","instance.web.HistoryBack");instance.web.Home=function(parent,action){var url='/'+(window.location.search||'');instance.web.redirect(url,action&&action.params&&action.params.wait);};instance.web.client_actions.add("home","instance.web.Home");instance.web.ChangePassword=instance.web.Widget.extend({template:"ChangePassword",start:function(){var self=this;this.getParent().dialog_title=_t("Change Password");var $button=self.$el.find('.oe_form_button');$button.appendTo(this.getParent().$buttons);$button.eq(2).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self.rpc("/web/session/change_password",{'fields':$("form[name=change_password_form]").serializeArray()}).done(function(result){if(result.error){self.display_error(result);return;}else{instance.webclient.on_logout();}});});},display_error:function(error){return new instance.web.Dialog(this,{size:'medium',title:error.title,buttons:[{text:_t("Ok"),click:function(){this.parents('.modal').modal('hide');}}]},$('<div>').html(error.error)).open();},});instance.web.client_actions.add("change_password","instance.web.ChangePassword");instance.web.Menu=instance.web.Widget.extend({init:function(){var self=this;this._super.apply(this,arguments);this.is_bound=$.Deferred();this.maximum_visible_links='auto';this.data={data:{children:[]}};this.on("menu_bound",this,function(){var $all_menus=self.$el.parents('body').find('.oe_webclient').find('[data-menu]');var all_menu_ids=_.map($all_menus,function(menu){return parseInt($(menu).attr('data-menu'),10);});if(!_.isEmpty(all_menu_ids)){this.do_load_needaction(all_menu_ids);}});},start:function(){this._super.apply(this,arguments);return this.bind_menu();},do_reload:function(){var self=this;self.bind_menu();},bind_menu:function(){var self=this;this.$secondary_menus=this.$el.parents().find('.oe_secondary_menus_container')
this.$secondary_menus.on('click','a[data-menu]',this.on_menu_click);this.$el.on('click','a[data-menu]',this.on_top_menu_click);this.$secondary_menus.find('.oe_menu_toggler').siblings('.oe_secondary_submenu').hide();if(self.current_menu){self.open_menu(self.current_menu);}
this.trigger('menu_bound');var lazyreflow=_.debounce(this.reflow.bind(this),200);instance.web.bus.on('resize',this,function(){if(parseInt(self.$el.parent().css('width'))<=768){lazyreflow('all_outside');}else{lazyreflow();}});instance.web.bus.trigger('resize');this.is_bound.resolve();},do_load_needaction:function(menu_ids){var self=this;menu_ids=_.compact(menu_ids);if(_.isEmpty(menu_ids)){return $.when();}
return this.rpc("/web/menu/load_needaction",{'menu_ids':menu_ids}).done(function(r){self.on_needaction_loaded(r);});},on_needaction_loaded:function(data){var self=this;this.needaction_data=data;_.each(this.needaction_data,function(item,menu_id){var $item=self.$secondary_menus.find('a[data-menu="'+menu_id+'"]');$item.find('.badge').remove();if(item.needaction_counter&&item.needaction_counter>0){$item.append(QWeb.render("Menu.needaction_counter",{widget:item}));}});},reflow:function(behavior){var self=this;var $more_container=this.$('#menu_more_container').hide();var $more=this.$('#menu_more');var $systray=this.$el.parents().find('.oe_systray');$more.children('li').insertBefore($more_container);if(behavior==='all_outside'){this.$el.find('li').show();$more_container.hide();return;}
var $toplevel_items=this.$el.find('li').not($more_container).not($systray.find('li')).hide();$toplevel_items.each(function(){if(behavior==='all_inside'){return false;}
var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>remaining_space){return false;}
$(this).show();});$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length||behavior==='all_inside');var $toplevel=this.$el.children("li:visible");if($toplevel.length===1&&behavior!='all_inside'){$toplevel.hide();}},open_menu:function(id){this.current_menu=id;this.session.active_id=id;var $clicked_menu,$sub_menu,$main_menu;$clicked_menu=this.$el.add(this.$secondary_menus).find('a[data-menu='+id+']');this.trigger('open_menu',id,$clicked_menu);if(this.$secondary_menus.has($clicked_menu).length){$sub_menu=$clicked_menu.parents('.oe_secondary_menu');$main_menu=this.$el.find('a[data-menu='+$sub_menu.data('menu-parent')+']');}else{$sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+$clicked_menu.attr('data-menu')+']');$main_menu=$clicked_menu;}
this.$el.find('.active').removeClass('active');$main_menu.parent().addClass('active');this.$secondary_menus.find('.oe_secondary_menu').hide();$sub_menu.show();this.$secondary_menus.parent('.oe_leftbar').toggle(!!$sub_menu.children().length);this.$secondary_menus.find('.active').removeClass('active');if($main_menu!==$clicked_menu){$clicked_menu.parents().show();if($clicked_menu.is('.oe_menu_toggler')){$clicked_menu.toggleClass('oe_menu_opened').siblings('.oe_secondary_submenu:first').toggle();}else{$clicked_menu.parent().addClass('active');}}
this.$secondary_menus.find('.oe_secondary_submenu li a span').each(function(){$(this).tooltip(this.scrollWidth>this.clientWidth?{title:$(this).text().trim(),placement:'right'}:'destroy');});},open_action:function(id){var $menu=this.$el.add(this.$secondary_menus).find('a[data-action-id="'+id+'"]');var menu_id=$menu.data('menu');if(menu_id){this.open_menu(menu_id);}},menu_click:function(id,needaction){if(!id){return;}
var $item=this.$el.find('a[data-menu='+id+']');if(!$item.length){$item=this.$secondary_menus.find('a[data-menu='+id+']');}
var action_id=$item.data('action-id');if(!action_id){if(this.$el.has($item).length){var $sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+id+']');var $items=$sub_menu.find('a[data-action-id]').filter('[data-action-id!=""]');if($items.length){action_id=$items.data('action-id');id=$items.data('menu');}}}
if(action_id){this.trigger('menu_click',{action_id:action_id,needaction:needaction,id:id,previous_menu_id:this.current_menu},$item);}else{console.log('Menu no action found web test 04 will fail');}
this.open_menu(id);},do_reload_needaction:function(){var self=this;if(self.current_menu){self.do_load_needaction([self.current_menu]).then(function(){self.trigger("need_action_reloaded");});}},on_top_menu_click:function(ev){ev.preventDefault();var self=this;var id=$(ev.currentTarget).data('menu');var $secondary_menu=this.$el.parents().find('.oe_secondary_menu[data-menu-parent='+id+']');var $menu_leaves=$secondary_menu.children().find('.oe_menu_leaf');var menu_ids=_.map($menu_leaves,function(leave){return parseInt($(leave).attr('data-menu'),10);});self.do_load_needaction(menu_ids).then(function(){self.trigger("need_action_reloaded");});this.$el.parents().find(".oe_secondary_menus_container").scrollTop(0,0);this.on_menu_click(ev);},on_menu_click:function(ev){ev.preventDefault();var needaction=$(ev.target).is('div#menu_counter');this.menu_click($(ev.currentTarget).data('menu'),needaction);},});instance.web.UserMenu=instance.web.Widget.extend({template:"UserMenu",init:function(parent){this._super(parent);this.update_promise=$.Deferred().resolve();},start:function(){var self=this;this._super.apply(this,arguments);this.$el.on('click','.dropdown-menu li a[data-menu]',function(ev){ev.preventDefault();var f=self['on_menu_'+$(this).data('menu')];if(f){f($(this));}});this.$el.parent().show()},do_update:function(){var self=this;var fct=function(){var $avatar=self.$el.find('.oe_topbar_avatar');$avatar.attr('src',$avatar.data('default-src'));if(!self.session.uid)
return;var func=new instance.web.Model("res.users").get_func("read");return self.alive(func(self.session.uid,["name","company_id"])).then(function(res){var topbar_name=res.name;if(instance.session.debug)
topbar_name=_.str.sprintf("%s (%s)",topbar_name,instance.session.db);if(res.company_id[0]>1)
topbar_name=_.str.sprintf("%s (%s)",topbar_name,res.company_id[1]);self.$el.find('.oe_topbar_name').text(topbar_name);if(!instance.session.debug){topbar_name=_.str.sprintf("%s (%s)",topbar_name,instance.session.db);}
var avatar_src=self.session.url('/web/binary/image',{model:'res.users',field:'image_small',id:self.session.uid});$avatar.attr('src',avatar_src);openerp.web.bus.trigger('resize');});};this.update_promise=this.update_promise.then(fct,fct);},on_menu_help:function(){window.open('http://help.odoo.com','_blank');},on_menu_logout:function(){this.trigger('user_logout');},on_menu_settings:function(){var self=this;if(!this.getParent().has_uncommitted_changes()){self.rpc("/web/action/load",{action_id:"base.action_res_users_my"}).done(function(result){result.res_id=instance.session.uid;self.getParent().action_manager.do_action(result);});}},on_menu_account:function(){var self=this;if(!this.getParent().has_uncommitted_changes()){var P=new instance.web.Model('ir.config_parameter');P.call('get_param',['database.uuid']).then(function(dbuuid){var state={'d':instance.session.db,'u':window.location.protocol+'//'+window.location.host,};var params={response_type:'token',client_id:dbuuid||'',state:JSON.stringify(state),scope:'userinfo',};instance.web.redirect('https://accounts.odoo.com/oauth2/auth?'+$.param(params));}).fail(function(result,ev){ev.preventDefault();instance.web.redirect('https://accounts.odoo.com/web');});}},on_menu_about:function(){var self=this;self.rpc("/web/webclient/version_info",{}).done(function(res){var $help=$(QWeb.render("UserMenu.about",{version_info:res}));$help.find('a.oe_activate_debug_mode').click(function(e){e.preventDefault();window.location=$.param.querystring(window.location.href,'debug');});new instance.web.Dialog(this,{size:'medium',dialogClass:'oe_act_window',title:_t("About"),},$help).open();});},});instance.web.FullscreenWidget=instance.web.Widget.extend({start:function(){if(!$('#oe-fullscreenwidget-viewport').length){$('head').append('<meta id="oe-fullscreenwidget-viewport" name="viewport" content="initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">');}
instance.webclient.set_content_full_screen(true);return this._super();},destroy:function(){instance.webclient.set_content_full_screen(false);$('#oe-fullscreenwidget-viewport').remove();return this._super();},});instance.web.Client=instance.web.Widget.extend({init:function(parent,origin){instance.client=instance.webclient=this;this.client_options={};this._super(parent);this.origin=origin;},start:function(){var self=this;return instance.session.session_bind(this.origin).then(function(){self.bind_events();return self.show_common();});},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.size()>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});instance.web.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){self.$el.find('.oe_dropdown_menu.oe_opened, .oe_dropdown_toggle.oe_opened').removeClass('oe_opened');}});},show_common:function(){var self=this;this.crashmanager=new instance.web.CrashManager();instance.session.on('error',this.crashmanager,this.crashmanager.rpc_error);self.notification=new instance.web.Notification(this);self.notification.appendTo(self.$el.find('.openerp'));self.loading=new instance.web.Loading(self);self.loading.appendTo(self.$('.openerp_webclient_container'));self.action_manager=new instance.web.ActionManager(self);self.action_manager.appendTo(self.$('.oe_application'));},toggle_bars:function(value){this.$('tr:has(td.navbar),.oe_leftbar').toggle(value);},has_uncommitted_changes:function(){return false;},});instance.web.WebClient=instance.web.Client.extend({init:function(parent,client_options){this._super(parent);if(client_options){_.extend(this.client_options,client_options);}
this._current_state=null;this.menu_dm=new instance.web.DropMisordered();this.action_mutex=new $.Mutex();this.set('title_part',{"zopenerp":"Odoo"});},start:function(){var self=this;this.on("change:title_part",this,this._title_changed);this._title_changed();return $.when(this._super()).then(function(){if(jQuery.deparam!==undefined&&jQuery.deparam(jQuery.param.querystring()).kitten!==undefined){self.to_kitten();}
if(self.session.session_is_valid()){self.show_application();}
if(self.client_options.action){self.action_manager.do_action(self.client_options.action);delete(self.client_options.action);}});},to_kitten:function(){this.kitten=true;$("body").addClass("kitten-mode-activated");$("body").css("background-image","url("+instance.session.origin+"/web/static/src/img/back-enable.jpg"+")");if($.blockUI){var imgkit=Math.floor(Math.random()*2+1);$.blockUI.defaults.message='<img src="/web/static/src/img/k-waiting'+imgkit+'.gif" class="loading-kitten">';}},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},show_common:function(){var self=this;this._super();window.onerror=function(message,file,line){self.crashmanager.show_error({type:_t("Client Error"),message:message,data:{debug:file+':'+line}});};},show_application:function(){var self=this;self.toggle_bars(true);self.update_logo();this.$('.oe_logo_edit_admin').click(function(ev){self.logo_edit(ev);});self.menu=new instance.web.Menu(self);self.menu.setElement(this.$el.parents().find('.oe_application_menu_placeholder'));self.menu.start();self.menu.on('menu_click',this,this.on_menu_action);self.user_menu=new instance.web.UserMenu(self);self.user_menu.appendTo(this.$el.parents().find('.oe_user_menu_placeholder'));self.user_menu.on('user_logout',self,self.on_logout);self.user_menu.do_update();self.bind_hashchange();self.set_title();self.check_timezone();if(self.client_options.action_post_login){self.action_manager.do_action(self.client_options.action_post_login);delete(self.client_options.action_post_login);}},update_logo:function(){var company=this.session.company_id;var img=this.session.url('/web/binary/company_logo'+'?db='+this.session.db+(company?'&company='+company:''));this.$('.oe_logo img').attr('src','').attr('src',img);this.$('.oe_logo_edit').toggleClass('oe_logo_edit_admin',this.session.uid===1);},logo_edit:function(ev){var self=this;ev.preventDefault();self.alive(new instance.web.Model("res.users").get_func("read")(this.session.uid,["company_id"])).then(function(res){self.rpc("/web/action/load",{action_id:"base.action_res_company_form"}).done(function(result){result.res_id=res['company_id'][0];result.target="new";result.views=[[false,'form']];result.flags={action_buttons:true,};self.action_manager.do_action(result);var form=self.action_manager.dialog_widget.views.form.controller;form.on("on_button_cancel",self.action_manager,self.action_manager.dialog_stop);form.on('record_saved',self,function(){self.action_manager.dialog_stop();self.update_logo();});});});return false;},check_timezone:function(){var self=this;return self.alive(new instance.web.Model('res.users').call('read',[[this.session.uid],['tz_offset']])).then(function(result){var user_offset=result[0]['tz_offset'];var offset=-(new Date().getTimezoneOffset());var browser_offset=(offset<0)?"-":"+";browser_offset+=_.str.sprintf("%02d",Math.abs(offset/60));browser_offset+=_.str.sprintf("%02d",Math.abs(offset%60));if(browser_offset!==user_offset){var $icon=$(QWeb.render('WebClient.timezone_systray'));$icon.on('click',function(){var notification=self.do_warn(_t("Timezone Mismatch"),QWeb.render('WebClient.timezone_notification',{user_timezone:instance.session.user_context.tz||'UTC',user_offset:user_offset,browser_offset:browser_offset,}),true);notification.element.find('.oe_webclient_timezone_notification').on('click',function(){notification.close();}).find('a').on('click',function(){notification.close();self.user_menu.on_menu_settings();return false;});});$icon.prependTo(window.$('.oe_systray'));}});},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},do_reload:function(){var self=this;return this.session.session_reload().then(function(){instance.session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_notify:function(){var n=this.notification;return n.notify.apply(n,arguments);},do_warn:function(){var n=this.notification;return n.warn.apply(n,arguments);},on_logout:function(){var self=this;if(!this.has_uncommitted_changes()){self.action_manager.do_action('logout');}},bind_hashchange:function(){var self=this;$(window).bind('hashchange',this.on_hashchange);var state=$.bbq.getState(true);if(_.isEmpty(state)||state.action=="login"){self.menu.is_bound.done(function(){new instance.web.Model("res.users").call("read",[self.session.uid,["action_id"]]).done(function(data){if(data.action_id){self.action_manager.do_action(data.action_id[0]);self.menu.open_action(data.action_id[0]);}else{var first_menu_id=self.menu.$el.find("a:first").data("menu");if(first_menu_id){self.menu.menu_click(first_menu_id);}}});});}else{$(window).trigger('hashchange');}},on_hashchange:function(event){var self=this;var stringstate=event.getState(false);if(!_.isEqual(this._current_state,stringstate)){var state=event.getState(true);if(!state.action&&state.menu_id){self.menu.is_bound.done(function(){self.menu.menu_click(state.menu_id);});}else{state._push_me=false;this.action_manager.do_load_state(state,!!this._current_state);}}
this._current_state=stringstate;},do_push_state:function(state){this.set_title(state.title);delete state.title;var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},on_menu_action:function(options){var self=this;return this.menu_dm.add(this.rpc("/web/action/load",{action_id:options.action_id})).then(function(result){return self.action_mutex.exec(function(){if(options.needaction){result.context=new instance.web.CompoundContext(result.context,{search_default_message_unread:true,search_disable_custom_filters:true,});}
var completed=$.Deferred();$.when(self.action_manager.do_action(result,{clear_breadcrumbs:true,action_menu_id:self.menu.current_menu,})).fail(function(){self.menu.open_menu(options.previous_menu_id);}).always(function(){completed.resolve();});setTimeout(function(){completed.resolve();},2000);return completed;});});},set_content_full_screen:function(fullscreen){$(document.body).css('overflow-y',fullscreen?'hidden':'scroll');this.$('.oe_webclient').toggleClass('oe_content_full_screen',fullscreen);},has_uncommitted_changes:function(){var $e=$.Event('clear_uncommitted_changes');instance.web.bus.trigger('clear_uncommitted_changes',$e);if($e.isDefaultPrevented()){return true;}else{return this._super.apply(this,arguments);}},});instance.web.EmbeddedClient=instance.web.Client.extend({_template:'EmbedClient',init:function(parent,origin,dbname,login,key,action_id,options){this._super(parent,origin);this.bind_credentials(dbname,login,key);this.action_id=action_id;this.options=options||{};},start:function(){var self=this;return $.when(this._super()).then(function(){return self.authenticate().then(function(){if(!self.action_id){return;}
return self.rpc("/web/action/load",{action_id:self.action_id}).done(function(result){var action=result;action.flags=_.extend({search_view:false,action_buttons:false,sidebar:false},self.options,action.flags||{});self.do_action(action);});});});},do_action:function(){var am=this.action_manager;return am.do_action.apply(am,arguments);},authenticate:function(){var s=instance.session;if(s.session_is_valid()&&s.db===this.dbname&&s.login===this.login){return $.when();}
return instance.session.session_authenticate(this.dbname,this.login,this.key);},bind_credentials:function(dbname,login,key){this.dbname=dbname;this.login=login;this.key=key;},});instance.web.embed=function(origin,dbname,login,key,action,options){$('head').append($('<link>',{'rel':'stylesheet','type':'text/css','href':origin+'/web/css/web.assets_webclient'}));var currentScript=document.currentScript;if(!currentScript){var sc=document.getElementsByTagName('script');currentScript=sc[sc.length-1];}
var client=new instance.web.EmbeddedClient(null,origin,dbname,login,key,action,options);client.insertAfter(currentScript);};})();;

/* /web/static/src/js/views.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.views={};var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.ActionManager=instance.web.Widget.extend({init:function(parent){this._super(parent);this.inner_action=null;this.inner_widget=null;this.dialog=null;this.dialog_widget=null;this.breadcrumbs=[];this.on('history_back',this,function(){return this.history_back();});},start:function(){this._super.apply(this,arguments);this.$el.on('click','a.oe_breadcrumb_item',this.on_breadcrumb_clicked);},dialog_stop:function(reason){if(this.dialog){this.dialog.destroy(reason);}
this.dialog=null;},push_breadcrumb:function(item){var last=this.breadcrumbs.slice(-1)[0];if(last){last.hide();}
item=_.extend({show:function(index){this.widget.$el.show();},hide:function(){this.widget.$el.hide();},destroy:function(){this.widget.destroy();},get_title:function(){return this.title||this.widget.get('title');}},item);item.id=_.uniqueId('breadcrumb_');this.breadcrumbs.push(item);},history_back:function(){var last=this.breadcrumbs.slice(-1)[0];if(!last){return false;}
var title=last.get_title();if(_.isArray(title)&&title.length>1){return this.select_breadcrumb(this.breadcrumbs.length-1,title.length-2);}else if(this.breadcrumbs.length===1){return false;}else{var prev=this.breadcrumbs[this.breadcrumbs.length-2];title=prev.get_title();return this.select_breadcrumb(this.breadcrumbs.length-2,_.isArray(title)?title.length-1:undefined);}},on_breadcrumb_clicked:function(ev){var $e=$(ev.target);var id=$e.data('id');var index;for(var i=this.breadcrumbs.length-1;i>=0;i--){if(this.breadcrumbs[i].id==id){index=i;break;}}
var subindex=$e.parent().find('a.oe_breadcrumb_item[data-id='+$e.data('id')+']').index($e);this.select_breadcrumb(index,subindex);},select_breadcrumb:function(index,subindex){var next_item=this.breadcrumbs[index+1];if(next_item&&next_item.on_reverse_breadcrumb){next_item.on_reverse_breadcrumb(this.breadcrumbs[index].widget);}
for(var i=this.breadcrumbs.length-1;i>=0;i--){if(i>index){if(this.remove_breadcrumb(i)===false){return false;}}}
var item=this.breadcrumbs[index];item.show(subindex);this.inner_widget=item.widget;this.inner_action=item.action;return true;},clear_breadcrumbs:function(){for(var i=this.breadcrumbs.length-1;i>=0;i--){if(this.remove_breadcrumb(0)===false){break;}}},remove_breadcrumb:function(index){var item=this.breadcrumbs.splice(index,1)[0];if(item){var dups=_.filter(this.breadcrumbs,function(it){return item.widget===it.widget;});if(!dups.length){if(this.getParent().has_uncommitted_changes()){this.inner_widget=item.widget;this.inner_action=item.action;this.breadcrumbs.splice(index,0,item);return false;}else{item.destroy();}}}
var last_widget=this.breadcrumbs.slice(-1)[0];if(last_widget){this.inner_widget=last_widget.widget;this.inner_action=last_widget.action;}},add_breadcrumb_url:function(url,label){this.push_breadcrumb({show:function(){instance.web.redirect(url);},hide:function(){},destroy:function(){},get_title:function(){return label;}});},get_title:function(){var titles=[];for(var i=0;i<this.breadcrumbs.length;i+=1){var item=this.breadcrumbs[i];var tit=item.get_title();if(item.hide_breadcrumb){continue;}
if(!_.isArray(tit)){tit=[tit];}
for(var j=0;j<tit.length;j+=1){var label=_.escape(tit[j]);if(i===this.breadcrumbs.length-1&&j===tit.length-1){titles.push(_.str.sprintf('<span class="oe_breadcrumb_item">%s</span>',label));}else{titles.push(_.str.sprintf('<a href="#" class="oe_breadcrumb_item" data-id="%s">%s</a>',item.id,label));}}}
return titles.join(' <span class="oe_fade">/</span> ');},do_push_state:function(state){state=state||{};if(this.getParent()&&this.getParent().do_push_state){if(this.inner_action){if(this.inner_action._push_me===false){return;}
state['title']=this.inner_action.name;if(this.inner_action.type=='ir.actions.act_window'){state['model']=this.inner_action.res_model;}
if(this.inner_action.menu_id){state['menu_id']=this.inner_action.menu_id;}
if(this.inner_action.id){state['action']=this.inner_action.id;}else if(this.inner_action.type=='ir.actions.client'){state['action']=this.inner_action.tag;var params={};_.each(this.inner_action.params,function(v,k){if(_.isString(v)||_.isNumber(v)){params[k]=v;}});state=_.extend(params||{},state);}
if(this.inner_action.context){var active_id=this.inner_action.context.active_id;if(active_id){state["active_id"]=active_id;}
var active_ids=this.inner_action.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state["active_ids"]=this.inner_action.context.active_ids.join(',');}}}
if(!this.dialog){this.getParent().do_push_state(state);}}},do_load_state:function(state,warm){var self=this,action_loaded;if(!warm&&'return_label'in state){var return_url=state.return_url||document.referrer;if(return_url){this.add_breadcrumb_url(return_url,state.return_label);}}
if(state.action){if(_.isString(state.action)&&instance.web.client_actions.contains(state.action)){var action_client={type:"ir.actions.client",tag:state.action,params:state,_push_me:state._push_me,};if(warm){this.null_action();}
action_loaded=this.do_action(action_client);}else{var run_action=(!this.inner_widget||!this.inner_widget.action)||this.inner_widget.action.id!==state.action;if(run_action){var add_context={};if(state.active_id){add_context.active_id=state.active_id;}
if(state.active_ids){add_context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){add_context.active_ids=[state.active_id];}
add_context.params=state;if(warm){this.null_action();}
action_loaded=this.do_action(state.action,{additional_context:add_context});$.when(action_loaded||null).done(function(){instance.webclient.menu.is_bound.done(function(){if(self.inner_action&&self.inner_action.id){instance.webclient.menu.open_action(self.inner_action.id);}});});}}}else if(state.model&&state.id){if(warm){this.null_action();}
var action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[false,'form']]};action_loaded=this.do_action(action);}else if(state.sa){if(warm){this.null_action();}
action_loaded=this.rpc('/web/session/get_session_action',{key:state.sa}).then(function(action){if(action){return self.do_action(action);}});}
$.when(action_loaded||null).done(function(){if(self.inner_widget&&self.inner_widget.do_load_state){self.inner_widget.do_load_state(state,warm);}});},do_action:function(action,options){options=_.defaults(options||{},{clear_breadcrumbs:false,on_reverse_breadcrumb:function(){},hide_breadcrumb:false,on_close:function(){},action_menu_id:null,additional_context:{},});if(action===false){action={type:'ir.actions.act_window_close'};}else if(_.isString(action)&&instance.web.client_actions.contains(action)){var action_client={type:"ir.actions.client",tag:action,params:{}};return this.do_action(action_client,options);}else if(_.isNumber(action)||_.isString(action)){var self=this;var additional_context={active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model};return self.rpc("/web/action/load",{action_id:action,additional_context:additional_context}).then(function(result){return self.do_action(result,options);});}
var ncontext=new instance.web.CompoundContext(options.additional_context,action.context||{});action.context=instance.web.pyeval.eval('context',ncontext);if(action.context.active_id||action.context.active_ids){action.context.search_disable_custom_filters=true;}
if(action.domain){action.domain=instance.web.pyeval.eval('domain',action.domain,action.context||{});}
if(!action.type){console.error("No type for action",action);return $.Deferred().reject();}
var type=action.type.replace(/\./g,'_');var popup=action.target==='new';var inline=action.target==='inline'||action.target==='inlineview';var form=_.str.startsWith(action.view_mode,'form');action.flags=_.defaults(action.flags||{},{views_switcher:!popup&&!inline,search_view:!popup&&!inline,action_buttons:!popup&&!inline,sidebar:!popup&&!inline,pager:(!popup||!form)&&!inline,display_title:!popup,search_disable_custom_filters:action.context&&action.context.search_disable_custom_filters});action.menu_id=options.action_menu_id;if(!(type in this)){console.error("Action manager can't handle action of type "+action.type,action);return $.Deferred().reject();}
return this[type](action,options);},null_action:function(){this.dialog_stop();this.clear_breadcrumbs();},ir_actions_common:function(executor,options){if(this.inner_widget&&executor.action.target!=='new'){if(this.getParent().has_uncommitted_changes()){return $.Deferred().reject();}else if(options.clear_breadcrumbs){this.clear_breadcrumbs();}}
var widget=executor.widget();if(executor.action.target==='new'){var pre_dialog=(this.dialog&&!this.dialog.isDestroyed())?this.dialog:null;if(pre_dialog){pre_dialog.off('closing',null,pre_dialog.on_close);}
if(this.dialog_widget&&!this.dialog_widget.isDestroyed()){this.dialog_widget.destroy();}
this.dialog_stop(executor.action);this.dialog=new instance.web.Dialog(this,{title:executor.action.name,dialogClass:executor.klass,});this.dialog.on_close=function(){options.on_close.apply(null,arguments);if(pre_dialog&&pre_dialog.on_close){pre_dialog.on_close();}};this.dialog.on("closing",null,this.dialog.on_close);if(widget instanceof instance.web.ViewManager){_.extend(widget.flags,{$buttons:this.dialog.$buttons,footer_to_buttons:true,});}
this.dialog_widget=widget;this.dialog_widget.setParent(this.dialog);var initialized=this.dialog_widget.appendTo(this.dialog.$el);this.dialog.open();return initialized;}else{this.dialog_stop(executor.action);this.inner_action=executor.action;this.inner_widget=widget;executor.post_process(widget);return this.inner_widget.appendTo(this.$el);}},ir_actions_act_window:function(action,options){var self=this;return this.ir_actions_common({widget:function(){return new instance.web.ViewManagerAction(self,action);},action:action,klass:'oe_act_window',post_process:function(widget){widget.add_breadcrumb({on_reverse_breadcrumb:options.on_reverse_breadcrumb,hide_breadcrumb:options.hide_breadcrumb,});},},options);},ir_actions_client:function(action,options){var self=this;var ClientWidget=instance.web.client_actions.get_object(action.tag);if(!ClientWidget){return self.do_warn("Action Error","Could not find client action '"+action.tag+"'.");}
if(!(ClientWidget.prototype instanceof instance.web.Widget)){var next;if((next=ClientWidget(this,action))){return this.do_action(next,options);}
return $.when();}
return this.ir_actions_common({widget:function(){return new ClientWidget(self,action);},action:action,klass:'oe_act_client',post_process:function(widget){self.push_breadcrumb({widget:widget,title:action.name,on_reverse_breadcrumb:options.on_reverse_breadcrumb,hide_breadcrumb:options.hide_breadcrumb,});if(action.tag!=='reload'){self.do_push_state({});}}},options);},ir_actions_act_window_close:function(action,options){if(!this.dialog){options.on_close();}
this.dialog_stop();return $.when();},ir_actions_server:function(action,options){var self=this;this.rpc('/web/action/run',{action_id:action.id,context:action.context||{}}).done(function(action){self.do_action(action,options);});},ir_actions_report_xml:function(action,options){var self=this;instance.web.blockUI();action=_.clone(action);var eval_contexts=([instance.session.user_context]||[]).concat([action.context]);action.context=instance.web.pyeval.eval('contexts',eval_contexts);if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){var params={action:JSON.stringify(action),token:new Date().getTime()};var url=self.session.url('/web/report',params);instance.web.unblockUI();$('<a href="'+url+'" target="_blank"></a>')[0].click();return;}
var c=instance.webclient.crashmanager;return $.Deferred(function(d){self.session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:instance.web.unblockUI,success:function(){if(!self.dialog){options.on_close();}
self.dialog_stop();d.resolve();},error:function(){c.rpc_error.apply(c,arguments);d.reject();}});});},ir_actions_act_url:function(action){if(action.target==='self'){instance.web.redirect(action.url);}else{window.open(action.url,'_blank');}
return $.when();},});instance.web.ViewManager=instance.web.Widget.extend({template:"ViewManager",init:function(parent,dataset,views,flags){this._super(parent);this.url_states={};this.model=dataset?dataset.model:undefined;this.dataset=dataset;this.searchview=null;this.active_view=null;this.views_src=_.map(views,function(x){if(x instanceof Array){var view_type=x[1];var View=instance.web.views.get_object(view_type,true);var view_label=View?View.prototype.display_name:(void'nope');return{view_id:x[0],view_type:view_type,label:view_label,button_label:View?_.str.sprintf(_t('%(view_type)s view'),{'view_type':(view_label||view_type)}):(void'nope'),};}else{return x;}});this.ActionManager=parent;this.views={};this.flags=flags||{};this.registry=instance.web.views;this.views_history=[];this.view_completely_inited=$.Deferred();},start:function(){this._super();var self=this;this.$el.find('.oe_view_manager_switch a').click(function(){self.switch_mode($(this).data('view-type'));}).tooltip();var views_ids={};_.each(this.views_src,function(view){self.views[view.view_type]=$.extend({},view,{deferred:$.Deferred(),controller:null,options:_.extend({$buttons:self.$el.find('.oe_view_manager_buttons'),$sidebar:self.flags.sidebar?self.$el.find('.oe_view_manager_sidebar'):undefined,$pager:self.$el.find('.oe_view_manager_pager'),action:self.action,action_views_ids:views_ids},self.flags,self.flags[view.view_type]||{},view.options||{})});views_ids[view.view_type]=view.view_id;});if(this.flags.views_switcher===false){this.$el.find('.oe_view_manager_switch').hide();}
var default_view=this.flags.default_view||this.views_src[0].view_type;return this.switch_mode(default_view,null,this.flags[default_view]&&this.flags[default_view].options);},switch_mode:function(view_type,no_store,view_options){var self=this;var view=this.views[view_type];var view_promise;var form=this.views['form'];if(!view||(form&&form.controller&&!form.controller.can_be_discarded())){return $.Deferred().reject();}
if(!no_store){this.views_history.push(view_type);}
this.active_view=view_type;if(!view.controller){view_promise=this.do_create_view(view_type);}else if(this.searchview&&self.flags.auto_search&&view.controller.searchable!==false){this.searchview.ready.done(this.searchview.do_search);}
if(this.searchview){this.searchview[(view.controller.searchable===false||this.searchview.options.hidden)?'hide':'show']();}
this.$el.find('.oe_view_manager_switch a').parent().removeClass('active');this.$el.find('.oe_view_manager_switch a').filter('[data-view-type="'+view_type+'"]').parent().addClass('active');this.$el.attr("data-view-type",view_type);return $.when(view_promise).done(function(){_.each(_.keys(self.views),function(view_name){var controller=self.views[view_name].controller;var container=self.$el.find("> div > div > .oe_view_manager_body > .oe_view_manager_view_"+view_name);if(view_name===view_type){container.show();if(controller)controller.do_show(view_options||{});}else{container.hide();if(controller)controller.do_hide();}});self.trigger('switch_mode',view_type,no_store,view_options);});},do_create_view:function(view_type){var self=this;var view=this.views[view_type];var viewclass=this.registry.get_object(view_type);var options=_.clone(view.options);if(view_type==="form"&&this.action&&(this.action.target=='new'||this.action.target=='inline')){options.initial_mode='edit';}
var controller=new viewclass(this,this.dataset,view.view_id,options);controller.on('history_back',this,function(){var am=self.getParent();if(am&&am.trigger){return am.trigger('history_back');}});controller.on("change:title",this,function(){if(self.active_view===view_type){self.set_title(controller.get('title'));}});if(view.embedded_view){controller.set_embedded_view(view.embedded_view);}
controller.on('switch_mode',self,this.switch_mode);controller.on('previous_view',self,this.prev_view);var container=this.$el.find("> div > div > .oe_view_manager_body > .oe_view_manager_view_"+view_type);var view_promise=controller.appendTo(container);this.views[view_type].controller=controller;return $.when(view_promise).done(function(){self.views[view_type].deferred.resolve(view_type);if(self.searchview&&self.flags.auto_search&&view.controller.searchable!==false){self.searchview.ready.done(self.searchview.do_search);}else{self.view_completely_inited.resolve();}
self.trigger("controller_inited",view_type,controller);});},get_view_id:function(view_type){return this.views[view_type]&&this.views[view_type].view_id||false;},set_title:function(title){this.$el.find('.oe_view_title_text:first').text(title);},add_breadcrumb:function(options){options=options||{};var self=this;var views=[this.active_view||this.views_src[0].view_type];this.on('switch_mode',self,function(mode){var last=views.slice(-1)[0];if(mode!==last){if(mode!=='form'){views.length=0;}
views.push(mode);}});var item=_.extend({widget:this,action:this.action,show:function(index){var view_to_select=views[index];var state=self.url_states[view_to_select];self.do_push_state(state||{});$.when(self.switch_mode(view_to_select)).done(function(){self.$el.show();});},get_title:function(){var id;var currentIndex;_.each(self.getParent().breadcrumbs,function(bc,i){if(bc.widget===self){currentIndex=i;}});var next=self.getParent().breadcrumbs.slice(currentIndex+1)[0];var titles=_.map(views,function(v){var controller=self.views[v].controller;if(v==='form'){id=controller.datarecord.id;}
return controller.get('title');});if(next&&next.action&&next.action.res_id&&self.dataset&&self.active_view==='form'&&self.dataset.model===next.action.res_model&&id===next.action.res_id){titles.pop();}
return titles;}},options);this.getParent().push_breadcrumb(item);},prev_view:function(options){options=options||{};var current_view=this.views_history.pop();var previous_view=this.views_history[this.views_history.length-1]||options['default'];if(options.created&&current_view==='form'&&previous_view==='list'){return this.switch_mode('form');}else if(options.created&&!previous_view&&this.action&&this.action.flags.default_view==='form'){return this.switch_mode('form');}
return this.switch_mode(previous_view,true);},setup_search_view:function(view_id,search_defaults){var self=this;if(this.searchview){this.searchview.destroy();}
var options={hidden:this.flags.search_view===false,disable_custom_filters:this.flags.search_disable_custom_filters,};this.searchview=new instance.web.SearchView(this,this.dataset,view_id,search_defaults,options);this.searchview.on('search_data',self,this.do_searchview_search);return this.searchview.appendTo(this.$(".oe_view_manager_view_search"),this.$(".oe_searchview_drawer_container"));},do_searchview_search:function(domains,contexts,groupbys){var self=this,controller=this.views[this.active_view].controller,action_context=this.action.context||{};instance.web.pyeval.eval_domains_and_contexts({domains:[this.action.domain||[]].concat(domains||[]),contexts:[action_context].concat(contexts||[]),group_by_seq:groupbys||[]}).done(function(results){if(results.error){throw new Error(_.str.sprintf(_t("Failed to evaluate search criterions")+": \n%s",JSON.stringify(results.error)));}
self.dataset._model=new instance.web.Model(self.dataset.model,results.context,results.domain);var groupby=results.group_by.length?results.group_by:action_context.group_by;if(_.isString(groupby)){groupby=[groupby];}
if(!controller.grouped&&!_.isEmpty(groupby)){self.dataset.set_sort([]);}
$.when(controller.do_search(results.domain,results.context,groupby||[])).then(function(){self.view_completely_inited.resolve();});});},on_action:function(action){},on_create:function(){},on_remove:function(){},on_edit:function(){},on_action_executed:function(){},});instance.web.ViewManagerAction=instance.web.ViewManager.extend({template:"ViewManagerAction",init:function(parent,action){var flags=action.flags||{};if(!('auto_search'in flags)){flags.auto_search=action.auto_search!==false;}
if(action.res_model=='board.board'&&action.view_mode==='form'){_.extend(flags,{views_switcher:false,display_title:false,search_view:false,pager:false,sidebar:false,action_buttons:false});}
this._super(parent,null,action.views,flags);this.session=parent.session;this.action=action;var context=action.context;if(action.target==='current'){var active_context={active_model:action.res_model,};context=new instance.web.CompoundContext(context,active_context).eval();delete context['active_id'];delete context['active_ids'];if(action.res_id){context['active_id']=action.res_id;context['active_ids']=[action.res_id];}}
var dataset=new instance.web.DataSetSearch(this,action.res_model,context,action.domain);if(action.res_id){dataset.ids.push(action.res_id);dataset.index=0;}
this.dataset=dataset;},start:function(){var self=this,searchview_loaded,search_defaults={};_.each(this.action.context,function(value,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value;}});var searchview_id=this.action['search_view_id']&&this.action['search_view_id'][0];searchview_loaded=this.setup_search_view(searchview_id||false,search_defaults);var main_view_loaded=this._super();var manager_ready=$.when(searchview_loaded,main_view_loaded,this.view_completely_inited);this.$el.find('.oe_debug_view').change(this.on_debug_changed);this.$el.addClass("oe_view_manager_"+(this.action.target||'current'));return manager_ready;},on_debug_changed:function(evt){var self=this,$sel=$(evt.currentTarget),$option=$sel.find('option:selected'),val=$sel.val(),current_view=this.views[this.active_view].controller;switch(val){case'fvg':var dialog=new instance.web.Dialog(this,{title:_t("Fields View Get")}).open();$('<pre>').text(instance.web.json_node_to_xml(current_view.fields_view.arch,true)).appendTo(dialog.$el);break;case'tests':this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});break;case'get_metadata':var ids=current_view.get_selected_ids();if(ids.length===1){this.dataset.call('get_metadata',[ids]).done(function(result){var dialog=new instance.web.Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),self.dataset.model),size:'medium',},QWeb.render('ViewManagerDebugViewLog',{perm:result[0],format:instance.web.format_value})).open();});}
break;case'toggle_layout_outline':current_view.rendering_engine.toggle_layout_debugging();break;case'set_defaults':current_view.open_defaults_dialog();break;case'translate':this.do_action({name:_t("Technical Translation"),res_model:'ir.translation',domain:[['type','!=','object'],'|',['name','=',this.dataset.model],['name','ilike',this.dataset.model+',']],views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_type:"list",view_mode:"list"});break;case'fields':this.dataset.call('fields_get',[false,{}]).done(function(fields){var $root=$('<dl>');_(fields).each(function(attributes,name){$root.append($('<dt>').append($('<h4>').text(name)));var $attrs=$('<dl>').appendTo($('<dd>').appendTo($root));_(attributes).each(function(def,name){if(def instanceof Object){def=JSON.stringify(def);}
$attrs.append($('<dt>').text(name)).append($('<dd style="white-space: pre-wrap;">').text(def));});});new instance.web.Dialog(self,{title:_.str.sprintf(_t("Model %s fields"),self.dataset.model),},$root).open();});break;case'edit_workflow':return this.do_action({res_model:'workflow',domain:[['osv','=',this.dataset.model]],views:[[false,'list'],[false,'form'],[false,'diagram']],type:'ir.actions.act_window',view_type:'list',view_mode:'list'});case'edit':this.do_edit_resource($option.data('model'),$option.data('id'),{name:$option.text()});break;case'manage_filters':this.do_action({res_model:'ir.filters',views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this.dataset.model}});break;case'print_workflow':if(current_view.get_selected_ids&&current_view.get_selected_ids().length==1){instance.web.blockUI();var action={context:{active_ids:current_view.get_selected_ids()},report_name:"workflow.instance.graph",datas:{model:this.dataset.model,id:current_view.get_selected_ids()[0],nested:true,}};this.session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:instance.web.unblockUI});}
break;default:if(val){console.log("No debug handler for ",val);}}
evt.currentTarget.selectedIndex=0;},do_edit_resource:function(model,id,action){action=_.extend({res_model:model,res_id:id,type:'ir.actions.act_window',view_type:'form',view_mode:'form',views:[[false,'form']],target:'new',flags:{action_buttons:true,form:{resize_textareas:true}}},action||{});this.do_action(action);},switch_mode:function(view_type,no_store,options){var self=this;return this.alive($.when(this._super.apply(this,arguments))).done(function(){var controller=self.views[self.active_view].controller;self.$el.find('.oe_debug_view').html(QWeb.render('ViewManagerDebug',{view:controller,view_manager:self}));self.set_title();});},do_create_view:function(view_type){var self=this;return this._super.apply(this,arguments).then(function(){var view=self.views[view_type].controller;view.set({'title':self.action.name});});},get_action_manager:function(){var cur=this;while((cur=cur.getParent())){if(cur instanceof instance.web.ActionManager){return cur;}}
return undefined;},set_title:function(title){this.$el.find('.oe_breadcrumb_title:first').html(this.get_action_manager().get_title());},do_push_state:function(state){if(this.getParent()&&this.getParent().do_push_state){state["view_type"]=this.active_view;this.url_states[this.active_view]=state;this.getParent().do_push_state(state);}},do_load_state:function(state,warm){var self=this,defs=[];if(state.view_type&&state.view_type!==this.active_view){defs.push(this.views[this.active_view].deferred.then(function(){return self.switch_mode(state.view_type,true);}));}
$.when(this.views[this.active_view]?this.views[this.active_view].deferred:$.when(),defs).done(function(){self.views[self.active_view].controller.do_load_state(state,warm);});},});instance.web.Sidebar=instance.web.Widget.extend({init:function(parent){var self=this;this._super(parent);var view=this.getParent();this.sections=[{'name':'print','label':_t('Print'),},{'name':'other','label':_t('More'),}];this.items={'print':[],'other':[]};this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.do_attachement_update(self.dataset,self.model_id,args);instance.web.unblockUI();});},start:function(){var self=this;this._super(this);this.redraw();this.$el.on('click','.oe_dropdown_menu li a',function(event){var section=$(this).data('section');var index=$(this).data('index');var item=self.items[section][index];if(item.callback){item.callback.apply(self,[item]);}else if(item.action){self.on_item_action_clicked(item);}else if(item.url){return true;}
event.preventDefault();});},redraw:function(){var self=this;self.$el.html(QWeb.render('Sidebar',{widget:self}));this.$('.oe_form_dropdown_section').each(function(){$(this).toggle(!!$(this).find('li').length);});self.$("[title]").tooltip({delay:{show:500,hide:0}});},add_items:function(section_code,items){var self=this;if(items){this.items[section_code].push.apply(this.items[section_code],items);this.redraw();}},add_toolbar:function(toolbar){var self=this;_.each(['print','action','relate'],function(type){var items=toolbar[type];if(items){for(var i=0;i<items.length;i++){items[i]={label:items[i]['name'],action:items[i],classname:'oe_sidebar_'+type};}
self.add_items(type=='print'?'print':'other',items);}});},on_item_action_clicked:function(item){var self=this;self.getParent().sidebar_eval_context().done(function(sidebar_eval_context){var ids=self.getParent().get_selected_ids();var domain;if(self.getParent().get_active_domain){domain=self.getParent().get_active_domain();}
else{domain=$.Deferred().resolve(undefined);}
if(ids.length===0){new instance.web.Dialog(this,{title:_t("Warning"),size:'medium',},$("<div />").text(_t("You must choose at least one record."))).open();return false;}
var dataset=self.getParent().dataset;var active_ids_context={active_id:ids[0],active_ids:ids,active_model:dataset.model,};$.when(domain).done(function(domain){if(domain!==undefined){active_ids_context.active_domain=domain;}
var c=instance.web.pyeval.eval('context',new instance.web.CompoundContext(sidebar_eval_context,active_ids_context));self.rpc("/web/action/load",{action_id:item.action.id,context:new instance.web.CompoundContext(dataset.get_context(),active_ids_context).eval()}).done(function(result){result.context=new instance.web.CompoundContext(result.context||{},active_ids_context).set_eval_context(c);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){self.getParent().reload();},});});});});},do_attachement_update:function(dataset,model_id,args){var self=this;this.dataset=dataset;this.model_id=model_id;if(args&&args[0].error){this.do_warn(_t('Uploading Error'),args[0].error);}
if(!model_id){this.on_attachments_loaded([]);}else{var dom=[['res_model','=',dataset.model],['res_id','=',model_id],['type','in',['binary','url']]];var ds=new instance.web.DataSetSearch(this,'ir.attachment',dataset.get_context(),dom);ds.read_slice(['name','url','type','create_uid','create_date','write_uid','write_date'],{}).done(this.on_attachments_loaded);}},on_attachments_loaded:function(attachments){var self=this;var items=[];var prefix=this.session.url('/web/binary/saveas',{model:'ir.attachment',field:'datas',filename_field:'name'});_.each(attachments,function(a){a.label=a.name;if(a.type==="binary"){a.url=prefix+'&id='+a.id+'&t='+(new Date().getTime());}});self.items['files']=attachments;self.redraw();this.$('.oe_sidebar_add_attachment .oe_form_binary_file').change(this.on_attachment_changed);this.$el.find('.oe_sidebar_delete_item').click(this.on_attachment_delete);},on_attachment_changed:function(e){var $e=$(e.target);if($e.val()!==''){this.$el.find('form.oe_form_binary_form').submit();$e.parent().find('input[type=file]').prop('disabled',true);$e.parent().find('button').prop('disabled',true).find('img, span').toggle();this.$('.oe_sidebar_add_attachment span').text(_t('Uploading...'));instance.web.blockUI();}},on_attachment_delete:function(e){e.preventDefault();e.stopPropagation();var self=this;var $e=$(e.currentTarget);if(confirm(_t("Do you really want to delete this attachment ?"))){(new instance.web.DataSet(this,'ir.attachment')).unlink([parseInt($e.attr('data-id'),10)]).done(function(){self.do_attachement_update(self.dataset,self.model_id);});}}});instance.web.View=instance.web.Widget.extend({display_name:'',view_type:undefined,init:function(parent,dataset,view_id,options){this._super(parent);this.ViewManager=parent;this.dataset=dataset;this.view_id=view_id;this.set_default_options(options);},start:function(){return this.load_view();},load_view:function(context){var self=this;var view_loaded_def;if(this.embedded_view){view_loaded_def=$.Deferred();$.async_when().done(function(){view_loaded_def.resolve(self.embedded_view);});}else{if(!this.view_type)
console.warn("view_type is not defined",this);view_loaded_def=instance.web.fields_view_get({"model":this.dataset._model,"view_id":this.view_id,"view_type":this.view_type,"toolbar":!!this.options.$sidebar,"context":this.dataset.get_context(),});}
return this.alive(view_loaded_def).then(function(r){self.fields_view=r;self.$el.addClass('oe_view').toggleClass('oe_cannot_create',!self.is_action_enabled('create')).toggleClass('oe_cannot_edit',!self.is_action_enabled('edit')).toggleClass('oe_cannot_delete',!self.is_action_enabled('delete'));return $.when(self.view_loading(r)).then(function(){self.trigger('view_loaded',r);});});},view_loading:function(r){},set_default_options:function(options){this.options=options||{};_.defaults(this.options,{$sidebar:null,sidebar_id:null,action:null,action_views_ids:{}});},do_execute_action:function(action_data,dataset,record_id,on_closed){var self=this;var result_handler=function(){if(on_closed){on_closed.apply(null,arguments);}
if(self.getParent()&&self.getParent().on_action_executed){return self.getParent().on_action_executed.apply(null,arguments);}};var context=new instance.web.CompoundContext(dataset.get_context(),action_data.context||{});var handler=function(action){if(action&&action.constructor==Object){var ncontext=new instance.web.CompoundContext(_.object(_.reject(_.pairs(dataset.get_context().eval()),function(pair){return pair[0].match('^(?:(?:default_|search_default_).+|.+_view_ref|group_by|group_by_no_leaf|active_id|active_ids)$')!==null;})));ncontext.add(action_data.context||{});ncontext.add({active_model:dataset.model});if(record_id){ncontext.add({active_id:record_id,active_ids:[record_id],});}
ncontext.add(action.context||{});action.context=ncontext;return self.do_action(action,{on_close:result_handler,});}else{self.do_action({"type":"ir.actions.act_window_close"});return result_handler();}};if(action_data.special==='cancel'){return handler({"type":"ir.actions.act_window_close"});}else if(action_data.type=="object"){var args=[[record_id]];if(action_data.args){try{var additional_args=JSON.parse(action_data.args.replace(/'/g,'"'));args=args.concat(additional_args);}catch(e){console.error("Could not JSON.parse arguments",action_data.args);}}
args.push(context);return dataset.call_button(action_data.name,args).then(handler).then(function(){if(instance.webclient){instance.webclient.menu.do_reload_needaction();}});}else if(action_data.type=="action"){return this.rpc('/web/action/load',{action_id:action_data.name,context:_.extend(instance.web.pyeval.eval('context',context),{'active_model':dataset.model,'active_ids':dataset.ids,'active_id':record_id}),do_not_eval:true}).then(handler);}else{return dataset.exec_workflow(record_id,action_data.name).then(handler);}},set_embedded_view:function(embedded_view){this.embedded_view=embedded_view;},do_show:function(){this.$el.show();},do_hide:function(){this.$el.hide();},is_active:function(){var manager=this.getParent();return!manager||!manager.active_view||manager.views[manager.active_view].controller===this;},guard_active:function(fn){var self=this;return function(){if(self.is_active()){fn.apply(self,arguments);}};},do_push_state:function(state){if(this.getParent()&&this.getParent().do_push_state){this.getParent().do_push_state(state);}},do_load_state:function(state,warm){},do_switch_view:function(){this.trigger.apply(this,['switch_mode'].concat(_.toArray(arguments)));},do_search:function(domain,context,group_by){},on_sidebar_export:function(){new instance.web.DataExport(this,this.dataset).open();},sidebar_eval_context:function(){return $.when({});},reload:function(){return $.when();},is_action_enabled:function(action){var attrs=this.fields_view.arch.attrs;return(action in attrs)?JSON.parse(attrs[action]):true;},});instance.web.fields_view_get=function(args){function postprocess(fvg){var doc=$.parseXML(fvg.arch).documentElement;fvg.arch=instance.web.xml_to_json(doc,(doc.nodeName.toLowerCase()!=='kanban'));if('id'in fvg.fields){var id_field=fvg.fields['id'];id_field.original_type=id_field.type;id_field.type='id';}
_.each(fvg.fields,function(field){_.each(field.views||{},function(view){postprocess(view);});});return fvg;}
args=_.defaults(args,{toolbar:false,});var model=args.model;if(typeof model==='string'){model=new instance.web.Model(args.model,args.context);}
return args.model.call('fields_view_get',{view_id:args.view_id,view_type:args.view_type,context:args.context,toolbar:args.toolbar}).then(function(fvg){return postprocess(fvg);});};instance.web.xml_to_json=function(node,strip_whitespace){switch(node.nodeType){case 9:return instance.web.xml_to_json(node.documentElement,strip_whitespace);case 3:case 4:return(strip_whitespace&&node.data.trim()==='')?undefined:node.data;case 1:var attrs=$(node).getAttributes();_.each(['domain','filter_domain','context','default_get'],function(key){if(attrs[key]){try{attrs[key]=JSON.parse(attrs[key]);}catch(e){}}});return{tag:node.tagName.toLowerCase(),attrs:attrs,children:_.compact(_.map(node.childNodes,function(node){return instance.web.xml_to_json(node,strip_whitespace);})),};}};instance.web.json_node_to_xml=function(node,human_readable,indent){indent=indent||0;var sindent=(human_readable?(new Array(indent+1).join('\t')):''),r=sindent+'<'+node.tag,cr=human_readable?'\n':'';if(typeof(node)==='string'){return sindent+node;}else if(typeof(node.tag)!=='string'||!node.children instanceof Array||!node.attrs instanceof Object){throw new Error(_.str.sprintf(_t("Node [%s] is not a JSONified XML node"),JSON.stringify(node)));}
for(var attr in node.attrs){var vattr=node.attrs[attr];if(typeof(vattr)!=='string'){vattr=JSON.stringify(vattr);}
vattr=vattr.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');if(human_readable){vattr=vattr.replace(/&quot;/g,"'");}
r+=' '+attr+'="'+vattr+'"';}
if(node.children&&node.children.length){r+='>'+cr;var childs=[];for(var i=0,ii=node.children.length;i<ii;i++){childs.push(instance.web.json_node_to_xml(node.children[i],human_readable,indent+1));}
r+=childs.join(cr);r+=cr+sindent+'</'+node.tag+'>';return r;}else{return r+'/>';}};instance.web.xml_to_str=function(node){var str="";if(window.XMLSerializer){str=(new XMLSerializer()).serializeToString(node);}else if(window.ActiveXObject){str=node.xml;}else{throw new Error(_t("Could not serialize XML"));}
var void_elements='area base br col command embed hr img input keygen link meta param source track wbr'.split(' ');str=str.replace(/<([a-z]+)([^<>]*)\s*\/\s*>/g,function(match,tag,attrs){if(void_elements.indexOf(tag)<0){return"<"+tag+attrs+"></"+tag+">";}else{return match;}});return str;};instance.web.views=new instance.web.Registry();})();;

/* /web/static/src/js/data.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.data={};instance.web.serialize_sort=function(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');};instance.web.deserialize_sort=function(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});};instance.web.Query=instance.web.Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new instance.web.Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=new instance.web.CompoundDomain(q._filter,to_set.filter);break;case'context':q._context=new instance.web.CompoundContext(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return instance.session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:instance.web.pyeval.eval('domains',[this._model.domain(this._filter)]),context:instance.web.pyeval.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:instance.web.serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return $.when(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=instance.web.pyeval.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx['group_by_no_leaf']){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:instance.web.serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new instance.web.QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});instance.web.QueryGroup=instance.web.Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};_(fixed_group).each(function(value,key){if(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key)){return;}
aggregates[key]=value||0;});this.model=new instance.web.Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context['group_by_no_leaf']),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});instance.web.Model.include({init:function(){var session,model_name,context,domain;var args=_.toArray(arguments);args.reverse();session=args.pop();if(session&&!(session instanceof openerp.web.Session)){model_name=session;session=null;}else{model_name=args.pop();}
context=args.length>0?args.pop():null;domain=args.length>0?args.pop():null;this._super(session,model_name,context,domain);this._context=context||{};this._domain=domain||[];},session:function(){if(!this._session)
return instance.session;return this._super();},get_func:function(method_name){var self=this;return function(){return self.call(method_name,_.toArray(arguments));};},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
instance.web.pyeval.ensure_evaluated(args,kwargs);return this._super(method,args,kwargs,options);},query:function(fields){return new instance.web.Query(this,fields);},exec_workflow:function(id,signal){return this.session().rpc('/web/dataset/exec_workflow',{model:this.name,id:id,signal:signal});},domain:function(domain){if(!domain){return this._domain;}
return new instance.web.CompoundDomain(this._domain,domain);},context:function(context){return new instance.web.CompoundContext(instance.session.user_context,this._context,context||{});},call_button:function(method,args){instance.web.pyeval.ensure_evaluated(args,{});return this.session().rpc('/web/dataset/call_button',{model:this.name,method:method,domain_id:null,context_id:args.length-1,args:args||[]});},});instance.web.DataSet=instance.web.Class.extend(instance.web.PropertiesMixin,{init:function(parent,model,context){instance.web.PropertiesMixin.init.call(this);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new instance.web.Model(model,context);},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids))
return $.Deferred().resolve([]);options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new instance.web.CompoundContext(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};return this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all().done(function(records){self.ids=_(records).pluck('id');});},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return $.Deferred().reject().promise();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;return this._model.call('create',[data],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',data,options);});},write:function(id,data,options){options=options||{};var self=this;return this._model.call('write',[[id],data],{context:this.get_context(options.context)}).done(function(){self.trigger('dataset_changed',id,data,options);});},unlink:function(ids){var self=this;return this._model.call('unlink',[ids],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',ids);});},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name){return this._model.call('name_create',[name],{context:this.get_context()});},exec_workflow:function(id,signal){return this._model.exec_workflow(id,signal);},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return instance.web.serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=instance.web.deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return instance.session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:instance.web.pyeval.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});instance.web.DataSetStatic=instance.web.DataSet.extend({init:function(parent,model,context,ids){var self=this;this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return $.Deferred().resolve({result:true});},});instance.web.DataSetSearch=instance.web.DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new instance.web.Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);return q.all().done(function(records){q.count().done(function(count){self._length=count;});self.ids=_(records).pluck('id');});},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},unlink:function(ids,callback,error_callback){var self=this;return this._super(ids).done(function(result){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});},size:function(){if(this._length!==null){return this._length;}
return this._super();}});instance.web.BufferedDataSet=instance.web.DataSetStatic.extend({virtual_id_prefix:"one2many_v_id_",debug_mode:true,init:function(){this._super.apply(this,arguments);this.reset_ids([]);this.last_default_get={};this.running_reads=[];},default_get:function(fields,options){var self=this;return this._super(fields,options).done(function(res){self.last_default_get=res;});},create:function(data,options){var cached={id:_.uniqueId(this.virtual_id_prefix),values:_.extend({},data,(options||{}).readonly_fields||{}),defaults:this.last_default_get};this.to_create.push(_.extend(_.clone(cached),{values:_.clone(data)}));this.cache.push(cached);return $.Deferred().resolve(cached.id).promise();},write:function(id,data,options){var self=this;var record=_.detect(this.to_create,function(x){return x.id===id;});record=record||_.detect(this.to_write,function(x){return x.id===id;});var dirty=false;if(record){for(var k in data){if(record.values[k]===undefined||record.values[k]!==data[k]){dirty=true;break;}}
$.extend(record.values,data);}else{dirty=true;record={id:id,values:data};self.to_write.push(record);}
var cached=_.detect(this.cache,function(x){return x.id===id;});if(!cached){cached={id:id,values:{}};this.cache.push(cached);}
$.extend(cached.values,_.extend({},record.values,(options||{}).readonly_fields||{}));if(dirty)
this.trigger("dataset_changed",id,data,options);return $.Deferred().resolve(true).promise();},unlink:function(ids,callback,error_callback){var self=this;_.each(ids,function(id){if(!_.detect(self.to_create,function(x){return x.id===id;})){self.to_delete.push({id:id});}});this.to_create=_.reject(this.to_create,function(x){return _.include(ids,x.id);});this.to_write=_.reject(this.to_write,function(x){return _.include(ids,x.id);});this.cache=_.reject(this.cache,function(x){return _.include(ids,x.id);});this.set_ids(_.without.apply(_,[this.ids].concat(ids)));this.trigger("dataset_changed",ids,callback,error_callback);return $.async_when({result:true}).done(callback);},reset_ids:function(ids){this.set_ids(ids);this.to_delete=[];this.to_create=[];this.to_write=[];this.cache=[];this.delete_all=false;_.each(_.clone(this.running_reads),function(el){el.reject();});},read_ids:function(ids,fields,options){var self=this;var to_get=[];_.each(ids,function(id){var cached=_.detect(self.cache,function(x){return x.id===id;});var created=_.detect(self.to_create,function(x){return x.id===id;});if(created){_.each(fields,function(x){if(cached.values[x]===undefined)
cached.values[x]=created.defaults[x]||false;});}else{if(!cached||!_.all(fields,function(x){return cached.values[x]!==undefined;}))
to_get.push(id);}});var return_records=function(){var records=_.map(ids,function(id){var c=_.find(self.cache,function(c){return c.id===id;});return _.isUndefined(c)?c:_.extend({},c.values,{"id":id});});if(self.debug_mode){if(_.include(records,undefined)){throw"Record not correctly loaded";}}
var sort_fields=self._sort,compare=function(v1,v2){return(v1<v2)?-1:(v1>v2)?1:0;};if(sort_fields.length){records.sort(function(a,b){return _.reduce(sort_fields,function(acc,field){if(acc){return acc;}
var sign=1;if(field[0]==='-'){sign=-1;field=field.slice(1);}
if(!a[field]&&a[field]!==0){return sign}
if(!b[field]&&b[field]!==0){return(sign==-1)?1:-1}
if(_.isArray(a[field])&&a[field].length==2&&_.isString(a[field][1])){return sign*compare(a[field][1],b[field][1]);}
return sign*compare(a[field],b[field]);},0);});}
return $.when(records);};if(to_get.length>0){var def=$.Deferred();self.running_reads.push(def);def.always(function(){self.running_reads=_.without(self.running_reads,def);});this._super(to_get,fields,options).then(function(){def.resolve.apply(def,arguments);},function(){def.reject.apply(def,arguments);});return def.then(function(records){_.each(records,function(record,index){var id=to_get[index];var cached=_.detect(self.cache,function(x){return x.id===id;});if(!cached){self.cache.push({id:id,values:record});}else{cached.values=_.defaults(_.clone(cached.values),record);}});return return_records();});}else{return return_records();}},evict_record:function(id){if(_(this.to_create.concat(this.to_write)).find(function(record){return record.id===id;})){return;}
for(var i=0,len=this.cache.length;i<len;++i){var record=this.cache[i];if(record.id===id){this.cache.splice(i,1);break;}}},call_button:function(method,args){this.evict_record(args[0][0]);return this._super(method,args);},exec_workflow:function(id,signal){this.evict_record(id);return this._super(id,signal);},alter_ids:function(n_ids){this._super(n_ids);this.trigger("dataset_changed",n_ids);},});instance.web.BufferedDataSet.virtual_id_regex=/^one2many_v_id_.*$/;instance.web.ProxyDataSet=instance.web.DataSetSearch.extend({init:function(){this._super.apply(this,arguments);this.create_function=null;this.write_function=null;this.read_function=null;this.default_get_function=null;this.unlink_function=null;},read_ids:function(ids,fields,options){if(this.read_function){return this.read_function(ids,fields,options,this._super);}else{return this._super.apply(this,arguments);}},default_get:function(fields,options){if(this.default_get_function){return this.default_get_function(fields,options,this._super);}else{return this._super.apply(this,arguments);}},create:function(data,options){if(this.create_function){return this.create_function(data,options,this._super);}else{return this._super.apply(this,arguments);}},write:function(id,data,options){if(this.write_function){return this.write_function(id,data,options,this._super);}else{return this._super.apply(this,arguments);}},unlink:function(ids){if(this.unlink_function){return this.unlink_function(ids,this._super);}else{return this._super.apply(this,arguments);}},});instance.web.CompoundContext=instance.web.Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return instance.web.pyeval.eval('context',this,undefined,{no_user_context:true});},});instance.web.CompoundDomain=instance.web.Class.extend({init:function(){this.__ref="compound_domain";this.__domains=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(domain){this.__domains.push(domain);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return instance.web.pyeval.eval('domain',this);},});instance.web.DropMisordered=instance.web.Class.extend({init:function(failMisordered){this.lsn=0;this.rsn=-1;this.failMisordered=failMisordered||false;},add:function(deferred){var res=$.Deferred();var self=this,seq=this.lsn++;deferred.done(function(){if(seq>self.rsn){self.rsn=seq;res.resolve.apply(res,arguments);}else if(self.failMisordered){res.reject();}}).fail(function(){res.reject.apply(res,arguments);});return res.promise();}});instance.web.SimpleIndexedDB=instance.web.Class.extend({init:function(opts){var self=this;var opts=opts||{};this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;this.db=undefined;this._ready=new $.Deferred();if(this.indexedDB&&this.indexedDB.open){var request=this.indexedDB.open(opts.name||"SimpleIndexedDB",1);request.onerror=function(event){self.db=null;self._ready.reject(event.target.error);};request.onsuccess=function(event){self.db=request.result;self._ready.resolve();};request.onupgradeneeded=function(event){self.db=event.target.result;var objectStore=self.db.createObjectStore("keyvals",{keyPath:"key"});self._ready.resolve();};}else{this.db=null;this._ready.reject({type:'UnknownError',message:'IndexedDB is not supported by your Browser'});}},isSupportedByBrowser:function(){return this.indexedDB&&this.indexedDB.open;},ready:function(done,failed){this._ready.then(done,failed);return this._ready.promise();},getItem:function(key,done,failed){var self=this;var def=new $.Deferred();def.then(done,failed);this._ready.then(function(){var request=self.db.transaction(["keyvals"],"readwrite").objectStore("keyvals").get(key);request.onsuccess=function(){def.resolve(request.result?request.result.value:undefined);};request.onerror=function(event){def.reject(event.target.error);};},function(){def.reject({type:'UnknownError',message:'Could not initialize the IndexedDB database'});});return def.promise();},setItem:function(key,value,done,failed){var self=this;var def=new $.Deferred();def.then(done,failed);this._ready.then(function(){var request=self.db.transaction(["keyvals"],"readwrite").objectStore("keyvals").put({key:key,value:value});request.onsuccess=function(){def.resolve();};request.onerror=function(event){def.reject(event.target.error);};},function(){def.reject({type:'UnknownError',message:'Could not initialize the IndexedDB database'});});return def.promise();},removeItem:function(key,done,failed){var self=this;var def=new $.Deferred();def.then(done,failed);this._ready.then(function(){var request=self.db.transaction(["keyvals"],"readwrite").objectStore("keyvals").delete(key);request.onsuccess=function(){def.resolve();};request.onerror=function(event){def.reject(event.target.error);};},function(){def.reject({type:'UnknownError',message:'Could not initialize the IndexedDB database'});});return def.promise();},});})();;

/* /web/static/src/js/data_export.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.data_export={};var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.DataExport=instance.web.Dialog.extend({template:'ExportTreeView',dialog_title:{toString:function(){return _t("Export Data");}},events:{'click #add_field':function(){var self=this;this.$('#field-tree-structure tr.ui-selected').removeClass('ui-selected').find('a').each(function(){var id=$(this).attr('id').split('-')[1];var string=$(this).attr('string');self.add_field(id,string);});},'click #remove_field':function(){this.$('#fields_list option:selected').remove();},'click #remove_all_field':function(){this.$('#fields_list').empty();},'click #export_new_list':'on_show_save_list',},init:function(parent,dataset){var self=this;var options={buttons:[{text:_t("Close"),click:function(){self.$el.parents('.modal').modal('hide');}},{text:_t("Export To File"),click:function(){self.on_click_export_data();}}],close:function(){self.close();}};this._super(parent,options);this.records={};this.dataset=dataset;this.exports=new instance.web.DataSetSearch(this,'ir.exports',this.dataset.get_context());},start:function(){var self=this;this._super.apply(this,arguments);var got_fields=new $.Deferred();this.$el.find('#import_compat').change(function(){self.$el.find('#fields_list').empty();self.$el.find('#field-tree-structure').remove();var import_comp=self.$el.find("#import_compat").val();self.rpc("/web/export/get_fields",{model:self.dataset.model,import_compat:!!import_comp,}).done(function(records){got_fields.resolve();self.on_show_data(records);});}).change();var got_domain=this.getParent().get_active_domain().then(function(domain){if(domain===undefined){self.ids_to_export=self.getParent().get_selected_ids();self.domain=self.dataset.domain;}
else{self.ids_to_export=false;self.domain=domain;}
self.on_show_domain();});return $.when(got_fields,got_domain,this.rpc('/web/export/formats',{}).done(this.do_setup_export_formats),this.show_exports_list());},do_setup_export_formats:function(formats){var $fmts=this.$el.find('#export_format');_(formats).each(function(format){var opt=new Option(format.label,format.tag);if(format.error){opt.disabled=true;opt.replaceChild(document.createTextNode(_.str.sprintf("%s — %s",format.label,format.error)),opt.childNodes[0]);}
$fmts.append(opt);});},show_exports_list:function(){var self=this;if(self.$el.find('#saved_export_list').is(':hidden')){self.$el.find('#ExistsExportList').show();return $.when();}
return this.exports.read_slice(['name'],{domain:[['resource','=',this.dataset.model]]}).done(function(export_list){if(!export_list.length){return;}
self.$el.find('#ExistsExportList').append(QWeb.render('Exists.ExportList',{'existing_exports':export_list}));self.$el.find('#saved_export_list').change(function(){self.$el.find('#fields_list option').remove();var export_id=self.$el.find('#saved_export_list option:selected').val();if(export_id){self.rpc('/web/export/namelist',{'model':self.dataset.model,export_id:parseInt(export_id,10)}).done(self.do_load_export_field);}});self.$el.find('#delete_export_list').click(function(){var select_exp=self.$el.find('#saved_export_list option:selected');if(select_exp.val()){self.exports.unlink([parseInt(select_exp.val(),10)]);select_exp.remove();self.$el.find("#fields_list option").remove();if(self.$el.find('#saved_export_list option').length<=1){self.$el.find('#ExistsExportList').hide();}}});});},do_load_export_field:function(field_list){var export_node=this.$el.find("#fields_list");_(field_list).each(function(field){export_node.append(new Option(field.label,field.name));});},on_show_save_list:function(){var self=this;var current_node=self.$el.find("#savenewlist");if(!(current_node.find("label")).length){current_node.append(QWeb.render('ExportNewList'));current_node.find("#add_export_list").click(function(){var value=current_node.find("#savelist_name").val();if(value){self.do_save_export_list(value);}else{alert(_t("Please enter save field list name"));}});}else{if(current_node.is(':hidden')){current_node.show();current_node.find("#savelist_name").val("");}else{current_node.hide();}}},do_save_export_list:function(value){var self=this;var fields=self.get_fields();if(!fields.length){return;}
this.exports.create({name:value,resource:this.dataset.model,export_fields:_(fields).map(function(field){return[0,0,{name:field}];})}).then(function(export_list_id){if(!export_list_id){return;}
if(!self.$el.find("#saved_export_list").length||self.$el.find("#saved_export_list").is(":hidden")){self.show_exports_list();}
self.$el.find("#saved_export_list").append(new Option(value,export_list_id));});this.on_show_save_list();},on_click:function(id,record){var self=this;if(!record['children']){return;}
var model=record['params']['model'],prefix=record['params']['prefix'],name=record['params']['name'],exclude_fields=[];if(record['relation_field']){exclude_fields.push(record['relation_field']);}
if(!record.loaded){var import_comp=self.$el.find("#import_compat").val();self.rpc("/web/export/get_fields",{model:model,prefix:prefix,parent_name:name,import_compat:Boolean(import_comp),parent_field_type:record['field_type'],exclude:exclude_fields}).done(function(results){record.loaded=true;self.on_show_data(results,record.id);});}else{self.showcontent(record.id);}},on_show_domain:function(){this.$el.find('tr').first().find('td').append(QWeb.render('ExportTreeView-Domain',{'record':this}));},on_show_data:function(result,after){var self=this;if(after){var current_tr=self.$el.find("tr[id='treerow-"+after+"']");current_tr.addClass('open');current_tr.find('img').attr('src','/web/static/src/img/collapse.gif');current_tr.after(QWeb.render('ExportTreeView-Secondary.children',{'fields':result}));}else{self.$el.find('#left_field_panel').append(QWeb.render('ExportTreeView-Secondary',{'fields':result}));}
_.each(result,function(record){self.records[record.id]=record.value;if(record.required){var required_fld=self.$el.find("tr[id='treerow-"+record.id+"']").find('#tree-column');required_fld.addClass("oe_export_requiredfield");}
self.$el.find("img[id='parentimg-"+record.id+"']").click(function(){self.on_click(this.id,record);});self.$el.find("tr[id='treerow-"+record.id+"']").click(function(e){if(e.shiftKey){var frst_click,scnd_click='';if(self.row_index===0){self.row_index=this.rowIndex;frst_click=self.$el.find("tr[id^='treerow-']")[self.row_index-1];$(frst_click).addClass("ui-selected");}else{var i;if(this.rowIndex>=self.row_index){for(i=(self.row_index-1);i<this.rowIndex;i++){scnd_click=self.$el.find("tr[id^='treerow-']")[i];if(!$(scnd_click).find('#tree-column').hasClass("oe_export_readonlyfield")){$(scnd_click).addClass("ui-selected");}}}else{for(i=(self.row_index-1);i>=(this.rowIndex-1);i--){scnd_click=self.$el.find("tr[id^='treerow-']")[i];if(!$(scnd_click).find('#tree-column').hasClass("oe_export_readonlyfield")){$(scnd_click).addClass("ui-selected");}}}}}
self.row_index=this.rowIndex;self.$el.find("tr[id='treerow-"+record.id+"']").keyup(function(){self.row_index=0;});var o2m_selection=self.$el.find("tr[id='treerow-"+record.id+"']").find('#tree-column');if($(o2m_selection).hasClass("oe_export_readonlyfield")){return false;}
if(e.ctrlKey){if($(this).hasClass('ui-selected')){$(this).removeClass('ui-selected').find('a').blur();}else{$(this).addClass('ui-selected').find('a').focus();}}else if(!e.shiftKey){self.$el.find("tr.ui-selected").removeClass("ui-selected").find('a').blur();$(this).addClass("ui-selected").find('a').focus();}
return false;});self.$el.find("tr[id='treerow-"+record.id+"']").keydown(function(e){var keyCode=e.keyCode||e.which;var arrow={left:37,up:38,right:39,down:40};var elem;switch(keyCode){case arrow.left:if($(this).hasClass('open')){self.on_click(this.id,record);}
break;case arrow.right:if(!$(this).hasClass('open')){self.on_click(this.id,record);}
break;case arrow.up:elem=this;$(elem).removeClass("ui-selected");while(!$(elem).prev().is(":visible")){elem=$(elem).prev();}
if(!$(elem).prev().find('#tree-column').hasClass("oe_export_readonlyfield")){$(elem).prev().addClass("ui-selected");}
$(elem).prev().find('a').focus();break;case arrow.down:elem=this;$(elem).removeClass("ui-selected");while(!$(elem).next().is(":visible")){elem=$(elem).next();}
if(!$(elem).next().find('#tree-column').hasClass("oe_export_readonlyfield")){$(elem).next().addClass("ui-selected");}
$(elem).next().find('a').focus();break;}});self.$el.find("tr[id='treerow-"+record.id+"']").dblclick(function(){var $o2m_selection=self.$el.find("tr[id^='treerow-"+record.id+"']").find('#tree-column');if(!$o2m_selection.hasClass("oe_export_readonlyfield")){self.add_field(record.id,$(this).find("a").attr("string"));}});});self.$el.find('#fields_list').mouseover(function(event){if(event.relatedTarget){if(event.relatedTarget.attributes['id']&&event.relatedTarget.attributes['string']){var field_id=event.relatedTarget.attributes["id"]["value"];if(field_id&&field_id.split("-")[0]==='export'){if(!self.$el.find("tr[id='treerow-"+field_id.split("-")[1]+"']").find('#tree-column').hasClass("oe_export_readonlyfield")){self.add_field(field_id.split("-")[1],event.relatedTarget.attributes["string"]["value"]);}}}}});},showcontent:function(id){var $this=this.$el.find("tr[id='treerow-"+id+"']");var is_open=$this.hasClass('open');$this.toggleClass('open');var first_child=$this.find('img');if(is_open){first_child.attr('src','/web/static/src/img/expand.gif');}else{first_child.attr('src','/web/static/src/img/collapse.gif');}
var child_field=this.$el.find("tr[id^='treerow-"+id+"/']");var child_len=(id.split("/")).length+1;for(var i=0;i<child_field.length;i++){var $child=$(child_field[i]);if(is_open){$child.hide();}else if(child_len==(child_field[i].id.split("/")).length){if($child.hasClass('open')){$child.removeClass('open');$child.find('img').attr('src','/web/static/src/img/expand.gif');}
$child.show();}}},add_field:function(field_id,string){var field_list=this.$el.find('#fields_list');if(this.$el.find("#fields_list option[value='"+field_id+"']")&&!this.$el.find("#fields_list option[value='"+field_id+"']").length){field_list.append(new Option(string,field_id));}},get_fields:function(){var export_fields=this.$("#fields_list option").map(function(){return $(this).val();}).get();if(!export_fields.length){alert(_t("Please select fields to save export list..."));}
return export_fields;},on_click_export_data:function(){var self=this;var exported_fields=this.$el.find('#fields_list option').map(function(){return{name:self.records[this.value]||this.value,label:this.textContent||this.innerText};}).get();if(_.isEmpty(exported_fields)){alert(_t("Please select fields to export..."));return;}
exported_fields.unshift({name:'id',label:'External ID'});var export_format=this.$el.find("#export_format").val();var c=instance.webclient.crashmanager;instance.web.blockUI();this.session.get_file({url:'/web/export/'+export_format,data:{data:JSON.stringify({model:this.dataset.model,fields:exported_fields,ids:this.ids_to_export,domain:this.domain,context:this.dataset.context,import_compat:!!this.$el.find("#import_compat").val(),})},complete:instance.web.unblockUI,error:c.rpc_error.bind(c),});},close:function(){this._super();}});})();;

/* /web/static/src/js/search.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.search={};var QWeb=instance.web.qweb,_t=instance.web._t,_lt=instance.web._lt;_.mixin({sum:function(obj){return _.reduce(obj,function(a,b){return a+b;},0);}});var my=instance.web.search={};var B=Backbone;my.FacetValue=B.Model.extend({});my.FacetValues=B.Collection.extend({model:my.FacetValue});my.Facet=B.Model.extend({initialize:function(attrs){var values=attrs.values;delete attrs.values;B.Model.prototype.initialize.apply(this,arguments);this.values=new my.FacetValues(values||[]);this.values.on('add remove change reset',function(_,options){this.trigger('change',this,options);},this);},get:function(key){if(key!=='values'){return B.Model.prototype.get.call(this,key);}
return this.values.toJSON();},set:function(key,value){if(key!=='values'){return B.Model.prototype.set.call(this,key,value);}
this.values.reset(value);},toJSON:function(){var out={};var attrs=this.attributes;for(var att in attrs){if(!attrs.hasOwnProperty(att)||att==='field'){continue;}
out[att]=attrs[att];}
out.values=this.values.toJSON();return out;}});my.SearchQuery=B.Collection.extend({model:my.Facet,initialize:function(){B.Collection.prototype.initialize.apply(this,arguments);this.on('change',function(facet){if(!facet.values.isEmpty()){return;}
this.remove(facet,{silent:true});},this);},add:function(values,options){options=options||{};if(!values){values=[];}else if(!(values instanceof Array)){values=[values];}
_(values).each(function(value){var model=this._prepareModel(value,options);var previous=this.detect(function(facet){return facet.get('category')===model.get('category')&&facet.get('field')===model.get('field');});if(previous){previous.values.add(model.get('values'),_.omit(options,'at','merge'));return;}
B.Collection.prototype.add.call(this,model,options);},this);return this;},toggle:function(value,options){options=options||{};var facet=this.detect(function(facet){return facet.get('category')===value.category&&facet.get('field')===value.field;});if(!facet){return this.add(value,options);}
var changed=false;_(value.values).each(function(val){var already_value=facet.values.detect(function(v){return v.get('value')===val.value&&v.get('label')===val.label;});if(already_value){facet.values.remove(already_value,{silent:true});}else{facet.values.add(val,{silent:true});}
changed=true;});facet.trigger('change',facet);return this;}});function assert(condition,message){if(!condition){throw new Error(message);}}
my.InputView=instance.web.Widget.extend({template:'SearchView.InputView',events:{focus:function(){this.trigger('focused',this);},blur:function(){this.$el.text('');this.trigger('blurred',this);},keydown:'onKeydown',paste:'onPaste',},getSelection:function(){this.el.normalize();var root=this.el.childNodes[0];if(!root||!root.textContent){return{start:0,end:0};}
var range=window.getSelection().getRangeAt(0);if(range.startContainer===this.el&&range.startOffset===0){range.setStart(root,0);}
if(range.endContainer===this.el&&range.endOffset===1){range.setEnd(root,root.length);}
assert(range.startContainer===root,"selection should be in the input view");assert(range.endContainer===root,"selection should be in the input view");return{start:range.startOffset,end:range.endOffset};},onKeydown:function(e){this.el.normalize();var sel;switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();break;case $.ui.keyCode.BACKSPACE:sel=this.getSelection();if(sel.start===0&&sel.start===sel.end){e.preventDefault();var preceding=this.getParent().siblingSubview(this,-1);if(preceding&&(preceding instanceof my.FacetView)){preceding.model.destroy();}}
break;case $.ui.keyCode.LEFT:sel=this.getSelection();if(sel.start!==0||sel.start!==sel.end){e.stopPropagation();}
break;case $.ui.keyCode.RIGHT:sel=this.getSelection();var len=this.$el.text().length;if(sel.start!==len||sel.start!==sel.end){e.stopPropagation();}
break;}},setCursorAtEnd:function(){this.el.normalize();var sel=window.getSelection();sel.removeAllRanges();var range=document.createRange();range.selectNode(this.el.childNodes[0]);range.collapse(false);sel.addRange(range);},onPaste:function(){this.el.normalize();setTimeout(function(){var data=this.$el.text();if(!data)
return;this.$el.empty().text(data);this.el.normalize();this.setCursorAtEnd();}.bind(this),0);}});my.FacetView=instance.web.Widget.extend({template:'SearchView.FacetView',events:{'focus':function(){this.trigger('focused',this);},'blur':function(){this.trigger('blurred',this);},'click':function(e){if($(e.target).is('.oe_facet_remove')){this.model.destroy();return false;}
this.$el.focus();e.stopPropagation();},'keydown':function(e){var keys=$.ui.keyCode;switch(e.which){case keys.BACKSPACE:case keys.DELETE:this.model.destroy();return false;}}},init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},start:function(){var self=this;var $e=this.$('> span:last-child');return $.when(this._super()).then(function(){return $.when.apply(null,self.model.values.map(function(value){return new my.FacetValueView(self,value).appendTo($e);}));});},model_changed:function(){this.$el.text(this.$el.text()+'*');}});my.FacetValueView=instance.web.Widget.extend({template:'SearchView.FacetView.Value',init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},model_changed:function(){this.$el.text(this.$el.text()+'*');}});instance.web.SearchView=instance.web.Widget.extend({template:"SearchView",events:{'click':function(e){if(e.target===this.$('.oe_searchview_facets')[0]){this.$('.oe_searchview_input:last').focus();}},'click button.oe_searchview_search':function(e){e.stopImmediatePropagation();this.do_search();},'click .oe_searchview_clear':function(e){e.stopImmediatePropagation();this.query.reset();},'click .oe_searchview_unfold_drawer':function(e){e.stopImmediatePropagation();if(this.drawer)
this.drawer.toggle();},'keydown .oe_searchview_input, .oe_searchview_facet':function(e){switch(e.which){case $.ui.keyCode.LEFT:this.focusPreceding(e.target);e.preventDefault();break;case $.ui.keyCode.RIGHT:if(!this.autocomplete.is_expandable()){this.focusFollowing(e.target);}
e.preventDefault();break;}},'autocompleteopen':function(){this.$el.autocomplete('widget').css('z-index',9999);},},init:function(parent,dataset,view_id,defaults,options){this.options=_.defaults(options||{},{hidden:false,disable_custom_filters:false,});this._super(parent);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.defaults=defaults||{};this.has_defaults=!_.isEmpty(this.defaults);this.headless=this.options.hidden&&!this.has_defaults;this.input_subviews=[];this.view_manager=null;this.$view_manager_header=null;this.ready=$.Deferred();this.drawer_ready=$.Deferred();this.fields_view_get=$.Deferred();this.drawer=new instance.web.SearchViewDrawer(parent,this);},start:function(){var self=this;var p=this._super();this.$view_manager_header=this.$el.parents(".oe_view_manager_header").first();this.setup_global_completion();this.query=new my.SearchQuery().on('add change reset remove',this.proxy('do_search')).on('change',this.proxy('renderChangedFacets')).on('add reset remove',this.proxy('renderFacets'));if(this.options.hidden){this.$el.hide();}
if(this.headless){this.ready.resolve();}else{var load_view=instance.web.fields_view_get({model:this.dataset._model,view_id:this.view_id,view_type:'search',context:this.dataset.get_context(),});this.alive($.when(load_view)).then(function(r){self.fields_view_get.resolve(r);return self.search_view_loaded(r);}).fail(function(){self.ready.reject.apply(null,arguments);});}
var view_manager=this.getParent();while(!(view_manager instanceof instance.web.ViewManager)&&view_manager&&view_manager.getParent){view_manager=view_manager.getParent();}
if(view_manager){this.view_manager=view_manager;view_manager.on('switch_mode',this,function(e){self.drawer.toggle(e==='graph');});}
return $.when(p,this.ready);},set_drawer:function(drawer){this.drawer=drawer;},show:function(){this.$el.show();},hide:function(){this.$el.hide();},subviewForRoot:function(subview_root){return _(this.input_subviews).detect(function(subview){return subview.$el[0]===subview_root;});},siblingSubview:function(subview,direction,wrap_around){var index=_(this.input_subviews).indexOf(subview)+direction;if(wrap_around&&index<0){index=this.input_subviews.length-1;}else if(wrap_around&&index>=this.input_subviews.length){index=0;}
return this.input_subviews[index];},focusPreceding:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),-1,true).$el.focus();},focusFollowing:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),+1,true).$el.focus();},setup_global_completion:function(){var self=this;this.autocomplete=new instance.web.search.AutoComplete(this,{source:this.proxy('complete_global_search'),select:this.proxy('select_completion'),delay:0,get_search_string:function(){return self.$('div.oe_searchview_input').text();},width:this.$el.width(),});this.autocomplete.appendTo(this.$el);},complete_global_search:function(req,resp){$.when.apply(null,_(this.drawer.inputs).chain().filter(function(input){return input.visible();}).invoke('complete',req.term).value()).then(function(){resp(_(arguments).chain().compact().flatten(true).value());});},select_completion:function(e,ui){e.preventDefault();var input_index=_(this.input_subviews).indexOf(this.subviewForRoot(this.$('div.oe_searchview_input:focus')[0]));this.query.add(ui.item.facet,{at:input_index/2});},childFocused:function(){this.$el.addClass('oe_focused');},childBlurred:function(){var val=this.$el.val();this.$el.val('');this.$el.removeClass('oe_focused').trigger('blur');this.autocomplete.close();},renderChangedFacets:function(model,options){this.renderFacets(undefined,model,options);},renderFacets:function(collection,model,options){var self=this;var started=[];var $e=this.$('div.oe_searchview_facets');_.invoke(this.input_subviews,'destroy');this.input_subviews=[];var i=new my.InputView(this);started.push(i.appendTo($e));this.input_subviews.push(i);this.query.each(function(facet){var f=new my.FacetView(this,facet);started.push(f.appendTo($e));self.input_subviews.push(f);var i=new my.InputView(this);started.push(i.appendTo($e));self.input_subviews.push(i);},this);_.each(this.input_subviews,function(childView){childView.on('focused',self,self.proxy('childFocused'));childView.on('blurred',self,self.proxy('childBlurred'));});$.when.apply(null,started).then(function(){if(options&&options.focus_input===false)return;var input_to_focus;if(!options||typeof options.at!=='number'){input_to_focus=_.last(self.input_subviews);}else{input_to_focus=self.input_subviews[(options.at+1)*2];}
input_to_focus.$el.focus();});},search_view_loaded:function(data){var self=this;this.fields_view=data;this.view_id=this.view_id||data.view_id;if(data.type!=='search'||data.arch.tag!=='search'){throw new Error(_.str.sprintf("Got non-search view after asking for a search view: type %s, arch root %s",data.type,data.arch.tag));}
return this.drawer_ready.then(this.proxy('setup_default_query')).then(function(){self.trigger("search_view_loaded",data);self.ready.resolve();});},setup_default_query:function(){var custom_filters=this.drawer.custom_filters.filters;if(!this.options.disable_custom_filters&&!_(custom_filters).isEmpty()){var personal_filter=_(custom_filters).find(function(filter){return filter.user_id&&filter.is_default;});if(personal_filter){this.drawer.custom_filters.toggle_filter(personal_filter,true);return;}
var global_filter=_(custom_filters).find(function(filter){return!filter.user_id&&filter.is_default;});if(global_filter){this.drawer.custom_filters.toggle_filter(global_filter,true);return;}}
this.query.reset(_(arguments).compact(),{preventSearch:true});},build_search_data:function(){var domains=[],contexts=[],groupbys=[],errors=[];this.query.each(function(facet){var field=facet.get('field');try{var domain=field.get_domain(facet);if(domain){domains.push(domain);}
var context=field.get_context(facet);if(context){contexts.push(context);}
var group_by=field.get_groupby(facet);if(group_by){groupbys.push.apply(groupbys,group_by);}}catch(e){if(e instanceof instance.web.search.Invalid){errors.push(e);}else{throw e;}}});return{domains:domains,contexts:contexts,groupbys:groupbys,errors:errors};},do_search:function(_query,options){if(options&&options.preventSearch){return;}
var search=this.build_search_data();if(!_.isEmpty(search.errors)){this.on_invalid(search.errors);return;}
this.trigger('search_data',search.domains,search.contexts,search.groupbys);},on_invalid:function(errors){this.do_notify(_t("Invalid Search"),_t("triggered from search view"));this.trigger('invalid_search',errors);},appendTo:function($searchview_parent,$searchview_drawer_node){var $searchview_drawer_node=$searchview_drawer_node||$searchview_parent;return $.when(this._super($searchview_parent),this.drawer.appendTo($searchview_drawer_node));},destroy:function(){this.drawer.destroy();this.getParent().destroy.call(this);}});instance.web.SearchViewDrawer=instance.web.Widget.extend({template:"SearchViewDrawer",init:function(parent,searchview){this._super(parent);this.searchview=searchview;this.searchview.set_drawer(this);this.ready=searchview.drawer_ready;this.controls=[];this.inputs=[];},toggle:function(visibility){this.$el.toggle(visibility);var $view_manager_body=this.$el.closest('.oe_view_manager_body');if($view_manager_body.length){$view_manager_body.scrollTop(0);}},start:function(){var self=this;if(this.searchview.headless)return $.when(this._super(),this.searchview.ready);var filters_ready=this.searchview.fields_view_get.then(this.proxy('prepare_filters'));return $.when(this._super(),filters_ready).then(function(){var defaults=arguments[1][0];self.ready.resolve.apply(null,defaults);});},prepare_filters:function(data){this.make_widgets(data['arch'].children,data.fields);this.add_common_inputs();var in_drawer=this.select_for_drawer();var $first_col=this.$(".col-md-7"),$snd_col=this.$(".col-md-5");var add_custom_filters=in_drawer[0].appendTo($first_col),add_filters=in_drawer[1].appendTo($first_col),add_rest=$.when.apply(null,_(in_drawer.slice(2)).invoke('appendTo',$snd_col)),defaults_fetched=$.when.apply(null,_(this.inputs).invoke('facet_for_defaults',this.searchview.defaults));return $.when(defaults_fetched,add_custom_filters,add_filters,add_rest);},select_for_drawer:function(){return _(this.inputs).filter(function(input){return input.in_drawer();});},make_widgets:function(items,fields,group){if(!group){group=new instance.web.search.Group(this,'q',{attrs:{string:_t("Filters")}});}
var self=this;var filters=[];_.each(items,function(item){if(filters.length&&item.tag!=='filter'){group.push(new instance.web.search.FilterGroup(filters,group));filters=[];}
switch(item.tag){case'separator':case'newline':break;case'filter':filters.push(new instance.web.search.Filter(item,group));break;case'group':self.add_separator();self.make_widgets(item.children,fields,new instance.web.search.Group(group,'w',item));self.add_separator();break;case'field':var field=this.make_field(item,fields[item['attrs'].name],group);group.push(field);self.make_widgets(item.children,fields,group);break;}},this);if(filters.length){group.push(new instance.web.search.FilterGroup(filters,this));}},add_separator:function(){if(!(_.last(this.inputs)instanceof instance.web.search.Separator))
new instance.web.search.Separator(this);},make_field:function(item,field,parent){if(field.type==="many2one"&&item.attrs.widget==="selection"){item.attrs.widget=undefined;}
var obj=instance.web.search.fields.get_any([item.attrs.widget,field.type]);if(obj){return new(obj)(item,field,parent||this);}else{console.group('Unknown field type '+field.type);console.error('View node',item);console.info('View field',field);console.info('In view',this);console.groupEnd();return null;}},add_common_inputs:function(){this.custom_filters=new instance.web.search.CustomFilters(this);(new instance.web.search.Filters(this));(new instance.web.search.SaveFilter(this,this.custom_filters));(new instance.web.search.Advanced(this));},});instance.web.search.fields=new instance.web.Registry({'char':'instance.web.search.CharField','text':'instance.web.search.CharField','html':'instance.web.search.CharField','boolean':'instance.web.search.BooleanField','integer':'instance.web.search.IntegerField','id':'instance.web.search.IntegerField','float':'instance.web.search.FloatField','selection':'instance.web.search.SelectionField','datetime':'instance.web.search.DateTimeField','date':'instance.web.search.DateField','many2one':'instance.web.search.ManyToOneField','many2many':'instance.web.search.CharField','one2many':'instance.web.search.CharField'});instance.web.search.Invalid=instance.web.Class.extend({init:function(field,value,message){this.field=field;this.value=value;this.message=message;},toString:function(){return _.str.sprintf(_t("Incorrect value for field %(fieldname)s: [%(value)s] is %(message)s"),{fieldname:this.field,value:this.value,message:this.message});}});instance.web.search.Widget=instance.web.Widget.extend({template:null,init:function(parent){this._super(parent);var ancestor=parent;do{this.drawer=ancestor;}while(!(ancestor instanceof instance.web.SearchViewDrawer)&&(ancestor=(ancestor.getParent&&ancestor.getParent())));this.view=this.drawer.searchview||this.drawer;}});instance.web.search.add_expand_listener=function($root){$root.find('a.searchview_group_string').click(function(e){$root.toggleClass('folded expanded');e.stopPropagation();e.preventDefault();});};instance.web.search.Group=instance.web.search.Widget.extend({init:function(parent,icon,node){this._super(parent);var attrs=node.attrs;this.modifiers=attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};this.attrs=attrs;this.icon=icon;this.name=attrs.string;this.children=[];this.drawer.controls.push(this);},push:function(input){this.children.push(input);},visible:function(){return!this.modifiers.invisible;},});instance.web.search.Input=instance.web.search.Widget.extend({_in_drawer:false,init:function(parent){this._super(parent);this.load_attrs({});this.drawer.inputs.push(this);},complete:function(value){return $.when(null);},facet_for_defaults:function(defaults){if(!this.attrs||!(this.attrs.name in defaults&&defaults[this.attrs.name])){return $.when(null);}
return this.facet_for(defaults[this.attrs.name]);},in_drawer:function(){return!!this._in_drawer;},get_context:function(){throw new Error("get_context not implemented for widget "+this.attrs.type);},get_groupby:function(){throw new Error("get_groupby not implemented for widget "+this.attrs.type);},get_domain:function(){throw new Error("get_domain not implemented for widget "+this.attrs.type);},load_attrs:function(attrs){attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};this.attrs=attrs;},visible:function(){if(this.attrs.modifiers.invisible){return false;}
var parent=this;while((parent=parent.getParent())&&((parent instanceof instance.web.search.Group)||(parent instanceof instance.web.search.Input))){if(!parent.visible()){return false;}}
return true;},});instance.web.search.FilterGroup=instance.web.search.Input.extend({template:'SearchView.filters',icon:'q',completion_label:_lt("Filter on: %s"),init:function(filters,parent){if(!(this instanceof instance.web.search.GroupbyGroup)&&_(filters).all(function(f){if(!f.attrs.context){return false;}
var c=instance.web.pyeval.eval('context',f.attrs.context);return!_.isEmpty(c.group_by);})){return new instance.web.search.GroupbyGroup(filters,parent);}
this._super(parent);this.filters=filters;this.view.query.on('add remove change reset',this.proxy('search_change'));},start:function(){this.$el.on('click','li',this.proxy('toggle_filter'));return $.when(null);},search_change:function(){var self=this;var $filters=this.$('> li').removeClass('badge');var facet=this.view.query.find(_.bind(this.match_facet,this));if(!facet){return;}
facet.values.each(function(v){var i=_(self.filters).indexOf(v.get('value'));if(i===-1){return;}
$filters.filter(function(){return Number($(this).data('index'))===i;}).addClass('badge');});},match_facet:function(facet){return facet.get('field')===this;},make_facet:function(values){return{category:_t("Filter"),icon:this.icon,values:values,field:this};},make_value:function(filter){return{label:filter.attrs.string||filter.attrs.help||filter.attrs.name,value:filter};},facet_for_defaults:function(defaults){var self=this;var fs=_(this.filters).chain().filter(function(f){return f.attrs&&f.attrs.name&&!!defaults[f.attrs.name];}).map(function(f){return self.make_value(f);}).value();if(_.isEmpty(fs)){return $.when(null);}
return $.when(this.make_facet(fs));},get_context:function(facet){var contexts=facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();if(!contexts.length){return;}
if(contexts.length===1){return contexts[0];}
return _.extend(new instance.web.CompoundContext(),{__contexts:contexts});},get_groupby:function(facet){return facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();},get_domain:function(facet){var domains=facet.values.chain().map(function(f){return f.get('value').attrs.domain;}).without('[]').reject(_.isEmpty).value();if(!domains.length){return;}
if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new instance.web.CompoundDomain(),{__domains:domains});},toggle_filter:function(e){this.toggle(this.filters[Number($(e.target).data('index'))]);},toggle:function(filter){this.view.query.toggle(this.make_facet([this.make_value(filter)]));},complete:function(item){var self=this;item=item.toLowerCase();var facet_values=_(this.filters).chain().filter(function(filter){return filter.visible();}).filter(function(filter){var at={string:filter.attrs.string||'',help:filter.attrs.help||'',name:filter.attrs.name||''};var include=_.str.include;return include(at.string.toLowerCase(),item)||include(at.help.toLowerCase(),item)||include(at.name.toLowerCase(),item);}).map(this.make_value).value();if(_(facet_values).isEmpty()){return $.when(null);}
return $.when(_.map(facet_values,function(facet_value){return{label:_.str.sprintf(self.completion_label.toString(),_.escape(facet_value.label)),facet:self.make_facet([facet_value])};}));}});instance.web.search.GroupbyGroup=instance.web.search.FilterGroup.extend({icon:'w',completion_label:_lt("Group by: %s"),init:function(filters,parent){this._super(filters,parent);if(!this.view._s_groupby){this.view._s_groupby={help:"See GroupbyGroup#init",get_context:this.proxy('get_context'),get_domain:this.proxy('get_domain'),get_groupby:this.proxy('get_groupby')};}},match_facet:function(facet){return facet.get('field')===this.view._s_groupby;},make_facet:function(values){return{category:_t("GroupBy"),icon:this.icon,values:values,field:this.view._s_groupby};}});instance.web.search.Filter=instance.web.search.Input.extend({template:'SearchView.filter',init:function(node,parent){this._super(parent);this.load_attrs(node.attrs);},facet_for:function(){return $.when(null);},get_context:function(){},get_domain:function(){},});instance.web.search.Separator=instance.web.search.Input.extend({_in_drawer:false,complete:function(){return{is_separator:true};}});instance.web.search.Field=instance.web.search.Input.extend({template:'SearchView.field',default_operator:'=',init:function(view_section,field,parent){this._super(parent);this.load_attrs(_.extend({},field,view_section.attrs));},facet_for:function(value){return $.when({field:this,category:this.attrs.string||this.attrs.name,values:[{label:String(value),value:value}]});},value_from:function(facetValue){return facetValue.get('value');},get_context:function(facet){var self=this;var context=this.attrs.context;if(_.isEmpty(context)||!facet.values.length){return;}
var contexts=facet.values.map(function(facetValue){return new instance.web.CompoundContext(context).set_eval_context({self:self.value_from(facetValue)});});if(contexts.length===1){return contexts[0];}
return _.extend(new instance.web.CompoundContext(),{__contexts:contexts});},get_groupby:function(){},make_domain:function(name,operator,facet){return[[name,operator,this.value_from(facet)]];},get_domain:function(facet){if(!facet.values.length){return;}
var value_to_domain;var self=this;var domain=this.attrs['filter_domain'];if(domain){value_to_domain=function(facetValue){return new instance.web.CompoundDomain(domain).set_eval_context({self:self.value_from(facetValue)});};}else{value_to_domain=function(facetValue){return self.make_domain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=facet.values.map(value_to_domain);if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new instance.web.CompoundDomain(),{__domains:domains});}});instance.web.search.CharField=instance.web.search.Field.extend({default_operator:'ilike',complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value}]}}]);}});instance.web.search.NumberField=instance.web.search.Field.extend({complete:function(value){var val=this.parse(value);if(isNaN(val)){return $.when();}
var label=_.str.sprintf(_t("Search %(field)s for: %(value)s"),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:val}]}}]);},});instance.web.search.IntegerField=instance.web.search.NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return instance.web.parse_value(value,{'widget':'integer'});}catch(e){return NaN;}}});instance.web.search.FloatField=instance.web.search.NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return instance.web.parse_value(value,{'widget':'float'});}catch(e){return NaN;}}});function facet_from(field,pair){return{field:field,category:field['attrs'].string,values:[{label:pair[1],value:pair[0]}]};}
instance.web.search.SelectionField=instance.web.search.Field.extend({template:'SearchView.field.selection',init:function(){this._super.apply(this,arguments);this.prepend_empty=!_(this.attrs.selection).detect(function(item){return!item[1];});},complete:function(needle){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var value=sel[0],label=sel[1];if(value===undefined||!label){return false;}
return label.toLowerCase().indexOf(needle.toLowerCase())!==-1;}).map(function(sel){return{label:_.escape(sel[1]),indent:true,facet:facet_from(self,sel)};}).value();if(_.isEmpty(results)){return $.when(null);}
return $.when.call(null,[{label:_.escape(this.attrs.string)}].concat(results));},facet_for:function(value){var match=_(this.attrs.selection).detect(function(sel){return sel[0]===value;});if(!match){return $.when(null);}
return $.when(facet_from(this,match));}});instance.web.search.BooleanField=instance.web.search.SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];}});instance.web.search.DateField=instance.web.search.Field.extend({value_from:function(facetValue){return instance.web.date_to_str(facetValue.get('value'));},complete:function(needle){var d;try{var t=(this.attrs&&this.attrs.type==='datetime')?'datetime':'date';var v=instance.web.parse_value(needle,{'widget':t});if(t==='datetime'){d=instance.web.str_to_datetime(v);}
else{d=instance.web.str_to_date(v);}}catch(e){}
if(!d){return $.when(null);}
var date_string=instance.web.format_value(d,this.attrs);var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+date_string+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:date_string,value:d}]}}]);}});instance.web.search.DateTimeField=instance.web.search.DateField.extend({value_from:function(facetValue){return instance.web.datetime_to_str(facetValue.get('value'));}});instance.web.search.ManyToOneField=instance.web.search.CharField.extend({default_operator:{},init:function(view_section,field,parent){this._super(view_section,field,parent);this.model=new instance.web.Model(this.attrs.relation);},complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value,operator:'ilike'}]},expand:this.expand.bind(this),}]);},expand:function(needle){var self=this;var context=instance.web.pyeval.eval('contexts',[this.view.dataset.get_context()]);return this.model.call('name_search',[],{name:needle,args:(typeof this.attrs.domain==='string')?[]:this.attrs.domain,limit:8,context:context}).then(function(results){if(_.isEmpty(results)){return null;}
return _(results).map(function(result){return{label:_.escape(result[1]),facet:facet_from(self,result)};});});},facet_for:function(value){var self=this;if(value instanceof Array){if(value.length===2&&_.isString(value[1])){return $.when(facet_from(this,value));}
assert(value.length<=1,_t("M2O search fields do not currently handle multiple default values"));value=value[0];}
return this.model.call('name_get',[value]).then(function(names){if(_(names).isEmpty()){return null;}
return facet_from(self,names[0]);});},value_from:function(facetValue){return facetValue.get('label');},make_domain:function(name,operator,facetValue){operator=facetValue.get('operator')||operator;switch(operator){case this.default_operator:return[[name,'=',facetValue.get('value')]];case'ilike':return[[name,'ilike',facetValue.get('value')]];case'child_of':return[[name,'child_of',facetValue.get('value')]];}
return this._super(name,operator,facetValue);},get_context:function(facet){var values=facet.values;if(_.isEmpty(this.attrs.context)&&values.length===1){var c={};var v=values.at(0);if(v.get('operator')!=='ilike'){c['default_'+this.attrs.name]=v.get('value');}
return c;}
return this._super(facet);}});instance.web.search.CustomFilters=instance.web.search.Input.extend({template:'SearchView.Custom',_in_drawer:true,init:function(){this.is_ready=$.Deferred();this._super.apply(this,arguments);},start:function(){var self=this;this.model=new instance.web.Model('ir.filters');this.filters={};this.$filters={};this.view.query.on('remove',function(facet){if(!facet.get('is_custom_filter')){return;}
self.clear_selection();}).on('reset',this.proxy('clear_selection'));return this.model.call('get_filters',[this.view.model,this.get_action_id()]).then(this.proxy('set_filters')).done(function(){self.is_ready.resolve();}).fail(function(){self.is_ready.reject.apply(self.is_ready,arguments);});},get_action_id:function(){var action=instance.client.action_manager.inner_action;if(action)return action.id;},facet_for_defaults:function(){return this.is_ready;},key_for:function(filter){var user_id=filter.user_id,action_id=filter.action_id;var uid=(user_id instanceof Array)?user_id[0]:user_id;var act_id=(action_id instanceof Array)?action_id[0]:action_id;return _.str.sprintf('(%s)(%s)%s',uid,act_id,filter.name);},facet_for:function(filter){return{category:_t("Custom Filter"),icon:'M',field:{get_context:function(){return filter.context;},get_groupby:function(){return[filter.context];},get_domain:function(){return filter.domain;}},_id:filter['id'],is_custom_filter:true,values:[{label:filter.name,value:null}]};},clear_selection:function(){this.$('span.badge').removeClass('badge');},append_filter:function(filter){var self=this;var key=this.key_for(filter);var warning=_t("This filter is global and will be removed for everybody if you continue.");var $filter;if(key in this.$filters){$filter=this.$filters[key];}else{var id=filter.id;this.filters[key]=filter;$filter=$('<li></li>').appendTo(this.$('.oe_searchview_custom_list')).toggleClass('oe_searchview_custom_default',filter.is_default).append(this.$filters[key]=$('<span>').text(filter.name));this.$filters[key].addClass(filter.user_id?'oe_searchview_custom_private':'oe_searchview_custom_public')
$('<a class="oe_searchview_custom_delete">x</a>').click(function(e){e.stopPropagation();if(!(filter.user_id||confirm(warning))){return;}
self.model.call('unlink',[id]).done(function(){$filter.remove();delete self.$filters[key];delete self.filters[key];if(_.isEmpty(self.filters)){self.hide();}});}).appendTo($filter);}
this.$filters[key].unbind('click').click(function(){self.toggle_filter(filter);});this.show();},toggle_filter:function(filter,preventSearch){var current=this.view.query.find(function(facet){return facet.get('_id')===filter.id;});if(current){this.view.query.remove(current);this.$filters[this.key_for(filter)].removeClass('badge');return;}
this.view.query.reset([this.facet_for(filter)],{preventSearch:preventSearch||false});this.$filters[this.key_for(filter)].addClass('badge');},set_filters:function(filters){_(filters).map(_.bind(this.append_filter,this));if(!filters.length){this.hide();}},hide:function(){this.$el.hide();},show:function(){this.$el.show();},});instance.web.search.SaveFilter=instance.web.search.Input.extend({template:'SearchView.SaveFilter',_in_drawer:true,init:function(parent,custom_filters){this._super(parent);this.custom_filters=custom_filters;},start:function(){var self=this;this.model=new instance.web.Model('ir.filters');this.$el.on('submit','form',this.proxy('save_current'));this.$el.on('click','input[type=checkbox]',function(){$(this).siblings('input[type=checkbox]').prop('checked',false);});this.$el.on('click','h4',function(){self.$el.toggleClass('oe_opened');});},save_current:function(){var self=this;var $name=this.$('input:first');var private_filter=!this.$('#oe_searchview_custom_public').prop('checked');var set_as_default=this.$('#oe_searchview_custom_default').prop('checked');if(_.isEmpty($name.val())){this.do_warn(_t("Error"),_t("Filter name is required."));return false;}
var search=this.view.build_search_data();instance.web.pyeval.eval_domains_and_contexts({domains:search.domains,contexts:search.contexts,group_by_seq:search.groupbys||[]}).done(function(results){if(!_.isEmpty(results.group_by)){results.context.group_by=results.group_by;}
var ctx=results.context;_(_.keys(instance.session.user_context)).each(function(key){delete ctx[key];});var filter={name:$name.val(),user_id:private_filter?instance.session.uid:false,model_id:self.view.model,context:results.context,domain:results.domain,is_default:set_as_default,action_id:self.custom_filters.get_action_id()};return self.model.call('create_or_replace',[filter]).done(function(id){filter.id=id;if(self.custom_filters){self.custom_filters.append_filter(filter);}
self.$el.removeClass('oe_opened').find('form')[0].reset();});});return false;},});instance.web.search.Filters=instance.web.search.Input.extend({template:'SearchView.Filters',_in_drawer:true,start:function(){var self=this;var is_group=function(i){return i instanceof instance.web.search.FilterGroup;};var visible_filters=_(this.drawer.controls).chain().reject(function(group){return _(_(group.children).filter(is_group)).isEmpty()||group.modifiers.invisible;});var groups=visible_filters.map(function(group){var filters=_(group.children).filter(is_group);return{name:_.str.sprintf("<span class='oe_i'>%s</span> %s",group.icon,group.name),filters:filters,length:_(filters).chain().map(function(i){return i.filters.length;}).sum().value()};}).value();var $dl=$('<dl class="dl-horizontal">').appendTo(this.$el);var rendered_lines=_.map(groups,function(group){$('<dt>').html(group.name).appendTo($dl);var $dd=$('<dd>').appendTo($dl);return $.when.apply(null,_(group.filters).invoke('appendTo',$dd));});return $.when.apply(this,rendered_lines);},});instance.web.search.Advanced=instance.web.search.Input.extend({template:'SearchView.advanced',_in_drawer:true,start:function(){var self=this;this.$el.on('keypress keydown keyup',function(e){e.stopPropagation();}).on('click','h4',function(){self.$el.toggleClass('oe_opened');}).on('click','button.oe_add_condition',function(){self.append_proposition();}).on('submit','form',function(e){e.preventDefault();self.commit_search();});return $.when(this._super(),new instance.web.Model(this.view.model).call('fields_get',{context:this.view.dataset.context}).done(function(data){self.fields={id:{string:'ID',type:'id',searchable:true}};_.each(data,function(field_def,field_name){if(field_def.selectable!==false&&field_name!='id'){self.fields[field_name]=field_def;}});})).done(function(){self.append_proposition();});},append_proposition:function(){var self=this;return(new instance.web.search.ExtendedSearchProposition(this,this.fields)).appendTo(this.$('ul')).done(function(){self.$('button.oe_apply').prop('disabled',false);});},remove_proposition:function(prop){if(this.getChildren().length<=1){this.$('button.oe_apply').prop('disabled',true);}
prop.destroy();},commit_search:function(){var children=this.getChildren();var propositions=_.invoke(children,'get_proposition');var domain=_(propositions).pluck('value');for(var i=domain.length;--i;){domain.unshift('|');}
this.view.query.add({category:_t("Advanced"),values:propositions,field:{get_context:function(){},get_domain:function(){return domain;},get_groupby:function(){}}});_.invoke(children,'destroy');this.append_proposition();this.view.$el.removeClass('oe_searchview_open_drawer');}});instance.web.search.ExtendedSearchProposition=instance.web.Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .searchview_extended_prop_field':'changed','change .searchview_extended_prop_op':'operator_changed','click .searchview_extended_delete_prop':function(e){e.stopPropagation();this.getParent().remove_proposition(this);}},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated&&field.searchable;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){return this._super().done(this.proxy('changed'));},changed:function(){var nval=this.$(".searchview_extended_prop_field").val();if(this.attrs.selected===null||this.attrs.selected===undefined||nval!=this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name==nval;}));}},operator_changed:function(e){var $value=this.$('.searchview_extended_prop_value');switch($(e.target).val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},select_field:function(field){var self=this;if(this.attrs.selected!==null&&this.attrs.selected!==undefined){this.value.destroy();this.value=null;this.$('.searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field===null||field===undefined){return;}
var type=field.type;var Field=instance.web.search.custom_filters.get_object(type);if(!Field){Field=instance.web.search.custom_filters.get_object("char");}
this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.searchview_extended_prop_op'));});var $value_loc=this.$('.searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_proposition:function(){if(this.attrs.selected===null||this.attrs.selected===undefined)
return null;var field=this.attrs.selected;var op_select=this.$('.searchview_extended_prop_op')[0];var operator=op_select.options[op_select.selectedIndex];return{label:this.value.get_label(field,operator),value:this.value.get_domain(field,operator),};}});instance.web.search.ExtendedSearchProposition.Field=instance.web.Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return this.make_domain(field.name,'!=',false);case'∄':return this.make_domain(field.name,'=',false);default:return this.make_domain(field.name,operator.value,this.get_value());}},make_domain:function(field,operator,value){return[field,operator,value];},toString:function(){return this.get_value();}});instance.web.search.ExtendedSearchProposition.Char=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.char',operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});instance.web.search.ExtendedSearchProposition.DateTime=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.empty',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater or equal than")},{value:"<=",text:_lt("less or equal than")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],widget:function(){return instance.web.DateTimeWidget;},get_value:function(){return this.datewidget.get_value();},toString:function(){return instance.web.format_value(this.get_value(),{type:"datetime"});},start:function(){var ready=this._super();this.datewidget=new(this.widget())(this);this.datewidget.appendTo(this.$el);return ready;}});instance.web.search.ExtendedSearchProposition.Date=instance.web.search.ExtendedSearchProposition.DateTime.extend({widget:function(){return instance.web.DateWidget;},toString:function(){return instance.web.format_value(this.get_value(),{type:"date"});}});instance.web.search.ExtendedSearchProposition.Integer=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.integer',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater or equal than")},{value:"<=",text:_lt("less or equal than")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return instance.web.parse_value(val===""?0:val,{'widget':'integer'});}catch(e){return"";}}});instance.web.search.ExtendedSearchProposition.Id=instance.web.search.ExtendedSearchProposition.Integer.extend({operators:[{value:"=",text:_lt("is")}]});instance.web.search.ExtendedSearchProposition.Float=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater or equal than")},{value:"<=",text:_lt("less or equal than")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return instance.web.parse_value(val===""?0.0:val,{'widget':'float'});}catch(e){return"";}}});instance.web.search.ExtendedSearchProposition.Selection=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});instance.web.search.ExtendedSearchProposition.Boolean=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.empty',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});instance.web.search.custom_filters=new instance.web.Registry({'char':'instance.web.search.ExtendedSearchProposition.Char','text':'instance.web.search.ExtendedSearchProposition.Char','one2many':'instance.web.search.ExtendedSearchProposition.Char','many2one':'instance.web.search.ExtendedSearchProposition.Char','many2many':'instance.web.search.ExtendedSearchProposition.Char','datetime':'instance.web.search.ExtendedSearchProposition.DateTime','date':'instance.web.search.ExtendedSearchProposition.Date','integer':'instance.web.search.ExtendedSearchProposition.Integer','float':'instance.web.search.ExtendedSearchProposition.Float','boolean':'instance.web.search.ExtendedSearchProposition.Boolean','selection':'instance.web.search.ExtendedSearchProposition.Selection','id':'instance.web.search.ExtendedSearchProposition.Id'});instance.web.search.AutoComplete=instance.web.Widget.extend({template:"SearchView.autocomplete",init:function(parent,options){this._super(parent);this.$input=parent.$el;this.source=options.source;this.delay=options.delay;this.select=options.select,this.get_search_string=options.get_search_string;this.width=options.width||400;this.current_result=null;this.searching=true;this.search_string=null;this.current_search=null;},start:function(){var self=this;this.$el.width(this.width);this.$input.on('keyup',function(ev){if(ev.which===$.ui.keyCode.RIGHT){self.searching=true;ev.preventDefault();return;}
if(ev.which===$.ui.keyCode.ENTER){if(self.current_result&&self.get_search_string().length){self.select_item(ev);}
return;}
if(!self.searching){self.searching=true;return;}
self.search_string=self.get_search_string();if(self.search_string.length){var search_string=self.search_string;setTimeout(function(){self.initiate_search(search_string);},self.delay);}else{self.close();}});this.$input.on('keydown',function(ev){switch(ev.which){case $.ui.keyCode.TAB:if(self.current_result&&self.get_search_string().length){self.select_item(ev);}
break;case $.ui.keyCode.DOWN:self.move('down');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.UP:self.move('up');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.RIGHT:self.searching=false;var current=self.current_result
if(current&&current.expand&&!current.expanded){self.expand();self.searching=true;}
ev.preventDefault();break;case $.ui.keyCode.ESCAPE:self.close();self.searching=false;break;}});},initiate_search:function(query){if(query===this.search_string&&query!==this.current_search){this.search(query);}},search:function(query){var self=this;this.current_search=query;this.source({term:query},function(results){if(results.length){self.render_search_results(results);self.focus_element(self.$('li:first-child'));}else{self.close();}});},render_search_results:function(results){var self=this;var $list=this.$('ul');$list.empty();var render_separator=false;results.forEach(function(result){if(result.is_separator){if(render_separator)
$list.append($('<li>').addClass('oe-separator'));render_separator=false;}else{var $item=self.make_list_item(result).appendTo($list);result.$el=$item;render_separator=true;}});this.show();},make_list_item:function(result){var self=this;var $li=$('<li>').hover(function(ev){self.focus_element($li);}).mousedown(function(ev){if(ev.button===0){self.select(ev,{item:{facet:result.facet}});self.close();}else{ev.preventDefault();}}).data('result',result);if(result.expand){var $expand=$('<span class="oe-expand">').text('▶').appendTo($li);$expand.mousedown(function(ev){ev.preventDefault();ev.stopPropagation();if(result.expanded)
self.fold();else
self.expand();});result.expanded=false;}
if(result.indent)$li.addClass('oe-indent');$li.append($('<span>').html(result.label));return $li;},expand:function(){var self=this;this.current_result.expand(this.get_search_string()).then(function(results){(results||[{label:'(no result)'}]).reverse().forEach(function(result){result.indent=true;var $li=self.make_list_item(result);self.current_result.$el.after($li);});self.current_result.expanded=true;self.current_result.$el.find('span.oe-expand').html('▼');});},fold:function(){var $next=this.current_result.$el.next();while($next.hasClass('oe-indent')){$next.remove();$next=this.current_result.$el.next();}
this.current_result.expanded=false;this.current_result.$el.find('span.oe-expand').html('▶');},focus_element:function($li){this.$('li').removeClass('oe-selection-focus');$li.addClass('oe-selection-focus');this.current_result=$li.data('result');},select_item:function(ev){if(this.current_result.facet){this.select(ev,{item:{facet:this.current_result.facet}});this.close();}},show:function(){this.$el.show();},close:function(){this.current_search=null;this.search_string=null;this.searching=true;this.$el.hide();},move:function(direction){var $next;if(direction==='down'){$next=this.$('li.oe-selection-focus').nextAll(':not(.oe-separator)').first();if(!$next.length)$next=this.$('li:first-child');}else{$next=this.$('li.oe-selection-focus').prevAll(':not(.oe-separator)').first();if(!$next.length)$next=this.$('li:not(.oe-separator)').last();}
this.focus_element($next);},is_expandable:function(){return!!this.$('.oe-selection-focus .oe-expand').length;},});})();;

/* /web/static/src/js/view_list.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.list={};var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.views.add('list','instance.web.ListView');instance.web.ListView=instance.web.View.extend({_template:'ListView',display_name:_lt('List'),defaults:{'selectable':true,'deletable':false,'header':true,'addable':_lt("Create"),'sortable':true,'reorderable':true,'action_buttons':true,'disable_editable_mode':false,},view_type:'tree',events:{'click thead th.oe_sortable[data-id]':'sort_by_column'},init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.set_default_options(_.extend({},this.defaults,options||{}));this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.previous_colspan=null;this.colors=null;this.fonts=null;this.columns=[];this.records=new Collection();this.set_groups(new(this.options.GroupsType)(this));if(this.dataset instanceof instance.web.DataSetStatic){this.groups.datagroup=new StaticDataGroup(this.dataset);}else{this.groups.datagroup=new DataGroup(this,this.model,dataset.get_domain(),dataset.get_context());this.groups.datagroup.sort=this.dataset._sort;}
this.page=0;this.records.bind('change',function(event,record,key){if(!_(self.aggregate_columns).chain().pluck('name').contains(key).value()){return;}
self.compute_aggregates();});this.no_leaf=false;this.grouped=false;},view_loading:function(r){return this.load_list(r);},set_default_options:function(options){this._super(options);_.defaults(this.options,{GroupsType:instance.web.ListView.Groups,ListType:instance.web.ListView.List});},limit:function(){if(this._limit===undefined){this._limit=(this.options.limit||this.defaults.limit||(this.getParent().action||{}).limit||80);}
return this._limit;},set_groups:function(groups){var self=this;if(this.groups){$(this.groups).unbind("selected deleted action row_link");delete this.groups;}
this.groups=groups;$(this.groups).bind({'selected':function(e,ids,records,deselected){self.do_select(ids,records,deselected);},'deleted':function(e,ids){self.do_delete(ids);},'action':function(e,action_name,id,callback){self.do_button_action(action_name,id,callback);},'row_link':function(e,id,dataset,view){self.do_activate_record(dataset.index,id,dataset,view);}});},start:function(){this.$el.addClass('oe_list');return this._super();},style_for:function(record){var len,style='';var context=_.extend({},record.attributes,{uid:this.session.uid,current_date:new Date().toString('yyyy-MM-dd')});var i;var pair;var expression;if(this.fonts){for(i=0,len=this.fonts.length;i<len;++i){pair=this.fonts[i];var font=pair[0];expression=pair[1];if(py.evaluate(expression,context).toJSON()){switch(font){case'bold':style+='font-weight: bold;';break;case'italic':style+='font-style: italic;';break;case'underline':style+='text-decoration: underline;';break;}}}}
if(!this.colors){return style;}
for(i=0,len=this.colors.length;i<len;++i){pair=this.colors[i];var color=pair[0];expression=pair[1];if(py.evaluate(expression,context).toJSON()){return style+='color: '+color+';';}}
return style;},load_list:function(data){var self=this;this.fields_view=data;this.name=""+this.fields_view.arch.attrs.string;if(this.fields_view.arch.attrs.colors){this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
if(this.fields_view.arch.attrs.fonts){this.fonts=_(this.fields_view.arch.attrs.fonts.split(';')).chain().compact().map(function(font_pair){var pair=font_pair.split(':'),font=pair[0],expr=pair[1];return[font,py.parse(py.tokenize(expr)),expr];}).value();}
this.setup_columns(this.fields_view.fields,this.grouped);this.$el.html(QWeb.render(this._template,this));this.$el.addClass(this.fields_view.arch.attrs['class']);this.$el.find('.oe_list_record_selector').click(function(){self.$el.find('.oe_list_record_selector input').prop('checked',self.$el.find('.oe_list_record_selector').prop('checked')||false);var selection=self.groups.get_selection();$(self.groups).trigger('selected',[selection.ids,selection.records]);});if(!this.$buttons){this.$buttons=$(QWeb.render("ListView.buttons",{'widget':self}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}else{this.$el.find('.oe_list_buttons').replaceWith(this.$buttons);}
this.$buttons.find('.oe_list_add').click(this.proxy('do_add_record')).prop('disabled',this.grouped);}
if(!this.$pager){this.$pager=$(QWeb.render("ListView.pager",{'widget':self}));if(this.options.$buttons){this.$pager.appendTo(this.options.$pager);}else{this.$el.find('.oe_list_pager').replaceWith(this.$pager);}
this.$pager.on('click','a[data-pager-action]',function(){var $this=$(this);var max_page=Math.floor(self.dataset.size()/self.limit());switch($this.data('pager-action')){case'first':self.page=0;break;case'last':self.page=max_page-1;break;case'next':self.page+=1;break;case'previous':self.page-=1;break;}
if(self.page<0){self.page=max_page;}else if(self.page>max_page){self.page=0;}
self.reload_content();}).find('.oe_list_pager_state').click(function(e){e.stopPropagation();var $this=$(this);var $select=$('<select>').appendTo($this.empty()).click(function(e){e.stopPropagation();}).append('<option value="80">80</option>'+'<option value="200">200</option>'+'<option value="500">500</option>'+'<option value="2000">2000</option>'+'<option value="NaN">'+_t("Unlimited")+'</option>').change(function(){var val=parseInt($select.val(),10);self._limit=(isNaN(val)?null:val);self.page=0;self.reload_content();}).blur(function(){$(this).trigger('change');}).val(self._limit||'NaN');});}
if(!this.sidebar&&this.options.$sidebar){this.sidebar=new instance.web.Sidebar(this);this.sidebar.appendTo(this.options.$sidebar);this.sidebar.add_items('other',_.compact([{label:_t("Export"),callback:this.on_sidebar_export},self.is_action_enabled('delete')&&{label:_t('Delete'),callback:this.do_delete_selected}]));this.sidebar.add_toolbar(this.fields_view.toolbar);this.sidebar.$el.hide();}
var default_order=this.fields_view.arch.attrs.default_order,unsorted=!this.dataset._sort.length;if(unsorted&&default_order&&!this.grouped){this.dataset.set_sort(default_order.split(','));}
if(this.dataset._sort.length){if(this.dataset._sort[0].indexOf('-')==-1){this.$el.find('th[data-id='+this.dataset._sort[0]+']').addClass("sortdown");}else{this.$el.find('th[data-id='+this.dataset._sort[0].split('-')[1]+']').addClass("sortup");}}
this.trigger('list_view_loaded',data,this.grouped);},sort_by_column:function(e){e.stopPropagation();var $column=$(e.currentTarget);var col_name=$column.data('id');var field=this.fields_view.fields[col_name];if(field&&!field.sortable){return false;}
this.dataset.sort(col_name);if($column.hasClass("sortdown")||$column.hasClass("sortup")){$column.toggleClass("sortup sortdown");}else{$column.addClass("sortdown");}
$column.siblings('.oe_sortable').removeClass("sortup sortdown");this.reload_content();},configure_pager:function(dataset){this.dataset.ids=dataset.ids;if(dataset._length){this.dataset._length=dataset._length;}
var total=dataset.size();var limit=this.limit()||total;if(total===0)
this.$pager.hide();else
this.$pager.css("display","");this.$pager.toggleClass('oe_list_pager_single_page',(total<=limit));var spager='-';if(total){var range_start=this.page*limit+1;var range_stop=range_start-1+limit;if(this.records.length){range_stop=range_start-1+this.records.length;}
if(range_stop>total){range_stop=total;}
spager=_.str.sprintf(_t("%d-%d of %d"),range_start,range_stop,total);}
this.$pager.find('.oe_list_pager_state').text(spager);},setup_columns:function(fields,grouped){var registry=instance.web.list.columns;this.columns.splice(0,this.columns.length);this.columns.push.apply(this.columns,_(this.fields_view.arch.children).map(function(field){var id=field.attrs.name;return registry.for_(id,fields[id],field);}));if(grouped){this.columns.unshift(new instance.web.list.MetaColumn('_group',_t("Group")));}
this.visible_columns=_.filter(this.columns,function(column){return column.invisible!=='1';});this.aggregate_columns=_(this.visible_columns).invoke('to_aggregate');},select_record:function(index,view){view=view||index===null||index===undefined?'form':'form';this.dataset.index=index;_.delay(_.bind(function(){this.do_switch_view(view);},this));},do_show:function(){this._super();if(this.$buttons){this.$buttons.show();}
if(this.$pager){this.$pager.show();}},do_hide:function(){if(this.sidebar){this.sidebar.$el.hide();}
if(this.$buttons){this.$buttons.hide();}
if(this.$pager){this.$pager.hide();}
this._super();},reload_view:function(grouped,context,initial){return this.load_view(context);},reload_content:synchronized(function(){var self=this;self.$el.find('.oe_list_record_selector').prop('checked',false);this.records.reset();var reloaded=$.Deferred();this.$el.find('.oe_list_content').append(this.groups.render(function(){if(self.dataset.index==null){if(self.records.length){self.dataset.index=0;}}else if(self.dataset.index>=self.records.length){self.dataset.index=self.records.length?0:null;}
self.compute_aggregates();reloaded.resolve();}));this.do_push_state({page:this.page,limit:this._limit});return reloaded.promise();}),reload:function(){return this.reload_content();},reload_record:function(record){var self=this;var fields=this.fields_view.fields;return this.dataset.read_ids([record.get('id')],_.pluck(_(this.columns).filter(function(r){return r.tag==='field';}),'name'),{check_access_rule:true}).done(function(records){var values=records[0];if(!values){self.records.remove(record);return;}
_.each(values,function(value,key){if(fields[key]&&fields[key].type==='many2many')
record.set(key+'__display',false,{silent:true});record.set(key,value,{silent:true});});record.trigger('change',record);});},do_load_state:function(state,warm){var reload=false;if(state.page&&this.page!==state.page){this.page=state.page;reload=true;}
if(state.limit){if(_.isString(state.limit)){state.limit=null;}
if(state.limit!==this._limit){this._limit=state.limit;reload=true;}}
if(reload){this.reload_content();}},do_search:function(domain,context,group_by){this.page=0;this.groups.datagroup=new DataGroup(this,this.model,domain,context,group_by);this.groups.datagroup.sort=this.dataset._sort;if(_.isEmpty(group_by)&&!context['group_by_no_leaf']){group_by=null;}
this.no_leaf=!!context['group_by_no_leaf'];this.grouped=!!group_by;return this.alive(this.load_view(context)).then(this.proxy('reload_content'));},do_delete:function(ids){if(!(ids.length&&confirm(_t("Do you really want to remove these records?")))){return;}
var self=this;return $.when(this.dataset.unlink(ids)).done(function(){_(ids).each(function(id){self.records.remove(self.records.get(id));});if(self.records.length===0&&self.dataset.size()>0){self.$pager.find('ul li:first a').trigger('click');}else if(self.dataset.size()==self.limit()){self.reload();}else{self.configure_pager(self.dataset);}
self.compute_aggregates();});},do_select:function(ids,records,deselected){if(deselected){this.$('.oe_list_record_selector').prop('checked',false);}
if(!ids.length){this.dataset.index=0;if(this.sidebar){this.sidebar.$el.hide();}
this.compute_aggregates();return;}
this.dataset.index=_(this.dataset.ids).indexOf(ids[0]);if(this.sidebar){this.options.$sidebar.show();this.sidebar.$el.show();}
this.compute_aggregates(_(records).map(function(record){return{count:1,values:record};}));},do_button_action:function(name,id,callback){this.handle_button(name,id,callback);},handle_button:function(name,id,callback){var action=_.detect(this.columns,function(field){return field.name===name;});if(!action){return;}
if('confirm'in action&&!window.confirm(action.confirm)){return;}
var c=new instance.web.CompoundContext();c.set_eval_context(_.extend({active_id:id,active_ids:[id],active_model:this.dataset.model},this.records.get(id).toContext()));if(action.context){c.add(action.context);}
action.context=c;this.do_execute_action(action,this.dataset,id,_.bind(callback,null,id));},do_activate_record:function(index,id,dataset,view){this.dataset.ids=dataset.ids;this.select_record(index,view);},do_add_record:function(){this.select_record(null);},do_delete_selected:function(){var ids=this.groups.get_selection().ids;if(ids.length){this.do_delete(this.groups.get_selection().ids);}else{this.do_warn(_t("Warning"),_t("You must select at least one record."));}},compute_aggregates:function(records){var columns=_(this.aggregate_columns).filter(function(column){return column['function'];});if(_.isEmpty(columns)){return;}
if(_.isEmpty(records)){records=this.groups.get_records();}
records=_(records).compact();var count=0,sums={};_(columns).each(function(column){switch(column['function']){case'max':sums[column.id]=-Infinity;break;case'min':sums[column.id]=Infinity;break;default:sums[column.id]=0;}});_(records).each(function(record){count+=record.count||1;_(columns).each(function(column){var field=column.id,value=record.values[field];switch(column['function']){case'sum':sums[field]+=value;break;case'avg':sums[field]+=record.count*value;break;case'min':if(sums[field]>value){sums[field]=value;}
break;case'max':if(sums[field]<value){sums[field]=value;}
break;}});});var aggregates={};_(columns).each(function(column){var field=column.id;switch(column['function']){case'avg':aggregates[field]={value:sums[field]/count};break;default:aggregates[field]={value:sums[field]};}});this.display_aggregates(aggregates);},display_aggregates:function(aggregation){var self=this;var $footer_cells=this.$el.find('.oe_list_footer');_(this.aggregate_columns).each(function(column){if(!column['function']){return;}
$footer_cells.filter(_.str.sprintf('[data-field=%s]',column.id)).html(column.format(aggregation,{process_modifiers:false}));});},get_selected_ids:function(){var ids=this.groups.get_selection().ids;return ids;},get_active_domain:function(){var self=this;if(this.$('.oe_list_record_selector').prop('checked')){var search_view=this.getParent().searchview;var search_data=search_view.build_search_data();return instance.web.pyeval.eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).then(function(results){var domain=self.dataset.domain.concat(results.domain||[]);return domain});}
else{return $.Deferred().resolve();}},pad_columns:function(count,options){options=options||{};var $first_header=this.$el.find('thead tr:first th');var colspan=$first_header.attr('colspan');if(colspan){if(!this.previous_colspan){this.previous_colspan=colspan;}
$first_header.attr('colspan',parseInt(colspan,10)+count);}
var $rows=this.$el.find('.oe_list_header_columns, tr:not(thead tr)').not(options['except']);var newcols=new Array(count+1).join('<td class="oe_list_padding"></td>');if(options.position==='before'){$rows.prepend(newcols);}else{$rows.append(newcols);}},unpad_columns:function(){this.$el.find('.oe_list_padding').remove();if(this.previous_colspan){this.$el.find('thead tr:first th').attr('colspan',this.previous_colspan);this.previous_colspan=null;}},no_result:function(){this.$el.find('.oe_view_nocontent').remove();if(this.groups.group_by||!this.options.action||!this.options.action.help){return;}
this.$el.find('table:first').hide();this.$el.prepend($('<div class="oe_view_nocontent">').html(this.options.action.help));var create_nocontent=this.$buttons;this.$el.find('.oe_view_nocontent').click(function(){create_nocontent.openerpBounce();});}});instance.web.ListView.List=instance.web.Class.extend({init:function(group,opts){var self=this;this.group=group;this.view=group.view;this.session=this.view.session;this.options=opts.options;this.columns=opts.columns;this.dataset=opts.dataset;this.records=opts.records;this.record_callbacks={'remove':function(event,record){var id=record.get('id');self.dataset.remove_ids([id]);var $row=self.$current.children('[data-id='+id+']');var index=$row.data('index');$row.remove();},'reset':function(){return self.on_records_reset();},'change':function(event,record,attribute,value,old_value){var $row;if(attribute==='id'){if(old_value){throw new Error(_.str.sprintf(_t("Setting 'id' attribute on existing record %s"),JSON.stringify(record.attributes)));}
self.dataset.add_ids([value],self.records.indexOf(record));$row=self.$current.children('[data-id=false]');}else{$row=self.$current.children('[data-id='+record.get('id')+']');}
$row.replaceWith(self.render_record(record));},'add':function(ev,records,record,index){var $new_row=$(self.render_record(record));var id=record.get('id');if(id){self.dataset.add_ids([id],index);}
if(index===0){$new_row.prependTo(self.$current);}else{var previous_record=records.at(index-1),$previous_sibling=self.$current.children('[data-id='+previous_record.get('id')+']');$new_row.insertAfter($previous_sibling);}}};_(this.record_callbacks).each(function(callback,event){this.records.bind(event,callback);},this);this.$current=$('<tbody>').delegate('input[readonly=readonly]','click',function(e){e.preventDefault();}).delegate('th.oe_list_record_selector','click',function(e){e.stopPropagation();var selection=self.get_selection();var checked=$(e.currentTarget).find('input').prop('checked');$(self).trigger('selected',[selection.ids,selection.records,!checked]);}).delegate('td.oe_list_record_delete button','click',function(e){e.stopPropagation();var $row=$(e.target).closest('tr');$(self).trigger('deleted',[[self.row_id($row)]]);}).delegate('td.oe_list_field_cell button','click',function(e){e.stopPropagation();var $target=$(e.currentTarget),field=$target.closest('td').data('field'),$row=$target.closest('tr'),record_id=self.row_id($row);if($target.attr('disabled')){return;}
$target.attr('disabled','disabled');$(self).trigger('action',[field.toString(),record_id,function(id){$target.removeAttr('disabled');return self.reload_record(self.records.get(id));}]);}).delegate('a','click',function(e){e.stopPropagation();}).delegate('tr','click',function(e){var row_id=self.row_id(e.currentTarget);if(row_id){e.stopPropagation();if(!self.dataset.select_id(row_id)){throw new Error(_t("Could not find id in dataset"));}
self.row_clicked(e);}});},row_clicked:function(e,view){$(this).trigger('row_link',[this.dataset.ids[this.dataset.index],this.dataset,view]);},render_cell:function(record,column){var value;if(column.type==='reference'){value=record.get(column.id);var ref_match;if(value&&(ref_match=/^([\w\.]+),(\d+)$/.exec(value))){var model=ref_match[1],id=parseInt(ref_match[2],10);new instance.web.DataSet(this.view,model).name_get([id]).done(function(names){if(!names.length){return;}
record.set(column.id+'__display',names[0][1]);});}}else if(column.type==='many2one'){value=record.get(column.id);if(typeof value==='number'||value instanceof Number){new instance.web.DataSet(this.view,column.relation).name_get([value]).done(function(names){if(!names.length){return;}
record.set(column.id,names[0]);});}}else if(column.type==='many2many'){value=record.get(column.id);if(value instanceof Array&&!_.isEmpty(value)&&!record.get(column.id+'__display')){var ids;if(value[0]instanceof Array){var command=value[0];if(command[0]!==6){throw new Error(_.str.sprintf(_t("Unknown m2m command %s"),command[0]));}
ids=command[2];}else{ids=value;}
new instance.web.Model(column.relation).call('name_get',[ids,this.dataset.context]).done(function(names){record.set(column.id+'__display',_(names).pluck(1).join(', '));record.set(column.id,ids);});record.set(column.id,false);}}
return column.format(record.toForm().data,{model:this.dataset.model,id:record.get('id')});},render:function(){this.$current.empty().append(QWeb.render('ListView.rows',_.extend({render_cell:function(){return self.render_cell.apply(self,arguments);}},this)));this.pad_table_to(4);},pad_table_to:function(count){if(this.records.length>=count||_(this.columns).any(function(column){return column.meta;})){return;}
var cells=[];if(this.options.selectable){cells.push('<th class="oe_list_record_selector"></td>');}
_(this.columns).each(function(column){if(column.invisible==='1'){return;}
cells.push('<td title="'+column.string+'">&nbsp;</td>');});if(this.options.deletable){cells.push('<td class="oe_list_record_delete"><button type="button" style="visibility: hidden"> </button></td>');}
cells.unshift('<tr>');cells.push('</tr>');var row=cells.join('');this.$current.children('tr:not([data-id])').remove().end().append(new Array(count-this.records.length+1).join(row));},get_selection:function(){var result={ids:[],records:[]};if(!this.options.selectable){return result;}
var records=this.records;this.$current.find('th.oe_list_record_selector input:checked').closest('tr').each(function(){var record=records.get($(this).data('id'));result.ids.push(record.get('id'));result.records.push(record.attributes);});return result;},row_id:function(row){return $(row).data('id');},on_records_reset:function(){_(this.record_callbacks).each(function(callback,event){this.records.unbind(event,callback);},this);if(!this.$current){return;}
this.$current.remove();},get_records:function(){return this.records.map(function(record){return{count:1,values:record.attributes};});},reload_record:function(record){return this.view.reload_record(record);},render_record:function(record){var self=this;var index=this.records.indexOf(record);return QWeb.render('ListView.row',{columns:this.columns,options:this.options,record:record,row_parity:(index%2===0)?'even':'odd',view:this.view,render_cell:function(){return self.render_cell.apply(self,arguments);}});}});instance.web.ListView.Groups=instance.web.Class.extend({passthrough_events:'action deleted row_link',init:function(view,options){options=options||{};this.view=view;this.records=options.records||view.records;this.options=options.options||view.options;this.columns=options.columns||view.columns;this.datagroup=null;this.$row=null;this.children={};this.page=0;var self=this;this.records.bind('reset',function(){return self.on_records_reset();});},make_fragment:function(){return document.createDocumentFragment();},point_insertion:function(row){var $row=$(row);var red_letter_tboday=$row.closest('tbody')[0];var $next_siblings=$row.nextAll();if($next_siblings.length){var $root_kanal=$('<tbody>').insertAfter(red_letter_tboday);$root_kanal.append($next_siblings);this.elements.splice(_.indexOf(this.elements,red_letter_tboday),0,$root_kanal[0]);}
return red_letter_tboday;},make_paginator:function(){var self=this;var $prev=$('<button type="button" data-pager-action="previous">&lt;</button>').click(function(e){e.stopPropagation();self.page-=1;self.$row.closest('tbody').next().replaceWith(self.render());});var $next=$('<button type="button" data-pager-action="next">&gt;</button>').click(function(e){e.stopPropagation();self.page+=1;self.$row.closest('tbody').next().replaceWith(self.render());});this.$row.children().last().addClass('oe_list_group_pagination').append($prev).append('<span class="oe_list_pager_state"></span>').append($next);},open:function(point_insertion){this.render().insertAfter(point_insertion);var no_subgroups=_(this.datagroup.group_by).isEmpty(),records_terminated=!this.datagroup.context['group_by_no_leaf'];if(no_subgroups&&records_terminated){this.make_paginator();}},close:function(){this.$row.children().last().find('button').remove();this.$row.children().last().find('span').remove();this.records.reset();},indent:function($node,level){return $('<span>').css({'float':'left','white-space':'pre'}).text(new Array(level).join('   ')).prependTo($node);},render_groups:function(datagroups){var self=this;var placeholder=this.make_fragment();_(datagroups).each(function(group){if(self.children[group.value]){self.records.proxy(group.value).reset();delete self.children[group.value];}
var child=self.children[group.value]=new(self.view.options.GroupsType)(self.view,{records:self.records.proxy(group.value),options:self.options,columns:self.columns});self.bind_child_events(child);child.datagroup=group;var $row=child.$row=$('<tr class="oe_group_header">');if(group.openable&&group.length){$row.click(function(e){if(!$row.data('open')){$row.data('open',true).find('span.ui-icon').removeClass('ui-icon-triangle-1-e').addClass('ui-icon-triangle-1-s');child.open(self.point_insertion(e.currentTarget));}else{$row.removeData('open').find('span.ui-icon').removeClass('ui-icon-triangle-1-s').addClass('ui-icon-triangle-1-e');child.close();var selection=self.get_selection();$(self).trigger('selected',[selection.ids,this.records]);}});}
placeholder.appendChild($row[0]);var $group_column=$('<th class="oe_list_group_name">').appendTo($row);if(group.grouped_on){var row_data={};row_data[group.grouped_on]=group;var group_label=_t("Undefined");var group_column=_(self.columns).detect(function(column){return column.id===group.grouped_on;});if(group_column){try{group_label=group_column.format(row_data,{value_if_empty:_t("Undefined"),process_modifiers:false});}catch(e){group_label=_.str.escapeHTML(row_data[group_column.id].value);}}else{group_label=group.value;if(group_label instanceof Array){group_label=group_label[1];}
if(group_label===false){group_label=_t('Undefined');}
group_label=_.str.escapeHTML(group_label);}
$group_column.html(_.str.sprintf(_t("%s (%d)"),group_label,group.length));if(group.length&&group.openable){$group_column.prepend('<span class="ui-icon ui-icon-triangle-1-e" style="float: left;">');}else{$group_column.prepend('<span class="ui-icon" style="float: left; background-position: 150px 150px">');}}
self.indent($group_column,group.level);if(self.options.selectable){$row.append('<td>');}
_(self.columns).chain().filter(function(column){return column.invisible!=='1';}).each(function(column){if(column.meta){}else if(column.id in group.aggregates){var r={};r[column.id]={value:group.aggregates[column.id]};$('<td class="oe_number">').html(column.format(r,{process_modifiers:false})).appendTo($row);}else{$row.append('<td>');}});if(self.options.deletable){$row.append('<td class="oe_list_group_pagination">');}});return placeholder;},bind_child_events:function(child){var $this=$(this),self=this;$(child).bind('selected',function(e,_0,_1,deselected){var selection=self.get_selection();$this.trigger(e,[selection.ids,selection.records,deselected]);}).bind(this.passthrough_events,function(e){var args=Array.prototype.slice.call(arguments,1);$this.trigger.call($this,e,args);});},render_dataset:function(dataset){var self=this,list=new(this.view.options.ListType)(this,{options:this.options,columns:this.columns,dataset:dataset,records:this.records});this.bind_child_events(list);var view=this.view,limit=view.limit(),page=this.datagroup.openable?this.page:view.page;var fields=_.pluck(_.select(this.columns,function(x){return x.tag=="field";}),'name');var options={offset:page*limit,limit:limit,context:{bin_size:true}};return $.async_when().then(function(){return dataset.read_slice(fields,options).then(function(records){if(self.records.length){self.records.reset(null,{silent:true});}
if(!self.datagroup.openable){view.configure_pager(dataset);}else{if(dataset.size()==records.length){self.$row.find('td.oe_list_group_pagination').find('button').remove();self.$row.find('td.oe_list_group_pagination').find('span').remove();}else{var pages=Math.ceil(dataset.size()/limit);self.$row.find('.oe_list_pager_state').text(_.str.sprintf(_t("%(page)d/%(page_count)d"),{page:page+1,page_count:pages})).end().find('button[data-pager-action=previous]').css('visibility',page===0?'hidden':'').end().find('button[data-pager-action=next]').css('visibility',page===pages-1?'hidden':'');}}
self.records.add(records,{silent:true});list.render();if(_.isEmpty(records)){view.no_result();}
return list;});});},setup_resequence_rows:function(list,dataset){if((dataset.sort&&dataset.sort()&&dataset.sort()!=='sequence'&&dataset.sort()!=='sequence ASC')||!_(this.columns).any(function(column){return column.widget==='handle'||column.name==='sequence';})){return;}
var sequence_field=_(this.columns).find(function(c){return c.widget==='handle';});var seqname=sequence_field?sequence_field.name:'sequence';list.$current.sortable({axis:'y',items:'> tr[data-id]',helper:'clone'});if(sequence_field){list.$current.sortable('option','handle','.oe_list_field_handle');}
list.$current.sortable('option',{start:function(e,ui){ui.placeholder.height(ui.item.height());},stop:function(event,ui){var to_move=list.records.get(ui.item.data('id')),target_id=ui.item.prev().data('id'),from_index=list.records.indexOf(to_move),target=list.records.get(target_id);if(list.records.at(from_index-1)==target){return;}
list.records.remove(to_move);var to=target_id?list.records.indexOf(target)+1:0;list.records.add(to_move,{at:to});var record,index=to,seq=to?list.records.at(to-1).get(seqname):0;var fct=function(dataset,id,seq){$.async_when().done(function(){var attrs={};attrs[seqname]=seq;dataset.write(id,attrs);});};while(++seq,(record=list.records.at(index++))){fct(dataset,record.get('id'),seq);record.set(seqname,seq);}}});},render:function(post_render){var self=this;var $el=$('<tbody>');this.elements=[$el[0]];this.datagroup.list(_(this.view.visible_columns).chain().filter(function(column){return column.tag==='field';}).pluck('name').value(),function(groups){self.view.$pager.find('.oe_pager_group').hide();self.view.$pager.find('.oe_list_pager_state').text(self.view._limit?self.view._limit:'∞');$el[0].appendChild(self.render_groups(groups));if(post_render){post_render();}},function(dataset){self.render_dataset(dataset).then(function(list){self.children[null]=list;self.elements=[list.$current.replaceAll($el)[0]];self.setup_resequence_rows(list,dataset);}).always(function(){if(post_render){post_render();}});});return $el;},get_selection:function(){var ids=[],records=[];_(this.children).each(function(child){var selection=child.get_selection();ids.push.apply(ids,selection.ids);records.push.apply(records,selection.records);});return{ids:ids,records:records};},on_records_reset:function(){this.children={};$(this.elements).remove();},get_records:function(){if(_(this.children).isEmpty()){if(!this.datagroup.length){return;}
return{count:this.datagroup.length,values:this.datagroup.aggregates};}
return _(this.children).chain().map(function(child){return child.get_records();}).flatten().value();}});function synchronized(fn){var fn_mutex=new $.Mutex();return function(){var obj=this;var args=_.toArray(arguments);return fn_mutex.exec(function(){if(obj.isDestroyed()){return $.when();}
return fn.apply(obj,args)});};}
var DataGroup=instance.web.Class.extend({init:function(parent,model,domain,context,group_by,level){this.model=new instance.web.Model(model,context,domain);this.group_by=group_by;this.context=context;this.domain=domain;this.level=level||0;},list:function(fields,ifGroups,ifRecords){var self=this;if(!_.isEmpty(this.group_by)){fields=_.unique((fields||[]).concat(this.group_by));}
var query=this.model.query(fields).order_by(this.sort).group_by(this.group_by);$.when(query).done(function(querygroups){if(!querygroups){var ds=new instance.web.DataSetSearch(self,self.model.name,self.model.context(),self.model.domain());ds._sort=self.sort;ifRecords(ds);return;}
var child_datagroups=_(querygroups).map(function(group){var child_context=_.extend({},self.model.context(),group.model.context());var child_dg=new DataGroup(self,self.model.name,group.model.domain(),child_context,group.model._context.group_by,self.level+1);child_dg.sort=self.sort;child_dg.__context=child_context;child_dg.__domain=group.model.domain();child_dg.folded=group.get('folded');child_dg.grouped_on=group.get('grouped_on');child_dg.length=group.get('length');child_dg.value=group.get('value');child_dg.openable=group.get('has_children');child_dg.aggregates=group.get('aggregates');return child_dg;});ifGroups(child_datagroups);});}});var StaticDataGroup=DataGroup.extend({init:function(dataset){this.dataset=dataset;},list:function(fields,ifGroups,ifRecords){ifRecords(this.dataset);}});var Events={bind:function(event,handler){var calls=this['_callbacks']||(this._callbacks={});if(event in calls){calls[event].push(handler);}else{calls[event]=[handler];}
return this;},unbind:function(event,handler){var calls=this._callbacks||{};if(!(event in calls)){return this;}
if(!handler){delete calls[event];}else{var handlers=calls[event];handlers.splice(_(handlers).indexOf(handler),1);}
return this;},trigger:function(event){var calls;if(!(calls=this._callbacks)){return this;}
var callbacks=(calls[event]||[]).concat(calls[null]||[]);for(var i=0,length=callbacks.length;i<length;++i){callbacks[i].apply(this,arguments);}
return this;}};var Record=instance.web.Class.extend({init:function(data){this.attributes=data||{};},get:function(key){return this.attributes[key];},set:function(key,value,options){options=options||{};var old_value=this.attributes[key];if(old_value===value){return this;}
this.attributes[key]=value;if(!options.silent){this.trigger('change:'+key,this,value,old_value);this.trigger('change',this,key,value,old_value);}
return this;},toForm:function(){var form_data={},attrs=this.attributes;for(var k in attrs){form_data[k]={value:attrs[k]};}
return{data:form_data};},toContext:function(){var output={},attrs=this.attributes;for(var k in attrs){var val=attrs[k];if(typeof val!=='object'){output[k]=val;}else if(val instanceof Array){output[k]=val[0];}else{throw new Error(_.str.sprintf(_t("Can't convert value %s to context"),val));}}
return output;}});Record.include(Events);var Collection=instance.web.Class.extend({init:function(records,options){options=options||{};_.bindAll(this,'_onRecordEvent');this.length=0;this.records=[];this._byId={};this._proxies={};this._key=options.key;this._parent=options.parent;if(records){this.add(records);}},add:function(record,options){options=options||{};var records=record instanceof Array?record:[record];for(var i=0,length=records.length;i<length;++i){var instance_=(records[i]instanceof Record)?records[i]:new Record(records[i]);instance_.bind(null,this._onRecordEvent);this._byId[instance_.get('id')]=instance_;if(options.at===undefined||options.at===null){this.records.push(instance_);if(!options.silent){this.trigger('add',this,instance_,this.records.length-1);}}else{var insertion_index=options.at+i;this.records.splice(insertion_index,0,instance_);if(!options.silent){this.trigger('add',this,instance_,insertion_index);}}
this.length++;}
return this;},at:function(index,group){if(group){var groups=group.split('.');return this._proxies[groups[0]].at(index,groups.join('.'));}
return this.records[index];},get:function(id){if(!_(this._proxies).isEmpty()){var record=null;_(this._proxies).detect(function(proxy){record=proxy.get(id);return record;});return record;}
return this._byId[id];},proxy:function(section){this._proxies[section]=new Collection(null,{parent:this,key:section}).bind(null,this._onRecordEvent);return this._proxies[section];},reset:function(records,options){options=options||{};_(this._proxies).each(function(proxy){proxy.reset();});this._proxies={};_(this.records).invoke('unbind',null,this._onRecordEvent);this.length=0;this.records=[];this._byId={};if(records){this.add(records);}
if(!options.silent){this.trigger('reset',this);}
return this;},remove:function(record){var index=this.indexOf(record);if(index===-1){_(this._proxies).each(function(proxy){proxy.remove(record);});return this;}
record.unbind(null,this._onRecordEvent);this.records.splice(index,1);delete this._byId[record.get('id')];this.length--;this.trigger('remove',record,this);return this;},_onRecordEvent:function(event){switch(event){case'reset':return;case'change:id':var record=arguments[1];var new_value=arguments[2];var old_value=arguments[3];if(this._byId[old_value]===record){delete this._byId[old_value];this._byId[new_value]=record;}
break;}
this.trigger.apply(this,arguments);},find:function(callback){var record;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((record=this._proxies[section].find(callback))){return record;}}
for(var i=0;i<this.length;++i){record=this.records[i];if(callback(record)){return record;}}},each:function(callback){for(var section in this._proxies){if(this._proxies.hasOwnProperty(section)){this._proxies[section].each(callback);}}
for(var i=0;i<this.length;++i){callback(this.records[i]);}},map:function(callback){var results=[];this.each(function(record){results.push(callback(record));});return results;},pluck:function(fieldname){return this.map(function(record){return record.get(fieldname);});},indexOf:function(record){return _(this.records).indexOf(record);},succ:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].succ(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index+1;if(options.wraparound&&(next_index===this.length)){return this.at(0);}
return this.at(next_index);},pred:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].pred(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index-1;if(options.wraparound&&(next_index===-1)){return this.at(this.length-1);}
return this.at(next_index);}});Collection.include(Events);instance.web.list={Events:Events,Record:Record,Collection:Collection};instance.web.list.columns=new instance.web.Registry({'field':'instance.web.list.Column','field.boolean':'instance.web.list.Boolean','field.binary':'instance.web.list.Binary','field.char':'instance.web.list.Char','field.progressbar':'instance.web.list.ProgressBar','field.handle':'instance.web.list.Handle','button':'instance.web.list.Button','field.many2onebutton':'instance.web.list.Many2OneButton','field.reference':'instance.web.list.Reference','field.many2many':'instance.web.list.Many2Many'});instance.web.list.columns.for_=function(id,field,node){var description=_.extend({tag:node.tag},field,node.attrs);var tag=description.tag;var Type=this.get_any([tag+'.'+description.widget,tag+'.'+description.type,tag]);return new Type(id,node.tag,description);};instance.web.list.Column=instance.web.Class.extend({init:function(id,tag,attrs){_.extend(attrs,{id:id,tag:tag});this.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};delete attrs.modifiers;_.extend(this,attrs);if(this.modifiers['tree_invisible']){this.invisible='1';}else{delete this.invisible;}},modifiers_for:function(fields){var out={};var domain_computer=instance.web.form.compute_domain;for(var attr in this.modifiers){if(!this.modifiers.hasOwnProperty(attr)){continue;}
var modifier=this.modifiers[attr];out[attr]=_.isBoolean(modifier)?modifier:domain_computer(modifier,fields);}
return out;},to_aggregate:function(){if(this.type!=='integer'&&this.type!=='float'){return{};}
var aggregation_func=this['group_operator']||'sum';if(!(aggregation_func in this)){return{};}
var C=function(fn,label){this['function']=fn;this.label=label;};C.prototype=this;return new C(aggregation_func,this[aggregation_func]);},format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
if(!row_data[this.id]){return options.value_if_empty===undefined?'':options.value_if_empty;}
return this._format(row_data,options);},_format:function(row_data,options){return _.escape(instance.web.format_value(row_data[this.id].value,this,options.value_if_empty));}});instance.web.list.MetaColumn=instance.web.list.Column.extend({meta:true,init:function(id,string){this._super(id,'',{string:string});}});instance.web.list.Button=instance.web.list.Column.extend({format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
var template=this.icon&&'ListView.row.button'||'ListView.row.text_button';return QWeb.render(template,{widget:this,prefix:instance.session.prefix,disabled:attrs.readonly||isNaN(row_data.id.value)||instance.web.BufferedDataSet.virtual_id_regex.test(row_data.id.value)});}});instance.web.list.Boolean=instance.web.list.Column.extend({_format:function(row_data,options){return _.str.sprintf('<input type="checkbox" %s readonly="readonly"/>',row_data[this.id].value?'checked="checked"':'');}});instance.web.list.Binary=instance.web.list.Column.extend({_format:function(row_data,options){var text=_t("Download");var value=row_data[this.id].value;if(!value){return options.value_if_empty||'';}
var download_url;if(value.substr(0,10).indexOf(' ')==-1){download_url="data:application/octet-stream;base64,"+value;}else{download_url=instance.session.url('/web/binary/saveas',{model:options.model,field:this.id,id:options.id});if(this.filename){download_url+='&filename_field='+this.filename;}}
if(this.filename&&row_data[this.filename]){text=_.str.sprintf(_t("Download \"%s\""),instance.web.format_value(row_data[this.filename].value,{type:'char'}));}
return _.template('<a href="<%-href%>"><%-text%></a> (<%-size%>)',{text:text,href:download_url,size:instance.web.binary_to_binsize(value),});}});instance.web.list.Char=instance.web.list.Column.extend({replacement:'*',_format:function(row_data,options){var value=row_data[this.id].value;if(value&&this.password==='True'){return value.replace(/[\s\S]/g,_.escape(this.replacement));}
return this._super(row_data,options);}});instance.web.list.ProgressBar=instance.web.list.Column.extend({_format:function(row_data,options){return _.template('<progress value="<%-value%>" max="100"><%-value%>%</progress>',{value:_.str.sprintf("%.0f",row_data[this.id].value||0)});}});instance.web.list.Handle=instance.web.list.Column.extend({init:function(){this._super.apply(this,arguments);this.modifiers.readonly=true;},_format:function(row_data,options){return'<div class="oe_list_handle">';}});instance.web.list.Many2OneButton=instance.web.list.Column.extend({_format:function(row_data,options){this.has_value=!!row_data[this.id].value;this.icon=this.has_value?'gtk-yes':'gtk-no';this.string=this.has_value?_t('View'):_t('Create');return QWeb.render('Many2OneButton.cell',{'widget':this,'prefix':instance.session.prefix,});},});instance.web.list.Many2Many=instance.web.list.Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){row_data[this.id]=row_data[this.id+'__display'];}
return this._super(row_data,options);}});instance.web.list.Reference=instance.web.list.Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){if(!!row_data[this.id+'__display']){row_data[this.id]=row_data[this.id+'__display'];}else{row_data[this.id]={'value':''};}}
return this._super(row_data,options);}});})();;

/* /web/static/src/js/view_form.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.form={};instance.web.form.FieldManagerMixin={get_field_desc:function(field_name){},get_field_value:function(field_name){},set_values:function(values){},compute_domain:function(expression){},build_eval_context:function(){},};instance.web.views.add('form','instance.web.FormView');instance.web.FormView=instance.web.View.extend(instance.web.form.FieldManagerMixin,{searchable:false,template:"FormView",display_name:_lt('Form'),view_type:"form",init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.ViewManager=parent;this.set_default_options(options);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id||false;this.fields_view={};this.fields={};this.fields_order=[];this.datarecord={};this._onchange_specs={};this.onchanges_mutex=new $.Mutex();this.default_focus_field=null;this.default_focus_button=null;this.fields_registry=instance.web.form.widgets;this.tags_registry=instance.web.form.tags;this.widgets_registry=instance.web.form.custom_widgets;this.has_been_loaded=$.Deferred();this.translatable_fields=[];_.defaults(this.options,{"not_interactible_on_create":false,"initial_mode":"view","disable_autofocus":false,"footer_to_buttons":false,});this.is_initialized=$.Deferred();this.mutating_mutex=new $.Mutex();this.save_list=[];this.render_value_defs=[];this.reload_mutex=new $.Mutex();this.__clicked_inside=false;this.__blur_timeout=null;this.rendering_engine=new instance.web.form.FormRenderingEngine(this);self.set({actual_mode:self.options.initial_mode});this.has_been_loaded.done(function(){self._build_onchange_specs();self.on("change:actual_mode",self,self.check_actual_mode);self.check_actual_mode();self.on("change:actual_mode",self,self.init_pager);self.init_pager();});self.on("load_record",self,self.load_record);instance.web.bus.on('clear_uncommitted_changes',this,function(e){if(!this.can_be_discarded()){e.preventDefault();}});},view_loading:function(r){return this.load_form(r);},destroy:function(){_.each(this.get_widgets(),function(w){w.off('focused blurred');w.destroy();});if(this.$el){this.$el.off('.formBlur');}
this._super();},load_form:function(data){var self=this;if(!data){throw new Error(_t("No data provided."));}
if(this.arch){throw"Form view does not support multiple calls to load_form";}
this.fields_order=[];this.fields_view=data;this.rendering_engine.set_fields_registry(this.fields_registry);this.rendering_engine.set_tags_registry(this.tags_registry);this.rendering_engine.set_widgets_registry(this.widgets_registry);this.rendering_engine.set_fields_view(data);var $dest=this.$el.hasClass("oe_form_container")?this.$el:this.$el.find('.oe_form_container');this.rendering_engine.render_to($dest);this.$el.on('mousedown.formBlur',function(){self.__clicked_inside=true;});this.$buttons=$(QWeb.render("FormView.buttons",{'widget':self}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}else{this.$el.find('.oe_form_buttons').replaceWith(this.$buttons);}
this.$buttons.on('click','.oe_form_button_create',this.guard_active(this.on_button_create));this.$buttons.on('click','.oe_form_button_edit',this.guard_active(this.on_button_edit));this.$buttons.on('click','.oe_form_button_save',this.guard_active(this.on_button_save));this.$buttons.on('click','.oe_form_button_cancel',this.guard_active(this.on_button_cancel));if(this.options.footer_to_buttons){this.$el.find('footer').appendTo(this.$buttons);}
this.$sidebar=this.options.$sidebar||this.$el.find('.oe_form_sidebar');if(!this.sidebar&&this.options.$sidebar){this.sidebar=new instance.web.Sidebar(this);this.sidebar.appendTo(this.$sidebar);if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
this.sidebar.add_items('other',_.compact([self.is_action_enabled('delete')&&{label:_t('Delete'),callback:self.on_button_delete},self.is_action_enabled('create')&&{label:_t('Duplicate'),callback:self.on_button_duplicate}]));}
this.has_been_loaded.resolve();this.$el.find(".oe_form_group_row,.oe_form_field,label,h1,.oe_title,.oe_notebook_page, .oe_list_content").on('click',function(e){if(self.get("actual_mode")=="view"){var $button=self.options.$buttons.find(".oe_form_button_edit");$button.openerpBounce();e.stopPropagation();instance.web.bus.trigger('click',e);}});this.$el.find(".oe_form_field_status:not(.oe_form_status_clickable)").on('click',function(e){if((self.get("actual_mode")=="view")){var $button=self.$el.find(".oe_highlight:not(.oe_form_invisible)").css({'float':'left','clear':'none'});$button.openerpBounce();e.stopPropagation();}});this.trigger('form_view_loaded',data);return $.when();},widgetFocused:function(){this.__clicked_inside=false;if(this.__blur_timeout){clearTimeout(this.__blur_timeout);this.__blur_timeout=null;}},widgetBlurred:function(){if(this.__clicked_inside){this.__clicked_inside=false;return;}
var self=this;this.widgetFocused();this.__blur_timeout=setTimeout(function(){self.trigger('blurred');},0);},do_load_state:function(state,warm){if(state.id&&this.datarecord.id!=state.id){if(this.dataset.get_id_index(state.id)===null){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);this.do_show();}},do_show:function(options){var self=this;options=options||{};if(this.sidebar){this.sidebar.$el.show();}
if(this.$buttons){this.$buttons.show();}
this.$el.show().css({opacity:'0',filter:'alpha(opacity = 0)'});this.$el.add(this.$buttons).removeClass('oe_form_dirty');var shown=this.has_been_loaded;if(options.reload!==false){shown=shown.then(function(){if(self.dataset.index===null){return self.on_button_new();}
var fields=_.keys(self.fields_view.fields);fields.push('display_name');return self.dataset.read_index(fields,{context:{'bin_size':true,'future_display_name':true}}).then(function(r){self.trigger('load_record',r);});});}
return shown.then(function(){self._actualize_mode(options.mode||self.options.initial_mode);self.$el.css({opacity:'1',filter:'alpha(opacity = 100)'});});},do_hide:function(){if(this.sidebar){this.sidebar.$el.hide();}
if(this.$buttons){this.$buttons.hide();}
if(this.$pager){this.$pager.hide();}
this._super();},load_record:function(record){var self=this,set_values=[];if(!record){this.set({'title':undefined});this.do_warn(_t("Form"),_t("The record could not be found in the database."),true);return $.Deferred().reject();}
this.datarecord=record;this._actualize_mode();this.set({'title':record.id?record.display_name:_t("New")});_(this.fields).each(function(field,f){field._dirty_flag=false;field._inhibit_on_change_flag=true;var result=field.set_value(self.datarecord[f]||false);field._inhibit_on_change_flag=false;set_values.push(result);});return $.when.apply(null,set_values).then(function(){if(!record.id){self.do_onchange(null);}
self.on_form_changed();self.rendering_engine.init_fields();self.is_initialized.resolve();self.do_update_pager(record.id===null||record.id===undefined);if(self.sidebar){self.sidebar.do_attachement_update(self.dataset,self.datarecord.id);}
if(record.id){self.do_push_state({id:record.id});}else{self.do_push_state({});}
self.$el.add(self.$buttons).removeClass('oe_form_dirty');self.autofocus();});},load_defaults:function(){var self=this;var keys=_.keys(this.fields_view.fields);if(keys.length){return this.dataset.default_get(keys).then(function(r){self.trigger('load_record',r);});}
return self.trigger('load_record',{});},on_form_changed:function(){this.trigger("view_content_has_changed");},do_notify_change:function(){this.$el.add(this.$buttons).addClass('oe_form_dirty');},execute_pager_action:function(action){if(this.can_be_discarded()){switch(action){case'first':this.dataset.index=0;break;case'previous':this.dataset.previous();break;case'next':this.dataset.next();break;case'last':this.dataset.index=this.dataset.ids.length-1;break;}
var def=this.reload();this.trigger('pager_action_executed');return def;}
return $.when();},init_pager:function(){var self=this;if(this.$pager)
this.$pager.remove();if(this.get("actual_mode")==="create")
return;this.$pager=$(QWeb.render("FormView.pager",{'widget':self})).hide();if(this.options.$pager){this.$pager.appendTo(this.options.$pager);}else{this.$el.find('.oe_form_pager').replaceWith(this.$pager);}
this.$pager.on('click','a[data-pager-action]',function(){var $el=$(this);if($el.attr("disabled"))
return;var action=$el.data('pager-action');var def=$.when(self.execute_pager_action(action));$el.attr("disabled");def.always(function(){$el.removeAttr("disabled");});});this.do_update_pager();},do_update_pager:function(hide_index){this.$pager.toggle(this.dataset.ids.length>1);if(hide_index){$(".oe_form_pager_state",this.$pager).html("");}else{$(".oe_form_pager_state",this.$pager).html(_.str.sprintf(_t("%d / %d"),this.dataset.index+1,this.dataset.ids.length));}},_build_onchange_specs:function(){var self=this;var find=function(field_name,root){var fields=[root];while(fields.length){var node=fields.pop();if(!node){continue;}
if(node.tag==='field'&&node.attrs.name===field_name){return node.attrs.on_change||"";}
fields=_.union(fields,node.children);}
return"";};self._onchange_fields=[];self._onchange_specs={};_.each(this.fields,function(field,name){self._onchange_fields.push(name);self._onchange_specs[name]=find(name,field.node);_.each(field.field.views,function(view){_.each(view.fields,function(_,subname){self._onchange_specs[name+'.'+subname]=find(subname,view.arch);});});});},_get_onchange_values:function(){var field_values=this.get_fields_values();if(field_values.id.toString().match(instance.web.BufferedDataSet.virtual_id_regex)){delete field_values.id;}
if(this.dataset.parent_view){var parent_view=this.dataset.parent_view;var child_name=this.dataset.child_name;var parent_name=parent_view.get_field_desc(child_name).relation_field;if(parent_name){var parent_values=parent_view.get_fields_values();delete parent_values[child_name];field_values[parent_name]=parent_values;}}
return field_values;},do_onchange:function(widget){var self=this;var onchange_specs=self._onchange_specs;try{var def=$.when({});var change_spec=widget?onchange_specs[widget.name]:null;if(!widget||(!_.isEmpty(change_spec)&&change_spec!=="0")){var ids=[],trigger_field_name=widget?widget.name:self._onchange_fields,values=self._get_onchange_values(),context=new instance.web.CompoundContext(self.dataset.get_context());if(widget&&widget.build_context()){context.add(widget.build_context());}
if(self.dataset.parent_view){var parent_name=self.dataset.parent_view.get_field_desc(self.dataset.child_name).relation_field;context.add({field_parent:parent_name});}
if(self.datarecord.id&&!instance.web.BufferedDataSet.virtual_id_regex.test(self.datarecord.id)){ids.push(self.datarecord.id);}
def=self.alive(new instance.web.Model(self.dataset.model).call("onchange",[ids,values,trigger_field_name,onchange_specs,context]));}
this.onchanges_mutex.exec(function(){return def.then(function(response){var fields={};if(widget){fields[widget.name]=widget.field;}
else{fields=self.fields_view.fields;}
var defs=[];_.each(fields,function(field,fieldname){if(field&&field.change_default){var value_;if(response.value&&(fieldname in response.value)){value_=response.value[fieldname];}else{value_=self.fields[fieldname].get_value();}
var condition=fieldname+'='+value_;if(value_){defs.push(self.alive(new instance.web.Model('ir.values').call('get_defaults',[self.model,condition])).then(function(results){if(!results.length){return response;}
if(!response.value){response.value={};}
for(var i=0;i<results.length;++i){var triplet=results[i];response.value[triplet[1]]=triplet[2];}
return response;}));}}});return _.isEmpty(defs)?response:$.when.apply(null,defs);}).then(function(response){return self.on_processed_onchange(response);});});return this.onchanges_mutex.def;}catch(e){console.error(e);instance.webclient.crashmanager.show_message(e);return $.Deferred().reject();}},on_processed_onchange:function(result){try{var fields=this.fields;_(result.domain).each(function(domain,fieldname){var field=fields[fieldname];if(!field){return;}
field.node.attrs.domain=domain;});if(!_.isEmpty(result.value)){this._internal_set_values(result.value);}
if(!_.isEmpty(result.warning)){new instance.web.Dialog(this,{size:'medium',title:result.warning.title,buttons:[{text:_t("Ok"),click:function(){this.parents('.modal').modal('hide');}}]},QWeb.render("CrashManager.warning",result.warning)).open();}
return $.Deferred().resolve();}catch(e){console.error(e);instance.webclient.crashmanager.show_message(e);return $.Deferred().reject();}},_process_operations:function(){var self=this;return this.mutating_mutex.exec(function(){function iterate(){var mutex=new $.Mutex();_.each(self.fields,function(field){self.onchanges_mutex.def.then(function(){mutex.exec(function(){return field.commit_value();});});});var args=_.toArray(arguments);return $.when.apply(null,[mutex.def,self.onchanges_mutex.def]).then(function(){var save_obj=self.save_list.pop();if(save_obj){return self._process_save(save_obj).then(function(){save_obj.ret=_.toArray(arguments);return iterate();},function(){save_obj.error=true;});}
return $.when();}).fail(function(){self.save_list.pop();return $.when();});}
return iterate();});},_internal_set_values:function(values){for(var f in values){if(!values.hasOwnProperty(f)){continue;}
var field=this.fields[f];if(field){var value_=values[f];if(field.get_value()!=value_){field._inhibit_on_change_flag=true;field.set_value(value_);field._inhibit_on_change_flag=false;field._dirty_flag=true;}}}
this.on_form_changed();},set_values:function(values){var self=this;return this.mutating_mutex.exec(function(){self._internal_set_values(values);});},to_view_mode:function(){this._actualize_mode("view");},to_edit_mode:function(){this.onchanges_mutex=new $.Mutex();this._actualize_mode("edit");},_actualize_mode:function(switch_to){var mode=switch_to||this.get("actual_mode");if(!this.datarecord.id){mode="create";}else if(mode==="create"){mode="edit";}
this.render_value_defs=[];this.set({actual_mode:mode});},check_actual_mode:function(source,options){var self=this;if(this.get("actual_mode")==="view"){self.$el.removeClass('oe_form_editable').addClass('oe_form_readonly');self.$buttons.find('.oe_form_buttons_edit').hide();self.$buttons.find('.oe_form_buttons_view').show();self.$sidebar.show();}else{self.$el.removeClass('oe_form_readonly').addClass('oe_form_editable');self.$buttons.find('.oe_form_buttons_edit').show();self.$buttons.find('.oe_form_buttons_view').hide();self.$sidebar.hide();this.autofocus();}},autofocus:function(){if(this.get("actual_mode")!=="view"&&!this.options.disable_autofocus){var fields_order=this.fields_order.slice(0);if(this.default_focus_field){fields_order.unshift(this.default_focus_field.name);}
for(var i=0;i<fields_order.length;i+=1){var field=this.fields[fields_order[i]];if(!field.get('effective_invisible')&&!field.get('effective_readonly')&&field.$label){if(field.focus()!==false){break;}}}}},on_button_save:function(e){var self=this;$(e.target).attr("disabled",true);return this.save().done(function(result){self.trigger("save",result);self.reload().then(function(){self.to_view_mode();var menu=instance.webclient.menu;if(menu){menu.do_reload_needaction();}});}).always(function(){$(e.target).attr("disabled",false);});},on_button_cancel:function(event){var self=this;if(this.can_be_discarded()){if(this.get('actual_mode')==='create'){this.trigger('history_back');}else{this.to_view_mode();$.when.apply(null,this.render_value_defs).then(function(){self.trigger('load_record',self.datarecord);});}}
this.trigger('on_button_cancel');return false;},on_button_new:function(){var self=this;this.to_edit_mode();return $.when(this.has_been_loaded).then(function(){if(self.can_be_discarded()){return self.load_defaults();}});},on_button_edit:function(){return this.to_edit_mode();},on_button_create:function(){this.dataset.index=null;this.do_show();},on_button_duplicate:function(){var self=this;return this.has_been_loaded.then(function(){return self.dataset.call('copy',[self.datarecord.id,{},self.dataset.context]).then(function(new_id){self.record_created(new_id);self.to_edit_mode();});});},on_button_delete:function(){var self=this;var def=$.Deferred();this.has_been_loaded.done(function(){if(self.datarecord.id&&confirm(_t("Do you really want to delete this record?"))){self.dataset.unlink([self.datarecord.id]).done(function(){if(self.dataset.size()){self.execute_pager_action('next');}else{self.do_action('history_back');}
def.resolve();});}else{$.async_when().done(function(){def.reject();});}});return def.promise();},can_be_discarded:function(){if(this.$el.is('.oe_form_dirty')){if(!confirm(_t("Warning, the record has been modified, your changes will be discarded.\n\nAre you sure you want to leave this page ?"))){return false;}
this.$el.removeClass('oe_form_dirty');}
return true;},save:function(prepend_on_create){var self=this;var save_obj={prepend_on_create:prepend_on_create,ret:null};this.save_list.push(save_obj);return self._process_operations().then(function(){if(save_obj.error)
return $.Deferred().reject();return $.when.apply($,save_obj.ret);}).done(function(result){self.$el.removeClass('oe_form_dirty');});},_process_save:function(save_obj){var self=this;var prepend_on_create=save_obj.prepend_on_create;try{var form_invalid=false,values={},first_invalid_field=null,readonly_values={};for(var f in self.fields){if(!self.fields.hasOwnProperty(f)){continue;}
f=self.fields[f];if(!f.is_valid()){form_invalid=true;if(!first_invalid_field){first_invalid_field=f;}}else if(f.name!=='id'&&(!self.datarecord.id||f._dirty_flag)){if(!f.get("readonly")){values[f.name]=f.get_value();}else{readonly_values[f.name]=f.get_value();}}}
if(form_invalid){self.set({'display_invalid_fields':true});first_invalid_field.focus();self.on_invalid();return $.Deferred().reject();}else{self.set({'display_invalid_fields':false});var save_deferral;if(!self.datarecord.id){save_deferral=self.dataset.create(values,{readonly_fields:readonly_values}).then(function(r){return self.record_created(r,prepend_on_create);},null);}else if(_.isEmpty(values)){save_deferral=$.Deferred().resolve({}).promise();}else{save_deferral=self.dataset.write(self.datarecord.id,values,{readonly_fields:readonly_values}).then(function(r){return self.record_saved(r);},null);}
return save_deferral;}}catch(e){console.error(e);return $.Deferred().reject();}},on_invalid:function(){var warnings=_(this.fields).chain().filter(function(f){return!f.is_valid();}).map(function(f){return _.str.sprintf('<li>%s</li>',_.escape(f.string));}).value();warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},record_saved:function(r){this.trigger('record_saved',r);if(!r){return $.Deferred().reject();}
return r;},record_created:function(r,prepend_on_create){var self=this;if(!r){this.trigger('record_created',r);return $.Deferred().reject();}else{this.datarecord.id=r;if(!prepend_on_create){this.dataset.alter_ids(this.dataset.ids.concat([this.datarecord.id]));this.dataset.index=this.dataset.ids.length-1;}else{this.dataset.alter_ids([this.datarecord.id].concat(this.dataset.ids));this.dataset.index=0;}
this.do_update_pager();if(this.sidebar){this.sidebar.do_attachement_update(this.dataset,this.datarecord.id);}
return $.when(this.reload()).then(function(){self.trigger('record_created',r);return _.extend(r,{created:true});});}},on_action:function(action){console.debug('Executing action',action);},reload:function(){var self=this;return this.reload_mutex.exec(function(){if(self.dataset.index===null||self.dataset.index===undefined){self.trigger("previous_view");return $.Deferred().reject().promise();}
if(self.dataset.index<0){return $.when(self.on_button_new());}else{var fields=_.keys(self.fields_view.fields);fields.push('display_name');return self.dataset.read_index(fields,{context:{'bin_size':true,'future_display_name':true},check_access_rule:true}).then(function(r){self.trigger('load_record',r);}).fail(function(){self.do_action('history_back');});}});},get_widgets:function(){return _.filter(this.getChildren(),function(obj){return obj instanceof instance.web.form.FormWidget;});},get_fields_values:function(){var values={};var ids=this.get_selected_ids();values["id"]=ids.length>0?ids[0]:false;_.each(this.fields,function(value_,key){values[key]=value_.get_value();});return values;},get_selected_ids:function(){var id=this.dataset.ids[this.dataset.index];return id?[id]:[];},recursive_save:function(){var self=this;return $.when(this.save()).then(function(res){if(self.dataset.parent_view)
return self.dataset.parent_view.recursive_save();});},recursive_reload:function(){var self=this;var pre=$.when();if(self.dataset.parent_view)
pre=self.dataset.parent_view.recursive_reload();return pre.then(function(){return self.reload();});},is_dirty:function(){return _.any(this.fields,function(value_){return value_._dirty_flag;});},is_interactible_record:function(){var id=this.datarecord.id;if(!id){if(this.options.not_interactible_on_create)
return false;}else if(typeof(id)==="string"){if(instance.web.BufferedDataSet.virtual_id_regex.test(id))
return false;}
return true;},sidebar_eval_context:function(){return $.when(this.build_eval_context());},open_defaults_dialog:function(){var self=this;var display=function(field,value){if(!value){return value;}
if(field instanceof instance.web.form.FieldSelection){return _(field.get('values')).find(function(option){return option[0]===value;})[1];}else if(field instanceof instance.web.form.FieldMany2One){return field.get_displayed();}
return value;};var fields=_.chain(this.fields).map(function(field){var value=field.get_value();if(!value||field.get('invisible')||field.get("readonly")||field.field.type==='one2many'||field.field.type==='many2many'||field.field.type==='binary'||field.password){return false;}
return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(self.fields).filter(function(field){return field.field.change_default;}).map(function(field){var value=field.get_value();return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).value();var d=new instance.web.Dialog(this,{title:_t("Set Default"),args:{fields:fields,conditions:conditions},buttons:[{text:_t("Close"),click:function(){d.close();}},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var field_to_set=$defaults.val();if(!field_to_set){$defaults.parent().addClass('oe_form_invalid');return;}
var condition=d.$el.find('#formview_default_conditions').val(),all_users=d.$el.find('#formview_default_all').is(':checked');new instance.web.DataSet(self,'ir.values').call('set_default',[self.dataset.model,field_to_set,self.fields[field_to_set].get_value(),all_users,true,condition||false]).done(function(){d.close();});}}]});d.template='FormView.set_default';d.open();},register_field:function(field,name){this.fields[name]=field;this.fields_order.push(name);if(JSON.parse(field.node.attrs.default_focus||"0")){this.default_focus_field=field;}
field.on('focused',null,this.proxy('widgetFocused')).on('blurred',null,this.proxy('widgetBlurred'));if(this.get_field_desc(name).translate){this.translatable_fields.push(field);}
field.on('changed_value',this,function(){if(field.is_syntax_valid()){this.trigger('field_changed:'+name);}
if(field._inhibit_on_change_flag){return;}
field._dirty_flag=true;if(field.is_syntax_valid()){this.do_onchange(field);this.on_form_changed(true);this.do_notify_change();}});},get_field_desc:function(field_name){return this.fields_view.fields[field_name];},get_field_value:function(field_name){return this.fields[field_name].get_value();},compute_domain:function(expression){return instance.web.form.compute_domain(expression,this.fields);},_build_view_fields_values:function(){var a_dataset=this.dataset;var fields_values=this.get_fields_values();var active_id=a_dataset.ids[a_dataset.index];_.extend(fields_values,{active_id:active_id||false,active_ids:active_id?[active_id]:[],active_model:a_dataset.model,parent:{}});if(a_dataset.parent_view){fields_values.parent=a_dataset.parent_view.get_fields_values();}
return fields_values;},build_eval_context:function(){var a_dataset=this.dataset;return new instance.web.CompoundContext(a_dataset.get_context(),this._build_view_fields_values());},});instance.web.form.FormRenderingEngineInterface=instance.web.Class.extend({set_fields_view:function(fields_view){},set_fields_registry:function(fields_registry){},render_to:function($el){},});instance.web.form.FormRenderingEngine=instance.web.form.FormRenderingEngineInterface.extend({init:function(view){this.view=view;},set_fields_view:function(fvg){this.fvg=fvg;this.version=parseFloat(this.fvg.arch.attrs.version);if(isNaN(this.version)){this.version=7.0;}},set_tags_registry:function(tags_registry){this.tags_registry=tags_registry;},set_fields_registry:function(fields_registry){this.fields_registry=fields_registry;},set_widgets_registry:function(widgets_registry){this.widgets_registry=widgets_registry;},process_version:function(){if(this.version<7.0){this.$form.find('form:first').wrapInner('<group col="4"/>');this.$form.find('page').each(function(){if(!$(this).parents('field').length){$(this).wrapInner('<group col="4"/>');}});}},get_arch_fragment:function(){var doc=$.parseXML(instance.web.json_node_to_xml(this.fvg.arch)).documentElement;$('button',doc).each(function(){$(this).attr('data-button-type',$(this).attr('type')).attr('type','button');});$('board',doc).each(function(){$(this).attr('layout',$(this).attr('style'));});return $('<div class="oe_form"/>').append(instance.web.xml_to_str(doc));},render_to:function($target){var self=this;this.$target=$target;this.$form=this.get_arch_fragment();this.process_version();this.fields_to_init=[];this.tags_to_init=[];this.widgets_to_init=[];this.labels={};this.process(this.$form);this.$form.appendTo(this.$target);this.to_replace=[];_.each(this.fields_to_init,function($elem){var name=$elem.attr("name");if(!self.fvg.fields[name]){throw new Error(_.str.sprintf(_t("Field '%s' specified in view could not be found."),name));}
var obj=self.fields_registry.get_any([$elem.attr('widget'),self.fvg.fields[name].type]);if(!obj){throw new Error(_.str.sprintf(_t("Widget type '%s' is not implemented"),$elem.attr('widget')));}
var w=new(obj)(self.view,instance.web.xml_to_json($elem[0]));var $label=self.labels[$elem.attr("name")];if($label){w.set_input_id($label.attr("for"));}
self.alter_field(w);self.view.register_field(w,$elem.attr("name"));self.to_replace.push([w,$elem]);});_.each(this.tags_to_init,function($elem){var tag_name=$elem[0].tagName.toLowerCase();var obj=self.tags_registry.get_object(tag_name);var w=new(obj)(self.view,instance.web.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});_.each(this.widgets_to_init,function($elem){var widget_type=$elem.attr("type");var obj=self.widgets_registry.get_object(widget_type);var w=new(obj)(self.view,instance.web.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});},init_fields:function(){var defs=[];_.each(this.to_replace,function(el){defs.push(el[0].replace(el[1]));if(el[1].children().length){el[0].$el.append(el[1].children());}});this.to_replace=[];return $.when.apply($,defs);},render_element:function(template){var dicts=[].slice.call(arguments).slice(1);var dict=_.extend.apply(_,dicts);dict['classnames']=dict['class']||'';return $(QWeb.render(template,dict));},alter_field:function(field){},toggle_layout_debugging:function(){if(!this.$target.has('.oe_layout_debug_cell:first').length){this.$target.find('[title]').removeAttr('title');this.$target.find('.oe_form_group_cell').each(function(){var text='W:'+($(this).attr('width')||'')+' - C:'+$(this).attr('colspan');$(this).attr('title',text);});}
this.$target.toggleClass('oe_layout_debugging');},process:function($tag){var self=this;var tagname=$tag[0].nodeName.toLowerCase();if(this.tags_registry.contains(tagname)){this.tags_to_init.push($tag);return(tagname==='button')?this.process_button($tag):$tag;}
var fn=self['process_'+tagname];if(fn){var args=[].slice.call(arguments);args[0]=$tag;return fn.apply(self,args);}else{$tag.children().each(function(){self.process($(this));});self.handle_common_properties($tag,$tag);$tag.removeAttr("modifiers");return $tag;}},process_button:function($button){var self=this;$button.children().each(function(){self.process($(this));});return $button;},process_widget:function($widget){this.widgets_to_init.push($widget);return $widget;},process_sheet:function($sheet){var $new_sheet=this.render_element('FormRenderingSheet',$sheet.getAttributes());this.handle_common_properties($new_sheet,$sheet);var $dst=$new_sheet.find('.oe_form_sheet');$sheet.contents().appendTo($dst);$sheet.before($new_sheet).remove();this.process($new_sheet);},process_form:function($form){if($form.find('> sheet').length===0){$form.addClass('oe_form_nosheet');}
var $new_form=this.render_element('FormRenderingForm',$form.getAttributes());this.handle_common_properties($new_form,$form);$form.contents().appendTo($new_form);if($form[0]===this.$form[0]){this.$form=$new_form;}else{$form.before($new_form).remove();}
this.process($new_form);},preprocess_field:function($field){var self=this;var name=$field.attr('name'),field_colspan=parseInt($field.attr('colspan'),10),field_modifiers=JSON.parse($field.attr('modifiers')||'{}');if($field.attr('nolabel')==='1')
return;$field.attr('nolabel','1');var found=false;this.$form.find('label[for="'+name+'"]').each(function(i,el){$(el).parents().each(function(unused,tag){var name=tag.tagName.toLowerCase();if(name==="field"||name in self.tags_registry.map)
found=true;});});if(found)
return;var $label=$('<label/>').attr({'for':name,"modifiers":JSON.stringify({invisible:field_modifiers.invisible}),"string":$field.attr('string'),"help":$field.attr('help'),"class":$field.attr('class'),});$label.insertBefore($field);if(field_colspan>1){$field.attr('colspan',field_colspan-1);}
return $label;},process_field:function($field){if($field.parent().is('group')){var $label=this.preprocess_field($field);if($label){this.process($label);}}
this.fields_to_init.push($field);return $field;},process_group:function($group){var self=this;$group.children('field').each(function(){self.preprocess_field($(this));});var $new_group=this.render_element('FormRenderingGroup',$group.getAttributes());var $table;if($new_group.first().is('table.oe_form_group')){$table=$new_group;}else if($new_group.filter('table.oe_form_group').length){$table=$new_group.filter('table.oe_form_group').first();}else{$table=$new_group.find('table.oe_form_group').first();}
var $tr,$td,cols=parseInt($group.attr('col')||2,10),row_cols=cols;var children=[];$group.children().each(function(a,b,c){var $child=$(this);var colspan=parseInt($child.attr('colspan')||1,10);var tagName=$child[0].tagName.toLowerCase();var $td=$('<td/>').addClass('oe_form_group_cell').attr('colspan',colspan);var newline=tagName==='newline';if($tr&&row_cols>0&&(newline||row_cols<colspan)){$tr.addClass('oe_form_group_row_incomplete');if(newline){$tr.addClass('oe_form_group_row_newline');}}
if(newline){$tr=null;return;}
if(!$tr||row_cols<colspan){$tr=$('<tr/>').addClass('oe_form_group_row').appendTo($table);row_cols=cols;}else if(tagName==='group'){$td.addClass('oe_group_right');}
row_cols-=colspan;var field_modifiers=JSON.parse($child.attr('modifiers')||'{}');var invisible=field_modifiers.invisible;self.handle_common_properties($td,$("<dummy>").attr("modifiers",JSON.stringify({invisible:invisible})));$tr.append($td.append($child));children.push($child[0]);});if(row_cols&&$td){$td.attr('colspan',parseInt($td.attr('colspan'),10)+row_cols);}
$group.before($new_group).remove();$table.find('> tbody > tr').each(function(){var to_compute=[],row_cols=cols,total=100;$(this).children().each(function(){var $td=$(this),$child=$td.children(':first');if($child.attr('cell-class')){$td.addClass($child.attr('cell-class'));}
switch($child[0].tagName.toLowerCase()){case'separator':break;case'label':if($child.attr('for')){$td.attr('width','1%').addClass('oe_form_group_cell_label');row_cols-=$td.attr('colspan')||1;total--;}
break;default:var width=_.str.trim($child.attr('width')||''),iwidth=parseInt(width,10);if(iwidth){if(width.substr(-1)==='%'){total-=iwidth;width=iwidth+'%';}else{$td.css('min-width',width+'px');}
$td.attr('width',width);$child.removeAttr('width');row_cols-=$td.attr('colspan')||1;}else{to_compute.push($td);}}});if(row_cols){var unit=Math.floor(total/row_cols);if(!$(this).is('.oe_form_group_row_incomplete')){_.each(to_compute,function($td,i){var width=parseInt($td.attr('colspan'),10)*unit;$td.attr('width',width+'%');total-=width;});}}});_.each(children,function(el){self.process($(el));});this.handle_common_properties($new_group,$group);return $new_group;},process_notebook:function($notebook){var self=this;var pages=[];$notebook.find('> page').each(function(){var $page=$(this);var page_attrs=$page.getAttributes();page_attrs.id=_.uniqueId('notebook_page_');var $new_page=self.render_element('FormRenderingNotebookPage',page_attrs);$page.contents().appendTo($new_page);$page.before($new_page).remove();var ic=self.handle_common_properties($new_page,$page).invisibility_changer;page_attrs.__page=$new_page;page_attrs.__ic=ic;pages.push(page_attrs);$new_page.children().each(function(){self.process($(this));});});var $new_notebook=this.render_element('FormRenderingNotebook',{pages:pages});$notebook.contents().appendTo($new_notebook);$notebook.before($new_notebook).remove();self.process($($new_notebook.children()[0]));$new_notebook.tabs();_.each(pages,function(page,i){if(!page.__ic)
return;page.__ic.on("change:effective_invisible",null,function(){if(!page.__ic.get('effective_invisible')&&page.autofocus){$new_notebook.tabs('select',i);return;}
var current=$new_notebook.tabs("option","selected");if(!pages[current].__ic||!pages[current].__ic.get("effective_invisible"))
return;var first_visible=_.find(_.range(pages.length),function(i2){return(!pages[i2].__ic)||(!pages[i2].__ic.get("effective_invisible"));});if(first_visible!==undefined){$new_notebook.tabs('select',first_visible);}});});this.handle_common_properties($new_notebook,$notebook);return $new_notebook;},process_separator:function($separator){var $new_separator=this.render_element('FormRenderingSeparator',$separator.getAttributes());$separator.before($new_separator).remove();this.handle_common_properties($new_separator,$separator);return $new_separator;},process_label:function($label){var name=$label.attr("for"),field_orm=this.fvg.fields[name];var dict={string:$label.attr('string')||(field_orm||{}).string||'',help:$label.attr('help')||(field_orm||{}).help||'',_for:name?_.uniqueId('oe-field-input-'):undefined,};var align=parseFloat(dict.align);if(isNaN(align)||align===1){align='right';}else if(align===0){align='left';}else{align='center';}
dict.align=align;var $new_label=this.render_element('FormRenderingLabel',dict);$label.before($new_label).remove();this.handle_common_properties($new_label,$label);if(name){this.labels[name]=$new_label;}
return $new_label;},handle_common_properties:function($new_element,$node){var str_modifiers=$node.attr("modifiers")||"{}";var modifiers=JSON.parse(str_modifiers);var ic=null;if(modifiers.invisible!==undefined)
ic=new instance.web.form.InvisibilityChanger(this.view,this.view,modifiers.invisible,$new_element);$new_element.addClass($node.attr("class")||"");$new_element.attr('style',$node.attr('style'));return{invisibility_changer:ic,};},});instance.web.form.DefaultFieldManager=instance.web.Widget.extend({init:function(parent,eval_context){this._super(parent);this.field_descs={};this.eval_context=eval_context||{};this.set({display_invalid_fields:false,actual_mode:'create',});},get_field_desc:function(field_name){if(this.field_descs[field_name]===undefined){this.field_descs[field_name]={string:field_name,};}
return this.field_descs[field_name];},extend_field_desc:function(fields){var self=this;_.each(fields,function(v,k){_.extend(self.get_field_desc(k),v);});},get_field_value:function(field_name){return false;},set_values:function(values){},compute_domain:function(expression){return instance.web.form.compute_domain(expression,{});},build_eval_context:function(){return new instance.web.CompoundContext(this.eval_context);},});instance.web.form.compute_domain=function(expr,fields){if(!(expr instanceof Array))
return!!expr;var stack=[];for(var i=expr.length-1;i>=0;i--){var ex=expr[i];if(ex.length==1){var top=stack.pop();switch(ex){case'|':stack.push(stack.pop()||top);continue;case'&':stack.push(stack.pop()&&top);continue;case'!':stack.push(!top);continue;default:throw new Error(_.str.sprintf(_t("Unknown operator %s in domain %s"),ex,JSON.stringify(expr)));}}
var field=fields[ex[0]];if(!field){throw new Error(_.str.sprintf(_t("Unknown field %s in domain %s"),ex[0],JSON.stringify(expr)));}
var field_value=field.get_value?field.get_value():field.value;var op=ex[1];var val=ex[2];switch(op.toLowerCase()){case'=':case'==':stack.push(_.isEqual(field_value,val));break;case'!=':case'<>':stack.push(!_.isEqual(field_value,val));break;case'<':stack.push(field_value<val);break;case'>':stack.push(field_value>val);break;case'<=':stack.push(field_value<=val);break;case'>=':stack.push(field_value>=val);break;case'in':if(!_.isArray(val))val=[val];stack.push(_(val).contains(field_value));break;case'not in':if(!_.isArray(val))val=[val];stack.push(!_(val).contains(field_value));break;default:console.warn(_t("Unsupported operator %s in domain %s"),op,JSON.stringify(expr));}}
return _.all(stack,_.identity);};instance.web.form.is_bin_size=function(v){return(/^\d+(\.\d*)? \w+$/).test(v);};instance.web.form.InvisibilityChangerMixin={init:function(field_manager,invisible_domain){var self=this;this._ic_field_manager=field_manager;this._ic_invisible_modifier=invisible_domain;this._ic_field_manager.on("view_content_has_changed",this,function(){var result=self._ic_invisible_modifier===undefined?false:self._ic_field_manager.compute_domain(self._ic_invisible_modifier);self.set({"invisible":result});});this.set({invisible:this._ic_invisible_modifier===true,force_invisible:false});var check=function(){if(self.get("invisible")||self.get('force_invisible')){self.set({"effective_invisible":true});}else{self.set({"effective_invisible":false});}};this.on('change:invisible',this,check);this.on('change:force_invisible',this,check);check.call(this);},start:function(){this.on("change:effective_invisible",this,this._check_visibility);this._check_visibility();},_check_visibility:function(){this.$el.toggleClass('oe_form_invisible',this.get("effective_invisible"));},};instance.web.form.InvisibilityChanger=instance.web.Class.extend(instance.web.PropertiesMixin,instance.web.form.InvisibilityChangerMixin,{init:function(parent,field_manager,invisible_domain,$el){this.setParent(parent);instance.web.PropertiesMixin.init.call(this);instance.web.form.InvisibilityChangerMixin.init.call(this,field_manager,invisible_domain);this.$el=$el;this.start();},});instance.web.form.FormWidget=instance.web.Widget.extend(instance.web.form.InvisibilityChangerMixin,{init:function(field_manager,node){this._super(field_manager);this.field_manager=field_manager;if(this.field_manager instanceof instance.web.FormView)
this.view=this.field_manager;this.node=node;this.modifiers=JSON.parse(this.node.attrs.modifiers||'{}');instance.web.form.InvisibilityChangerMixin.init.call(this,this.field_manager,this.modifiers.invisible);this.field_manager.on("view_content_has_changed",this,this.process_modifiers);this.set({required:false,readonly:false,});var self=this;var test_effective_readonly=function(){self.set({"effective_readonly":self.get("readonly")||self.field_manager.get("actual_mode")==="view"});};this.on("change:readonly",this,test_effective_readonly);this.field_manager.on("change:actual_mode",this,test_effective_readonly);test_effective_readonly.call(this);},renderElement:function(){this.process_modifiers();this._super();this.$el.addClass(this.node.attrs["class"]||"");},destroy:function(){$.fn.tooltip('destroy');this._super.apply(this,arguments);},setupFocus:function($e){var self=this;$e.on({focus:function(){self.trigger('focused');},blur:function(){self.trigger('blurred');}});},process_modifiers:function(){var to_set={};for(var a in this.modifiers){if(!this.modifiers.hasOwnProperty(a)){continue;}
if(!_.include(["invisible"],a)){var val=this.field_manager.compute_domain(this.modifiers[a]);to_set[a]=val;}}
this.set(to_set);},do_attach_tooltip:function(widget,trigger,options){widget=widget||this;trigger=trigger||this.$el;options=_.extend({delay:{show:500,hide:0},title:function(){var template=widget.template+'.tooltip';if(!QWeb.has_template(template)){template='WidgetLabel.tooltip';}
return QWeb.render(template,{debug:instance.session.debug,widget:widget});},},options||{});if(instance.session.debug||widget.node.attrs.help||(widget.field&&widget.field.help)){$(trigger).tooltip(options);}},build_context:function(){var v_context=this.node.attrs.context;if(!v_context){v_context=(this.field||{}).context||{};}
if(v_context.__ref||true){var fields_values=this.field_manager.build_eval_context();v_context=new instance.web.CompoundContext(v_context).set_eval_context(fields_values);}
return v_context;},build_domain:function(){var f_domain=this.field.domain||[];var n_domain=this.node.attrs.domain||null;var final_domain=n_domain!==null?n_domain:f_domain;if(!(final_domain instanceof Array)||true){var fields_values=this.field_manager.build_eval_context();final_domain=new instance.web.CompoundDomain(final_domain).set_eval_context(fields_values);}
return final_domain;}});instance.web.form.WidgetButton=instance.web.form.FormWidget.extend({template:'WidgetButton',init:function(field_manager,node){node.attrs.type=node.attrs['data-button-type'];this.is_stat_button=/\boe_stat_button\b/.test(node.attrs['class']);this.icon_class=node.attrs.icon&&"stat_button_icon fa "+node.attrs.icon+" fa-fw";this._super(field_manager,node);this.force_disabled=false;this.string=(this.node.attrs.string||'').replace(/_/g,'');if(JSON.parse(this.node.attrs.default_focus||"0")){this.view.default_focus_button=this;}
if(this.node.attrs.icon&&(!/\//.test(this.node.attrs.icon))){this.node.attrs.icon='/web/static/src/img/icons/'+this.node.attrs.icon+'.png';}},start:function(){this._super.apply(this,arguments);this.view.on('view_content_has_changed',this,this.check_disable);this.check_disable();this.$el.click(this.on_click);if(this.node.attrs.help||instance.session.debug){this.do_attach_tooltip();}
this.setupFocus(this.$el);},on_click:function(){var self=this;this.force_disabled=true;this.check_disable();this.execute_action().always(function(){self.force_disabled=false;self.check_disable();});},execute_action:function(){var self=this;var exec_action=function(){if(self.node.attrs.confirm){var def=$.Deferred();var dialog=new instance.web.Dialog(this,{title:_t('Confirm'),buttons:[{text:_t("Cancel"),click:function(){this.parents('.modal').modal('hide');}},{text:_t("Ok"),click:function(){var self2=this;self.on_confirmed().always(function(){self2.parents('.modal').modal('hide');});}}],},$('<div/>').text(self.node.attrs.confirm)).open();dialog.on("closing",null,function(){def.resolve();});return def.promise();}else{return self.on_confirmed();}};if(!this.node.attrs.special){return this.view.recursive_save().then(exec_action);}else{return exec_action();}},on_confirmed:function(){var self=this;var context=this.build_context();return this.view.do_execute_action(_.extend({},this.node.attrs,{context:context}),this.view.dataset,this.view.datarecord.id,function(reason){if(!_.isObject(reason)){self.view.recursive_reload();}});},check_disable:function(){var disabled=(this.force_disabled||!this.view.is_interactible_record());this.$el.prop('disabled',disabled);this.$el.css('color',disabled?'grey':'');}});instance.web.form.FieldInterface={init:function(field_manager,node){},set_value:function(value_){},get_value:function(){},set_input_id:function(id){},is_valid:function(){},is_syntax_valid:function(){},focus:function(){},on_translate:function(){},commit_value:function(){},};instance.web.form.AbstractField=instance.web.form.FormWidget.extend(instance.web.form.FieldInterface,{init:function(field_manager,node){var self=this;this._super(field_manager,node);this.name=this.node.attrs.name;this.field=this.field_manager.get_field_desc(this.name);this.widget=this.node.attrs.widget;this.string=this.node.attrs.string||this.field.string||this.name;this.options=instance.web.py_eval(this.node.attrs.options||'{}');this.set({'value':false});this.on("change:value",this,function(){this.trigger('changed_value');this._check_css_flags();});},renderElement:function(){var self=this;this._super();if(this.field.translate&&this.view){this.$el.addClass('oe_form_field_translatable');this.$el.find('.oe_field_translate').click(this.on_translate);}
this.$label=this.view?this.view.$el.find('label[for='+this.id_for_label+']'):$();this.do_attach_tooltip(this,this.$label[0]||this.$el);if(instance.session.debug){this.$label.off('dblclick').on('dblclick',function(){console.log("Field '%s' of type '%s' in View: %o",self.name,(self.node.attrs.widget||self.field.type),self.view);window.w=self;console.log("window.w =",window.w);});}
if(!this.disable_utility_classes){this.off("change:required",this,this._set_required);this.on("change:required",this,this._set_required);this._set_required();}
this._check_visibility();this.field_manager.off("change:display_invalid_fields",this,this._check_css_flags);this.field_manager.on("change:display_invalid_fields",this,this._check_css_flags);this._check_css_flags();},start:function(){var tmp=this._super();this.on("change:value",this,function(){if(!this.no_rerender)
this.render_value();});this.render_value();},_set_required:function(){this.$el.toggleClass('oe_form_required',this.get("required"));},set_value:function(value_){this.set({'value':value_});},get_value:function(){return this.get('value');},internal_set_value:function(value_){var tmp=this.no_rerender;this.no_rerender=true;this.set({'value':value_});this.no_rerender=tmp;},render_value:function(){},is_valid:function(){return this.is_syntax_valid()&&!(this.get('required')&&this.is_false());},is_syntax_valid:function(){return true;},is_false:function(){return this.get('value')===false;},_check_css_flags:function(){if(this.field.translate){this.$el.find('.oe_field_translate').toggle(this.field_manager.get('actual_mode')!=="create");}
if(!this.disable_utility_classes){if(this.field_manager.get('display_invalid_fields')){this.$el.toggleClass('oe_form_invalid',!this.is_valid());}}},focus:function(){return false;},set_input_id:function(id){this.id_for_label=id;},on_translate:function(){var self=this;var trans=new instance.web.DataSet(this,'ir.translation');return trans.call_button('translate_fields',[this.view.dataset.model,this.view.datarecord.id,this.name,this.view.dataset.get_context()]).done(function(r){self.do_action(r);});},set_dimensions:function(height,width){this.$el.css({width:width,minHeight:height});},commit_value:function(){return $.when();},});instance.web.form.ReinitializeWidgetMixin={start:function(){this.initialize_field();this._super();},initialize_field:function(){this.on("change:effective_readonly",this,this.reinitialize);this.initialize_content();},reinitialize:function(){this.destroy_content();this.renderElement();this.initialize_content();},destroy_content:function(){},initialize_content:function(){},};instance.web.form.ReinitializeFieldMixin=_.extend({},instance.web.form.ReinitializeWidgetMixin,{reinitialize:function(){instance.web.form.ReinitializeWidgetMixin.reinitialize.call(this);var res=this.render_value();if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(res);}},});if(!('placeholder'in document.createElement('input'))){document.addEventListener("DOMNodeInserted",function(event){var nodename=event.target.nodeName.toLowerCase();if(nodename==="input"||nodename=="textarea"){$(event.target).placeholder();}});}
instance.web.form.FieldChar=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldChar',widget_class:'oe_form_field_char',events:{'change input':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.password=this.node.attrs.password==='True'||this.node.attrs.password==='1';},initialize_content:function(){this.setupFocus(this.$('input'));},store_dom_value:function(){if(!this.get('effective_readonly')&&this.$('input').length&&this.is_syntax_valid()){this.internal_set_value(this.parse_value(this.$('input').val()));}},commit_value:function(){this.store_dom_value();return this._super();},render_value:function(){var show_value=this.format_value(this.get('value'),'');if(!this.get("effective_readonly")){this.$el.find('input').val(show_value);}else{if(this.password){show_value=new Array(show_value.length+1).join('*');}
this.$(".oe_form_char_content").text(show_value);}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.$("input").size()>0){try{this.parse_value(this.$('input').val(),'');return true;}catch(e){return false;}}
return true;},parse_value:function(val,def){return instance.web.parse_value(val,this,def);},format_value:function(val,def){return instance.web.format_value(val,this,def);},is_false:function(){return this.get('value')===''||this._super();},focus:function(){var input=this.$('input:first')[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);this.$('input').css({height:height,width:width});}});instance.web.form.KanbanSelection=instance.web.form.FieldChar.extend({init:function(field_manager,node){this._super(field_manager,node);},prepare_dropdown_selection:function(){var self=this;var data=[];var selection=self.field.selection||[];_.map(selection,function(res){var value={'name':res[0],'tooltip':res[1],'state_name':res[1],}
if(res[0]=='normal'){value['state_class']='oe_kanban_status';}
else if(res[0]=='done'){value['state_class']='oe_kanban_status oe_kanban_status_green';}
else{value['state_class']='oe_kanban_status oe_kanban_status_red';}
data.push(value);});return data;},render_value:function(){var self=this;this.record_id=this.view.datarecord.id;this.states=this.prepare_dropdown_selection();;this.$el.html(QWeb.render("KanbanSelection",{'widget':self}));this.$el.find('li').on('click',this.set_kanban_selection.bind(this));},set_kanban_selection:function(ev){var self=this;var li=$(ev.target).closest('li');if(li.length){var value=String(li.data('value'));if(this.view.get('actual_mode')=='view'){var write_values={}
write_values[self.name]=value;return this.view.dataset._model.call('write',[[self.record_id],write_values,self.view.dataset.get_context()]).done(self.reload_record.bind(self));}
else{return this.set_value(value);}}},reload_record:function(){this.view.reload();},});instance.web.form.Priority=instance.web.form.FieldChar.extend({init:function(field_manager,node){this._super(field_manager,node);},prepare_priority:function(){var self=this;var selection=this.field.selection||[];var init_value=selection&&selection[0][0]||0;var data=_.map(selection.slice(1),function(element,index){var value={'value':element[0],'name':element[1],'click_value':element[0],}
if(index==0&&self.get('value')==element[0]){value['click_value']=init_value;}
return value;});return data;},render_value:function(){var self=this;this.record_id=this.view.datarecord.id;this.priorities=this.prepare_priority();this.$el.html(QWeb.render("Priority",{'widget':this}));this.$el.find('li').on('click',this.set_priority.bind(this));},set_priority:function(ev){var self=this;var li=$(ev.target).closest('li');if(li.length){var value=String(li.data('value'));if(this.view.get('actual_mode')=='view'){var write_values={}
write_values[self.name]=value;return this.view.dataset._model.call('write',[[self.record_id],write_values,self.view.dataset.get_context()]).done(self.reload_record.bind(self));}
else{return this.set_value(value);}}},reload_record:function(){this.view.reload();},});instance.web.form.FieldID=instance.web.form.FieldChar.extend({process_modifiers:function(){this._super();this.set({readonly:true});},});instance.web.form.FieldEmail=instance.web.form.FieldChar.extend({template:'FieldEmail',initialize_content:function(){this._super();var $button=this.$el.find('button');$button.click(this.on_button_clicked);this.setupFocus($button);},render_value:function(){if(!this.get("effective_readonly")){this._super();}else{this.$el.find('a').attr('href','mailto:'+this.get('value')).text(this.get('value')||'');}},on_button_clicked:function(){if(!this.get('value')||!this.is_syntax_valid()){this.do_warn(_t("E-mail Error"),_t("Can't send email to invalid e-mail address"));}else{location.href='mailto:'+this.get('value');}}});instance.web.form.FieldUrl=instance.web.form.FieldChar.extend({template:'FieldUrl',initialize_content:function(){this._super();var $button=this.$el.find('button');$button.click(this.on_button_clicked);this.setupFocus($button);},render_value:function(){if(!this.get("effective_readonly")){this._super();}else{var tmp=this.get('value');var s=/(\w+):(.+)|^\.{0,2}\//.exec(tmp);if(!s){tmp="http://"+this.get('value');}
var text=this.get('value')?this.node.attrs.text||tmp:'';this.$el.find('a').attr('href',tmp).text(text);}},on_button_clicked:function(){if(!this.get('value')){this.do_warn(_t("Resource Error"),_t("This resource is empty"));}else{var url=$.trim(this.get('value'));if(/^www\./i.test(url))
url='http://'+url;window.open(url);}}});instance.web.form.FieldFloat=instance.web.form.FieldChar.extend({is_field_number:true,widget_class:'oe_form_field_float',init:function(field_manager,node){this._super(field_manager,node);this.internal_set_value(0);if(this.node.attrs.digits){this.digits=this.node.attrs.digits;}else{this.digits=this.field.digits;}},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
if(this.digits!==undefined&&this.digits.length===2){value_=instance.web.round_decimals(value_,this.digits[1]);}
this._super.apply(this,[value_]);},focus:function(){var $input=this.$('input:first');return $input.length?$input.select():false;}});instance.web.form.FieldCharDomain=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{init:function(field_manager,node){this._super.apply(this,arguments);},start:function(){var self=this;this._super.apply(this,arguments);this.on("change:effective_readonly",this,function(){this.display_field();});this.display_field();return this._super();},set_value:function(value_){var self=this;this.set('value',value_||false);this.display_field();},display_field:function(){var self=this;this.$el.html(instance.web.qweb.render("FieldCharDomain",{widget:this}));if(this.get('value')){var model=this.options.model||this.field_manager.get_field_value(this.options.model_field);var domain=instance.web.pyeval.eval('domain',this.get('value'));var ds=new instance.web.DataSetStatic(self,model,self.build_context());ds.call('search_count',[domain]).then(function(results){$('.oe_domain_count',self.$el).text(results+' records selected');if(self.get('effective_readonly')){$('button span',self.$el).text(' See selection');}
else{$('button span',self.$el).text(' Change selection');}});}else{$('.oe_domain_count',this.$el).text('0 record selected');$('button span',this.$el).text(' Select records');};this.$('.select_records').on('click',self.on_click);},on_click:function(event){event.preventDefault();var self=this;var model=this.options.model||this.field_manager.get_field_value(this.options.model_field);this.pop=new instance.web.form.SelectCreatePopup(this);this.pop.select_element(model,{title:this.get('effective_readonly')?'Selected records':'Select records...',readonly:this.get('effective_readonly'),disable_multiple_selection:this.get('effective_readonly'),no_create:this.get('effective_readonly'),},[],this.build_context());this.pop.on("elements_selected",self,function(element_ids){if(this.pop.$('input.oe_list_record_selector').prop('checked')){var search_data=this.pop.searchview.build_search_data();var domain_done=instance.web.pyeval.eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).then(function(results){return results.domain;});}
else{var domain=[["id","in",element_ids]];var domain_done=$.Deferred().resolve(domain);}
$.when(domain_done).then(function(domain){var domain=self.pop.dataset.domain.concat(domain||[]);self.set_value(domain);});});},});instance.web.DateTimeWidget=instance.web.Widget.extend({template:"web.datepicker",jqueryui_object:'datetimepicker',type_of_date:"datetime",events:{'change .oe_datepicker_master':'change_datetime','keypress .oe_datepicker_master':'change_datetime',},init:function(parent){this._super(parent);this.name=parent.name;},start:function(){var self=this;this.$input=this.$el.find('input.oe_datepicker_master');this.$input_picker=this.$el.find('input.oe_datepicker_container');$.datepicker.setDefaults({clearText:_t('Clear'),clearStatus:_t('Erase the current date'),closeText:_t('Done'),closeStatus:_t('Close without change'),prevText:_t('<Prev'),prevStatus:_t('Show the previous month'),nextText:_t('Next>'),nextStatus:_t('Show the next month'),currentText:_t('Today'),currentStatus:_t('Show the current month'),monthNames:Date.CultureInfo.monthNames,monthNamesShort:Date.CultureInfo.abbreviatedMonthNames,monthStatus:_t('Show a different month'),yearStatus:_t('Show a different year'),weekHeader:_t('Wk'),weekStatus:_t('Week of the year'),dayNames:Date.CultureInfo.dayNames,dayNamesShort:Date.CultureInfo.abbreviatedDayNames,dayNamesMin:Date.CultureInfo.shortestDayNames,dayStatus:_t('Set DD as first week day'),dateStatus:_t('Select D, M d'),firstDay:Date.CultureInfo.firstDayOfWeek,initStatus:_t('Select a date'),isRTL:false});$.timepicker.setDefaults({timeOnlyTitle:_t('Choose Time'),timeText:_t('Time'),hourText:_t('Hour'),minuteText:_t('Minute'),secondText:_t('Second'),currentText:_t('Now'),closeText:_t('Done')});this.picker({onClose:this.on_picker_select,onSelect:this.on_picker_select,changeMonth:true,changeYear:true,showWeek:true,showButtonPanel:true,firstDay:Date.CultureInfo.firstDayOfWeek});this.picker('widget').click(function(e){e.stopPropagation();});this.$el.find('img.oe_datepicker_trigger').click(function(){if(self.get("effective_readonly")||self.picker('widget').is(':visible')){self.$input.focus();return;}
self.picker('setDate',self.get('value')?instance.web.auto_str_to_date(self.get('value')):new Date());self.$input_picker.show();self.picker('show');self.$input_picker.hide();});this.set_readonly(false);this.set({'value':false});},picker:function(){return $.fn[this.jqueryui_object].apply(this.$input_picker,arguments);},on_picker_select:function(text,instance_){var date=this.picker('getDate');this.$input.val(date?this.format_client(date):'').change().focus();},set_value:function(value_){this.set({'value':value_});this.$input.val(value_?this.format_client(value_):'');},get_value:function(){return this.get('value');},set_value_from_ui_:function(){var value_=this.$input.val()||false;this.set({'value':this.parse_client(value_)});},set_readonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);this.$el.find('img.oe_datepicker_trigger').toggleClass('oe_input_icon_disabled',readonly);},is_valid_:function(){var value_=this.$input.val();if(value_===""){return true;}else{try{this.parse_client(value_);return true;}catch(e){return false;}}},parse_client:function(v){return instance.web.parse_value(v,{"widget":this.type_of_date});},format_client:function(v){return instance.web.format_value(v,{"widget":this.type_of_date});},change_datetime:function(e){if((e.type!=="keypress"||e.which===13)&&this.is_valid_()){this.set_value_from_ui_();this.trigger("datetime_changed");}},commit_value:function(){this.change_datetime();},});instance.web.DateWidget=instance.web.DateTimeWidget.extend({jqueryui_object:'datepicker',type_of_date:"date"});instance.web.form.FieldDatetime=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:"FieldDatetime",build_widget:function(){return new instance.web.DateTimeWidget(this);},destroy_content:function(){if(this.datewidget){this.datewidget.destroy();this.datewidget=undefined;}},initialize_content:function(){if(!this.get("effective_readonly")){this.datewidget=this.build_widget();this.datewidget.on('datetime_changed',this,_.bind(function(){this.internal_set_value(this.datewidget.get_value());},this));this.datewidget.appendTo(this.$el);this.setupFocus(this.datewidget.$input);}},render_value:function(){if(!this.get("effective_readonly")){this.datewidget.set_value(this.get('value'));}else{this.$el.text(instance.web.format_value(this.get('value'),this,''));}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.datewidget){return this.datewidget.is_valid_();}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function(){var input=this.datewidget&&this.datewidget.$input[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);if(!this.get("effective_readonly")){this.datewidget.$input.css('height',height);}}});instance.web.form.FieldDate=instance.web.form.FieldDatetime.extend({template:"FieldDate",build_widget:function(){return new instance.web.DateWidget(this);}});instance.web.form.FieldText=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldText',events:{'keyup':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'keypress':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'change textarea':'store_dom_value',},initialize_content:function(){var self=this;if(!this.get("effective_readonly")){this.$textarea=this.$el.find('textarea');this.auto_sized=false;this.default_height=this.$textarea.css('height');if(this.get("effective_readonly")){this.$textarea.attr('disabled','disabled');}
this.setupFocus(this.$textarea);}else{this.$textarea=undefined;}},commit_value:function(){if(!this.get("effective_readonly")&&this.$textarea){this.store_dom_value();}
return this._super();},store_dom_value:function(){this.internal_set_value(instance.web.parse_value(this.$textarea.val(),this));},render_value:function(){if(!this.get("effective_readonly")){var show_value=instance.web.format_value(this.get('value'),this,'');if(show_value===''){this.$textarea.css('height',parseInt(this.default_height,10)+"px");}
this.$textarea.val(show_value);if(!this.auto_sized){this.auto_sized=true;this.$textarea.autosize();}else{this.$textarea.trigger("autosize");}}else{var txt=this.get("value")||'';this.$(".oe_form_text_content").text(txt);}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.$textarea){try{instance.web.parse_value(this.$textarea.val(),this,'');return true;}catch(e){return false;}}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function($el){var input=!this.get("effective_readonly")&&this.$textarea&&this.$textarea[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);if(!this.get("effective_readonly")&&this.$textarea){this.$textarea.css({width:width,minHeight:height});}},});instance.web.form.FieldTextHtml=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldTextHtml',init:function(){this._super.apply(this,arguments);},initialize_content:function(){var self=this;if(!this.get("effective_readonly")){self._updating_editor=false;this.$textarea=this.$el.find('textarea');var width=((this.node.attrs||{}).editor_width||'calc(100% - 4px)');var height=((this.node.attrs||{}).editor_height||250);this.$textarea.cleditor({width:width,height:height,controls:"bold italic underline strikethrough "+"| removeformat | bullets numbering | outdent "+"indent | link unlink | source",bodyStyle:"margin:4px; color:#4c4c4c; font-size:13px; font-family:'Lucida Grande',Helvetica,Verdana,Arial,sans-serif; cursor:text"});this.$cleditor=this.$textarea.cleditor()[0];this.$cleditor.change(function(){if(!self._updating_editor){self.$cleditor.updateTextArea();self.internal_set_value(self.$textarea.val());}});if(this.field.translate){var $img=$('<img class="oe_field_translate oe_input_icon" src="/web/static/src/img/icons/terp-translate.png" width="16" height="16" border="0"/>').click(this.on_translate);this.$cleditor.$toolbar.append($img);}}},render_value:function(){if(!this.get("effective_readonly")){this.$textarea.val(this.get('value')||'');this._updating_editor=true;this.$cleditor.updateFrame();this._updating_editor=false;}else{this.$el.html(this.get('value'));}},});instance.web.form.FieldBoolean=instance.web.form.AbstractField.extend({template:'FieldBoolean',start:function(){var self=this;this.$checkbox=$("input",this.$el);this.setupFocus(this.$checkbox);this.$el.click(_.bind(function(){this.internal_set_value(this.$checkbox.is(':checked'));},this));var check_readonly=function(){self.$checkbox.prop('disabled',self.get("effective_readonly"));self.click_disabled_boolean();};this.on("change:effective_readonly",this,check_readonly);check_readonly.call(this);this._super.apply(this,arguments);},render_value:function(){this.$checkbox[0].checked=this.get('value');},focus:function(){var input=this.$checkbox&&this.$checkbox[0];return input?input.focus():false;},click_disabled_boolean:function(){var $disabled=this.$el.find('input[type=checkbox]:disabled');$disabled.each(function(){$(this).next('div').remove();$(this).closest("span").append($('<div class="boolean"></div>'));});}});instance.web.form.FieldProgressBar=instance.web.form.AbstractField.extend({template:'FieldProgressBar',render_value:function(){this.$el.progressbar({value:this.get('value')||0,disabled:this.get("effective_readonly")});var formatted_value=instance.web.format_value(this.get('value')||0,{type:'float'});this.$('span').html(formatted_value+'%');}});instance.web.form.FieldPercentPie=instance.web.form.AbstractField.extend({template:'FieldPercentPie',render_value:function(){var value=this.get('value'),formatted_value=Math.round(value||0)+'%',svg=this.$('svg')[0];svg.innerHTML="";nv.addGraph(function(){var width=42,height=42;var chart=nv.models.pieChart().width(width).height(height).margin({top:0,right:0,bottom:0,left:0}).donut(true).showLegend(false).showLabels(false).tooltips(false).color(['#7C7BAD','#DDD']).donutRatio(0.62);d3.select(svg).datum([{'x':'value','y':value},{'x':'complement','y':100-value}]).transition().call(chart).attr('style','width: '+width+'px; height:'+height+'px;');d3.select(svg).append("text").attr({x:width/2,y:height/2+3,'text-anchor':'middle'}).style({"font-size":"10px","font-weight":"bold"}).text(formatted_value);return chart;});}});instance.web.form.FieldBarChart=instance.web.form.AbstractField.extend({template:'FieldBarChart',render_value:function(){var value=JSON.parse(this.get('value'));var svg=this.$('svg')[0];svg.innerHTML="";nv.addGraph(function(){var width=34,height=34;var chart=nv.models.discreteBarChart().x(function(d){return d.tooltip}).y(function(d){return d.value}).width(width).height(height).margin({top:0,right:0,bottom:0,left:0}).tooltips(false).showValues(false).transitionDuration(350).showXAxis(false).showYAxis(false);d3.select(svg).datum([{key:'values',values:value}]).transition().call(chart).attr('style','width: '+(width+4)+'px; height: '+(height+8)+'px;');nv.utils.windowResize(chart.update);return chart;});}});instance.web.form.FieldSelection=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldSelection',events:{'change select':'store_dom_value',},init:function(field_manager,node){var self=this;this._super(field_manager,node);this.set("value",false);this.set("values",[]);this.records_orderer=new instance.web.DropMisordered();this.field_manager.on("view_content_has_changed",this,function(){var domain=new openerp.web.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});},initialize_field:function(){instance.web.form.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_values);this.set("domain",new openerp.web.CompoundDomain(this.build_domain()).eval());this.on("change:values",this,this.render_value);},query_values:function(){var self=this;var def;if(this.field.type==="many2one"){var model=new openerp.Model(openerp.session,this.field.relation);def=model.call("name_search",['',this.get("domain")],{"context":this.build_context()});}else{var values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});def=$.when(values);}
this.records_orderer.add(def).then(function(values){if(!_.isEqual(values,self.get("values"))){self.set("values",values);}});},initialize_content:function(){var ischanging=false;var $select=this.$el.find('select').change(function(){ischanging=true;}).click(function(){ischanging=false;}).keyup(function(e){if(e.which!==13||!ischanging){return;}
e.stopPropagation();ischanging=false;});this.setupFocus($select);},commit_value:function(){this.store_dom_value();return this._super();},store_dom_value:function(){if(!this.get('effective_readonly')&&this.$('select').length){var val=JSON.parse(this.$('select').val());this.internal_set_value(val);}},set_value:function(value_){value_=value_===null?false:value_;value_=value_ instanceof Array?value_[0]:value_;this._super(value_);},render_value:function(){var values=this.get("values");values=[[false,this.node.attrs.placeholder||'']].concat(values);var found=_.find(values,function(el){return el[0]===this.get("value");},this);if(!found){found=[this.get("value"),_t('Unknown')];values=[found].concat(values);}
if(!this.get("effective_readonly")){this.$().html(QWeb.render("FieldSelectionSelect",{widget:this,values:values}));this.$("select").val(JSON.stringify(found[0]));}else{this.$el.text(found[1]);}},focus:function(){var input=this.$('select:first')[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);this.$('select').css({height:height,width:width});}});instance.web.form.FieldRadio=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldRadio',events:{'click input':'click_change_value'},init:function(field_manager,node){this._super(field_manager,node);this.selection=_.clone(this.field.selection)||[];this.domain=false;},initialize_content:function(){this.uniqueId=_.uniqueId("radio");this.on("change:effective_readonly",this,this.render_value);this.field_manager.on("view_content_has_changed",this,this.get_selection);this.get_selection();},click_change_value:function(event){var val=$(event.target).val();val=this.field.type=="selection"?val:+val;if(val!==this.get_value()){this.set_value(val);}},get_selection:function(){var self=this;var selection=[];var def=$.Deferred();if(self.field.type=="many2one"){var domain=instance.web.pyeval.eval('domain',this.build_domain())||[];if(!_.isEqual(self.domain,domain)){self.domain=domain;var ds=new instance.web.DataSetStatic(self,self.field.relation,self.build_context());ds.call('search',[self.domain]).then(function(records){ds.name_get(records).then(function(records){selection=records;def.resolve();});});}else{selection=self.selection;def.resolve();}}
else if(self.field.type=="selection"){selection=self.field.selection||[];def.resolve();}
return def.then(function(){if(!_.isEqual(selection,self.selection)){self.selection=_.clone(selection);self.renderElement();self.render_value();}});},set_value:function(value_){if(value_){if(this.field.type=="selection"){value_=_.find(this.field.selection,function(sel){return sel[0]==value_;});}
else if(!this.selection.length){this.selection=[value_];}}
this._super(value_);},get_value:function(){var value=this.get('value');return value instanceof Array?value[0]:value;},render_value:function(){var self=this;this.$el.toggleClass("oe_readonly",this.get('effective_readonly'));this.$("input:checked").prop("checked",false);if(this.get_value()){this.$("input").filter(function(){return this.value==self.get_value();}).prop("checked",true);this.$(".oe_radio_readonly").text(this.get('value')?this.get('value')[1]:"");}}});(function(){var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value_){return matcher.test($("<div>").html(value_.label||value_.value||value_).text());});}
$.extend(proto,{_initSource:function(){if(this.options.html&&$.isArray(this.options.source)){this.source=function(request,response){response(filter(this.options.source,request.term));};}else{initSource.call(this);}},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html?"html":"text"](item.label)).appendTo(ul).addClass(item.classname);}});})();instance.web.form.CompletionFieldMixin={init:function(){this.limit=7;this.orderer=new instance.web.DropMisordered();},get_search_result:function(search_val){var self=this;var dataset=new instance.web.DataSet(this,this.field.relation,self.build_context());this.last_query=search_val;var exclusion_domain=[],ids_blacklist=this.get_search_blacklist();if(!_(ids_blacklist).isEmpty()){exclusion_domain.push(['id','not in',ids_blacklist]);}
return this.orderer.add(dataset.name_search(search_val,new instance.web.CompoundDomain(self.build_domain(),exclusion_domain),'ilike',this.limit+1,self.build_context())).then(function(data){self.last_search=data;var values=_.map(data,function(x){x[1]=x[1].split("\n")[0];return{label:_.str.escapeHTML(x[1]),value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=values.slice(0,self.limit);values.push({label:_t("Search More..."),action:function(){dataset.name_search(search_val,self.build_domain(),'ilike',160).done(function(data){self._search_create_popup("search",data);});},classname:'oe_m2o_dropdown_option'});}
var raw_result=_(data.result).map(function(x){return x[1];});if(search_val.length>0&&!_.include(raw_result,search_val)&&!(self.options&&(self.options.no_create||self.options.no_quick_create))){values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:function(){self._quick_create(search_val);},classname:'oe_m2o_dropdown_option'});}
if(!(self.options&&(self.options.no_create||self.options.no_create_edit))){values.push({label:_t("Create and Edit..."),action:function(){self._search_create_popup("form",undefined,self._create_context(search_val));},classname:'oe_m2o_dropdown_option'});}
else if(values.length==0)
values.push({label:_t("No results to show..."),action:function(){},classname:'oe_m2o_dropdown_option'});return values;});},get_search_blacklist:function(){return[];},_quick_create:function(name){var self=this;var slow_create=function(){self._search_create_popup("form",undefined,self._create_context(name));};if(self.options.quick_create===undefined||self.options.quick_create){new instance.web.DataSet(this,this.field.relation,self.build_context()).name_create(name).done(function(data){if(!self.get('effective_readonly'))
self.add_id(data[0]);}).fail(function(error,event){event.preventDefault();slow_create();});}else
slow_create();},_search_create_popup:function(view,ids,context){var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(self.field.relation,{title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids?_.map(ids,function(x){return x[0];}):undefined,initial_view:view,disable_multiple_selection:true},self.build_domain(),new instance.web.CompoundContext(self.build_context(),context||{}));pop.on("elements_selected",self,function(element_ids){self.add_id(element_ids[0]);self.focus();});},add_id:function(id){},_create_context:function(name){var tmp={};var field=(this.options||{}).create_name_field;if(field===undefined)
field="name";if(field!==false&&name&&(this.options||{}).quick_create!==false)
tmp["default_"+field]=name;return tmp;},};instance.web.form.M2ODialog=instance.web.Dialog.extend({template:"M2ODialog",init:function(parent){this.name=parent.string;this._super(parent,{title:_.str.sprintf(_t("Create a %s"),parent.string),size:'medium',});},start:function(){var self=this;var text=_.str.sprintf(_t("You are creating a new %s, are you sure it does not exist yet?"),self.name);this.$("p").text(text);this.$buttons.html(QWeb.render("M2ODialog.buttons"));this.$("input").val(this.getParent().$input.val());this.$buttons.find(".oe_form_m2o_qc_button").click(function(e){if(self.$("input").val()!=''){self.getParent()._quick_create(self.$("input").val());self.destroy();}else{e.preventDefault();self.$("input").focus();}});this.$buttons.find(".oe_form_m2o_sc_button").click(function(){self.getParent()._search_create_popup("form",undefined,self.getParent()._create_context(self.$("input").val()));self.destroy();});this.$buttons.find(".oe_form_m2o_cancel_button").click(function(){self.destroy();});},});instance.web.form.FieldMany2One=instance.web.form.AbstractField.extend(instance.web.form.CompletionFieldMixin,instance.web.form.ReinitializeFieldMixin,{template:"FieldMany2One",events:{'keydown input':function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.stopPropagation();}},},init:function(field_manager,node){this._super(field_manager,node);instance.web.form.CompletionFieldMixin.init.call(this);this.set({'value':false});this.display_value={};this.display_value_backup={};this.last_search=[];this.floating=false;this.current_display=null;this.is_started=false;this.ignore_focusout=false;},reinit_value:function(val){this.internal_set_value(val);this.floating=false;if(this.is_started&&!this.no_rerender)
this.render_value();},initialize_field:function(){this.is_started=true;instance.web.bus.on('click',this,function(){if(!this.get("effective_readonly")&&this.$input&&this.$input.autocomplete('widget').is(':visible')){this.$input.autocomplete("close");}});instance.web.form.ReinitializeFieldMixin.initialize_field.call(this);},initialize_content:function(){if(!this.get("effective_readonly"))
this.render_editable();},destroy_content:function(){if(this.$drop_down){this.$drop_down.off('click');delete this.$drop_down;}
if(this.$input){this.$input.closest(".modal .modal-content").off('scroll');this.$input.off('keyup blur autocompleteclose autocompleteopen '+'focus focusout change keydown');delete this.$input;}
if(this.$follow_button){this.$follow_button.off('blur focus click');delete this.$follow_button;}},destroy:function(){this.destroy_content();return this._super();},init_error_displayer:function(){},hide_error_displayer:function(){},show_error_displayer:function(){new instance.web.form.M2ODialog(this).open();},render_editable:function(){var self=this;this.$input=this.$el.find("input");this.init_error_displayer();self.$input.on('focus',function(){self.hide_error_displayer();});this.$drop_down=this.$el.find(".oe_m2o_drop_down_button");this.$follow_button=$(".oe_m2o_cm_button",this.$el);this.$follow_button.click(function(ev){ev.preventDefault();if(!self.get('value')){self.focus();return;}
var pop=new instance.web.form.FormOpenPopup(self);var context=self.build_context().eval();var model_obj=new instance.web.Model(self.field.relation);model_obj.call('get_formview_id',[self.get("value"),context]).then(function(view_id){pop.show_element(self.field.relation,self.get("value"),self.build_context(),{title:_t("Open: ")+self.string,view_id:view_id});pop.on('write_completed',self,function(){self.display_value={};self.display_value_backup={};self.render_value();self.focus();self.trigger('changed_value');});});});var input_changed=function(){if(self.current_display!==self.$input.val()){self.current_display=self.$input.val();if(self.$input.val()===""){self.internal_set_value(false);self.floating=false;}else{self.floating=true;}}};this.$input.keydown(input_changed);this.$input.change(input_changed);this.$drop_down.click(function(){self.$input.focus();if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}else{if(self.get("value")&&!self.floating){self.$input.autocomplete("search","");}else{self.$input.autocomplete("search");}}});var close_autocomplete=_.debounce(function(){if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}},50);this.$input.closest(".modal .modal-content").on('scroll',this,close_autocomplete);self.ed_def=$.Deferred();self.uned_def=$.Deferred();var ed_delay=200;var ed_duration=15000;var anyoneLoosesFocus=function(e){if(self.ignore_focusout){return;}
var used=false;if(self.floating){if(self.last_search.length>0){if(self.last_search[0][0]!=self.get("value")){self.display_value={};self.display_value_backup={};self.display_value[""+self.last_search[0][0]]=self.last_search[0][1];self.reinit_value(self.last_search[0][0]);self.last_search=[]}else{used=true;self.render_value();}}else{used=true;}
self.floating=false;}
if(used&&self.get("value")===false&&!self.no_ed&&!(self.options&&(self.options.no_create||self.options.no_quick_create))){self.ed_def.reject();self.uned_def.reject();self.ed_def=$.Deferred();self.ed_def.done(function(){self.show_error_displayer();ignore_blur=false;self.trigger('focused');});ignore_blur=true;setTimeout(function(){self.ed_def.resolve();self.uned_def.reject();self.uned_def=$.Deferred();self.uned_def.done(function(){self.hide_error_displayer();});setTimeout(function(){self.uned_def.resolve();},ed_duration);},ed_delay);}else{self.no_ed=false;self.ed_def.reject();}};var ignore_blur=false;this.$input.on({focusout:anyoneLoosesFocus,focus:function(){self.trigger('focused');},autocompleteopen:function(){ignore_blur=true;},autocompleteclose:function(){setTimeout(function(){ignore_blur=false;},0);},blur:function(){if(ignore_blur){$(this).focus();return;}
if(_(self.getChildren()).any(function(child){return child instanceof instance.web.form.AbstractFormPopup;})){return;}
self.trigger('blurred');}});var isSelecting=false;this.$input.autocomplete({source:function(req,resp){self.get_search_result(req.term).done(function(result){resp(result);});},select:function(event,ui){isSelecting=true;var item=ui.item;if(item.id){self.display_value={};self.display_value_backup={};self.display_value[""+item.id]=item.name;self.reinit_value(item.id);}else if(item.action){item.action();self.trigger('focused');return false;}},focus:function(e,ui){e.preventDefault();},html:true,minLength:0,delay:200,});var appendTo=this.$el.parents('.oe_view_manager_body, .modal-dialog').last();if(appendTo.length===0){appendTo='.oe_application > *';}
this.$input.autocomplete({appendTo:appendTo});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.$input.autocomplete("widget").openerpClass();this.$input.keyup(function(e){if(e.which===13){if(isSelecting)
e.stopPropagation();}
isSelecting=false;});this.setupFocus(this.$follow_button);},render_value:function(no_recurse){var self=this;if(!this.get("value")){this.display_string("");return;}
var display=this.display_value[""+this.get("value")];if(display){this.display_string(display);return;}
if(!no_recurse){var dataset=new instance.web.DataSetStatic(this,this.field.relation,self.build_context());var def=this.alive(dataset.name_get([self.get("value")])).done(function(data){if(!data[0]){self.do_warn(_t("Render"),_t("No value found for the field "+self.field.string+" for value "+self.get("value")));return;}
self.display_value[""+self.get("value")]=data[0][1];self.render_value(true);}).fail(function(data,event){event.preventDefault();self.display_value[""+self.get("value")]=self.display_value_backup[""+self.get("value")];self.render_value(true);});if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(def);}}},display_string:function(str){var self=this;if(!this.get("effective_readonly")){this.$input.val(str.split("\n")[0]);this.current_display=this.$input.val();if(this.is_false()){this.$('.oe_m2o_cm_button').css({'display':'none'});}else{this.$('.oe_m2o_cm_button').css({'display':'inline'});}}else{var lines=_.escape(str).split("\n");var link="";var follow="";link=lines[0];follow=_.rest(lines).join("<br />");if(follow)
link+="<br />";var $link=this.$el.find('.oe_form_uri').unbind('click').html(link);if(!this.options.no_open)
$link.click(function(){var context=self.build_context().eval();var model_obj=new instance.web.Model(self.field.relation);model_obj.call('get_formview_action',[self.get("value"),context]).then(function(action){self.do_action(action);});return false;});$(".oe_form_m2o_follow",this.$el).html(follow);}},set_value:function(value_){var self=this;if(value_ instanceof Array){this.display_value={};this.display_value_backup={};if(!this.options.always_reload){this.display_value[""+value_[0]]=value_[1];}
else{this.display_value_backup[""+value_[0]]=value_[1];}
value_=value_[0];}
value_=value_||false;this.reinit_value(value_);},get_displayed:function(){return this.display_value[""+this.get("value")];},add_id:function(id){this.display_value={};this.display_value_backup={};this.reinit_value(id);},is_false:function(){return!this.get("value");},focus:function(){var input=!this.get('effective_readonly')&&this.$input&&this.$input[0];return input?input.focus():false;},_quick_create:function(){this.no_ed=true;this.ed_def.reject();return instance.web.form.CompletionFieldMixin._quick_create.apply(this,arguments);},_search_create_popup:function(){this.no_ed=true;this.ed_def.reject();this.ignore_focusout=true;this.reinit_value(false);var res=instance.web.form.CompletionFieldMixin._search_create_popup.apply(this,arguments);this.ignore_focusout=false;this.no_ed=false;return res;},set_dimensions:function(height,width){this._super(height,width);if(!this.get("effective_readonly")&&this.$input)
this.$input.css('height',height);}});instance.web.form.Many2OneButton=instance.web.form.AbstractField.extend({template:'Many2OneButton',init:function(field_manager,node){this._super.apply(this,arguments);},start:function(){this._super.apply(this,arguments);this.set_button();},set_button:function(){var self=this;if(this.$button){this.$button.remove();}
this.string='';this.node.attrs.icon=this.get('value')?'/web/static/src/img/icons/gtk-yes.png':'/web/static/src/img/icons/gtk-no.png';this.$button=$(QWeb.render('WidgetButton',{'widget':this}));this.$button.addClass('oe_link').css({'padding':'4px'});this.$el.append(this.$button);this.$button.on('click',self.on_click);},on_click:function(ev){var self=this;this.popup=new instance.web.form.FormOpenPopup(this);this.popup.show_element(this.field.relation,this.get('value'),this.build_context(),{title:this.string});this.popup.on('create_completed',self,function(r){self.set_value(r);});},set_value:function(value_){var self=this;if(value_ instanceof Array){value_=value_[0];}
value_=value_||false;this.set('value',value_);this.set_button();},});instance.web.form.AddAnItemList=instance.web.ListView.List.extend({pad_table_to:function(count){if(!this.view.is_action_enabled('create')||this.is_readonly()){this._super(count);return;}
this._super(count>0?count-1:0);var self=this;var columns=_(this.columns).filter(function(column){return column.invisible!=='1';}).length;if(this.options.selectable){columns++;}
if(this.options.deletable){columns++;}
var $cell=$('<td>',{colspan:columns,'class':this._add_row_class||''}).append($('<a>',{href:'#'}).text(_t("Add an item")).mousedown(function(){if(self.view.editor.is_editing()){self.view.__ignore_blur=true;}}).click(function(e){e.preventDefault();e.stopPropagation();if(self.view.editor.form.__blur_timeout){clearTimeout(self.view.editor.form.__blur_timeout);self.view.editor.form.__blur_timeout=false;}
self.view.ensure_saved().done(function(){self.view.do_add_record();});}));var $padding=this.$current.find('tr:not([data-id]):first');var $newrow=$('<tr>').append($cell);if($padding.length){$padding.before($newrow);}else{this.$current.append($newrow)}}});var commands={CREATE:0,'create':function(values){return[commands.CREATE,false,values];},UPDATE:1,'update':function(id,values){return[commands.UPDATE,id,values];},DELETE:2,'delete':function(id){return[commands.DELETE,id,false];},FORGET:3,'forget':function(id){return[commands.FORGET,id,false];},LINK_TO:4,'link_to':function(id){return[commands.LINK_TO,id,false];},DELETE_ALL:5,'delete_all':function(){return[5,false,false];},REPLACE_WITH:6,'replace_with':function(ids){return[6,false,ids];}};instance.web.form.FieldOne2Many=instance.web.form.AbstractField.extend({multi_selection:false,disable_utility_classes:true,init:function(field_manager,node){this._super(field_manager,node);lazy_build_o2m_kanban_view();this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;this.form_last_update=$.Deferred();this.init_form_last_update=this.form_last_update;this.is_started=false;this.dataset=new instance.web.form.One2ManyDataSet(this,this.field.relation);this.dataset.o2m=this;this.dataset.parent_view=this.view;this.dataset.child_name=this.name;var self=this;this.dataset.on('dataset_changed',this,function(){self.trigger_on_change();});this.set_value([]);},start:function(){this._super.apply(this,arguments);this.$el.addClass('oe_form_field oe_form_field_one2many');var self=this;self.load_views();var destroy=function(){self.is_loaded=self.is_loaded.then(function(){self.viewmanager.destroy();return $.when(self.load_views()).done(function(){self.reload_current_view();});});};this.is_loaded.done(function(){self.on("change:effective_readonly",self,destroy);});this.view.on("on_button_cancel",self,destroy);this.is_started=true;this.reload_current_view();},trigger_on_change:function(){this.trigger('changed_value');},load_views:function(){var self=this;var modes=this.node.attrs.mode;modes=!!modes?modes.split(","):["tree"];var views=[];_.each(modes,function(mode){if(!_.include(["list","tree","graph","kanban"],mode)){throw new Error(_.str.sprintf(_t("View type '%s' is not supported in One2Many."),mode));}
var view={view_id:false,view_type:mode=="tree"?"list":mode,options:{}};if(self.field.views&&self.field.views[mode]){view.embedded_view=self.field.views[mode];}
if(view.view_type==="list"){_.extend(view.options,{addable:null,selectable:self.multi_selection,sortable:true,import_enabled:false,deletable:true});if(self.get("effective_readonly")){_.extend(view.options,{deletable:null,reorderable:false,});}}else if(view.view_type==="form"){if(self.get("effective_readonly")){view.view_type='form';}
_.extend(view.options,{not_interactible_on_create:true,});}else if(view.view_type==="kanban"){_.extend(view.options,{confirm_on_delete:false,});if(self.get("effective_readonly")){_.extend(view.options,{action_buttons:false,quick_creatable:false,creatable:false,read_only_mode:true,});}}
views.push(view);});this.views=views;this.viewmanager=new instance.web.form.One2ManyViewManager(this,this.dataset,views,{});this.viewmanager.o2m=self;var once=$.Deferred().done(function(){self.init_form_last_update.resolve();});var def=$.Deferred().done(function(){self.initial_is_loaded.resolve();});this.viewmanager.on("controller_inited",self,function(view_type,controller){controller.o2m=self;if(view_type=="list"){if(self.get("effective_readonly")){controller.on('edit:before',self,function(e){e.cancel=true;});_(controller.columns).find(function(column){if(!(column instanceof instance.web.list.Handle)){return false;}
column.modifiers.invisible=true;return true;});}}else if(view_type==="form"){if(self.get("effective_readonly")){$(".oe_form_buttons",controller.$el).children().remove();}
controller.on("load_record",self,function(){once.resolve();});controller.on('pager_action_executed',self,self.save_any_view);}else if(view_type=="graph"){self.reload_current_view();}
def.resolve();});this.viewmanager.on("switch_mode",self,function(n_mode,b,c,d,e){$.when(self.save_any_view()).done(function(){if(n_mode==="list"){$.async_when().done(function(){self.reload_current_view();});}});});$.async_when().done(function(){self.viewmanager.appendTo(self.$el);});return def;},reload_current_view:function(){var self=this;self.is_loaded=self.is_loaded.then(function(){var view=self.get_active_view();if(view.type==="list"){return view.controller.reload_content();}else if(view.type==="form"){if(self.dataset.index===null&&self.dataset.ids.length>=1){self.dataset.index=0;}
var act=function(){return view.controller.do_show();};self.form_last_update=self.form_last_update.then(act,act);return self.form_last_update;}else if(view.controller.do_search){return view.controller.do_search(self.build_domain(),self.dataset.get_context(),[]);}},undefined);return self.is_loaded;},get_active_view:function(){if(this.viewmanager&&this.viewmanager.views&&this.viewmanager.active_view&&this.viewmanager.views[this.viewmanager.active_view]&&this.viewmanager.views[this.viewmanager.active_view].controller){return{type:this.viewmanager.active_view,controller:this.viewmanager.views[this.viewmanager.active_view].controller};}},set_value:function(value_){value_=value_||[];var self=this;var view=this.get_active_view();this.dataset.reset_ids([]);var ids;if(value_.length>=1&&value_[0]instanceof Array){ids=[];_.each(value_,function(command){var obj={values:command[2]};switch(command[0]){case commands.CREATE:obj['id']=_.uniqueId(self.dataset.virtual_id_prefix);obj.defaults={};self.dataset.to_create.push(obj);self.dataset.cache.push(_.extend(_.clone(obj),{values:_.clone(command[2])}));ids.push(obj.id);return;case commands.UPDATE:obj['id']=command[1];self.dataset.to_write.push(obj);self.dataset.cache.push(_.extend(_.clone(obj),{values:_.clone(command[2])}));ids.push(obj.id);return;case commands.DELETE:self.dataset.to_delete.push({id:command[1]});return;case commands.LINK_TO:ids.push(command[1]);return;case commands.DELETE_ALL:self.dataset.delete_all=true;return;}});this._super(ids);this.dataset.set_ids(ids);}else if(value_.length>=1&&typeof(value_[0])==="object"){ids=[];this.dataset.delete_all=true;_.each(value_,function(command){var obj={values:command};obj['id']=_.uniqueId(self.dataset.virtual_id_prefix);obj.defaults={};self.dataset.to_create.push(obj);self.dataset.cache.push(_.clone(obj));ids.push(obj.id);});this._super(ids);this.dataset.set_ids(ids);}else{this._super(value_);this.dataset.reset_ids(value_);}
if(this.dataset.index===null&&this.dataset.ids.length>0){this.dataset.index=0;}
this.trigger_on_change();if(this.is_started&&!this.no_rerender){return self.reload_current_view();}else{return $.when();}},get_value:function(){var self=this;if(!this.dataset)
return[];var val=this.dataset.delete_all?[commands.delete_all()]:[];val=val.concat(_.map(this.dataset.ids,function(id){var alter_order=_.detect(self.dataset.to_create,function(x){return x.id===id;});if(alter_order){return commands.create(alter_order.values);}
alter_order=_.detect(self.dataset.to_write,function(x){return x.id===id;});if(alter_order){return commands.update(alter_order.id,alter_order.values);}
return commands.link_to(id);}));return val.concat(_.map(this.dataset.to_delete,function(x){return commands['delete'](x.id);}));},commit_value:function(){return this.save_any_view();},save_any_view:function(){var view=this.get_active_view();if(view){if(this.viewmanager.active_view==="form"){if(view.controller.is_initialized.state()!=='resolved'){return $.when(false);}
return $.when(view.controller.save());}else if(this.viewmanager.active_view==="list"){return $.when(view.controller.ensure_saved());}}
return $.when(false);},is_syntax_valid:function(){var view=this.get_active_view();if(!view){return true;}
switch(this.viewmanager.active_view){case'form':return _(view.controller.fields).chain().invoke('is_valid').all(_.identity).value();case'list':return view.controller.is_valid();}
return true;},});instance.web.form.One2ManyViewManager=instance.web.ViewManager.extend({template:'One2Many.viewmanager',init:function(parent,dataset,views,flags){this._super(parent,dataset,views,_.extend({},flags,{$sidebar:false}));this.registry=this.registry.extend({list:'instance.web.form.One2ManyListView',form:'instance.web.form.One2ManyFormView',kanban:'instance.web.form.One2ManyKanbanView',});this.__ignore_blur=false;},switch_mode:function(mode,unused){if(mode!=='form'){return this._super(mode,unused);}
var self=this;var id=self.o2m.dataset.index!==null?self.o2m.dataset.ids[self.o2m.dataset.index]:null;var pop=new instance.web.form.FormOpenPopup(this);pop.show_element(self.o2m.field.relation,id,self.o2m.build_context(),{title:_t("Open: ")+self.o2m.string,create_function:function(data,options){return self.o2m.dataset.create(data,options).done(function(r){self.o2m.dataset.set_ids(self.o2m.dataset.ids.concat([r]));self.o2m.dataset.trigger("dataset_changed",r);});},write_function:function(id,data,options){return self.o2m.dataset.write(id,data,{}).done(function(){self.o2m.reload_current_view();});},alternative_form_view:self.o2m.field.views?self.o2m.field.views["form"]:undefined,parent_view:self.o2m.view,child_name:self.o2m.name,read_function:function(){return self.o2m.dataset.read_ids.apply(self.o2m.dataset,arguments);},form_view_options:{'not_interactible_on_create':true},readonly:self.o2m.get("effective_readonly")});pop.on("elements_selected",self,function(){self.o2m.reload_current_view();});},});instance.web.form.One2ManyDataSet=instance.web.BufferedDataSet.extend({get_context:function(){this.context=this.o2m.build_context();return this.context;}});instance.web.form.One2ManyListView=instance.web.ListView.extend({_template:'One2Many.listview',init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,_.extend(options||{},{GroupsType:instance.web.form.One2ManyGroups,ListType:instance.web.form.One2ManyList}));this.on('edit:after',this,this.proxy('_after_edit'));this.on('save:before cancel:before',this,this.proxy('_before_unedit'));this.records.bind('add',this.proxy("changed_records")).bind('edit',this.proxy("changed_records")).bind('remove',this.proxy("changed_records"));},start:function(){var ret=this._super();this.$el.off('mousedown.handleButtons').on('mousedown.handleButtons','table button, div a.oe_m2o_cm_button',this.proxy('_button_down'));return ret;},changed_records:function(){this.o2m.trigger_on_change();},is_valid:function(){var self=this;if(!this.fields_view||!this.editable()){return true;}
var r;if(_.isEmpty(this.records.records)){return true;}
current_values={};_.each(this.editor.form.fields,function(field){field._inhibit_on_change_flag=true;field.no_rerender=true;current_values[field.name]=field.get('value');});var valid=_.every(this.records.records,function(record){r=record;_.each(self.editor.form.fields,function(field){field.set_value(r.attributes[field.name]);});return _.every(self.editor.form.fields,function(field){field.process_modifiers();field._check_css_flags();return field.is_valid();});});_.each(this.editor.form.fields,function(field){field.set('value',current_values[field.name]);field._inhibit_on_change_flag=false;field.no_rerender=false;});return valid;},do_add_record:function(){if(this.editable()){this._super.apply(this,arguments);}else{var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(self.o2m.field.relation,{title:_t("Create: ")+self.o2m.string,initial_view:"form",alternative_form_view:self.o2m.field.views?self.o2m.field.views["form"]:undefined,create_function:function(data,options){return self.o2m.dataset.create(data,options).done(function(r){self.o2m.dataset.set_ids(self.o2m.dataset.ids.concat([r]));self.o2m.dataset.trigger("dataset_changed",r);});},read_function:function(){return self.o2m.dataset.read_ids.apply(self.o2m.dataset,arguments);},parent_view:self.o2m.view,child_name:self.o2m.name,form_view_options:{'not_interactible_on_create':true}},self.o2m.build_domain(),self.o2m.build_context());pop.on("elements_selected",self,function(){self.o2m.reload_current_view();});}},do_activate_record:function(index,id){var self=this;var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.o2m.field.relation,id,self.o2m.build_context(),{title:_t("Open: ")+self.o2m.string,write_function:function(id,data){return self.o2m.dataset.write(id,data,{}).done(function(){self.o2m.reload_current_view();});},alternative_form_view:self.o2m.field.views?self.o2m.field.views["form"]:undefined,parent_view:self.o2m.view,child_name:self.o2m.name,read_function:function(){return self.o2m.dataset.read_ids.apply(self.o2m.dataset,arguments);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||self.o2m.get("effective_readonly")});},do_button_action:function(name,id,callback){if(!_.isNumber(id)){instance.webclient.notification.warn(_t("Action Button"),_t("The o2m record must be saved before an action can be used"));return;}
var parent_form=this.o2m.view;var self=this;this.ensure_saved().then(function(){if(parent_form)
return parent_form.save();else
return $.when();}).done(function(){var ds=self.o2m.dataset;var cached_records=_.any([ds.to_create,ds.to_delete,ds.to_write],function(value){return value.length;});if(!self.o2m.options.reload_on_button&&!cached_records){self.handle_button(name,id,callback);}else{self.handle_button(name,id,function(){self.o2m.view.reload();});}});},_after_edit:function(){this.__ignore_blur=false;this.editor.form.on('blurred',this,this._on_form_blur);this.editor.form.widgetFocused();},_before_unedit:function(){this.editor.form.off('blurred',this,this._on_form_blur);},_button_down:function(){this.__ignore_blur=true;},_on_form_blur:function(){if(this.__ignore_blur){this.__ignore_blur=false;return;}
if(this.editor.form.$el.hasClass('oe_form_dirty')){this.ensure_saved();return;}
this.cancel_edition();},keypress_ENTER:function(){this.__ignore_blur=true;this._super.apply(this,arguments);},do_delete:function(ids){var confirm=window.confirm;window.confirm=function(){return true;};try{return this._super(ids);}finally{window.confirm=confirm;}},reload_record:function(record){this.dataset.evict_record(record.get('id'));return this._super(record);}});instance.web.form.One2ManyGroups=instance.web.ListView.Groups.extend({setup_resequence_rows:function(){if(!this.view.o2m.get('effective_readonly')){this._super.apply(this,arguments);}}});instance.web.form.One2ManyList=instance.web.form.AddAnItemList.extend({_add_row_class:'oe_form_field_one2many_list_row_add',is_readonly:function(){return this.view.o2m.get('effective_readonly');},});instance.web.form.One2ManyFormView=instance.web.FormView.extend({form_template:'One2Many.formview',load_form:function(data){this._super(data);var self=this;this.$buttons.find('button.oe_form_button_create').click(function(){self.save().done(self.on_button_new);});},do_notify_change:function(){if(this.dataset.parent_view){this.dataset.parent_view.do_notify_change();}else{this._super.apply(this,arguments);}}});var lazy_build_o2m_kanban_view=function(){if(!instance.web_kanban||instance.web.form.One2ManyKanbanView)
return;instance.web.form.One2ManyKanbanView=instance.web_kanban.KanbanView.extend({});};instance.web.form.FieldMany2ManyTags=instance.web.form.AbstractField.extend(instance.web.form.CompletionFieldMixin,instance.web.form.ReinitializeFieldMixin,{template:"FieldMany2ManyTags",tag_template:"FieldMany2ManyTag",init:function(){this._super.apply(this,arguments);instance.web.form.CompletionFieldMixin.init.call(this);this.set({"value":[]});this._display_orderer=new instance.web.DropMisordered();this._drop_shown=false;},initialize_texttext:function(){var self=this;return{plugins:'tags arrow autocomplete',autocomplete:{render:function(suggestion){return $('<span class="text-label"/>').data('index',suggestion['index']).html(suggestion['label']);}},ext:{autocomplete:{selectFromDropdown:function(){this.trigger('hideDropdown');var index=Number(this.selectedSuggestionElement().children().children().data('index'));var data=self.search_result[index];if(data.id){self.add_id(data.id);}else{self.ignore_blur=true;data.action();}
this.trigger('setSuggestions',{result:[]});},},tags:{isTagAllowed:function(tag){return!!tag.name;},removeTag:function(tag){var id=tag.data("id");self.set({"value":_.without(self.get("value"),id)});},renderTag:function(stuff){return $.fn.textext.TextExtTags.prototype.renderTag.call(this,stuff).data("id",stuff.id);},},itemManager:{itemToString:function(item){return item.name;},},core:{onSetInputData:function(e,data){if(data===''){this._plugins.autocomplete._suggestions=null;}
this.input().val(data);},},},}},initialize_content:function(){if(this.get("effective_readonly"))
return;var self=this;self.ignore_blur=false;self.$text=this.$("textarea");self.$text.textext(self.initialize_texttext()).bind('getSuggestions',function(e,data){var _this=this;var str=!!data?data.query||'':'';self.get_search_result(str).done(function(result){self.search_result=result;$(_this).trigger('setSuggestions',{result:_.map(result,function(el,i){return _.extend(el,{index:i});})});});}).bind('hideDropdown',function(){self._drop_shown=false;}).bind('showDropdown',function(){self._drop_shown=true;});self.tags=self.$text.textext()[0].tags();self.$text.focusin(function(){self.trigger('focused');self.ignore_blur=false;}).focusout(function(){self.$text.trigger("setInputData","");if(!self.ignore_blur){self.trigger('blurred');}}).keydown(function(e){if(e.which===$.ui.keyCode.TAB&&self._drop_shown){self.$text.textext()[0].autocomplete().selectFromDropdown();}});},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){var val=[];_.each(value_,function(command){if(command[0]===commands.LINK_TO){val.push(command[1]);}else if(command[0]===commands.REPLACE_WITH){val=command[2];}});value_=val;}
this._super(value_);},is_false:function(){return _(this.get("value")).isEmpty();},get_value:function(){var tmp=[commands.replace_with(this.get("value"))];return tmp;},get_search_blacklist:function(){return this.get("value");},map_tag:function(data){return _.map(data,function(el){return{name:el[1],id:el[0]};})},get_render_data:function(ids){var self=this;var dataset=new instance.web.DataSetStatic(this,this.field.relation,self.build_context());return dataset.name_get(ids);},render_tag:function(data){var self=this;if(!self.get("effective_readonly")){self.tags.containerElement().children().remove();self.$('textarea').css("padding-left","3px");self.tags.addTags(self.map_tag(data));}else{self.$el.html(QWeb.render(self.tag_template,{elements:data}));}},render_value:function(){var self=this;var dataset=new instance.web.DataSetStatic(this,this.field.relation,self.build_context());var values=self.get("value");var handle_names=function(data){if(self.isDestroyed())
return;var indexed={};_.each(data,function(el){indexed[el[0]]=el;});data=_.map(values,function(el){return indexed[el];});self.render_tag(data);}
if(!values||values.length>0){return this._display_orderer.add(self.get_render_data(values)).done(handle_names);}else{handle_names([]);}},add_id:function(id){this.set({'value':_.uniq(this.get('value').concat([id]))});},focus:function(){var input=this.$text&&this.$text[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);this.$("textarea").css({width:width,minHeight:height});},_search_create_popup:function(){self.ignore_blur=true;return instance.web.form.CompletionFieldMixin._search_create_popup.apply(this,arguments);},});instance.web.form.FieldMany2Many=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{multi_selection:false,disable_utility_classes:true,init:function(field_manager,node){this._super(field_manager,node);this.is_loaded=$.Deferred();this.dataset=new instance.web.form.Many2ManyDataSet(this,this.field.relation);this.dataset.m2m=this;var self=this;this.dataset.on('unlink',self,function(ids){self.dataset_changed();});this.set_value([]);this.list_dm=new instance.web.DropMisordered();this.render_value_dm=new instance.web.DropMisordered();},initialize_content:function(){var self=this;this.$el.addClass('oe_form_field oe_form_field_many2many');this.list_view=new instance.web.form.Many2ManyListView(this,this.dataset,false,{'addable':null,'deletable':this.get("effective_readonly")?false:true,'selectable':this.multi_selection,'sortable':false,'reorderable':false,'import_enabled':false,});var embedded=(this.field.views||{}).tree;if(embedded){this.list_view.set_embedded_view(embedded);}
this.list_view.m2m_field=this;var loaded=$.Deferred();this.list_view.on("list_view_loaded",this,function(){loaded.resolve();});this.list_view.appendTo(this.$el);var old_def=self.is_loaded;self.is_loaded=$.Deferred().done(function(){old_def.resolve();});this.list_dm.add(loaded).then(function(){self.is_loaded.resolve();});},destroy_content:function(){this.list_view.destroy();this.list_view=undefined;},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){var val=[];_.each(value_,function(command){if(command[0]===commands.LINK_TO){val.push(command[1]);}else if(command[0]===commands.REPLACE_WITH){val=command[2];}});value_=val;}
this._super(value_);},get_value:function(){return[commands.replace_with(this.get('value'))];},is_false:function(){return _(this.get("value")).isEmpty();},render_value:function(){var self=this;this.dataset.set_ids(this.get("value"));this.render_value_dm.add(this.is_loaded).then(function(){return self.list_view.reload_content();});},dataset_changed:function(){this.internal_set_value(this.dataset.ids);},});instance.web.form.Many2ManyDataSet=instance.web.DataSetStatic.extend({get_context:function(){this.context=this.m2m.build_context();return this.context;}});instance.web.form.Many2ManyListView=instance.web.ListView.extend({init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,_.extend(options||{},{ListType:instance.web.form.Many2ManyList,}));},do_add_record:function(){var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(this.model,{title:_t("Add: ")+this.m2m_field.string,no_create:this.m2m_field.options.no_create,},new instance.web.CompoundDomain(this.m2m_field.build_domain(),["!",["id","in",this.m2m_field.dataset.ids]]),this.m2m_field.build_context());var self=this;pop.on("elements_selected",self,function(element_ids){var reload=false;_(element_ids).each(function(id){if(!_.detect(self.dataset.ids,function(x){return x==id;})){self.dataset.set_ids(self.dataset.ids.concat([id]));self.m2m_field.dataset_changed();reload=true;}});if(reload){self.reload_content();}});},do_activate_record:function(index,id){var self=this;var pop=new instance.web.form.FormOpenPopup(this);pop.show_element(this.dataset.model,id,this.m2m_field.build_context(),{title:_t("Open: ")+this.m2m_field.string,readonly:this.getParent().get("effective_readonly")});pop.on('write_completed',self,self.reload_content);},do_button_action:function(name,id,callback){var self=this;var _sup=_.bind(this._super,this);if(!this.m2m_field.options.reload_on_button){return _sup(name,id,callback);}else{return this.m2m_field.view.save().then(function(){return _sup(name,id,function(){self.m2m_field.view.reload();});});}},is_action_enabled:function(){return true;},});instance.web.form.Many2ManyList=instance.web.form.AddAnItemList.extend({_add_row_class:'oe_form_field_many2many_list_row_add',is_readonly:function(){return this.view.m2m_field.get('effective_readonly');}});instance.web.form.FieldMany2ManyKanban=instance.web.form.AbstractField.extend(instance.web.form.CompletionFieldMixin,{disable_utility_classes:true,init:function(field_manager,node){this._super(field_manager,node);instance.web.form.CompletionFieldMixin.init.call(this);m2m_kanban_lazy_init();this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;var self=this;this.dataset=new instance.web.form.Many2ManyDataSet(this,this.field.relation);this.dataset.m2m=this;this.dataset.on('unlink',self,function(ids){self.dataset_changed();});},start:function(){this._super.apply(this,arguments);var self=this;self.load_view();self.on("change:effective_readonly",self,function(){self.is_loaded=self.is_loaded.then(function(){self.kanban_view.destroy();return $.when(self.load_view()).done(function(){self.render_value();});});});},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){var val=[];_.each(value_,function(command){if(command[0]===commands.LINK_TO){val.push(command[1]);}else if(command[0]===commands.REPLACE_WITH){val=command[2];}});value_=val;}
this._super(value_);},get_value:function(){return[commands.replace_with(this.get('value'))];},load_view:function(){var self=this;this.kanban_view=new instance.web.form.Many2ManyKanbanView(this,this.dataset,false,{'create_text':_t("Add"),'creatable':self.get("effective_readonly")?false:true,'quick_creatable':self.get("effective_readonly")?false:true,'read_only_mode':self.get("effective_readonly")?true:false,'confirm_on_delete':false,});var embedded=(this.field.views||{}).kanban;if(embedded){this.kanban_view.set_embedded_view(embedded);}
this.kanban_view.m2m=this;var loaded=$.Deferred();this.kanban_view.on("kanban_view_loaded",self,function(){self.initial_is_loaded.resolve();loaded.resolve();});this.kanban_view.on('switch_mode',this,this.open_popup);$.async_when().done(function(){self.kanban_view.appendTo(self.$el);});return loaded;},render_value:function(){var self=this;this.dataset.set_ids(this.get("value"));this.is_loaded=this.is_loaded.then(function(){return self.kanban_view.do_search(self.build_domain(),self.dataset.get_context(),[]);});},dataset_changed:function(){this.set({'value':this.dataset.ids});},open_popup:function(type,unused){if(type!=="form")
return;var self=this;var pop;if(this.dataset.index===null){pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(this.field.relation,{title:_t("Add: ")+this.string},new instance.web.CompoundDomain(this.build_domain(),["!",["id","in",this.dataset.ids]]),this.build_context());pop.on("elements_selected",self,function(element_ids){_.each(element_ids,function(one_id){if(!_.detect(self.dataset.ids,function(x){return x==one_id;})){self.dataset.set_ids([].concat(self.dataset.ids,[one_id]));self.dataset_changed();self.render_value();}});});}else{var id=self.dataset.ids[self.dataset.index];pop=new instance.web.form.FormOpenPopup(this);pop.show_element(self.field.relation,id,self.build_context(),{title:_t("Open: ")+self.string,write_function:function(id,data,options){return self.dataset.write(id,data,{}).done(function(){self.render_value();});},alternative_form_view:self.field.views?self.field.views["form"]:undefined,parent_view:self.view,child_name:self.name,readonly:self.get("effective_readonly")});}},add_id:function(id){this.quick_create.add_id(id);},});function m2m_kanban_lazy_init(){if(instance.web.form.Many2ManyKanbanView)
return;instance.web.form.Many2ManyKanbanView=instance.web_kanban.KanbanView.extend({quick_create_class:'instance.web.form.Many2ManyQuickCreate',_is_quick_create_enabled:function(){return this._super()&&!this.group_by;},});instance.web.form.Many2ManyQuickCreate=instance.web.Widget.extend({template:'Many2ManyKanban.quick_create',init:function(parent,dataset,context,buttons){this._super(parent);this.m2m=this.getParent().view.m2m;this.m2m.quick_create=this;this._dataset=dataset;this._buttons=buttons||false;this._context=context||{};},start:function(){var self=this;self.$text=this.$el.find('input').css("width","200px");self.$text.textext({plugins:'arrow autocomplete',autocomplete:{render:function(suggestion){return $('<span class="text-label"/>').data('index',suggestion['index']).html(suggestion['label']);}},ext:{autocomplete:{selectFromDropdown:function(){$(this).trigger('hideDropdown');var index=Number(this.selectedSuggestionElement().children().children().data('index'));var data=self.search_result[index];if(data.id){self.add_id(data.id);}else{data.action();}},},itemManager:{itemToString:function(item){return item.name;},},},}).bind('getSuggestions',function(e,data){var _this=this;var str=!!data?data.query||'':'';self.m2m.get_search_result(str).done(function(result){self.search_result=result;$(_this).trigger('setSuggestions',{result:_.map(result,function(el,i){return _.extend(el,{index:i});})});});});self.$text.focusout(function(){self.$text.val("");});},focus:function(){this.$text[0].focus();},add_id:function(id){var self=this;self.$text.val("");self.trigger('added',id);this.m2m.dataset_changed();},});}
instance.web.form.AbstractFormPopup=instance.web.Widget.extend({template:"AbstractFormPopup.render",init_popup:function(model,row_id,domain,context,options){this.row_id=row_id;this.model=model;this.domain=domain||[];this.context=context||{};this.options=options;_.defaults(this.options,{});},init_dataset:function(){var self=this;this.created_elements=[];this.dataset=new instance.web.ProxyDataSet(this,this.model,this.context);this.dataset.read_function=this.options.read_function;this.dataset.create_function=function(data,options,sup){var fct=self.options.create_function||sup;return fct.call(this,data,options).done(function(r){self.trigger('create_completed saved',r);self.created_elements.push(r);});};this.dataset.write_function=function(id,data,options,sup){var fct=self.options.write_function||sup;return fct.call(this,id,data,options).done(function(r){self.trigger('write_completed saved',r);});};this.dataset.parent_view=this.options.parent_view;this.dataset.child_name=this.options.child_name;},display_popup:function(){var self=this;this.renderElement();var dialog=new instance.web.Dialog(this,{dialogClass:'oe_act_window',title:this.options.title||"",},this.$el).open();dialog.on('closing',this,function(e){self.check_exit(true);});this.$buttonpane=dialog.$buttons;this.start();},setup_form_view:function(){var self=this;if(this.row_id){this.dataset.ids=[this.row_id];this.dataset.index=0;}else{this.dataset.index=null;}
var options=_.clone(self.options.form_view_options)||{};if(this.row_id!==null){options.initial_mode=this.options.readonly?"view":"edit";}
_.extend(options,{$buttons:this.$buttonpane,});this.view_form=new instance.web.FormView(this,this.dataset,this.options.view_id||false,options);if(this.options.alternative_form_view){this.view_form.set_embedded_view(this.options.alternative_form_view);}
this.view_form.appendTo(this.$el.find(".oe_popup_form"));this.view_form.on("form_view_loaded",self,function(){var multi_select=self.row_id===null&&!self.options.disable_multiple_selection;self.$buttonpane.html(QWeb.render("AbstractFormPopup.buttons",{multi_select:multi_select,readonly:self.row_id!==null&&self.options.readonly,}));var $snbutton=self.$buttonpane.find(".oe_abstractformpopup-form-save-new");$snbutton.click(function(){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.view_form.on_button_new();});});});var $sbutton=self.$buttonpane.find(".oe_abstractformpopup-form-save");$sbutton.click(function(){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.check_exit();});});});var $cbutton=self.$buttonpane.find(".oe_abstractformpopup-form-close");$cbutton.click(function(){self.view_form.trigger('on_button_cancel');self.check_exit();});self.view_form.do_show();});},select_elements:function(element_ids){this.trigger("elements_selected",element_ids);},check_exit:function(no_destroy){if(this.created_elements.length>0){this.select_elements(this.created_elements);this.created_elements=[];}
this.trigger('closed');this.destroy();},destroy:function(){this.trigger('closed');if(this.$el.is(":data(bs.modal)")){this.$el.parents('.modal').modal('hide');}
this._super();},});instance.web.form.FormOpenPopup=instance.web.form.AbstractFormPopup.extend({show_element:function(model,row_id,context,options){this.init_popup(model,row_id,[],context,options);_.defaults(this.options,{});this.display_popup();},start:function(){this._super();this.init_dataset();this.setup_form_view();},});instance.web.form.SelectCreatePopup=instance.web.form.AbstractFormPopup.extend({select_element:function(model,options,domain,context){this.init_popup(model,null,domain,context,options);var self=this;_.defaults(this.options,{initial_view:"search",});this.initial_ids=this.options.initial_ids;this.display_popup();},start:function(){var self=this;this.init_dataset();if(this.options.initial_view=="search"){instance.web.pyeval.eval_domains_and_contexts({domains:[],contexts:[this.context]}).done(function(results){var search_defaults={};_.each(results.context,function(value_,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value_;}});self.setup_search_view(search_defaults);});}else{this.new_object();}},setup_search_view:function(search_defaults){var self=this;if(this.searchview){this.searchview.destroy();}
if(this.searchview_drawer){this.searchview_drawer.destroy();}
this.searchview=new instance.web.SearchView(this,this.dataset,false,search_defaults);this.searchview_drawer=new instance.web.SearchViewDrawer(this,this.searchview);this.searchview.on('search_data',self,function(domains,contexts,groupbys){if(self.initial_ids){self.do_search(domains.concat([[["id","in",self.initial_ids]],self.domain]),contexts.concat(self.context),groupbys);self.initial_ids=undefined;}else{self.do_search(domains.concat([self.domain]),contexts.concat(self.context),groupbys);}});this.searchview.on("search_view_loaded",self,function(){self.view_list=new instance.web.form.SelectCreateListView(self,self.dataset,false,_.extend({'deletable':false,'selectable':!self.options.disable_multiple_selection,'import_enabled':false,'$buttons':self.$buttonpane,'disable_editable_mode':true,'$pager':self.$('.oe_popup_list_pager'),},self.options.list_view_options||{}));self.view_list.on('edit:before',self,function(e){e.cancel=true;});self.view_list.popup=self;self.view_list.appendTo($(".oe_popup_list",self.$el)).then(function(){self.view_list.do_show();}).then(function(){self.searchview.do_search();});self.view_list.on("list_view_loaded",self,function(){self.$buttonpane.html(QWeb.render("SelectCreatePopup.search.buttons",{widget:self}));var $cbutton=self.$buttonpane.find(".oe_selectcreatepopup-search-close");$cbutton.click(function(){self.destroy();});var $sbutton=self.$buttonpane.find(".oe_selectcreatepopup-search-select");$sbutton.click(function(){self.select_elements(self.selected_ids);self.destroy();});$cbutton=self.$buttonpane.find(".oe_selectcreatepopup-search-create");$cbutton.click(function(){self.new_object();});});});this.searchview.appendTo(this.$(".oe_popup_search"));},do_search:function(domains,contexts,groupbys){var self=this;instance.web.pyeval.eval_domains_and_contexts({domains:domains||[],contexts:contexts||[],group_by_seq:groupbys||[]}).done(function(results){self.view_list.do_search(results.domain,results.context,results.group_by);});},on_click_element:function(ids){var self=this;this.selected_ids=ids||[];if(this.selected_ids.length>0){self.$buttonpane.find(".oe_selectcreatepopup-search-select").removeAttr('disabled');}else{self.$buttonpane.find(".oe_selectcreatepopup-search-select").attr('disabled',"disabled");}},new_object:function(){if(this.searchview){this.searchview.hide();}
if(this.view_list){this.view_list.do_hide();}
this.setup_form_view();},});instance.web.form.SelectCreateListView=instance.web.ListView.extend({do_add_record:function(){this.popup.new_object();},select_record:function(index){this.popup.select_elements([this.dataset.ids[index]]);this.popup.destroy();},do_select:function(ids,records){this._super(ids,records);this.popup.on_click_element(ids);}});instance.web.form.FieldReference=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldReference',init:function(field_manager,node){this._super(field_manager,node);this.reference_ready=true;},destroy_content:function(){if(this.fm){this.fm.destroy();this.fm=undefined;}},initialize_content:function(){var self=this;var fm=new instance.web.form.DefaultFieldManager(this);this.fm=fm;fm.extend_field_desc({"selection":{selection:this.field_manager.get_field_desc(this.name).selection,type:"selection",},"m2o":{relation:null,type:"many2one",},});this.selection=new instance.web.form.FieldSelection(fm,{attrs:{name:'selection',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.selection.on("change:value",this,this.on_selection_changed);this.selection.appendTo(this.$(".oe_form_view_reference_selection"));this.selection.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});this.m2o=new instance.web.form.FieldMany2One(fm,{attrs:{name:'Referenced Document',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.m2o.on("change:value",this,this.data_changed);this.m2o.appendTo(this.$(".oe_form_view_reference_m2o"));this.m2o.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});},on_selection_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),false]);this.render_value();}},data_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),this.m2o.get_value()]);}},set_value:function(val){if(val){val=val.split(',');val[0]=val[0]||false;val[1]=val[0]?(val[1]?parseInt(val[1],10):val[1]):false;}
this._super(val||[false,false]);},get_value:function(){return this.get('value')[0]&&this.get('value')[1]?(this.get('value')[0]+','+this.get('value')[1]):false;},render_value:function(){this.reference_ready=false;if(!this.get("effective_readonly")){this.selection.set_value(this.get('value')[0]);}
this.m2o.field.relation=this.get('value')[0];this.m2o.set_value(this.get('value')[1]);this.m2o.$el.toggle(!!this.get('value')[0]);this.reference_ready=true;},});instance.web.form.FieldBinary=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{init:function(field_manager,node){var self=this;this._super(field_manager,node);this.binary_value=false;this.useFileAPI=!!window.FileReader;this.max_upload_size=25*1024*1024;if(!this.useFileAPI){this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},stop:function(){if(!this.useFileAPI){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},initialize_content:function(){var self=this;this.$el.find('input.oe_form_binary_file').change(this.on_file_change);this.$el.find('button.oe_form_binary_file_save').click(this.on_save_as);this.$el.find('.oe_form_binary_file_clear').click(this.on_clear);this.$el.find('.oe_form_binary_file_edit').click(function(event){self.$el.find('input.oe_form_binary_file').click();});},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");instance.webclient.notification.warn(_t("File upload"),_.str.sprintf(msg,instance.web.human_size(this.max_upload_size)));return false;}
var filereader=new FileReader();filereader.readAsDataURL(file);filereader.onloadend=function(upload){var data=upload.target.result;data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);};}else{this.$el.find('form.oe_form_binary_form input[name=session_id]').val(this.session.session_id);this.$el.find('form.oe_form_binary_form').submit();}
this.$el.find('.oe_form_binary_progress').show();this.$el.find('.oe_form_binary').hide();}},on_file_uploaded:function(size,name,content_type,file_base64){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.filename=name;this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$el.find('.oe_form_binary_progress').hide();this.$el.find('.oe_form_binary').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){},on_save_as:function(ev){var value=this.get('value');if(!value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else{instance.web.blockUI();var c=instance.webclient.crashmanager;var filename_fieldname=this.node.attrs.filename;var filename_field=this.view.fields&&this.view.fields[filename_fieldname];this.session.get_file({url:'/web/binary/saveas_ajax',data:{data:JSON.stringify({model:this.view.dataset.model,id:(this.view.datarecord.id||''),field:this.name,filename_field:(filename_fieldname||''),data:instance.web.form.is_bin_size(value)?null:value,filename:filename_field?filename_field.get('value'):null,context:this.view.dataset.get_context()})},complete:instance.web.unblockUI,error:c.rpc_error.bind(c)});ev.stopPropagation();return false;}},set_filename:function(value){var filename=this.node.attrs.filename;if(filename){var tmp={};tmp[filename]=value;this.field_manager.set_values(tmp);}},on_clear:function(){if(this.get('value')!==false){this.binary_value=false;this.internal_set_value(false);}
return false;}});instance.web.form.FieldBinaryFile=instance.web.form.FieldBinary.extend({template:'FieldBinaryFile',initialize_content:function(){this._super();if(this.get("effective_readonly")){var self=this;this.$el.find('a').click(function(ev){if(self.get('value')){self.on_save_as(ev);}
return false;});}},render_value:function(){var show_value;if(!this.get("effective_readonly")){if(this.node.attrs.filename){show_value=this.view.datarecord[this.node.attrs.filename]||'';}else{show_value=(this.get('value')!==null&&this.get('value')!==undefined&&this.get('value')!==false)?this.get('value'):'';}
this.$el.find('input').eq(0).val(show_value);}else{this.$el.find('a').toggle(!!this.get('value'));if(this.get('value')){show_value=_t("Download");if(this.view)
show_value+=" "+(this.view.datarecord[this.node.attrs.filename]||'');this.$el.find('a').text(show_value);}}},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.binary_value=true;this.internal_set_value(file_base64);var show_value=name+" ("+instance.web.human_size(size)+")";this.$el.find('input').eq(0).val(show_value);this.set_filename(name);},on_clear:function(){this._super.apply(this,arguments);this.$el.find('input').eq(0).val('');this.set_filename('');}});instance.web.form.FieldBinaryImage=instance.web.form.FieldBinary.extend({template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",render_value:function(){var self=this;var url;if(this.get('value')&&!instance.web.form.is_bin_size(this.get('value'))){url='data:image/png;base64,'+this.get('value');}else if(this.get('value')){var id=JSON.stringify(this.view.datarecord.id||null);var field=this.name;if(this.options.preview_image)
field=this.options.preview_image;url=this.session.url('/web/binary/image',{model:this.view.dataset.model,id:id,field:field,t:(new Date().getTime()),});}else{url=this.placeholder;}
var $img=$(QWeb.render("FieldBinaryImage-img",{widget:this,url:url}));$($img).click(function(e){if(self.view.get("actual_mode")=="view"){var $button=$(".oe_form_button_edit");$button.openerpBounce();e.stopPropagation();}});this.$el.find('> img').remove();this.$el.prepend($img);$img.load(function(){if(!self.options.size)
return;$img.css("max-width",""+self.options.size[0]+"px");$img.css("max-height",""+self.options.size[1]+"px");});$img.on('error',function(){$img.attr('src',self.placeholder);instance.webclient.notification.warn(_t("Image"),_t("Could not display the selected image."));});},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.internal_set_value(file_base64);this.binary_value=true;this.render_value();this.set_filename(name);},on_clear:function(){this._super.apply(this,arguments);this.render_value();this.set_filename('');},set_value:function(value_){var changed=value_!==this.get_value();this._super.apply(this,arguments);if(!changed){this.trigger("change:value",this,{oldValue:value_,newValue:value_});}}});instance.web.form.FieldMany2ManyBinaryMultiFiles=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:"FieldBinaryFileUploader",init:function(field_manager,node){this._super(field_manager,node);this.field_manager=field_manager;this.node=node;if(this.field.type!="many2many"||this.field.relation!='ir.attachment'){throw _.str.sprintf(_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model."),this.field.string);}
this.data={};this.set_value([]);this.ds_file=new instance.web.DataSetSearch(this,'ir.attachment');this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,_.bind(this.on_file_loaded,this));},initialize_content:function(){this.$el.on('change','input.oe_form_binary_file',this.on_file_change);},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){var val=[];_.each(value_,function(command){if(command[0]===commands.LINK_TO){val.push(command[1]);}else if(command[0]===commands.REPLACE_WITH){val=command[2];}});value_=val;}
this._super(value_);},get_value:function(){var tmp=[commands.replace_with(this.get("value"))];return tmp;},get_file_url:function(attachment){return this.session.url('/web/binary/saveas',{model:'ir.attachment',field:'datas',filename_field:'datas_fname',id:attachment['id']});},read_name_values:function(){var self=this;var ids=this.get('value');var _value=_.filter(ids,function(id){return typeof self.data[id]=='undefined';});if(_value.length){return this.ds_file.call('read',[_value,['id','name','datas_fname']]).then(function(datas){_.each(datas,function(data){data.no_unlink=true;data.url=self.session.url('/web/binary/saveas',{model:'ir.attachment',field:'datas',filename_field:'datas_fname',id:data.id});self.data[data.id]=data;});return ids;});}else{return $.when(ids);}},render_value:function(){var self=this;this.read_name_values().then(function(ids){var render=$(instance.web.qweb.render('FieldBinaryFileUploader.files',{'widget':self,'values':ids}));render.on('click','.oe_delete',_.bind(self.on_file_delete,self));self.$('.oe_placeholder_files, .oe_attachments').replaceWith(render);var $input=self.$('input.oe_form_binary_file');$input.after($input.clone(true)).remove();self.$(".oe_fileupload").show();});},on_file_change:function(event){event.stopPropagation();var self=this;var $target=$(event.target);if($target.val()!==''){var filename=$target.val().replace(/.*[\\\/]/,'');if(self.data[0]&&self.data[0].upload){return false;}
for(var id in this.get('value')){if(self.data[id]&&(self.data[id].filename||self.data[id].name)==filename&&!self.data[id].no_unlink){self.ds_file.unlink([id]);}}
if(this.node.attrs.blockui>0){instance.web.blockUI();}
this.$('form.oe_form_binary_form').submit();this.$(".oe_fileupload").hide();this.data[0]={'id':0,'name':filename,'filename':filename,'url':'','upload':true};}},on_file_loaded:function(event,result){var files=this.get('value');if(this.node.attrs.blockui>0){instance.web.unblockUI();}
if(result.error||!result.id){this.do_warn(_t('Uploading Error'),result.error);delete this.data[0];}else{if(this.data[0]&&this.data[0].filename==result.filename&&this.data[0].upload){delete this.data[0];this.data[result.id]={'id':result.id,'name':result.name,'filename':result.filename,'url':this.get_file_url(result)};}else{this.data[result.id]={'id':result.id,'name':result.name,'filename':result.filename,'url':this.get_file_url(result)};}
var values=_.clone(this.get('value'));values.push(result.id);this.set({'value':values});}
this.render_value();},on_file_delete:function(event){event.stopPropagation();var file_id=$(event.target).data("id");if(file_id){var files=_.filter(this.get('value'),function(id){return id!=file_id;});if(!this.data[file_id].no_unlink){this.ds_file.unlink([file_id]);}
this.set({'value':files});}},});instance.web.form.FieldStatus=instance.web.form.AbstractField.extend({template:"FieldStatus",init:function(field_manager,node){this._super(field_manager,node);this.options.clickable=this.options.clickable||(this.node.attrs||{}).clickable||false;this.options.visible=this.options.visible||(this.node.attrs||{}).statusbar_visible||false;this.set({value:false});this.selection={'unfolded':[],'folded':[]};this.set("selection",{'unfolded':[],'folded':[]});this.selection_dm=new instance.web.DropMisordered();this.dataset=new instance.web.DataSetStatic(this,this.field.relation,this.build_context());},start:function(){this.field_manager.on("view_content_has_changed",this,this.calc_domain);this.calc_domain();this.on("change:value",this,this.get_selection);this.on("change:evaluated_selection_domain",this,this.get_selection);this.on("change:selection",this,function(){this.selection=this.get("selection");this.render_value();});this.get_selection();if(this.options.clickable){this.$el.on('click','li[data-id]',this.on_click_stage);}
if(this.$el.parent().is('header')){this.$el.after('<div class="oe_clear"/>');}
this._super();},set_value:function(value_){if(value_ instanceof Array){value_=value_[0];}
this._super(value_);},render_value:function(){var self=this;var content=QWeb.render("FieldStatus.content",{'widget':self,'value_folded':_.find(self.selection.folded,function(i){return i[0]===self.get('value');})});self.$el.html(content);},calc_domain:function(){var d=instance.web.pyeval.eval('domain',this.build_domain());var domain=[];if(d.length){domain=['|',['id','=',this.get('value')]].concat(d);}
if(!_.isEqual(domain,this.get("evaluated_selection_domain"))){this.set("evaluated_selection_domain",domain);}},get_selection:function(){var self=this;var selection_unfolded=[];var selection_folded=[];var fold_field=this.options.fold_field;var calculation=_.bind(function(){if(this.field.type=="many2one"){return self.get_distant_fields().then(function(fields){return new instance.web.DataSetSearch(self,self.field.relation,self.build_context(),self.get("evaluated_selection_domain")).read_slice(_.union(_.keys(self.distant_fields),['id']),{}).then(function(records){var ids=_.pluck(records,'id');return self.dataset.name_get(ids).then(function(records_name){_.each(records,function(record){var name=_.find(records_name,function(val){return val[0]==record.id;})[1];if(fold_field&&record[fold_field]&&record.id!=self.get('value')){selection_folded.push([record.id,name]);}else{selection_unfolded.push([record.id,name]);}});});});});}else{var select=this.field.selection;for(var i=0;i<select.length;i++){var key=select[i][0];if(key==this.get('value')||!this.options.visible||this.options.visible.indexOf(key)!=-1){selection_unfolded.push(select[i]);}}
return $.when();}},this);this.selection_dm.add(calculation()).then(function(){var selection={'unfolded':selection_unfolded,'folded':selection_folded};if(!_.isEqual(selection,self.get("selection"))){self.set("selection",selection);}});},get_distant_fields:function(){var self=this;if(!this.options.fold_field){this.distant_fields={}}
if(this.distant_fields){return $.when(this.distant_fields);}
return new instance.web.Model(self.field.relation).call("fields_get",[[this.options.fold_field]]).then(function(fields){self.distant_fields=fields;return fields;});},on_click_stage:function(ev){var self=this;var $li=$(ev.currentTarget);var val;if(this.field.type=="many2one"){val=parseInt($li.data("id"),10);}
else{val=$li.data("id");}
if(val!=self.get('value')){this.view.recursive_save().done(function(){var change={};change[self.name]=val;self.view.dataset.write(self.view.datarecord.id,change).done(function(){self.view.reload();});});}},});instance.web.form.FieldMonetary=instance.web.form.FieldFloat.extend({template:"FieldMonetary",widget_class:'oe_form_field_float oe_form_field_monetary',init:function(){this._super.apply(this,arguments);this.set({"currency":false});if(this.options.currency_field){this.field_manager.on("field_changed:"+this.options.currency_field,this,function(){this.set({"currency":this.field_manager.get_field_value(this.options.currency_field)});});}
this.on("change:currency",this,this.get_currency_info);this.get_currency_info();this.ci_dm=new instance.web.DropMisordered();},start:function(){var tmp=this._super();this.on("change:currency_info",this,this.reinitialize);return tmp;},get_currency_info:function(){var self=this;if(this.get("currency")===false){this.set({"currency_info":null});return;}
return this.ci_dm.add(self.alive(new instance.web.Model("res.currency").query(["symbol","position"]).filter([["id","=",self.get("currency")]]).first())).then(function(res){self.set({"currency_info":res});});},parse_value:function(val,def){return instance.web.parse_value(val,{type:"float",digits:(this.node.attrs||{}).digits||this.field.digits},def);},format_value:function(val,def){return instance.web.format_value(val,{type:"float",digits:(this.node.attrs||{}).digits||this.field.digits},def);},});instance.web.form.FieldMany2ManyCheckBoxes=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{className:"oe_form_many2many_checkboxes",init:function(){this._super.apply(this,arguments);this.set("value",{});this.set("records",[]);this.field_manager.on("view_content_has_changed",this,function(){var domain=new openerp.web.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});this.records_orderer=new instance.web.DropMisordered();},initialize_field:function(){instance.web.form.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_records);this.set("domain",new openerp.web.CompoundDomain(this.build_domain()).eval());this.on("change:records",this,this.render_value);},query_records:function(){var self=this;var model=new openerp.Model(openerp.session,this.field.relation);this.records_orderer.add(model.call("search",[this.get("domain")],{"context":this.build_context()}).then(function(record_ids){return model.call("name_get",[record_ids],{"context":self.build_context()});})).then(function(res){self.set("records",res);});},render_value:function(){this.$().html(QWeb.render("FieldMany2ManyCheckBoxes",{widget:this,selected:this.get("value")}));var inputs=this.$("input");inputs.change(_.bind(this.from_dom,this));if(this.get("effective_readonly"))
inputs.attr("disabled","true");},from_dom:function(){var new_value={};this.$("input").each(function(){var elem=$(this);new_value[elem.data("record-id")]=elem.attr("checked")?true:undefined;});if(!_.isEqual(new_value,this.get("value")))
this.internal_set_value(new_value);},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){var val=[];_.each(value_,function(command){if(command[0]===commands.LINK_TO){val.push(command[1]);}else if(command[0]===commands.REPLACE_WITH){val=command[2];}});value_=val;}
var formatted={};_.each(value_,function(el){formatted[JSON.stringify(el)]=true;});this._super(formatted);},get_value:function(){var value=_.filter(_.keys(this.get("value")),function(el){return this.get("value")[el];},this);value=_.map(value,function(el){return JSON.parse(el);});return[commands.replace_with(value)];},});instance.web.form.X2ManyCounter=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{className:"oe_form_x2many_counter",init:function(){this._super.apply(this,arguments);this.set("value",[]);_.defaults(this.options,{"views":[[false,"tree"],[false,"form"]],});},render_value:function(){var text=_.str.sprintf("%d %s",this.val().length,this.string);this.$().html(QWeb.render("X2ManyCounter",{text:text}));this.$("a").click(_.bind(this.go_to,this));},go_to:function(){return this.view.recursive_save().then(_.bind(function(){var val=this.val();var context={};if(this.field.type==="one2many"){context["default_"+this.field.relation_field]=this.view.datarecord.id;}
var domain=[["id","in",val]];return this.do_action({type:'ir.actions.act_window',name:this.string,res_model:this.field.relation,views:this.options.views,target:'current',context:context,domain:domain,});},this));},val:function(){var value=this.get("value")||[];if(value.length>=1&&value[0]instanceof Array){value=value[0][2];}
return value;}});instance.web.form.StatInfo=instance.web.form.AbstractField.extend({is_field_number:true,init:function(){this._super.apply(this,arguments);this.internal_set_value(0);},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
this._super.apply(this,[value_]);},render_value:function(){var options={value:this.get("value")||0,};if(!this.node.attrs.nolabel){options.text=this.string}
this.$el.html(QWeb.render("StatInfo",options));},});instance.web.form.widgets=new instance.web.Registry({'char':'instance.web.form.FieldChar','id':'instance.web.form.FieldID','email':'instance.web.form.FieldEmail','url':'instance.web.form.FieldUrl','text':'instance.web.form.FieldText','html':'instance.web.form.FieldTextHtml','char_domain':'instance.web.form.FieldCharDomain','date':'instance.web.form.FieldDate','datetime':'instance.web.form.FieldDatetime','selection':'instance.web.form.FieldSelection','radio':'instance.web.form.FieldRadio','many2one':'instance.web.form.FieldMany2One','many2onebutton':'instance.web.form.Many2OneButton','many2many':'instance.web.form.FieldMany2Many','many2many_tags':'instance.web.form.FieldMany2ManyTags','many2many_kanban':'instance.web.form.FieldMany2ManyKanban','one2many':'instance.web.form.FieldOne2Many','one2many_list':'instance.web.form.FieldOne2Many','reference':'instance.web.form.FieldReference','boolean':'instance.web.form.FieldBoolean','float':'instance.web.form.FieldFloat','percentpie':'instance.web.form.FieldPercentPie','barchart':'instance.web.form.FieldBarChart','integer':'instance.web.form.FieldFloat','float_time':'instance.web.form.FieldFloat','progressbar':'instance.web.form.FieldProgressBar','image':'instance.web.form.FieldBinaryImage','binary':'instance.web.form.FieldBinaryFile','many2many_binary':'instance.web.form.FieldMany2ManyBinaryMultiFiles','statusbar':'instance.web.form.FieldStatus','monetary':'instance.web.form.FieldMonetary','many2many_checkboxes':'instance.web.form.FieldMany2ManyCheckBoxes','x2many_counter':'instance.web.form.X2ManyCounter','priority':'instance.web.form.Priority','kanban_state_selection':'instance.web.form.KanbanSelection','statinfo':'instance.web.form.StatInfo',});instance.web.form.tags=new instance.web.Registry({'button':'instance.web.form.WidgetButton',});instance.web.form.custom_widgets=new instance.web.Registry({});})();;

/* /web/static/src/js/view_list_editable.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.list_editable={};var _t=instance.web._t;instance.web.ListView.prototype.defaults.editable=null;instance.web.ListView.include({init:function(){var self=this;this._super.apply(this,arguments);this.saving_mutex=new $.Mutex();this._force_editability=null;this._context_editable=false;this.editor=this.make_editor();this.fields_for_resize=[];instance.web.bus.on('resize',this,this.resize_fields);$(this.groups).bind({'edit':function(e,id,dataset){self.do_edit(dataset.index,id,dataset);},'saved':function(){if(self.groups.get_selection().length){return;}
self.configure_pager(self.dataset);self.compute_aggregates();}});this.records.bind('remove',function(){if(self.editor.is_editing()){self.cancel_edition();}});this.on('edit:before',this,function(event){if(!self.editable()||self.editor.is_editing()){event.cancel=true;}});this.on('edit:after',this,function(){self.$el.add(self.$buttons).addClass('oe_editing');self.$('.ui-sortable').sortable('disable');});this.on('save:after cancel:after',this,function(){self.$('.ui-sortable').sortable('enable');self.$el.add(self.$buttons).removeClass('oe_editing');});},destroy:function(){instance.web.bus.off('resize',this,this.resize_fields);this._super();},do_hide:function(){if(this.editor.is_editing()){this.cancel_edition(true);}
this._super();},sort_by_column:function(e){e.stopPropagation();if(!this.editor.is_editing()){this._super.apply(this,arguments);}},do_edit:function(index,id,dataset){_.extend(this.dataset,dataset);},do_delete:function(ids){var nonfalse=_.compact(ids);var _super=this._super.bind(this);var next=this.editor.is_editing()?this.cancel_edition(true):$.when();return next.then(function(){return _super(nonfalse);});},editable:function(){return!this.grouped&&!this.options.disable_editable_mode&&(this.fields_view.arch.attrs.editable||this._context_editable||this.options.editable);},do_search:function(domain,context,group_by){var self=this,_super=self._super,args=arguments;var ready=this.editor.is_editing()?this.cancel_edition(true):$.when();return ready.then(function(){self._context_editable=!!context.set_editable;return _super.apply(self,args);});},do_add_record:function(){var self=this;if(this.editable()){this.$el.find('table:first').show();this.$el.find('.oe_view_nocontent').remove();this.start_edition();}else{this._super();}},load_list:function(data,grouped){var self=this;var result=this._super(data,grouped);this.editor.destroy();this.editor=this.make_editor();if(this.editable()){this.$el.addClass('oe_list_editable');this.$buttons.off('click','.oe_list_save').on('click','.oe_list_save',this.proxy('save_edition')).off('click','.oe_list_discard').on('click','.oe_list_discard',function(e){e.preventDefault();self.cancel_edition();});var editor_ready=this.editor.prependTo(this.$el).done(this.proxy('setup_events'));return $.when(result,editor_ready);}else{this.$el.removeClass('oe_list_editable');}
return result;},make_editor:function(){return new instance.web.list.Editor(this);},do_button_action:function(name,id,callback){var self=this,args=arguments;this.ensure_saved().done(function(done){if(!id&&done.created){id=done.record.get('id');}
self.handle_button(name,id,callback);});},ensure_saved:function(){return this.save_edition();},make_empty_record:function(id){var attrs={id:id};_(this.columns).chain().filter(function(x){return x.tag==='field';}).pluck('name').each(function(field){attrs[field]=false;});return new instance.web.list.Record(attrs);},start_edition:function(record,options){var self=this;var item=false;if(record){item=record.attributes;this.dataset.select_id(record.get('id'));}else{record=this.make_empty_record(false);this.records.add(record,{at:this.prepends_on_create()?0:null});}
return this.ensure_saved().then(function(){return $.when.apply(null,self.editor.form.render_value_defs);}).then(function(){var $recordRow=self.groups.get_row_for(record);var cells=self.get_cells_for($recordRow);var fields={};self.fields_for_resize.splice(0,self.fields_for_resize.length);return self.with_event('edit',{record:record.attributes,cancel:false},function(){return self.editor.edit(item,function(field_name,field){var cell=cells[field_name];if(!cell){return;}
field.$el.attr('data-fieldname',field_name);fields[field_name]=field;self.fields_for_resize.push({field:field,cell:cell});},options).then(function(){$recordRow.addClass('oe_edition');self.resize_fields();var focus_field=options&&options.focus_field?options.focus_field:undefined;if(!focus_field){focus_field=_.find(self.editor.form.fields_order,function(field){return fields[field]&&fields[field].$el.is(':visible:has(input)');});}
if(focus_field&&fields[focus_field])fields[focus_field].$el.find('input').select();return record.attributes;});}).fail(function(){if(!record.get('id')){self.records.remove(record);}});});},get_cells_for:function($row){var cells={};$row.children('td').each(function(index,el){cells[el.getAttribute('data-field')]=el;});return cells;},resize_fields:function(){if(!this.editor.is_editing()){return;}
for(var i=0,len=this.fields_for_resize.length;i<len;++i){var item=this.fields_for_resize[i];this.resize_field(item.field,item.cell);}},resize_field:function(field,cell){var $cell=$(cell);field.set_dimensions($cell.outerHeight(),$cell.outerWidth());field.$el.position({my:'left top',at:'left top',of:$cell});if(field.get('effective_readonly')){field.$el.addClass('oe_readonly');}
if(field.widget=="handle")
field.$el.addClass('oe_list_field_handle');},save_edition:function(){var self=this;return self.saving_mutex.exec(function(){if(!self.editor.is_editing()){return $.when();}
return self.with_event('save',{editor:self.editor,form:self.editor.form,cancel:false},function(){return self.editor.save().then(function(attrs){var created=false;var record=self.records.get(attrs.id);if(!record){created=true;record=self.records.find(function(r){return!r.get('id');}).set('id',attrs.id);}
return self.handle_onwrite(record).then(function(){return self.reload_record(record);}).then(function(){return{created:created,record:record};});});});});},cancel_edition:function(force){var self=this;return this.with_event('cancel',{editor:this.editor,form:this.editor.form,cancel:false},function(){return this.editor.cancel(force).then(function(attrs){if(attrs.id){var record=self.records.get(attrs.id);if(!record){return;}
return self.reload_record(record);}
var to_delete=self.records.find(function(r){return!r.get('id');});if(to_delete){self.records.remove(to_delete);}});});},with_event:function(event_name,event,action){var self=this;event=event||{};this.trigger(event_name+':before',event);if(event.cancel){return $.Deferred().reject({message:_.str.sprintf("Event %s:before cancelled",event_name)});}
return $.when(action.call(this)).done(function(){self.trigger.apply(self,[event_name+':after'].concat(_.toArray(arguments)));});},edition_view:function(editor){var view=$.extend(true,{},this.fields_view);view.arch.tag='form';_.extend(view.arch.attrs,{'class':'oe_form_container',version:'7.0'});_(view.arch.children).chain().zip(_(this.columns).filter(function(c){return!(c instanceof instance.web.list.MetaColumn);})).each(function(ar){var widget=ar[0],column=ar[1];var modifiers=_.extend({},column.modifiers);widget.attrs.nolabel=true;if(modifiers['tree_invisible']||widget.tag==='button'){modifiers.invisible=true;}
widget.attrs.modifiers=JSON.stringify(modifiers);});return view;},handle_onwrite:function(source_record){var self=this;var on_write_callback=self.fields_view.arch.attrs.on_write;if(!on_write_callback){return $.when();}
return this.dataset.call(on_write_callback,[source_record.get('id')]).then(function(ids){return $.when.apply(null,_(ids).map(_.bind(self.handle_onwrite_record,self,source_record)));});},handle_onwrite_record:function(source_record,id){var record=this.records.get(id);if(!record){var index=this.records.indexOf(source_record)+1;record=this.make_empty_record(id);this.records.add(record,{at:index});}
return this.reload_record(record);},prepends_on_create:function(){return this.editable()==='top';},setup_events:function(){var self=this;_.each(this.editor.form.fields,function(field,field_name){field.on("change:effective_readonly",self,function(){var item=_(self.fields_for_resize).find(function(item){return item.field===field;});if(item){setTimeout(function(){self.resize_field(item.field,item.cell);},0);}});});this.editor.$el.on('keyup keypress keydown',function(e){if(!self.editor.is_editing()){return true;}
var key=_($.ui.keyCode).chain().map(function(v,k){return{name:k,code:v};}).find(function(o){return o.code===e.which;}).value();if(!key){return true;}
var method=e.type+'_'+key.name;if(!(method in self)){return true;}
return self[method](e);});},_next:function(next_record,options){next_record=next_record||'succ';var self=this;return this.save_edition().then(function(saveInfo){if(!saveInfo){return null;}
if(saveInfo.created){return self.start_edition();}
var record=self.records[next_record](saveInfo.record,{wraparound:true});return self.start_edition(record,options);});},keypress_ENTER:function(){return this._next();},keydown_ESCAPE:function(e){return false;},keyup_ESCAPE:function(e){return this.cancel_edition();},_text_selection_range:function(el){var selectionStart;try{selectionStart=el.selectionStart;}catch(e){return null;}
if(selectionStart!==undefined){return{start:selectionStart,end:el.selectionEnd};}else if(document.body.createTextRange){throw new Error("Implement text range handling for MSIE");}
return null;},_text_cursor:function(el){var selection=this._text_selection_range(el);if(!selection){return null;}
if(selection.start!==selection.end){return{position:null,collapsed:false};}
return{position:selection.start,collapsed:true};},_at_start:function(cursor,el){return cursor.collapsed&&(cursor.position===0);},_at_end:function(cursor,el){return cursor.collapsed&&(cursor.position===el.value.length);},_key_move_record:function(event,record_direction,is_valid_move){if(!this.editor.is_editing('edit')){return $.when();}
var cursor=this._text_cursor(event.target);if(cursor&&!is_valid_move(event.target,cursor)){return $.when();}
event.preventDefault();var source_field=$(event.target).closest('[data-fieldname]').attr('data-fieldname');return this._next(record_direction,{focus_field:source_field});},keydown_UP:function(e){var self=this;return this._key_move_record(e,'pred',function(el,cursor){return self._at_start(cursor,el);});},keydown_DOWN:function(e){var self=this;return this._key_move_record(e,'succ',function(el,cursor){return self._at_end(cursor,el);});},keydown_LEFT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_start(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(--field_index<0){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_RIGHT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_end(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(++field_index>=fields_order.length){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_TAB:function(e){var form=this.editor.form;var last_field=_(form.fields_order).chain().map(function(name){return form.fields[name];}).filter(function(field){return field.$el.is(':visible')&&!field.get('effective_readonly');}).last().value();if(last_field&&last_field.$el.has(e.target).length){e.preventDefault();return this._next();}
return $.when();}});instance.web.list.Editor=instance.web.Widget.extend({init:function(parent,options){this._super(parent);this.options=options||{};_.defaults(this.options,{formView:instance.web.FormView,delegate:this.getParent()});this.delegate=this.options.delegate;this.record=null;this.form=new(this.options.formView)(this,this.delegate.dataset,false,{initial_mode:'edit',disable_autofocus:true,$buttons:$(),$pager:$()});},start:function(){var self=this;var _super=this._super();this.form.embedded_view=this._validate_view(this.delegate.edition_view(this));var form_ready=this.form.appendTo(this.$el).done(self.form.proxy('do_hide'));return $.when(_super,form_ready);},_validate_view:function(edition_view){if(!edition_view){throw new Error("editor delegate's #edition_view must return "
+"a view descriptor");}
var arch=edition_view.arch;if(!(arch&&arch.children instanceof Array)){throw new Error("Editor delegate's #edition_view must have a"+" non-empty arch");}
if(arch.tag!=="form"){throw new Error("Editor delegate's #edition_view must have a"+" 'form' root node");}
if(!(arch.attrs&&arch.attrs.version==="7.0")){throw new Error("Editor delegate's #edition_view must be a"+" version 7 view");}
if(!/\boe_form_container\b/.test(arch.attrs['class'])){throw new Error("Editor delegate's #edition_view must have the"+" class 'oe_form_container' on its root"+" element");}
return edition_view;},is_editing:function(state){if(!this.record){return false;}
switch(state){case null:case undefined:return true;case'new':return!this.record.id;case'edit':return!!this.record.id;}
throw new Error("is_editing's state filter must be either `new` or"+" `edit` if provided");},edit:function(record,configureField,options){var self=this;var form=self.form;var loaded=record?form.trigger('load_record',_.extend({},record)):form.load_defaults();return $.when(loaded).then(function(){return form.do_show({reload:false});}).then(function(){self.record=form.datarecord;_(form.fields).each(function(field,name){configureField(name,field);});return form;});},save:function(){var self=this;return this.form.save(this.delegate.prepends_on_create()).then(function(result){var created=result.created&&!self.record.id;if(created){self.record.id=result.result;}
return self.cancel();});},cancel:function(force){if(!(force||this.form.can_be_discarded())){return $.Deferred().reject({message:_t("The form's data can not be discarded")}).promise();}
var record=this.record;this.record=null;this.form.do_hide();return $.when(record);},});instance.web.ListView.Groups.include({passthrough_events:instance.web.ListView.Groups.prototype.passthrough_events+" edit saved",get_row_for:function(record){return _(this.children).chain().invoke('get_row_for',record).compact().first().value();}});instance.web.ListView.List.include({row_clicked:function(event){if(!this.view.editable()||!this.view.is_action_enabled('edit')){return this._super.apply(this,arguments);}
var record_id=$(event.currentTarget).data('id');return this.view.start_edition(record_id?this.records.get(record_id):null,{focus_field:$(event.target).data('field')});},get_row_for:function(record){var id;var $row=this.$current.children('[data-id='+record.get('id')+']');if($row.length){return $row;}
return null;}});})();;

/* /web/static/src/js/view_tree.js defined in bundle 'web.assets_backend' */
(function(){var instance=openerp;openerp.web.view_tree={};var QWeb=instance.web.qweb,_lt=instance.web._lt;instance.web.views.add('tree','instance.web.TreeView');instance.web.TreeView=instance.web.View.extend({display_name:_lt('Tree'),view_type:'tree',searchable:false,init:function(parent,dataset,view_id,options){this._super(parent);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.records={};this.options=_.extend({},this.defaults,options||{});_.bindAll(this,'color_for');},view_loading:function(r){return this.load_tree(r);},fields_list:function(){var fields=_.keys(this.fields);if(!_(fields).contains(this.children_field)){fields.push(this.children_field);}
return fields;},load_tree:function(fields_view){var self=this;var has_toolbar=!!fields_view.arch.attrs.toolbar;this.children_field=fields_view['field_parent'];this.fields_view=fields_view;_(this.fields_view.arch.children).each(function(field){if(field.attrs.modifiers){field.attrs.modifiers=JSON.parse(field.attrs.modifiers);}});this.fields=fields_view.fields;this.hook_row_click();this.$el.html(QWeb.render('TreeView',{'title':this.fields_view.arch.attrs.string,'fields_view':this.fields_view.arch.children,'fields':this.fields,'toolbar':has_toolbar}));this.$el.addClass(this.fields_view.arch.attrs['class']);this.dataset.read_slice(this.fields_list()).done(function(records){if(!has_toolbar){self.getdata(null,_(records).pluck('id'));return;}
var $select=self.$el.find('select').change(function(){var $option=$(this).find(':selected');self.getdata($option.val(),$option.data('children'));});_(records).each(function(record){self.records[record.id]=record;$('<option>').val(record.id).text(record.name).data('children',record[self.children_field]).appendTo($select);});if(!_.isEmpty(records)){$select.change();}});this.do_push_state({});if(!this.fields_view.arch.attrs.colors){return;}
this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();},color_for:function(record){if(!this.colors){return'';}
var context=_.extend({},record,{uid:this.session.uid,current_date:new Date().toString('yyyy-MM-dd')});for(var i=0,len=this.colors.length;i<len;++i){var pair=this.colors[i],color=pair[0],expression=pair[1];if(py.evaluate(expression,context).toJSON()){return'color: '+color+';';}}
return'';},hook_row_click:function(){var self=this;this.$el.delegate('.treeview-td span, .treeview-tr span','click',function(e){e.stopImmediatePropagation();self.activate($(this).closest('tr').data('id'));});this.$el.delegate('.treeview-tr','click',function(){var is_loaded=0,$this=$(this),record_id=$this.data('id'),row_parent_id=$this.data('row-parent-id'),record=self.records[record_id],children_ids=record[self.children_field];_(children_ids).each(function(childid){if(self.$el.find('[id=treerow_'+childid+'][data-row-parent-id='+record_id+']').length){if(self.$el.find('[id=treerow_'+childid+'][data-row-parent-id='+record_id+']').is(':hidden')){is_loaded=-1;}else{is_loaded++;}}});if(is_loaded===0){if(!$this.parent().hasClass('oe_open')){self.getdata(record_id,children_ids);}}else{self.showcontent($this,record_id,is_loaded<0);}});},getdata:function(id,children_ids){var self=this;self.dataset.read_ids(children_ids,this.fields_list()).done(function(records){_(records).each(function(record){self.records[record.id]=record;});var $curr_node=self.$el.find('#treerow_'+id);var children_rows=QWeb.render('TreeView.rows',{'records':records,'children_field':self.children_field,'fields_view':self.fields_view.arch.children,'fields':self.fields,'level':$curr_node.data('level')||0,'render':instance.web.format_value,'color_for':self.color_for,'row_parent_id':id});if($curr_node.length){$curr_node.addClass('oe_open');$curr_node.after(children_rows);}else{self.$el.find('tbody').html(children_rows);}});},activate:function(id){var self=this;var local_context={active_model:self.dataset.model,active_id:id,active_ids:[id]};var ctx=instance.web.pyeval.eval('context',new instance.web.CompoundContext(this.dataset.get_context(),local_context));return this.rpc('/web/treeview/action',{id:id,model:this.dataset.model,context:ctx}).then(function(actions){if(!actions.length){return;}
var action=actions[0][2];var c=new instance.web.CompoundContext(local_context).set_eval_context(ctx);if(action.context){c.add(action.context);}
action.context=c;return self.do_action(action);});},showcontent:function(curnode,record_id,show){curnode.parent('tr').toggleClass('oe_open',show);_(this.records[record_id][this.children_field]).each(function(child_id){var $child_row=this.$el.find('[id=treerow_'+child_id+'][data-row-parent-id='+curnode.data('id')+']');if($child_row.hasClass('oe_open')){$child_row.toggleClass('oe_open',show);this.showcontent($child_row,child_id,false);}
$child_row.toggle(show);},this);},do_show:function(){this.$el.show();},do_hide:function(){this.$el.hide();this.hidden=true;}});})();;

/* /base/static/src/js/apps.js defined in bundle 'web.assets_backend' */
openerp.base=function(instance){instance.base.apps_client=null;var _t=instance.web._t;instance.base.Apps=instance.web.Widget.extend({template:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var d=$.Deferred();var i=new Image();i.onerror=function(){d.reject(client);};i.onload=function(){d.resolve(client);};var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return d.promise();};if(instance.base.apps_client){return check_client_available(instance.base.apps_client);}else{var Mod=new instance.web.Model('ir.module.module');return Mod.call('get_apps_server').then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};instance.base.apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message.apps");if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){self.session.rpc.apply(self.session,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){var M=new instance.web.Model(m.model);M[m.method].apply(M,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},start:function(){var self=this;return self.get_client().done(function(client){self.client=client;var qs=(instance.session.debug?'debug&':'')+'db='+client.dbname;var u=client.origin+'/apps/embed/client?'+qs;var css={width:'100%',height:'400px'};self.$ifr=$('<iframe>').attr('src',u);$(window).on("message.apps",self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:this.session.db,origin:this.session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:update_count',self,function(m){var count=m.count
var get_upd_menu_id=function(){if(_.isUndefined(self._upd_menu_id)){var IMD=new instance.web.Model('ir.model.data');return IMD.call('get_object_reference',['base','menu_module_updates']).then(function(r){var mid=r[1];if(r[0]!=='ir.ui.menu'){mid=null;}
self._upd_menu_id=mid;return mid;});}else{return $.Deferred().resolve(self._upd_menu_id).promise();}};$.when(get_upd_menu_id()).done(function(menu_id){if(_.isNull(menu_id)){return;}
var $menu=instance.webclient.menu.$secondary_menus.find(_.str.sprintf('a[data-menu=%s]',menu_id));if($menu.length===0){return;}
if(_.isUndefined(count)){count=0;}
var needupdate=$menu.find('#menu_counter');if(needupdate&&needupdate.length!==0){if(count>0){needupdate.text(count);}else{needupdate.remove();}}else if(count>0){$menu.append(instance.web.qweb.render("Menu.needaction_counter",{widget:{needaction_counter:count}}));}});});self.on('message:blockUI',self,function(){instance.web.blockUI();});self.on('message:unblockUI',self,function(){instance.web.unblockUI();});self.on('message:warn',self,function(m){instance.webclient.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$el).css(css).addClass('apps-client');}).fail(function(client){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);self.rpc('/web/action/load',{action_id:self.failback_action_id}).done(function(action){self.do_action(action);instance.webclient.menu.open_action(action.id);});});},});instance.base.AppsUpdates=instance.base.Apps.extend({remote_action_tag:'loempia.embed.updates',});instance.web.client_actions.add("apps","instance.base.Apps");instance.web.client_actions.add("apps.updates","instance.base.AppsUpdates");};;

/* /account/static/src/js/account_widgets.js defined in bundle 'web.assets_backend' */
openerp.account=function(instance){openerp.account.quickadd(instance);var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.account=instance.web.account||{};instance.web.client_actions.add('bank_statement_reconciliation_view','instance.web.account.bankStatementReconciliation');instance.web.account.bankStatementReconciliation=instance.web.Widget.extend({className:'oe_bank_statement_reconciliation',events:{"click .statement_name span":"statementNameClickHandler","keyup .change_statement_name_field":"changeStatementNameFieldHandler","click .change_statement_name_button":"changeStatementButtonClickHandler","click .show_more":"showMoreButtonClickHandler",},init:function(parent,context){this._super(parent);this.num_reconciliations_fetched_in_batch=10;if(context.context.statement_id)this.statement_ids=[context.context.statement_id];if(context.context.statement_ids)this.statement_ids=context.context.statement_ids;this.single_statement=this.statement_ids!==undefined&&this.statement_ids.length===1;this.multiple_statements=this.statement_ids!==undefined&&this.statement_ids.length>1;this.title=context.context.title||_t("Reconciliation");this.st_lines=[];this.last_displayed_reconciliation_index=undefined;this.reconciled_lines=0;this.already_reconciled_lines=0;this.model_bank_statement=new instance.web.Model("account.bank.statement");this.model_bank_statement_line=new instance.web.Model("account.bank.statement.line");this.reconciliation_menu_id=false;this.formatCurrency;this.lines_reconciled_with_ctrl_enter=0;this.time_widget_loaded=Date.now();this.max_move_lines_displayed=5;this.animation_speed=100;this.aestetic_animation_speed=300;this.map_currency_id_rounding={};this.presets={};this.map_account_id_code={};this.excluded_move_lines_ids={};this.create_form_fields={account_id:{id:"account_id",index:0,corresponding_property:"account_id",label:_t("Account"),required:true,tabindex:10,constructor:instance.web.form.FieldMany2One,field_properties:{relation:"account.account",string:_t("Account"),type:"many2one",domain:[['type','not in',['view','closed','consolidation']]],},},label:{id:"label",index:1,corresponding_property:"label",label:_t("Label"),required:true,tabindex:11,constructor:instance.web.form.FieldChar,field_properties:{string:_t("Label"),type:"char",},},tax_id:{id:"tax_id",index:2,corresponding_property:"tax_id",label:_t("Tax"),required:false,tabindex:12,constructor:instance.web.form.FieldMany2One,field_properties:{relation:"account.tax",string:_t("Tax"),type:"many2one",domain:[['type_tax_use','in',['purchase','all']],['parent_id','=',false]],},},amount:{id:"amount",index:3,corresponding_property:"amount",label:_t("Amount"),required:true,tabindex:13,constructor:instance.web.form.FieldFloat,field_properties:{string:_t("Amount"),type:"float",},},analytic_account_id:{id:"analytic_account_id",index:4,corresponding_property:"analytic_account_id",label:_t("Analytic Acc."),required:false,tabindex:14,group:"analytic.group_analytic_accounting",constructor:instance.web.form.FieldMany2One,field_properties:{relation:"account.analytic.account",string:_t("Analytic Acc."),type:"many2one",domain:[['type','!=','view'],['state','not in',['close','cancelled']]],},},};},start:function(){this._super();var self=this;var lines_filter=[['journal_entry_id','=',false],['account_id','=',false]];var deferred_promises=[];if(self.statement_ids&&self.statement_ids.length>0){lines_filter.push(['statement_id','in',self.statement_ids]);if(self.single_statement){deferred_promises.push(self.model_bank_statement.query(["name"]).filter([['id','=',self.statement_ids[0]]]).first().then(function(title){self.title=title.name;}));}
deferred_promises.push(self.model_bank_statement.call("number_of_lines_reconciled",[self.statement_ids]).then(function(num){self.already_reconciled_lines=num;}));}
deferred_promises.push(new instance.web.Model("account.statement.operation.template").query(['id','name','account_id','label','amount_type','amount','tax_id','analytic_account_id']).all().then(function(data){_(data).each(function(preset){self.presets[preset.id]=preset;});}));deferred_promises.push(new instance.web.Model("res.currency").call("get_format_currencies_js_function").then(function(data){self.formatCurrency=new Function("amount, currency_id",data);}));deferred_promises.push(self.model_bank_statement_line.query(['id']).filter(lines_filter).order_by('statement_id, id').all().then(function(data){self.st_lines=_(data).map(function(o){return o.id});}));return $.when.apply($,deferred_promises).then(function(){if(self.st_lines.length===0){self.$el.prepend(QWeb.render("bank_statement_nothing_to_reconcile"));return;}
new instance.web.Model("account.account").query(['id','code']).all().then(function(data){_.each(data,function(o){self.map_account_id_code[o.id]=o.code});});new instance.web.Model("res.currency").query(['id','rounding']).all().then(function(data){_.each(data,function(o){self.map_currency_id_rounding[o.id]=o.rounding});});new instance.web.Model("ir.model.data").call("xmlid_to_res_id",["account.menu_bank_reconcile_bank_statements"]).then(function(data){self.reconciliation_menu_id=data;self.doReloadMenuReconciliation();});$("body").on("keypress",function(e){self.keyboardShortcutsHandler(e);});self.$el.prepend(QWeb.render("bank_statement_reconciliation",{title:self.title,single_statement:self.single_statement,total_lines:self.already_reconciled_lines+self.st_lines.length}));self.updateProgressbar();var reconciliations_to_show=self.st_lines.slice(0,self.num_reconciliations_fetched_in_batch);self.last_displayed_reconciliation_index=reconciliations_to_show.length;self.$(".reconciliation_lines_container").css("opacity",0);return self.model_bank_statement_line.call("get_data_for_reconciliations",[reconciliations_to_show]).then(function(data){var child_promises=[];while((datum=data.shift())!==undefined)
child_promises.push(self.displayReconciliation(datum.st_line.id,'inactive',false,true,datum.st_line,datum.reconciliation_proposition));$.when.apply($,child_promises).then(function(){self.$(".reconciliation_lines_container").animate({opacity:1},self.aestetic_animation_speed);self.getChildren()[0].set("mode","match");self.updateShowMoreButton();});});});},statementNameClickHandler:function(){if(!this.single_statement)return;this.$(".statement_name span").hide();this.$(".change_statement_name_field").attr("value",this.title);this.$(".change_statement_name_container").show();this.$(".change_statement_name_field").focus();},changeStatementNameFieldHandler:function(e){var name=this.$(".change_statement_name_field").val();if(name==="")this.$(".change_statement_name_button").attr("disabled","disabled");else this.$(".change_statement_name_button").removeAttr("disabled");if(name!==""&&e.which===13)
this.$(".change_statement_name_button").trigger("click");if(e.which===27){this.$(".statement_name span").show();this.$(".change_statement_name_container").hide();}},changeStatementButtonClickHandler:function(){var self=this;if(!self.single_statement)return;var name=self.$(".change_statement_name_field").val();if(name==="")return;self.$(".change_statement_name_button").attr("disabled","disabled");return self.model_bank_statement.call("write",[[self.statement_ids[0]],{'name':name}]).done(function(){self.title=name;self.$(".statement_name span").text(name).show();self.$(".change_statement_name_container").hide();}).always(function(){self.$(".change_statement_name_button").removeAttr("disabled");});},keyboardShortcutsHandler:function(e){var self=this;if((e.which===13||e.which===10)&&(e.ctrlKey||e.metaKey)){self.persistReconciliations(_.filter(self.getChildren(),function(o){return o.is_valid;}));}},persistReconciliations:function(reconciliations){if(reconciliations.length===0)return;var self=this;var data=[];for(var i=0;i<reconciliations.length;i++){var child=reconciliations[i];data.push([child.st_line_id,child.makeMoveLineDicts()]);}
var deferred_animation=self.$(".reconciliation_lines_container, .show_more_container").fadeOut(self.aestetic_animation_speed);deferred_rpc=self.model_bank_statement_line.call("process_reconciliations",[data]);return $.when(deferred_animation,deferred_rpc).done(function(){for(var i=0;i<reconciliations.length;i++){var child=reconciliations[i];self.unexcludeMoveLines(child,child.partner_id,child.get("mv_lines_selected"));$.each(child.$(".bootstrap_popover"),function(){$(this).popover('destroy')});child.destroy();}
self.lines_reconciled_with_ctrl_enter+=reconciliations.length;self.reconciled_lines+=reconciliations.length;self.updateProgressbar();self.doReloadMenuReconciliation();if(self.last_displayed_reconciliation_index<self.st_lines.length){return self.displayReconciliations(self.num_reconciliations_fetched_in_batch).then(function(){if(self.reconciled_lines!==self.st_lines.length){var first_child=self.getChildren()[0];if(first_child.get("mode")==="inactive"){first_child.set("mode","match");}}
self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);});}else if(self.reconciled_lines===self.st_lines.length){self.displayDoneMessage();}else{self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);}}).fail(function(){self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);});},excludeMoveLines:function(source_child,partner_id,lines){var self=this;var line_ids=_.collect(lines,function(o){return o.id});var excluded_ids=this.excluded_move_lines_ids[partner_id];var excluded_move_lines_changed=false;_.each(line_ids,function(line_id){if(excluded_ids.indexOf(line_id)===-1){excluded_ids.push(line_id);excluded_move_lines_changed=true;}});if(!excluded_move_lines_changed)
return;var contains_lines=function(lines_array,line_ids){for(var i=0;i<lines_array.length;i++)
for(var j=0;j<line_ids.length;j++)
if(lines_array[i].id===line_ids[j])
return true;return false;};_.each(self.getChildren(),function(child){if(child===source_child||child.st_line===undefined)return;if(child.partner_id===partner_id||child.st_line.has_no_partner){if(contains_lines(child.get("mv_lines_selected"),line_ids)){child.set("mv_lines_selected",_.filter(child.get("mv_lines_selected"),function(o){return line_ids.indexOf(o.id)===-1}));}else if(contains_lines(child.mv_lines_deselected,line_ids)){child.mv_lines_deselected=_.filter(child.mv_lines_deselected,function(o){return line_ids.indexOf(o.id)===-1});child.updateMatches();}else if(contains_lines(child.get("mv_lines"),line_ids)){child.updateMatches();}}});},unexcludeMoveLines:function(source_child,partner_id,lines){var self=this;var line_ids=_.collect(lines,function(o){return o.id});var initial_excluded_lines_num=this.excluded_move_lines_ids[partner_id].length;this.excluded_move_lines_ids[partner_id]=_.difference(this.excluded_move_lines_ids[partner_id],line_ids);if(this.excluded_move_lines_ids[partner_id].length===initial_excluded_lines_num)
return;_.each(self.getChildren(),function(child){if(child.st_line===undefined)return;if(child.partner_id===partner_id&&child!==source_child&&(child.get("mode")==="match"||child.$el.hasClass("no_match")))
child.updateMatches();if(child.st_line.has_no_partner&&child.get("mode")==="match"||child.$el.hasClass("no_match"))
child.updateMatches();});},displayReconciliations:function(number){var self=this;var begin=self.last_displayed_reconciliation_index;var end=Math.min((begin+number),self.st_lines.length);var reconciliations_to_show=self.st_lines.slice(begin,end);var excluded_move_lines_ids=[];_.each(self.excluded_move_lines_ids,function(o){excluded_move_lines_ids=excluded_move_lines_ids.concat(o);});return self.model_bank_statement_line.call("get_data_for_reconciliations",[reconciliations_to_show,excluded_move_lines_ids]).then(function(data){var child_promises=[];var datum;while((datum=data.shift())!==undefined){var context={st_line_id:datum.st_line.id,mode:'inactive',animate_entrance:false,initial_data_provided:true,st_line:datum.st_line,reconciliation_proposition:datum.reconciliation_proposition,};var widget=new instance.web.account.bankStatementReconciliationLine(self,context);child_promises.push(widget.appendTo(self.$(".reconciliation_lines_container")));}
self.last_displayed_reconciliation_index+=reconciliations_to_show.length;return $.when.apply($,child_promises).then(function(){self.updateShowMoreButton();});});},displayReconciliation:function(st_line_id,mode,animate_entrance,initial_data_provided,st_line,reconciliation_proposition){var self=this;animate_entrance=(animate_entrance===undefined?true:animate_entrance);initial_data_provided=(initial_data_provided===undefined?false:initial_data_provided);var context={st_line_id:st_line_id,mode:mode,animate_entrance:animate_entrance,initial_data_provided:initial_data_provided,st_line:initial_data_provided?st_line:undefined,reconciliation_proposition:initial_data_provided?reconciliation_proposition:undefined,};var widget=new instance.web.account.bankStatementReconciliationLine(self,context);return widget.appendTo(self.$(".reconciliation_lines_container"));},childValidated:function(child){var self=this;self.reconciled_lines++;self.updateProgressbar();self.doReloadMenuReconciliation();if(self.last_displayed_reconciliation_index<self.st_lines.length&&self.getChildren().length<self.num_reconciliations_fetched_in_batch){self.displayReconciliation(self.st_lines[self.last_displayed_reconciliation_index++],'inactive');}
if(self.reconciled_lines===self.st_lines.length){self.displayDoneMessage();}
if(self.reconciled_lines!==self.st_lines.length){var first_child=self.getChildren()[0];if(first_child.get("mode")==="inactive"){first_child.set("mode","match");}}
self.updateShowMoreButton();},goBackToStatementsTreeView:function(){var self=this;new instance.web.Model("ir.model.data").call("get_object_reference",['account','action_bank_statement_tree']).then(function(result){var action_id=result[1];var action_manager=self.getParent();var breadcrumbs=action_manager.breadcrumbs;var found=false;for(var i=breadcrumbs.length-1;i>=0;i--){if(breadcrumbs[i].action&&breadcrumbs[i].action.id===action_id){var title=breadcrumbs[i].get_title();action_manager.select_breadcrumb(i,_.isArray(title)?i:undefined);found=true;}}
if(!found)
self.do_action('history_back');});},displayDoneMessage:function(){var self=this;var sec_taken=Math.round((Date.now()-self.time_widget_loaded)/1000);var sec_per_item=Math.round(sec_taken/self.reconciled_lines);var achievements=[];var time_taken;if(sec_taken/60>=1)time_taken=Math.floor(sec_taken/60)+"' "+sec_taken%60+"''";else time_taken=sec_taken%60+" seconds";var title;if(sec_per_item<5)title=_t("Whew, that was fast !")+" <i class='fa fa-trophy congrats_icon'></i>";else title=_t("Congrats, you're all done !")+" <i class='fa fa-thumbs-o-up congrats_icon'></i>";if(self.lines_reconciled_with_ctrl_enter===self.reconciled_lines)
achievements.push({title:_t("Efficiency at its finest"),desc:_t("Only use the ctrl-enter shortcut to validate reconciliations."),icon:"fa-keyboard-o"});if(sec_per_item<5)
achievements.push({title:_t("Fast reconciler"),desc:_t("Take on average less than 5 seconds to reconcile a transaction."),icon:"fa-bolt"});self.$(".protip").hide();self.updateShowMoreButton();self.$(".oe_form_sheet").append(QWeb.render("bank_statement_reconciliation_done_message",{title:title,time_taken:time_taken,sec_per_item:sec_per_item,transactions_done:self.reconciled_lines,done_with_ctrl_enter:self.lines_reconciled_with_ctrl_enter,achievements:achievements,single_statement:self.single_statement,multiple_statements:self.multiple_statements,}));var container=$("<div style='overflow: hidden;' />");self.$(".done_message").wrap(container).css("opacity",0).css("position","relative").css("left","-50%");self.$(".done_message").animate({opacity:1,left:0},self.aestetic_animation_speed*2,"easeOutCubic");self.$(".done_message").animate({opacity:1},self.aestetic_animation_speed*3,"easeOutCubic");self.$(".achievement").popover({'placement':'top','container':self.el,'trigger':'hover'});if(self.$(".button_back_to_statement").length!==0){self.$(".button_back_to_statement").click(function(){self.goBackToStatementsTreeView();});}
if(self.$(".button_close_statement").length!==0){self.$(".button_close_statement").hide();self.model_bank_statement.query(["balance_end_real","balance_end"]).filter([['id','in',self.statement_ids]]).all().then(function(data){if(_.all(data,function(o){return o.balance_end_real===o.balance_end})){self.$(".button_close_statement").show();self.$(".button_close_statement").click(function(){self.$(".button_close_statement").attr("disabled","disabled");self.model_bank_statement.call("button_confirm_bank",[self.statement_ids]).then(function(){self.goBackToStatementsTreeView();},function(){self.$(".button_close_statement").removeAttr("disabled");});});}});}},showMoreButtonClickHandler:function(){this.displayReconciliations(this.num_reconciliations_fetched_in_batch);},updateShowMoreButton:function(){var items_remaining=this.st_lines.length-this.last_displayed_reconciliation_index;if(items_remaining>0)
this.$(".show_more").show().find(".num_items_remaining").text(items_remaining);else
this.$(".show_more").hide();},updateProgressbar:function(){var self=this;var done=self.already_reconciled_lines+self.reconciled_lines;var total=self.already_reconciled_lines+self.st_lines.length;var prog_bar=self.$(".progress .progress-bar");prog_bar.attr("aria-valuenow",done);prog_bar.css("width",(done/total*100)+"%");self.$(".progress .progress-text .valuenow").text(done);},doReloadMenuReconciliation:function(){var menu=instance.webclient.menu;if(!menu||!this.reconciliation_menu_id){return $.when();}
return menu.rpc("/web/menu/load_needaction",{'menu_ids':[this.reconciliation_menu_id]}).done(function(r){menu.on_needaction_loaded(r);}).then(function(){menu.trigger("need_action_reloaded");});},});instance.web.account.bankStatementReconciliationLine=instance.web.Widget.extend({className:'oe_bank_statement_reconciliation_line',events:{"click .change_partner":"changePartnerClickHandler","click .button_ok":"persistAndDestroy","click .mv_line":"moveLineClickHandler","click .initial_line":"initialLineClickHandler","click .line_open_balance":"lineOpenBalanceClickHandler","click .pager_control_left:not(.disabled)":"pagerControlLeftHandler","click .pager_control_right:not(.disabled)":"pagerControlRightHandler","keyup .filter":"filterHandler","click .line_info_button":function(e){e.stopPropagation()},"click .add_line":"addLineBeingEdited","click .preset":"presetClickHandler","click .do_partial_reconcile_button":"doPartialReconcileButtonClickHandler","click .undo_partial_reconcile_button":"undoPartialReconcileButtonClickHandler",},init:function(parent,context){this._super(parent);this.formatCurrency=this.getParent().formatCurrency;if(context.initial_data_provided){_.each(context.reconciliation_proposition,function(line){this.decorateMoveLine(line,context.st_line.currency_id);},this);this.set("mv_lines_selected",context.reconciliation_proposition);this.st_line=context.st_line;this.partner_id=context.st_line.partner_id;this.decorateStatementLine(this.st_line);if(this.getParent().excluded_move_lines_ids[this.partner_id]===undefined)
this.getParent().excluded_move_lines_ids[this.partner_id]=[];this.getParent().excludeMoveLines(this,this.partner_id,context.reconciliation_proposition);}else{this.set("mv_lines_selected",[]);this.st_line=undefined;this.partner_id=undefined;}
this.context=context;this.st_line_id=context.st_line_id;this.max_move_lines_displayed=this.getParent().max_move_lines_displayed;this.animation_speed=this.getParent().animation_speed;this.aestetic_animation_speed=this.getParent().aestetic_animation_speed;this.model_bank_statement_line=new instance.web.Model("account.bank.statement.line");this.model_res_users=new instance.web.Model("res.users");this.model_tax=new instance.web.Model("account.tax");this.map_currency_id_rounding=this.getParent().map_currency_id_rounding;this.map_account_id_code=this.getParent().map_account_id_code;this.presets=this.getParent().presets;this.is_valid=true;this.is_consistent=true;this.can_fetch_more_move_lines;this.filter="";this.do_load_reconciliation_proposition=true;this.set("mode",undefined);this.on("change:mode",this,this.modeChanged);this.set("balance",undefined);this.on("change:balance",this,this.balanceChanged);this.set("pager_index",0);this.on("change:pager_index",this,this.pagerChanged);this.set("mv_lines",[]);this.on("change:mv_lines",this,this.mvLinesChanged);this.mv_lines_deselected=[];this.on("change:mv_lines_selected",this,this.mvLinesSelectedChanged);this.set("lines_created",[]);this.set("line_created_being_edited",[{'id':0}]);this.on("change:lines_created",this,this.createdLinesChanged);this.on("change:line_created_being_edited",this,this.createdLinesChanged);},start:function(){var self=this;return self._super().then(function(){self.animation_speed=0;self.aestetic_animation_speed=0;self.is_consistent=false;if(self.context.animate_entrance){self.$el.fadeOut(0);self.$el.slideUp(0);}
return $.when(self.loadData()).then(function(){return $.when(self.render()).then(function(){self.is_consistent=true;self.animation_speed=self.getParent().animation_speed;self.aestetic_animation_speed=self.getParent().aestetic_animation_speed;if(self.context.animate_entrance){return self.$el.stop(true,true).fadeIn({duration:self.aestetic_animation_speed,queue:false}).css('display','none').slideDown(self.aestetic_animation_speed);}});});});},loadData:function(){var self=this;if(self.context.initial_data_provided)
return;var excluded_move_lines_ids=[];if(self.do_load_reconciliation_proposition){_.each(self.getParent().excluded_move_lines_ids,function(o){excluded_move_lines_ids=excluded_move_lines_ids.concat(o);});}
return self.model_bank_statement_line.call("get_data_for_reconciliations",[[self.st_line_id],excluded_move_lines_ids,self.do_load_reconciliation_proposition]).then(function(data){self.st_line=data[0].st_line;self.decorateStatementLine(self.st_line);self.partner_id=data[0].st_line.partner_id;if(self.getParent().excluded_move_lines_ids[self.partner_id]===undefined)
self.getParent().excluded_move_lines_ids[self.partner_id]=[];var mv_lines=[];_.each(data[0].reconciliation_proposition,function(line){self.decorateMoveLine(line,self.st_line.currency_id);mv_lines.push(line);},self);self.set("mv_lines_selected",self.get("mv_lines_selected").concat(mv_lines));});},render:function(){var self=this;var presets_array=[];for(var id in self.presets)
if(self.presets.hasOwnProperty(id))
presets_array.push(self.presets[id]);self.$el.prepend(QWeb.render("bank_statement_reconciliation_line",{line:self.st_line,mode:self.context.mode,presets:presets_array}));self.$(".match").slideUp(0);self.$(".create").slideUp(0);if(self.st_line.no_match)self.$el.addClass("no_match");self.bindPopoverTo(self.$(".line_info_button"));self.createFormWidgets();if(self.st_line.has_no_partner){self.$el.css("opacity","0");self.updateBalance();self.$(".change_partner_container").show(0);self.$(".match").slideUp(0);self.$el.addClass("no_partner");self.set("mode",self.context.mode);self.balanceChanged();self.updateAccountingViewMatchedLines();self.animation_speed=self.getParent().animation_speed;self.aestetic_animation_speed=self.getParent().aestetic_animation_speed;self.$el.animate({opacity:1},self.aestetic_animation_speed);return;}
return $.when(self.set("mode",self.context.mode)).then(function(){self.balanceChanged();self.createdLinesChanged();self.updateAccountingViewMatchedLines();});},restart:function(mode){var self=this;mode=(mode===undefined?'inactive':mode);self.context.animate_entrance=false;self.$el.css("height",self.$el.outerHeight());_.each(self.getChildren(),function(o){o.destroy()});self.is_consistent=false;return $.when(self.$el.animate({opacity:0},self.animation_speed)).then(function(){self.getParent().unexcludeMoveLines(self,self.partner_id,self.get("mv_lines_selected"));$.each(self.$(".bootstrap_popover"),function(){$(this).popover('destroy')});self.$el.empty();self.$el.removeClass("no_partner");self.context.mode=mode;self.context.initial_data_provided=false;self.is_valid=true;self.is_consistent=true;self.filter="";self.set("balance",undefined,{silent:true});self.set("mode",undefined,{silent:true});self.set("pager_index",0,{silent:true});self.set("mv_lines",[],{silent:true});self.set("mv_lines_selected",[],{silent:true});self.mv_lines_deselected=[];self.set("lines_created",[],{silent:true});self.set("line_created_being_edited",[{'id':0}],{silent:true});return $.when(self.start()).then(function(){self.$el.css("height","auto");self.is_consistent=true;self.$el.animate({opacity:1},self.animation_speed);});});},createFormWidgets:function(){var self=this;var create_form_fields=self.getParent().create_form_fields;var create_form_fields_arr=[];for(var key in create_form_fields)
if(create_form_fields.hasOwnProperty(key))
create_form_fields_arr.push(create_form_fields[key]);create_form_fields_arr.sort(function(a,b){return b.index-a.index});var dataset=new instance.web.DataSet(this,"account.account",self.context);dataset.ids=[];dataset.arch={attrs:{string:"Stéphanie de Monaco",version:"7.0",class:"oe_form_container"},children:[],tag:"form"};var field_manager=new instance.web.FormView(this,dataset,false,{initial_mode:'edit',disable_autofocus:false,$buttons:$(),$pager:$()});field_manager.load_form(dataset);var Default_field=function(){this.context={};this.domain=[];this.help="";this.readonly=false;this.required=true;this.selectable=true;this.states={};this.views={};};var Default_node=function(field_name){this.tag="field";this.children=[];this.required=true;this.attrs={invisible:"False",modifiers:'{"required":true}',name:field_name,nolabel:"True",};};field_manager.fields_view.fields={};for(var i=0;i<create_form_fields_arr.length;i++){field_manager.fields_view.fields[create_form_fields_arr[i].id]=_.extend(new Default_field(),create_form_fields_arr[i].field_properties);}
field_manager.fields_view.fields["change_partner"]=_.extend(new Default_field(),{relation:"res.partner",string:_t("Partner"),type:"many2one",domain:[['parent_id','=',false],'|',['customer','=',true],['supplier','=',true]],});var hideGroupResponseClosureFactory=function(field_widget,$container,obj_key){return function(has_group){if(has_group)$container.show();else{field_widget.destroy();$container.remove();delete self[obj_key];}};};self.create_form=[];for(var i=0;i<create_form_fields_arr.length;i++){var field_data=create_form_fields_arr[i];var node=new Default_node(field_data.id);if(!field_data.required)node.attrs.modifiers="";var field=new field_data.constructor(field_manager,node);self[field_data.id+"_field"]=field;self.create_form.push(field);field.corresponding_property=field_data.corresponding_property;field.on("change:value",self,self.formCreateInputChanged);var $field_container=$(QWeb.render("form_create_field",{id:field_data.id,label:field_data.label}));field.appendTo($field_container.find("td"));self.$(".create_form").prepend($field_container);if(field_data.field_properties.type!="many2one"){field.$el.find("input").keyup(function(e,field){field.commit_value();}.bind(null,null,field));}
field.$el.find("input").attr("tabindex",field_data.tabindex);if(field_data.group!==undefined){var target=$field_container;target.hide();self.model_res_users.call("has_group",[field_data.group]).then(hideGroupResponseClosureFactory(field,target,(field_data.id+"_field")));}}
var change_partner_node=new Default_node("change_partner");change_partner_node.attrs.modifiers="";self.change_partner_field=new instance.web.form.FieldMany2One(field_manager,change_partner_node);self.change_partner_field.appendTo(self.$(".change_partner_container"));self.change_partner_field.on("change:value",self.change_partner_field,function(){self.changePartner(this.get_value());});self.change_partner_field.$el.find("input").attr("placeholder",self.st_line.communication_partner_name||_t("Select Partner"));field_manager.do_show();},decorateStatementLine:function(line){line.q_popover=QWeb.render("bank_statement_reconciliation_line_details",{line:line});},decorateMoveLine:function(line,currency_id){line.partial_reconcile=false;line.propose_partial_reconcile=false;line['credit']=[line['debit'],line['debit']=line['credit']][0];line.q_due_date=(line.date_maturity===false?line.date:line.date_maturity);line.q_amount=(line.debit!==0?"- "+line.q_debit:"")+(line.credit!==0?line.q_credit:"");line.q_label=line.name;line.debit_str=this.formatCurrency(line.debit,currency_id);line.credit_str=this.formatCurrency(line.credit,currency_id);line.q_popover=QWeb.render("bank_statement_reconciliation_move_line_details",{line:line});if(line.has_no_partner)
line.q_label=line.partner_name+': '+line.q_label;if(line.ref&&line.ref!==line.name)
line.q_label+=" : "+line.ref;},bindPopoverTo:function(el){var self=this;$(el).addClass("bootstrap_popover");el.popover({'placement':'left','container':self.el,'html':true,'trigger':'hover','animation':false,'toggle':'popover'});},islineCreatedBeingEditedValid:function(){var line=this.get("line_created_being_edited")[0];return line.amount&&line.account_id&&line.label;},getCreatedLines:function(){var self=this;var created_lines=self.get("lines_created").slice();if(self.islineCreatedBeingEditedValid())
return created_lines.concat(self.get("line_created_being_edited"));else
return created_lines;},moveLineClickHandler:function(e){var self=this;if(e.currentTarget.dataset.selected==="true")self.deselectMoveLine(e.currentTarget);else self.selectMoveLine(e.currentTarget);},selectMoveLine:function(mv_line){var self=this;var line_id=mv_line.dataset.lineid;var line=_.find(self.get("mv_lines"),function(o){return o.id==line_id});if(!line){line=_.find(self.mv_lines_deselected,function(o){return o.id==line_id});self.mv_lines_deselected=_.filter(self.mv_lines_deselected,function(o){return o.id!=line_id});}
if(!line)return;var last_selected_line=_.last(self.get("mv_lines_selected"));if(last_selected_line&&last_selected_line.account_type!=line.account_type){new instance.web.Dialog(this,{title:_t("Warning"),size:'medium',},$("<div />").text(_.str.sprintf(_t("You are selecting transactions from both a payable and a receivable account.\n\nIn order to proceed, you first need to deselect the %s transactions."),last_selected_line.account_type))).open();return;}
self.set("mv_lines_selected",self.get("mv_lines_selected").concat(line));},deselectMoveLine:function(mv_line){var self=this;var line_id=mv_line.dataset.lineid;var line=_.find(self.get("mv_lines_selected"),function(o){return o.id==line_id});if(!line)return;self.mv_lines_deselected.unshift(line);var mv_lines_selected=_.filter(self.get("mv_lines_selected"),function(o){return o.id!=line_id});if(line.partial_reconcile===true)self.unpartialReconcileLine(line);if(line.propose_partial_reconcile===true)line.propose_partial_reconcile=false;self.$el.removeClass("no_match");self.set("mode","match");self.set("mv_lines_selected",mv_lines_selected);},pagerControlLeftHandler:function(){var self=this;if(self.$(".pager_control_left").hasClass("disabled")){return;}
if(self.get("pager_index")===0){return;}
self.set("pager_index",self.get("pager_index")-1);},pagerControlRightHandler:function(){var self=this;if(self.$(".pager_control_right").hasClass("disabled")){return;}
if(!self.can_fetch_more_move_lines){return;}
self.set("pager_index",self.get("pager_index")+1);},filterHandler:function(){var self=this;self.set("pager_index",0);self.filter=self.$(".filter").val();window.clearTimeout(self.apply_filter_timeout);self.apply_filter_timeout=window.setTimeout(self.proxy('updateMatches'),200);},initializeCreateForm:function(){var self=this;_.each(self.create_form,function(field){field.set("value",false);});self.label_field.set("value",self.st_line.name);self.amount_field.set("value",-1*self.get("balance"));self.account_id_field.focus();},addLineBeingEdited:function(){var self=this;if(!self.islineCreatedBeingEditedValid())return;self.set("lines_created",self.get("lines_created").concat(self.get("line_created_being_edited")));var new_id=self.get("line_created_being_edited")[0].id+1;self.set("line_created_being_edited",[{'id':new_id}]);self.initializeCreateForm();},removeLine:function($line){var self=this;var line_id=$line.data("lineid");if(line_id===self.get("line_created_being_edited")[0].id){self.addLineBeingEdited();}
self.set("lines_created",_.filter(self.get("lines_created"),function(o){return o.id!=line_id}));self.amount_field.set("value",-1*self.get("balance"));},presetClickHandler:function(e){var self=this;self.initializeCreateForm();var preset=self.presets[e.currentTarget.dataset.presetid];if(preset.tax&&self.tax_field)self.tax_field.set_value(false);if(preset.amount&&self.amount_field)self.amount_field.set_value(false);for(var key in preset){if(!preset.hasOwnProperty(key)||key==="amount")continue;if(preset[key]&&self.hasOwnProperty(key+"_field"))
self[key+"_field"].set_value(preset[key]);}
if(preset.amount&&self.amount_field){if(preset.amount_type==="fixed")
self.amount_field.set_value(preset.amount);else if(preset.amount_type==="percentage_of_total")
self.amount_field.set_value(self.st_line.amount*preset.amount/100);else if(preset.amount_type==="percentage_of_balance"){self.amount_field.set_value(0);self.updateBalance();self.amount_field.set_value(-1*self.get("balance")*preset.amount/100);}}},initialLineClickHandler:function(){var self=this;if(self.get("mode")==="match"){self.set("mode","inactive");}else{self.set("mode","match");}},lineOpenBalanceClickHandler:function(){var self=this;if(self.get("mode")==="create"){self.set("mode","match");}else{self.set("mode","create");}},changePartnerClickHandler:function(){var self=this;self.$(".change_partner_container").find("input").attr("placeholder",self.st_line.partner_name);self.$(".change_partner_container").show();self.$(".partner_name").hide();self.change_partner_field.$drop_down.trigger("click");},updateAccountingViewMatchedLines:function(){var self=this;$.each(self.$(".tbody_matched_lines .bootstrap_popover"),function(){$(this).popover('destroy')});self.$(".tbody_matched_lines").empty();_(self.get("mv_lines_selected")).each(function(line){var $line=$(QWeb.render("bank_statement_reconciliation_move_line",{line:line,selected:true}));self.bindPopoverTo($line.find(".line_info_button"));if(line.propose_partial_reconcile)self.bindPopoverTo($line.find(".do_partial_reconcile_button"));if(line.partial_reconcile)self.bindPopoverTo($line.find(".undo_partial_reconcile_button"));self.$(".tbody_matched_lines").append($line);});},updateAccountingViewCreatedLines:function(){var self=this;$.each(self.$(".tbody_created_lines .bootstrap_popover"),function(){$(this).popover('destroy')});self.$(".tbody_created_lines").empty();_(self.getCreatedLines()).each(function(line){var $line=$(QWeb.render("bank_statement_reconciliation_created_line",{line:line}));$line.click(function(){self.removeLine($(this))});self.$(".tbody_created_lines").append($line);if(line.no_remove_action){$line.hover(function(){$(this).prev().addClass("active")},function(){$(this).prev().removeClass("active")});}});},updateMatchView:function(){var self=this;var table=self.$(".match table");var nothing_displayed=true;$.each(self.$(".match table .bootstrap_popover"),function(){$(this).popover('destroy')});table.empty();var slice_start=self.get("pager_index")*self.max_move_lines_displayed;var slice_end=(self.get("pager_index")+1)*self.max_move_lines_displayed;_(_.filter(self.mv_lines_deselected,function(o){return o.name.indexOf(self.filter)!==-1||o.ref.indexOf(self.filter)!==-1}).slice(slice_start,slice_end)).each(function(line){var $line=$(QWeb.render("bank_statement_reconciliation_move_line",{line:line,selected:false}));self.bindPopoverTo($line.find(".line_info_button"));table.append($line);nothing_displayed=false;});_(self.get("mv_lines")).each(function(line){var $line=$(QWeb.render("bank_statement_reconciliation_move_line",{line:line,selected:false}));self.bindPopoverTo($line.find(".line_info_button"));table.append($line);nothing_displayed=false;});if(nothing_displayed&&this.filter!=="")
table.append(QWeb.render("filter_no_match",{filter_str:self.filter}));},updatePagerControls:function(){var self=this;if(self.get("pager_index")===0)
self.$(".pager_control_left").addClass("disabled");else
self.$(".pager_control_left").removeClass("disabled");if(!self.can_fetch_more_move_lines)
self.$(".pager_control_right").addClass("disabled");else
self.$(".pager_control_right").removeClass("disabled");},balanceChanged:function(){var self=this;self.is_valid=false;self.$(".tip_reconciliation_not_balanced").show();self.$(".tbody_open_balance").empty();self.$(".button_ok").text("OK").removeClass("oe_highlight").attr("disabled","disabled");var balance_type=undefined;if(Math.abs(self.get("balance")).toFixed(3)==="0.000")balance_type="equal";else if(self.get("balance")*self.st_line.amount>0)balance_type="greater";else if(self.get("balance")*self.st_line.amount<0)balance_type="lower";if(balance_type==="equal"){displayValidState(true);}else if(balance_type==="greater"){createOpenBalance("Create Write-off");}else if(balance_type==="lower"){if(self.st_line.has_no_partner){createOpenBalance("Choose counterpart");}else{displayValidState(false,"Keep open");createOpenBalance("Open balance");}}
if(self.get("mv_lines_selected").length>0){var propose_partial=self.getCreatedLines().length===0&&self.get("mv_lines_selected").length===1&&balance_type==="greater"&&!self.get("mv_lines_selected")[0].partial_reconcile;self.get("mv_lines_selected")[0].propose_partial_reconcile=propose_partial;self.updateAccountingViewMatchedLines();}
function displayValidState(higlight_ok_button,ok_button_text){self.is_valid=true;self.$(".tip_reconciliation_not_balanced").hide();self.$(".button_ok").removeAttr("disabled");if(higlight_ok_button)self.$(".button_ok").addClass("oe_highlight");if(ok_button_text!==undefined)self.$(".button_ok").text(ok_button_text)}
function createOpenBalance(name){var balance=self.get("balance");var amount=self.formatCurrency(Math.abs(balance),self.st_line.currency_id);var $line=$(QWeb.render("bank_statement_reconciliation_line_open_balance",{debit:balance>0?amount:"",credit:balance<0?amount:"",account_code:self.map_account_id_code[self.st_line.open_balance_account_id]}));if(name!==undefined)
$line.find(".cell_label").text(name);self.$(".tbody_open_balance").empty().append($line);}},modeChanged:function(o,val){var self=this;self.$(".action_pane.active").removeClass("active");if(val.oldValue==="create")
self.addLineBeingEdited();if(self.get("mode")==="inactive"){self.$(".match").slideUp(self.animation_speed);self.$(".create").slideUp(self.animation_speed);self.el.dataset.mode="inactive";}else if(self.get("mode")==="match"){var old_animation_speed=self.animation_speed;return $.when(self.updateMatches()).then(function(){var new_animation_speed=self.animation_speed;self.animation_speed=old_animation_speed;if(self.$el.hasClass("no_match")){self.animation_speed=0;self.set("mode","create");return;}
self.$(".match").slideDown(self.animation_speed);self.$(".create").slideUp(self.animation_speed);self.el.dataset.mode="match";self.animation_speed=new_animation_speed;});}else if(self.get("mode")==="create"){self.initializeCreateForm();self.$(".match").slideUp(self.animation_speed);self.$(".create").slideDown(self.animation_speed);self.el.dataset.mode="create";}},pagerChanged:function(){this.updateMatches();},mvLinesChanged:function(){var self=this;if(self.get("pager_index")!==0&&self.get("mv_lines").length===0&&!self.can_fetch_more_move_lines){self.set("pager_index",0);}
if(self.get("mv_lines").length+self.mv_lines_deselected.length===0&&!self.can_fetch_more_move_lines&&self.filter===""){self.$el.addClass("no_match");if(self.get("mode")==="match"){self.set("mode","inactive");}}else{self.$el.removeClass("no_match");}
_.each(self.get("mv_lines"),function(line){if(line.partial_reconciliation_siblings_ids.length>0){var correct_format=_.collect(line.partial_reconciliation_siblings_ids,function(o){return{'id':o}});self.getParent().excludeMoveLines(self,self.partner_id,correct_format);}});self.updateMatchView();self.updatePagerControls();},mvLinesSelectedChanged:function(elt,val){var self=this;var added_lines=_.difference(val.newValue,val.oldValue);var removed_lines=_.difference(val.oldValue,val.newValue);self.getParent().excludeMoveLines(self,self.partner_id,added_lines);self.getParent().unexcludeMoveLines(self,self.partner_id,removed_lines);$.when(self.updateMatches()).then(function(){self.updateAccountingViewMatchedLines();self.updateBalance();});},formCreateInputChanged:function(elt,val){var self=this;var line_created_being_edited=self.get("line_created_being_edited");line_created_being_edited[0][elt.corresponding_property]=val.newValue;line_created_being_edited[0].currency_id=self.st_line.currency_id;if(elt===self.account_id_field)
line_created_being_edited[0].account_num=self.map_account_id_code[elt.get("value")];var deferred_tax=new $.Deferred();if(elt===self.tax_id_field||elt===self.amount_field){var amount=self.amount_field.get("value");var tax_id=self.tax_id_field.get("value");if(amount&&tax_id){deferred_tax=$.when(self.model_tax.call("compute_for_bank_reconciliation",[tax_id,amount])).then(function(data){line_created_being_edited[0].amount_with_tax=line_created_being_edited[0].amount;line_created_being_edited[0].amount=(data.total.toFixed(3)===amount.toFixed(3)?amount:data.total);var current_line_cursor=1;$.each(data.taxes,function(index,tax){if(tax.amount!==0.0){var tax_account_id=(amount>0?tax.account_collected_id:tax.account_paid_id);tax_account_id=tax_account_id!==false?tax_account_id:line_created_being_edited[0].account_id;line_created_being_edited[current_line_cursor]={id:line_created_being_edited[0].id,account_id:tax_account_id,account_num:self.map_account_id_code[tax_account_id],label:tax.name,amount:tax.amount,no_remove_action:true,currency_id:self.st_line.currency_id,is_tax_line:true};current_line_cursor=current_line_cursor+1;}});});}else{line_created_being_edited.length=1;deferred_tax.resolve();}}else{deferred_tax.resolve();}
$.when(deferred_tax).then(function(){var rounding=1/self.map_currency_id_rounding[self.st_line.currency_id];$.each(line_created_being_edited,function(index,val){if(val.amount){line_created_being_edited[index].amount=Math.round(val.amount*rounding)/rounding;line_created_being_edited[index].amount_str=self.formatCurrency(Math.abs(val.amount),val.currency_id);}
if(val.amount_with_tax)
line_created_being_edited[index].amount_with_tax=Math.round(val.amount_with_tax*rounding)/rounding;});self.set("line_created_being_edited",line_created_being_edited);self.createdLinesChanged();});},createdLinesChanged:function(){var self=this;self.updateAccountingViewCreatedLines();self.updateBalance();if(self.islineCreatedBeingEditedValid())self.$(".add_line").show();else self.$(".add_line").hide();},doPartialReconcileButtonClickHandler:function(e){var self=this;var line_id=$(e.currentTarget).closest("tr").data("lineid");var line=_.find(self.get("mv_lines_selected"),function(o){return o.id==line_id});self.partialReconcileLine(line);$(e.currentTarget).popover('destroy');self.updateAccountingViewMatchedLines();self.updateBalance();e.stopPropagation();},partialReconcileLine:function(line){var self=this;var balance=self.get("balance");line.initial_amount=line.debit!==0?line.debit:-1*line.credit;if(balance<0){line.debit+=balance;line.debit_str=self.formatCurrency(line.debit,self.st_line.currency_id);}else{line.credit-=balance;line.credit_str=self.formatCurrency(line.credit,self.st_line.currency_id);}
line.propose_partial_reconcile=false;line.partial_reconcile=true;},undoPartialReconcileButtonClickHandler:function(e){var self=this;var line_id=$(e.currentTarget).closest("tr").data("lineid");var line=_.find(self.get("mv_lines_selected"),function(o){return o.id==line_id});self.unpartialReconcileLine(line);$(e.currentTarget).popover('destroy');self.updateAccountingViewMatchedLines();self.updateBalance();e.stopPropagation();},unpartialReconcileLine:function(line){var self=this;if(line.initial_amount>0){line.debit=line.initial_amount;line.debit_str=self.formatCurrency(line.debit,self.st_line.currency_id);}else{line.credit=-1*line.initial_amount;line.credit_str=self.formatCurrency(line.credit,self.st_line.currency_id);}
line.propose_partial_reconcile=true;line.partial_reconcile=false;},updateBalance:function(){var self=this;var mv_lines_selected=self.get("mv_lines_selected");var lines_selected_num=mv_lines_selected.length;if(lines_selected_num!==1){_.each(mv_lines_selected,function(line){if(line.partial_reconcile===true)self.unpartialReconcileLine(line);if(line.propose_partial_reconcile===true)line.propose_partial_reconcile=false;});self.updateAccountingViewMatchedLines();}
var balance=0;balance-=self.st_line.amount;_.each(mv_lines_selected,function(o){balance=balance-o.debit+o.credit;});_.each(self.getCreatedLines(),function(o){balance+=o.amount;});balance=Math.round(balance*1000)/1000;self.set("balance",balance);},updateMatches:function(){var self=this;var deselected_lines_num=self.mv_lines_deselected.length;var offset=self.get("pager_index")*self.max_move_lines_displayed-deselected_lines_num;if(offset<0)offset=0;var limit=(self.get("pager_index")+1)*self.max_move_lines_displayed-deselected_lines_num;if(limit>self.max_move_lines_displayed)limit=self.max_move_lines_displayed;var excluded_ids=_.collect(self.get("mv_lines_selected").concat(self.mv_lines_deselected),function(o){return o.id;});var globally_excluded_ids=[];if(self.st_line.has_no_partner)
_.each(self.getParent().excluded_move_lines_ids,function(o){globally_excluded_ids=globally_excluded_ids.concat(o)});else
globally_excluded_ids=self.getParent().excluded_move_lines_ids[self.partner_id];if(globally_excluded_ids!==undefined)
for(var i=0;i<globally_excluded_ids.length;i++)
if(excluded_ids.indexOf(globally_excluded_ids[i])===-1)
excluded_ids.push(globally_excluded_ids[i]);limit+=1;if(limit>0){return self.model_bank_statement_line.call("get_move_lines_for_reconciliation_by_statement_line_id",[self.st_line.id,excluded_ids,self.filter,offset,limit]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line,self.st_line.currency_id)},self);self.can_fetch_more_move_lines=(lines.length===limit);self.set("mv_lines",lines.slice(0,limit-1));});}else{self.set("mv_lines",[]);}},changePartner:function(partner_id){var self=this;self.is_consistent=false;return self.model_bank_statement_line.call("write",[[self.st_line_id],{'partner_id':partner_id}]).then(function(){self.do_load_reconciliation_proposition=false;self.animation_speed=0;return $.when(self.restart(self.get("mode"))).then(function(){self.do_load_reconciliation_proposition=true;self.is_consistent=true;self.set("mode","match");});});},prepareSelectedMoveLineForPersisting:function(line){return{name:line.name,debit:line.debit,credit:line.credit,counterpart_move_line_id:line.id,};},prepareCreatedMoveLineForPersisting:function(line){var dict={};if(dict['account_id']===undefined)
dict['account_id']=line.account_id;dict['name']=line.label;var amount=line.tax_id?line.amount_with_tax:line.amount;if(amount>0)dict['credit']=amount;if(amount<0)dict['debit']=-1*amount;if(line.tax_id)dict['account_tax_id']=line.tax_id;if(line.is_tax_line)dict['is_tax_line']=line.is_tax_line;if(line.analytic_account_id)dict['analytic_account_id']=line.analytic_account_id;return dict;},prepareOpenBalanceForPersisting:function(){var balance=this.get("balance");var dict={};dict['account_id']=this.st_line.open_balance_account_id;dict['name']=this.st_line.name+' : '+_t("Open balance");if(balance>0)dict['debit']=balance;if(balance<0)dict['credit']=-1*balance;return dict;},makeMoveLineDicts:function(){var self=this;var mv_line_dicts=[];_.each(self.get("mv_lines_selected"),function(o){mv_line_dicts.push(self.prepareSelectedMoveLineForPersisting(o))});_.each(self.getCreatedLines(),function(o){mv_line_dicts.push(self.prepareCreatedMoveLineForPersisting(o))});if(Math.abs(self.get("balance")).toFixed(3)!=="0.000")mv_line_dicts.push(self.prepareOpenBalanceForPersisting());return mv_line_dicts;},persistAndDestroy:function(speed){var self=this;speed=(isNaN(speed)?self.animation_speed:speed);if(!self.is_consistent)return;var height=self.$el.outerHeight();var container=$("<div />");container.css("height",height).css("marginTop",self.$el.css("marginTop")).css("marginBottom",self.$el.css("marginBottom"));self.$el.wrap(container);var deferred_animation=self.$el.parent().slideUp(speed*height/150);self.$(".button_ok").attr("disabled","disabled");return self.model_bank_statement_line.call("process_reconciliation",[self.st_line_id,self.makeMoveLineDicts()]).done(function(){self.getParent().unexcludeMoveLines(self,self.partner_id,self.get("mv_lines_selected"));$.each(self.$(".bootstrap_popover"),function(){$(this).popover('destroy')});return $.when(deferred_animation).then(function(){self.$el.parent().remove();var parent=self.getParent();return $.when(self.destroy()).then(function(){parent.childValidated(self);});});}).fail(function(){self.$el.parent().slideDown(speed*height/150,function(){self.$el.unwrap();});}).always(function(){self.$(".button_ok").removeAttr("disabled");});},});instance.web.views.add('tree_account_reconciliation','instance.web.account.ReconciliationListView');instance.web.account.ReconciliationListView=instance.web.ListView.extend({init:function(){this._super.apply(this,arguments);var self=this;this.current_partner=null;this.on('record_selected',this,function(){if(self.get_selected_ids().length===0){self.$(".oe_account_recon_reconcile").attr("disabled","");}else{self.$(".oe_account_recon_reconcile").removeAttr("disabled");}});},load_list:function(){var self=this;var tmp=this._super.apply(this,arguments);if(this.partners){this.$el.prepend(QWeb.render("AccountReconciliation",{widget:this}));this.$(".oe_account_recon_previous").click(function(){self.current_partner=(((self.current_partner-1)%self.partners.length)+self.partners.length)%self.partners.length;self.search_by_partner();});this.$(".oe_account_recon_next").click(function(){self.current_partner=(self.current_partner+1)%self.partners.length;self.search_by_partner();});this.$(".oe_account_recon_reconcile").click(function(){self.reconcile();});this.$(".oe_account_recom_mark_as_reconciled").click(function(){self.mark_as_reconciled();});}
return tmp;},do_search:function(domain,context,group_by){var self=this;this.last_domain=domain;this.last_context=context;this.last_group_by=group_by;this.old_search=_.bind(this._super,this);var mod=new instance.web.Model("account.move.line",context,domain);return mod.call("list_partners_to_reconcile",[]).then(function(result){var current=self.current_partner!==null?self.partners[self.current_partner][0]:null;self.partners=result;var index=_.find(_.range(self.partners.length),function(el){if(current===self.partners[el][0])
return true;});if(index!==undefined)
self.current_partner=index;else
self.current_partner=self.partners.length==0?null:0;self.search_by_partner();});},search_by_partner:function(){var self=this;var fct=function(){return self.old_search(new instance.web.CompoundDomain(self.last_domain,[["partner_id","in",self.current_partner===null?[]:[self.partners[self.current_partner][0]]]]),self.last_context,self.last_group_by);};if(self.current_partner===null){self.last_reconciliation_date=_t("Never");return fct();}else{return new instance.web.Model("res.partner").call("read",[self.partners[self.current_partner][0],["last_reconciliation_date"]]).then(function(res){self.last_reconciliation_date=instance.web.format_value(res.last_reconciliation_date,{"type":"datetime"},_t("Never"));return fct();});}},reconcile:function(){var self=this;var ids=this.get_selected_ids();if(ids.length===0){new instance.web.Dialog(this,{title:_t("Warning"),size:'medium',},$("<div />").text(_t("You must choose at least one record."))).open();return false;}
new instance.web.Model("ir.model.data").call("get_object_reference",["account","action_view_account_move_line_reconcile"]).then(function(result){var additional_context=_.extend({active_id:ids[0],active_ids:ids,active_model:self.model});return self.rpc("/web/action/load",{action_id:result[1],context:additional_context}).done(function(result){result.context=instance.web.pyeval.eval('contexts',[result.context,additional_context]);result.flags=result.flags||{};result.flags.new_window=true;return self.do_action(result,{on_close:function(){self.do_search(self.last_domain,self.last_context,self.last_group_by);}});});});},mark_as_reconciled:function(){var self=this;var id=self.partners[self.current_partner][0];new instance.web.Model("res.partner").call("mark_as_reconciled",[[id]]).then(function(){self.do_search(self.last_domain,self.last_context,self.last_group_by);});},do_select:function(ids,records){this.trigger('record_selected')
this._super.apply(this,arguments);},});};;

/* /account/static/src/js/account_move_line_quickadd.js defined in bundle 'web.assets_backend' */
openerp.account.quickadd=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.account=instance.web.account||{};instance.web.views.add('tree_account_move_line_quickadd','instance.web.account.QuickAddListView');instance.web.account.QuickAddListView=instance.web.ListView.extend({init:function(){this._super.apply(this,arguments);this.journals=[];this.periods=[];this.current_journal=null;this.current_period=null;this.default_period=null;this.default_journal=null;this.current_journal_type=null;this.current_journal_currency=null;this.current_journal_analytic=null;},start:function(){var tmp=this._super.apply(this,arguments);var self=this;var defs=[];this.$el.parent().prepend(QWeb.render("AccountMoveLineQuickAdd",{widget:this}));this.$el.parent().find('.oe_account_select_journal').change(function(){self.current_journal=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.$el.parent().find('.oe_account_select_period').change(function(){self.current_period=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.on('edit:after',this,function(){self.$el.parent().find('.oe_account_select_journal').attr('disabled','disabled');self.$el.parent().find('.oe_account_select_period').attr('disabled','disabled');});this.on('save:after cancel:after',this,function(){self.$el.parent().find('.oe_account_select_journal').removeAttr('disabled');self.$el.parent().find('.oe_account_select_period').removeAttr('disabled');});var mod=new instance.web.Model("account.move.line",self.dataset.context,self.dataset.domain);defs.push(mod.call("default_get",[['journal_id','period_id'],self.dataset.context]).then(function(result){self.current_period=result['period_id'];self.current_journal=result['journal_id'];}));defs.push(mod.call("list_journals",[]).then(function(result){self.journals=result;}));defs.push(mod.call("list_periods",[]).then(function(result){self.periods=result;}));return $.when(tmp,defs);},do_search:function(domain,context,group_by){var self=this;this.last_domain=domain;this.last_context=context;this.last_group_by=group_by;this.old_search=_.bind(this._super,this);var o;self.$el.parent().find('.oe_account_select_journal').children().remove().end();self.$el.parent().find('.oe_account_select_journal').append(new Option('',''));for(var i=0;i<self.journals.length;i++){o=new Option(self.journals[i][1],self.journals[i][0]);if(self.journals[i][0]===self.current_journal){self.current_journal_type=self.journals[i][2];self.current_journal_currency=self.journals[i][3];self.current_journal_analytic=self.journals[i][4];$(o).attr('selected',true);}
self.$el.parent().find('.oe_account_select_journal').append(o);}
self.$el.parent().find('.oe_account_select_period').children().remove().end();self.$el.parent().find('.oe_account_select_period').append(new Option('',''));for(var i=0;i<self.periods.length;i++){o=new Option(self.periods[i][1],self.periods[i][0]);self.$el.parent().find('.oe_account_select_period').append(o);}
self.$el.parent().find('.oe_account_select_period').val(self.current_period).attr('selected',true);return self.search_by_journal_period();},search_by_journal_period:function(){var self=this;var domain=[];if(self.current_journal!==null)domain.push(["journal_id","=",self.current_journal]);if(self.current_period!==null)domain.push(["period_id","=",self.current_period]);self.last_context["journal_id"]=self.current_journal===null?false:self.current_journal;if(self.current_period===null)delete self.last_context["period_id"];else self.last_context["period_id"]=self.current_period;self.last_context["journal_type"]=self.current_journal_type;self.last_context["currency"]=self.current_journal_currency;self.last_context["analytic_journal_id"]=self.current_journal_analytic;var compound_domain=new instance.web.CompoundDomain(self.last_domain,domain);self.dataset.domain=compound_domain.eval();return self.old_search(compound_domain,self.last_context,self.last_group_by);},});};;

/* /account/static/src/js/account_tour_bank_statement_reconciliation.js defined in bundle 'web.assets_backend' */
(function(){'use strict';var _t=openerp._t;openerp.Tour.register({id:'bank_statement_reconciliation',name:_t("Reconcile the demo bank statement"),path:'/web',mode:'test',steps:[{title:"go to accounting",element:'.oe_menu_toggler:contains("Accounting"):visible',},{title:"go to bank statements",element:'.oe_menu_leaf:contains("Bank Statement"):visible',},{title:"select first bank statement",element:'.oe_list_content tbody tr:contains("BNK/2014/001")',},{title:"click the reconcile button",element:'.oe_form_container header button:contains("Reconcile")',},{title:"set second reconciliation in match mode",element:'.oe_bank_statement_reconciliation_line:nth-child(2) .initial_line'},{title:"deselect SAJ/2014/002 from second reconciliation",element:'.oe_bank_statement_reconciliation_line:nth-child(2) .accounting_view .mv_line:contains("SAJ/2014/002")'},{title:"check it appeared in first reconciliation's matches list and select SAJ/2014/002 in second reconciliation",waitNot:'.oe_bank_statement_reconciliation_line:nth-child(2) .accounting_view .mv_line:contains("SAJ/2014/002")',waitFor:'.oe_bank_statement_reconciliation_line:first-child .mv_line:contains("SAJ/2014/002")',element:'.oe_bank_statement_reconciliation_line:nth-child(2) .mv_line:contains("SAJ/2014/002")'},{title:"select SAJ/2014/001",element:'.oe_bank_statement_reconciliation_line:first-child .mv_line:contains("SAJ/2014/001")'},{title:"click on the partial reconciliation button",element:'.oe_bank_statement_reconciliation_line:first-child .mv_line:contains("SAJ/2014/001") .do_partial_reconcile_button'},{title:"click on the OK button",element:'.oe_bank_statement_reconciliation_line:first-child .button_ok.oe_highlight'},{title:"change the partner (1)",waitNot:'.oe_bank_statement_reconciliation_line:nth-child(4)',element:'.oe_bank_statement_reconciliation_line:first-child .partner_name'},{title:"change the partner (2)",element:'.oe_bank_statement_reconciliation_line:first-child .change_partner_container input',sampleText:'Vauxoo',},{title:"change the partner (3)",element:'.ui-autocomplete .ui-menu-item:contains("Vauxoo")'},{title:"check the reconciliation is reloaded and has no match",element:'.oe_bank_statement_reconciliation_line:first-child.no_match',},{title:"change the partner back (1)",element:'.oe_bank_statement_reconciliation_line:first-child .partner_name'},{title:"change the partner back (2)",element:'.oe_bank_statement_reconciliation_line:first-child .change_partner_container input',sampleText:'Best Designers',},{title:"change the partner back (3)",element:'.ui-autocomplete .ui-menu-item:contains("Best Designers")'},{title:"select SAJ/2014/002",element:'.oe_bank_statement_reconciliation_line:first-child .mv_line:contains("SAJ/2014/002")'},{title:"click on the OK button",element:'.oe_bank_statement_reconciliation_line:first-child .button_ok.oe_highlight'},{title:"check following reconciliation passes in mode create",waitNot:'.oe_bank_statement_reconciliation_line:nth-child(3)',element:'.oe_bank_statement_reconciliation_line:first-child[data-mode="create"]'},{title:"click the Profit/Loss preset",element:'.oe_bank_statement_reconciliation_line:first-child button:contains("Profit / Loss")'},{title:"click on the OK button",element:'.oe_bank_statement_reconciliation_line:first-child .button_ok.oe_highlight'},{title:"select SAJ/2014/003",waitNot:'.oe_bank_statement_reconciliation_line:nth-child(2)',element:'.oe_bank_statement_reconciliation_line:first-child .mv_line:contains("SAJ/2014/003")'},{title:"click on the Keep Open button",element:'.oe_bank_statement_reconciliation_line:first-child .button_ok:not(.oe_highlight)'},{title:"check 'finish screen' and close the statement",waitFor:'.done_message',element:'.button_close_statement'},{title:"check the statement is closed",element:'.oe_form_container header .label:contains("Closed")'},]});}());;

/* /newsletter/static/src/js/newsletter.js defined in bundle 'web.assets_backend' */
openerp.newsletter=function(instance)
{instance.web.form.widgets.add('text_email_html','openerp.newsletter.FieldEmailHTML');openerp.newsletter.FieldEmailHTML=instance.web_ckeditor4.FieldCKEditor4.extend({init:function()
{this.ckeditor_config.removePlugins+=',scayt,preview,a11yhelp,about,wsc';_.extend(this.ckeditor_config,{disableNativeSpellChecker:false,});return this._super.apply(this,arguments);}});};

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/import.js defined in bundle 'web.assets_backend' */
openerp.base_import=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;var _lt=instance.web._lt;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
instance.web.ListView.prototype.defaults.import_enabled=true;instance.web.ListView.include({load_list:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);if(add_button){this.$buttons.on('click','.oe_list_button_import',function(){self.do_action({type:'ir.actions.client',tag:'import',params:{model:self.dataset.model,context:self.getParent().action.context,}},{on_reverse_breadcrumb:function(){self.reload();},});return false;});}}});instance.web.client_actions.add('import','instance.web.DataImport');instance.web.DataImport=instance.web.Widget.extend({template:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:'utf-8'},{name:'separator',label:_lt("Separator:"),value:','},{name:'quoting',label:_lt("Quoting:"),value:'"'}],events:{'change .oe_import_file':'loaded_file','click .oe_import_file_reload':'loaded_file','change input.oe_import_has_header, .oe_import_options input':'settings_changed','click a.oe_import_toggle':function(e){e.preventDefault();var $el=$(e.target);($el.next().length?$el.next():$el.parent().next()).toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},'click .oe_import_validate':'validate','click .oe_import_import':'import','click .oe_import_cancel':function(e){e.preventDefault();this.exit();}},init:function(parent,action){var self=this;this._super.apply(this,arguments);this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.Import=new instance.web.Model('base_import.import');},start:function(){var self=this;this.setup_encoding_picker();this.setup_separator_picker();return $.when(this._super(),this.Import.call('create',[{'res_model':this.res_model}]).done(function(id){self.id=id;self.$('input[name=import_id]').val(id);}))},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'160px',query:function(q){var make=function(term){return{id:term,text:term};};var suggestions=_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 '+'gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),make);if(q.term){suggestions.unshift(make(q.term));}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:'utf-8',text:'utf-8'});}}).select2('val','utf-8');},setup_separator_picker:function(){this.$('input.oe_import_separator').select2({width:'160px',query:function(q){var suggestions=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked')};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});return options;},onfile_loaded:function(){this.$('.oe_import_button, .oe_import_file_reload').prop('disabled',true);if(!this.$('input.oe_import_file').val()){return;}
this.$el.removeClass('oe_import_preview oe_import_error');jsonp(this.$el,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$('.oe_import_button, .oe_import_file_reload').prop('disabled',true);this.$el.addClass('oe_import_with_file');this.$el.removeClass('oe_import_preview_error oe_import_error');this.$el.toggleClass('oe_import_noheaders',!this.$('input.oe_import_has_header').prop('checked'));this.Import.call('parse_preview',[this.id,this.import_options()]).done(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$('.oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview_error oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){this.$('.oe_import_import').removeClass('oe_highlight');this.$('.oe_import_validate').addClass('oe_highlight');this.$('.oe_import_button, .oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview');this.$('table').html(QWeb.render('ImportView.preview',result));if(result.headers.length===1){this.$('.oe_import_options').show();this.onresults(null,null,null,[{type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")}]);}
var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.select2({allowClear:true,minimumInputLength:0,data:data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
callback(item_finder(default_value));},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'});},generate_fields_completion:function(root){var basic=[];var regulars=[];var o2m=[];function traverse(field,ancestors,collection){var subfields=field.fields;var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(!collection){if(field.name==='id'){collection=basic}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required});for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection);}}
_(root.fields).each(function(field){traverse(field,[]);});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);return basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m}]);},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();kwargs.context=_.extend({},this.parent_context,{tracking_disable:!this.$('#oe_import_tracking').prop('checked')});return this.Import.call('do',[this.id,fields,this.import_options()],kwargs).then(undefined,function(error,event){if(event){event.preventDefault();}
return $.when([{type:'error',record:false,message:error.data.arguments[1],}]);});},onvalidate:function(){return this.call_import({dryrun:true}).done(this.proxy('validated'));},onimport:function(){var self=this;return this.call_import({dryrun:false}).done(function(message){if(!_.any(message,function(message){return message.type==='error'})){self['import_succeeded']();return;}
self['import_failed'](message);});},onimported:function(){this.exit();},exit:function(){this.do_action({type:'ir.actions.client',tag:'history_back'});},onresults:function(event,from,to,message){var no_messages=_.isEmpty(message);this.$('.oe_import_import').toggleClass('oe_highlight',no_messages);this.$('.oe_import_validate').toggleClass('oe_highlight',!no_messages);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}
var offset=1;if(this.import_options().headers){offset+=1;}
this.$el.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:_(message).groupBy('message'),at:function(rows){var from=rows.from+offset;var to=rows.to+offset;if(from===to){return _.str.sprintf(_t("at row %d"),from);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices">%s <ul>%s</ul></div>',_.str.escapeHTML(_t("Here are the possible values:")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s">',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("Get all possible values")),'</a>','</div>'].join('')},}));},});StateMachine.create({target:instance.web.DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}]})};;

/* /board/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
openerp.board=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;if(!instance.board){instance.board={};}
instance.web.form.DashBoard=instance.web.form.FormWidget.extend({init:function(view,node){this._super(view,node);this.form_template='DashBoard';this.actions_attrs={};this.action_managers=[];},start:function(){var self=this;this._super.apply(this,arguments);this.$el.find('.oe_dashboard_column').sortable({connectWith:'.oe_dashboard_column',handle:'.oe_header',scroll:false}).bind('sortstop',self.do_save_dashboard);var old_title=this.__parentedParent.get('title');this.__parentedParent.on('load_record',self,function(){self.__parentedParent.set({'title':old_title});})
this.$el.find('.oe_dashboard_link_reset').click(this.on_reset);this.$el.find('.oe_dashboard_link_change_layout').click(this.on_change_layout);this.$el.find('h2.oe_header span.oe_header_txt').click(function(ev){if(ev.target===ev.currentTarget)
self.on_header_string($(ev.target).parent());});this.$el.delegate('.oe_dashboard_column .oe_fold','click',this.on_fold_action);this.$el.delegate('.oe_dashboard_column .oe_close','click',this.on_close_action);_.each(this.node.children,function(column,column_index){_.each(column.children,function(action,action_index){delete(action.attrs.width);delete(action.attrs.height);delete(action.attrs.colspan);var action_id=_.str.toNumber(action.attrs.name);if(!_.isNaN(action_id)){self.rpc('/web/action/load',{action_id:action_id}).done(function(result){self.on_load_action(result,column_index+'_'+action_index,action.attrs);});}});});},on_header_string:function(h2){var self=this;var span=h2.find('span:first').hide();var input=h2.find('.oe_header_text').css('visibility','visible');var attr=h2.closest(".oe_action").data('action_attrs');var change_string=function(new_name){attr['string']=new_name;span.text(new_name).show();input.css('visibility','hidden');self.do_save_dashboard();}
input.unbind().val(span.text()).change(function(event){change_string($(this).val());}).keyup(function(event){if(event.keyCode==27){input.css('visibility','hidden');span.show();}});},on_reset:function(){this.rpc('/web/view/undo_custom',{view_id:this.view.fields_view.view_id,reset:true}).done(this.do_reload);},on_change_layout:function(){var self=this;var qdict={current_layout:this.$el.find('.oe_dashboard').attr('data-layout')};var $dialog=new instance.web.Dialog(this,{title:_t("Edit Layout"),},QWeb.render('DashBoard.layouts',qdict)).open();$dialog.$el.find('li').click(function(){var layout=$(this).attr('data-layout');self.do_change_layout(layout);$dialog.$dialog_box.modal('hide');});},do_change_layout:function(new_layout){var $dashboard=this.$el.find('.oe_dashboard');var current_layout=$dashboard.attr('data-layout');if(current_layout!=new_layout){var clayout=current_layout.split('-').length,nlayout=new_layout.split('-').length,column_diff=clayout-nlayout;if(column_diff>0){var $last_column=$();$dashboard.find('.oe_dashboard_column').each(function(k,v){if(k>=nlayout){$(v).find('.oe_action').appendTo($last_column);}else{$last_column=$(v);}});}
$dashboard.toggleClass('oe_dashboard_layout_'+current_layout+' oe_dashboard_layout_'+new_layout);$dashboard.attr('data-layout',new_layout);this.do_save_dashboard();}},on_fold_action:function(e){var $e=$(e.currentTarget),$action=$e.parents('.oe_action:first'),id=parseInt($action.attr('data-id'),10);if($e.is('.oe_minimize')){$action.data('action_attrs').fold='1';}else{delete($action.data('action_attrs').fold);}
$e.toggleClass('oe_minimize oe_maximize');$action.find('.oe_content').toggle();this.do_save_dashboard();},on_close_action:function(e){if(confirm(_t("Are you sure you want to remove this item ?"))){$(e.currentTarget).parents('.oe_action:first').remove();this.do_save_dashboard();}},do_save_dashboard:function(){var self=this;var board={form_title:this.view.fields_view.arch.attrs.string,style:this.$el.find('.oe_dashboard').attr('data-layout'),columns:[]};this.$el.find('.oe_dashboard_column').each(function(){var actions=[];$(this).find('.oe_action').each(function(){var action_id=$(this).attr('data-id'),new_attrs=_.clone($(this).data('action_attrs'));if(new_attrs.domain){new_attrs.domain=new_attrs.domain_string;delete(new_attrs.domain_string);}
if(new_attrs.context){new_attrs.context=new_attrs.context_string;delete(new_attrs.context_string);}
actions.push(new_attrs);});board.columns.push(actions);});var arch=QWeb.render('DashBoard.xml',board);this.rpc('/web/view/add_custom',{view_id:this.view.fields_view.view_id,arch:arch});},on_load_action:function(result,index,action_attrs){var self=this,action=result,view_mode=action_attrs.view_mode;action_attrs.context_string=action_attrs.context;action_attrs.context=instance.web.pyeval.eval('context',action_attrs.context||{});action_attrs.domain_string=action_attrs.domain;action_attrs.domain=instance.web.pyeval.eval('domain',action_attrs.domain||[],action_attrs.context);if(action_attrs.context['dashboard_merge_domains_contexts']===false){action.context=action_attrs.context||{};action.domain=action_attrs.domain||[];}else{action.context=instance.web.pyeval.eval('contexts',[action.context||{},action_attrs.context]);action.domain=instance.web.pyeval.eval('domains',[action_attrs.domain,action.domain||[]],action.context)}
var action_orig=_.extend({flags:{}},action);if(view_mode&&view_mode!=action.view_mode){action.views=_.map(view_mode.split(','),function(mode){mode=mode==='tree'?'list':mode;return _(action.views).find(function(view){return view[1]==mode;})||[false,mode];});}
action.flags={search_view:false,sidebar:false,views_switcher:false,action_buttons:false,pager:false,low_profile:true,display_title:false,list:{selectable:false}};var am=new instance.web.ActionManager(this),$action=$('#'+this.view.element_id+'_action_'+index);$action.parent().data('action_attrs',action_attrs);this.action_managers.push(am);am.appendTo($action);am.do_action(action);am.do_action=function(action){self.do_action(action);};if(am.inner_widget){var new_form_action=function(id,editable){var new_views=[];_.each(action_orig.views,function(view){new_views[view[1]==='form'?'unshift':'push'](view);});if(!new_views.length||new_views[0][1]!=='form'){new_views.unshift([false,'form']);}
action_orig.views=new_views;action_orig.res_id=id;action_orig.flags={form:{"initial_mode":editable?"edit":"view",}};self.do_action(action_orig);};var list=am.inner_widget.views.list;if(list){list.deferred.done(function(){$(list.controller.groups).off('row_link').on('row_link',function(e,id){new_form_action(id);});});}
var kanban=am.inner_widget.views.kanban;if(kanban){kanban.deferred.done(function(){kanban.controller.open_record=function(id,editable){new_form_action(id,editable);};});}}},renderElement:function(){this._super();var check=_.detect(this.node.children,function(column,column_index){return _.detect(column.children,function(element){return element.tag==="action"?element:false;});});if(!check){return this.no_result();}
for(var i=this.node.children.length;i<3;i++){this.node.children.push({tag:'column',attrs:{},children:[]});}
var rendered=QWeb.render(this.form_template,this);this.$el.html(rendered);},no_result:function(){if(this.view.options.action.help){this.$el.append($('<div class="oe_view_nocontent">').append($('<div>').html(this.view.options.action.help||" ")));}},do_reload:function(){var view_manager=this.view.getParent(),action_manager=view_manager.getParent();this.view.destroy();action_manager.do_action(view_manager.action);}});instance.web.form.DashBoardLegacy=instance.web.form.DashBoard.extend({renderElement:function(){if(this.node.tag=='hpaned'){this.node.attrs.layout='2-1';}else if(this.node.tag=='vpaned'){this.node.attrs.layout='1';}
this.node.tag='board';_.each(this.node.children,function(child){if(child.tag.indexOf('child')==0){child.tag='column';var actions=[],first_child=child.children[0];if(first_child&&first_child.tag=='vpaned'){_.each(first_child.children,function(subchild){actions.push.apply(actions,subchild.children);});child.children=actions;}}});this._super(this);}});instance.web.form.tags.add('hpaned','instance.web.form.DashBoardLegacy');instance.web.form.tags.add('vpaned','instance.web.form.DashBoardLegacy');instance.web.form.tags.add('board','instance.web.form.DashBoard');instance.board.AddToDashboard=instance.web.search.Input.extend({template:'SearchView.addtodashboard',_in_drawer:true,init:function(parent){this._super(parent);this.is_loaded=null;},start:function(){var self=this;this.$el.on('click','h4',this.proxy('load_and_show_option')).on('submit','form',function(e){e.preventDefault();self.add_dashboard();});return $.when();},load_data:function(){var board=new instance.web.Model('board.board');return board.call('list',[board.context()]);},_x:function(){if(!instance.webclient){return $.Deferred().reject();}
var dashboard_menu=instance.webclient.menu.data.data.children;return new instance.web.Model('ir.model.data').query(['res_id']).filter([['name','=','menu_reporting_dashboard']]).first().then(function(result){var menu=_(dashboard_menu).chain().pluck('children').flatten(true).find(function(child){return child.id===result.res_id;}).value();return menu?menu.children:[];});},render_data:function(dashboard_choices){var selection=instance.web.qweb.render("SearchView.addtodashboard.selection",{selections:dashboard_choices});this.$("input").before(selection)},add_dashboard:function(){var self=this;if(!this.view.view_manager.action||!this.$el.find("select").val()){this.do_warn(_t("Can't find dashboard action"));return;}
var data=this.view.build_search_data();var context=new instance.web.CompoundContext(this.view.dataset.get_context()||[]);var domain=new instance.web.CompoundDomain(this.view.dataset.get_domain()||[]);_.each(data.contexts,context.add,context);_.each(data.domains,domain.add,domain);context.add({group_by:instance.web.pyeval.eval('groupbys',data.groupbys||[])});var c=instance.web.pyeval.eval('context',context);for(var k in c){if(c.hasOwnProperty(k)&&/^search_default_/.test(k)){delete c[k];}}
c.dashboard_merge_domains_contexts=false;var d=instance.web.pyeval.eval('domain',domain);this.rpc('/board/add_to_dashboard',{menu_id:this.$el.find("select").val(),action_id:this.view.view_manager.action.id,context_to_save:c,domain:d,view_mode:this.view.view_manager.active_view,name:this.$el.find("input").val()}).done(function(r){if(r===false){self.do_warn(_t("Could not add filter to dashboard"));}else{self.$el.toggleClass('oe_opened');self.do_notify(_t("Filter added to dashboard"),'');}});},load_and_show_option:function(){if(!this.is_loaded){this.is_loaded=this.load_data().done(this.proxy("render_data"));}
this.is_loaded.done(this.proxy('show_option'));},show_option:function(){this.$el.toggleClass('oe_opened');if(!this.$el.hasClass('oe_opened'))
return;this.$("input").val(this.view.fields_view.name||"");},});instance.web.SearchViewDrawer.include({add_common_inputs:function(){this._super();var vm=this.getParent().getParent();if(vm.inner_action&&vm.inner_action.id&&vm.inner_action.views){(new instance.board.AddToDashboard(this));}}});};;

/* /calendar/static/src/js/base_calendar.js defined in bundle 'web.assets_backend' */
openerp.calendar=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.calendar={};function reload_favorite_list(result){var self=current=result;if(result.view){self=result.view;}
new instance.web.Model("res.users").query(["partner_id"]).filter([["id","=",self.dataset.context.uid]]).first().done(function(result){var sidebar_items={};var filter_value=result.partner_id[0];var filter_item={value:filter_value,label:result.partner_id[1]+_lt(" [Me]"),color:self.get_color(filter_value),avatar_model:self.avatar_model,is_checked:true,is_remove:false,};sidebar_items[0]=filter_item;filter_item={value:-1,label:_lt("Everybody's calendars"),color:self.get_color(-1),avatar_model:self.avatar_model,is_checked:false};sidebar_items[-1]=filter_item;new instance.web.Model("calendar.contacts").query(["partner_id"]).filter([["user_id","=",self.dataset.context.uid]]).all().then(function(result){_.each(result,function(item){filter_value=item.partner_id[0];filter_item={value:filter_value,label:item.partner_id[1],color:self.get_color(filter_value),avatar_model:self.avatar_model,is_checked:true};sidebar_items[filter_value]=filter_item;});self.all_filters=sidebar_items;self.now_filter_ids=$.map(self.all_filters,function(o){return o.value;});self.sidebar.filter.events_loaded(self.all_filters);self.sidebar.filter.set_filters();self.sidebar.filter.set_distroy_filters();self.sidebar.filter.addInputBox();self.sidebar.filter.destroy_filter();}).done(function(){self.$calendar.fullCalendar('refetchEvents');if(current.ir_model_m2o){current.ir_model_m2o.set_value(false);}});});}
instance.web_calendar.CalendarView.include({extraSideBar:function(){this._super();if(this.useContacts){new reload_favorite_list(this);}}});instance.web_calendar.SidebarFilter.include({set_distroy_filters:function(){var self=this;if(self.view.useContacts){self.$('.oe_calendar_all_responsibles').on('mouseenter mouseleave',function(e){self.$('.oe_remove_follower').toggleClass('hidden',e.type=='mouseleave');});}},addInputBox:function(){var self=this;if(this.dfm)
return;this.dfm=new instance.web.form.DefaultFieldManager(self);this.dfm.extend_field_desc({partner_id:{relation:"res.partner",},});this.ir_model_m2o=new instance.web.form.FieldMany2One(self.dfm,{attrs:{class:'oe_add_input_box',name:"partner_id",type:"many2one",options:'{"no_open": True}',placeholder:_t("Add Favorite Calendar"),},});this.ir_model_m2o.insertAfter($('div.oe_calendar_filter'));this.ir_model_m2o.on('change:value',self,function(){self.add_filter();});},add_filter:function(){var self=this;new instance.web.Model("res.users").query(["partner_id"]).filter([["id","=",this.view.dataset.context.uid]]).first().done(function(result){$.map(self.ir_model_m2o.display_value,function(element,index){if(result.partner_id[0]!=index){self.ds_message=new instance.web.DataSetSearch(self,'calendar.contacts');self.ds_message.call("create",[{'partner_id':index}]);}});});new reload_favorite_list(this);},destroy_filter:function(e){var self=this;this.$(".oe_remove_follower").on('click',function(e){self.ds_message=new instance.web.DataSetSearch(self,'calendar.contacts');if(!confirm(_t("Do you really want to delete this filter from favorite?"))){return false;}
var id=$(e.currentTarget)[0].dataset.id;self.ds_message.call('search',[[['partner_id','=',parseInt(id)]]]).then(function(record){return self.ds_message.unlink(record);}).done(function(){new reload_favorite_list(self);});});},});instance.web.WebClient=instance.web.WebClient.extend({get_notif_box:function(me){return $(me).closest(".ui-notify-message-style");},get_next_notif:function(){var self=this;this.rpc("/calendar/notify").done(function(result){_.each(result,function(res){setTimeout(function(){if(!($.find(".eid_"+res.event_id)).length){res.title=QWeb.render('notify_title',{'title':res.title,'id':res.event_id});res.message+=QWeb.render("notify_footer");a=self.do_notify(res.title,res.message,true);$(".link2event").on('click',function(){self.rpc("/web/action/load",{action_id:"calendar.action_calendar_event_notify",}).then(function(r){r.res_id=res.event_id;return self.action_manager.do_action(r);});});a.element.find(".link2recall").on('click',function(){self.get_notif_box(this).find('.ui-notify-close').trigger("click");});a.element.find(".link2showed").on('click',function(){self.get_notif_box(this).find('.ui-notify-close').trigger("click");self.rpc("/calendar/notify_ack");});}
else if(self.get_notif_box($.find(".eid_"+res.event_id)).attr("style")!==""){self.get_notif_box($.find(".eid_"+res.event_id)).attr("style","");}},res.timer*1000);});}).fail(function(err,ev){if(err.code===-32098){ev.preventDefault();}});},check_notifications:function(){var self=this;self.get_next_notif();self.intervalNotif=setInterval(function(){self.get_next_notif();},5*60*1000);},show_application:function(){this._super();this.check_notifications();},on_logout:function(){this._super();clearInterval(self.intervalNotif);},});instance.calendar.invitation=instance.web.Widget.extend({init:function(parent,db,action,id,view,attendee_data){this._super(parent);this.db=db;this.action=action;this.id=id;this.view=view;this.attendee_data=attendee_data;},start:function(){var self=this;if(instance.session.session_is_valid(self.db)&&instance.session.username!="anonymous"){self.redirect_meeting_view(self.db,self.action,self.id,self.view);}else{self.open_invitation_form(self.attendee_data);}},open_invitation_form:function(invitation){$('.oe_application').html(QWeb.render('invitation_view',{'invitation':JSON.parse(invitation)}));},redirect_meeting_view:function(db,action,meeting_id,view){var self=this;var action_url='';action_url=_.str.sprintf('/web?db=%s#id=%s&view_type=form&model=calendar.event',db,meeting_id);var reload_page=function(){return location.replace(action_url);};reload_page();},});instance.web.form.Many2ManyAttendee=instance.web.form.FieldMany2ManyTags.extend({tag_template:"many2manyattendee",initialize_texttext:function(){return _.extend(this._super(),{html:{tag:QWeb.render('m2mattendee_tag')}});},map_tag:function(value){return _.map(value,function(el){return{name:el[1],id:el[0],state:el[2]};});},get_render_data:function(ids){var self=this;var dataset=new instance.web.DataSetStatic(this,this.field.relation,self.build_context());return dataset.call('get_attendee_detail',[ids,self.getParent().datarecord.id||false]);},render_tag:function(data){this._super(data);var self=this;if(!self.get("effective_readonly")){var tag_element=self.tags.tagElements();_.each(data,function(value,key){$(tag_element[key]).find(".custom-edit").addClass(data[key][2]);});}}});instance.web.form.widgets=instance.web.form.widgets.extend({'many2manyattendee':'instance.web.form.Many2ManyAttendee',});instance.calendar.event=function(db,action,id,view,attendee_data){instance.session.session_bind(instance.session.origin).done(function(){new instance.calendar.invitation(null,db,action,id,view,attendee_data).appendTo($("body").addClass('openerp'));});};};;

/* /disable_openerp_online/static/src/js/disable_openerp_online.js defined in bundle 'web.assets_backend' */
console.error("Could not get content for /disable_openerp_online/static/src/js/disable_openerp_online.js defined in bundle 'web.assets_backend'.");;

/* /document/static/src/js/document.js defined in bundle 'web.assets_backend' */
openerp.document=function(instance){_t=instance.web._t;instance.web.Sidebar.include({init:function(){this._super.apply(this,arguments);if(this.getParent().view_type=="form"){this.sections.splice(1,0,{'name':'files','label':_t('Attachment(s)'),});this.items['files']=[];}},on_attachments_loaded:function(attachments){var self=this;_.chain(attachments).groupBy(function(attachment){return attachment.name}).each(function(attachment){if(attachment.length>1)
_.map(attachment,function(attachment,i){attachment.name=_.str.sprintf(_t("%s (%s)"),attachment.name,i+1)})})
self._super(attachments);},});};;

/* /edi/static/src/js/edi.js defined in bundle 'web.assets_backend' */
openerp.edi=function(instance){var _t=instance.web._t;instance.edi={};instance.edi.EdiImport=instance.web.Widget.extend({init:function(parent,url){this._super();this.url=url;},start:function(){if(!this.session.session_is_valid()){instance.redirect('/web/login?redir='+encodeURIComponent(window.location));}else{this.show_import();}},show_import:function(){this.destroy_content();this.do_import();},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},do_import:function(){this.rpc('/edi/import_edi_url',{url:this.url}).done(this.on_imported).fail(this.on_imported_error);},on_imported:function(response){if('action'in response){this.rpc("/web/session/save_session_action",{the_action:response.action}).done(function(key){window.location="/#sa="+encodeURIComponent(key);});}
else{new instance.web.Dialog(this,{title:'Import Successful!',buttons:{Ok:function(){this.parents('.modal').modal('hide');window.location="/";}}},$('<div>').html(_t('The document has been successfully imported!'))).open();}},on_imported_error:function(response){var self=this;var msg=_t("Sorry, the document could not be imported.");if(response.data.message){msg+="\n "+_t("Reason:")+response.data.message;}
var params={error:response,message:msg};new instance.web.Dialog(this,{title:_t("Document Import Notification"),buttons:{Ok:function(){this.parents('.modal').modal('hide');}}},$(instance.web.qweb.render("CrashManager.warning",params))).open();}});instance.edi.edi_import=function(url){instance.session.session_bind().done(function(){new instance.edi.EdiImport(null,url).appendTo($("body").addClass('openerp'));});}};;

/* /google_calendar/static/src/js/calendar_sync.js defined in bundle 'web.assets_backend' */
openerp.google_calendar=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web_calendar.CalendarView.include({view_loading:function(r){var self=this;this.$el.on('click','div.oe_cal_sync_button',function(){self.sync_calendar(r);});return this._super(r);},sync_calendar:function(res,button){var self=this;var context=instance.web.pyeval.eval('context');$('div.oe_cal_sync_button').prop('disabled',true);self.rpc('/google_calendar/sync_data',{arch:res.arch,fields:res.fields,model:res.model,fromurl:window.location.href,local_context:context}).done(function(o){if(o.status==="need_auth"){alert(_t("You will be redirected to Google to authorize access to your calendar!"));instance.web.redirect(o.url);}
else if(o.status==="need_config_from_admin"){if(!_.isUndefined(o.action)&&parseInt(o.action)){if(confirm(_t("The Google Synchronization needs to be configured before you can use it, do you want to do it now?"))){self.do_action(o.action);}}
else{alert(_t("An administrator needs to configure Google Synchronization before you can use it!"));}}
else if(o.status==="need_refresh"){self.$calendar.fullCalendar('refetchEvents');}
else if(o.status==="need_reset"){var confirm_text1=_t("The account you are trying to synchronize (%s) is not the same as the last one used (%s)!");var confirm_text2=_t("In order to do this, you first need to disconnect all existing events from the old account.");var confirm_text3=_t("Do you want to do this now?");var text=_.str.sprintf(confirm_text1+"\n"+confirm_text2+"\n\n"+confirm_text3,o.info.new_name,o.info.old_name);if(confirm(text)){self.rpc('/google_calendar/remove_references',{model:res.model,local_context:context}).done(function(o){if(o.status==="OK"){alert(_t("All events have been disconnected from your previous account. You can now restart the synchronization"));}
else if(o.status==="KO"){alert(_t("An error occured while disconnecting events from your previous account. Please retry or contact your administrator."));}});}}}).always(function(o){$('div.oe_cal_sync_button').prop('disabled',false);});}});instance.web_calendar.CalendarView.include({extraSideBar:function(){this._super();if(this.dataset.model=="calendar.event"){this.$el.find('.oe_calendar_filter').prepend(QWeb.render('GoogleCalendar.buttonSynchro'));}}});};;

/* /google_drive/static/src/js/gdrive.js defined in bundle 'web.assets_backend' */
openerp.google_drive=function(instance,m){var _t=instance.web._t,QWeb=instance.web.qweb;instance.web.Sidebar.include({start:function(){var self=this;var ids
this._super.apply(this,arguments);var view=self.getParent();var result;if(view.fields_view.type=="form"){ids=[]
view.on("load_record",self,function(r){ids=[r.id]
self.add_gdoc_items(view,r.id)});}},add_gdoc_items:function(view,res_id){var self=this;var gdoc_item=_.indexOf(_.pluck(self.items.other,'classname'),'oe_share_gdoc');if(gdoc_item!==-1){self.items.other.splice(gdoc_item,1);}
if(res_id){view.sidebar_eval_context().done(function(context){var ds=new instance.web.DataSet(this,'google.drive.config',context);ds.call('get_google_drive_config',[view.dataset.model,res_id,context]).done(function(r){if(!_.isEmpty(r)){_.each(r,function(res){var already_there=false;for(var i=0;i<self.items.other.length;i++){if(self.items.other[i].classname==="oe_share_gdoc"&&self.items.other[i].label.indexOf(res.name)>-1){already_there=true;break;}}
if(!already_there){self.add_items('other',[{label:res.name+'<img style="position:absolute;right:5px;height:20px;width:20px;" title="Google Drive" src="google_drive/static/src/img/drive_icon.png"/>',config_id:res.id,res_id:res_id,res_model:view.dataset.model,callback:self.on_google_doc,classname:'oe_share_gdoc'},]);}})}});});}},fetch:function(model,fields,domain,ctx){return new instance.web.Model(model).query(fields).filter(domain).context(ctx).all()},on_google_doc:function(doc_item){var self=this;self.config=doc_item;var loaded=self.fetch('google.drive.config',['google_drive_resource_id','google_drive_client_id'],[['id','=',doc_item.config_id]]).then(function(configs){var ds=new instance.web.DataSet(self,'google.drive.config');ds.call('get_google_drive_url',[doc_item.config_id,doc_item.res_id,configs[0].google_drive_resource_id,self.dataset.context]).done(function(url){if(url){window.open(url,'_blank');}});});},});};;

/* /google_spreadsheet/static/src/js/search.js defined in bundle 'web.assets_backend' */
openerp.google_spreadsheet=function(instance){var _t=instance.web._t;instance.web.FormView.include({on_processed_onchange:function(result,processed){var self=this;var fields=self.fields;_(result.selection).each(function(selection,fieldname){var field=fields[fieldname];if(!field){return;}
field.field.selection=selection;field.values=selection;field.renderElement();});return this._super(result,processed);},});instance.board.AddToGoogleSpreadsheet=instance.web.search.Input.extend({template:'SearchView.addtogooglespreadsheet',_in_drawer:true,start:function(){var self=this;this.$el.on('click','h4',function(){var view=self.view;var data=view.build_search_data();var model=view.model;var list_view=self.view.getParent().views['list'];var view_id=list_view?list_view.view_id:false;var context=new instance.web.CompoundContext(view.dataset.get_context()||[]);var domain=new instance.web.CompoundDomain(view.dataset.get_domain()||[]);_.each(data.contexts,context.add,context);_.each(data.domains,domain.add,domain);domain=JSON.stringify(domain.eval());var groupbys=instance.web.pyeval.eval('groupbys',data.groupbys).join(" ");var view_id=view_id;var ds=new instance.web.DataSet(self,'google.drive.config');ds.call('set_spreadsheet',[model,domain,groupbys,view_id]).done(function(res){if(res['url']){window.open(res['url'],'_blank');}});});},});instance.web.SearchViewDrawer.include({add_common_inputs:function(){this._super();var vm=this.getParent().getParent();if(vm.inner_action&&vm.inner_action.views){(new instance.board.AddToGoogleSpreadsheet(this));}}});};;

/* /help_online/static/src/js/help_online.js defined in bundle 'web.assets_backend' */
openerp.help_online=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;var _lt=instance.web._lt;instance.web.ListView.include({load_list:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);this.$buttons.on('click','.oe_list_button_help_online',function(){self.do_action({type:'ir.actions.act_url',url:'/partner_mobile',target:'self',});});},});openerp.web.TreeView.include({view_loading:function(r){var ret=this._super(r);if(!_.isUndefined(this.ViewManager.load_help_buttons)){this.ViewManager.load_help_buttons();}
return ret},});openerp.web.ListView.include({view_loading:function(r){var ret=this._super(r);if(!_.isUndefined(this.ViewManager.load_help_buttons)){this.ViewManager.load_help_buttons();}
return ret},});openerp.web.FormView.include({view_loading:function(r){var ret=this._super(r);if(!_.isUndefined(this.ViewManager.clean_help_buttons)){this.ViewManager.clean_help_buttons();}
return ret},do_show:function(options){var ret=this._super(options);if(!_.isUndefined(this.ViewManager.load_help_buttons)){this.ViewManager.load_help_buttons();}
return ret},});openerp.web.ViewManager.include({clean_help_buttons:function(){this.$el.find("div.oe_help_online_buttons").first().remove();},load_help_buttons:function(){var self=this;this.rpc('/help_online/build_url',{model:this.dataset.model,view_type:this.active_view}).then(function(result){self.clean_help_buttons();if(result&&!_.isEmpty(result)){self.$helpButtonsEl=$(QWeb.render("HelpOnline.Buttons",{'view_manager':self,'url_info':result}));self.$el.find("ul.oe_view_manager_switch.oe_button_group.oe_right").first().before(self.$helpButtonsEl);self.$helpButtonsEl.find('a.oe_list_button_help_online').tooltip();if(result.exists===false){self.$helpButtonsEl.find('li').addClass('oe_help_online_not_found')
self.$helpButtonsEl.find('a.oe_list_button_help_online').on('click',function(event){var evt=event;evt.preventDefault();var dialog=new instance.web.Dialog(this,{title:_t('Confirm'),buttons:[{text:_t("Cancel"),click:function(){this.parents('.modal').modal('hide');return false;}},{text:_t("Ok"),click:function(){this.parents('.modal').modal('hide');var form=$("<form></form>");form.attr({id:"formform",action:evt.target.href,method:"GET",target:evt.target.target});$("body").append(form);$("#formform").submit();$("#formform").remove();return false;}}],},$('<div/>').text(_t('Page does not exist. Do you want to create?'))).open();});}}});},});};

/* /hr/static/src/js/suggestions.js defined in bundle 'web.assets_backend' */
openerp.hr=function(session){var _t=session.web._t;var QWeb=session.web.qweb;var suggestions=session.suggestions;var removed_suggested_employee=session.suggestions.removed_suggested_employee=[];suggestions.Employees=session.web.Widget.extend({events:{'click .oe_suggestion_remove.oe_suggestion_employee':'stop_employee_suggestion','click .oe_suggestion_remove_item.oe_suggestion_employee':'remove_employee_suggestion','click .oe_suggestion_follow':'follow_employee',},init:function(){this._super(this,arguments);this.hr_employee=new session.web.DataSetSearch(this,'hr.employee');this.res_users=new session.web.DataSetSearch(this,'res.users');this.employees=[];},start:function(){this._super.apply(this,arguments);return this.fetch_suggested_employee();},fetch_suggested_employee:function(){var self=this;var employee=self.hr_employee.call('get_suggested_thread',{'removed_suggested_threads':removed_suggested_employee}).then(function(res){_(res).each(function(result){result['image']=self.session.url('/web/binary/image',{model:'hr.employee',field:'image_small',id:result.id});});self.employees=res;});return $.when(employee).done(this.proxy('display_suggested_employees'));},display_suggested_employees:function(){var suggested_employees=this.$('.oe_sidebar_suggestion.oe_suggestion_employee');if(suggested_employees){suggested_employees.remove();}
if(this.employees.length===0){return this.$el.empty();}
return this.$el.empty().html(QWeb.render('hr.suggestions.employees',{'widget':this}));},follow_employee:function(event){var self=this;var employee_id=parseInt($(event.currentTarget).attr('id'),10);return this.hr_employee.call('message_subscribe_users',[[employee_id],[this.session.uid],undefined]).then(function(res){self.fetch_suggested_employee();});},remove_employee_suggestion:function(event){removed_suggested_employee.push($(event.currentTarget).attr('id'));return this.fetch_suggested_employee();},stop_employee_suggestion:function(event){var self=this;return this.res_users.call('stop_showing_employees_suggestions',[this.session.uid]).then(function(res){self.$(".oe_sidebar_suggestion.oe_suggestion_employee").hide();});}});session.mail.WallSidebar.include({start:function(){this._super.apply(this,arguments);var sug_employees=new suggestions.Employees(this);return sug_employees.appendTo(this.$('.oe_suggestions_employees'));},});};;

/* /hr_attendance/static/src/js/attendance.js defined in bundle 'web.assets_backend' */
openerp.hr_attendance=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;var _lt=instance.web._lt;instance.hr_attendance.AttendanceSlider=instance.web.Widget.extend({template:'AttendanceSlider',init:function(parent){this._super(parent);this.set({"signed_in":false});},start:function(){var self=this;var tmp=function(){var $sign_in_out_icon=this.$('#oe_attendance_sign_in_out_icon');$sign_in_out_icon.toggleClass("fa-sign-in",!this.get("signed_in"));$sign_in_out_icon.toggleClass("fa-sign-out",this.get("signed_in"));};this.on("change:signed_in",this,tmp);_.bind(tmp,this)();this.$(".oe_attendance_sign_in_out").click(function(ev){ev.preventDefault();self.do_update_attendance();});this.$el.tooltip({title:function(){var last_text=instance.web.format_value(self.last_sign,{type:"datetime"});var current_text=instance.web.format_value(new Date(),{type:"datetime"});var duration=self.last_sign?$.timeago(self.last_sign):"none";if(self.get("signed_in")){return _.str.sprintf(_t("Last sign in: %s,<br />%s.<br />Click to sign out."),last_text,duration);}else{return _.str.sprintf(_t("Click to Sign In at %s."),current_text);}},});return this.check_attendance();},do_update_attendance:function(){var self=this;var hr_employee=new instance.web.DataSet(self,'hr.employee');hr_employee.call('attendance_action_change',[[self.employee.id]]).done(function(result){self.last_sign=new Date();self.set({"signed_in":!self.get("signed_in")});});},check_attendance:function(){var self=this;self.employee=false;this.$el.hide();var employee=new instance.web.DataSetSearch(self,'hr.employee',self.session.user_context,[['user_id','=',self.session.uid]]);return employee.read_slice(['id','name','state','last_sign','attendance_access']).then(function(res){if(_.isEmpty(res))
return;if(res[0].attendance_access===false){return;}
self.$el.show();self.employee=res[0];self.last_sign=instance.web.str_to_datetime(self.employee.last_sign);self.set({"signed_in":self.employee.state!=="absent"});});},});instance.web.UserMenu.include({do_update:function(){this._super();var self=this;this.update_promise.done(function(){if(!_.isUndefined(self.attendanceslider)){return;}
var Users=new instance.web.Model('res.users');Users.call('has_group',['base.group_user']).done(function(is_employee){if(is_employee){self.attendanceslider=new instance.hr_attendance.AttendanceSlider(self);self.attendanceslider.prependTo(instance.webclient.$('.oe_systray'));}else{self.attendanceslider=null;}});});},});};;

/* /hr_timesheet_sheet/static/src/js/timesheet.js defined in bundle 'web.assets_backend' */
openerp.hr_timesheet_sheet=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;instance.hr_timesheet_sheet.WeeklyTimesheet=instance.web.form.FormWidget.extend(instance.web.form.ReinitializeWidgetMixin,{events:{"click .oe_timesheet_weekly_account a":"go_to",},ignore_fields:function(){return['line_id'];},init:function(){this._super.apply(this,arguments);var self=this;this.set({sheets:[],date_to:false,date_from:false,});this.updating=false;this.defs=[];this.field_manager.on("field_changed:timesheet_ids",this,this.query_sheets);this.field_manager.on("field_changed:date_from",this,function(){this.set({"date_from":instance.web.str_to_date(this.field_manager.get_field_value("date_from"))});});this.field_manager.on("field_changed:date_to",this,function(){this.set({"date_to":instance.web.str_to_date(this.field_manager.get_field_value("date_to"))});});this.field_manager.on("field_changed:user_id",this,function(){this.set({"user_id":this.field_manager.get_field_value("user_id")});});this.on("change:sheets",this,this.update_sheets);this.res_o2m_drop=new instance.web.DropMisordered();this.render_drop=new instance.web.DropMisordered();this.description_line=_t("/");this.view.original_save=_.bind(this.view.save,this.view);this.view.save=function(prepend_on_create){self.prepend_on_create=prepend_on_create;return $.when.apply($,self.defs).then(function(){return self.view.original_save(self.prepend_on_create);});};},go_to:function(event){var id=JSON.parse($(event.target).data("id"));this.do_action({type:'ir.actions.act_window',res_model:"account.analytic.account",res_id:id,views:[[false,'form']],target:'current'});},query_sheets:function(){var self=this;if(self.updating)
return;var commands=this.field_manager.get_field_value("timesheet_ids");this.res_o2m_drop.add(new instance.web.Model(this.view.model).call("resolve_2many_commands",["timesheet_ids",commands,[],new instance.web.CompoundContext()])).done(function(result){self.querying=true;self.set({sheets:result});self.querying=false;});},update_sheets:function(){var self=this;if(self.querying)
return;self.updating=true;self.field_manager.set_values({timesheet_ids:self.get("sheets")}).done(function(){self.updating=false;});},initialize_field:function(){instance.web.form.ReinitializeWidgetMixin.initialize_field.call(this);var self=this;self.on("change:sheets",self,self.initialize_content);self.on("change:date_to",self,self.initialize_content);self.on("change:date_from",self,self.initialize_content);self.on("change:user_id",self,self.initialize_content);},initialize_content:function(){var self=this;if(self.setting)
return;if(!self.get("date_to")||!self.get("date_from"))
return;this.destroy_content();var dates;var accounts;var account_names;var default_get;return this.render_drop.add(new instance.web.Model("hr.analytic.timesheet").call("default_get",[['account_id','general_account_id','journal_id','date','name','user_id','product_id','product_uom_id','to_invoice','amount','unit_amount'],new instance.web.CompoundContext({'user_id':self.get('user_id')})]).then(function(result){default_get=result;dates=[];var start=self.get("date_from");var end=self.get("date_to");while(start<=end){dates.push(start);start=start.clone().addDays(1);}
accounts=_(self.get("sheets")).chain().map(function(el){if(typeof(el.account_id)==="object")
el.account_id=el.account_id[0];return el;}).groupBy("account_id").value();var account_ids=_.map(_.keys(accounts),function(el){return el==="false"?false:Number(el)});return new instance.web.Model("hr.analytic.timesheet").call("multi_on_change_account_id",[[],account_ids,new instance.web.CompoundContext({'user_id':self.get('user_id')})]).then(function(accounts_defaults){accounts=_(accounts).chain().map(function(lines,account_id){account_defaults=_.extend({},default_get,(accounts_defaults[account_id]||{}).value||{});account_id=account_id==="false"?false:Number(account_id);var index=_.groupBy(lines,"date");var days=_.map(dates,function(date){var day={day:date,lines:index[instance.web.date_to_str(date)]||[]};var to_add=_.find(day.lines,function(line){return line.name===self.description_line});if(to_add){day.lines=_.without(day.lines,to_add);day.lines.unshift(to_add);}else{day.lines.unshift(_.extend(_.clone(account_defaults),{name:self.description_line,unit_amount:0,date:instance.web.date_to_str(date),account_id:account_id,}));}
return day;});return{account:account_id,days:days,account_defaults:account_defaults};}).value();return new instance.web.Model("account.analytic.account").call("name_get",[_.pluck(accounts,"account"),new instance.web.CompoundContext()]).then(function(result){account_names={};_.each(result,function(el){account_names[el[0]]=el[1];});accounts=_.sortBy(accounts,function(el){return account_names[el.account];});});;});})).then(function(result){self.dates=dates;self.accounts=accounts;self.account_names=account_names;self.default_get=default_get;self.display_data();});},destroy_content:function(){if(this.dfm){this.dfm.destroy();this.dfm=undefined;}},is_valid_value:function(value){var split_value=value.split(":");var valid_value=true;if(split_value.length>2)
return false;_.detect(split_value,function(num){if(isNaN(num)){valid_value=false;}});return valid_value;},display_data:function(){var self=this;self.$el.html(QWeb.render("hr_timesheet_sheet.WeeklyTimesheet",{widget:self}));_.each(self.accounts,function(account){_.each(_.range(account.days.length),function(day_count){if(!self.get('effective_readonly')){self.get_box(account,day_count).val(self.sum_box(account,day_count,true)).change(function(){var num=$(this).val();if(self.is_valid_value(num)){num=(num==0)?0:Number(self.parse_client(num));}
if(isNaN(num)){$(this).val(self.sum_box(account,day_count,true));}else{account.days[day_count].lines[0].unit_amount+=num-self.sum_box(account,day_count);var product=(account.days[day_count].lines[0].product_id instanceof Array)?account.days[day_count].lines[0].product_id[0]:account.days[day_count].lines[0].product_id
var journal=(account.days[day_count].lines[0].journal_id instanceof Array)?account.days[day_count].lines[0].journal_id[0]:account.days[day_count].lines[0].journal_id
self.defs.push(new instance.web.Model("hr.analytic.timesheet").call("on_change_unit_amount",[[],product,account.days[day_count].lines[0].unit_amount,false,false,journal]).then(function(res){account.days[day_count].lines[0]['amount']=res.value.amount||0;self.display_totals();self.sync();}));if(!isNaN($(this).val())){$(this).val(self.sum_box(account,day_count,true));}}});}else{self.get_box(account,day_count).html(self.sum_box(account,day_count,true));}});});self.display_totals();self.$(".oe_timesheet_weekly_adding button").click(_.bind(this.init_add_account,this));},init_add_account:function(){var self=this;if(self.dfm)
return;self.$(".oe_timesheet_weekly_add_row").show();self.dfm=new instance.web.form.DefaultFieldManager(self);self.dfm.extend_field_desc({account:{relation:"account.analytic.account",},});self.account_m2o=new instance.web.form.FieldMany2One(self.dfm,{attrs:{name:"account",type:"many2one",domain:[['type','in',['normal','contract']],['state','<>','close'],['use_timesheets','=',1],['id','not in',_.pluck(self.accounts,"account")],],context:{default_use_timesheets:1,default_type:"contract",},modifiers:'{"required": true}',},});self.account_m2o.prependTo(self.$(".oe_timesheet_weekly_add_row td"));self.$(".oe_timesheet_weekly_add_row button").click(function(){var id=self.account_m2o.get_value();if(id===false){self.dfm.set({display_invalid_fields:true});return;}
var ops=self.generate_o2m_value();new instance.web.Model("hr.analytic.timesheet").call("multi_on_change_account_id",[[],[id],new instance.web.CompoundContext({'user_id':self.get('user_id')})]).then(function(res){res=res[id];var def=_.extend({},self.default_get,res.value,{name:self.description_line,unit_amount:0,date:instance.web.date_to_str(self.dates[0]),account_id:id,});ops.push(def);self.set({"sheets":ops});});});},get_box:function(account,day_count){return this.$('[data-account="'+account.account+'"][data-day-count="'+day_count+'"]');},get_total:function(account){return this.$('[data-account-total="'+account.account+'"]');},get_day_total:function(day_count){return this.$('[data-day-total="'+day_count+'"]');},get_super_total:function(){return this.$('.oe_timesheet_weekly_supertotal');},sum_box:function(account,day_count,show_value_in_hour){var line_total=0;_.each(account.days[day_count].lines,function(line){line_total+=line.unit_amount;});return(show_value_in_hour&&line_total!=0)?this.format_client(line_total):line_total;},display_totals:function(){var self=this;var day_tots=_.map(_.range(self.dates.length),function(){return 0});var super_tot=0;_.each(self.accounts,function(account){var acc_tot=0;_.each(_.range(self.dates.length),function(day_count){var sum=self.sum_box(account,day_count);acc_tot+=sum;day_tots[day_count]+=sum;super_tot+=sum;});self.get_total(account).html(self.format_client(acc_tot));});_.each(_.range(self.dates.length),function(day_count){self.get_day_total(day_count).html(self.format_client(day_tots[day_count]));});self.get_super_total().html(self.format_client(super_tot));},sync:function(){var self=this;self.setting=true;self.set({sheets:this.generate_o2m_value()});self.setting=false;},parse_client:function(value){return instance.web.parse_value(value,{type:"float_time"});},format_client:function(value){return instance.web.format_value(value,{type:"float_time"});},generate_o2m_value:function(){var self=this;var ops=[];var ignored_fields=self.ignore_fields();_.each(self.accounts,function(account){_.each(account.days,function(day){_.each(day.lines,function(line){if(line.unit_amount!==0){var tmp=_.clone(line);tmp.id=undefined;_.each(line,function(v,k){if(v instanceof Array){tmp[k]=v[0];}});tmp=_.omit(tmp,ignored_fields);ops.push(tmp);}});});});return ops;},});instance.web.form.custom_widgets.add('weekly_timesheet','instance.hr_timesheet_sheet.WeeklyTimesheet');};;

/* /bus/static/src/js/bus.js defined in bundle 'web.assets_backend' */
(function(){var bus=openerp.bus={};bus.ERROR_DELAY=10000;bus.Bus=openerp.Widget.extend({init:function(){this._super();this.options={};this.activated=false;this.channels=[];this.last=0;this.stop=false;},start_polling:function(){if(!this.activated){this.poll();this.stop=false;}},stop_polling:function(){this.activated=false;this.stop=true;this.channels=[];},poll:function(){var self=this;self.activated=true;var data={'channels':self.channels,'last':self.last,'options':self.options};openerp.session.rpc('/longpolling/poll',data,{shadow:true}).then(function(result){_.each(result,_.bind(self.on_notification,self));if(!self.stop){self.poll();}},function(unused,e){e.preventDefault();setTimeout(_.bind(self.poll,self),bus.ERROR_DELAY+(Math.floor((Math.random()*20)+1)*1000));});},on_notification:function(notification){if(notification.id>this.last){this.last=notification.id;}
this.trigger("notification",[notification.channel,notification.message]);},add_channel:function(channel){if(!_.contains(this.channels,channel)){this.channels.push(channel);}},delete_channel:function(channel){this.channels=_.without(this.channels,channel);},});bus.bus=new bus.Bus();return bus;})();;

/* /im_chat/static/src/js/im_chat.js defined in bundle 'web.assets_backend' */
(function(){"use strict";var _t=openerp._t;var _lt=openerp._lt;var QWeb=openerp.qweb;var NBR_LIMIT_HISTORY=20;var USERS_LIMIT=20;var im_chat=openerp.im_chat={};im_chat.ConversationManager=openerp.Widget.extend({init:function(parent,options){var self=this;this._super(parent);this.options=_.clone(options)||{};_.defaults(this.options,{inputPlaceholder:_t("Say something..."),defaultMessage:null,defaultUsername:_t("Visitor"),});this.sessions={};this.bus=openerp.bus.bus;this.bus.on("notification",this,this.on_notification);this.bus.options["im_presence"]=true;this.set("right_offset",0);this.set("bottom_offset",0);this.on("change:right_offset",this,this.calc_positions);this.on("change:bottom_offset",this,this.calc_positions);this.set("window_focus",true);this.on("change:window_focus",self,function(e){self.bus.options["im_presence"]=self.get("window_focus");});this.set("waiting_messages",0);this.on("change:waiting_messages",this,this.window_title_change);$(window).on("focus",_.bind(this.window_focus,this));$(window).on("blur",_.bind(this.window_blur,this));this.window_title_change();},on_notification:function(notification){var self=this;var channel=notification[0];var message=notification[1];var regex_uuid=new RegExp(/(\w{8}(-\w{4}){3}-\w{12}?)/g);if((Array.isArray(channel)&&(channel[1]==='im_chat.session'||channel[1]==='im_chat.presence'))||(regex_uuid.test(channel))){if(message.type==="message"||message.type==="meta"){self.received_message(message);}
if(message.uuid){this.apply_session(message);}
if(message.im_status){self.trigger("im_new_user_status",[message]);}}},window_focus:function(){this.set("window_focus",true);this.set("waiting_messages",0);},window_blur:function(){this.set("window_focus",false);},window_beep:function(){if(typeof(Audio)==="undefined"){return;}
var audio=new Audio();var ext=audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";var kitten=jQuery.deparam!==undefined&&jQuery.deparam(jQuery.param.querystring()).kitten!==undefined;audio.src=openerp.session.url("/im_chat/static/src/audio/"+(kitten?"purr":"ting")+ext);audio.play();},window_title_change:function(){var title=undefined;if(this.get("waiting_messages")!==0){title=_.str.sprintf(_t("%d Messages"),this.get("waiting_messages"))
this.window_beep();}
if(!openerp.webclient||!openerp.webclient.set_title_part)
return;openerp.webclient.set_title_part("im_messages",title);},apply_session:function(session,focus){var self=this;var conv=this.sessions[session.uuid];if(!conv){if(session.state!=='closed'){conv=new im_chat.Conversation(this,this,session,this.options);conv.appendTo($("body"));conv.on("destroyed",this,_.bind(this.delete_session,this));this.sessions[session.uuid]=conv;this.calc_positions();}}else{conv.set("session",session);}
conv&&this.trigger("im_session_activated",conv);if(focus)
conv.focus();return conv;},activate_session:function(session,focus){var self=this;var active_session=_.clone(session);active_session.state='open';var conv=this.apply_session(active_session,focus);if(session.state!=='open'){conv.update_fold_state('open');}
return conv;},delete_session:function(uuid){delete this.sessions[uuid];this.calc_positions();},received_message:function(message){var self=this;var session_id=message.to_id[0];var uuid=message.to_id[1];if(!this.get("window_focus")){this.set("waiting_messages",this.get("waiting_messages")+1);}
var conv=this.sessions[uuid];if(!conv){var def_session=new openerp.Model("im_chat.session").call("session_info",[],{"ids":[session_id]}).then(function(session){conv=self.activate_session(session,false);conv.received_message(message);});}else{conv.received_message(message);}},calc_positions:function(){var self=this;var current=this.get("right_offset");_.each(this.sessions,function(s){s.set("bottom_position",self.get("bottom_offset"));s.set("right_position",current);current+=s.$().outerWidth(true);});},destroy:function(){$(window).off("unload",this.unload);$(window).off("focus",this.window_focus);$(window).off("blur",this.window_blur);return this._super();}});im_chat.Conversation=openerp.Widget.extend({className:"openerp_style oe_im_chatview",events:{"keydown input":"keydown","click .oe_im_chatview_close":"click_close","click .oe_im_chatview_header":"click_header"},init:function(parent,c_manager,session,options){this._super(parent);this.c_manager=c_manager;this.options=options||{};this.loading_history=true;this.set("messages",[]);this.set("session",session);this.set("right_position",0);this.set("bottom_position",0);this.set("pending",0);this.inputPlaceholder=this.options.defaultInputPlaceholder;},start:function(){var self=this;self.$().append(openerp.qweb.render("im_chat.Conversation",{widget:self}));self.$().hide();self.on("change:session",self,self.update_session);self.on("change:right_position",self,self.calc_pos);self.on("change:bottom_position",self,self.calc_pos);self.full_height=self.$().height();self.calc_pos();self.on("change:pending",self,_.bind(function(){if(self.get("pending")===0){self.$(".oe_im_chatview_nbr_messages").text("");}else{self.$(".oe_im_chatview_nbr_messages").text("("+self.get("pending")+")");}},self));self.on("change:messages",this,this.render_messages);self.$('.oe_im_chatview_content').on('scroll',function(){if($(this).scrollTop()===0){self.load_history();}});self.load_history();self.$().show();self.update_session();},show:function(){this.$().animate({height:this.full_height});this.set("pending",0);},hide:function(){this.$().animate({height:this.$(".oe_im_chatview_header").outerHeight()});},calc_pos:function(){this.$().css("right",this.get("right_position"));this.$().css("bottom",this.get("bottom_position"));},update_fold_state:function(state){return new openerp.Model("im_chat.session").call("update_state",[],{"uuid":this.get("session").uuid,"state":state});},update_session:function(){var names=[];_.each(this.get("session").users,function(user){if((openerp.session.uid!==user.id)&&!(_.isUndefined(openerp.session.uid)&&!user.id)){names.push(user.name);}});this.$(".oe_im_chatview_header_name").text(names.join(", "));this.$(".oe_im_chatview_header_name").attr('title',names.join(", "));if(this.get("session").state){if(this.get("session").state==='closed'){this.destroy();}else{if(this.get("session").state==='open'){this.show();}else{this.hide();}}}},load_history:function(){var self=this;if(this.loading_history){var data={uuid:self.get("session").uuid,limit:NBR_LIMIT_HISTORY};var lastid=_.first(this.get("messages"))?_.first(this.get("messages")).id:false;if(lastid){data["last_id"]=lastid;}
openerp.session.rpc("/im_chat/history",data).then(function(messages){if(messages){self.insert_messages(messages);if(messages.length!=NBR_LIMIT_HISTORY){self.loading_history=false;}}else{self.loading_history=false;}});}},received_message:function(message){if(this.get('session').state==='open'){this.set("pending",0);}else{this.set("pending",this.get("pending")+1);}
this.insert_messages([message]);},send_message:function(message,type){var self=this;var send_it=function(){return openerp.session.rpc("/im_chat/post",{uuid:self.get("session").uuid,message_type:type,message_content:message});};var tries=0;send_it().fail(function(error,e){e.preventDefault();tries+=1;if(tries<3)
return send_it();});},insert_messages:function(messages){var self=this;messages=_.filter(messages,function(m){return!_.contains(_.pluck(self.get("messages"),'id'),m.id);});_.map(messages,function(m){if(!m.from_id){m.from_id=[false,self.options["defaultUsername"]];}
m.message=self.escape_keep_url(m.message);m.message=self.smiley(m.message);m.create_date=Date.parse(m.create_date).setTimezone("UTC").toString("yyyy-MM-dd HH:mm:ss");return m;});this.set("messages",_.sortBy(this.get("messages").concat(messages),function(m){return m.id;}));},render_messages:function(){var self=this;var res={};var last_date_day,last_user_id=-1;_.each(this.get("messages"),function(current){current.from_id[2]=openerp.session.url(_.str.sprintf("/im_chat/image/%s/%s",self.get('session').uuid,current.from_id[0]));var date_day=current.create_date.split(" ")[0];if(date_day!==last_date_day){res[date_day]=[];last_user_id=-1;}
last_date_day=date_day;if(current.type=="message"){if(last_user_id===current.from_id[0]){_.last(res[date_day]).push(current);}else{res[date_day].push([current]);}
last_user_id=current.from_id[0];}else{res[date_day].push([current]);last_user_id=-1;}});this.$('.oe_im_chatview_content_bubbles').html($(openerp.qweb.render("im_chat.Conversation_content",{"list":res})));this._go_bottom();},keydown:function(e){if(e&&e.which!==13){return;}
var mes=this.$("input").val();if(!mes.trim()){return;}
this.$("input").val("");this.send_message(mes,"message");},get_smiley_list:function(){var kitten=jQuery.deparam!==undefined&&jQuery.deparam(jQuery.param.querystring()).kitten!==undefined;var smileys={":'(":"&#128546;",":O":"&#128561;","3:)":"&#128520;",":)":"&#128522;",":D":"&#128517;",";)":"&#128521;",":p":"&#128523;",":(":"&#9785;",":|":"&#128528;",":/":"&#128527;","8)":"&#128563;",":s":"&#128534;",":pinky":"<img src='/im_chat/static/src/img/pinky.png'/>",":musti":"<img src='/im_chat/static/src/img/musti.png'/>",};if(kitten){_.extend(smileys,{":)":"&#128570;",":D":"&#128569;",";)":"&#128572;",":p":"&#128573;",":(":"&#128576;",":|":"&#128575;",});}
return smileys;},smiley:function(str){var re_escape=function(str){return String(str).replace(/([.*+?=^!:${}()|[\]\/\\])/g,'\\$1');};var smileys=this.get_smiley_list();_.each(_.keys(smileys),function(key){str=str.replace(new RegExp("(?:^|\\s)("+re_escape(key)+")(?:\\s|$)"),' <span class="smiley">'+smileys[key]+'</span> ');});return str;},escape_keep_url:function(str){var url_regex=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi;var last=0;var txt="";while(true){var result=url_regex.exec(str);if(!result)
break;txt+=_.escape(str.slice(last,result.index));last=url_regex.lastIndex;var url=_.escape(result[0]);txt+='<a href="'+url+'" target="_blank">'+url+'</a>';}
txt+=_.escape(str.slice(last,str.length));return txt;},_go_bottom:function(){this.$(".oe_im_chatview_content").scrollTop(this.$(".oe_im_chatview_content").get(0).scrollHeight);},add_user:function(user){return new openerp.Model("im_chat.session").call("add_user",[this.get("session").uuid,user.id]);},focus:function(){this.$(".oe_im_chatview_input").focus();},click_header:function(){this.update_fold_state();},click_close:function(event){event.stopPropagation();this.update_fold_state('closed');},destroy:function(){this.trigger("destroyed",this.get('session').uuid);return this._super();}});im_chat.UserWidget=openerp.Widget.extend({"template":"im_chat.UserWidget",events:{"click":"activate_user",},init:function(parent,user){this._super(parent);this.set("id",user.id);this.set("name",user.name);this.set("im_status",user.im_status);this.set("image_url",user.image_url);},start:function(){this.$el.data("user",{id:this.get("id"),name:this.get("name")});this.$el.draggable({helper:"clone"});this.on("change:im_status",this,this.update_status);this.update_status();},update_status:function(){this.$(".oe_im_user_online").toggle(this.get('im_status')!=='offline');var img_src=(this.get('im_status')=='away'?'/im_chat/static/src/img/yellow.png':'/im_chat/static/src/img/green.png');this.$(".oe_im_user_online").attr('src',img_src);},activate_user:function(){this.trigger("activate_user",this.get("id"));},});im_chat.InstantMessaging=openerp.Widget.extend({template:"im_chat.InstantMessaging",events:{"keydown .oe_im_searchbox":"input_change","keyup .oe_im_searchbox":"input_change","change .oe_im_searchbox":"input_change",},init:function(parent){this._super(parent);this.shown=false;this.set("right_offset",0);this.set("current_search","");this.users=[];this.widgets={};this.c_manager=new openerp.im_chat.ConversationManager(this);this.on("change:right_offset",this.c_manager,_.bind(function(){this.c_manager.set("right_offset",this.get("right_offset"));},this));this.user_search_dm=new openerp.web.DropMisordered();},start:function(){var self=this;this.$el.css("right",-this.$el.outerWidth());$(window).scroll(_.bind(this.calc_box,this));$(window).resize(_.bind(this.calc_box,this));this.calc_box();this.on("change:current_search",this,this.search_users_status);self.c_manager.on("im_session_activated",self,function(conv){conv.$el.droppable({drop:function(event,ui){conv.add_user(ui.draggable.data("user"));}});});this.c_manager.on("im_new_user_status",this,this.update_users_status);openerp.session.rpc("/im_chat/init",{}).then(function(notifications){_.each(notifications,function(notif){self.c_manager.on_notification(notif);});openerp.bus.bus.start_polling();});return;},calc_box:function(){var $topbar=window.$('#oe_main_menu_navbar');var top=$topbar.offset().top+$topbar.height();top=Math.max(top-$(window).scrollTop(),0);this.$el.css("top",top);this.$el.css("bottom",0);},input_change:function(){this.set("current_search",this.$(".oe_im_searchbox").val());},search_users_status:function(e){var user_model=new openerp.web.Model("res.users");var self=this;return this.user_search_dm.add(user_model.call("im_search",[this.get("current_search"),USERS_LIMIT],{context:new openerp.web.CompoundContext()})).then(function(result){self.$(".oe_im_input").val("");var old_widgets=self.widgets;self.widgets={};self.users=[];_.each(result,function(user){user.image_url=openerp.session.url('/web/binary/image',{model:'res.users',field:'image_small',id:user.id});var widget=new openerp.im_chat.UserWidget(self,user);widget.appendTo(self.$(".oe_im_users"));widget.on("activate_user",self,self.activate_user);self.widgets[user.id]=widget;self.users.push(user);});_.each(old_widgets,function(w){w.destroy();});});},switch_display:function(){this.calc_box();var fct=_.bind(function(place){this.set("right_offset",place+this.$el.outerWidth());},this);var opt={step:fct,};if(this.shown){this.$el.animate({right:-this.$el.outerWidth(),},opt);}else{if(!openerp.bus.bus.activated){this.do_warn("Instant Messaging is not activated on this server. Try later.","");return;}
this.search_users_status();this.$el.animate({right:0,},opt);}
this.shown=!this.shown;},activate_user:function(user_id){var self=this;var sessions=new openerp.web.Model("im_chat.session");return sessions.call("session_get",[user_id]).then(function(session){self.c_manager.activate_session(session,true);});},update_users_status:function(users_list){var self=this;_.each(users_list,function(el){self.widgets[el.id]&&self.widgets[el.id].set("im_status",el.im_status);});}});im_chat.ImTopButton=openerp.Widget.extend({template:'im_chat.ImTopButton',events:{"click":"clicked",},clicked:function(ev){ev.preventDefault();this.trigger("clicked");},});if(openerp.web&&openerp.web.UserMenu){openerp.web.UserMenu.include({do_update:function(){var self=this;var Users=new openerp.web.Model('res.users');Users.call('has_group',['base.group_user']).done(function(is_employee){if(is_employee){self.update_promise.then(function(){var im=new openerp.im_chat.InstantMessaging(self);openerp.im_chat.single=im;im.appendTo(openerp.client.$el);var button=new openerp.im_chat.ImTopButton(this);button.on("clicked",im,im.switch_display);button.appendTo(window.$('.oe_systray'));});}});return this._super.apply(this,arguments);},});}
return im_chat;})();;

/* /im_odoo_support/static/src/js/im_odoo_support.js defined in bundle 'web.assets_backend' */
(function(){"use strict";var _t=openerp._t;openerp.im_odoo_support={};var COOKIE_NAME='livechat_conversation';var SERVICE_URL='https://services.odoo.com/';openerp.im_odoo_support.OdooSupport=openerp.Widget.extend({init:function(login,uuid,params,options){var self=this;this._super();this.login=login;this.uuid=uuid;this.options=_.extend(options||{},{'defaultUsername':login});this.params=_.extend(params||{},{'database_uuid':uuid});this.assets_loaded=false;this.session=false;$(window).on("odoo_support_ready_to_bind",this,_.bind(this.bind_actions,this));},bind_actions:function(event,button){if(button==='usermenu'){openerp.client.$('.oe_user_menu_placeholder .odoo_support_contact').on('click',this,_.bind(this.click_action,this));var session=openerp.get_cookie(COOKIE_NAME);if(session){this.start_support();}}
if(button==='im_contact'){if(openerp.im_chat&&openerp.im_chat.single){openerp.im_chat.single.$('.odoo_support_contact').on('click',this,_.bind(this.click_action,this));}}},click_action:function(){var session=openerp.get_cookie(COOKIE_NAME);if(!session){this.start_support();}},start_support:function(){var self=this;if(!this.assets_loaded){this.load_assets().then(function(){try{odoo_support.im_livechat.support=new odoo_support.im_livechat.LiveSupport(self.options,self.params);odoo_support.im_livechat.support.on('im_odoo_support_status',this,function(is_online){if(openerp.im_chat&&openerp.im_chat.single){openerp.im_chat.single.support_user.$(".oe_im_user_online").toggle(is_online);}});}catch(e){self.error_on_start(e);}}).fail(function(e){self.error_on_start(e);});}else{odoo_support.im_livechat.support.start();}},error_on_start:function(e){self.assets_loaded=false;openerp.client.do_warn(_t("Error"),_t("The connection with the Odoo Support Server failed. Please retry in a few minutes, or send an email to support@odoo.com ."));},load_assets:function(){var self=this;var add_asset=function(file_url,type){var def=$.Deferred();if(type==='js'){$.getScript(file_url,function(data,textStatus,jqxhr){def.resolve();}).fail(function(){def.reject();});return def;}else{$('<link rel="stylesheet" href="'+file_url+'"></link>').appendTo($("head")).ready(function(){def.resolve();});return def;}};var defs=[];defs.push(add_asset(SERVICE_URL+"odoo-livechat/assets/js",'js'));defs.push(add_asset(SERVICE_URL+"odoo-livechat/assets/css",'css'));return $.when.apply($,defs).then(function(res){self.assets_loaded=true;return res;},function(){self.error_on_start();});},});if(openerp.im_chat){openerp.im_chat.InstantMessaging.include({start:function(){this._super.apply(this,arguments);var user={"id":-1,"name":_t('Odoo Support'),"im_status":'online',"image_url":"/im_odoo_support/static/img/odoo_o_small.png"};var widget=new openerp.im_chat.UserWidget(self,user);widget.prependTo(self.$(".oe_im_users"));widget.$el.addClass('odoo_support_contact');this.support_user=widget;$(window).trigger('odoo_support_ready_to_bind','im_contact');},search_users_status:function(e){var self=this;this._super.apply(this,arguments).then(function(res){if(self.$('.oe_im_searchbox').val().length===0||_t("Odoo Support").toLowerCase().indexOf(self.$('.oe_im_searchbox').val().toLowerCase())!=-1){self.support_user.$el.show();}else{self.support_user.$el.hide();}
return res;});}});}
openerp.web.UserMenu.include({do_update:function(){$(window).trigger('odoo_support_ready_to_bind','usermenu');return this._super.apply(this,arguments);},});})();;

/* <inline asset> defined in bundle 'web.assets_backend' */
(function(){openerp.im_odoo_support.support=new openerp.im_odoo_support.OdooSupport("martin@smartforceplus.com","ce3efff4-bc74-11e4-9a30-bc764e18077c");})();;

/* /mail/static/src/js/mail.js defined in bundle 'web.assets_backend' */
openerp.mail=function(session){var _t=session.web._t,_lt=session.web._lt;var mail=session.mail;openerp_mail_followers(session,mail);openerp_FieldMany2ManyTagsEmail(session);openerp_announcement(session);mail.ChatterUtils={parse_email:function(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];},get_image:function(session,model,field,id,resize){var r=resize?encodeURIComponent(resize):'';id=id||'';return session.url('/web/binary/image',{model:model,field:field,id:id,resize:r});},get_attachment_url:function(session,message_id,attachment_id){return session.url('/mail/download_attachment',{'model':'mail.message','id':message_id,'method':'download_attachment','attachment_id':attachment_id});},do_replace_expressions:function(string){var icon_list=['al','pinky']
var regex_login=new RegExp(/(^|\s):((\w)*)/g);var regex_res=regex_login.exec(string);while(regex_res!=null){var icon_name=regex_res[2];if(_.include(icon_list,icon_name))
string=string.replace(regex_res[0],regex_res[1]+'<img src="/mail/static/src/img/_'+icon_name+'.png" width="22px" height="22px" alt="'+icon_name+'"/>');regex_res=regex_login.exec(string);}
return string;},get_text2html:function(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>')},expand_domain:function(domain){var new_domain=[];var nb_and=-1;for(var k=domain.length-1;k>=0;k--){if(typeof domain[k]!='array'&&typeof domain[k]!='object'){nb_and-=2;continue;}
nb_and+=1;}
for(var k=0;k<nb_and;k++){domain.unshift('&');}
return domain;},breakword:function(str){var out='';if(!str){return str;}
for(var i=0,len=str.length;i<len;i++){out+=_.str.escapeHTML(str[i])+'&#8203;';}
return out;},};mail.MessageCommon=session.web.Widget.extend({init:function(parent,datasets,options){this._super(parent,options);this.options=datasets.options||options||{};this.domain=datasets.domain||options.domain||[];this.context=_.extend({default_model:false,default_res_id:0,default_parent_id:false},options.context||{});this.id=datasets.id||false,this.last_id=this.id,this.model=datasets.model||this.context.default_model||false,this.res_id=datasets.res_id||this.context.default_res_id||false,this.parent_id=datasets.parent_id||false,this.type=datasets.type||false,this.subtype=datasets.subtype||false,this.is_author=datasets.is_author||false,this.author_avatar=datasets.author_avatar||false,this.is_private=datasets.is_private||false,this.subject=datasets.subject||false,this.name=datasets.name||false,this.record_name=datasets.record_name||false,this.body=datasets.body||'',this.body_short=datasets.body_short||'',this.vote_nb=datasets.vote_nb||0,this.has_voted=datasets.has_voted||false,this.is_favorite=datasets.is_favorite||false,this.thread_level=datasets.thread_level||0,this.to_read=datasets.to_read||false,this.author_id=datasets.author_id||false,this.attachment_ids=datasets.attachment_ids||[],this.partner_ids=datasets.partner_ids||[];this.date=datasets.date;this.user_pid=datasets.user_pid||false;this.format_data();if(this.model=='res.partner'){this.record_name='Partner Profile of '+this.record_name;}
else if(this.model=='hr.employee'){this.record_name='News from '+this.record_name;}
this.show_record_name=this.options.show_record_name&&this.record_name&&!this.thread_level;this.options.show_read=false;this.options.show_unread=false;if(this.options.show_read_unread_button){if(this.options.read_action=='read')this.options.show_read=true;else if(this.options.read_action=='unread')this.options.show_unread=true;else{this.options.show_read=this.to_read;this.options.show_unread=!this.to_read;}
this.options.rerender=true;this.options.toggle_read=true;}
this.parent_thread=typeof parent.on_message_detroy=='function'?parent:this.options.root_thread;this.thread=false;},format_data:function(){this.date=this.date?session.web.str_to_datetime(this.date):false;this.display_date=this.date.toString('ddd MMM dd yyyy HH:mm');if(this.date&&new Date().getTime()-this.date.getTime()<7*24*60*60*1000){this.timerelative=$.timeago(this.date);}
if(this.author_avatar){this.avatar="data:image/png;base64,"+this.author_avatar;}else if(this.type=='email'&&(!this.author_id||!this.author_id[0])){this.avatar=('/mail/static/src/img/email_icon.png');}else if(this.author_id&&this.template!='mail.compose_message'){this.avatar=mail.ChatterUtils.get_image(this.session,'res.partner','image_small',this.author_id[0]);}else{this.avatar=mail.ChatterUtils.get_image(this.session,'res.users','image_small',this.session.uid);}
if(this.author_id&&this.author_id[1]){var parsed_email=mail.ChatterUtils.parse_email(this.author_id[1]);this.author_id.push(parsed_email[0],parsed_email[1]);}
if(this.partner_ids&&this.partner_ids.length>3){this.extra_partners_nbr=this.partner_ids.length-3;this.extra_partners_str=''
var extra_partners=this.partner_ids.slice(3);for(var key in extra_partners){this.extra_partners_str+=extra_partners[key][1];}}},display_attachments:function(){for(var l in this.attachment_ids){var attach=this.attachment_ids[l];if(!attach.formating){attach.url=mail.ChatterUtils.get_attachment_url(this.session,this.id,attach.id);attach.name=mail.ChatterUtils.breakword(attach.name||attach.filename);attach.formating=true;}}
this.$(".oe_msg_attachment_list").html(session.web.qweb.render('mail.thread.message.attachments',{'widget':this}));},attachments_resize_image:function(id,resize){return mail.ChatterUtils.get_image(this.session,'ir.attachment','datas',id,resize);},get_child_ids:function(){return _.map(this.get_childs(),function(val){return val.id;});},get_childs:function(nb_thread_level){var res=[];if(arguments[1]&&this.id)res.push(this);if((isNaN(nb_thread_level)||nb_thread_level>0)&&this.thread){_(this.thread.messages).each(function(val,key){res=res.concat(val.get_childs((isNaN(nb_thread_level)?undefined:nb_thread_level-1),true));});}
return res;},browse_message:function(options){if(!options._go_thread_wall){options._go_thread_wall=true;for(var i in this.options.root_thread.messages){var res=this.options.root_thread.messages[i].browse_message(options);if(res)return res;}}
if(this.id==options.id)
return this;for(var i in this.thread.messages){if(this.thread.messages[i].thread){var res=this.thread.messages[i].browse_message(options);if(res)return res;}}
return false;},destroy:function(){this._super();this.parent_thread.on_message_detroy(this);}});mail.ThreadComposeMessage=mail.MessageCommon.extend({template:'mail.compose_message',init:function(parent,datasets,options){this._super(parent,datasets,options);this.show_compact_message=false;this.show_delete_attachment=true;this.is_log=false;this.recipients=[];this.recipient_ids=[];session.web.bus.on('clear_uncommitted_changes',this,function(e){if(this.show_composer&&!e.isDefaultPrevented()){if(!confirm(_t("You are currently composing a message, your message will be discarded.\n\nAre you sure you want to leave this page ?"))){e.preventDefault();}
else{this.on_cancel();}}});},start:function(){this._super.apply(this,arguments);this.ds_attachment=new session.web.DataSetSearch(this,'ir.attachment');this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,this.on_attachment_loaded);this.display_attachments();this.bind_events();},on_attachment_change:function(event){event.stopPropagation();var self=this;var $target=$(event.target);if($target.val()!==''){var filename=$target.val().replace(/.*[\\\/]/,'');var attachments=[];for(var i in this.attachment_ids){if((this.attachment_ids[i].filename||this.attachment_ids[i].name)==filename){if(this.attachment_ids[i].upload){return false;}
this.ds_attachment.unlink([this.attachment_ids[i].id]);}else{attachments.push(this.attachment_ids[i]);}}
this.attachment_ids=attachments;this.$('form.oe_form_binary_form').submit();this.$(".oe_attachment_file").hide();this.attachment_ids.push({'id':0,'name':filename,'filename':filename,'url':'','upload':true});this.display_attachments();}},on_attachment_loaded:function(event,result){if(result.erorr||!result.id){this.do_warn(session.web.qweb.render('mail.error_upload'),result.error);this.attachment_ids=_.filter(this.attachment_ids,function(val){return!val.upload;});}else{for(var i in this.attachment_ids){if(this.attachment_ids[i].filename==result.filename&&this.attachment_ids[i].upload){this.attachment_ids[i]={'id':result.id,'name':result.name,'filename':result.filename,'url':mail.ChatterUtils.get_attachment_url(this.session,this.id,result.id)};}}}
this.display_attachments();var $input=this.$('input.oe_form_binary_file');$input.after($input.clone(true)).remove();this.$(".oe_attachment_file").show();},on_attachment_delete:function(event){event.stopPropagation();var attachment_id=$(event.target).data("id");if(attachment_id){var attachments=[];for(var i in this.attachment_ids){if(attachment_id!=this.attachment_ids[i].id){attachments.push(this.attachment_ids[i]);}
else{this.ds_attachment.unlink([attachment_id]);}}
this.attachment_ids=attachments;this.display_attachments();}},bind_events:function(){var self=this;this.$('.oe_compact_inbox').on('click',self.on_toggle_quick_composer);this.$('.oe_compose_post').on('click',self.on_toggle_quick_composer);this.$('.oe_compose_log').on('click',self.on_toggle_quick_composer);this.$('input.oe_form_binary_file').on('change',_.bind(this.on_attachment_change,this));this.$('.oe_cancel').on('click',_.bind(this.on_cancel,this));this.$('.oe_post').on('click',self.on_message_post);this.$('.oe_full').on('click',_.bind(this.on_compose_fullmail,this,this.id?'reply':'comment'));this.$('.oe_msg_left, .oe_msg_center').on('mousedown',_.bind(function(){this.stay_open=true;},this));this.$('.oe_msg_left, .oe_msg_content').on('mouseup',_.bind(function(){this.$('textarea').focus();},this));var ev_stay={};ev_stay.mouseup=ev_stay.keydown=ev_stay.focus=function(){self.stay_open=false;};this.$('textarea').on(ev_stay);this.$('textarea').autosize();this.$('textarea').on('blur',self.on_toggle_quick_composer);this.$(".oe_msg_attachment_list").on('click','.oe_delete',this.on_attachment_delete);this.$(".oe_recipients").on('change','input',this.on_checked_recipient);},on_compose_fullmail:function(default_composition_mode){var self=this;if(!this.do_check_attachment_upload()){return false;}
var recipient_done=$.Deferred();if(this.is_log){recipient_done.resolve([]);}
else{recipient_done=this.check_recipient_partners();}
$.when(recipient_done).done(function(partner_ids){var context={'default_parent_id':self.id,'default_body':mail.ChatterUtils.get_text2html(self.$el?(self.$el.find('textarea:not(.oe_compact)').val()||''):''),'default_attachment_ids':_.map(self.attachment_ids,function(file){return file.id;}),'default_partner_ids':partner_ids,'default_is_log':self.is_log,'mail_post_autofollow':true,'mail_post_autofollow_partner_ids':partner_ids,'is_private':self.is_private};if(default_composition_mode!='reply'&&self.context.default_model&&self.context.default_res_id){context.default_model=self.context.default_model;context.default_res_id=self.context.default_res_id;}
var action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:context,};self.do_action(action);self.on_cancel();});},reinit:function(){var $render=$(session.web.qweb.render('mail.compose_message',{'widget':this}));$render.insertAfter(this.$el.last());this.$el.remove();this.$el=$render;this.display_attachments();this.bind_events();},on_cancel:function(event){if(event)event.stopPropagation();this.attachment_ids=[];this.stay_open=false;this.show_composer=false;this.reinit();},do_check_attachment_upload:function(){if(_.find(this.attachment_ids,function(file){return file.upload;})){this.do_warn(session.web.qweb.render('mail.error_upload'),session.web.qweb.render('mail.error_upload_please_wait'));return false;}else{return true;}},check_recipient_partners:function(){var self=this;var check_done=$.Deferred();var recipients=_.filter(this.recipients,function(recipient){return recipient.checked});var recipients_to_find=_.filter(recipients,function(recipient){return(!recipient.partner_id)});var names_to_find=_.pluck(recipients_to_find,'full_name');var recipients_to_check=_.filter(recipients,function(recipient){return(recipient.partner_id&&!recipient.email_address)});var recipient_ids=_.pluck(_.filter(recipients,function(recipient){return recipient.partner_id&&recipient.email_address}),'partner_id');var names_to_remove=[];var recipient_ids_to_remove=[];var find_done=$.Deferred();if(names_to_find.length>0){find_done=self.parent_thread.ds_thread._model.call('message_partner_info_from_emails',[this.context.default_res_id,names_to_find]);}
else{find_done.resolve([]);}
$.when(find_done).pipe(function(result){var emails_deferred=[];var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){var deferred=$.Deferred()
emails_deferred.push(deferred);var partner_name=partner_info.full_name;var partner_id=partner_info.partner_id;var parsed_email=mail.ChatterUtils.parse_email(partner_name);var pop=new session.web.form.FormOpenPopup(this);pop.show_element('res.partner',partner_id,{'force_email':true,'ref':"compound_context",'default_name':parsed_email[0],'default_email':parsed_email[1],},{title:_t("Please complete partner's informations"),});pop.on('closed',self,function(){deferred.resolve();});pop.view_form.on('on_button_cancel',self,function(){names_to_remove.push(partner_name);if(partner_id){recipient_ids_to_remove.push(partner_id);}});});$.when.apply($,emails_deferred).then(function(){var new_names_to_find=_.difference(names_to_find,names_to_remove);find_done=$.Deferred();if(new_names_to_find.length>0){find_done=self.parent_thread.ds_thread._model.call('message_partner_info_from_emails',[self.context.default_res_id,new_names_to_find,true]);}
else{find_done.resolve([]);}
$.when(find_done).pipe(function(result){var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){if(partner_info.partner_id&&_.indexOf(partner_info.partner_id,recipient_ids_to_remove)==-1){recipient_ids.push(partner_info.partner_id);}});}).pipe(function(){check_done.resolve(recipient_ids);});});});return check_done;},on_message_post:function(event){var self=this;if(self.flag_post){return;}
if(this.do_check_attachment_upload()&&(this.attachment_ids.length||this.$('textarea').val().match(/\S+/))){self.flag_post=true;if(this.is_log){this.do_send_message_post([],this.is_log);}
else{this.check_recipient_partners().done(function(partner_ids){self.do_send_message_post(partner_ids,self.is_log);});}}},do_send_message_post:function(partner_ids,log){var self=this;var values={'body':this.$('textarea').val(),'subject':false,'parent_id':this.context.default_parent_id,'attachment_ids':_.map(this.attachment_ids,function(file){return file.id;}),'partner_ids':partner_ids,'context':_.extend(this.parent_thread.context,{'mail_post_autofollow':true,'mail_post_autofollow_partner_ids':partner_ids,}),'type':'comment','content_subtype':'plaintext',};if(log){values['subtype']=false;}
else{values['subtype']='mail.mt_comment';}
this.parent_thread.ds_thread._model.call('message_post',[this.context.default_res_id],values).done(function(message_id){var thread=self.parent_thread;var root=thread==self.options.root_thread;if(self.options.display_indented_thread<self.thread_level&&thread.parent_message){var thread=thread.parent_message.parent_thread;}
thread.message_fetch([["id","=",message_id]],false,[message_id],function(arg,data){var message=thread.create_message_object(data.slice(-1)[0]);thread.insert_message(message,root?undefined:self.$el,root);});self.on_cancel();self.flag_post=false;});},on_toggle_quick_composer:function(event){var self=this;var $input=$(event.target);this.compute_emails_from();var email_addresses=_.pluck(this.recipients,'email_address');var suggested_partners=$.Deferred();if(event.type=='click'){this.is_log=$input.hasClass('oe_compose_log');suggested_partners=this.parent_thread.ds_thread.call('message_get_suggested_recipients',[[this.context.default_res_id],this.context]).done(function(additional_recipients){var thread_recipients=additional_recipients[self.context.default_res_id];_.each(thread_recipients,function(recipient){var parsed_email=mail.ChatterUtils.parse_email(recipient[1]);if(_.indexOf(email_addresses,parsed_email[1])==-1){self.recipients.push({'checked':true,'partner_id':recipient[0],'full_name':recipient[1],'name':parsed_email[0],'email_address':parsed_email[1],'reason':recipient[2],})}});});}
else{suggested_partners.resolve({});}
$.when(suggested_partners).pipe(function(additional_recipients){if((!self.stay_open||(event&&event.type=='click'))&&(!self.show_composer||!self.$('textarea:not(.oe_compact)').val().match(/\S+/)&&!self.attachment_ids.length)){self.show_composer=!self.show_composer||self.stay_open;self.reinit();}
if(!self.stay_open&&self.show_composer&&(!event||event.type!='blur')){self.$('textarea:not(.oe_compact):first').focus();}});return suggested_partners;},do_hide_compact:function(){this.show_compact_message=false;if(!this.show_composer){this.reinit();}},do_show_compact:function(){this.show_compact_message=true;if(!this.show_composer){this.reinit();}},compute_emails_from:function(){var self=this;var messages=[];if(this.parent_thread.parent_message){var message=this.parent_thread.parent_message;var parent_message=message.parent_id?message.parent_thread.parent_message:message;if(parent_message){var messages=[parent_message].concat(parent_message.get_childs());}}else if(this.options.emails_from_on_composer){_.each(this.options.root_thread.messages,function(msg){messages.push(msg);messages.concat(msg.get_childs());});}
_.each(messages,function(thread){if(thread.author_id&&!thread.author_id[0]&&!_.find(self.recipients,function(recipient){return recipient.email_address==thread.author_id[3];})){self.recipients.push({'full_name':thread.author_id[1],'name':thread.author_id[2],'email_address':thread.author_id[3],'partner_id':false,'checked':true,'reason':'Incoming email author'});}});return self.recipients;},on_checked_recipient:function(event){var $input=$(event.target);var full_name=$input.attr("data");_.each(this.recipients,function(recipient){if(recipient.full_name==full_name){recipient.checked=$input.is(":checked");}});},});mail.ThreadExpandable=mail.MessageCommon.extend({template:'mail.thread.expandable',init:function(parent,datasets,options){this._super(parent,datasets,options);this.type='expandable';this.max_limit=datasets.max_limit;this.nb_messages=datasets.nb_messages;this.flag_used=false;},start:function(){this._super.apply(this,arguments);this.bind_events();},reinit:function(){var $render=$(session.web.qweb.render('mail.thread.expandable',{'widget':this}));this.$el.replaceWith($render);this.$el=$render;this.bind_events();},bind_events:function(){this.$('.oe_msg_more_message').on('click',this.on_expandable);},animated_destroy:function(fadeTime){var self=this;this.$el.fadeOut(fadeTime,function(){self.destroy();});},on_expandable:function(event){if(event)event.stopPropagation();if(this.flag_used){return false}
this.flag_used=true;var self=this;self.parent_thread.message_fetch(this.domain,this.context,false,function(arg,data){self.id=false;var element=self.$el;if(self.thread_level===0){element=element.parent();}
self.parent_thread.switch_new_message(data,element);self.animated_destroy(200);});return false;},});mail.ThreadMessage=mail.MessageCommon.extend({template:'mail.thread.message',start:function(){this._super.apply(this,arguments);this.bind_events();if(this.thread_level<this.options.display_indented_thread){this.create_thread();}
this.display_attachments();this.ds_notification=new session.web.DataSetSearch(this,'mail.notification');this.ds_message=new session.web.DataSetSearch(this,'mail.message');},bind_events:function(){var self=this;this.$('.oe_read').on('click',this.on_message_read);this.$('.oe_unread').on('click',this.on_message_unread);this.$('.oe_msg_delete').on('click',this.on_message_delete);this.$('.oe_reply').on('click',this.on_message_reply);this.$('.oe_star').on('click',this.on_star);this.$('.oe_msg_vote').on('click',this.on_vote);this.$('.oe_mail_expand').on('click',this.on_expand);this.$('.oe_mail_reduce').on('click',this.on_expand);this.$('.oe_mail_action_model').on('click',this.on_record_clicked);this.$('.oe_mail_action_author').on('click',this.on_record_author_clicked);},on_record_clicked:function(event){event.preventDefault();var self=this;var state={'model':this.model,'id':this.res_id,'title':this.record_name};session.webclient.action_manager.do_push_state(state);this.context.params={model:this.model,res_id:this.res_id,};this.thread.ds_thread.call("message_redirect_action",{context:this.context}).then(function(action){self.do_action(action);});},on_record_author_clicked:function(event){event.preventDefault();var partner_id=$(event.target).data('partner');var state={'model':'res.partner','id':partner_id,'title':this.record_name};session.webclient.action_manager.do_push_state(state);var action={type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:'res.partner',views:[[false,'form']],res_id:partner_id,}
this.do_action(action);},on_message_reply:function(event){event.stopPropagation();this.create_thread();this.thread.on_compose_message(event);return false;},on_expand:function(event){event.stopPropagation();this.$('.oe_msg_body:first > .oe_msg_body_short:first').toggle();this.$('.oe_msg_body:first > .oe_msg_body_long:first').toggle();return false;},create_thread:function(){if(this.thread){return false;}
this.thread=new mail.Thread(this,this,{'domain':this.domain,'context':{'default_model':this.model,'default_res_id':this.res_id,'default_parent_id':this.id},'options':this.options});this.thread.insertAfter(this.$el);},animated_destroy:function(fadeTime){var self=this;this.$el.fadeOut(fadeTime,function(){self.parent_thread.message_to_expandable(self);});if(this.thread){this.thread.$el.fadeOut(fadeTime);}},on_message_delete:function(event){event.stopPropagation();if(!confirm(_t("Do you really want to delete this message?"))){return false;}
this.animated_destroy(150);var ids=[this.id].concat(this.get_child_ids());this.ds_message.unlink(ids);return false;},check_for_rerender:function(){var self=this;var messages=[this].concat(this.get_childs());var message_ids=_.map(messages,function(msg){return msg.id;});var domain=mail.ChatterUtils.expand_domain(this.options.root_thread.domain).concat([["id","in",message_ids]]);return this.parent_thread.ds_message.call('message_read',[undefined,domain,[],!!this.parent_thread.options.display_indented_thread,this.context,this.parent_thread.id]).then(function(records){_.map(messages,function(msg){if(!_.find(records,function(record){return record.id==msg.id;})){msg.animated_destroy(150);}else{msg.renderElement();msg.start();}
self.options.root_thread.MailWidget.do_reload_menu_emails();});});},on_message_read:function(event){event.stopPropagation();this.on_message_read_unread(true);return false;},on_message_unread:function(event){event.stopPropagation();this.on_message_read_unread(false);return false;},on_message_read_unread:function(read_value){var self=this;var messages=[this].concat(this.get_childs());if(this.options.view_inbox&&read_value){var messages=_.filter(messages,function(val){return!val.is_favorite&&val.id;});if(!messages.length){this.check_for_rerender();return false;}}
var message_ids=_.map(messages,function(val){return val.id;});this.ds_message.call('set_message_read',[message_ids,read_value,true,this.context]).then(function(){_.each(messages,function(msg){msg.to_read=!read_value;if(msg.options.toggle_read){msg.options.show_read=msg.to_read;msg.options.show_unread=!msg.to_read;}});self.check_for_rerender();});return false;},on_vote:function(event){event.stopPropagation();this.ds_message.call('vote_toggle',[[this.id]]).then(_.bind(function(vote){this.has_voted=vote;this.vote_nb+=this.has_voted?1:-1;this.display_vote();},this));return false;},display_vote:function(){var vote_element=session.web.qweb.render('mail.thread.message.vote',{'widget':this});this.$(".oe_msg_footer:first .oe_mail_vote_count").remove();this.$(".oe_msg_footer:first .oe_msg_vote").replaceWith(vote_element);this.$('.oe_msg_vote').on('click',this.on_vote);},on_star:function(event){event.stopPropagation();var self=this;var button=self.$('.oe_star:first');this.ds_message.call('set_message_starred',[[self.id],!self.is_favorite,true]).then(function(star){self.is_favorite=star;if(self.is_favorite){button.addClass('oe_starred');}else{button.removeClass('oe_starred');}
if(self.options.view_inbox&&self.is_favorite){self.on_message_read_unread(true);}else{self.check_for_rerender();}});return false;},});mail.Thread=session.web.Widget.extend({template:'mail.thread',init:function(parent,datasets,options){var self=this;this._super(parent,options);this.MailWidget=parent instanceof mail.Widget?parent:false;this.domain=options.domain||[];this.context=_.extend(options.context||{});this.options=options.options;this.options.root_thread=(options.options.root_thread!=undefined?options.options.root_thread:this);this.options.show_compose_message=this.options.show_compose_message&&!this.thread_level;this.parent_message=parent.thread!=undefined?parent:false;this.id=datasets.id||false;this.last_id=datasets.last_id||false;this.parent_id=datasets.parent_id||false;this.is_private=datasets.is_private||false;this.author_id=datasets.author_id||false;this.thread_level=(datasets.thread_level+1)||0;datasets.partner_ids=datasets.partner_ids||[];if(datasets.author_id&&!_.contains(_.flatten(datasets.partner_ids),datasets.author_id[0])&&datasets.author_id[0]){datasets.partner_ids.push(datasets.author_id);}
this.user_pid=datasets.user_pid||false;this.partner_ids=datasets.partner_ids;this.messages=[];this.options.flat_mode=(this.options.display_indented_thread-this.thread_level>0);this.compose_message=false;this.ds_thread=new session.web.DataSetSearch(this,this.context.default_model||'mail.thread');this.ds_message=new session.web.DataSetSearch(this,'mail.message');this.render_mutex=new $.Mutex();},start:function(){this._super.apply(this,arguments);this.bind_events();},instantiate_compose_message:function(){if(!this.compose_message){this.compose_message=new mail.ThreadComposeMessage(this,this,{'context':this.options.compose_as_todo&&!this.thread_level?_.extend(this.context,{'default_starred':true}):this.context,'options':this.options,});if(!this.thread_level||this.thread_level>this.options.display_indented_thread){this.compose_message.insertBefore(this.$el);}else{this.compose_message.prependTo(this.$el);}}},on_scroll:function(){var expandables=_.each(_.filter(this.messages,function(val){return val.max_limit&&!val.parent_id;}),function(val){var pos=val.$el.position();if(pos.top){var bottom=$(window).scrollTop()+$(window).height()+200;if(bottom>pos.top){val.on_expandable();}}});},bind_events:function(){var self=this;self.$('.oe_mail_list_recipients .oe_more').on('click',self.on_show_recipients);self.$('.oe_mail_compose_textarea .oe_more_hidden').on('click',self.on_hide_recipients);},on_show_recipients:function(){var p=$(this).parent();p.find('.oe_more_hidden, .oe_hidden').show();p.find('.oe_more').hide();return false;},on_hide_recipients:function(){var p=$(this).parent();p.find('.oe_more_hidden, .oe_hidden').hide();p.find('.oe_more').show();return false;},get_child_ids:function(){return _.map(this.get_childs(),function(val){return val.id;});},get_childs:function(nb_thread_level){var res=[];if(arguments[1])res.push(this);if(isNaN(nb_thread_level)||nb_thread_level>0){_(this.messages).each(function(val,key){if(val.thread){res=res.concat(val.thread.get_childs((isNaN(nb_thread_level)?undefined:nb_thread_level-1),true));}});}
return res;},browse_thread:function(options){if(!options._go_thread_wall){options._go_thread_wall=true;return this.options.root_thread.browse_thread(options);}
if(this.id==options.id){return this;}
if(options.id){for(var i in this.messages){if(this.messages[i].thread){var res=this.messages[i].thread.browse_thread({'id':options.id,'_go_thread_wall':true});if(res)return res;}}}
if(options.default_return_top_thread){return this;}
return false;},browse_message:function(options){if(this.options.root_thread.messages[0])
return this.options.root_thread.messages[0].browse_message(options);},on_compose_message:function(event){this.instantiate_compose_message();this.compose_message.on_toggle_quick_composer(event);return false;},no_message:function(){var no_message=$(session.web.qweb.render('mail.wall_no_message',{}));if(this.options.help){no_message.html(this.options.help);}
if(!this.$el.find(".oe_view_nocontent").length)
{no_message.appendTo(this.$el);}},message_fetch:function(replace_domain,replace_context,ids,callback){return this.ds_message.call('message_read',[ids===false?undefined:ids&&ids.slice(0,this.options.fetch_limit),(replace_domain?replace_domain:this.domain),(this.id?[this.id].concat(this.get_child_ids()):this.get_child_ids()),this.options.flat_mode,(replace_context?replace_context:this.context),this.context.default_parent_id||undefined,this.options.fetch_limit,]).done(callback?_.bind(callback,this,arguments):this.proxy('switch_new_message')).done(this.proxy('message_fetch_set_read'));},message_fetch_set_read:function(message_list){if(!this.context.mail_read_set_read)return;var self=this;this.render_mutex.exec(function(){msg_ids=_.pluck(message_list,'id');return self.ds_message.call('set_message_read',[msg_ids,true,false,self.context]).then(function(nb_read){if(nb_read){self.options.root_thread.MailWidget.do_reload_menu_emails();}});});},create_message_object:function(data){var self=this;data.thread_level=self.thread_level||0;data.options=_.extend(data.options||{},self.options);if(data.type=='expandable'){var message=new mail.ThreadExpandable(self,data,{'context':{'default_model':data.model||self.context.default_model,'default_res_id':data.res_id||self.context.default_res_id,'default_parent_id':self.id,}});}else{data.record_name=(data.record_name!=''&&data.record_name)||(self.parent_message&&self.parent_message.record_name);var message=new mail.ThreadMessage(self,data,{'context':{'default_model':data.model,'default_res_id':data.res_id,'default_parent_id':data.id,}});}
for(var i in self.messages){if(message.id&&self.messages[i]&&self.messages[i].id==message.id){self.messages[i].destroy();}}
self.messages.push(message);return message;},insert_message:function(message,dom_insert_after,prepend){var self=this;if(this.options.show_compact_message>this.thread_level){this.instantiate_compose_message();this.compose_message.do_show_compact();}
this.$('.oe_view_nocontent').remove();if(dom_insert_after&&dom_insert_after.parent()[0]==self.$el[0]){message.insertAfter(dom_insert_after);}else if(prepend){message.prependTo(self.$el);}else{message.appendTo(self.$el);}
message.$el.hide().fadeIn(500);return message},switch_new_message:function(records,dom_insert_after){var self=this;var dom_insert_after=typeof dom_insert_after=='object'?dom_insert_after:false;_(records).each(function(record){var thread=self.browse_thread({'id':record.parent_id,'default_return_top_thread':true});var message=thread.create_message_object(record);thread.insert_message(message,dom_insert_after);});if(!records.length&&this.options.root_thread==this){this.no_message();}},on_message_detroy:function(message){this.messages=_.filter(this.messages,function(val){return!val.isDestroyed();});if(this.options.root_thread==this&&!this.messages.length){this.no_message();}
return false;},message_to_expandable:function(message){if(!this.thread_level||message.isDestroyed()){message.destroy();return false;}
var messages=_.sortBy(this.messages,function(val){return val.id;});var it=_.indexOf(messages,message);var msg_up=message.$el.prev('.oe_msg');var msg_down=message.$el.next('.oe_msg');var msg_up=msg_up.hasClass('oe_msg_expandable')?_.find(this.messages,function(val){return val.$el[0]==msg_up[0];}):false;var msg_down=msg_down.hasClass('oe_msg_expandable')?_.find(this.messages,function(val){return val.$el[0]==msg_down[0];}):false;var message_dom=[["id","=",message.id]];if(msg_up&&msg_up.type=="expandable"&&msg_down&&msg_down.type=="expandable"){msg_up.domain=mail.ChatterUtils.expand_domain(msg_up.domain);msg_down.domain=mail.ChatterUtils.expand_domain(msg_down.domain);msg_down.domain=['|','|'].concat(msg_up.domain).concat(message_dom).concat(msg_down.domain);if(!msg_down.max_limit){msg_down.nb_messages+=1+msg_up.nb_messages;}
msg_up.$el.remove();msg_up.destroy();msg_down.reinit();}else if(msg_up&&msg_up.type=="expandable"){msg_up.domain=mail.ChatterUtils.expand_domain(msg_up.domain);msg_up.domain=['|'].concat(msg_up.domain).concat(message_dom);msg_up.nb_messages++;msg_up.reinit();}else if(msg_down&&msg_down.type=="expandable"){msg_down.domain=mail.ChatterUtils.expand_domain(msg_down.domain);msg_down.domain=['|'].concat(msg_down.domain).concat(message_dom);if(!msg_down.max_limit){msg_down.nb_messages++;}
msg_down.reinit();}else{var expandable=new mail.ThreadExpandable(this,{'model':message.model,'parent_id':message.parent_id,'nb_messages':1,'thread_level':message.thread_level,'parent_id':message.parent_id,'domain':message_dom,'options':message.options,},{'context':{'default_model':message.model||this.context.default_model,'default_res_id':message.res_id||this.context.default_res_id,'default_parent_id':this.id,}});this.messages.push(expandable);expandable.insertAfter(message.$el);}
message.destroy();return true;},});session.web.client_actions.add('mail.Widget','session.mail.Widget');mail.Widget=session.web.Widget.extend({template:'mail.Root',init:function(parent,action){this._super(parent,action);var self=this;this.action=_.clone(action);this.domain=this.action.domain||this.action.params.domain||[];this.context=this.action.context||this.action.params.context||{};this.action.params=_.extend({'display_indented_thread':-1,'show_reply_button':false,'show_read_unread_button':false,'truncate_limit':250,'show_record_name':false,'show_compose_message':false,'show_compact_message':false,'compose_placeholder':false,'show_link':true,'view_inbox':false,'message_ids':undefined,'compose_as_todo':false,'readonly':false,'emails_from_on_composer':true,'fetch_limit':30},this.action.params);this.action.params.help=this.action.help||false;},start:function(options){this._super.apply(this,arguments);this.message_render();},do_reload_menu_emails:function(){var menu=session.webclient.menu;if(!menu||!menu.current_menu){return $.when();}
return menu.rpc("/web/menu/load_needaction",{'menu_ids':[menu.current_menu]}).done(function(r){menu.on_needaction_loaded(r);}).then(function(){menu.trigger("need_action_reloaded");});},message_render:function(search){this.thread=new mail.Thread(this,{},{'domain':this.domain,'context':this.context,'options':this.action.params,});this.thread.appendTo(this.$el);if(this.action.params.show_compose_message){this.thread.instantiate_compose_message();this.thread.compose_message.do_show_compact();}
this.thread.message_fetch(null,null,this.action.params.message_ids);},});session.web.form.widgets.add('mail_thread','openerp.mail.RecordThread');mail.RecordThread=session.web.form.AbstractField.extend({template:'mail.record_thread',init:function(parent,node){this._super.apply(this,arguments);this.ParentViewManager=parent;this.node=_.clone(node);this.node.params=_.extend({'display_indented_thread':-1,'show_reply_button':false,'show_read_unread_button':true,'read_action':'unread','show_record_name':false,'show_compact_message':1,'display_log_button':true,},this.node.params);if(this.node.attrs.placeholder){this.node.params.compose_placeholder=this.node.attrs.placeholder;}
if(this.node.attrs.readonly){this.node.params.readonly=this.node.attrs.readonly;}
if('display_log_button'in this.options){this.node.params.display_log_button=this.options.display_log_button;}
this.domain=(this.node.params&&this.node.params.domain)||(this.field&&this.field.domain)||[];if(!this.ParentViewManager.is_action_enabled('edit')){this.node.params.show_link=false;}},start:function(){this._super.apply(this,arguments);this.view.on("change:actual_mode",this,this._check_visibility);this._check_visibility();},_check_visibility:function(){this.$el.toggle(this.view.get("actual_mode")!=="create");},render_value:function(){var self=this;if(!this.view.datarecord.id||session.web.BufferedDataSet.virtual_id_regex.test(this.view.datarecord.id)){this.$('oe_mail_thread').hide();return;}
this.node.params=_.extend(this.node.params,{'message_ids':this.get_value(),'show_compose_message':this.view.is_action_enabled('edit'),});this.node.context={'mail_read_set_read':true,'default_res_id':this.view.datarecord.id||false,'default_model':this.view.model||false,};if(this.root){$('<span class="oe_mail-placeholder"/>').insertAfter(this.root.$el);this.root.destroy();}
this.root=new mail.Widget(this,_.extend(this.node,{'domain':(this.domain||[]).concat([['model','=',this.view.model],['res_id','=',this.view.datarecord.id]]),}));return this.root.replace(this.$('.oe_mail-placeholder'));},});mail.WallSidebar=session.web.Widget.extend({template:'mail.wall.sidebar',});session.web.client_actions.add('mail.wall','session.mail.Wall');mail.Wall=session.web.Widget.extend({template:'mail.wall',init:function(parent,action){this._super(parent,action);this.ActionManager=parent;this.action=_.clone(action);this.domain=this.action.params.domain||this.action.domain||[];this.context=_.extend(this.action.params.context||{},this.action.context||{});this.defaults={};for(var key in this.action.context.params){if(_.indexOf(['model','res_id'],key)==-1){continue;}
this.context['search_default_'+key]=this.action.context.params[key];}
for(var key in this.context){if(key.match(/^search_default_/)){this.defaults[key.replace(/^search_default_/,'')]=this.context[key];}}
this.action.params=_.extend({'display_indented_thread':1,'show_reply_button':true,'show_read_unread_button':true,'show_compose_message':true,'show_record_name':true,'show_compact_message':this.action.params.view_mailbox?false:1,'view_inbox':false,'emails_from_on_composer':false,'fetch_limit':30},this.action.params);},start:function(){this._super.apply(this);this.bind_events();var searchview_loaded=this.load_searchview(this.defaults);if(!this.searchview.has_defaults){this.message_render();}
var wall_sidebar=new mail.WallSidebar(this);wall_sidebar.appendTo(this.$el.find('.oe_mail_wall_aside'));},load_searchview:function(defaults){var ds_msg=new session.web.DataSetSearch(this,'mail.message');this.searchview=new session.web.SearchView(this,ds_msg,false,defaults||{},false);this.searchview.on('search_data',this,this.do_searchview_search);this.searchview.appendTo(this.$('.oe_view_manager_view_search'),this.$('.oe_searchview_drawer_container'));if(this.searchview.has_defaults){this.searchview.ready.then(this.searchview.do_search);}
return this.searchview},do_searchview_search:function(domains,contexts,groupbys){var self=this;session.web.pyeval.eval_domains_and_contexts({domains:domains||[],contexts:contexts||[],group_by_seq:groupbys||[]}).then(function(results){if(self.root){$('<span class="oe_mail-placeholder"/>').insertAfter(self.root.$el);self.root.destroy();}
return self.message_render(results);});},message_render:function(search){var domain=this.domain.concat(search&&search['domain']?search['domain']:[]);var context=_.extend(this.context,search&&search['context']?search['context']:{});this.root=new mail.Widget(this,_.extend(this.action,{'domain':domain,'context':context,}));return this.root.replace(this.$('.oe_mail-placeholder'));},bind_events:function(){var self=this;this.$(".oe_write_full").click(function(event){event.stopPropagation();var action={name:_t('Compose Email'),type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',action_from:'mail.ThreadComposeMessage',views:[[false,'form']],target:'new',context:{},};session.client.action_manager.do_action(action);});this.$(".oe_write_onwall").click(function(event){self.root.thread.on_compose_message(event);});}});openerp.mail.suggestions(session,mail);};;

/* /mail/static/src/js/mail_followers.js defined in bundle 'web.assets_backend' */
openerp_mail_followers=function(session,mail){var _t=session.web._t,_lt=session.web._lt;var mail_followers=session.mail_followers={};session.web.form.widgets.add('mail_followers','openerp.mail_followers.Followers');mail_followers.Followers=session.web.form.AbstractField.extend({template:'mail.followers',init:function(){this._super.apply(this,arguments);this.image=this.node.attrs.image||'image_small';this.comment=this.node.attrs.help||false;this.displayed_limit=this.node.attrs.displayed_nb||10;this.displayed_nb=this.displayed_limit;this.ds_model=new session.web.DataSetSearch(this,this.view.model);this.ds_users=new session.web.DataSetSearch(this,'res.users');this.value=[];this.followers=[];this.view_is_editable=this.__parentedParent.is_action_enabled('edit');},start:function(){this.view.on("change:actual_mode",this,this.on_check_visibility_mode);this.on_check_visibility_mode();this.reinit();this.bind_events();this._super();},on_check_visibility_mode:function(){this.set({"force_invisible":this.view.get("actual_mode")=="create"});},set_value:function(_value){this.value=_value;this._super(_value);},reinit:function(){this.message_is_follower==undefined;this.display_buttons();},bind_events:function(){var self=this;this.$('.oe_follower').on('click',function(event){if($(this).hasClass('oe_notfollow'))
self.do_follow();else
self.do_unfollow();});this.$el.on('click','.oe_subtype_list input',function(event){self.do_update_subscription(event);var $list=self.$('.oe_subtype_list');if(!$list.hasClass('open')){$list.addClass('open');}
if(self.$('.oe_subtype_list ul')[0].children.length<1){$list.removeClass('open');}
event.stopPropagation();});this.$('.oe_invite').on('click',self.on_invite_follower);this.$el.on('click','.oe_edit_subtype',self.on_edit_subtype);this.$el.on('click','.oe_remove_follower',self.on_remove_follower);this.$el.on('click','.oe_show_more',self.on_show_more_followers);this.$el.on('click','a[data-partner]',self.on_follower_clicked);},on_edit_subtype:function(event){var self=this;var $currentTarget=$(event.currentTarget);var user_pid=$currentTarget.data('id');$('div.oe_edit_actions').remove();self.$dialog=new session.web.Dialog(this,{size:'small',title:_t('Edit Subscription of ')+$currentTarget.siblings('a').text(),buttons:[{text:_t("Apply"),click:function(){self.do_update_subscription(event,user_pid);this.parents('.modal').modal('hide');}},{text:_t("Cancel"),click:function(){this.parents('.modal').modal('hide');}}],},"<div class='oe_edit_actions'>").open();return self.fetch_subtypes(user_pid);},on_invite_follower:function(event){var self=this;var action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{'default_res_model':this.view.dataset.model,'default_res_id':this.view.datarecord.id,},}
this.do_action(action,{on_close:function(){self.read_value();},});},on_show_more_followers:function(event){this.displayed_nb+=this.displayed_limit;this.display_followers(false);},on_remove_follower:function(event){var partner_id=$(event.target).data('id');var name=$(event.target).parent().find("a").html();if(confirm(_.str.sprintf(_t("Warning! \n %s won't be notified of any email or discussion on this document. Do you really want to remove him from the followers ?"),name))){var context=new session.web.CompoundContext(this.build_context(),{});return this.ds_model.call('message_unsubscribe',[[this.view.datarecord.id],[partner_id],context]).then(this.proxy('read_value'));}},on_follower_clicked:function(event){event.preventDefault();var partner_id=$(event.target).data('partner');var state={'model':'res.partner','id':partner_id,'title':this.record_name};session.webclient.action_manager.do_push_state(state);var action={type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:'res.partner',views:[[false,'form']],res_id:partner_id,}
this.do_action(action);},read_value:function(){var self=this;this.displayed_nb=this.displayed_limit;return this.ds_model.read_ids([this.view.datarecord.id],['message_follower_ids']).then(function(results){self.value=results[0].message_follower_ids;self.render_value();});},render_value:function(){this.reinit();return this.fetch_followers(this.value);},fetch_followers:function(value_){this.value=value_||[];return this.ds_model.call('read_followers_data',[this.value]).then(this.proxy('display_followers'),this.proxy('fetch_generic')).then(this.proxy('display_buttons')).then(this.proxy('fetch_subtypes'));},fetch_generic:function(error,event){var self=this;event.preventDefault();return this.ds_users.call('read',[[this.session.uid],['partner_id']]).then(function(results){var pid=results[0]['partner_id'][0];self.message_is_follower=(_.indexOf(self.value,pid)!=-1);}).then(self.proxy('display_generic'));},_format_followers:function(count){var str='';if(count<=0){str=_t('No followers');}else if(count===1){str=_t('One follower');}else{str=''+count+' '+_t('followers');}
return str;},display_generic:function(){var self=this;var node_user_list=this.$('.oe_follower_list').empty();this.$('.oe_follower_title').html(this._format_followers(this.value.length));},display_followers:function(records){var self=this;this.message_is_follower=false;this.followers=records||this.followers;var node_user_list=this.$('.oe_follower_list').empty();this.$('.oe_follower_title').html(this._format_followers(this.followers.length));self.message_is_follower=_.indexOf(this.followers.map(function(rec){return rec[2]['is_uid']}),true)!=-1;var truncated=this.followers.slice(0,this.displayed_nb);_(truncated).each(function(record){partner={'id':record[0],'name':record[1],'is_uid':record[2]['is_uid'],'is_editable':record[2]['is_editable'],'avatar_url':mail.ChatterUtils.get_image(self.session,'res.partner','image_small',record[0]),}
$(session.web.qweb.render('mail.followers.partner',{'record':partner,'widget':self})).appendTo(node_user_list);if(partner.is_editable){self.$('.oe_follower_list').on('mouseenter mouseleave',function(e){self.$('.oe_edit_subtype').toggleClass('oe_hidden',e.type=='mouseleave');self.$('.oe_follower_list').find('.oe_partner').toggleClass('oe_partner_name',e.type=='mouseenter');});}});if(truncated.length<this.followers.length){$(session.web.qweb.render('mail.followers.show_more',{'number':(this.followers.length-truncated.length)})).appendTo(node_user_list);}},display_buttons:function(){if(this.message_is_follower){this.$('button.oe_follower').removeClass('oe_notfollow').addClass('oe_following');}
else{this.$('button.oe_follower').removeClass('oe_following').addClass('oe_notfollow');}
if(this.view.is_action_enabled('edit'))
this.$('span.oe_mail_invite_wrapper').hide();else
this.$('span.oe_mail_invite_wrapper').show();},fetch_subtypes:function(user_pid){var self=this;var dialog=false;if(user_pid){dialog=true;}else{var subtype_list_ul=this.$('.oe_subtype_list ul').empty();if(!this.message_is_follower){this.$('.oe_subtype_list > .dropdown-toggle').attr('disabled',true);return;}
else{this.$('.oe_subtype_list > .dropdown-toggle').attr('disabled',false);}}
var id=this.view.datarecord.id;this.ds_model.call('message_get_subscription_data',[[id],user_pid,new session.web.CompoundContext(this.build_context(),{})]).then(function(data){self.display_subtypes(data,id,dialog);});},display_subtypes:function(data,id,dialog){var self=this;if(dialog){var $list=self.$dialog.$el;}
else{var $list=this.$('.oe_subtype_list ul');}
var records=data[id].message_subtype_data;this.records_length=$.map(records,function(value,index){return index;}).length;if(this.records_length>1){self.display_followers();}
var old_model='';_(records).each(function(record,record_name){if(old_model!=record.parent_model){if(old_model!=''){var index=$($list).find('.oe_subtype').length;$($($list).find('.oe_subtype')[index-1]).addClass('subtype-border');}
old_model=record.parent_model;}
record.name=record_name;record.followed=record.followed||undefined;$(session.web.qweb.render('mail.followers.subtype',{'record':record,'dialog':dialog})).appendTo($list);});},do_follow:function(){var context=new session.web.CompoundContext(this.build_context(),{});this.$('.oe_subtype_list > .dropdown-toggle').attr('disabled',false);this.ds_model.call('message_subscribe_users',[[this.view.datarecord.id],[this.session.uid],undefined,context]).then(this.proxy('read_value'));_.each(this.$('.oe_subtype_list input'),function(record){$(record).attr('checked','checked');});},do_unfollow:function(user_pid){var self=this;if(confirm(_t("Warning! \nYou won't be notified of any email or discussion on this document. Do you really want to unfollow this document ?"))){_(this.$('.oe_msg_subtype_check')).each(function(record){$(record).attr('checked',false);});var action_unsubscribe='message_unsubscribe_users';this.$('.oe_subtype_list > .dropdown-toggle').attr('disabled',true);var follower_ids=[this.session.uid];if(user_pid){action_unsubscribe='message_unsubscribe';follower_ids=[user_pid];}
var context=new session.web.CompoundContext(this.build_context(),{});return this.ds_model.call(action_unsubscribe,[[this.view.datarecord.id],follower_ids,context]).then(this.proxy('read_value'));}
return false;},do_update_subscription:function(event,user_pid){var self=this;var action_subscribe='message_subscribe_users';var follower_ids=[this.session.uid];var oe_action=this.$('.oe_actions input[type="checkbox"]');if(user_pid){action_subscribe='message_subscribe';follower_ids=[user_pid];oe_action=$('.oe_edit_actions input[type="checkbox"]');}
var checklist=new Array();_(oe_action).each(function(record){if($(record).is(':checked')){checklist.push(parseInt($(record).data('id')));}});if(!checklist.length){if(!this.do_unfollow(user_pid)){$(event.target).attr("checked","checked");}else{self.$('.oe_subtype_list ul').empty();}}else{var context=new session.web.CompoundContext(this.build_context(),{});return this.ds_model.call(action_subscribe,[[this.view.datarecord.id],follower_ids,checklist,context]).then(this.proxy('read_value'));}},});};;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'web.assets_backend' */
openerp_FieldMany2ManyTagsEmail=function(instance){var _t=instance.web._t;instance.web.form.FieldMany2ManyTagsEmail=instance.web.form.FieldMany2ManyTags.extend({start:function(){this.values=[];this.values_checking=[];this.on("change:value",this,this.on_change_value_check);this.trigger("change:value");this._super.apply(this,arguments);},on_change_value_check:function(){this.values=_.uniq(this.values);var values_removed=_.difference(this.values,this.get('value'));if(values_removed.length){this.values=_.difference(this.values,values_removed);this.set({'value':this.values});return false;}
var not_checked=_.difference(this.get('value'),this.values,this.values_checking);if(not_checked.length){this.values_checking=this.values_checking.concat(not_checked);this._check_email_popup(not_checked);}},_check_email_popup:function(ids){var self=this;new instance.web.Model('res.partner').call("search",[[["id","in",ids],["email","=",false],["notify_email","=",'always']]],{context:this.build_context()}).then(function(record_ids){var valid_partner=_.difference(ids,record_ids);self.values=self.values.concat(valid_partner);self.values_checking=_.difference(self.values_checking,valid_partner);_.each(record_ids,function(id){var pop=new instance.web.form.FormOpenPopup(self);pop.show_element('res.partner',id,self.build_context(),{title:_t("Please complete partner's informations and Email"),});pop.on('write_completed',self,function(){this.values.push(id);this.values_checking=_.without(this.values_checking,id);this.set({'value':this.values});});pop.on('closed',self,function(){this.values_checking=_.without(this.values_checking,id);this.set({'value':this.values});});});});},});instance.web.form.widgets=instance.web.form.widgets.extend({'many2many_tags_email':'instance.web.form.FieldMany2ManyTagsEmail',});};;

/* /mail/static/src/js/announcement.js defined in bundle 'web.assets_backend' */
openerp_announcement=function(instance){instance.web.WebClient.include({show_application:function(){return $.when(this._super.apply(this,arguments)).then(this.proxy('show_annoucement_bar'));},_ab_location:function(dbuuid){return _.str.sprintf('https://services.openerp.com/openerp-enterprise/ab/css/%s.css',dbuuid);},show_annoucement_bar:function(){if(this.session.get_cookie('ab')==='c'){return;}
var self=this;var config_parameter=new instance.web.Model('ir.config_parameter');$(openerp.qweb.render('WebClient.announcement_bar')).prependTo($('body'));var $bar=$('#announcement_bar_table');return config_parameter.call('get_param',['database.uuid',false]).then(function(dbuuid){if(!dbuuid){return;}
var $link=$bar.find('.url a');$link.attr('href',_.str.sprintf('%s/%s',$link.attr('href'),dbuuid));var $css=$('<link />').attr({rel:'stylesheet',type:'text/css',media:'screen',href:self._ab_location(dbuuid)});$css.on('load',function(){var close=function(){var ttl=7*24*60*60;self.session.set_cookie('ab','c',ttl);$bar.slideUp();setTimeout(function(){$('.openerp_webclient_container').css('height','calc(100% - 34px)');},400);};setTimeout(function(){var height=$('#announcement_bar_table').outerHeight()
+$('#oe_main_menu_navbar').outerHeight();$('.openerp_webclient_container').css('height','calc(100% - '+height+'px)');$bar.find('.close').on('click',close);self.trigger('ab_loaded',$bar);},400)});$('head').append($css);}).fail(function(result,ev){ev.preventDefault();});}});};;

/* /mail/static/src/js/suggestions.js defined in bundle 'web.assets_backend' */
openerp.mail.suggestions=function(session,mail){var _t=session.web._t;var QWeb=session.web.qweb;var suggestions=session.suggestions={};var removed_suggested_group=session.suggestions.removed_suggested_group=[];suggestions.Groups=session.web.Widget.extend({events:{'click .oe_suggestion_remove.oe_suggestion_group':'stop_group_suggestion','click .oe_suggestion_remove_item.oe_suggestion_group':'remove_group_suggestion','click .oe_suggestion_join':'join_group',},init:function(){this._super.apply(this,arguments);this.mail_group=new session.web.DataSetSearch(this,'mail.group');this.res_users=new session.web.DataSetSearch(this,'res.users');this.groups=[];},start:function(){this._super.apply(this,arguments);return this.fetch_suggested_groups();},fetch_suggested_groups:function(){var self=this;var group=self.mail_group.call('get_suggested_thread',{'removed_suggested_threads':removed_suggested_group}).then(function(res){_(res).each(function(result){result['image']=self.session.url('/web/binary/image',{model:'mail.group',field:'image_small',id:result.id});});self.groups=res;});return $.when(group).then(this.proxy('display_suggested_groups'));},display_suggested_groups:function(){var suggested_groups=this.$('.oe_sidebar_suggestion.oe_suggestion_group');if(suggested_groups){suggested_groups.empty();}
if(this.groups.length===0){return this.$el.empty();}
return this.$el.empty().html(QWeb.render('mail.suggestions.groups',{'widget':this}));},join_group:function(event){var self=this;var group_id=parseInt($(event.currentTarget).attr('id'),10);return this.mail_group.call('message_subscribe_users',[[group_id],[this.session.uid]]).then(function(res){self.fetch_suggested_groups();});},remove_group_suggestion:function(event){removed_suggested_group.push($(event.currentTarget).attr('id'));return this.fetch_suggested_groups();},stop_group_suggestion:function(event){var self=this;return this.res_users.call('stop_showing_groups_suggestions',[this.session.uid]).then(function(res){self.$(".oe_sidebar_suggestion.oe_suggestion_group").hide();});}});session.mail.WallSidebar.include({start:function(){this._super.apply(this,arguments);var sug_groups=new suggestions.Groups(this);return sug_groups.appendTo(this.$('.oe_suggestions_groups'));},});};;

/* /web_iframe/static/src/js/web_iframe.js defined in bundle 'web.assets_backend' */
openerp.web_iframe=function(session){var _t=session.web._t,_lt=session.web._lt;var web_iframe=session.web_iframe;session.web.client_actions.add('web_iframe.iframe','session.web_iframe.iframe');web_iframe.iframe=session.web.Widget.extend({template:'web_iframe.iframe',init:function(parent,action){this._super(parent,action);this.action=_.clone(action);this.action.params=_.extend({'link':'https://yelizariev.github.io/',},this.action.params);},start:function(){this.$el.find('iframe').css({height:'100%',width:'100%',border:0});this.$el.find('iframe').attr({src:this.action.params.link});this.$el.find('iframe').on("load",this.bind_events.bind(this));return this._super();},bind_events:function(){},iframe_clicked:function(e){}})};

/* /mass_mailing/static/src/js/mass_mailing.js defined in bundle 'web.assets_backend' */
openerp.mass_mailing=function(instance){var _t=instance.web._t;openerp.web_kanban.KanbanRecord.include({on_card_clicked:function(event){if(this.view.dataset.model==='mail.mass_mailing.campaign'){this.$('.oe_mailings').click();}else{this._super.apply(this,arguments);}},});};;

/* /oerp_no_phoning_home/static/src/js/announcement.js defined in bundle 'web.assets_backend' */
console.error("Could not get content for /oerp_no_phoning_home/static/src/js/announcement.js defined in bundle 'web.assets_backend'.");;

/* /point_of_sale/static/lib/fastclick.js defined in bundle 'web.assets_backend' */
function FastClick(layer){'use strict';var oldOnClick,self=this;this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=layer;if(!layer||!layer.nodeType){throw new TypeError('Layer must be a document node');}
this.onClick=function(){return FastClick.prototype.onClick.apply(self,arguments);};this.onMouse=function(){return FastClick.prototype.onMouse.apply(self,arguments);};this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(self,arguments);};this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(self,arguments);};this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(self,arguments);};this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(self,arguments);};if(FastClick.notNeeded(layer)){return;}
if(this.deviceIsAndroid){layer.addEventListener('mouseover',this.onMouse,true);layer.addEventListener('mousedown',this.onMouse,true);layer.addEventListener('mouseup',this.onMouse,true);}
layer.addEventListener('click',this.onClick,true);layer.addEventListener('touchstart',this.onTouchStart,false);layer.addEventListener('touchmove',this.onTouchMove,false);layer.addEventListener('touchend',this.onTouchEnd,false);layer.addEventListener('touchcancel',this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==='click'){rmv.call(layer,type,callback.hijacked||callback,capture);}else{rmv.call(layer,type,callback,capture);}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==='click'){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event);}}),capture);}else{adv.call(layer,type,callback,capture);}};}
if(typeof layer.onclick==='function'){oldOnClick=layer.onclick;layer.addEventListener('click',function(event){oldOnClick(event);},false);layer.onclick=null;}}
FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf('Android')>0;FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&(/OS ([6-9]|\d{2})_\d/).test(navigator.userAgent);FastClick.prototype.needsClick=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'button':case'select':case'textarea':if(target.disabled){return true;}
break;case'input':if((this.deviceIsIOS&&target.type==='file')||target.disabled){return true;}
break;case'label':case'video':return true;}
return(/\bneedsclick\b/).test(target.className);};FastClick.prototype.needsFocus=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'textarea':return true;case'select':return!this.deviceIsAndroid;case'input':switch(target.type){case'button':case'checkbox':case'file':case'image':case'radio':case'submit':return false;}
return!target.disabled&&!target.readOnly;default:return(/\bneedsfocus\b/).test(target.className);}};FastClick.prototype.sendClick=function(targetElement,event){'use strict';var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur();}
touch=event.changedTouches[0];clickEvent=document.createEvent('MouseEvents');clickEvent.initMouseEvent(this.determineEventType(targetElement),true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent);};FastClick.prototype.determineEventType=function(targetElement){'use strict;'
if(this.deviceIsAndroid&&targetElement.tagName.toLowerCase()==='select'){return'mousedown';}
return'click';}
FastClick.prototype.focus=function(targetElement){'use strict';var length;if(this.deviceIsIOS&&targetElement.setSelectionRange&&targetElement.type.indexOf('date')!==0&&targetElement.type!=='time'){length=targetElement.value.length;targetElement.setSelectionRange(length,length);}else{targetElement.focus();}};FastClick.prototype.updateScrollParent=function(targetElement){'use strict';var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break;}
parentElement=parentElement.parentElement;}while(parentElement);}
if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop;}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){'use strict';if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode;}
return eventTarget;};FastClick.prototype.onTouchStart=function(event){'use strict';var targetElement,touch,selection;if(event.targetTouches.length>1){return true;}
targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(this.deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true;}
if(!this.deviceIsIOS4){if(touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false;}
this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement);}}
this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if((event.timeStamp-this.lastClickTime)<200){event.preventDefault();}
return true;};FastClick.prototype.touchHasMoved=function(event){'use strict';var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true;}
return false;};FastClick.prototype.onTouchMove=function(event){'use strict';if(!this.trackingClick){return true;}
if(this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null;}
return true;};FastClick.prototype.findControl=function(labelElement){'use strict';if(labelElement.control!==undefined){return labelElement.control;}
if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor);}
return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');};FastClick.prototype.onTouchEnd=function(event){'use strict';var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick){return true;}
if((event.timeStamp-this.lastClickTime)<200){this.cancelNextClick=true;return true;}
this.cancelNextClick=false;this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(this.deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent;}
targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==='label'){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(this.deviceIsAndroid){return false;}
targetElement=forElement;}}else if(this.needsFocus(targetElement)){if((event.timeStamp-trackingClickStart)>100||(this.deviceIsIOS&&window.top!==window&&targetTagName==='input')){this.targetElement=null;return false;}
this.focus(targetElement);if(!this.deviceIsIOS4||targetTagName!=='select'){this.targetElement=null;event.preventDefault();}
return false;}
if(this.deviceIsIOS&&!this.deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true;}}
if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event);}
return false;};FastClick.prototype.onTouchCancel=function(){'use strict';this.trackingClick=false;this.targetElement=null;};FastClick.prototype.onMouse=function(event){'use strict';if(!this.targetElement){return true;}
if(event.forwardedTouchEvent){return true;}
if(!event.cancelable){return true;}
if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation();}else{event.propagationStopped=true;}
event.stopPropagation();event.preventDefault();return false;}
return true;};FastClick.prototype.onClick=function(event){'use strict';var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true;}
if(event.target.type==='submit'&&event.detail===0){return true;}
permitted=this.onMouse(event);if(!permitted){this.targetElement=null;}
return permitted;};FastClick.prototype.destroy=function(){'use strict';var layer=this.layer;if(this.deviceIsAndroid){layer.removeEventListener('mouseover',this.onMouse,true);layer.removeEventListener('mousedown',this.onMouse,true);layer.removeEventListener('mouseup',this.onMouse,true);}
layer.removeEventListener('click',this.onClick,true);layer.removeEventListener('touchstart',this.onTouchStart,false);layer.removeEventListener('touchmove',this.onTouchMove,false);layer.removeEventListener('touchend',this.onTouchEnd,false);layer.removeEventListener('touchcancel',this.onTouchCancel,false);};FastClick.notNeeded=function(layer){'use strict';var metaViewport;if(typeof window.ontouchstart==='undefined'){return true;}
if((/Chrome\/[0-9]+/).test(navigator.userAgent)){if(FastClick.prototype.deviceIsAndroid){metaViewport=document.querySelector('meta[name=viewport]');if(metaViewport&&metaViewport.content.indexOf('user-scalable=no')!==-1){return false;}}else{return true;}}
if(layer.style.msTouchAction==='none'){return true;}
return false;};FastClick.attach=function(layer){'use strict';return new FastClick(layer);};if(typeof define!=='undefined'&&define.amd){define(function(){'use strict';return FastClick;});}else if(typeof module!=='undefined'&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick;}else{window.FastClick=FastClick;};

/* /point_of_sale/static/lib/waitfont.js defined in bundle 'web.assets_backend' */
(function(){function waitForWebfonts(fonts,callback){var loadedFonts=0;for(var i=0,l=fonts.length;i<l;++i){(function(font){var node=document.createElement('span');node.innerHTML='giItT1WQy@!-/#';node.style.position='absolute';node.style.left='-10000px';node.style.top='-10000px';node.style.fontSize='300px';node.style.fontFamily='sans-serif';node.style.fontVariant='normal';node.style.fontStyle='normal';node.style.fontWeight='normal';node.style.letterSpacing='0';document.body.appendChild(node);var width=node.offsetWidth;node.style.fontFamily=font;var interval;function checkFont(){if(node&&node.offsetWidth!=width){++loadedFonts;node.parentNode.removeChild(node);node=null;}
if(loadedFonts>=fonts.length){if(interval){clearInterval(interval);}
if(loadedFonts==fonts.length){callback();return true;}}};if(!checkFont()){interval=setInterval(checkFont,50);}})(fonts[i]);}}
window.waitForWebfonts=waitForWebfonts;})();;

/* /point_of_sale/static/src/js/db.js defined in bundle 'web.assets_backend' */
function openerp_pos_db(instance,module){module.PosDB=instance.web.Class.extend({name:'openerp_pos_db',limit:100,init:function(options){options=options||{};this.name=options.name||this.name;this.limit=options.limit||this.limit;this.cache={};this.product_by_id={};this.product_by_ean13={};this.product_by_category_id={};this.product_by_reference={};this.partner_sorted=[];this.partner_by_id={};this.partner_by_ean13={};this.partner_search_string="";this.partner_write_date=null;this.category_by_id={};this.root_category_id=0;this.category_products={};this.category_ancestors={};this.category_childs={};this.category_parent={};this.category_search_string={};this.packagings_by_id={};this.packagings_by_product_tmpl_id={};this.packagings_by_ean13={};},get_category_by_id:function(categ_id){if(categ_id instanceof Array){var list=[];for(var i=0,len=categ_id.length;i<len;i++){var cat=this.category_by_id[categ_id[i]];if(cat){list.push(cat);}else{console.error("get_category_by_id: no category has id:",categ_id[i]);}}
return list;}else{return this.category_by_id[categ_id];}},get_category_childs_ids:function(categ_id){return this.category_childs[categ_id]||[];},get_category_ancestors_ids:function(categ_id){return this.category_ancestors[categ_id]||[];},get_category_parent_id:function(categ_id){return this.category_parent[categ_id]||this.root_category_id;},add_categories:function(categories){var self=this;if(!this.category_by_id[this.root_category_id]){this.category_by_id[this.root_category_id]={id:this.root_category_id,name:'Root',};}
for(var i=0,len=categories.length;i<len;i++){this.category_by_id[categories[i].id]=categories[i];}
for(var i=0,len=categories.length;i<len;i++){var cat=categories[i];var parent_id=cat.parent_id[0]||this.root_category_id;this.category_parent[cat.id]=cat.parent_id[0];if(!this.category_childs[parent_id]){this.category_childs[parent_id]=[];}
this.category_childs[parent_id].push(cat.id);}
function make_ancestors(cat_id,ancestors){self.category_ancestors[cat_id]=ancestors;ancestors=ancestors.slice(0);ancestors.push(cat_id);var childs=self.category_childs[cat_id]||[];for(var i=0,len=childs.length;i<len;i++){make_ancestors(childs[i],ancestors);}}
make_ancestors(this.root_category_id,[]);},load:function(store,deft){if(this.cache[store]!==undefined){return this.cache[store];}
var data=localStorage[this.name+'_'+store];if(data!==undefined&&data!==""){data=JSON.parse(data);this.cache[store]=data;return data;}else{return deft;}},save:function(store,data){var str_data=JSON.stringify(data);localStorage[this.name+'_'+store]=JSON.stringify(data);this.cache[store]=data;},_product_search_string:function(product){var str=product.display_name;if(product.ean13){str+='|'+product.ean13;}
if(product.default_code){str+='|'+product.default_code;}
if(product.description){str+='|'+product.description;}
if(product.description_sale){str+='|'+product.description_sale;}
var packagings=this.packagings_by_product_tmpl_id[product.product_tmpl_id]||[];for(var i=0;i<packagings.length;i++){str+='|'+packagings[i].ean;}
str=product.id+':'+str.replace(':','')+'\n';return str;},add_products:function(products){var stored_categories=this.product_by_category_id;if(!products instanceof Array){products=[products];}
for(var i=0,len=products.length;i<len;i++){var product=products[i];var search_string=this._product_search_string(product);var categ_id=product.pos_categ_id?product.pos_categ_id[0]:this.root_category_id;product.product_tmpl_id=product.product_tmpl_id[0];if(!stored_categories[categ_id]){stored_categories[categ_id]=[];}
stored_categories[categ_id].push(product.id);if(this.category_search_string[categ_id]===undefined){this.category_search_string[categ_id]='';}
this.category_search_string[categ_id]+=search_string;var ancestors=this.get_category_ancestors_ids(categ_id)||[];for(var j=0,jlen=ancestors.length;j<jlen;j++){var ancestor=ancestors[j];if(!stored_categories[ancestor]){stored_categories[ancestor]=[];}
stored_categories[ancestor].push(product.id);if(this.category_search_string[ancestor]===undefined){this.category_search_string[ancestor]='';}
this.category_search_string[ancestor]+=search_string;}
this.product_by_id[product.id]=product;if(product.ean13){this.product_by_ean13[product.ean13]=product;}
if(product.default_code){this.product_by_reference[product.default_code]=product;}}},add_packagings:function(packagings){for(var i=0,len=packagings.length;i<len;i++){var pack=packagings[i];this.packagings_by_id[pack.id]=pack;if(!this.packagings_by_product_tmpl_id[pack.product_tmpl_id[0]]){this.packagings_by_product_tmpl_id[pack.product_tmpl_id[0]]=[];}
this.packagings_by_product_tmpl_id[pack.product_tmpl_id[0]].push(pack);if(pack.ean){this.packagings_by_ean13[pack.ean]=pack;}}},_partner_search_string:function(partner){var str=partner.name;if(partner.ean13){str+='|'+partner.ean13;}
if(partner.address){str+='|'+partner.address;}
if(partner.phone){str+='|'+partner.phone.split(' ').join('');}
if(partner.mobile){str+='|'+partner.mobile.split(' ').join('');}
if(partner.email){str+='|'+partner.email;}
str=''+partner.id+':'+str.replace(':','')+'\n';return str;},add_partners:function(partners){var updated_count=0;var new_write_date='';for(var i=0,len=partners.length;i<len;i++){var partner=partners[i];if(this.partner_write_date&&this.partner_by_id[partner.id]&&new Date(this.partner_write_date).getTime()+1000>=new Date(partner.write_date).getTime()){continue;}else if(new_write_date<partner.write_date){new_write_date=partner.write_date;}
if(!this.partner_by_id[partner.id]){this.partner_sorted.push(partner.id);}
this.partner_by_id[partner.id]=partner;updated_count+=1;}
this.partner_write_date=new_write_date||this.partner_write_date;if(updated_count){this.partner_search_string="";this.partner_by_ean13={};for(var id in this.partner_by_id){var partner=this.partner_by_id[id];if(partner.ean13){this.partner_by_ean13[partner.ean13]=partner;}
partner.address=(partner.street||'')+', '+
(partner.zip||'')+' '+
(partner.city||'')+', '+
(partner.country_id[1]||'');this.partner_search_string+=this._partner_search_string(partner);}}
return updated_count;},get_partner_write_date:function(){return this.partner_write_date;},get_partner_by_id:function(id){return this.partner_by_id[id];},get_partner_by_ean13:function(ean13){return this.partner_by_ean13[ean13];},get_partners_sorted:function(max_count){max_count=max_count?Math.min(this.partner_sorted.length,max_count):this.partner_sorted.length;var partners=[];for(var i=0;i<max_count;i++){partners.push(this.partner_by_id[this.partner_sorted[i]]);}
return partners;},search_partner:function(query){try{query=query.replace(/[\[\]\(\)\+\*\?\.\-\!\&\^\$\|\~\_\{\}\:\,\\\/]/g,'.');query=query.replace(' ','.+');var re=RegExp("([0-9]+):.*?"+query,"gi");}catch(e){return[];}
var results=[];for(var i=0;i<this.limit;i++){r=re.exec(this.partner_search_string);if(r){var id=Number(r[1]);results.push(this.get_partner_by_id(id));}else{break;}}
return results;},clear:function(stores){for(var i=0,len=arguments.length;i<len;i++){localStorage.removeItem(this.name+'_'+arguments[i]);}},_count_props:function(obj){var count=0;for(var prop in obj){if(obj.hasOwnProperty(prop)){count++;}}
return count;},get_product_by_id:function(id){return this.product_by_id[id];},get_product_by_ean13:function(ean13){if(this.product_by_ean13[ean13]){return this.product_by_ean13[ean13];}
var pack=this.packagings_by_ean13[ean13];if(pack){return this.product_by_id[pack.product_tmpl_id[0]];}
return undefined;},get_product_by_reference:function(ref){return this.product_by_reference[ref];},get_product_by_category:function(category_id){var product_ids=this.product_by_category_id[category_id];var list=[];if(product_ids){for(var i=0,len=Math.min(product_ids.length,this.limit);i<len;i++){list.push(this.product_by_id[product_ids[i]]);}}
return list;},search_product_in_category:function(category_id,query){try{query=query.replace(/[\[\]\(\)\+\*\?\.\-\!\&\^\$\|\~\_\{\}\:\,\\\/]/g,'.');query=query.replace(' ','.+');var re=RegExp("([0-9]+):.*?"+query,"gi");}catch(e){return[];}
var results=[];for(var i=0;i<this.limit;i++){r=re.exec(this.category_search_string[category_id]);if(r){var id=Number(r[1]);results.push(this.get_product_by_id(id));}else{break;}}
return results;},add_order:function(order){var order_id=order.uid;var orders=this.load('orders',[]);for(var i=0,len=orders.length;i<len;i++){if(orders[i].id===order_id){orders[i].data=order;this.save('orders',orders);return order_id;}}
orders.push({id:order_id,data:order});this.save('orders',orders);return order_id;},remove_order:function(order_id){var orders=this.load('orders',[]);orders=_.filter(orders,function(order){return order.id!==order_id;});this.save('orders',orders);},remove_all_orders:function(){this.save('orders',[]);},get_orders:function(){return this.load('orders',[]);},get_order:function(order_id){var orders=this.get_orders();for(var i=0,len=orders.length;i<len;i++){if(orders[i].id===order_id){return orders[i];}}
return undefined;},});};

/* /point_of_sale/static/src/js/models.js defined in bundle 'web.assets_backend' */
function openerp_pos_models(instance,module){var QWeb=instance.web.qweb;var _t=instance.web._t;var round_di=instance.web.round_decimals;var round_pr=instance.web.round_precision
module.PosModel=Backbone.Model.extend({initialize:function(session,attributes){Backbone.Model.prototype.initialize.call(this,attributes);var self=this;this.session=session;this.flush_mutex=new $.Mutex();this.pos_widget=attributes.pos_widget;this.proxy=new module.ProxyDevice(this);this.barcode_reader=new module.BarcodeReader({'pos':this,proxy:this.proxy,patterns:{}});this.proxy_queue=new module.JobQueue();this.db=new module.PosDB();this.debug=jQuery.deparam(jQuery.param.querystring()).debug!==undefined;this.accounting_precision=2;this.company_logo=null;this.company_logo_base64='';this.currency=null;this.shop=null;this.company=null;this.user=null;this.users=[];this.partners=[];this.cashier=null;this.cashregisters=[];this.bankstatements=[];this.taxes=[];this.pos_session=null;this.config=null;this.units=[];this.units_by_id={};this.pricelist=null;this.order_sequence=1;window.posmodel=this;this.set({'synch':{state:'connected',pending:0},'orders':new module.OrderCollection(),'selectedOrder':null,});this.bind('change:synch',function(pos,synch){clearTimeout(self.synch_timeout);self.synch_timeout=setTimeout(function(){if(synch.state!=='disconnected'&&synch.pending>0){self.set('synch',{state:'disconnected',pending:synch.pending});}},3000);});this.get('orders').bind('remove',function(order,_unused_,options){self.on_removed_order(order,options.index,options.reason);});this.ready=this.load_server_data().then(function(){if(self.config.use_proxy){return self.connect_to_proxy();}});},destroy:function(){this.proxy.close();this.barcode_reader.disconnect();this.barcode_reader.disconnect_from_proxy();},connect_to_proxy:function(){var self=this;var done=new $.Deferred();this.barcode_reader.disconnect_from_proxy();this.pos_widget.loading_message(_t('Connecting to the PosBox'),0);this.pos_widget.loading_skip(function(){self.proxy.stop_searching();});this.proxy.autoconnect({force_ip:self.config.proxy_ip||undefined,progress:function(prog){self.pos_widget.loading_progress(prog);},}).then(function(){if(self.config.iface_scan_via_proxy){self.barcode_reader.connect_to_proxy();}}).always(function(){done.resolve();});return done;},fetch:function(model,fields,domain,ctx){this._load_progress=(this._load_progress||0)+0.05;this.pos_widget.loading_message(_t('Loading')+' '+model,this._load_progress);return new instance.web.Model(model).query(fields).filter(domain).context(ctx).all()},models:[{model:'res.users',fields:['name','company_id'],ids:function(self){return[self.session.uid];},loaded:function(self,users){self.user=users[0];},},{model:'res.company',fields:['currency_id','email','website','company_registry','vat','name','phone','partner_id','country_id'],ids:function(self){return[self.user.company_id[0]]},loaded:function(self,companies){self.company=companies[0];},},{model:'decimal.precision',fields:['name','digits'],loaded:function(self,dps){self.dp={};for(var i=0;i<dps.length;i++){self.dp[dps[i].name]=dps[i].digits;}},},{model:'product.uom',fields:[],domain:null,loaded:function(self,units){self.units=units;var units_by_id={};for(var i=0,len=units.length;i<len;i++){units_by_id[units[i].id]=units[i];units[i].groupable=(units[i].category_id[0]===1);units[i].is_unit=(units[i].id===1);}
self.units_by_id=units_by_id;}},{model:'res.users',fields:['name','ean13'],domain:null,loaded:function(self,users){self.users=users;},},{model:'res.partner',fields:['name','street','city','state_id','country_id','vat','phone','zip','mobile','email','ean13','write_date'],domain:[['customer','=',true]],loaded:function(self,partners){self.partners=partners;self.db.add_partners(partners);},},{model:'res.country',fields:['name'],loaded:function(self,countries){self.countries=countries;self.company.country=null;for(var i=0;i<countries.length;i++){if(countries[i].id===self.company.country_id[0]){self.company.country=countries[i];}}},},{model:'account.tax',fields:['name','amount','price_include','include_base_amount','type'],domain:null,loaded:function(self,taxes){self.taxes=taxes;self.taxes_by_id={};for(var i=0;i<taxes.length;i++){self.taxes_by_id[taxes[i].id]=taxes[i];}},},{model:'pos.session',fields:['id','journal_ids','name','user_id','config_id','start_at','stop_at','sequence_number','login_number'],domain:function(self){return[['state','=','opened'],['user_id','=',self.session.uid]];},loaded:function(self,pos_sessions){self.pos_session=pos_sessions[0];var orders=self.db.get_orders();for(var i=0;i<orders.length;i++){self.pos_session.sequence_number=Math.max(self.pos_session.sequence_number,orders[i].data.sequence_number+1);}},},{model:'pos.config',fields:[],domain:function(self){return[['id','=',self.pos_session.config_id[0]]];},loaded:function(self,configs){self.config=configs[0];self.config.use_proxy=self.config.iface_payment_terminal||self.config.iface_electronic_scale||self.config.iface_print_via_proxy||self.config.iface_scan_via_proxy||self.config.iface_cashdrawer;self.barcode_reader.add_barcode_patterns({'product':self.config.barcode_product,'cashier':self.config.barcode_cashier,'client':self.config.barcode_customer,'weight':self.config.barcode_weight,'discount':self.config.barcode_discount,'price':self.config.barcode_price,});if(self.config.company_id[0]!==self.user.company_id[0]){throw new Error(_t("Error: The Point of Sale User must belong to the same company as the Point of Sale. You are probably trying to load the point of sale as an administrator in a multi-company setup, with the administrator account set to the wrong company."));}},},{model:'stock.location',fields:[],ids:function(self){return[self.config.stock_location_id[0]];},loaded:function(self,locations){self.shop=locations[0];},},{model:'product.pricelist',fields:['currency_id'],ids:function(self){return[self.config.pricelist_id[0]];},loaded:function(self,pricelists){self.pricelist=pricelists[0];},},{model:'res.currency',fields:['symbol','position','rounding','accuracy'],ids:function(self){return[self.pricelist.currency_id[0]];},loaded:function(self,currencies){self.currency=currencies[0];if(self.currency.rounding>0){self.currency.decimals=Math.ceil(Math.log(1.0/self.currency.rounding)/Math.log(10));}else{self.currency.decimals=0;}},},{model:'product.packaging',fields:['ean','product_tmpl_id'],domain:null,loaded:function(self,packagings){self.db.add_packagings(packagings);},},{model:'pos.category',fields:['id','name','parent_id','child_id','image'],domain:null,loaded:function(self,categories){self.db.add_categories(categories);},},{model:'product.product',fields:['display_name','list_price','price','pos_categ_id','taxes_id','ean13','default_code','to_weight','uom_id','uos_id','uos_coeff','mes_type','description_sale','description','product_tmpl_id'],domain:[['sale_ok','=',true],['available_in_pos','=',true]],context:function(self){return{pricelist:self.pricelist.id,display_default_code:false};},loaded:function(self,products){self.db.add_products(products);},},{model:'account.bank.statement',fields:['account_id','currency','journal_id','state','name','user_id','pos_session_id'],domain:function(self){return[['state','=','open'],['pos_session_id','=',self.pos_session.id]];},loaded:function(self,bankstatements,tmp){self.bankstatements=bankstatements;tmp.journals=[];_.each(bankstatements,function(statement){tmp.journals.push(statement.journal_id[0]);});},},{model:'account.journal',fields:[],domain:function(self,tmp){return[['id','in',tmp.journals]];},loaded:function(self,journals){self.journals=journals;var bankstatements=self.bankstatements;for(var i=0,ilen=bankstatements.length;i<ilen;i++){for(var j=0,jlen=journals.length;j<jlen;j++){if(bankstatements[i].journal_id[0]===journals[j].id){bankstatements[i].journal=journals[j];}}}
self.cashregisters=bankstatements;},},{label:'fonts',loaded:function(self){var fonts_loaded=new $.Deferred();waitForWebfonts(['Lato','Inconsolata'],function(){fonts_loaded.resolve();});setTimeout(function(){fonts_loaded.resolve();},5000);return fonts_loaded;},},{label:'pictures',loaded:function(self){self.company_logo=new Image();var logo_loaded=new $.Deferred();self.company_logo.onload=function(){var img=self.company_logo;var ratio=1;var targetwidth=300;var maxheight=150;if(img.width!==targetwidth){ratio=targetwidth/img.width;}
if(img.height*ratio>maxheight){ratio=maxheight/img.height;}
var width=Math.floor(img.width*ratio);var height=Math.floor(img.height*ratio);var c=document.createElement('canvas');c.width=width;c.height=height
var ctx=c.getContext('2d');ctx.drawImage(self.company_logo,0,0,width,height);self.company_logo_base64=c.toDataURL();logo_loaded.resolve();};self.company_logo.onerror=function(){logo_loaded.reject();};self.company_logo.crossOrigin="anonymous";self.company_logo.src='/web/binary/company_logo'+'?_'+Math.random();return logo_loaded;},},],load_server_data:function(){var self=this;var loaded=new $.Deferred();var progress=0;var progress_step=1.0/self.models.length;var tmp={};function load_model(index){if(index>=self.models.length){loaded.resolve();}else{var model=self.models[index];self.pos_widget.loading_message(_t('Loading')+' '+(model.label||model.model||''),progress);var fields=typeof model.fields==='function'?model.fields(self,tmp):model.fields;var domain=typeof model.domain==='function'?model.domain(self,tmp):model.domain;var context=typeof model.context==='function'?model.context(self,tmp):model.context;var ids=typeof model.ids==='function'?model.ids(self,tmp):model.ids;progress+=progress_step;if(model.model){if(model.ids){var records=new instance.web.Model(model.model).call('read',[ids,fields],context);}else{var records=new instance.web.Model(model.model).query(fields).filter(domain).context(context).all()}
records.then(function(result){try{$.when(model.loaded(self,result,tmp)).then(function(){load_model(index+1);},function(err){loaded.reject(err);});}catch(err){loaded.reject(err);}},function(err){loaded.reject(err);});}else if(model.loaded){try{$.when(model.loaded(self,tmp)).then(function(){load_model(index+1);},function(err){loaded.reject(err);});}catch(err){loaded.reject(err);}}else{load_model(index+1);}}}
try{load_model(0);}catch(err){loaded.reject(err);}
return loaded;},load_new_partners:function(){var self=this;var def=new $.Deferred();var fields=_.find(this.models,function(model){return model.model==='res.partner';}).fields;new instance.web.Model('res.partner').query(fields).filter([['write_date','>',this.db.get_partner_write_date()]]).all({'timeout':3000,'shadow':true}).then(function(partners){if(self.db.add_partners(partners)){def.resolve();}else{def.reject();}},function(err,event){event.preventDefault();def.reject();});return def;},on_removed_order:function(removed_order,index,reason){if((reason==='abandon'||removed_order.temporary)&&this.get('orders').size()>0){this.set({'selectedOrder':this.get('orders').at(index)||this.get('orders').last()});}else{this.add_new_order();}},add_new_order:function(){var order=new module.Order({pos:this});this.get('orders').add(order);this.set('selectedOrder',order);},get_order:function(){return this.get('selectedOrder');},delete_current_order:function(){this.get('selectedOrder').destroy({'reason':'abandon'});},push_order:function(order){var self=this;if(order){this.proxy.log('push_order',order.export_as_JSON());this.db.add_order(order.export_as_JSON());}
var pushed=new $.Deferred();this.flush_mutex.exec(function(){var flushed=self._flush_orders(self.db.get_orders());flushed.always(function(ids){pushed.resolve();});});return pushed;},push_and_invoice_order:function(order){var self=this;var invoiced=new $.Deferred();if(!order.get_client()){invoiced.reject('error-no-client');return invoiced;}
var order_id=this.db.add_order(order.export_as_JSON());this.flush_mutex.exec(function(){var done=new $.Deferred();var transfer=self._flush_orders([self.db.get_order(order_id)],{timeout:30000,to_invoice:true});transfer.fail(function(){invoiced.reject('error-transfer');done.reject();});transfer.pipe(function(order_server_id){self.pos_widget.do_action('point_of_sale.pos_invoice_report',{additional_context:{active_ids:order_server_id,}});invoiced.resolve();done.resolve();});return done;});return invoiced;},_flush_orders:function(orders,options){var self=this;this.set('synch',{state:'connecting',pending:orders.length});return self._save_to_server(orders,options).done(function(server_ids){var pending=self.db.get_orders().length;self.set('synch',{state:pending?'connecting':'connected',pending:pending});return server_ids;});},_save_to_server:function(orders,options){if(!orders||!orders.length){var result=$.Deferred();result.resolve([]);return result;}
options=options||{};var self=this;var timeout=typeof options.timeout==='number'?options.timeout:7500*orders.length;var posOrderModel=new instance.web.Model('pos.order');return posOrderModel.call('create_from_ui',[_.map(orders,function(order){order.to_invoice=options.to_invoice||false;return order;})],undefined,{shadow:!options.to_invoice,timeout:timeout}).then(function(server_ids){_.each(orders,function(order){self.db.remove_order(order.id);});return server_ids;}).fail(function(error,event){if(error.code===200){self.pos_widget.screen_selector.show_popup('error-traceback',{message:error.data.message,comment:error.data.debug});}
event.preventDefault();console.error('Failed to send orders:',orders);});},scan_product:function(parsed_code){var self=this;var selectedOrder=this.get('selectedOrder');if(parsed_code.encoding==='ean13'){var product=this.db.get_product_by_ean13(parsed_code.base_code);}else if(parsed_code.encoding==='reference'){var product=this.db.get_product_by_reference(parsed_code.code);}
if(!product){return false;}
if(parsed_code.type==='price'){selectedOrder.addProduct(product,{price:parsed_code.value});}else if(parsed_code.type==='weight'){selectedOrder.addProduct(product,{quantity:parsed_code.value,merge:false});}else if(parsed_code.type==='discount'){selectedOrder.addProduct(product,{discount:parsed_code.value,merge:false});}else{selectedOrder.addProduct(product);}
return true;},});var orderline_id=1;module.Orderline=Backbone.Model.extend({initialize:function(attr,options){this.pos=options.pos;this.order=options.order;this.product=options.product;this.price=options.product.price;this.quantity=1;this.quantityStr='1';this.discount=0;this.discountStr='0';this.type='unit';this.selected=false;this.id=orderline_id++;},clone:function(){var orderline=new module.Orderline({},{pos:this.pos,order:null,product:this.product,price:this.price,});orderline.quantity=this.quantity;orderline.quantityStr=this.quantityStr;orderline.discount=this.discount;orderline.type=this.type;orderline.selected=false;return orderline;},set_discount:function(discount){var disc=Math.min(Math.max(parseFloat(discount)||0,0),100);this.discount=disc;this.discountStr=''+disc;this.trigger('change',this);},get_discount:function(){return this.discount;},get_discount_str:function(){return this.discountStr;},get_product_type:function(){return this.type;},set_quantity:function(quantity){if(quantity==='remove'){this.order.removeOrderline(this);return;}else{var quant=parseFloat(quantity)||0;var unit=this.get_unit();if(unit){if(unit.rounding){this.quantity=round_pr(quant,unit.rounding);this.quantityStr=this.quantity.toFixed(Math.ceil(Math.log(1.0/unit.rounding)/Math.log(10)));}else{this.quantity=round_pr(quant,1);this.quantityStr=this.quantity.toFixed(0);}}else{this.quantity=quant;this.quantityStr=''+this.quantity;}}
this.trigger('change',this);},get_quantity:function(){return this.quantity;},get_quantity_str:function(){return this.quantityStr;},get_quantity_str_with_unit:function(){var unit=this.get_unit();if(unit&&!unit.is_unit){return this.quantityStr+' '+unit.name;}else{return this.quantityStr;}},get_unit:function(){var unit_id=this.product.uom_id;if(!unit_id){return undefined;}
unit_id=unit_id[0];if(!this.pos){return undefined;}
return this.pos.units_by_id[unit_id];},get_product:function(){return this.product;},set_selected:function(selected){this.selected=selected;this.trigger('change',this);},is_selected:function(){return this.selected;},can_be_merged_with:function(orderline){if(this.get_product().id!==orderline.get_product().id){return false;}else if(!this.get_unit()||!this.get_unit().groupable){return false;}else if(this.get_product_type()!==orderline.get_product_type()){return false;}else if(this.get_discount()>0){return false;}else if(this.price!==orderline.price){return false;}else{return true;}},merge:function(orderline){this.set_quantity(this.get_quantity()+orderline.get_quantity());},export_as_JSON:function(){return{qty:this.get_quantity(),price_unit:this.get_unit_price(),discount:this.get_discount(),product_id:this.get_product().id,};},export_for_printing:function(){return{quantity:this.get_quantity(),unit_name:this.get_unit().name,price:this.get_unit_price(),discount:this.get_discount(),product_name:this.get_product().display_name,price_display:this.get_display_price(),price_with_tax:this.get_price_with_tax(),price_without_tax:this.get_price_without_tax(),tax:this.get_tax(),product_description:this.get_product().description,product_description_sale:this.get_product().description_sale,};},set_unit_price:function(price){this.price=round_di(parseFloat(price)||0,this.pos.dp['Product Price']);this.trigger('change',this);},get_unit_price:function(){return this.price;},get_base_price:function(){var rounding=this.pos.currency.rounding;return round_pr(this.get_unit_price()*this.get_quantity()*(1-this.get_discount()/100),rounding);},get_display_price:function(){return this.get_base_price();},get_price_without_tax:function(){return this.get_all_prices().priceWithoutTax;},get_price_with_tax:function(){return this.get_all_prices().priceWithTax;},get_tax:function(){return this.get_all_prices().tax;},get_applicable_taxes:function(){var ptaxes_ids=this.get_product().taxes_id;var ptaxes_set={};for(var i=0;i<ptaxes_ids.length;i++){ptaxes_set[ptaxes_ids[i]]=true;}
var taxes=[];for(var i=0;i<this.pos.taxes.length;i++){if(ptaxes_set[this.pos.taxes[i].id]){taxes.push(this.pos.taxes[i]);}}
return taxes;},get_tax_details:function(){return this.get_all_prices().taxDetails;},get_all_prices:function(){var self=this;var currency_rounding=this.pos.currency.rounding;var base=this.get_base_price();var totalTax=base;var totalNoTax=base;var product=this.get_product();var taxes=this.get_applicable_taxes();var taxtotal=0;var taxdetail={};_.each(taxes,function(tax){if(tax.price_include){var tmp;if(tax.type==="percent"){tmp=base-round_pr(base/(1+tax.amount),currency_rounding);}else if(tax.type==="fixed"){tmp=round_pr(tax.amount*self.get_quantity(),currency_rounding);}else{throw"This type of tax is not supported by the point of sale: "+tax.type;}
tmp=round_pr(tmp,currency_rounding);taxtotal+=tmp;totalNoTax-=tmp;taxdetail[tax.id]=tmp;}else{var tmp;if(tax.type==="percent"){tmp=tax.amount*base;}else if(tax.type==="fixed"){tmp=tax.amount*self.get_quantity();}else{throw"This type of tax is not supported by the point of sale: "+tax.type;}
tmp=round_pr(tmp,currency_rounding);if(tax.include_base_amount){base+=tmp;}
taxtotal+=tmp;totalTax+=tmp;taxdetail[tax.id]=tmp;}});return{"priceWithTax":totalTax,"priceWithoutTax":totalNoTax,"tax":taxtotal,"taxDetails":taxdetail,};},});module.OrderlineCollection=Backbone.Collection.extend({model:module.Orderline,});module.Paymentline=Backbone.Model.extend({initialize:function(attributes,options){this.amount=0;this.cashregister=options.cashregister;this.name=this.cashregister.journal_id[1];this.selected=false;this.pos=options.pos;},set_amount:function(value){this.amount=round_di(parseFloat(value)||0,this.pos.currency.decimals);this.trigger('change:amount',this);},get_amount:function(){return this.amount;},get_amount_str:function(){return this.amount.toFixed(this.pos.currency.decimals);},set_selected:function(selected){if(this.selected!==selected){this.selected=selected;this.trigger('change:selected',this);}},get_type:function(){return this.cashregister.journal.type},export_as_JSON:function(){return{name:instance.web.datetime_to_str(new Date()),statement_id:this.cashregister.id,account_id:this.cashregister.account_id[0],journal_id:this.cashregister.journal_id[0],amount:this.get_amount()};},export_for_printing:function(){return{amount:this.get_amount(),journal:this.cashregister.journal_id[1],};},});module.PaymentlineCollection=Backbone.Collection.extend({model:module.Paymentline,});module.Order=Backbone.Model.extend({initialize:function(attributes){Backbone.Model.prototype.initialize.apply(this,arguments);this.pos=attributes.pos;this.sequence_number=this.pos.pos_session.sequence_number++;this.uid=this.generateUniqueId();this.set({creationDate:new Date(),orderLines:new module.OrderlineCollection(),paymentLines:new module.PaymentlineCollection(),name:_t("Order ")+this.uid,client:null,});this.selected_orderline=undefined;this.selected_paymentline=undefined;this.screen_data={};this.receipt_type='receipt';this.temporary=attributes.temporary||false;return this;},is_empty:function(){return(this.get('orderLines').models.length===0);},generateUniqueId:function(){function zero_pad(num,size){var s=""+num;while(s.length<size){s="0"+s;}
return s;}
return zero_pad(this.pos.pos_session.id,5)+'-'+
zero_pad(this.pos.pos_session.login_number,3)+'-'+
zero_pad(this.sequence_number,4);},addOrderline:function(line){if(line.order){order.removeOrderline(line);}
line.order=this;this.get('orderLines').add(line);this.selectLine(this.getLastOrderline());},addProduct:function(product,options){options=options||{};var attr=JSON.parse(JSON.stringify(product));attr.pos=this.pos;attr.order=this;var line=new module.Orderline({},{pos:this.pos,order:this,product:product});if(options.quantity!==undefined){line.set_quantity(options.quantity);}
if(options.price!==undefined){line.set_unit_price(options.price);}
if(options.discount!==undefined){line.set_discount(options.discount);}
var last_orderline=this.getLastOrderline();if(last_orderline&&last_orderline.can_be_merged_with(line)&&options.merge!==false){last_orderline.merge(line);}else{this.get('orderLines').add(line);}
this.selectLine(this.getLastOrderline());},removeOrderline:function(line){this.get('orderLines').remove(line);this.selectLine(this.getLastOrderline());},getOrderline:function(id){var orderlines=this.get('orderLines').models;for(var i=0;i<orderlines.length;i++){if(orderlines[i].id===id){return orderlines[i];}}
return null;},getLastOrderline:function(){return this.get('orderLines').at(this.get('orderLines').length-1);},addPaymentline:function(cashregister){var paymentLines=this.get('paymentLines');var newPaymentline=new module.Paymentline({},{cashregister:cashregister,pos:this.pos});if(cashregister.journal.type!=='cash'){newPaymentline.set_amount(Math.max(this.getDueLeft(),0));}
paymentLines.add(newPaymentline);this.selectPaymentline(newPaymentline);},removePaymentline:function(line){if(this.selected_paymentline===line){this.selectPaymentline(undefined);}
this.get('paymentLines').remove(line);},getName:function(){return this.get('name');},getSubtotal:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_display_price();}),0);},getTotalTaxIncluded:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_price_with_tax();}),0);},getDiscountTotal:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+(orderLine.get_unit_price()*(orderLine.get_discount()/100)*orderLine.get_quantity());}),0);},getTotalTaxExcluded:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_price_without_tax();}),0);},getTax:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_tax();}),0);},getTaxDetails:function(){var details={};var fulldetails=[];this.get('orderLines').each(function(line){var ldetails=line.get_tax_details();for(var id in ldetails){if(ldetails.hasOwnProperty(id)){details[id]=(details[id]||0)+ldetails[id];}}});for(var id in details){if(details.hasOwnProperty(id)){fulldetails.push({amount:details[id],tax:this.pos.taxes_by_id[id],name:this.pos.taxes_by_id[id].name});}}
return fulldetails;},getPaidTotal:function(){return(this.get('paymentLines')).reduce((function(sum,paymentLine){return sum+paymentLine.get_amount();}),0);},getChange:function(){return this.getPaidTotal()-this.getTotalTaxIncluded();},getDueLeft:function(){return this.getTotalTaxIncluded()-this.getPaidTotal();},set_receipt_type:function(type){this.receipt_type=type;},get_receipt_type:function(){return this.receipt_type;},set_client:function(client){this.set('client',client);},get_client:function(){return this.get('client');},get_client_name:function(){var client=this.get('client');return client?client.name:"";},set_screen_data:function(key,value){if(arguments.length===2){this.screen_data[key]=value;}else if(arguments.length===1){for(key in arguments[0]){this.screen_data[key]=arguments[0][key];}}},get_screen_data:function(key){return this.screen_data[key];},export_for_printing:function(){var orderlines=[];this.get('orderLines').each(function(orderline){orderlines.push(orderline.export_for_printing());});var paymentlines=[];this.get('paymentLines').each(function(paymentline){paymentlines.push(paymentline.export_for_printing());});var client=this.get('client');var cashier=this.pos.cashier||this.pos.user;var company=this.pos.company;var shop=this.pos.shop;var date=new Date();return{orderlines:orderlines,paymentlines:paymentlines,subtotal:this.getSubtotal(),total_with_tax:this.getTotalTaxIncluded(),total_without_tax:this.getTotalTaxExcluded(),total_tax:this.getTax(),total_paid:this.getPaidTotal(),total_discount:this.getDiscountTotal(),tax_details:this.getTaxDetails(),change:this.getChange(),name:this.getName(),client:client?client.name:null,invoice_id:null,cashier:cashier?cashier.name:null,header:this.pos.config.receipt_header||'',footer:this.pos.config.receipt_footer||'',precision:{price:2,money:2,quantity:3,},date:{year:date.getFullYear(),month:date.getMonth(),date:date.getDate(),day:date.getDay(),hour:date.getHours(),minute:date.getMinutes(),isostring:date.toISOString(),localestring:date.toLocaleString(),},company:{email:company.email,website:company.website,company_registry:company.company_registry,contact_address:company.partner_id[1],vat:company.vat,name:company.name,phone:company.phone,logo:this.pos.company_logo_base64,},shop:{name:shop.name,},currency:this.pos.currency,};},export_as_JSON:function(){var orderLines,paymentLines;orderLines=[];(this.get('orderLines')).each(_.bind(function(item){return orderLines.push([0,0,item.export_as_JSON()]);},this));paymentLines=[];(this.get('paymentLines')).each(_.bind(function(item){return paymentLines.push([0,0,item.export_as_JSON()]);},this));return{name:this.getName(),amount_paid:this.getPaidTotal(),amount_total:this.getTotalTaxIncluded(),amount_tax:this.getTax(),amount_return:this.getChange(),lines:orderLines,statement_ids:paymentLines,pos_session_id:this.pos.pos_session.id,partner_id:this.get_client()?this.get_client().id:false,user_id:this.pos.cashier?this.pos.cashier.id:this.pos.user.id,uid:this.uid,sequence_number:this.sequence_number,};},getSelectedLine:function(){return this.selected_orderline;},selectLine:function(line){if(line){if(line!==this.selected_orderline){if(this.selected_orderline){this.selected_orderline.set_selected(false);}
this.selected_orderline=line;this.selected_orderline.set_selected(true);}}else{this.selected_orderline=undefined;}},deselectLine:function(){if(this.selected_orderline){this.selected_orderline.set_selected(false);this.selected_orderline=undefined;}},selectPaymentline:function(line){if(line!==this.selected_paymentline){if(this.selected_paymentline){this.selected_paymentline.set_selected(false);}
this.selected_paymentline=line;if(this.selected_paymentline){this.selected_paymentline.set_selected(true);}
this.trigger('change:selected_paymentline',this.selected_paymentline);}},});module.OrderCollection=Backbone.Collection.extend({model:module.Order,});module.NumpadState=Backbone.Model.extend({defaults:{buffer:"0",mode:"quantity"},appendNewChar:function(newChar){var oldBuffer;oldBuffer=this.get('buffer');if(oldBuffer==='0'){this.set({buffer:newChar});}else if(oldBuffer==='-0'){this.set({buffer:"-"+newChar});}else{this.set({buffer:(this.get('buffer'))+newChar});}
this.trigger('set_value',this.get('buffer'));},deleteLastChar:function(){if(this.get('buffer')===""){if(this.get('mode')==='quantity'){this.trigger('set_value','remove');}else{this.trigger('set_value',this.get('buffer'));}}else{var newBuffer=this.get('buffer').slice(0,-1)||"";this.set({buffer:newBuffer});this.trigger('set_value',this.get('buffer'));}},switchSign:function(){var oldBuffer;oldBuffer=this.get('buffer');this.set({buffer:oldBuffer[0]==='-'?oldBuffer.substr(1):"-"+oldBuffer});this.trigger('set_value',this.get('buffer'));},changeMode:function(newMode){this.set({buffer:"0",mode:newMode});},reset:function(){this.set({buffer:"0",mode:"quantity"});},resetValue:function(){this.set({buffer:'0'});},});};

/* /point_of_sale/static/src/js/widget_base.js defined in bundle 'web.assets_backend' */
function openerp_pos_basewidget(instance,module){var round_di=instance.web.round_decimals;var round_pr=instance.web.round_precision
module.PosBaseWidget=instance.web.Widget.extend({init:function(parent,options){this._super(parent);options=options||{};this.pos=options.pos||(parent?parent.pos:undefined);this.pos_widget=options.pos_widget||(parent?parent.pos_widget:undefined);},format_currency:function(amount,precision){var currency=(this.pos&&this.pos.currency)?this.pos.currency:{symbol:'$',position:'after',rounding:0.01,decimals:2};var decimals=currency.decimals;if(precision&&(typeof this.pos.dp[precision])!==undefined){decimals=this.pos.dp[precision];}
if(typeof amount==='number'){amount=round_di(amount,decimals).toFixed(decimals);}
if(currency.position==='after'){return amount+' '+(currency.symbol||'');}else{return(currency.symbol||'')+' '+amount;}},show:function(){this.$el.removeClass('oe_hidden');},hide:function(){this.$el.addClass('oe_hidden');},format_pr:function(value,precision){var decimals=precision>0?Math.max(0,Math.ceil(Math.log(1.0/precision)/Math.log(10))):0;return value.toFixed(decimals);},});};

/* /point_of_sale/static/src/js/widget_keyboard.js defined in bundle 'web.assets_backend' */
function openerp_pos_keyboard(instance,module){module.OnscreenKeyboardWidget=instance.web.Widget.extend({template:'OnscreenKeyboardSimple',init:function(parent,options){var self=this;this._super(parent,options);options=options||{};this.keyboard_model=options.keyboard_model||'full';if(this.keyboard_model==='full'){this.template='OnscreenKeyboardFull';}
this.input_selector=options.input_selector||'.searchbox input';this.$target=null;this.capslock=false;this.shift=false;this.numlock=false;},connect:function(target){var self=this;this.$target=$(target);this.$target.focus(function(){self.show();});},generateEvent:function(type,key){var event=document.createEvent("KeyboardEvent");var initMethod=event.initKeyboardEvent?'initKeyboardEvent':'initKeyEvent';event[initMethod](type,true,true,window,false,false,false,false,((typeof key.code==='undefined')?key.char.charCodeAt(0):key.code),((typeof key.char==='undefined')?String.fromCharCode(key.code):key.char));return event;},writeCharacter:function(character){var input=this.$target[0];input.dispatchEvent(this.generateEvent('keydown',{char:character}));if(character!=='\n'){input.value+=character;}
input.dispatchEvent(this.generateEvent('keyup',{char:character}));},deleteCharacter:function(){var input=this.$target[0];input.dispatchEvent(this.generateEvent('keydown',{code:8}));input.value=input.value.substr(0,input.value.length-1);input.dispatchEvent(this.generateEvent('keyup',{code:8}));},deleteAllCharacters:function(){var input=this.$target[0];if(input.value){input.dispatchEvent(this.generateEvent('keydown',{code:8}));input.value="";input.dispatchEvent(this.generateEvent('keyup',{code:8}));}},show:function(){$('.keyboard_frame').show().css({'height':'235px'});},hide:function(){$('.keyboard_frame').css({'height':'0'}).hide();this.reset();},toggleShift:function(){$('.letter').toggleClass('uppercase');$('.symbol span').toggle();self.shift=(self.shift===true)?false:true;self.capslock=false;},toggleCapsLock:function(){$('.letter').toggleClass('uppercase');self.capslock=true;},toggleNumLock:function(){$('.symbol span').toggle();$('.numlock span').toggle();self.numlock=(self.numlock===true)?false:true;},removeShift:function(){if(self.shift===true){$('.symbol span').toggle();if(this.capslock===false)$('.letter').toggleClass('uppercase');self.shift=false;}},reset:function(){if(this.shift){this.toggleShift();}
if(this.capslock){this.toggleCapsLock();}
if(this.numlock){this.toggleNumLock();}},start:function(){var self=this;$('.close_button').click(function(){self.deleteAllCharacters();self.hide();});$('.keyboard li').click(function(){var $this=$(this),character=$this.html();if($this.hasClass('left-shift')||$this.hasClass('right-shift')){self.toggleShift();return false;}
if($this.hasClass('capslock')){self.toggleCapsLock();return false;}
if($this.hasClass('delete')){self.deleteCharacter();return false;}
if($this.hasClass('numlock')){self.toggleNumLock();return false;}
if($this.hasClass('symbol'))character=$('span:visible',$this).html();if($this.hasClass('space'))character=' ';if($this.hasClass('tab'))character="\t";if($this.hasClass('return'))character="\n";if($this.hasClass('uppercase'))character=character.toUpperCase();self.removeShift();self.writeCharacter(character);});},});};

/* /point_of_sale/static/src/js/widgets.js defined in bundle 'web.assets_backend' */
function openerp_pos_widgets(instance,module){var QWeb=instance.web.qweb;var _t=instance.web._t;module.DomCache=instance.web.Class.extend({init:function(options){options=options||{};this.max_size=options.max_size||2000;this.cache={};this.access_time={};this.size=0;},cache_node:function(key,node){var cached=this.cache[key];this.cache[key]=node;this.access_time[key]=new Date().getTime();if(!cached){this.size++;while(this.size>=this.max_size){var oldest_key=null;var oldest_time=new Date().getTime();for(var key in this.cache){var time=this.access_time[key];if(time<=oldest_time){oldest_time=time;oldest_key=key;}}
if(oldest_key){delete this.cache[oldest_key];delete this.access_time[oldest_key];}
this.size--;}}
return node;},get_node:function(key){var cached=this.cache[key];if(cached){this.access_time[key]=new Date().getTime();}
return cached;},});module.NumpadWidget=module.PosBaseWidget.extend({template:'NumpadWidget',init:function(parent,options){this._super(parent);this.state=new module.NumpadState();window.numpadstate=this.state;var self=this;},start:function(){this.state.bind('change:mode',this.changedMode,this);this.changedMode();this.$el.find('.numpad-backspace').click(_.bind(this.clickDeleteLastChar,this));this.$el.find('.numpad-minus').click(_.bind(this.clickSwitchSign,this));this.$el.find('.number-char').click(_.bind(this.clickAppendNewChar,this));this.$el.find('.mode-button').click(_.bind(this.clickChangeMode,this));},clickDeleteLastChar:function(){return this.state.deleteLastChar();},clickSwitchSign:function(){return this.state.switchSign();},clickAppendNewChar:function(event){var newChar;newChar=event.currentTarget.innerText||event.currentTarget.textContent;return this.state.appendNewChar(newChar);},clickChangeMode:function(event){var newMode=event.currentTarget.attributes['data-mode'].nodeValue;return this.state.changeMode(newMode);},changedMode:function(){var mode=this.state.get('mode');$('.selected-mode').removeClass('selected-mode');$(_.str.sprintf('.mode-button[data-mode="%s"]',mode),this.$el).addClass('selected-mode');},});module.PaypadWidget=module.PosBaseWidget.extend({template:'PaypadWidget',renderElement:function(){var self=this;this._super();_.each(this.pos.cashregisters,function(cashregister){var button=new module.PaypadButtonWidget(self,{pos:self.pos,pos_widget:self.pos_widget,cashregister:cashregister,});button.appendTo(self.$el);});}});module.PaypadButtonWidget=module.PosBaseWidget.extend({template:'PaypadButtonWidget',init:function(parent,options){this._super(parent,options);this.cashregister=options.cashregister;},renderElement:function(){var self=this;this._super();this.$el.click(function(){if(self.pos.get('selectedOrder').get('screen')==='receipt'){console.warn('TODO should not get there...?');return;}
self.pos.get('selectedOrder').addPaymentline(self.cashregister);self.pos_widget.screen_selector.set_current_screen('payment');});},});module.OrderWidget=module.PosBaseWidget.extend({template:'OrderWidget',init:function(parent,options){var self=this;this._super(parent,options);this.editable=false;this.pos.bind('change:selectedOrder',this.change_selected_order,this);this.line_click_handler=function(event){if(!self.editable){return;}
self.pos.get('selectedOrder').selectLine(this.orderline);self.pos_widget.numpad.state.reset();};this.client_change_handler=function(event){self.update_summary();}
this.bind_order_events();},enable_numpad:function(){this.disable_numpad();this.numpad_state=this.pos_widget.numpad.state;if(this.numpad_state){this.numpad_state.reset();this.numpad_state.bind('set_value',this.set_value,this);}},disable_numpad:function(){if(this.numpad_state){this.numpad_state.unbind('set_value',this.set_value);this.numpad_state.reset();}},set_editable:function(editable){this.editable=editable;if(editable){this.enable_numpad();}else{this.disable_numpad();this.pos.get('selectedOrder').deselectLine();}},set_value:function(val){var order=this.pos.get('selectedOrder');if(this.editable&&order.getSelectedLine()){var mode=this.numpad_state.get('mode');if(mode==='quantity'){order.getSelectedLine().set_quantity(val);}else if(mode==='discount'){order.getSelectedLine().set_discount(val);}else if(mode==='price'){order.getSelectedLine().set_unit_price(val);}}},change_selected_order:function(){this.bind_order_events();this.renderElement();},bind_order_events:function(){var order=this.pos.get('selectedOrder');order.unbind('change:client',this.client_change_handler);order.bind('change:client',this.client_change_handler);var lines=order.get('orderLines');lines.unbind();lines.bind('add',function(){this.numpad_state.reset();this.renderElement(true);},this);lines.bind('remove',function(line){this.remove_orderline(line);this.numpad_state.reset();this.update_summary();},this);lines.bind('change',function(line){this.rerender_orderline(line);this.update_summary();},this);},render_orderline:function(orderline){var el_str=openerp.qweb.render('Orderline',{widget:this,line:orderline});var el_node=document.createElement('div');el_node.innerHTML=_.str.trim(el_str);el_node=el_node.childNodes[0];el_node.orderline=orderline;el_node.addEventListener('click',this.line_click_handler);orderline.node=el_node;return el_node;},remove_orderline:function(order_line){if(this.pos.get('selectedOrder').get('orderLines').length===0){this.renderElement();}else{order_line.node.parentNode.removeChild(order_line.node);}},rerender_orderline:function(order_line){var node=order_line.node;var replacement_line=this.render_orderline(order_line);node.parentNode.replaceChild(replacement_line,node);},replace:function($target){this.renderElement();var target=$target[0];target.parentNode.replaceChild(this.el,target);},renderElement:function(scrollbottom){this.pos_widget.numpad.state.reset();var order=this.pos.get('selectedOrder');var orderlines=order.get('orderLines').models;var el_str=openerp.qweb.render('OrderWidget',{widget:this,order:order,orderlines:orderlines});var el_node=document.createElement('div');el_node.innerHTML=_.str.trim(el_str);el_node=el_node.childNodes[0];var list_container=el_node.querySelector('.orderlines');for(var i=0,len=orderlines.length;i<len;i++){var orderline=this.render_orderline(orderlines[i]);list_container.appendChild(orderline);}
if(this.el&&this.el.parentNode){this.el.parentNode.replaceChild(el_node,this.el);}
this.el=el_node;this.update_summary();if(scrollbottom){this.el.querySelector('.order-scroller').scrollTop=100*orderlines.length;}},update_summary:function(){var order=this.pos.get('selectedOrder');var total=order?order.getTotalTaxIncluded():0;var taxes=order?total-order.getTotalTaxExcluded():0;this.el.querySelector('.summary .total > .value').textContent=this.format_currency(total);this.el.querySelector('.summary .total .subentry .value').textContent=this.format_currency(taxes);},});module.OrderButtonWidget=module.PosBaseWidget.extend({template:'OrderButtonWidget',init:function(parent,options){this._super(parent,options);var self=this;this.order=options.order;this.order.bind('destroy',this.destroy,this);this.order.bind('change',this.renderElement,this);this.pos.bind('change:selectedOrder',this.renderElement,this);},renderElement:function(){this.selected=(this.pos.get('selectedOrder')===this.order)
this._super();var self=this;this.$el.click(function(){if(self.pos.get('selectedOrder')===self.order){var ss=self.pos.pos_widget.screen_selector;if(ss.get_current_screen()==='clientlist'){ss.back();}else if(ss.get_current_screen()!=='receipt'){ss.set_current_screen('clientlist');}}else{self.selectOrder();}});if(this.selected){this.$el.addClass('selected');}},selectOrder:function(event){this.pos.set({selectedOrder:this.order});},destroy:function(){this.order.unbind('destroy',this.destroy,this);this.order.unbind('change',this.renderElement,this);this.pos.unbind('change:selectedOrder',this.renderElement,this);this._super();},});module.ActionButtonWidget=instance.web.Widget.extend({template:'ActionButtonWidget',icon_template:'ActionButtonWidgetWithIcon',init:function(parent,options){this._super(parent,options);this.label=options.label||'button';this.rightalign=options.rightalign||false;this.click_action=options.click;this.disabled=options.disabled||false;if(options.icon){this.icon=options.icon;this.template=this.icon_template;}},set_disabled:function(disabled){if(this.disabled!=disabled){this.disabled=!!disabled;this.renderElement();}},renderElement:function(){this._super();if(this.click_action&&!this.disabled){this.$el.click(_.bind(this.click_action,this));}},});module.ActionBarWidget=instance.web.Widget.extend({template:'ActionBarWidget',init:function(parent,options){this._super(parent,options);this.button_list=[];this.buttons={};this.visibility={};},set_element_visible:function(element,visible,action){if(visible!=this.visibility[element]){this.visibility[element]=!!visible;if(visible){this.$('.'+element).removeClass('oe_hidden');}else{this.$('.'+element).addClass('oe_hidden');}}
if(visible&&action){this.action[element]=action;this.$('.'+element).off('click').click(action);}},set_button_disabled:function(name,disabled){var b=this.buttons[name];if(b){b.set_disabled(disabled);}},destroy_buttons:function(){for(var i=0;i<this.button_list.length;i++){this.button_list[i].destroy();}
this.button_list=[];this.buttons={};return this;},get_button_count:function(){return this.button_list.length;},add_new_button:function(button_options){var button=new module.ActionButtonWidget(this,button_options);this.button_list.push(button);if(button_options.name){this.buttons[button_options.name]=button;}
button.appendTo(this.$('.pos-actionbar-button-list'));return button;},show:function(){this.$el.removeClass('oe_hidden');},hide:function(){this.$el.addClass('oe_hidden');},});module.ProductCategoriesWidget=module.PosBaseWidget.extend({template:'ProductCategoriesWidget',init:function(parent,options){var self=this;this._super(parent,options);this.product_type=options.product_type||'all';this.onlyWeightable=options.onlyWeightable||false;this.category=this.pos.root_category;this.breadcrumb=[];this.subcategories=[];this.product_list_widget=options.product_list_widget||null;this.category_cache=new module.DomCache();this.set_category();this.switch_category_handler=function(event){self.set_category(self.pos.db.get_category_by_id(Number(this.dataset['categoryId'])));self.renderElement();};this.clear_search_handler=function(event){self.clear_search();};var search_timeout=null;this.search_handler=function(event){clearTimeout(search_timeout);var query=this.value;search_timeout=setTimeout(function(){self.perform_search(self.category,query,event.which===13);},70);};},set_category:function(category){var db=this.pos.db;if(!category){this.category=db.get_category_by_id(db.root_category_id);}else{this.category=category;}
this.breadcrumb=[];var ancestors_ids=db.get_category_ancestors_ids(this.category.id);for(var i=1;i<ancestors_ids.length;i++){this.breadcrumb.push(db.get_category_by_id(ancestors_ids[i]));}
if(this.category.id!==db.root_category_id){this.breadcrumb.push(this.category);}
this.subcategories=db.get_category_by_id(db.get_category_childs_ids(this.category.id));},get_image_url:function(category){return window.location.origin+'/web/binary/image?model=pos.category&field=image_medium&id='+category.id;},render_category:function(category,with_image){var cached=this.category_cache.get_node(category.id);if(!cached){if(with_image){var image_url=this.get_image_url(category);var category_html=QWeb.render('CategoryButton',{widget:this,category:category,image_url:this.get_image_url(category),});category_html=_.str.trim(category_html);var category_node=document.createElement('div');category_node.innerHTML=category_html;category_node=category_node.childNodes[0];}else{var category_html=QWeb.render('CategorySimpleButton',{widget:this,category:category,});category_html=_.str.trim(category_html);var category_node=document.createElement('div');category_node.innerHTML=category_html;category_node=category_node.childNodes[0];}
this.category_cache.cache_node(category.id,category_node);return category_node;}
return cached;},replace:function($target){this.renderElement();var target=$target[0];target.parentNode.replaceChild(this.el,target);},renderElement:function(){var self=this;var el_str=openerp.qweb.render(this.template,{widget:this});var el_node=document.createElement('div');el_node.innerHTML=el_str;el_node=el_node.childNodes[1];if(this.el&&this.el.parentNode){this.el.parentNode.replaceChild(el_node,this.el);}
this.el=el_node;var hasimages=false;for(var i=0;i<this.subcategories.length;i++){if(this.subcategories[i].image){hasimages=true;break;}}
var list_container=el_node.querySelector('.category-list');if(list_container){if(!hasimages){list_container.classList.add('simple');}else{list_container.classList.remove('simple');}
for(var i=0,len=this.subcategories.length;i<len;i++){list_container.appendChild(this.render_category(this.subcategories[i],hasimages));};}
var buttons=el_node.querySelectorAll('.js-category-switch');for(var i=0;i<buttons.length;i++){buttons[i].addEventListener('click',this.switch_category_handler);}
var products=this.pos.db.get_product_by_category(this.category.id);this.product_list_widget.set_product_list(products);this.el.querySelector('.searchbox input').addEventListener('keyup',this.search_handler);this.el.querySelector('.search-clear').addEventListener('click',this.clear_search_handler);if(this.pos.config.iface_vkeyboard&&this.pos_widget.onscreen_keyboard){this.pos_widget.onscreen_keyboard.connect($(this.el.querySelector('.searchbox input')));}},reset_category:function(){this.set_category();this.renderElement();},clear_search:function(){var products=this.pos.db.get_product_by_category(this.category.id);this.product_list_widget.set_product_list(products);var input=this.el.querySelector('.searchbox input');input.value='';input.focus();},perform_search:function(category,query,buy_result){if(query){var products=this.pos.db.search_product_in_category(category.id,query)
if(buy_result&&products.length===1){this.pos.get('selectedOrder').addProduct(products[0]);this.clear_search();}else{this.product_list_widget.set_product_list(products);}}else{var products=this.pos.db.get_product_by_category(this.category.id);this.product_list_widget.set_product_list(products);}},});module.ProductListWidget=module.PosBaseWidget.extend({template:'ProductListWidget',init:function(parent,options){var self=this;this._super(parent,options);this.model=options.model;this.productwidgets=[];this.weight=options.weight||0;this.show_scale=options.show_scale||false;this.next_screen=options.next_screen||false;this.click_product_handler=function(event){var product=self.pos.db.get_product_by_id(this.dataset['productId']);options.click_product_action(product);};this.product_list=options.product_list||[];this.product_cache=new module.DomCache();},set_product_list:function(product_list){this.product_list=product_list;this.renderElement();},get_product_image_url:function(product){return window.location.origin+'/web/binary/image?model=product.product&field=image_medium&id='+product.id;},replace:function($target){this.renderElement();var target=$target[0];target.parentNode.replaceChild(this.el,target);},render_product:function(product){var cached=this.product_cache.get_node(product.id);if(!cached){var image_url=this.get_product_image_url(product);var product_html=QWeb.render('Product',{widget:this,product:product,image_url:this.get_product_image_url(product),});var product_node=document.createElement('div');product_node.innerHTML=product_html;product_node=product_node.childNodes[1];this.product_cache.cache_node(product.id,product_node);return product_node;}
return cached;},renderElement:function(){var self=this;var el_str=openerp.qweb.render(this.template,{widget:this});var el_node=document.createElement('div');el_node.innerHTML=el_str;el_node=el_node.childNodes[1];if(this.el&&this.el.parentNode){this.el.parentNode.replaceChild(el_node,this.el);}
this.el=el_node;var list_container=el_node.querySelector('.product-list');for(var i=0,len=this.product_list.length;i<len;i++){var product_node=this.render_product(this.product_list[i]);product_node.addEventListener('click',this.click_product_handler);list_container.appendChild(product_node);};},});module.UsernameWidget=module.PosBaseWidget.extend({template:'UsernameWidget',init:function(parent,options){var options=options||{};this._super(parent,options);this.mode=options.mode||'cashier';},set_user_mode:function(mode){this.mode=mode;this.refresh();},refresh:function(){this.renderElement();},get_name:function(){var user;if(this.mode==='cashier'){user=this.pos.cashier||this.pos.user;}else{user=this.pos.get('selectedOrder').get_client()||this.pos.user;}
if(user){return user.name;}else{return"";}},});module.HeaderButtonWidget=module.PosBaseWidget.extend({template:'HeaderButtonWidget',init:function(parent,options){options=options||{};this._super(parent,options);this.action=options.action;this.label=options.label;},renderElement:function(){var self=this;this._super();if(this.action){this.$el.click(function(){self.action();});}},show:function(){this.$el.removeClass('oe_hidden');},hide:function(){this.$el.addClass('oe_hidden');},});module.DebugWidget=module.PosBaseWidget.extend({template:"DebugWidget",eans:{admin_badge:'0410100000006',client_badge:'0420200000004',invalid_ean:'1232456',soda_33cl:'5449000000996',oranges_kg:'2100002031410',lemon_price:'2301000001560',unknown_product:'9900000000004',},events:['open_cashbox','print_receipt','scale_read',],minimized:false,init:function(parent,options){this._super(parent,options);var self=this;this.minimized=false;this.dragging=false;this.dragpos={x:0,y:0};function eventpos(event){if(event.touches&&event.touches[0]){return{x:event.touches[0].screenX,y:event.touches[0].screenY};}else{return{x:event.screenX,y:event.screenY};}}
this.dragend_handler=function(event){self.dragging=false;};this.dragstart_handler=function(event){self.dragging=true;self.dragpos=eventpos(event);};this.dragmove_handler=function(event){if(self.dragging){var top=this.offsetTop;var left=this.offsetLeft;var pos=eventpos(event);var dx=pos.x-self.dragpos.x;var dy=pos.y-self.dragpos.y;self.dragpos=pos;this.style.right='auto';this.style.bottom='auto';this.style.left=left+dx+'px';this.style.top=top+dy+'px';}
event.preventDefault();event.stopPropagation();};},start:function(){var self=this;this.el.addEventListener('mouseleave',this.dragend_handler);this.el.addEventListener('mouseup',this.dragend_handler);this.el.addEventListener('touchend',this.dragend_handler);this.el.addEventListener('touchcancel',this.dragend_handler);this.el.addEventListener('mousedown',this.dragstart_handler);this.el.addEventListener('touchstart',this.dragstart_handler);this.el.addEventListener('mousemove',this.dragmove_handler);this.el.addEventListener('touchmove',this.dragmove_handler);this.$('.toggle').click(function(){var content=self.$('.content');var bg=self.$el;if(!self.minimized){content.animate({'height':'0'},200);}else{content.css({'height':'auto'});}
self.minimized=!self.minimized;});this.$('.button.set_weight').click(function(){var kg=Number(self.$('input.weight').val());if(!isNaN(kg)){self.pos.proxy.debug_set_weight(kg);}});this.$('.button.reset_weight').click(function(){self.$('input.weight').val('');self.pos.proxy.debug_reset_weight();});this.$('.button.custom_ean').click(function(){var ean=self.pos.barcode_reader.sanitize_ean(self.$('input.ean').val()||'0');self.$('input.ean').val(ean);self.pos.barcode_reader.scan(ean);});this.$('.button.reference').click(function(){self.pos.barcode_reader.scan(self.$('input.ean').val());});this.$('.button.show_orders').click(function(){self.pos.pos_widget.screen_selector.show_popup('unsent-orders');});this.$('.button.delete_orders').click(function(){self.pos.pos_widget.screen_selector.show_popup('confirm',{message:_t('Delete Unsent Orders ?'),comment:_t('This operation will permanently destroy all unsent orders from the local storage. You will lose all the data. This operation cannot be undone.'),confirm:function(){self.pos.db.remove_all_orders();self.pos.set({synch:{state:'connected',pending:0}});},});});_.each(this.eans,function(ean,name){self.$('.button.'+name).click(function(){self.$('input.ean').val(ean);self.pos.barcode_reader.scan(ean);});});_.each(this.events,function(name){self.pos.proxy.add_notification(name,function(){self.$('.event.'+name).stop().clearQueue().css({'background-color':'#6CD11D'});self.$('.event.'+name).animate({'background-color':'#1E1E1E'},2000);});});},});module.StatusWidget=module.PosBaseWidget.extend({status:['connected','connecting','disconnected','warning'],set_status:function(status,msg){var self=this;for(var i=0;i<this.status.length;i++){this.$('.js_'+this.status[i]).addClass('oe_hidden');}
this.$('.js_'+status).removeClass('oe_hidden');if(msg){this.$('.js_msg').removeClass('oe_hidden').html(msg);}else{this.$('.js_msg').addClass('oe_hidden').html('');}},});module.SynchNotificationWidget=module.StatusWidget.extend({template:'SynchNotificationWidget',start:function(){var self=this;this.pos.bind('change:synch',function(pos,synch){self.set_status(synch.state,synch.pending);});this.$el.click(function(){self.pos.push_order();});},});module.ProxyStatusWidget=module.StatusWidget.extend({template:'ProxyStatusWidget',set_smart_status:function(status){if(status.status==='connected'){var warning=false;var msg=''
if(this.pos.config.iface_scan_via_proxy){var scanner=status.drivers.scanner?status.drivers.scanner.status:false;if(scanner!='connected'&&scanner!='connecting'){warning=true;msg+=_t('Scanner');}}
if(this.pos.config.iface_print_via_proxy||this.pos.config.iface_cashdrawer){var printer=status.drivers.escpos?status.drivers.escpos.status:false;if(printer!='connected'&&printer!='connecting'){warning=true;msg=msg?msg+' & ':msg;msg+=_t('Printer');}}
if(this.pos.config.iface_electronic_scale){var scale=status.drivers.scale?status.drivers.scale.status:false;if(scale!='connected'&&scale!='connecting'){warning=true;msg=msg?msg+' & ':msg;msg+=_t('Scale');}}
msg=msg?msg+' '+_t('Offline'):msg;this.set_status(warning?'warning':'connected',msg);}else{this.set_status(status.status,'');}},start:function(){var self=this;this.set_smart_status(this.pos.proxy.get('status'));this.pos.proxy.on('change:status',this,function(eh,status){self.set_smart_status(status.newValue);});this.$el.click(function(){self.pos.connect_to_proxy();});},});module.PosWidget=module.PosBaseWidget.extend({template:'PosWidget',init:function(){this._super(arguments[0],{});this.pos=new module.PosModel(this.session,{pos_widget:this});this.pos_widget=this;this.numpad_visible=true;this.leftpane_visible=true;this.leftpane_width='440px';this.cashier_controls_visible=true;FastClick.attach(document.body);},disable_rubberbanding:function(){document.body.addEventListener('touchmove',function(event){var node=event.target;while(node){if(node.classList&&node.classList.contains('touch-scrollable')){return;}
node=node.parentNode;}
event.preventDefault();});},start:function(){var self=this;return self.pos.ready.done(function(){$(document).off();$(window).off();$('html').off();$('body').off();$(self.$el).parent().off();$('document').off();$('.oe_web_client').off();$('.openerp_webclient_container').off();self.renderElement();self.$('.neworder-button').click(function(){self.pos.add_new_order();});self.$('.deleteorder-button').click(function(){if(!self.pos.get('selectedOrder').is_empty()){self.screen_selector.show_popup('confirm',{message:_t('Destroy Current Order ?'),comment:_t('You will lose any data associated with the current order'),confirm:function(){self.pos.delete_current_order();},});}else{self.pos.delete_current_order();}});self.pos.get('orders').bind('add',function(new_order){var new_order_button=new module.OrderButtonWidget(null,{order:new_order,pos:self.pos});new_order_button.appendTo(this.$('.orders'));new_order_button.selectOrder();},self);self.pos.add_new_order();self.build_widgets();if(self.pos.config.iface_big_scrollbars){self.$el.addClass('big-scrollbars');}
self.screen_selector.set_default_screen();self.pos.barcode_reader.connect();instance.webclient.set_content_full_screen(true);self.$('.loader').animate({opacity:0},1500,'swing',function(){self.$('.loader').addClass('oe_hidden');});self.pos.push_order();}).fail(function(err){self.loading_error(err);});},loading_error:function(err){var self=this;var message=err.message;var comment=err.stack;if(err.message==='XmlHttpRequestError '){message='Network Failure (XmlHttpRequestError)';comment='The Point of Sale could not be loaded due to a network problem.\n Please check your internet connection.';}else if(err.message==='OpenERP Server Error'){message=err.data.message;comment=err.data.debug;}
if(typeof comment!=='string'){comment='Traceback not available.';}
var popup=$(QWeb.render('ErrorTracebackPopupWidget',{widget:{message:message,comment:comment},}));popup.find('.button').click(function(){self.close();});popup.css({zindex:9001});popup.appendTo(this.$el);},loading_progress:function(fac){this.$('.loader .loader-feedback').removeClass('oe_hidden');this.$('.loader .progress').css({'width':''+Math.floor(fac*100)+'%'});},loading_message:function(msg,progress){this.$('.loader .loader-feedback').removeClass('oe_hidden');this.$('.loader .message').text(msg);if(typeof progress!=='undefined'){this.loading_progress(progress);}},loading_skip:function(callback){if(callback){this.$('.loader .loader-feedback').removeClass('oe_hidden');this.$('.loader .button.skip').removeClass('oe_hidden');this.$('.loader .button.skip').off('click');this.$('.loader .button.skip').click(callback);}else{this.$('.loader .button.skip').addClass('oe_hidden');}},build_widgets:function(){var self=this;this.product_screen=new module.ProductScreenWidget(this,{});this.product_screen.appendTo(this.$('.screens'));this.receipt_screen=new module.ReceiptScreenWidget(this,{});this.receipt_screen.appendTo(this.$('.screens'));this.payment_screen=new module.PaymentScreenWidget(this,{});this.payment_screen.appendTo(this.$('.screens'));this.clientlist_screen=new module.ClientListScreenWidget(this,{});this.clientlist_screen.appendTo(this.$('.screens'));this.scale_screen=new module.ScaleScreenWidget(this,{});this.scale_screen.appendTo(this.$('.screens'));this.error_popup=new module.ErrorPopupWidget(this,{});this.error_popup.appendTo(this.$el);this.error_barcode_popup=new module.ErrorBarcodePopupWidget(this,{});this.error_barcode_popup.appendTo(this.$el);this.error_traceback_popup=new module.ErrorTracebackPopupWidget(this,{});this.error_traceback_popup.appendTo(this.$el);this.confirm_popup=new module.ConfirmPopupWidget(this,{});this.confirm_popup.appendTo(this.$el);this.unsent_orders_popup=new module.UnsentOrdersPopupWidget(this,{});this.unsent_orders_popup.appendTo(this.$el);this.close_button=new module.HeaderButtonWidget(this,{label:_t('Close'),action:function(){var self=this;if(!this.confirmed){this.$el.addClass('confirm');this.$el.text(_t('Confirm'));this.confirmed=setTimeout(function(){self.$el.removeClass('confirm');self.$el.text(_t('Close'));self.confirmed=false;},2000);}else{clearTimeout(this.confirmed);this.pos_widget.close();}},});this.close_button.appendTo(this.$('.pos-rightheader'));this.notification=new module.SynchNotificationWidget(this,{});this.notification.appendTo(this.$('.pos-rightheader'));if(this.pos.config.use_proxy){this.proxy_status=new module.ProxyStatusWidget(this,{});this.proxy_status.appendTo(this.$('.pos-rightheader'));}
this.username=new module.UsernameWidget(this,{});this.username.replace(this.$('.placeholder-UsernameWidget'));this.action_bar=new module.ActionBarWidget(this);this.action_bar.replace(this.$(".placeholder-RightActionBar"));this.paypad=new module.PaypadWidget(this,{});this.paypad.replace(this.$('.placeholder-PaypadWidget'));this.numpad=new module.NumpadWidget(this);this.numpad.replace(this.$('.placeholder-NumpadWidget'));this.order_widget=new module.OrderWidget(this,{});this.order_widget.replace(this.$('.placeholder-OrderWidget'));this.onscreen_keyboard=new module.OnscreenKeyboardWidget(this,{'keyboard_model':'simple'});this.onscreen_keyboard.replace(this.$('.placeholder-OnscreenKeyboardWidget'));this.screen_selector=new module.ScreenSelector({pos:this.pos,screen_set:{'products':this.product_screen,'payment':this.payment_screen,'scale':this.scale_screen,'receipt':this.receipt_screen,'clientlist':this.clientlist_screen,},popup_set:{'error':this.error_popup,'error-barcode':this.error_barcode_popup,'error-traceback':this.error_traceback_popup,'confirm':this.confirm_popup,'unsent-orders':this.unsent_orders_popup,},default_screen:'products',default_mode:'cashier',});if(this.pos.debug){this.debug_widget=new module.DebugWidget(this);this.debug_widget.appendTo(this.$('.pos-content'));}
this.disable_rubberbanding();},changed_pending_operations:function(){var self=this;this.synch_notification.on_change_nbr_pending(self.pos.get('nbr_pending_operations').length);},set_numpad_visible:function(visible){if(visible!==this.numpad_visible){this.numpad_visible=visible;if(visible){this.numpad.show();this.paypad.show();}else{this.numpad.hide();this.paypad.hide();}}},set_leftpane_visible:function(visible){if(visible!==this.leftpane_visible){this.leftpane_visible=visible;if(visible){this.$('.pos-leftpane').removeClass('oe_hidden');this.$('.rightpane').css({'left':this.leftpane_width});}else{this.$('.pos-leftpane').addClass('oe_hidden');this.$('.rightpane').css({'left':'0px'});}}},close:function(){var self=this;function close(){self.pos.push_order().then(function(){return new instance.web.Model("ir.model.data").get_func("search_read")([['name','=','action_client_pos_menu']],['res_id']).pipe(function(res){window.location='/web#action='+res[0]['res_id'];},function(err,event){event.preventDefault();self.screen_selector.show_popup('error',{'message':_t('Could not close the point of sale.'),'comment':_t('Your internet connection is probably down.'),});self.close_button.renderElement();});});}
var draft_order=_.find(self.pos.get('orders').models,function(order){return order.get('orderLines').length!==0&&order.get('paymentLines').length===0;});if(draft_order){if(confirm(_t("Pending orders will be lost.\nAre you sure you want to leave this session?"))){close();}}else{close();}},destroy:function(){this.pos.destroy();instance.webclient.set_content_full_screen(false);this._super();}});};

/* /point_of_sale/static/src/js/devices.js defined in bundle 'web.assets_backend' */
function openerp_pos_devices(instance,module){var _t=instance.web._t;module.JobQueue=function(){var queue=[];var running=false;var scheduled_end_time=0;var end_of_queue=(new $.Deferred()).resolve();var stoprepeat=false;var run=function(){if(end_of_queue.state()==='resolved'){end_of_queue=new $.Deferred();}
if(queue.length>0){running=true;var job=queue[0];if(!job.opts.repeat||stoprepeat){queue.shift();stoprepeat=false;}
scheduled_end_time=(new Date()).getTime()+(job.opts.duration||0);var def=job.fun()||(new $.Deferred()).resolve();def.always(function(){setTimeout(function(){run();},Math.max(0,scheduled_end_time-(new Date()).getTime()));});}else{running=false;scheduled_end_time=0;end_of_queue.resolve();}};this.schedule=function(fun,opts){queue.push({fun:fun,opts:opts||{}});if(!running){run();}}
this.clear=function(){queue=_.filter(queue,function(job){job.opts.important===true});};this.stoprepeat=function(){stoprepeat=true;};this.finished=function(){return end_of_queue;}};module.ProxyDevice=instance.web.Class.extend(openerp.PropertiesMixin,{init:function(parent,options){openerp.PropertiesMixin.init.call(this,parent);var self=this;options=options||{};url=options.url||'http://localhost:8069';this.pos=parent;this.weighting=false;this.debug_weight=0;this.use_debug_weight=false;this.paying=false;this.default_payment_status={status:'waiting',message:'',payment_method:undefined,receipt_client:undefined,receipt_shop:undefined,};this.custom_payment_status=this.default_payment_status;this.receipt_queue=[];this.notifications={};this.bypass_proxy=false;this.connection=null;this.host='';this.keptalive=false;this.set('status',{});this.set_connection_status('disconnected');this.on('change:status',this,function(eh,status){status=status.newValue;if(status.status==='connected'){self.print_receipt();}});window.hw_proxy=this;},set_connection_status:function(status,drivers){oldstatus=this.get('status');newstatus={};newstatus.status=status;newstatus.drivers=status==='disconnected'?{}:oldstatus.drivers;newstatus.drivers=drivers?drivers:newstatus.drivers;this.set('status',newstatus);},disconnect:function(){if(this.get('status').status!=='disconnected'){this.connection.destroy();this.set_connection_status('disconnected');}},connect:function(url){var self=this;this.connection=new instance.web.Session(undefined,url,{use_cors:true});this.host=url;this.set_connection_status('connecting',{});return this.message('handshake').then(function(response){if(response){self.set_connection_status('connected');localStorage['hw_proxy_url']=url;self.keepalive();}else{self.set_connection_status('disconnected');console.error('Connection refused by the Proxy');}},function(){self.set_connection_status('disconnected');console.error('Could not connect to the Proxy');});},autoconnect:function(options){var self=this;this.set_connection_status('connecting',{});var found_url=new $.Deferred();var success=new $.Deferred();if(options.force_ip){found_url=this.try_hard_to_connect(options.force_ip,options)}else if(localStorage['hw_proxy_url']){found_url=this.try_hard_to_connect(localStorage['hw_proxy_url'],options).then(null,function(){return self.find_proxy(options);});}else{found_url=this.find_proxy(options);}
success=found_url.then(function(url){return self.connect(url);});success.fail(function(){self.set_connection_status('disconnected');});return success;},keepalive:function(){var self=this;if(!this.keptalive){this.keptalive=true;function status(){self.connection.rpc('/hw_proxy/status_json',{},{timeout:2500}).then(function(driver_status){self.set_connection_status('connected',driver_status);},function(){if(self.get('status').status!=='connecting'){self.set_connection_status('disconnected');}}).always(function(){setTimeout(status,5000);});}
status();};},message:function(name,params){var callbacks=this.notifications[name]||[];for(var i=0;i<callbacks.length;i++){callbacks[i](params);}
if(this.get('status').status!=='disconnected'){return this.connection.rpc('/hw_proxy/'+name,params||{});}else{return(new $.Deferred()).reject();}},try_hard_to_connect:function(url,options){options=options||{};var port=':'+(options.port||'8069');this.set_connection_status('connecting');if(url.indexOf('//')<0){url='http://'+url;}
if(url.indexOf(':',5)<0){url=url+port;}
function try_real_hard_to_connect(url,retries,done){done=done||new $.Deferred();var c=$.ajax({url:url+'/hw_proxy/hello',method:'GET',timeout:1000,}).done(function(){done.resolve(url);}).fail(function(){if(retries>0){try_real_hard_to_connect(url,retries-1,done);}else{done.reject();}});return done;}
return try_real_hard_to_connect(url,3);},find_proxy:function(options){options=options||{};var self=this;var port=':'+(options.port||'8069');var urls=[];var found=false;var parallel=8;var done=new $.Deferred();var threads=[];var progress=0;urls.push('http://localhost'+port);for(var i=0;i<256;i++){urls.push('http://192.168.0.'+i+port);urls.push('http://192.168.1.'+i+port);urls.push('http://10.0.0.'+i+port);}
var prog_inc=1/urls.length;function update_progress(){progress=found?1:progress+prog_inc;if(options.progress){options.progress(progress);}}
function thread(done){var url=urls.shift();done=done||new $.Deferred();if(!url||found||!self.searching_for_proxy){done.resolve();return done;}
var c=$.ajax({url:url+'/hw_proxy/hello',method:'GET',timeout:400,}).done(function(){found=true;update_progress();done.resolve(url);}).fail(function(){update_progress();thread(done);});return done;}
this.searching_for_proxy=true;for(var i=0,len=Math.min(parallel,urls.length);i<len;i++){threads.push(thread());}
$.when.apply($,threads).then(function(){var urls=[];for(var i=0;i<arguments.length;i++){if(arguments[i]){urls.push(arguments[i]);}}
done.resolve(urls[0]);});return done;},stop_searching:function(){this.searching_for_proxy=false;this.set_connection_status('disconnected');},add_notification:function(name,callback){if(!this.notifications[name]){this.notifications[name]=[];}
this.notifications[name].push(callback);},scale_read:function(){var self=this;var ret=new $.Deferred();if(self.use_debug_weight){return(new $.Deferred()).resolve({weight:this.debug_weight,unit:'Kg',info:'ok'});}
this.message('scale_read',{}).then(function(weight){ret.resolve(weight);},function(){ret.resolve({weight:0.0,unit:'Kg',info:'ok'});});return ret;},debug_set_weight:function(kg){this.use_debug_weight=true;this.debug_weight=kg;},debug_reset_weight:function(){this.use_debug_weight=false;this.debug_weight=0;},open_cashbox:function(){return this.message('open_cashbox');},print_receipt:function(receipt){var self=this;if(receipt){this.receipt_queue.push(receipt);}
var aborted=false;function send_printing_job(){if(self.receipt_queue.length>0){var r=self.receipt_queue.shift();self.message('print_xml_receipt',{receipt:r},{timeout:5000}).then(function(){send_printing_job();},function(error){if(error){self.pos.pos_widget.screen_selector.show_popup('error-traceback',{'message':_t('Printing Error: ')+error.data.message,'comment':error.data.debug,});return;}
self.receipt_queue.unshift(r)});}}
send_printing_job();},log:function(){return this.message('log',{'arguments':_.toArray(arguments)});},});module.BarcodeReader=instance.web.Class.extend({actions:['product','cashier','client',],init:function(attributes){this.pos=attributes.pos;this.action_callback={};this.proxy=attributes.proxy;this.remote_scanning=false;this.remote_active=0;this.action_callback_stack=[];this.add_barcode_patterns(attributes.patterns||{'product':['xxxxxxxxxxxxx'],'cashier':['041xxxxxxxxxx'],'client':['042xxxxxxxxxx'],'weight':['21xxxxxNNDDDx'],'discount':['22xxxxxxxxNNx'],'price':['23xxxxxNNNDDx'],});},add_barcode_patterns:function(patterns){this.patterns=this.patterns||{};for(type in patterns){this.patterns[type]=this.patterns[type]||[];var patternlist=patterns[type];if(typeof patternlist==='string'){patternlist=patternlist.split(',');}
for(var i=0;i<patternlist.length;i++){var pattern=patternlist[i].trim().substring(0,12);if(!pattern.length){continue;}
pattern=pattern.replace(/[x\*]/gi,'x');while(pattern.length<12){pattern+='x';}
this.patterns[type].push(pattern);}}
this.sorted_patterns=[];for(var type in this.patterns){var patterns=this.patterns[type];for(var i=0;i<patterns.length;i++){var pattern=patterns[i];var score=0;for(var j=0;j<pattern.length;j++){if(pattern[j]!='x'){score++;}}
this.sorted_patterns.push({type:type,pattern:pattern,score:score});}}
this.sorted_patterns.sort(function(a,b){return b.score-a.score;});},save_callbacks:function(){var callbacks={};for(name in this.action_callback){callbacks[name]=this.action_callback[name];}
this.action_callback_stack.push(callbacks);},restore_callbacks:function(){if(this.action_callback_stack.length){var callbacks=this.action_callback_stack.pop();this.action_callback=callbacks;}},set_action_callback:function(action,callback){if(arguments.length==2){this.action_callback[action]=callback;}else{var actions=arguments[0];for(action in actions){this.set_action_callback(action,actions[action]);}}},reset_action_callbacks:function(){for(action in this.action_callback){this.action_callback[action]=undefined;}},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2==0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},check_ean:function(ean){return/^\d+$/.test(ean)&&this.ean_checksum(ean)===Number(ean[ean.length-1]);},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean=ean+'0';}
return ean.substr(0,12)+this.ean_checksum(ean);},parse_ean:function(ean){var self=this;var parse_result={encoding:'ean13',type:'error',code:ean,base_code:ean,value:0,};if(!this.check_ean(ean)){return parse_result;}
function is_number(char){n=char.charCodeAt(0);return n>=48&&n<=57;}
function match_pattern(ean,pattern){for(var i=0;i<pattern.length;i++){var p=pattern[i];var e=ean[i];if(is_number(p)&&p!==e){return false;}}
return true;}
function get_value(ean,pattern){var value=0;var decimals=0;for(var i=0;i<pattern.length;i++){var p=pattern[i];var v=parseInt(ean[i]);if(p==='N'){value*=10;value+=v;}else if(p==='D'){decimals+=1;value+=v*Math.pow(10,-decimals);}}
return value;}
function get_basecode(ean,pattern){var base='';for(var i=0;i<pattern.length;i++){var p=pattern[i];var v=ean[i];if(p==='x'||is_number(p)){base+=v;}else{base+='0';}}
return self.sanitize_ean(base);}
var patterns=this.sorted_patterns;for(var i=0;i<patterns.length;i++){if(match_pattern(ean,patterns[i].pattern)){parse_result.type=patterns[i].type;parse_result.value=get_value(ean,patterns[i].pattern);parse_result.base_code=get_basecode(ean,patterns[i].pattern);return parse_result;}}
return parse_result;},scan:function(code){if(code.length<3){return;}else if(code.length===13&&this.check_ean(code)){var parse_result=this.parse_ean(code);}else if(code.length===12&&this.check_ean('0'+code)){var parse_result=this.parse_ean('0'+code);}else if(this.pos.db.get_product_by_reference(code)){var parse_result={encoding:'reference',type:'product',code:code,};}else{var parse_result={encoding:'error',type:'error',code:code,};}
if(parse_result.type in{'product':'','weight':'','price':''}){if(this.action_callback['product']){this.action_callback['product'](parse_result);}}else{if(this.action_callback[parse_result.type]){this.action_callback[parse_result.type](parse_result);}}},connect:function(){var self=this;var code="";var timeStamp=0;var onlynumbers=true;var timeout=null;this.handler=function(e){if(e.which===13){e.preventDefault();return;}
if(timeStamp+50<new Date().getTime()){code="";onlynumbers=true;}
timeStamp=new Date().getTime();clearTimeout(timeout);if(e.which<48||e.which>=58){onlynumbers=false;}
code+=String.fromCharCode(e.which);timeout=setTimeout(function(){self.scan(code);code="";onlynumbers=true;},100);};$('body').on('keypress',this.handler);},disconnect:function(){$('body').off('keypress',this.handler)},connect_to_proxy:function(){var self=this;this.remote_scanning=true;if(this.remote_active>=1){return;}
this.remote_active=1;function waitforbarcode(){return self.proxy.connection.rpc('/hw_proxy/scanner',{},{timeout:7500}).then(function(barcode){if(!self.remote_scanning){self.remote_active=0;return;}
self.scan(barcode);waitforbarcode();},function(){if(!self.remote_scanning){self.remote_active=0;return;}
setTimeout(waitforbarcode,5000);});}
waitforbarcode();},disconnect_from_proxy:function(){this.remote_scanning=false;},});};

/* /point_of_sale/static/src/js/screens.js defined in bundle 'web.assets_backend' */
function openerp_pos_screens(instance,module){var QWeb=instance.web.qweb,_t=instance.web._t;var round_pr=instance.web.round_precision
module.ScreenSelector=instance.web.Class.extend({init:function(options){this.pos=options.pos;this.screen_set=options.screen_set||{};this.popup_set=options.popup_set||{};this.default_screen=options.default_screen;this.current_popup=null;this.current_mode=options.default_mode||'cashier';this.current_screen=null;for(screen_name in this.screen_set){this.screen_set[screen_name].hide();}
for(popup_name in this.popup_set){this.popup_set[popup_name].hide();}
this.pos.get('selectedOrder').set_screen_data({'screen':this.default_screen,});this.pos.bind('change:selectedOrder',this.load_saved_screen,this);},add_screen:function(screen_name,screen){screen.hide();this.screen_set[screen_name]=screen;return this;},show_popup:function(name,options){if(this.current_popup){this.close_popup();}
this.current_popup=this.popup_set[name];this.current_popup.show(options);},close_popup:function(){if(this.current_popup){this.current_popup.close();this.current_popup.hide();this.current_popup=null;}},load_saved_screen:function(){this.close_popup();var selectedOrder=this.pos.get('selectedOrder');this.set_current_screen(selectedOrder.get_screen_data('screen')||this.default_screen,null,'refresh');},set_user_mode:function(user_mode){if(user_mode!==this.current_mode){this.close_popup();this.current_mode=user_mode;this.load_saved_screen();}},get_user_mode:function(){return this.current_mode;},set_current_screen:function(screen_name,params,refresh){var screen=this.screen_set[screen_name];if(!screen){console.error("ERROR: set_current_screen("+screen_name+") : screen not found");}
this.close_popup();var order=this.pos.get('selectedOrder');var old_screen_name=order.get_screen_data('screen');order.set_screen_data('screen',screen_name);if(params){order.set_screen_data('params',params);}
if(screen_name!==old_screen_name){order.set_screen_data('previous-screen',old_screen_name);}
if(refresh||screen!==this.current_screen){if(this.current_screen){this.current_screen.close();this.current_screen.hide();}
this.current_screen=screen;this.current_screen.show();}},get_current_screen:function(){return this.pos.get('selectedOrder').get_screen_data('screen')||this.default_screen;},back:function(){var previous=this.pos.get('selectedOrder').get_screen_data('previous-screen');if(previous){this.set_current_screen(previous);}},get_current_screen_param:function(param){var params=this.pos.get('selectedOrder').get_screen_data('params');return params?params[param]:undefined;},set_default_screen:function(){this.set_current_screen(this.default_screen);},});module.ScreenWidget=module.PosBaseWidget.extend({show_numpad:true,show_leftpane:true,init:function(parent,options){this._super(parent,options);this.hidden=false;},help_button_action:function(){this.pos_widget.screen_selector.show_popup('help');},barcode_product_screen:'products',hotkeys_handlers:{},barcode_product_action:function(code){var self=this;if(self.pos.scan_product(code)){if(self.barcode_product_screen){self.pos_widget.screen_selector.set_current_screen(self.barcode_product_screen);}}else{self.pos_widget.screen_selector.show_popup('error-barcode',code.code);}},barcode_cashier_action:function(code){var users=this.pos.users;for(var i=0,len=users.length;i<len;i++){if(users[i].ean13===code.code){this.pos.cashier=users[i];this.pos_widget.username.refresh();return true;}}
this.pos_widget.screen_selector.show_popup('error-barcode',code.code);return false;},barcode_client_action:function(code){var partner=this.pos.db.get_partner_by_ean13(code.code);if(partner){this.pos.get('selectedOrder').set_client(partner);this.pos_widget.username.refresh();return true;}
this.pos_widget.screen_selector.show_popup('error-barcode',code.code);return false;},barcode_discount_action:function(code){var last_orderline=this.pos.get('selectedOrder').getLastOrderline();if(last_orderline){last_orderline.set_discount(code.value)}},barcode_error_action:function(code){this.pos_widget.screen_selector.show_popup('error-barcode',code.code);},show_action_bar:function(){this.pos_widget.action_bar.show();},hide_action_bar:function(){this.pos_widget.action_bar.hide();},add_action_button:function(button_def){this.show_action_bar();return this.pos_widget.action_bar.add_new_button(button_def);},show:function(){var self=this;this.hidden=false;if(this.$el){this.$el.removeClass('oe_hidden');}
if(this.pos_widget.action_bar.get_button_count()>0){this.show_action_bar();}else{this.hide_action_bar();}
var self=this;this.pos_widget.set_numpad_visible(this.show_numpad);this.pos_widget.set_leftpane_visible(this.show_leftpane);this.pos_widget.username.set_user_mode(this.pos_widget.screen_selector.get_user_mode());this.pos.barcode_reader.set_action_callback({'cashier':self.barcode_cashier_action?function(code){self.barcode_cashier_action(code);}:undefined,'product':self.barcode_product_action?function(code){self.barcode_product_action(code);}:undefined,'client':self.barcode_client_action?function(code){self.barcode_client_action(code);}:undefined,'discount':self.barcode_discount_action?function(code){self.barcode_discount_action(code);}:undefined,'error':self.barcode_error_action?function(code){self.barcode_error_action(code);}:undefined,});},close:function(){if(this.pos.barcode_reader){this.pos.barcode_reader.reset_action_callbacks();}
this.pos_widget.action_bar.destroy_buttons();},hide:function(){this.hidden=true;if(this.$el){this.$el.addClass('oe_hidden');}},renderElement:function(){this._super();if(this.hidden){if(this.$el){this.$el.addClass('oe_hidden');}}},});module.PopUpWidget=module.PosBaseWidget.extend({show:function(){if(this.$el){this.$el.removeClass('oe_hidden');}},close:function(){},hide:function(){if(this.$el){this.$el.addClass('oe_hidden');}},});module.ErrorPopupWidget=module.PopUpWidget.extend({template:'ErrorPopupWidget',show:function(options){options=options||{};var self=this;this._super();$('body').append('<audio src="/point_of_sale/static/src/sounds/error.wav" autoplay="true"></audio>');this.message=options.message||_t('Error');this.comment=options.comment||'';this.renderElement();this.pos.barcode_reader.save_callbacks();this.pos.barcode_reader.reset_action_callbacks();this.$('.footer .button').click(function(){self.pos_widget.screen_selector.close_popup();if(options.confirm){options.confirm.call(self);}});},close:function(){this._super();this.pos.barcode_reader.restore_callbacks();},});module.ErrorTracebackPopupWidget=module.ErrorPopupWidget.extend({template:'ErrorTracebackPopupWidget',});module.ErrorBarcodePopupWidget=module.ErrorPopupWidget.extend({template:'ErrorBarcodePopupWidget',show:function(barcode){this.barcode=barcode;this._super();},});module.ConfirmPopupWidget=module.PopUpWidget.extend({template:'ConfirmPopupWidget',show:function(options){var self=this;this._super();this.message=options.message||'';this.comment=options.comment||'';this.renderElement();this.$('.button.cancel').click(function(){self.pos_widget.screen_selector.close_popup();if(options.cancel){options.cancel.call(self);}});this.$('.button.confirm').click(function(){self.pos_widget.screen_selector.close_popup();if(options.confirm){options.confirm.call(self);}});},});module.ErrorNoClientPopupWidget=module.ErrorPopupWidget.extend({template:'ErrorNoClientPopupWidget',});module.ErrorInvoiceTransferPopupWidget=module.ErrorPopupWidget.extend({template:'ErrorInvoiceTransferPopupWidget',});module.UnsentOrdersPopupWidget=module.PopUpWidget.extend({template:'UnsentOrdersPopupWidget',show:function(options){var self=this;this._super(options);this.renderElement();this.$('.button.confirm').click(function(){self.pos_widget.screen_selector.close_popup();});},});module.ScaleScreenWidget=module.ScreenWidget.extend({template:'ScaleScreenWidget',next_screen:'products',previous_screen:'products',show_leftpane:false,show:function(){this._super();var self=this;var queue=this.pos.proxy_queue;this.set_weight(0);this.renderElement();this.hotkey_handler=function(event){if(event.which===13){self.order_product();self.pos_widget.screen_selector.set_current_screen(self.next_screen);}else if(event.which===27){self.pos_widget.screen_selector.set_current_screen(self.previous_screen);}};$('body').on('keyup',this.hotkey_handler);this.$('.back').click(function(){self.pos_widget.screen_selector.set_current_screen(self.previous_screen);});this.$('.next,.buy-product').click(function(){self.order_product();self.pos_widget.screen_selector.set_current_screen(self.next_screen);});queue.schedule(function(){return self.pos.proxy.scale_read().then(function(weight){self.set_weight(weight.weight);});},{duration:50,repeat:true});},get_product:function(){var ss=this.pos_widget.screen_selector;if(ss){return ss.get_current_screen_param('product');}else{return undefined;}},order_product:function(){this.pos.get('selectedOrder').addProduct(this.get_product(),{quantity:this.weight});},get_product_name:function(){var product=this.get_product();return(product?product.display_name:undefined)||'Unnamed Product';},get_product_price:function(){var product=this.get_product();return(product?product.price:0)||0;},set_weight:function(weight){this.weight=weight;this.$('.weight').text(this.get_product_weight_string());this.$('.computed-price').text(this.get_computed_price_string());},get_product_weight_string:function(){var product=this.get_product();var defaultstr=(this.weight||0).toFixed(3)+' Kg';if(!product||!this.pos){return defaultstr;}
var unit_id=product.uom_id;if(!unit_id){return defaultstr;}
var unit=this.pos.units_by_id[unit_id[0]];var weight=round_pr(this.weight||0,unit.rounding);var weightstr=weight.toFixed(Math.ceil(Math.log(1.0/unit.rounding)/Math.log(10)));weightstr+=' Kg';return weightstr;},get_computed_price_string:function(){return this.format_currency(this.get_product_price()*this.weight);},close:function(){var self=this;this._super();$('body').off('keyup',this.hotkey_handler);this.pos.proxy_queue.clear();},});module.ProductScreenWidget=module.ScreenWidget.extend({template:'ProductScreenWidget',show_numpad:true,show_leftpane:true,start:function(){var self=this;this.product_list_widget=new module.ProductListWidget(this,{click_product_action:function(product){if(product.to_weight&&self.pos.config.iface_electronic_scale){self.pos_widget.screen_selector.set_current_screen('scale',{product:product});}else{self.pos.get('selectedOrder').addProduct(product);}},product_list:this.pos.db.get_product_by_category(0)});this.product_list_widget.replace(this.$('.placeholder-ProductListWidget'));this.product_categories_widget=new module.ProductCategoriesWidget(this,{product_list_widget:this.product_list_widget,});this.product_categories_widget.replace(this.$('.placeholder-ProductCategoriesWidget'));},show:function(){this._super();var self=this;this.product_categories_widget.reset_category();this.pos_widget.order_widget.set_editable(true);},close:function(){this._super();this.pos_widget.order_widget.set_editable(false);if(this.pos.config.iface_vkeyboard&&this.pos_widget.onscreen_keyboard){this.pos_widget.onscreen_keyboard.hide();}},});module.ClientListScreenWidget=module.ScreenWidget.extend({template:'ClientListScreenWidget',init:function(parent,options){this._super(parent,options);},show_leftpane:false,auto_back:true,show:function(){var self=this;this._super();this.renderElement();this.details_visible=false;this.old_client=this.pos.get('selectedOrder').get('client');this.new_client=this.old_client;this.$('.back').click(function(){self.pos_widget.screen_selector.back();});this.$('.next').click(function(){self.save_changes();self.pos_widget.screen_selector.back();});this.$('.new-customer').click(function(){self.display_client_details('edit',{'country_id':self.pos.company.country_id,});});var partners=this.pos.db.get_partners_sorted(1000);this.render_list(partners);this.reload_partners();if(this.old_client){this.display_client_details('show',this.old_client,0);}
this.$('.client-list-contents').delegate('.client-line','click',function(event){self.line_select(event,$(this),parseInt($(this).data('id')));});var search_timeout=null;if(this.pos.config.iface_vkeyboard&&this.pos_widget.onscreen_keyboard){this.pos_widget.onscreen_keyboard.connect(this.$('.searchbox input'));}
this.$('.searchbox input').on('keyup',function(event){clearTimeout(search_timeout);var query=this.value;search_timeout=setTimeout(function(){self.perform_search(query,event.which===13);},70);});this.$('.searchbox .search-clear').click(function(){self.clear_search();});},barcode_client_action:function(code){if(this.editing_client){this.$('.detail.barcode').val(code.code);}else if(this.pos.db.get_partner_by_ean13(code.code)){this.display_client_details('show',this.pos.db.get_partner_by_ean13(code.code));}},perform_search:function(query,associate_result){if(query){var customers=this.pos.db.search_partner(query);this.display_client_details('hide');if(associate_result&&customers.length===1){this.new_client=customers[0];this.save_changes();this.pos_widget.screen_selector.back();}
this.render_list(customers);}else{var customers=this.pos.db.get_partners_sorted();this.render_list(customers);}},clear_search:function(){var customers=this.pos.db.get_partners_sorted(1000);this.render_list(customers);this.$('.searchbox input')[0].value='';this.$('.searchbox input').focus();},render_list:function(partners){var contents=this.$el[0].querySelector('.client-list-contents');contents.innerHTML="";for(var i=0,len=Math.min(partners.length,1000);i<len;i++){var partner=partners[i];var clientline_html=QWeb.render('ClientLine',{widget:this,partner:partners[i]});var clientline=document.createElement('tbody');clientline.innerHTML=clientline_html;clientline=clientline.childNodes[1];if(partners===this.new_client){clientline.classList.add('highlight');}else{clientline.classList.remove('highlight');}
contents.appendChild(clientline);}},save_changes:function(){if(this.has_client_changed()){this.pos.get('selectedOrder').set_client(this.new_client);}},has_client_changed:function(){if(this.old_client&&this.new_client){return this.old_client.id!==this.new_client.id;}else{return!!this.old_client!==!!this.new_client;}},toggle_save_button:function(){var $button=this.$('.button.next');if(this.editing_client){$button.addClass('oe_hidden');return;}else if(this.new_client){if(!this.old_client){$button.text(_t('Set Customer'));}else{$button.text(_t('Change Customer'));}}else{$button.text(_t('Deselect Customer'));}
$button.toggleClass('oe_hidden',!this.has_client_changed());},line_select:function(event,$line,id){var partner=this.pos.db.get_partner_by_id(id);this.$('.client-list .lowlight').removeClass('lowlight');if($line.hasClass('highlight')){$line.removeClass('highlight');$line.addClass('lowlight');this.display_client_details('hide',partner);this.new_client=null;this.toggle_save_button();}else{this.$('.client-list .highlight').removeClass('highlight');$line.addClass('highlight');var y=event.pageY-$line.parent().offset().top
this.display_client_details('show',partner,y);this.new_client=partner;this.toggle_save_button();}},partner_icon_url:function(id){return'/web/binary/image?model=res.partner&id='+id+'&field=image_small';},edit_client_details:function(partner){this.display_client_details('edit',partner);},undo_client_details:function(partner){if(!partner.id){this.display_client_details('hide');}else{this.display_client_details('show',partner);}},save_client_details:function(partner){var self=this;var fields={}
this.$('.client-details-contents .detail').each(function(idx,el){fields[el.name]=el.value;});if(!fields.name){this.pos_widget.screen_selector.show_popup('error',{message:_t('A Customer Name Is Required'),});return;}
if(this.uploaded_picture){fields.image=this.uploaded_picture;}
fields.id=partner.id||false;fields.country_id=fields.country_id||false;fields.ean13=fields.ean13?this.pos.barcode_reader.sanitize_ean(fields.ean13):false;new instance.web.Model('res.partner').call('create_from_ui',[fields]).then(function(partner_id){self.saved_client_details(partner_id);},function(err,event){event.preventDefault();self.pos_widget.screen_selector.show_popup('error',{'message':_t('Error: Could not Save Changes'),'comment':_t('Your Internet connection is probably down.'),});});},saved_client_details:function(partner_id){var self=this;this.reload_partners().then(function(){var partner=self.pos.db.get_partner_by_id(partner_id);if(partner){self.new_client=partner;self.toggle_save_button();self.display_client_details('show',partner);}else{self.display_client_details('hide');}});},resize_image_to_dataurl:function(img,maxwidth,maxheight,callback){img.onload=function(){var png=new Image();var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var ratio=1;if(img.width>maxwidth){ratio=maxwidth/img.width;}
if(img.height*ratio>maxheight){ratio=maxheight/img.height;}
var width=Math.floor(img.width*ratio);var height=Math.floor(img.height*ratio);canvas.width=width;canvas.height=height;ctx.drawImage(img,0,0,width,height);var dataurl=canvas.toDataURL();callback(dataurl);}},load_image_file:function(file,callback){var self=this;if(!file.type.match(/image.*/)){this.pos_widget.screen_selector.show_popup('error',{message:_t('Unsupported File Format'),comment:_t('Only web-compatible Image formats such as .png or .jpeg are supported'),});return;}
var reader=new FileReader();reader.onload=function(event){var dataurl=event.target.result;var img=new Image();img.src=dataurl;self.resize_image_to_dataurl(img,800,600,callback);}
reader.onerror=function(){self.pos_widget.screen_selector.show_popup('error',{message:_t('Could Not Read Image'),comment:_t('The provided file could not be read due to an unknown error'),});};reader.readAsDataURL(file);},reload_partners:function(){var self=this;return this.pos.load_new_partners().then(function(){self.render_list(self.pos.db.get_partners_sorted(1000));var curr_client=self.pos.get_order().get_client();if(curr_client){self.pos.get_order().set_client(self.pos.db.get_partner_by_id(curr_client.id));}});},display_client_details:function(visibility,partner,clickpos){var self=this;var contents=this.$('.client-details-contents');var parent=this.$('.client-list').parent();var scroll=parent.scrollTop();var height=contents.height();contents.off('click','.button.edit');contents.off('click','.button.save');contents.off('click','.button.undo');contents.on('click','.button.edit',function(){self.edit_client_details(partner);});contents.on('click','.button.save',function(){self.save_client_details(partner);});contents.on('click','.button.undo',function(){self.undo_client_details(partner);});this.editing_client=false;this.uploaded_picture=null;if(visibility==='show'){contents.empty();contents.append($(QWeb.render('ClientDetails',{widget:this,partner:partner})));var new_height=contents.height();if(!this.details_visible){if(clickpos<scroll+new_height+20){parent.scrollTop(clickpos-20);}else{parent.scrollTop(parent.scrollTop()+new_height);}}else{parent.scrollTop(parent.scrollTop()-height+new_height);}
this.details_visible=true;this.toggle_save_button();}else if(visibility==='edit'){this.editing_client=true;contents.empty();contents.append($(QWeb.render('ClientDetailsEdit',{widget:this,partner:partner})));this.toggle_save_button();contents.find('.image-uploader').on('change',function(){self.load_image_file(event.target.files[0],function(res){if(res){contents.find('.client-picture img, .client-picture .fa').remove();contents.find('.client-picture').append("<img src='"+res+"'>");contents.find('.detail.picture').remove();self.uploaded_picture=res;}});});}else if(visibility==='hide'){contents.empty();if(height>scroll){contents.css({height:height+'px'});contents.animate({height:0},400,function(){contents.css({height:''});});}else{parent.scrollTop(parent.scrollTop()-height);}
this.details_visible=false;this.toggle_save_button();}},close:function(){this._super();},});module.ReceiptScreenWidget=module.ScreenWidget.extend({template:'ReceiptScreenWidget',show_numpad:false,show_leftpane:false,show:function(){this._super();var self=this;var print_button=this.add_action_button({label:_t('Print'),icon:'/point_of_sale/static/src/img/icons/png48/printer.png',click:function(){self.print();},});var finish_button=this.add_action_button({label:_t('Next Order'),icon:'/point_of_sale/static/src/img/icons/png48/go-next.png',click:function(){self.finishOrder();},});this.refresh();if(!this.pos.get('selectedOrder')._printed){this.print();}
finish_button.set_disabled(true);setTimeout(function(){finish_button.set_disabled(false);},2000);},print:function(){this.pos.get('selectedOrder')._printed=true;window.print();},finishOrder:function(){this.pos.get('selectedOrder').destroy();},refresh:function(){var order=this.pos.get('selectedOrder');$('.pos-receipt-container',this.$el).html(QWeb.render('PosTicket',{widget:this,order:order,orderlines:order.get('orderLines').models,paymentlines:order.get('paymentLines').models,}));},close:function(){this._super();}});module.PaymentScreenWidget=module.ScreenWidget.extend({template:'PaymentScreenWidget',back_screen:'products',next_screen:'receipt',init:function(parent,options){var self=this;this._super(parent,options);this.pos.bind('change:selectedOrder',function(){this.bind_events();this.renderElement();},this);this.bind_events();this.line_delete_handler=function(event){var node=this;while(node&&!node.classList.contains('paymentline')){node=node.parentNode;}
if(node){self.pos.get('selectedOrder').removePaymentline(node.line)}
event.stopPropagation();};this.line_change_handler=function(event){var node=this;while(node&&!node.classList.contains('paymentline')){node=node.parentNode;}
if(node){node.line.set_amount(this.value);}};this.line_click_handler=function(event){var node=this;while(node&&!node.classList.contains('paymentline')){node=node.parentNode;}
if(node){self.pos.get('selectedOrder').selectPaymentline(node.line);}};this.hotkey_handler=function(event){if(event.which===13){self.validate_order();}else if(event.which===27){self.back();}};},show:function(){this._super();var self=this;this.enable_numpad();this.focus_selected_line();document.body.addEventListener('keyup',this.hotkey_handler);this.add_action_button({label:_t('Back'),icon:'/point_of_sale/static/src/img/icons/png48/go-previous.png',click:function(){self.back();},});this.add_action_button({label:_t('Validate'),name:'validation',icon:'/point_of_sale/static/src/img/icons/png48/validate.png',click:function(){self.validate_order();},});if(this.pos.config.iface_invoicing){this.add_action_button({label:_t('Invoice'),name:'invoice',icon:'/point_of_sale/static/src/img/icons/png48/invoice.png',click:function(){self.validate_order({invoice:true});},});}
if(this.pos.config.iface_cashdrawer){this.add_action_button({label:_t('Cash'),name:'cashbox',icon:'/point_of_sale/static/src/img/open-cashbox.png',click:function(){self.pos.proxy.open_cashbox();},});}
this.update_payment_summary();},close:function(){this._super();this.disable_numpad();document.body.removeEventListener('keyup',this.hotkey_handler);},remove_empty_lines:function(){var order=this.pos.get('selectedOrder');var lines=order.get('paymentLines').models.slice(0);for(var i=0;i<lines.length;i++){var line=lines[i];if(line.get_amount()===0){order.removePaymentline(line);}}},back:function(){this.remove_empty_lines();this.pos_widget.screen_selector.set_current_screen(this.back_screen);},bind_events:function(){if(this.old_order){this.old_order.unbind(null,null,this);}
var order=this.pos.get('selectedOrder');order.bind('change:selected_paymentline',this.focus_selected_line,this);this.old_order=order;if(this.old_paymentlines){this.old_paymentlines.unbind(null,null,this);}
var paymentlines=order.get('paymentLines');paymentlines.bind('add',this.add_paymentline,this);paymentlines.bind('change:selected',this.rerender_paymentline,this);paymentlines.bind('change:amount',function(line){if(!line.selected&&line.node){line.node.value=line.amount.toFixed(this.pos.currency.decimals);}
this.update_payment_summary();},this);paymentlines.bind('remove',this.remove_paymentline,this);paymentlines.bind('all',this.update_payment_summary,this);this.old_paymentlines=paymentlines;if(this.old_orderlines){this.old_orderlines.unbind(null,null,this);}
var orderlines=order.get('orderLines');orderlines.bind('all',this.update_payment_summary,this);this.old_orderlines=orderlines;},focus_selected_line:function(){var line=this.pos.get('selectedOrder').selected_paymentline;if(line){var input=line.node.querySelector('input');if(!input){return;}
var value=input.value;input.focus();if(this.numpad_state){this.numpad_state.reset();}
if(Number(value)===0){input.value='';}else{input.value=value;input.select();}}},add_paymentline:function(line){var list_container=this.el.querySelector('.payment-lines');list_container.appendChild(this.render_paymentline(line));if(this.numpad_state){this.numpad_state.reset();}},render_paymentline:function(line){var el_html=openerp.qweb.render('Paymentline',{widget:this,line:line});el_html=_.str.trim(el_html);var el_node=document.createElement('tbody');el_node.innerHTML=el_html;el_node=el_node.childNodes[0];el_node.line=line;el_node.querySelector('.paymentline-delete').addEventListener('click',this.line_delete_handler);el_node.addEventListener('click',this.line_click_handler);el_node.querySelector('input').addEventListener('keyup',this.line_change_handler);line.node=el_node;return el_node;},rerender_paymentline:function(line){var old_node=line.node;var new_node=this.render_paymentline(line);old_node.parentNode.replaceChild(new_node,old_node);},remove_paymentline:function(line){line.node.parentNode.removeChild(line.node);line.node=undefined;},renderElement:function(){this._super();var paymentlines=this.pos.get('selectedOrder').get('paymentLines').models;var list_container=this.el.querySelector('.payment-lines');for(var i=0;i<paymentlines.length;i++){list_container.appendChild(this.render_paymentline(paymentlines[i]));}
this.update_payment_summary();},update_payment_summary:function(){var currentOrder=this.pos.get('selectedOrder');var paidTotal=currentOrder.getPaidTotal();var dueTotal=currentOrder.getTotalTaxIncluded();var remaining=dueTotal>paidTotal?dueTotal-paidTotal:0;var change=paidTotal>dueTotal?paidTotal-dueTotal:0;this.$('.payment-due-total').html(this.format_currency(dueTotal));this.$('.payment-paid-total').html(this.format_currency(paidTotal));this.$('.payment-remaining').html(this.format_currency(remaining));this.$('.payment-change').html(this.format_currency(change));if(currentOrder.selected_orderline===undefined){remaining=1;}
if(this.pos_widget.action_bar){this.pos_widget.action_bar.set_button_disabled('validation',!this.is_paid());this.pos_widget.action_bar.set_button_disabled('invoice',!this.is_paid());}},is_paid:function(){var currentOrder=this.pos.get('selectedOrder');return(currentOrder.getTotalTaxIncluded()<0.000001||currentOrder.getPaidTotal()+0.000001>=currentOrder.getTotalTaxIncluded());},validate_order:function(options){var self=this;options=options||{};var currentOrder=this.pos.get('selectedOrder');if(currentOrder.get('orderLines').models.length===0){this.pos_widget.screen_selector.show_popup('error',{'message':_t('Empty Order'),'comment':_t('There must be at least one product in your order before it can be validated'),});return;}
var plines=currentOrder.get('paymentLines').models;for(var i=0;i<plines.length;i++){if(plines[i].get_type()==='bank'&&plines[i].get_amount()<0){this.pos_widget.screen_selector.show_popup('error',{'message':_t('Negative Bank Payment'),'comment':_t('You cannot have a negative amount in a Bank payment. Use a cash payment method to return money to the customer.'),});return;}}
if(!this.is_paid()){return;}
if(Math.abs(currentOrder.getTotalTaxIncluded()-currentOrder.getPaidTotal())>0.00001){var cash=false;for(var i=0;i<this.pos.cashregisters.length;i++){cash=cash||(this.pos.cashregisters[i].journal.type==='cash');}
if(!cash){this.pos_widget.screen_selector.show_popup('error',{message:_t('Cannot return change without a cash payment method'),comment:_t('There is no cash payment method available in this point of sale to handle the change.\n\n Please pay the exact amount or add a cash payment method in the point of sale configuration'),});return;}}
if(this.pos.config.iface_cashdrawer){this.pos.proxy.open_cashbox();}
if(options.invoice){this.pos_widget.action_bar.set_button_disabled('validation',true);this.pos_widget.action_bar.set_button_disabled('invoice',true);var invoiced=this.pos.push_and_invoice_order(currentOrder);invoiced.fail(function(error){if(error==='error-no-client'){self.pos_widget.screen_selector.show_popup('error',{message:_t('An anonymous order cannot be invoiced'),comment:_t('Please select a client for this order. This can be done by clicking the order tab'),});}else{self.pos_widget.screen_selector.show_popup('error',{message:_t('The order could not be sent'),comment:_t('Check your internet connection and try again.'),});}
self.pos_widget.action_bar.set_button_disabled('validation',false);self.pos_widget.action_bar.set_button_disabled('invoice',false);});invoiced.done(function(){self.pos_widget.action_bar.set_button_disabled('validation',false);self.pos_widget.action_bar.set_button_disabled('invoice',false);self.pos.get('selectedOrder').destroy();});}else{this.pos.push_order(currentOrder)
if(this.pos.config.iface_print_via_proxy){var receipt=currentOrder.export_for_printing();this.pos.proxy.print_receipt(QWeb.render('XmlReceipt',{receipt:receipt,widget:self,}));this.pos.get('selectedOrder').destroy();}else{this.pos_widget.screen_selector.set_current_screen(this.next_screen);}}
setTimeout(function(){document.activeElement.blur();$("input").blur();},250);},enable_numpad:function(){this.disable_numpad();this.numpad_state=this.pos_widget.numpad.state;if(this.numpad_state){this.numpad_state.reset();this.numpad_state.changeMode('payment');this.numpad_state.bind('set_value',this.set_value,this);this.numpad_state.bind('change:mode',this.set_mode_back_to_payment,this);}},disable_numpad:function(){if(this.numpad_state){this.numpad_state.unbind('set_value',this.set_value);this.numpad_state.unbind('change:mode',this.set_mode_back_to_payment);}},set_mode_back_to_payment:function(){this.numpad_state.set({mode:'payment'});},set_value:function(val){var selected_line=this.pos.get('selectedOrder').selected_paymentline;if(selected_line){selected_line.set_amount(val);selected_line.node.querySelector('input').value=selected_line.amount.toFixed(2);}},});};

/* /point_of_sale/static/src/js/tests.js defined in bundle 'web.assets_backend' */
(function(){'use strict';openerp.Tour.register({id:'pos_basic_order',name:'Complete a basic order trough the Front-End',path:'/web#model=pos.session.opening&action=point_of_sale.action_pos_session_opening',mode:'test',steps:[{title:'Wait fot the bloody screen to be ready',wait:200,},{title:'Load the Session',waitNot:'.oe_loading:visible',element:'span:contains("Resume Session"),span:contains("Start Session")',},{title:'Loading the Loading Screen',waitFor:'.loader'},{title:'Waiting for the end of loading...',waitFor:'.loader:hidden',},{title:'Loading The Point of Sale',waitFor:'.pos',},{title:'On va manger des CHIPS!',element:'.product-list .product-name:contains("250g Lays Pickels")',},{title:'The chips have been added to the Order',waitFor:'.order .product-name:contains("250g Lays Pickels")',},{title:'The order total has been updated to the correct value',wait:2000,waitFor:'.order .total .value:contains("1.48 €")',},{title:"Let's buy more chips",element:'.product-list .product-name:contains("250g Lays Pickels")',},{title:"Let's veryify we pay the correct price for two bags of chips",waitFor:'.order .total .value:contains("2.96 €")',},{title:"Let's pay with a debit card",element:".paypad-button:contains('Bank')",},{title:"Let's accept the payment",onload:function(){window._print=window.print;window.print=function(){console.log('Print!')};},element:".button .iconlabel:contains('Validate'):visible",},{title:"Let's finish the order",element:".button:not(.disabled) .iconlabel:contains('Next'):visible",},{onload:function(){window.print=window._print;window._print=undefined;},title:"Let's wait for the order posting",waitFor:".oe_status.js_synch .js_connected:visible",},{title:"Let's close the Point of Sale",element:".header-button:contains('Close')",},{title:"Wait for the backend to ready itself",element:'span:contains("Resume Session"),span:contains("Start Session")',},],});})();;

/* /point_of_sale/static/src/js/main.js defined in bundle 'web.assets_backend' */
openerp.point_of_sale=function(instance){instance.point_of_sale={};var module=instance.point_of_sale;openerp_pos_db(instance,module);openerp_pos_models(instance,module);openerp_pos_basewidget(instance,module);openerp_pos_keyboard(instance,module);openerp_pos_screens(instance,module);openerp_pos_devices(instance,module);openerp_pos_widgets(instance,module);instance.web.client_actions.add('pos.ui','instance.point_of_sale.PosWidget');};;

/* /project/static/src/js/project.js defined in bundle 'web.assets_backend' */
openerp.project=function(openerp){openerp.web_kanban.KanbanView.include({project_display_members_names:function(){var self=this;var members_ids=[];self.$el.find('img[data-member_id]').each(function(){members_ids.push($(this).data('member_id'));});var dataset=new openerp.web.DataSetSearch(self,'res.users',self.session.context,[['id','in',_.uniq(members_ids)]]);dataset.read_slice(['id','name']).done(function(result){_.each(result,function(v,k){self.$el.find('img[data-member_id='+v.id+']').attr('title',v.name).tooltip();});});},on_groups_started:function(){var self=this;self._super.apply(self,arguments);if(self.dataset.model==='project.project'){self.project_display_members_names();}}});openerp.web_kanban.KanbanRecord.include({on_card_clicked:function(){if(this.view.dataset.model==='project.project'){this.$('.oe_kanban_project_list a').first().click();}else{this._super.apply(this,arguments);}},});};;

/* /partner_sms/static/src/js/psms_widget.js defined in bundle 'web.assets_backend' */
console.error("Could not get content for /partner_sms/static/src/js/psms_widget.js defined in bundle 'web.assets_backend'.");;

/* /quick_record_search_ept/static/src/js/job_search.js defined in bundle 'web.assets_backend' */
openerp.quick_record_search_ept=function(instance)
{var QWeb=instance.web.qweb,_t=instance.web._t;instance.quick_record_search_ept.JobSearch=instance.web.Widget.extend
({template:'Systray.JobSearchWidget',init:function()
{this._super();this.on('load',this,this.load);this.on('display',this,this.display);},load:function(){},display:function(sc){var self=this;var $sc=$(QWeb.render('Systray.Shortcuts.Item',{'shortcut':sc}));$sc.appendTo(self.$el.find('.oe_systray'));},});instance.web.UserMenu.include
({do_update:function(){var self=this;this._super.apply(this,arguments);this.update_promise.done(function()
{if(self.job_search)
{alert("Load");self.job_search.trigger('load');}
else
{self.job_search=new instance.quick_record_search_ept.JobSearch(self);user_id=self.session.uid
res_id=user_id
act_call=(new instance.web.Model('quick.search.record').call('check_search_record_preference',[res_id])).then(function(result)
{var action=result;if(action=='True')
{self.job_search.appendTo(instance.webclient.$el.find('.oe_systray'));instance.webclient.$el.find('.oe_systray').find('#txtJobSearch').keydown(function(event)
{key=event.keyCode||event.which||event.charCode
if(key==13&&$(this).val().length>0)
{res_id=$(this).val()
act_call=(new instance.web.Model('quick.search.record').call('quick_record_search_def',[res_id])).then(function(result)
{var action=result;if(result['msg_id'])
{alert(result['msg_id'])}
$(this).val('');instance.client.action_manager.do_action(action)})}});}});}});},});};;

/* /report/static/src/js/qwebactionmanager.js defined in bundle 'web.assets_backend' */
openerp.report=function(instance){var wkhtmltopdf_state;var trigger_download=function(session,response,c,action,options){session.get_file({url:'/report/download',data:{data:JSON.stringify(response)},complete:openerp.web.unblockUI,error:c.rpc_error.bind(c),success:function(){if(action&&options&&!action.dialog){options.on_close();}},});};instance.web.ActionManager=instance.web.ActionManager.extend({ir_actions_report_xml:function(action,options){var self=this;instance.web.blockUI();action=_.clone(action);_t=instance.web._t;if('report_type'in action&&(action.report_type=='qweb-html'||action.report_type=='qweb-pdf'||action.report_type=='controller')){var report_url='';switch(action.report_type){case'qweb-html':report_url='/report/html/'+action.report_name;break;case'qweb-pdf':report_url='/report/pdf/'+action.report_name;break;case'controller':report_url=action.report_file;break;default:report_url='/report/html/'+action.report_name;break;}
if(!('data'in action)||!(action.data)){if('active_ids'in action.context){report_url+="/"+action.context.active_ids.join(',');}}else{report_url+="?options="+encodeURIComponent(JSON.stringify(action.data));report_url+="&context="+encodeURIComponent(JSON.stringify(action.context));}
var response=new Array();response[0]=report_url;response[1]=action.report_type;var c=openerp.webclient.crashmanager;if(action.report_type=='qweb-html'){window.open(report_url,'_blank','scrollbars=1,height=900,width=1280');instance.web.unblockUI();}else if(action.report_type==='qweb-pdf'){(wkhtmltopdf_state=wkhtmltopdf_state||openerp.session.rpc('/report/check_wkhtmltopdf')).then(function(presence){if(presence==='install'){self.do_notify(_t('Report'),_t('Unable to find Wkhtmltopdf on this \
system. The report will be shown in html.<br><br><a href="http://wkhtmltopdf.org/" target="_blank">\
wkhtmltopdf.org</a>'),true);report_url=report_url.substring(12)
window.open('/report/html/'+report_url,'_blank','height=768,width=1024');instance.web.unblockUI();return;}else if(presence==='workers'){self.do_notify(_t('Report'),_t('You need to start OpenERP with at least two \
workers to print a pdf version of the reports.'),true);report_url=report_url.substring(12)
window.open('/report/html/'+report_url,'_blank','height=768,width=1024');instance.web.unblockUI();return;}else if(presence==='upgrade'){self.do_notify(_t('Report'),_t('You should upgrade your version of\
 Wkhtmltopdf to at least 0.12.0 in order to get a correct display of headers and footers as well as\
 support for table-breaking between pages.<br><br><a href="http://wkhtmltopdf.org/" \
 target="_blank">wkhtmltopdf.org</a>'),true);}
return trigger_download(self.session,response,c,action,options);});}else if(action.report_type==='controller'){return trigger_download(self.session,response,c,action,options);}}else{return self._super(action,options);}}});};;

/* /sales_team/static/src/js/sales_team.js defined in bundle 'web.assets_backend' */
openerp.crm=function(openerp){openerp.web_kanban.KanbanView.include({crm_display_members_names:function(){var self=this;var members_ids=[];self.$el.find('img[data-member_id]').each(function(){members_ids.push($(this).data('member_id'));});var dataset=new openerp.web.DataSetSearch(self,'res.users',self.session.context,[['id','in',_.uniq(members_ids)]]);dataset.read_slice(['id','name']).done(function(result){_.each(result,function(v,k){self.$el.find('img[data-member_id='+v.id+']').attr('title',v.name).tooltip();});});},on_groups_started:function(){var self=this;self._super.apply(self,arguments);if(self.dataset.model==='crm.case.section'){self.crm_display_members_names();}},});openerp.web_kanban.KanbanRecord.include({on_card_clicked:function(){if(this.view.dataset.model==='crm.case.section'){this.$('.oe_kanban_crm_salesteams_list a').first().click();}else{this._super.apply(this,arguments);}},});};;

/* /share/static/src/js/share.js defined in bundle 'web.assets_backend' */
openerp.share=function(session){var _t=session.web._t;var has_action_id=false;function launch_wizard(self,view,user_type,invite){var action=view.getParent().action;var Share=new session.web.DataSet(self,'share.wizard',view.dataset.get_context());var domain=new session.web.CompoundDomain(view.dataset.domain);if(view.fields_view.type=='form'){domain=new session.web.CompoundDomain(domain,[['id','=',view.datarecord.id]]);}
if(view.fields_view.type=='form')rec_name=view.datarecord.name;else rec_name='';session.web.pyeval.eval_domains_and_contexts({domains:[domain],contexts:[Share.get_context()]}).done(function(result){Share.create({name:action.name,record_name:rec_name,domain:result.domain,action_id:action.id,user_type:user_type||'embedded',view_type:view.fields_view.type,invite:invite||false,}).done(function(share_id){var step1=Share.call('go_step_1',[[share_id],Share.get_context()]).done(function(result){var action=result;self.do_action(action);});});});}
function has_share(yes,no){if(!session.session.share_flag){session.session.share_flag=$.Deferred(function(){var func=new session.web.Model("share.wizard").get_func("has_share");func(session.session.uid).then(function(res){if(res){session.session.share_flag.resolve();}else{session.session.share_flag.reject();}});});}
session.session.share_flag.done(yes).fail(no);}
session.web.Sidebar=session.web.Sidebar.extend({start:function(){var self=this;this._super(this);has_share(function(){self.add_items('other',[{label:_t('Share'),callback:self.on_click_share,classname:'oe_share'},{label:_t('Embed'),callback:self.on_click_share_link,classname:'oe_share'},]);});},on_click_share:function(item){var view=this.getParent()
launch_wizard(this,view,'emails',false);},on_click_share_link:function(item){var view=this.getParent()
launch_wizard(this,view,'embedded',false);},});session.mail.RecordThread.include({start:function(){start_res=this._super.apply(this,arguments);if(has_action_id){this.$el.find('button.oe_share_invite').show();}
return start_res;}});session.web.ViewManagerAction.include({start:function(){var self=this;this.check_if_action_is_defined();has_share(function(){self.$el.delegate('button.oe_share_invite','click',self.on_click_share_invite);});return this._super.apply(this,arguments);},check_if_action_is_defined:function(){if(this.action&&this.action.id){has_action_id=true;}
else{has_action_id=false;}},on_click_share_invite:function(e){e.preventDefault();launch_wizard(this,this.views[this.active_view].controller,'emails',true);},});};;

/* /stock/static/src/js/widgets.js defined in bundle 'web.assets_backend' */
function openerp_picking_widgets(instance){var module=instance.stock;var _t=instance.web._t;var QWeb=instance.web.qweb;module.MobileWidget=instance.web.Widget.extend({start:function(){if(!$('#oe-mobilewidget-viewport').length){$('head').append('<meta id="oe-mobilewidget-viewport" name="viewport" content="initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">');}
return this._super();},destroy:function(){$('#oe-mobilewidget-viewport').remove();return this._super();},});module.PickingEditorWidget=instance.web.Widget.extend({template:'PickingEditorWidget',init:function(parent,options){this._super(parent,options);var self=this;this.rows=[];this.search_filter="";jQuery.expr[":"].Contains=jQuery.expr.createPseudo(function(arg){return function(elem){return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase())>=0;};});},get_header:function(){return this.getParent().get_header();},get_location:function(){var model=this.getParent();var locations=[];var self=this;_.each(model.locations,function(loc){locations.push({name:loc.complete_name,id:loc.id,});});return locations;},get_logisticunit:function(){var model=this.getParent();var ul=[];var self=this;_.each(model.uls,function(ulog){ul.push({name:ulog.name,id:ulog.id,});});return ul;},get_rows:function(){var model=this.getParent();this.rows=[];var self=this;var pack_created=[];_.each(model.packoplines,function(packopline){var pack=undefined;var color="";if(packopline.product_id[1]!==undefined){pack=packopline.package_id[1];}
if(packopline.product_qty==packopline.qty_done){color="success ";}
if(packopline.product_qty<packopline.qty_done){color="danger ";}
if(packopline.result_package_id[1]!==undefined&&$.inArray(packopline.result_package_id[0],pack_created)===-1){var myPackage=$.grep(model.packages,function(e){return e.id==packopline.result_package_id[0];})[0];self.rows.push({cols:{product:packopline.result_package_id[1],qty:'',rem:'',uom:undefined,lot:undefined,pack:undefined,container:packopline.result_package_id[1],container_id:undefined,loc:packopline.location_id[1],dest:packopline.location_dest_id[1],id:packopline.result_package_id[0],product_id:undefined,can_scan:false,head_container:true,processed:packopline.processed,package_id:myPackage.id,ul_id:myPackage.ul_id[0],},classes:('success container_head ')+(packopline.processed==="true"?'processed hidden ':''),});pack_created.push(packopline.result_package_id[0]);}
self.rows.push({cols:{product:packopline.product_id[1]||packopline.package_id[1],qty:packopline.product_qty,rem:packopline.qty_done,uom:packopline.product_uom_id[1],lot:packopline.lot_id[1],pack:pack,container:packopline.result_package_id[1],container_id:packopline.result_package_id[0],loc:packopline.location_id[1],dest:packopline.location_dest_id[1],id:packopline.id,product_id:packopline.product_id[0],can_scan:packopline.result_package_id[1]===undefined?true:false,head_container:false,processed:packopline.processed,package_id:undefined,ul_id:-1,},classes:color+(packopline.result_package_id[1]!==undefined?'in_container_hidden ':'')+(packopline.processed==="true"?'processed hidden ':''),});});group_by_container=_.groupBy(self.rows,function(row){return row.cols.container;});var sorted_row=[];if(group_by_container.undefined!==undefined){group_by_container.undefined.sort(function(a,b){return(b.classes==='')-(a.classes==='');});$.each(group_by_container.undefined,function(key,value){sorted_row.push(value);});}
$.each(group_by_container,function(key,value){if(key!=='undefined'){$.each(value,function(k,v){sorted_row.push(v);});}});return sorted_row;},renderElement:function(){var self=this;this._super();this.check_content_screen();this.$('.js_pick_done').click(function(){self.getParent().done();});this.$('.js_pick_print').click(function(){self.getParent().print_picking();});this.$('.oe_pick_app_header').text(self.get_header());this.$('.oe_searchbox').keyup(function(event){self.on_searchbox($(this).val());});this.$('.js_putinpack').click(function(){self.getParent().pack();});this.$('.js_drop_down').click(function(){self.getParent().drop_down();});this.$('.js_clear_search').click(function(){self.on_searchbox('');self.$('.oe_searchbox').val('');});this.$('.oe_searchbox').focus(function(){self.getParent().barcode_scanner.disconnect();});this.$('.oe_searchbox').blur(function(){self.getParent().barcode_scanner.connect(function(ean){self.get_Parent().scan(ean);});})
this.$('#js_select').change(function(){var selection=self.$('#js_select option:selected').attr('value');if(selection==="ToDo"){self.getParent().$('.js_pick_pack').removeClass('hidden')
self.getParent().$('.js_drop_down').removeClass('hidden')
self.$('.js_pack_op_line.processed').addClass('hidden')
self.$('.js_pack_op_line:not(.processed)').removeClass('hidden')}
else{self.getParent().$('.js_pick_pack').addClass('hidden')
self.getParent().$('.js_drop_down').addClass('hidden')
self.$('.js_pack_op_line.processed').removeClass('hidden')
self.$('.js_pack_op_line:not(.processed)').addClass('hidden')}
self.on_searchbox(self.search_filter);});this.$('.js_plus').click(function(){var id=$(this).data('product-id');var op_id=$(this).parents("[data-id]:first").data('id');self.getParent().scan_product_id(id,true,op_id);});this.$('.js_minus').click(function(){var id=$(this).data('product-id');var op_id=$(this).parents("[data-id]:first").data('id');self.getParent().scan_product_id(id,false,op_id);});this.$('.js_unfold').click(function(){var op_id=$(this).parent().data('id');var line=$(this).parent();select=self.$('.js_pack_op_line.in_container_hidden[data-container-id='+op_id+']')
if(select.length>0){line.addClass('warning');select.removeClass('in_container_hidden');select.addClass('in_container');}
else{line.removeClass('warning');select=self.$('.js_pack_op_line.in_container[data-container-id='+op_id+']')
select.removeClass('in_container');select.addClass('in_container_hidden');}});this.$('.js_create_lot').click(function(){var op_id=$(this).parents("[data-id]:first").data('id');var lot_name=false;self.$('.js_lot_scan').val('');var $lot_modal=self.$el.siblings('#js_LotChooseModal');self.getParent().barcode_scanner.disconnect();$lot_modal.modal()
$lot_modal.on('shown.bs.modal',function(){self.$('.js_lot_scan').focus();})
$lot_modal.on('hidden.bs.modal',function(){self.getParent().barcode_scanner.connect(function(ean){self.getParent().scan(ean);});})
self.$('.js_lot_scan').focus();self.$('.js_validate_lot').click(function(){var name=self.$('.js_lot_scan').val();if(name.length!==0){lot_name=name;}
$lot_modal.modal('hide');self.getParent().barcode_scanner.connect(function(ean){self.getParent().scan(ean);});self.getParent().create_lot(op_id,lot_name);});});this.$('.js_delete_pack').click(function(){var pack_id=$(this).parents("[data-id]:first").data('id');self.getParent().delete_package_op(pack_id);});this.$('.js_print_pack').click(function(){var pack_id=$(this).parents("[data-id]:first").data('id');self.getParent().print_package(pack_id);});this.$('.js_submit_value').submit(function(event){var op_id=$(this).parents("[data-id]:first").data('id');var value=parseFloat($("input",this).val());if(value>=0){self.getParent().set_operation_quantity(value,op_id);}
$("input",this).val("");return false;});this.$('.js_qty').focus(function(){self.getParent().barcode_scanner.disconnect();});this.$('.js_qty').blur(function(){var op_id=$(this).parents("[data-id]:first").data('id');var value=parseFloat($(this).val());if(value>=0){self.getParent().set_operation_quantity(value,op_id);}
self.getParent().barcode_scanner.connect(function(ean){self.getParent().scan(ean);});});this.$('.js_change_src').click(function(){var op_id=$(this).parents("[data-id]:first").data('id');self.$('#js_loc_select').addClass('source');self.$('#js_loc_select').data('op-id',op_id);self.$el.siblings('#js_LocationChooseModal').modal();});this.$('.js_change_dst').click(function(){var op_id=$(this).parents("[data-id]:first").data('id');self.$('#js_loc_select').data('op-id',op_id);self.$el.siblings('#js_LocationChooseModal').modal();});this.$('.js_pack_change_dst').click(function(){var op_id=$(this).parents("[data-id]:first").data('id');self.$('#js_loc_select').addClass('pack');self.$('#js_loc_select').data('op-id',op_id);self.$el.siblings('#js_LocationChooseModal').modal();});this.$('.js_validate_location').click(function(){var select_dom_element=self.$('#js_loc_select');var loc_id=self.$('#js_loc_select option:selected').data('loc-id');var src_dst=false;var op_id=select_dom_element.data('op-id');if(select_dom_element.hasClass('pack')){select_dom_element.removeClass('source');op_ids=[];self.$('.js_pack_op_line[data-container-id='+op_id+']').each(function(){op_ids.push($(this).data('id'));});op_id=op_ids;}
else if(select_dom_element.hasClass('source')){src_dst=true;select_dom_element.removeClass('source');}
if(loc_id===false){self.$el.siblings('#js_LocationChooseModal').modal('hide');}
else{self.$el.siblings('#js_LocationChooseModal').modal('hide');self.getParent().change_location(op_id,parseInt(loc_id),src_dst);}});this.$('.js_pack_configure').click(function(){var pack_id=$(this).parents(".js_pack_op_line:first").data('package-id');var ul_id=$(this).parents(".js_pack_op_line:first").data('ulid');self.$('#js_packconf_select').val(ul_id);self.$('#js_packconf_select').data('pack-id',pack_id);self.$el.siblings('#js_PackConfModal').modal();});this.$('.js_validate_pack').click(function(){var select_dom_element=self.$('#js_packconf_select');var ul_id=self.$('#js_packconf_select option:selected').data('ul-id');var pack_id=select_dom_element.data('pack-id');self.$el.siblings('#js_PackConfModal').modal('hide');if(pack_id){self.getParent().set_package_pack(pack_id,ul_id);$('.container_head[data-package-id="'+pack_id+'"]').data('ulid',ul_id);}});$('td.navbar').html('<div></div>');},on_searchbox:function(query){this.search_filter=query;var processed=".processed";if(this.$('#js_select option:selected').attr('value')=="ToDo"){processed=":not(.processed)";}
if(query!==''){this.$('.js_loc:not(.js_loc:Contains('+query+'))').removeClass('info');this.$('.js_loc:Contains('+query+')').addClass('info');this.$('.js_pack_op_line'+processed+':not(.js_pack_op_line:has(.js_loc:Contains('+query+')))').addClass('hidden');this.$('.js_pack_op_line'+processed+':has(.js_loc:Contains('+query+'))').removeClass('hidden');}
if(query===''){this.$('.js_loc').removeClass('info');this.$('.js_pack_op_line'+processed+'.hidden').removeClass('hidden');}
this.check_content_screen();},check_content_screen:function(){var self=this;var processed=this.$('.js_pack_op_line.processed');var qties=this.$('.js_pack_op_line:not(.processed):not(.hidden) .js_qty').map(function(){return $(this).val()});var container=this.$('.js_pack_op_line.container_head:not(.processed):not(.hidden)')
var disabled=true;$.each(qties,function(index,value){if(parseInt(value)>0){disabled=false;}});if(disabled){if(container.length===0){self.$('.js_drop_down').addClass('disabled');}
else{self.$('.js_drop_down').removeClass('disabled');}
self.$('.js_pick_pack').addClass('disabled');if(processed.length===0){self.$('.js_pick_done').addClass('disabled');}
else{self.$('.js_pick_done').removeClass('disabled');}}
else{self.$('.js_drop_down').removeClass('disabled');self.$('.js_pick_pack').removeClass('disabled');self.$('.js_pick_done').removeClass('disabled');}},get_current_op_selection:function(ignore_container){pack_op_ids=[]
this.$('.js_pack_op_line:not(.processed):not(.js_pack_op_line.hidden):not(.container_head)').each(function(){cur_id=$(this).data('id');pack_op_ids.push(parseInt(cur_id));});list=[]
_.each(this.rows,function(row){if(row.cols.rem>0&&(ignore_container||row.cols.container===undefined)){list.push(row.cols.id);}});return _.intersection(pack_op_ids,list);},remove_blink:function(){this.$('.js_pack_op_line.blink_me').removeClass('blink_me');},blink:function(op_id){this.$('.js_pack_op_line[data-id="'+op_id+'"]').addClass('blink_me');},check_done:function(){var model=this.getParent();var self=this;var done=true;_.each(model.packoplines,function(packopline){if(packopline.processed==="false"){done=false;return done;}});return done;},get_visible_ids:function(){var self=this;var visible_op_ids=[]
var op_ids=this.$('.js_pack_op_line:not(.processed):not(.hidden):not(.container_head):not(.in_container):not(.in_container_hidden)').map(function(){return $(this).data('id');});$.each(op_ids,function(key,op_id){visible_op_ids.push(parseInt(op_id));});return visible_op_ids;},});module.PickingMenuWidget=module.MobileWidget.extend({template:'PickingMenuWidget',init:function(parent,params){this._super(parent,params);var self=this;$(window).bind('hashchange',function(){var states=$.bbq.getState();if(states.action==="stock.ui"){self.do_action({type:'ir.actions.client',tag:'stock.ui',target:'current',},{clear_breadcrumbs:true,});}});this.picking_types=[];this.loaded=this.load();this.scanning_type=0;this.barcode_scanner=new module.BarcodeScanner();this.pickings_by_type={};this.pickings_by_id={};this.picking_search_string="";},load:function(){var self=this;return new instance.web.Model('stock.picking.type').get_func('search_read')([],[]).then(function(types){self.picking_types=types;type_ids=[];for(var i=0;i<types.length;i++){self.pickings_by_type[types[i].id]=[];type_ids.push(types[i].id);}
self.pickings_by_type[0]=[];return new instance.web.Model('stock.picking').call('search_read',[[['state','in',['assigned','partially_available']],['picking_type_id','in',type_ids]],[]],{context:new instance.web.CompoundContext()});}).then(function(pickings){self.pickings=pickings;for(var i=0;i<pickings.length;i++){var picking=pickings[i];self.pickings_by_type[picking.picking_type_id[0]].push(picking);self.pickings_by_id[picking.id]=picking;self.picking_search_string+=''+picking.id+':'+(picking.name?picking.name.toUpperCase():'')+'\n';}});},renderElement:function(){this._super();var self=this;this.$('.js_pick_quit').click(function(){self.quit();});this.$('.js_pick_scan').click(function(){self.scan_picking($(this).data('id'));});this.$('.js_pick_last').click(function(){self.goto_last_picking_of_type($(this).data('id'));});this.$('.oe_searchbox').keyup(function(event){self.on_searchbox($(this).val());});$('td.navbar').html('<div></div>');},start:function(){this._super();var self=this;instance.webclient.set_content_full_screen(true);this.barcode_scanner.connect(function(barcode){self.on_scan(barcode);});this.loaded.then(function(){self.renderElement();});},goto_picking:function(picking_id){$.bbq.pushState('#action=stock.ui&picking_id='+picking_id);$(window).trigger('hashchange');},goto_last_picking_of_type:function(type_id){$.bbq.pushState('#action=stock.ui&picking_type_id='+type_id);$(window).trigger('hashchange');},search_picking:function(barcode){try{var re=RegExp("([0-9]+):.*?"+barcode.toUpperCase(),"gi");}
catch(e){return[];}
var results=[];for(var i=0;i<100;i++){r=re.exec(this.picking_search_string);if(r){var picking=this.pickings_by_id[Number(r[1])];if(picking){results.push(picking);}}else{break;}}
return results;},on_scan:function(barcode){var self=this;for(var i=0,len=this.pickings.length;i<len;i++){var picking=this.pickings[i];if(picking.name.toUpperCase()===$.trim(barcode.toUpperCase())){this.goto_picking(picking.id);break;}}
this.$('.js_picking_not_found').removeClass('hidden');clearTimeout(this.picking_not_found_timeout);this.picking_not_found_timeout=setTimeout(function(){self.$('.js_picking_not_found').addClass('hidden');},2000);},on_searchbox:function(query){var self=this;clearTimeout(this.searchbox_timeout);this.searchbox_timout=setTimeout(function(){if(query){self.$('.js_picking_not_found').addClass('hidden');self.$('.js_picking_categories').addClass('hidden');self.$('.js_picking_search_results').html(QWeb.render('PickingSearchResults',{results:self.search_picking(query)}));self.$('.js_picking_search_results .oe_picking').click(function(){self.goto_picking($(this).data('id'));});self.$('.js_picking_search_results').removeClass('hidden');}else{self.$('.js_title_label').removeClass('hidden');self.$('.js_picking_categories').removeClass('hidden');self.$('.js_picking_search_results').addClass('hidden');}},100);},quit:function(){return new instance.web.Model("ir.model.data").get_func("search_read")([['name','=','action_picking_type_form']],['res_id']).pipe(function(res){window.location='/web#action='+res[0]['res_id'];});},destroy:function(){this._super();this.barcode_scanner.disconnect();instance.webclient.set_content_full_screen(false);},});openerp.web.client_actions.add('stock.menu','instance.stock.PickingMenuWidget');module.PickingMainWidget=module.MobileWidget.extend({template:'PickingMainWidget',init:function(parent,params){this._super(parent,params);var self=this;$(window).bind('hashchange',function(){var states=$.bbq.getState();if(states.action==="stock.menu"){self.do_action({type:'ir.actions.client',tag:'stock.menu',target:'current',},{clear_breadcrumbs:true,});}});init_hash=$.bbq.getState();this.picking_type_id=init_hash.picking_type_id?init_hash.picking_type_id:0;this.picking_id=init_hash.picking_id?init_hash.picking_id:undefined;this.picking=null;this.pickings=[];this.packoplines=null;this.selected_operation={id:null,picking_id:null};this.packages=null;this.barcode_scanner=new module.BarcodeScanner();this.locations=[];this.uls=[];if(this.picking_id){this.loaded=this.load(this.picking_id);}else{this.loaded=this.load();}},load:function(picking_id){var self=this;function load_picking_list(type_id){var pickings=new $.Deferred();new instance.web.Model('stock.picking').call('get_next_picking_for_ui',[{'default_picking_type_id':parseInt(type_id)}]).then(function(picking_ids){if(!picking_ids||picking_ids.length===0){(new instance.web.Dialog(self,{title:_t('No Picking Available'),buttons:[{text:_t('Ok'),click:function(){self.menu();}}]},_t('<p>We could not find a picking to display.</p>'))).open();pickings.reject();}else{self.pickings=picking_ids;pickings.resolve(picking_ids);}});return pickings;}
if(picking_id){var loaded_picking=new instance.web.Model('stock.picking').call('read',[[parseInt(picking_id)],[],new instance.web.CompoundContext()]).then(function(picking){self.picking=picking[0];self.picking_type_id=picking[0].picking_type_id[0];return load_picking_list(self.picking.picking_type_id[0]);});}else{var loaded_picking=new $.Deferred();load_picking_list(self.picking_type_id).then(function(){return new instance.web.Model('stock.picking').call('read',[self.pickings[0],[],new instance.web.CompoundContext()]);}).then(function(picking){self.picking=picking;self.picking_type_id=picking.picking_type_id[0];loaded_picking.resolve();});}
return loaded_picking.then(function(){return new instance.web.Model('stock.location').call('search',[[['usage','=','internal']]]).then(function(locations_ids){return new instance.web.Model('stock.location').call('read',[locations_ids,[]]).then(function(locations){self.locations=locations;});});}).then(function(){return new instance.web.Model('stock.picking').call('check_group_pack').then(function(result){return self.show_pack=result;});}).then(function(){return new instance.web.Model('stock.picking').call('check_group_lot').then(function(result){return self.show_lot=result;});}).then(function(){if(self.picking.pack_operation_exist===false){self.picking.recompute_pack_op=false;return new instance.web.Model('stock.picking').call('do_prepare_partial',[[self.picking.id]]);}}).then(function(){return new instance.web.Model('stock.pack.operation').call('search',[[['picking_id','=',self.picking.id]]])}).then(function(pack_op_ids){return new instance.web.Model('stock.pack.operation').call('read',[pack_op_ids,[],new instance.web.CompoundContext()])}).then(function(operations){self.packoplines=operations;var package_ids=[];for(var i=0;i<operations.length;i++){if(!_.contains(package_ids,operations[i].result_package_id[0])){if(operations[i].result_package_id[0]){package_ids.push(operations[i].result_package_id[0]);}}}
return new instance.web.Model('stock.quant.package').call('read',[package_ids,[],new instance.web.CompoundContext()])}).then(function(packages){self.packages=packages;}).then(function(){return new instance.web.Model('product.ul').call('search',[[]])}).then(function(uls_ids){return new instance.web.Model('product.ul').call('read',[uls_ids,[]])}).then(function(uls){self.uls=uls;});},start:function(){this._super();var self=this;instance.webclient.set_content_full_screen(true);this.barcode_scanner.connect(function(ean){self.scan(ean);});this.$('.js_pick_quit').click(function(){self.quit();});this.$('.js_pick_prev').click(function(){self.picking_prev();});this.$('.js_pick_next').click(function(){self.picking_next();});this.$('.js_pick_menu').click(function(){self.menu();});this.$('.js_reload_op').click(function(){self.reload_pack_operation();});$.when(this.loaded).done(function(){self.picking_editor=new module.PickingEditorWidget(self);self.picking_editor.replace(self.$('.oe_placeholder_picking_editor'));if(self.picking.id===self.pickings[0]){self.$('.js_pick_prev').addClass('disabled');}else{self.$('.js_pick_prev').removeClass('disabled');}
if(self.picking.id===self.pickings[self.pickings.length-1]){self.$('.js_pick_next').addClass('disabled');}else{self.$('.js_pick_next').removeClass('disabled');}
if(self.picking.recompute_pack_op){self.$('.oe_reload_op').removeClass('hidden');}
else{self.$('.oe_reload_op').addClass('hidden');}
if(!self.show_pack){self.$('.js_pick_pack').addClass('hidden');}
if(!self.show_lot){self.$('.js_create_lot').addClass('hidden');}}).fail(function(error){console.log(error);});},on_searchbox:function(query){var self=this;self.picking_editor.on_searchbox(query.toUpperCase());},refresh_ui:function(picking_id){var self=this;var remove_search_filter="";if(self.picking.id===picking_id){remove_search_filter=self.$('.oe_searchbox').val();}
return this.load(picking_id).then(function(){self.picking_editor.remove_blink();self.picking_editor.renderElement();if(!self.show_pack){self.$('.js_pick_pack').addClass('hidden');}
if(!self.show_lot){self.$('.js_create_lot').addClass('hidden');}
if(self.picking.recompute_pack_op){self.$('.oe_reload_op').removeClass('hidden');}
else{self.$('.oe_reload_op').addClass('hidden');}
if(self.picking.id===self.pickings[0]){self.$('.js_pick_prev').addClass('disabled');}else{self.$('.js_pick_prev').removeClass('disabled');}
if(self.picking.id===self.pickings[self.pickings.length-1]){self.$('.js_pick_next').addClass('disabled');}else{self.$('.js_pick_next').removeClass('disabled');}
if(remove_search_filter===""){self.$('.oe_searchbox').val('');self.on_searchbox('');}
else{self.$('.oe_searchbox').val(remove_search_filter);self.on_searchbox(remove_search_filter);}});},get_header:function(){if(this.picking){return this.picking.name;}else{return'';}},menu:function(){$.bbq.pushState('#action=stock.menu');$(window).trigger('hashchange');},scan:function(ean){var self=this;var product_visible_ids=this.picking_editor.get_visible_ids();return new instance.web.Model('stock.picking').call('process_barcode_from_ui',[self.picking.id,ean,product_visible_ids]).then(function(result){if(result.filter_loc!==false){if(result.filter_loc!==undefined){var modal_loc_hidden=self.$('#js_LocationChooseModal').attr('aria-hidden');if(modal_loc_hidden==="false"){var line=self.$('#js_LocationChooseModal .js_loc_option[data-loc-id='+result.filter_loc_id+']').attr('selected','selected');}
else{self.$('.oe_searchbox').val(result.filter_loc);self.on_searchbox(result.filter_loc);}}}
if(result.operation_id!==false){self.refresh_ui(self.picking.id).then(function(){return self.picking_editor.blink(result.operation_id);});}});},scan_product_id:function(product_id,increment,op_id){var self=this;return new instance.web.Model('stock.picking').call('process_product_id_from_ui',[self.picking.id,product_id,op_id,increment]).then(function(result){return self.refresh_ui(self.picking.id);});},pack:function(){var self=this;var pack_op_ids=self.picking_editor.get_current_op_selection(false);if(pack_op_ids.length!==0){return new instance.web.Model('stock.picking').call('action_pack',[[[self.picking.id]],pack_op_ids]).then(function(pack){instance.session.user_context.current_package_id=false;return self.refresh_ui(self.picking.id);});}},drop_down:function(){var self=this;var pack_op_ids=self.picking_editor.get_current_op_selection(true);if(pack_op_ids.length!==0){return new instance.web.Model('stock.pack.operation').call('action_drop_down',[pack_op_ids]).then(function(){return self.refresh_ui(self.picking.id).then(function(){if(self.picking_editor.check_done()){return self.done();}});});}},done:function(){var self=this;return new instance.web.Model('stock.picking').call('action_done_from_ui',[self.picking.id,{'default_picking_type_id':self.picking_type_id}]).then(function(new_picking_ids){if(new_picking_ids){return self.refresh_ui(new_picking_ids[0]);}
else{return 0;}});},create_lot:function(op_id,lot_name){var self=this;return new instance.web.Model('stock.pack.operation').call('create_and_assign_lot',[parseInt(op_id),lot_name]).then(function(){return self.refresh_ui(self.picking.id);});},change_location:function(op_id,loc_id,is_src_dst){var self=this;var vals={'location_dest_id':loc_id};if(is_src_dst){vals={'location_id':loc_id};}
return new instance.web.Model('stock.pack.operation').call('write',[op_id,vals]).then(function(){return self.refresh_ui(self.picking.id);});},print_package:function(package_id){var self=this;return new instance.web.Model('stock.quant.package').call('action_print',[[package_id]]).then(function(action){return self.do_action(action);});},print_picking:function(){var self=this;return new instance.web.Model('stock.picking.type').call('read',[[self.picking_type_id],['code'],new instance.web.CompoundContext()]).then(function(pick_type){return new instance.web.Model('stock.picking').call('do_print_picking',[[self.picking.id]]).then(function(action){return self.do_action(action);});});},picking_next:function(){for(var i=0;i<this.pickings.length;i++){if(this.pickings[i]===this.picking.id){if(i<this.pickings.length-1){$.bbq.pushState('picking_id='+this.pickings[i+1]);this.refresh_ui(this.pickings[i+1]);return;}}}},picking_prev:function(){for(var i=0;i<this.pickings.length;i++){if(this.pickings[i]===this.picking.id){if(i>0){$.bbq.pushState('picking_id='+this.pickings[i-1]);this.refresh_ui(this.pickings[i-1]);return;}}}},delete_package_op:function(pack_id){var self=this;return new instance.web.Model('stock.pack.operation').call('search',[[['result_package_id','=',pack_id]]]).then(function(op_ids){return new instance.web.Model('stock.pack.operation').call('write',[op_ids,{'result_package_id':false}]).then(function(){return self.refresh_ui(self.picking.id);});});},set_operation_quantity:function(quantity,op_id){var self=this;if(quantity>=0){return new instance.web.Model('stock.pack.operation').call('write',[[op_id],{'qty_done':quantity}]).then(function(){self.refresh_ui(self.picking.id);});}},set_package_pack:function(package_id,pack){var self=this;return new instance.web.Model('stock.quant.package').call('write',[[package_id],{'ul_id':pack}]);return;},reload_pack_operation:function(){var self=this;return new instance.web.Model('stock.picking').call('do_prepare_partial',[[self.picking.id]]).then(function(){self.refresh_ui(self.picking.id);});},quit:function(){this.destroy();return new instance.web.Model("ir.model.data").get_func("search_read")([['name','=','action_picking_type_form']],['res_id']).pipe(function(res){window.location='/web#action='+res[0]['res_id'];});},destroy:function(){this._super();this.barcode_scanner.disconnect();instance.webclient.set_content_full_screen(false);},});openerp.web.client_actions.add('stock.ui','instance.stock.PickingMainWidget');module.BarcodeScanner=instance.web.Class.extend({connect:function(callback){var code="";var timeStamp=0;var timeout=null;this.handler=function(e){if(e.which===13){return;}
if(timeStamp+50<new Date().getTime()){code="";}
timeStamp=new Date().getTime();clearTimeout(timeout);code+=String.fromCharCode(e.which);timeout=setTimeout(function(){if(code.length>=3){callback(code);}
code="";},100);};$('body').on('keypress',this.handler);},disconnect:function(){$('body').off('keypress',this.handler);},});}
openerp.stock=function(openerp){openerp.stock=openerp.stock||{};openerp_picking_widgets(openerp);};

/* /web_analytics/static/src/js/web_analytics.js defined in bundle 'web.assets_backend' */
var _gaq=_gaq||[];openerp.web_analytics=function(instance){(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'===document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();instance.web_analytics.Tracker=instance.web.Class.extend({init:function(webclient){var self=this;self.initialized=$.Deferred();_gaq.push(['_setAccount','UA-7333765-1']);_gaq.push(['_setDomainName','.openerp.com']);self.initialize_custom(webclient).then(function(){webclient.on('state_pushed',self,self.on_state_pushed);self.include_tracker();});},_get_user_type:function(){return'Local User';},_get_user_access_level:function(){if(!instance.session.session_is_valid()){return"Unauthenticated User";}
if(instance.session.uid===1){return'Admin User';}
if(instance.session.username.indexOf('@')!==-1){return'Portal User';}
if(instance.session.username==='anonymous'){return'Anonymous User';}
return'Normal User';},initialize_custom:function(){var self=this;instance.session.rpc("/web/webclient/version_info",{}).done(function(res){_gaq.push(['_setCustomVar',5,'Version',res.server_version,3]);self._push_customvars();self.initialized.resolve(self);});return self.initialized;},_push_customvars:function(){var self=this;_gaq.push(['_setCustomVar',4,'User Access Level',self._get_user_access_level(),1]);_gaq.push(['_setCustomVar',1,'User Type Conversion',self._get_user_type(),2]);},_push_pageview:function(url){_gaq.push(['_trackPageview',url]);},_push_event:function(options){_gaq.push(['_trackEvent',options.category,options.action,options.label,options.value,options.noninteraction]);},_push_ecommerce:function(trans_data,item_list){_gaq.push(['_addTrans',trans_data.order_id,trans_data.store_name,trans_data.total,trans_data.tax,trans_data.shipping,trans_data.city,trans_data.state,trans_data.country,]);_.each(item_list,function(item){_gaq.push(['_addItem',item.order_id,item.sku,item.name,item.category,item.price,item.quantity,]);});_gaq.push(['_trackTrans']);},on_state_pushed:function(state){if(state.model&&state.view_type){var url=instance.web_analytics.generateUrl({'model':state.model,'view_type':state.view_type});this._push_event({'category':state.model,'action':state.view_type,'label':url,});this._push_pageview(url);}},include_tracker:function(){var t=this;instance.web.FormView.include({init:function(parent,dataset,view_id,options){this._super.apply(this,arguments);var self=this;this.on('record_created',self,function(r){var url=instance.web_analytics.generateUrl({'model':self.model,'view_type':'form'});t._push_event({'category':self.model,'action':'create','label':url,'noninteraction':true,});});this.on('record_saved',self,function(r){var url=instance.web_analytics.generateUrl({'model':self.model,'view_type':'form'});t._push_event({'category':self.model,'action':'save','label':url,'noninteraction':true,});});}});instance.web.ActionManager.include({ir_actions_client:function(action,options){var url=instance.web_analytics.generateUrl({'action':action.tag});t._push_event({'category':action.type,'action':action.tag,'label':url,});t._push_pageview(url);return this._super.apply(this,arguments);},});instance.web.View.include({do_execute_action:function(action_data,dataset,record_id,on_closed){var category=this.model||dataset.model||'';var action;if(action_data.name&&_.isNaN(action_data.name-0)){action=action_data.name;}else{action=action_data.string||action_data.special||'';}
var url=instance.web_analytics.generateUrl({'model':category,'view_type':this.view_type});t._push_event({'category':category,'action':action,'label':url,'noninteraction':true,});return this._super.apply(this,arguments);},});instance.web.CrashManager.include({show_error:function(error){var hash=window.location.hash;var params=$.deparam(hash.substr(hash.indexOf('#')+1));var options={};if(params.model&&params.view_type){options={'model':params.model,'view_type':params.view_type};}else{options={'action':params.action};}
var url=instance.web_analytics.generateUrl(options);t._push_event({'category':options.model||"ir.actions.client",'action':"error "+(error.code?error.message+error.data.message:error.type+error.data.debug),'label':url,'noninteraction':true,});this._super.apply(this,arguments);},});},});instance.web_analytics.generateUrl=function(options){var url='';var keys=_.keys(options);keys=_.sortBy(keys,function(i){return i;});_.each(keys,function(key){url+='/'+key+'/'+options[key];});return url;};instance.web_analytics.setupTracker=function(wc){return wc.tracker.initialized;};instance.web.Client.include({bind_events:function(){this._super.apply(this,arguments);this.tracker=new instance.web_analytics.Tracker(this);},});instance.web.Session.include({session_authenticate:function(){return $.when(this._super.apply(this,arguments)).then(function(){if(instance.client&&instance.client.tracker){instance.client.tracker._push_customvars();}});},});};;

/* /web_calendar/static/lib/fullcalendar/js/fullcalendar.js defined in bundle 'web.assets_backend' */
(function($,undefined){;;var defaults={defaultView:'month',aspectRatio:1.35,header:{left:'title',center:'',right:'today prev,next'},weekends:true,weekNumbers:false,weekNumberCalculation:'iso',weekNumberTitle:'W',allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:'start',endParam:'end',titleFormat:{month:'MMMM yyyy',week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:'dddd, MMM d, yyyy'},columnFormat:{month:'ddd',week:'ddd M/d',day:'dddd M/d'},timeFormat:{'':'h(:mm)t'},isRTL:false,firstDay:0,monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],buttonText:{prev:"<span class='fc-text-arrow'>&lsaquo;</span>",next:"<span class='fc-text-arrow'>&rsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&laquo;</span>",nextYear:"<span class='fc-text-arrow'>&raquo;</span>",today:'today',month:'month',week:'week',day:'day'},theme:false,buttonIcons:{prev:'circle-triangle-w',next:'circle-triangle-e'},unselectAuto:true,dropAccept:'*',handleWindowResize:true};var rtlDefaults={header:{left:'next,prev today',center:'',right:'title'},buttonText:{prev:"<span class='fc-text-arrow'>&rsaquo;</span>",next:"<span class='fc-text-arrow'>&lsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&raquo;</span>",nextYear:"<span class='fc-text-arrow'>&laquo;</span>"},buttonIcons:{prev:'circle-triangle-e',next:'circle-triangle-w'}};;;var fc=$.fullCalendar={version:"1.6.4"};var fcViews=fc.views={};$.fn.fullCalendar=function(options){if(typeof options=='string'){var args=Array.prototype.slice.call(arguments,1);var res;this.each(function(){var calendar=$.data(this,'fullCalendar');if(calendar&&$.isFunction(calendar[options])){var r=calendar[options].apply(calendar,args);if(res===undefined){res=r;}
if(options=='destroy'){$.removeData(this,'fullCalendar');}}});if(res!==undefined){return res;}
return this;}
options=options||{};var eventSources=options.eventSources||[];delete options.eventSources;if(options.events){eventSources.push(options.events);delete options.events;}
options=$.extend(true,{},defaults,(options.isRTL||options.isRTL===undefined&&defaults.isRTL)?rtlDefaults:{},options);this.each(function(i,_element){var element=$(_element);var calendar=new Calendar(element,options,eventSources);element.data('fullCalendar',calendar);calendar.render();});return this;};function setDefaults(d){$.extend(true,defaults,d);};;function Calendar(element,options,eventSources){var t=this;t.options=options;t.render=render;t.destroy=destroy;t.refetchEvents=refetchEvents;t.reportEvents=reportEvents;t.reportEventChange=reportEventChange;t.rerenderEvents=rerenderEvents;t.changeView=changeView;t.select=select;t.unselect=unselect;t.prev=prev;t.next=next;t.prevYear=prevYear;t.nextYear=nextYear;t.today=today;t.gotoDate=gotoDate;t.incrementDate=incrementDate;t.formatDate=function(format,date){return formatDate(format,date,options)};t.formatDates=function(format,date1,date2){return formatDates(format,date1,date2,options)};t.getDate=getDate;t.getView=getView;t.option=option;t.trigger=trigger;EventManager.call(t,options,eventSources);var isFetchNeeded=t.isFetchNeeded;var fetchEvents=t.fetchEvents;var _element=element[0];var header;var headerElement;var content;var tm;var currentView;var elementOuterWidth;var suggestedViewHeight;var resizeUID=0;var ignoreWindowResize=0;var date=new Date();var events=[];var _dragElement;setYMD(date,options.year,options.month,options.date);function render(inc){if(!content){initialRender();}
else if(elementVisible()){calcSize();_renderView(inc);}}
function initialRender(){tm=options.theme?'ui':'fc';element.addClass('fc');if(options.isRTL){element.addClass('fc-rtl');}
else{element.addClass('fc-ltr');}
if(options.theme){element.addClass('ui-widget');}
content=$("<div class='fc-content' style='position:relative'/>").prependTo(element);header=new Header(t,options);headerElement=header.render();if(headerElement){element.prepend(headerElement);}
changeView(options.defaultView);if(options.handleWindowResize){$(window).resize(windowResize);}
if(!bodyVisible()){lateRender();}}
function lateRender(){setTimeout(function(){if(!currentView.start&&bodyVisible()){renderView();}},0);}
function destroy(){if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);currentView.triggerEventDestroy();}
$(window).unbind('resize',windowResize);header.destroy();content.remove();element.removeClass('fc fc-rtl ui-widget');}
function elementVisible(){return element.is(':visible');}
function bodyVisible(){return $('body').is(':visible');}
function changeView(newViewName){if(!currentView||newViewName!=currentView.name){_changeView(newViewName);}}
function _changeView(newViewName){ignoreWindowResize++;if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();currentView.triggerEventDestroy();freezeContentHeight();currentView.element.remove();header.deactivateButton(currentView.name);}
header.activateButton(newViewName);currentView=new fcViews[newViewName]($("<div class='fc-view fc-view-"+newViewName+"' style='position:relative'/>").appendTo(content),t);renderView();unfreezeContentHeight();ignoreWindowResize--;}
function renderView(inc){if(!currentView.start||inc||date<currentView.start||date>=currentView.end){if(elementVisible()){_renderView(inc);}}}
function _renderView(inc){ignoreWindowResize++;if(currentView.start){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();clearEvents();}
freezeContentHeight();currentView.render(date,inc||0);setSize();unfreezeContentHeight();(currentView.afterRender||noop)();updateTitle();updateTodayButton();trigger('viewRender',currentView,currentView,currentView.element);currentView.trigger('viewDisplay',_element);ignoreWindowResize--;getAndRenderEvents();}
function updateSize(){if(elementVisible()){unselect();clearEvents();calcSize();setSize();renderEvents();}}
function calcSize(){if(options.contentHeight){suggestedViewHeight=options.contentHeight;}
else if(options.height){suggestedViewHeight=options.height-(headerElement?headerElement.height():0)-vsides(content);}
else{suggestedViewHeight=Math.round(content.width()/Math.max(options.aspectRatio,.5));}}
function setSize(){if(suggestedViewHeight===undefined){calcSize();}
ignoreWindowResize++;currentView.setHeight(suggestedViewHeight);currentView.setWidth(content.width());ignoreWindowResize--;elementOuterWidth=element.outerWidth();}
function windowResize(){if(!ignoreWindowResize){if(currentView.start){var uid=++resizeUID;setTimeout(function(){if(uid==resizeUID&&!ignoreWindowResize&&elementVisible()){if(elementOuterWidth!=(elementOuterWidth=element.outerWidth())){ignoreWindowResize++;updateSize();currentView.trigger('windowResize',_element);ignoreWindowResize--;}}},200);}else{lateRender();}}}
function refetchEvents(){clearEvents();fetchAndRenderEvents();}
function rerenderEvents(modifiedEventID){clearEvents();renderEvents(modifiedEventID);}
function renderEvents(modifiedEventID){if(elementVisible()){currentView.setEventData(events);currentView.renderEvents(events,modifiedEventID);currentView.trigger('eventAfterAllRender');}}
function clearEvents(){currentView.triggerEventDestroy();currentView.clearEvents();currentView.clearEventData();}
function getAndRenderEvents(){if(!options.lazyFetching||isFetchNeeded(currentView.visStart,currentView.visEnd)){fetchAndRenderEvents();}
else{renderEvents();}}
function fetchAndRenderEvents(){fetchEvents(currentView.visStart,currentView.visEnd);}
function reportEvents(_events){events=_events;renderEvents();}
function reportEventChange(eventID){rerenderEvents(eventID);}
function updateTitle(){header.updateTitle(currentView.title);}
function updateTodayButton(){var today=new Date();if(today>=currentView.start&&today<currentView.end){header.disableButton('today');}
else{header.enableButton('today');}}
function select(start,end,allDay){currentView.select(start,end,allDay===undefined?true:allDay);}
function unselect(){if(currentView){currentView.unselect();}}
function prev(){renderView(-1);}
function next(){renderView(1);}
function prevYear(){addYears(date,-1);renderView();}
function nextYear(){addYears(date,1);renderView();}
function today(){date=new Date();renderView();}
function gotoDate(year,month,dateOfMonth){if(year instanceof Date){date=cloneDate(year);}else{setYMD(date,year,month,dateOfMonth);}
renderView();}
function incrementDate(years,months,days){if(years!==undefined){addYears(date,years);}
if(months!==undefined){addMonths(date,months);}
if(days!==undefined){addDays(date,days);}
renderView();}
function getDate(){return cloneDate(date);}
function freezeContentHeight(){content.css({width:'100%',height:content.height(),overflow:'hidden'});}
function unfreezeContentHeight(){content.css({width:'',height:'',overflow:''});}
function getView(){return currentView;}
function option(name,value){if(value===undefined){return options[name];}
if(name=='height'||name=='contentHeight'||name=='aspectRatio'){options[name]=value;updateSize();}}
function trigger(name,thisObj){if(options[name]){return options[name].apply(thisObj||_element,Array.prototype.slice.call(arguments,2));}}
if(options.droppable){$(document).bind('dragstart',function(ev,ui){var _e=ev.target;var e=$(_e);if(!e.parents('.fc').length){var accept=options.dropAccept;if($.isFunction(accept)?accept.call(_e,e):e.is(accept)){_dragElement=_e;currentView.dragStart(_dragElement,ev,ui);}}}).bind('dragstop',function(ev,ui){if(_dragElement){currentView.dragStop(_dragElement,ev,ui);_dragElement=null;}});}};;function Header(calendar,options){var t=this;t.render=render;t.destroy=destroy;t.updateTitle=updateTitle;t.activateButton=activateButton;t.deactivateButton=deactivateButton;t.disableButton=disableButton;t.enableButton=enableButton;var element=$([]);var tm;function render(){tm=options.theme?'ui':'fc';var sections=options.header;if(sections){element=$("<table class='fc-header' style='width:100%'/>").append($("<tr/>").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));return element;}}
function destroy(){element.remove();}
function renderSection(position){var e=$("<td class='fc-header-"+position+"'/>");var buttonStr=options.header[position];if(buttonStr){$.each(buttonStr.split(' '),function(i){if(i>0){e.append("<span class='fc-header-space'/>");}
var prevButton;$.each(this.split(','),function(j,buttonName){if(buttonName=='title'){e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(prevButton){prevButton.addClass(tm+'-corner-right');}
prevButton=null;}else{var buttonClick;if(calendar[buttonName]){buttonClick=calendar[buttonName];}
else if(fcViews[buttonName]){buttonClick=function(){button.removeClass(tm+'-state-hover');calendar.changeView(buttonName);};}
if(buttonClick){var icon=options.theme?smartProperty(options.buttonIcons,buttonName):null;var text=smartProperty(options.buttonText,buttonName);var button=$("<span class='fc-button fc-button-"+buttonName+" "+tm+"-state-default'>"+
(icon?"<span class='fc-icon-wrap'>"+"<span class='ui-icon ui-icon-"+icon+"'/>"+"</span>":text)+"</span>").click(function(){if(!button.hasClass(tm+'-state-disabled')){buttonClick();}}).mousedown(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-down');}).mouseup(function(){button.removeClass(tm+'-state-down');}).hover(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-hover');},function(){button.removeClass(tm+'-state-hover').removeClass(tm+'-state-down');}).appendTo(e);disableTextSelection(button);if(!prevButton){button.addClass(tm+'-corner-left');}
prevButton=button;}}});if(prevButton){prevButton.addClass(tm+'-corner-right');}});}
return e;}
function updateTitle(html){element.find('h2').html(html);}
function activateButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-active');}
function deactivateButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-active');}
function disableButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-disabled');}
function enableButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-disabled');}};;fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:'json',cache:false};var eventGUID=1;function EventManager(options,_sources){var t=this;t.isFetchNeeded=isFetchNeeded;t.fetchEvents=fetchEvents;t.addEventSource=addEventSource;t.removeEventSource=removeEventSource;t.updateEvent=updateEvent;t.renderEvent=renderEvent;t.removeEvents=removeEvents;t.clientEvents=clientEvents;t.normalizeEvent=normalizeEvent;var trigger=t.trigger;var getView=t.getView;var reportEvents=t.reportEvents;var stickySource={events:[]};var sources=[stickySource];var rangeStart,rangeEnd;var currentFetchID=0;var pendingSourceCnt=0;var loadingLevel=0;var cache=[];for(var i=0;i<_sources.length;i++){_addEventSource(_sources[i]);}
function isFetchNeeded(start,end){return!rangeStart||start<rangeStart||end>rangeEnd;}
function fetchEvents(start,end){rangeStart=start;rangeEnd=end;cache=[];var fetchID=++currentFetchID;var len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++){fetchEventSource(sources[i],fetchID);}}
function fetchEventSource(source,fetchID){_fetchEventSource(source,function(events){if(fetchID==currentFetchID){if(events){if(options.eventDataTransform){events=$.map(events,options.eventDataTransform);}
if(source.eventDataTransform){events=$.map(events,source.eventDataTransform);}
for(var i=0;i<events.length;i++){events[i].source=source;normalizeEvent(events[i]);}
cache=cache.concat(events);}
pendingSourceCnt--;if(!pendingSourceCnt){reportEvents(cache);}}});}
function _fetchEventSource(source,callback){var i;var fetchers=fc.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){res=fetchers[i](source,rangeStart,rangeEnd,callback);if(res===true){return;}
else if(typeof res=='object'){_fetchEventSource(res,callback);return;}}
var events=source.events;if(events){if($.isFunction(events)){pushLoading();events(cloneDate(rangeStart),cloneDate(rangeEnd),function(events){callback(events);popLoading();});}
else if($.isArray(events)){callback(events);}
else{callback();}}else{var url=source.url;if(url){var success=source.success;var error=source.error;var complete=source.complete;var customData;if($.isFunction(source.data)){customData=source.data();}
else{customData=source.data;}
var data=$.extend({},customData||{});var startParam=firstDefined(source.startParam,options.startParam);var endParam=firstDefined(source.endParam,options.endParam);if(startParam){data[startParam]=Math.round(+rangeStart/1000);}
if(endParam){data[endParam]=Math.round(+rangeEnd/1000);}
pushLoading();$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);if($.isArray(res)){events=res;}
callback(events);},error:function(){applyAll(error,this,arguments);callback();},complete:function(){applyAll(complete,this,arguments);popLoading();}}));}else{callback();}}}
function addEventSource(source){source=_addEventSource(source);if(source){pendingSourceCnt++;fetchEventSource(source,currentFetchID);}}
function _addEventSource(source){if($.isFunction(source)||$.isArray(source)){source={events:source};}
else if(typeof source=='string'){source={url:source};}
if(typeof source=='object'){normalizeSource(source);sources.push(source);return source;}}
function removeEventSource(source){sources=$.grep(sources,function(src){return!isSourcesEqual(src,source);});cache=$.grep(cache,function(e){return!isSourcesEqual(e.source,source);});reportEvents(cache);}
function updateEvent(event){var i,len=cache.length,e,defaultEventEnd=getView().defaultEventEnd,startDelta=event.start-event._start,endDelta=event.end?(event.end-(event._end||defaultEventEnd(event))):0;for(i=0;i<len;i++){e=cache[i];if(e._id==event._id&&e!=event){e.start=new Date(+e.start+startDelta);if(event.end){if(e.end){e.end=new Date(+e.end+endDelta);}else{e.end=new Date(+defaultEventEnd(e)+endDelta);}}else{e.end=null;}
e.title=event.title;e.url=event.url;e.allDay=event.allDay;e.className=event.className;e.editable=event.editable;e.color=event.color;e.backgroundColor=event.backgroundColor;e.borderColor=event.borderColor;e.textColor=event.textColor;normalizeEvent(e);}}
normalizeEvent(event);reportEvents(cache);}
function renderEvent(event,stick){normalizeEvent(event);if(!event.source){if(stick){stickySource.events.push(event);event.source=stickySource;}
cache.push(event);}
reportEvents(cache);}
function removeEvents(filter){if(!filter){cache=[];for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=[];}}}else{if(!$.isFunction(filter)){var id=filter+'';filter=function(e){return e._id==id;};}
cache=$.grep(cache,filter,true);for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=$.grep(sources[i].events,filter,true);}}}
reportEvents(cache);}
function clientEvents(filter){if($.isFunction(filter)){return $.grep(cache,filter);}
else if(filter){filter+='';return $.grep(cache,function(e){return e._id==filter;});}
return cache;}
function pushLoading(){if(!loadingLevel++){trigger('loading',null,true,getView());}}
function popLoading(){if(!--loadingLevel){trigger('loading',null,false,getView());}}
function normalizeEvent(event){var source=event.source||{};var ignoreTimezone=firstDefined(source.ignoreTimezone,options.ignoreTimezone);event._id=event._id||(event.id===undefined?'_fc'+eventGUID++:event.id+'');if(event.date){if(!event.start){event.start=event.date;}
delete event.date;}
event._start=cloneDate(event.start=parseDate(event.start,ignoreTimezone));event.end=parseDate(event.end,ignoreTimezone);if(event.end&&event.end<=event.start){event.end=null;}
event._end=event.end?cloneDate(event.end):null;if(event.allDay===undefined){event.allDay=firstDefined(source.allDayDefault,options.allDayDefault);}
if(event.className){if(typeof event.className=='string'){event.className=event.className.split(/\s+/);}}else{event.className=[];}}
function normalizeSource(source){if(source.className){if(typeof source.className=='string'){source.className=source.className.split(/\s+/);}}else{source.className=[];}
var normalizers=fc.sourceNormalizers;for(var i=0;i<normalizers.length;i++){normalizers[i](source);}}
function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2);}
function getSourcePrimitive(source){return((typeof source=='object')?(source.events||source.url):'')||source;}};;fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.parseISO8601=parseISO8601;fc.parseTime=parseTime;fc.formatDate=formatDate;fc.formatDates=formatDates;var dayIDs=['sun','mon','tue','wed','thu','fri','sat'],DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addYears(d,n,keepTime){d.setFullYear(d.getFullYear()+n);if(!keepTime){clearTime(d);}
return d;}
function addMonths(d,n,keepTime){if(+d){var m=d.getMonth()+n,check=cloneDate(d);check.setDate(1);check.setMonth(m);d.setMonth(m);if(!keepTime){clearTime(d);}
while(d.getMonth()!=check.getMonth()){d.setDate(d.getDate()+(d<check?1:-1));}}
return d;}
function addDays(d,n,keepTime){if(+d){var dd=d.getDate()+n,check=cloneDate(d);check.setHours(9);check.setDate(dd);d.setDate(dd);if(!keepTime){clearTime(d);}
fixDate(d,check);}
return d;}
function fixDate(d,check){if(+d){while(d.getDate()!=check.getDate()){d.setTime(+d+(d<check?1:-1)*HOUR_MS);}}}
function addMinutes(d,n){d.setMinutes(d.getMinutes()+n);return d;}
function clearTime(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d;}
function cloneDate(d,dontKeepTime){if(dontKeepTime){return clearTime(new Date(+d));}
return new Date(+d);}
function zeroDate(){var i=0,d;do{d=new Date(1970,i++,1);}while(d.getHours());return d;}
function dayDiff(d1,d2){return Math.round((cloneDate(d1,true)-cloneDate(d2,true))/DAY_MS);}
function setYMD(date,y,m,d){if(y!==undefined&&y!=date.getFullYear()){date.setDate(1);date.setMonth(0);date.setFullYear(y);}
if(m!==undefined&&m!=date.getMonth()){date.setDate(1);date.setMonth(m);}
if(d!==undefined){date.setDate(d);}}
function parseDate(s,ignoreTimezone){if(typeof s=='object'){return s;}
if(typeof s=='number'){return new Date(s*1000);}
if(typeof s=='string'){if(s.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(s)*1000);}
if(ignoreTimezone===undefined){ignoreTimezone=true;}
return parseISO8601(s,ignoreTimezone)||(s?new Date(s):null);}
return null;}
function parseISO8601(s,ignoreTimezone){var m=s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!m){return null;}
var date=new Date(m[1],0,1);if(ignoreTimezone||!m[13]){var check=new Date(m[1],0,1,9,0);if(m[3]){date.setMonth(m[3]-1);check.setMonth(m[3]-1);}
if(m[5]){date.setDate(m[5]);check.setDate(m[5]);}
fixDate(date,check);if(m[7]){date.setHours(m[7]);}
if(m[8]){date.setMinutes(m[8]);}
if(m[10]){date.setSeconds(m[10]);}
if(m[12]){date.setMilliseconds(Number("0."+m[12])*1000);}
fixDate(date,check);}else{date.setUTCFullYear(m[1],m[3]?m[3]-1:0,m[5]||1);date.setUTCHours(m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1000:0);if(m[14]){var offset=Number(m[16])*60+(m[18]?Number(m[18]):0);offset*=m[15]=='-'?1:-1;date=new Date(+date+(offset*60*1000));}}
return date;}
function parseTime(s){if(typeof s=='number'){return s*60;}
if(typeof s=='object'){return s.getHours()*60+s.getMinutes();}
var m=s.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(m){var h=parseInt(m[1],10);if(m[3]){h%=12;if(m[3].toLowerCase().charAt(0)=='p'){h+=12;}}
return h*60+(m[2]?parseInt(m[2],10):0);}}
function formatDate(date,format,options){return formatDates(date,null,format,options);}
function formatDates(date1,date2,format,options){options=options||defaults;var date=date1,otherDate=date2,i,len=format.length,c,i2,formatter,res='';for(i=0;i<len;i++){c=format.charAt(i);if(c=="'"){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="'"){if(date){if(i2==i+1){res+="'";}else{res+=format.substring(i+1,i2);}
i=i2;}
break;}}}
else if(c=='('){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==')'){var subres=formatDate(date,format.substring(i+1,i2),options);if(parseInt(subres.replace(/\D/,''),10)){res+=subres;}
i=i2;break;}}}
else if(c=='['){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==']'){var subformat=format.substring(i+1,i2);var subres=formatDate(date,subformat,options);if(subres!=formatDate(otherDate,subformat,options)){res+=subres;}
i=i2;break;}}}
else if(c=='{'){date=date2;otherDate=date1;}
else if(c=='}'){date=date1;otherDate=date2;}
else{for(i2=len;i2>i;i2--){if(formatter=dateFormatters[format.substring(i,i2)]){if(date){res+=formatter(date,options);}
i=i2-1;break;}}
if(i2==i){if(date){res+=c;}}}}
return res;};var dateFormatters={s:function(d){return d.getSeconds()},ss:function(d){return zeroPad(d.getSeconds())},m:function(d){return d.getMinutes()},mm:function(d){return zeroPad(d.getMinutes())},h:function(d){return d.getHours()%12||12},hh:function(d){return zeroPad(d.getHours()%12||12)},H:function(d){return d.getHours()},HH:function(d){return zeroPad(d.getHours())},d:function(d){return d.getDate()},dd:function(d){return zeroPad(d.getDate())},ddd:function(d,o){return o.dayNamesShort[d.getDay()]},dddd:function(d,o){return o.dayNames[d.getDay()]},M:function(d){return d.getMonth()+1},MM:function(d){return zeroPad(d.getMonth()+1)},MMM:function(d,o){return o.monthNamesShort[d.getMonth()]},MMMM:function(d,o){return o.monthNames[d.getMonth()]},yy:function(d){return(d.getFullYear()+'').substring(2)},yyyy:function(d){return d.getFullYear()},t:function(d){return d.getHours()<12?'a':'p'},tt:function(d){return d.getHours()<12?'am':'pm'},T:function(d){return d.getHours()<12?'A':'P'},TT:function(d){return d.getHours()<12?'AM':'PM'},u:function(d){return formatDate(d,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(d){var date=d.getDate();if(date>10&&date<20){return'th';}
return['st','nd','rd'][date%10-1]||'th';},w:function(d,o){return o.weekNumberCalculation(d);},W:function(d){return iso8601Week(d);}};fc.dateFormatters=dateFormatters;function iso8601Week(date){var time;var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;};;fc.applyAll=applyAll;function exclEndDay(event){if(event.end){return _exclEndDay(event.end,event.allDay);}else{return addDays(cloneDate(event.start),1);}}
function _exclEndDay(end,allDay){end=cloneDate(end);return allDay||end.getHours()||end.getMinutes()?addDays(end,1):clearTime(end);}
function lazySegBind(container,segs,bindHandlers){container.unbind('mouseover').mouseover(function(ev){var parent=ev.target,e,i,seg;while(parent!=this){e=parent;parent=parent.parentNode;}
if((i=e._fci)!==undefined){e._fci=undefined;seg=segs[i];bindHandlers(seg.event,seg.element,seg);$(ev.target).trigger(ev);}
ev.stopPropagation();});}
function setOuterWidth(element,width,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.width(Math.max(0,width-hsides(e,includeMargins)));}}
function setOuterHeight(element,height,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.height(Math.max(0,height-vsides(e,includeMargins)));}}
function hsides(element,includeMargins){return hpadding(element)+hborders(element)+(includeMargins?hmargins(element):0);}
function hpadding(element){return(parseFloat($.css(element[0],'paddingLeft',true))||0)+
(parseFloat($.css(element[0],'paddingRight',true))||0);}
function hmargins(element){return(parseFloat($.css(element[0],'marginLeft',true))||0)+
(parseFloat($.css(element[0],'marginRight',true))||0);}
function hborders(element){return(parseFloat($.css(element[0],'borderLeftWidth',true))||0)+
(parseFloat($.css(element[0],'borderRightWidth',true))||0);}
function vsides(element,includeMargins){return vpadding(element)+vborders(element)+(includeMargins?vmargins(element):0);}
function vpadding(element){return(parseFloat($.css(element[0],'paddingTop',true))||0)+
(parseFloat($.css(element[0],'paddingBottom',true))||0);}
function vmargins(element){return(parseFloat($.css(element[0],'marginTop',true))||0)+
(parseFloat($.css(element[0],'marginBottom',true))||0);}
function vborders(element){return(parseFloat($.css(element[0],'borderTopWidth',true))||0)+
(parseFloat($.css(element[0],'borderBottomWidth',true))||0);}
function noop(){}
function dateCompare(a,b){return a-b;}
function arrayMax(a){return Math.max.apply(Math,a);}
function zeroPad(n){return(n<10?'0':'')+n;}
function smartProperty(obj,name){if(obj[name]!==undefined){return obj[name];}
var parts=name.split(/(?=[A-Z])/),i=parts.length-1,res;for(;i>=0;i--){res=obj[parts[i].toLowerCase()];if(res!==undefined){return res;}}
return obj[''];}
function htmlEscape(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#039;').replace(/"/g,'&quot;').replace(/\n/g,'<br />');}
function disableTextSelection(element){element.attr('unselectable','on').css('MozUserSelect','none').bind('selectstart.ui',function(){return false;});}
function markFirstLast(e){e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last');}
function setDayID(cell,date){cell.each(function(i,_cell){_cell.className=_cell.className.replace(/^fc-\w*/,'fc-'+dayIDs[date.getDay()]);});}
function getSkinCss(event,opt){var source=event.source||{};var eventColor=event.color;var sourceColor=source.color;var optionColor=opt('eventColor');var backgroundColor=event.backgroundColor||eventColor||source.backgroundColor||sourceColor||opt('eventBackgroundColor')||optionColor;var borderColor=event.borderColor||eventColor||source.borderColor||sourceColor||opt('eventBorderColor')||optionColor;var textColor=event.textColor||source.textColor||opt('eventTextColor');var statements=[];if(backgroundColor){statements.push('background-color:'+backgroundColor);}
if(borderColor){statements.push('border-color:'+borderColor);}
if(textColor){statements.push('color:'+textColor);}
return statements.join(';');}
function applyAll(functions,thisObj,args){if($.isFunction(functions)){functions=[functions];}
if(functions){var i;var ret;for(i=0;i<functions.length;i++){ret=functions[i].apply(thisObj,args)||ret;}
return ret;}}
function firstDefined(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}};;fcViews.month=MonthView;function MonthView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'month');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addMonths(date,delta);date.setDate(1);}
var firstDay=opt('firstDay');var start=cloneDate(date,true);start.setDate(1);var end=addMonths(cloneDate(start),1);var visStart=cloneDate(start);addDays(visStart,-((visStart.getDay()-firstDay+7)%7));skipHiddenDays(visStart);var visEnd=cloneDate(end);addDays(visEnd,(7-visEnd.getDay()+firstDay)%7);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();var rowCnt=Math.round(dayDiff(visEnd,visStart)/7);if(opt('weekMode')=='fixed'){addDays(visEnd,(6-rowCnt)*7);rowCnt=6;}
t.title=formatDate(start,opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(rowCnt,colCnt,true);}};;fcViews.basicWeek=BasicWeekView;function BasicWeekView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicWeek');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));renderBasic(1,colCnt,false);}};;fcViews.basicDay=BasicDayView;function BasicDayView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicDay');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderBasic(1,1,false);}};;setDefaults({weekMode:'fixed'});function BasicView(element,calendar,viewName){var t=this;t.renderBasic=renderBasic;t.setHeight=setHeight;t.setWidth=setWidth;t.renderDayOverlay=renderDayOverlay;t.defaultSelectionEnd=defaultSelectionEnd;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;t.defaultEventEnd=defaultEventEnd;t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getIsCellAllDay=function(){return true};t.allDayRow=allDayRow;t.getRowCnt=function(){return rowCnt};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getDaySegmentContainer=function(){return daySegmentContainer};View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);BasicEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var daySelectionMousedown=t.daySelectionMousedown;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var table;var head;var headCells;var body;var bodyRows;var bodyCells;var bodyFirstCells;var firstRowCellInners;var firstRowCellContentInners;var daySegmentContainer;var viewWidth;var viewHeight;var colWidth;var weekNumberWidth;var rowCnt,colCnt;var showNumbers;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var tm;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-grid'));function renderBasic(_rowCnt,_colCnt,_showNumbers){rowCnt=_rowCnt;colCnt=_colCnt;showNumbers=_showNumbers;updateOptions();if(!body){buildEventContainer();}
buildTable();}
function updateOptions(){tm=opt('theme')?'ui':'fc';colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}}
function buildEventContainer(){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(element);}
function buildTable(){var html=buildTableHTML();if(table){table.remove();}
table=$(html).appendTo(element);head=table.find('thead');headCells=head.find('.fc-day-header');body=table.find('tbody');bodyRows=body.find('tr');bodyCells=body.find('.fc-day');bodyFirstCells=bodyRows.find('td:first-child');firstRowCellInners=bodyRows.eq(0).find('.fc-day > div');firstRowCellContentInners=bodyRows.eq(0).find('.fc-day-content > div');markFirstLast(head.add(head.find('tr')));markFirstLast(bodyRows);bodyRows.eq(0).addClass('fc-first');bodyRows.filter(':last').addClass('fc-last');bodyCells.each(function(i,_cell){var date=cellToDate(Math.floor(i/colCnt),i%colCnt);trigger('dayRender',t,date,$(_cell));});dayBind(bodyCells);}
function buildTableHTML(){var html="<table class='fc-border-separate' style='width:100%' cellspacing='0'>"+
buildHeadHTML()+
buildBodyHTML()+"</table>";return html;}
function buildHeadHTML(){var headerClass=tm+"-widget-header";var html='';var col;var date;html+="<thead><tr>";if(showWeekNumbers){html+="<th class='fc-week-number "+headerClass+"'>"+
htmlEscape(weekNumberTitle)+"</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-day-header fc-"+dayIDs[date.getDay()]+" "+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="</tr></thead>";return html;}
function buildBodyHTML(){var contentClass=tm+"-widget-content";var html='';var row;var col;var date;html+="<tbody>";for(row=0;row<rowCnt;row++){html+="<tr class='fc-week'>";if(showWeekNumbers){date=cellToDate(row,0);html+="<td class='fc-week-number "+contentClass+"'>"+"<div>"+
htmlEscape(formatDate(date,weekNumberFormat))+"</div>"+"</td>";}
for(col=0;col<colCnt;col++){date=cellToDate(row,col);html+=buildCellHTML(date);}
html+="</tr>";}
html+="</tbody>";return html;}
function buildCellHTML(date){var contentClass=tm+"-widget-content";var month=t.start.getMonth();var today=clearTime(new Date());var html='';var classNames=['fc-day','fc-'+dayIDs[date.getDay()],contentClass];if(date.getMonth()!=month){classNames.push('fc-other-month');}
if(+date==+today){classNames.push('fc-today',tm+'-state-highlight');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
html+="<td"+" class='"+classNames.join(' ')+"'"+" data-date='"+formatDate(date,'yyyy-MM-dd')+"'"+">"+"<div>";if(showNumbers){html+="<div class='fc-day-number'>"+date.getDate()+"</div>";}
html+="<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";return html;}
function setHeight(height){viewHeight=height;var bodyHeight=viewHeight-head.height();var rowHeight;var rowHeightLast;var cell;if(opt('weekMode')=='variable'){rowHeight=rowHeightLast=Math.floor(bodyHeight/(rowCnt==1?2:6));}else{rowHeight=Math.floor(bodyHeight/rowCnt);rowHeightLast=bodyHeight-rowHeight*(rowCnt-1);}
bodyFirstCells.each(function(i,_cell){if(i<rowCnt){cell=$(_cell);cell.find('> div').css('min-height',(i==rowCnt-1?rowHeightLast:rowHeight)-vsides(cell));}});}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();weekNumberWidth=0;if(showWeekNumbers){weekNumberWidth=head.find('th.fc-week-number').outerWidth();}
colWidth=Math.floor((viewWidth-weekNumberWidth)/colCnt);setOuterWidth(headCells.slice(0,-1),colWidth);}
function dayBind(days){days.click(dayClick).mousedown(daySelectionMousedown);}
function dayClick(ev){if(!opt('selectable')){var date=parseISO8601($(this).data('date'));trigger('dayClick',this,date,true,ev);}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,element);return renderOverlay(rect,element);}
function defaultSelectionEnd(startDate,allDay){return cloneDate(startDate);}
function renderSelection(startDate,endDate,allDay){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}
function clearSelection(){clearOverlays();}
function reportDayClick(date,allDay,ev){var cell=dateToCell(date);var _element=bodyCells[cell.row*colCnt+cell.col];trigger('dayClick',_element,date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){var d=cellToDate(cell);trigger('drop',_dragElement,d,true,ev,ui);}}
function defaultEventEnd(event){return cloneDate(event.start);}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;headCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();bodyRows.each(function(i,_e){if(i<rowCnt){e=$(_e);n=e.offset().top;if(i){p[1]=n;}
p=[n];rows[i]=p;}});p[1]=n+e.outerHeight();});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return firstRowCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return firstRowCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colContentRight(col){return colContentPositions.right(col);}
function allDayRow(i){return bodyRows.eq(i);}};;function BasicEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;DayEventRenderer.call(t);function renderEvents(events,modifiedEventId){t.renderDayEvents(events,modifiedEventId);}
function clearEvents(){t.getDaySegmentContainer().empty();}};;fcViews.agendaWeek=AgendaWeekView;function AgendaWeekView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaWeek');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderAgenda(colCnt);}};;fcViews.agendaDay=AgendaDayView;function AgendaDayView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaDay');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderAgenda(1);}};;setDefaults({allDaySlot:true,allDayText:'all-day',firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:'h(:mm)tt',timeFormat:{agenda:'h:mm{ - h:mm}'},dragOpacity:{agenda:.5},minTime:0,maxTime:24,slotEventOverlap:true});function AgendaView(element,calendar,viewName){var t=this;t.renderAgenda=renderAgenda;t.setWidth=setWidth;t.setHeight=setHeight;t.afterRender=afterRender;t.defaultEventEnd=defaultEventEnd;t.timePosition=timePosition;t.getIsCellAllDay=getIsCellAllDay;t.allDayRow=getAllDayRow;t.getCoordinateGrid=function(){return coordinateGrid};t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getDaySegmentContainer=function(){return daySegmentContainer};t.getSlotSegmentContainer=function(){return slotSegmentContainer};t.getMinMinute=function(){return minMinute};t.getMaxMinute=function(){return maxMinute};t.getSlotContainer=function(){return slotContainer};t.getRowCnt=function(){return 1};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getSnapHeight=function(){return snapHeight};t.getSnapMinutes=function(){return snapMinutes};t.defaultSelectionEnd=defaultSelectionEnd;t.renderDayOverlay=renderDayOverlay;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);AgendaEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var reportSelection=t.reportSelection;var unselect=t.unselect;var daySelectionMousedown=t.daySelectionMousedown;var slotSegHtml=t.slotSegHtml;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var dayTable;var dayHead;var dayHeadCells;var dayBody;var dayBodyCells;var dayBodyCellInners;var dayBodyCellContentInners;var dayBodyFirstCell;var dayBodyFirstCellStretcher;var slotLayer;var daySegmentContainer;var allDayTable;var allDayRow;var slotScroller;var slotContainer;var slotSegmentContainer;var slotTable;var selectionHelper;var viewWidth;var viewHeight;var axisWidth;var colWidth;var gutterWidth;var slotHeight;var snapMinutes;var snapRatio;var snapHeight;var colCnt;var slotCnt;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var slotTopCache={};var tm;var rtl;var minMinute,maxMinute;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-agenda'));function renderAgenda(c){colCnt=c;updateOptions();if(!dayTable){buildSkeleton();}
else{buildDayTable();}}
function updateOptions(){tm=opt('theme')?'ui':'fc';rtl=opt('isRTL')
minMinute=parseTime(opt('minTime'));maxMinute=parseTime(opt('maxTime'));colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}
snapMinutes=opt('snapMinutes')||opt('slotMinutes');}
function buildSkeleton(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var s;var d;var i;var maxd;var minutes;var slotNormal=opt('slotMinutes')%15==0;buildDayTable();slotLayer=$("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(element);if(opt('allDaySlot')){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotLayer);s="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>"+"<tr>"+"<th class='"+headerClass+" fc-agenda-axis'>"+opt('allDayText')+"</th>"+"<td>"+"<div class='fc-day-content'><div style='position:relative'/></div>"+"</td>"+"<th class='"+headerClass+" fc-agenda-gutter'>&nbsp;</th>"+"</tr>"+"</table>";allDayTable=$(s).appendTo(slotLayer);allDayRow=allDayTable.find('tr');dayBind(allDayRow.find('td'));slotLayer.append("<div class='fc-agenda-divider "+headerClass+"'>"+"<div class='fc-agenda-divider-inner'/>"+"</div>");}else{daySegmentContainer=$([]);}
slotScroller=$("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(slotLayer);slotContainer=$("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(slotScroller);slotSegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotContainer);s="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>"+"<tbody>";d=zeroDate();maxd=addMinutes(cloneDate(d),maxMinute);addMinutes(d,minMinute);slotCnt=0;for(i=0;d<maxd;i++){minutes=d.getMinutes();s+="<tr class='fc-slot"+i+' '+(!minutes?'':'fc-minor')+"'>"+"<th class='fc-agenda-axis "+headerClass+"'>"+
((!slotNormal||!minutes)?formatDate(d,opt('axisFormat')):'&nbsp;')+"</th>"+"<td class='"+contentClass+"'>"+"<div style='position:relative'>&nbsp;</div>"+"</td>"+"</tr>";addMinutes(d,opt('slotMinutes'));slotCnt++;}
s+="</tbody>"+"</table>";slotTable=$(s).appendTo(slotContainer);slotBind(slotTable.find('td'));}
function buildDayTable(){var html=buildDayTableHTML();if(dayTable){dayTable.remove();}
dayTable=$(html).appendTo(element);dayHead=dayTable.find('thead');dayHeadCells=dayHead.find('th').slice(1,-1);dayBody=dayTable.find('tbody');dayBodyCells=dayBody.find('td').slice(0,-1);dayBodyCellInners=dayBodyCells.find('> div');dayBodyCellContentInners=dayBodyCells.find('.fc-day-content > div');dayBodyFirstCell=dayBodyCells.eq(0);dayBodyFirstCellStretcher=dayBodyCellInners.eq(0);markFirstLast(dayHead.add(dayHead.find('tr')));markFirstLast(dayBody.add(dayBody.find('tr')));}
function buildDayTableHTML(){var html="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>"+
buildDayTableHeadHTML()+
buildDayTableBodyHTML()+"</table>";return html;}
function buildDayTableHeadHTML(){var headerClass=tm+"-widget-header";var date;var html='';var weekText;var col;html+="<thead>"+"<tr>";if(showWeekNumbers){date=cellToDate(0,0);weekText=formatDate(date,weekNumberFormat);if(rtl){weekText+=weekNumberTitle;}
else{weekText=weekNumberTitle+weekText;}
html+="<th class='fc-agenda-axis fc-week-number "+headerClass+"'>"+
htmlEscape(weekText)+"</th>";}
else{html+="<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-"+dayIDs[date.getDay()]+" fc-col"+col+' '+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="<th class='fc-agenda-gutter "+headerClass+"'>&nbsp;</th>"+"</tr>"+"</thead>";return html;}
function buildDayTableBodyHTML(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var date;var today=clearTime(new Date());var col;var cellsHTML;var cellHTML;var classNames;var html='';html+="<tbody>"+"<tr>"+"<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";cellsHTML='';for(col=0;col<colCnt;col++){date=cellToDate(0,col);classNames=['fc-col'+col,'fc-'+dayIDs[date.getDay()],contentClass];if(+date==+today){classNames.push(tm+'-state-highlight','fc-today');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
cellHTML="<td class='"+classNames.join(' ')+"'>"+"<div>"+"<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";cellsHTML+=cellHTML;}
html+=cellsHTML;html+="<td class='fc-agenda-gutter "+contentClass+"'>&nbsp;</td>"+"</tr>"+"</tbody>";return html;}
function setHeight(height){if(height===undefined){height=viewHeight;}
viewHeight=height;slotTopCache={};var headHeight=dayBody.position().top;var allDayHeight=slotScroller.position().top;var bodyHeight=Math.min(height-headHeight,slotTable.height()+allDayHeight+1);dayBodyFirstCellStretcher.height(bodyHeight-vsides(dayBodyFirstCell));slotLayer.css('top',headHeight);slotScroller.height(bodyHeight-allDayHeight-1);slotHeight=slotTable.find('tr:first').height()+1;snapRatio=opt('slotMinutes')/snapMinutes;snapHeight=slotHeight/snapRatio;}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();var axisFirstCells=dayHead.find('th:first');if(allDayTable){axisFirstCells=axisFirstCells.add(allDayTable.find('th:first'));}
axisFirstCells=axisFirstCells.add(slotTable.find('th:first'));axisWidth=0;setOuterWidth(axisFirstCells.width('').each(function(i,_cell){axisWidth=Math.max(axisWidth,$(_cell).outerWidth());}),axisWidth);var gutterCells=dayTable.find('.fc-agenda-gutter');if(allDayTable){gutterCells=gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));}
var slotTableWidth=slotScroller[0].clientWidth;gutterWidth=slotScroller.width()-slotTableWidth;if(gutterWidth){setOuterWidth(gutterCells,gutterWidth);gutterCells.show().prev().removeClass('fc-last');}else{gutterCells.hide().prev().addClass('fc-last');}
colWidth=Math.floor((slotTableWidth-axisWidth)/colCnt);setOuterWidth(dayHeadCells.slice(0,-1),colWidth);}
function resetScroll(){var d0=zeroDate();var scrollDate=cloneDate(d0);scrollDate.setHours(opt('firstHour'));var top=timePosition(d0,scrollDate)+1;function scroll(){slotScroller.scrollTop(top);}
scroll();setTimeout(scroll,0);}
function afterRender(){resetScroll();}
function dayBind(cells){cells.click(slotClick).mousedown(daySelectionMousedown);}
function slotBind(cells){cells.click(slotClick).mousedown(slotSelectionMousedown);}
function slotClick(ev){if(!opt('selectable')){var col=Math.min(colCnt-1,Math.floor((ev.pageX-dayTable.offset().left-axisWidth)/colWidth));var date=cellToDate(0,col);var rowMatch=this.parentNode.className.match(/fc-slot(\d+)/);if(rowMatch){var mins=parseInt(rowMatch[1])*opt('slotMinutes');var hours=Math.floor(mins/60);date.setHours(hours);date.setMinutes(mins%60+minMinute);trigger('dayClick',dayBodyCells[col],date,false,ev);}else{trigger('dayClick',dayBodyCells[col],date,true,ev);}}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,slotLayer);return renderOverlay(rect,slotLayer);}
function renderSlotOverlay(overlayStart,overlayEnd){for(var i=0;i<colCnt;i++){var dayStart=cellToDate(0,i);var dayEnd=addDays(cloneDate(dayStart),1);var stretchStart=new Date(Math.max(dayStart,overlayStart));var stretchEnd=new Date(Math.min(dayEnd,overlayEnd));if(stretchStart<stretchEnd){var rect=coordinateGrid.rect(0,i,0,i,slotContainer);var top=timePosition(dayStart,stretchStart);var bottom=timePosition(dayStart,stretchEnd);rect.top=top;rect.height=bottom-top;slotBind(renderOverlay(rect,slotContainer));}}}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;dayHeadCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();if(opt('allDaySlot')){e=allDayRow;n=e.offset().top;rows[0]=[n,n+e.outerHeight()];}
var slotTableTop=slotContainer.offset().top;var slotScrollerTop=slotScroller.offset().top;var slotScrollerBottom=slotScrollerTop+slotScroller.outerHeight();function constrain(n){return Math.max(slotScrollerTop,Math.min(slotScrollerBottom,n));}
for(var i=0;i<slotCnt*snapRatio;i++){rows.push([constrain(slotTableTop+snapHeight*i),constrain(slotTableTop+snapHeight*(i+1))]);}});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return dayBodyCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return dayBodyCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentRight(col){return colContentPositions.right(col);}
function getIsCellAllDay(cell){return opt('allDaySlot')&&!cell.row;}
function realCellToDate(cell){var d=cellToDate(0,cell.col);var slotIndex=cell.row;if(opt('allDaySlot')){slotIndex--;}
if(slotIndex>=0){addMinutes(d,minMinute+slotIndex*snapMinutes);}
return d;}
function timePosition(day,time){day=cloneDate(day,true);if(time<addMinutes(cloneDate(day),minMinute)){return 0;}
if(time>=addMinutes(cloneDate(day),maxMinute)){return slotTable.height();}
var slotMinutes=opt('slotMinutes'),minutes=time.getHours()*60+time.getMinutes()-minMinute,slotI=Math.floor(minutes/slotMinutes),slotTop=slotTopCache[slotI];if(slotTop===undefined){slotTop=slotTopCache[slotI]=slotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;}
return Math.max(0,Math.round(slotTop-1+slotHeight*((minutes%slotMinutes)/slotMinutes)));}
function getAllDayRow(index){return allDayRow;}
function defaultEventEnd(event){var start=cloneDate(event.start);if(event.allDay){return start;}
return addMinutes(start,opt('defaultEventMinutes'));}
function defaultSelectionEnd(startDate,allDay){if(allDay){return cloneDate(startDate);}
return addMinutes(cloneDate(startDate),opt('slotMinutes'));}
function renderSelection(startDate,endDate,allDay){if(allDay){if(opt('allDaySlot')){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}}else{renderSlotSelection(startDate,endDate);}}
function renderSlotSelection(startDate,endDate){var helperOption=opt('selectHelper');coordinateGrid.build();if(helperOption){var col=dateToCell(startDate).col;if(col>=0&&col<colCnt){var rect=coordinateGrid.rect(0,col,0,col,slotContainer);var top=timePosition(startDate,startDate);var bottom=timePosition(startDate,endDate);if(bottom>top){rect.top=top;rect.height=bottom-top;rect.left+=2;rect.width-=5;if($.isFunction(helperOption)){var helperRes=helperOption(startDate,endDate);if(helperRes){rect.position='absolute';selectionHelper=$(helperRes).css(rect).appendTo(slotContainer);}}else{rect.isStart=true;rect.isEnd=true;selectionHelper=$(slotSegHtml({title:'',start:startDate,end:endDate,className:['fc-select-helper'],editable:false},rect));selectionHelper.css('opacity',opt('dragOpacity'));}
if(selectionHelper){slotBind(selectionHelper);slotContainer.append(selectionHelper);setOuterWidth(selectionHelper,rect.width,true);setOuterHeight(selectionHelper,rect.height,true);}}}}else{renderSlotOverlay(startDate,endDate);}}
function clearSelection(){clearOverlays();if(selectionHelper){selectionHelper.remove();selectionHelper=null;}}
function slotSelectionMousedown(ev){if(ev.which==1&&opt('selectable')){unselect(ev);var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cell.col==origCell.col&&!getIsCellAllDay(cell)){var d1=realCellToDate(origCell);var d2=realCellToDate(cell);dates=[d1,addMinutes(cloneDate(d1),snapMinutes),d2,addMinutes(cloneDate(d2),snapMinutes)].sort(dateCompare);renderSlotSelection(dates[0],dates[3]);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],false,ev);}
reportSelection(dates[0],dates[3],false,ev);}});}}
function reportDayClick(date,allDay,ev){trigger('dayClick',dayBodyCells[dateToCell(date).col],date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){if(getIsCellAllDay(cell)){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}else{var d1=realCellToDate(cell);var d2=addMinutes(cloneDate(d1),opt('defaultEventMinutes'));renderSlotOverlay(d1,d2);}}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){trigger('drop',_dragElement,realCellToDate(cell),getIsCellAllDay(cell),ev,ui);}}};;function AgendaEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;t.slotSegHtml=slotSegHtml;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var eventElementHandlers=t.eventElementHandlers;var setHeight=t.setHeight;var getDaySegmentContainer=t.getDaySegmentContainer;var getSlotSegmentContainer=t.getSlotSegmentContainer;var getHoverListener=t.getHoverListener;var getMaxMinute=t.getMaxMinute;var getMinMinute=t.getMinMinute;var timePosition=t.timePosition;var getIsCellAllDay=t.getIsCellAllDay;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var cellToDate=t.cellToDate;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var getSnapHeight=t.getSnapHeight;var getSnapMinutes=t.getSnapMinutes;var getSlotContainer=t.getSlotContainer;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var renderDayEvents=t.renderDayEvents;var calendar=t.calendar;var formatDate=calendar.formatDate;var formatDates=calendar.formatDates;t.draggableDayEvent=draggableDayEvent;function renderEvents(events,modifiedEventId){var i,len=events.length,dayEvents=[],slotEvents=[];for(i=0;i<len;i++){if(events[i].allDay){dayEvents.push(events[i]);}else{slotEvents.push(events[i]);}}
if(opt('allDaySlot')){renderDayEvents(dayEvents,modifiedEventId);setHeight();}
renderSlotSegs(compileSlotSegs(slotEvents),modifiedEventId);}
function clearEvents(){getDaySegmentContainer().empty();getSlotSegmentContainer().empty();}
function compileSlotSegs(events){var colCnt=getColCnt(),minMinute=getMinMinute(),maxMinute=getMaxMinute(),d,visEventEnds=$.map(events,slotEventEnd),i,j,seg,colSegs,segs=[];for(i=0;i<colCnt;i++){d=cellToDate(0,i);addMinutes(d,minMinute);colSegs=sliceSegs(events,visEventEnds,d,addMinutes(cloneDate(d),maxMinute-minMinute));colSegs=placeSlotSegs(colSegs);for(j=0;j<colSegs.length;j++){seg=colSegs[j];seg.col=i;segs.push(seg);}}
return segs;}
function sliceSegs(events,visEventEnds,start,end){var segs=[],i,len=events.length,event,eventStart,eventEnd,segStart,segEnd,isStart,isEnd;for(i=0;i<len;i++){event=events[i];eventStart=event.start;eventEnd=visEventEnds[i];if(eventEnd>start&&eventStart<end){if(eventStart<start){segStart=cloneDate(start);isStart=false;}else{segStart=eventStart;isStart=true;}
if(eventEnd>end){segEnd=cloneDate(end);isEnd=false;}else{segEnd=eventEnd;isEnd=true;}
segs.push({event:event,start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd});}}
return segs.sort(compareSlotSegs);}
function slotEventEnd(event){if(event.end){return cloneDate(event.end);}else{return addMinutes(cloneDate(event.start),opt('defaultEventMinutes'));}}
function renderSlotSegs(segs,modifiedEventId){var i,segCnt=segs.length,seg,event,top,bottom,columnLeft,columnRight,columnWidth,width,left,right,html='',eventElements,eventElement,triggerRes,titleElement,height,slotSegmentContainer=getSlotSegmentContainer(),isRTL=opt('isRTL');for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;top=timePosition(seg.start,seg.start);bottom=timePosition(seg.start,seg.end);columnLeft=colContentLeft(seg.col);columnRight=colContentRight(seg.col);columnWidth=columnRight-columnLeft;columnRight-=columnWidth*.025;columnWidth=columnRight-columnLeft;width=columnWidth*(seg.forwardCoord-seg.backwardCoord);if(opt('slotEventOverlap')){width=Math.max((width-(20/2))*2,width);}
if(isRTL){right=columnRight-seg.backwardCoord*columnWidth;left=right-width;}
else{left=columnLeft+seg.backwardCoord*columnWidth;right=left+width;}
left=Math.max(left,columnLeft);right=Math.min(right,columnRight);width=right-left;seg.top=top;seg.left=left;seg.outerWidth=width;seg.outerHeight=bottom-top;html+=slotSegHtml(event,seg);}
slotSegmentContainer[0].innerHTML=html;eventElements=slotSegmentContainer.children();for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;eventElement=$(eventElements[i]);triggerRes=trigger('eventRender',event,event,eventElement);if(triggerRes===false){eventElement.remove();}else{if(triggerRes&&triggerRes!==true){eventElement.remove();eventElement=$(triggerRes).css({position:'absolute',top:seg.top,left:seg.left}).appendTo(slotSegmentContainer);}
seg.element=eventElement;if(event._id===modifiedEventId){bindSlotSeg(event,eventElement,seg);}else{eventElement[0]._fci=i;}
reportEventElement(event,eventElement);}}
lazySegBind(slotSegmentContainer,segs,bindSlotSeg);for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){seg.vsides=vsides(eventElement,true);seg.hsides=hsides(eventElement,true);titleElement=eventElement.find('.fc-event-title');if(titleElement.length){seg.contentTop=titleElement[0].offsetTop;}}}
for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){eventElement[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px';height=Math.max(0,seg.outerHeight-seg.vsides);eventElement[0].style.height=height+'px';event=seg.event;if(seg.contentTop!==undefined&&height-seg.contentTop<10){eventElement.find('div.fc-event-time').text(formatDate(event.start,opt('timeFormat'))+' - '+event.title);eventElement.find('div.fc-event-title').remove();}
trigger('eventAfterRender',event,event,eventElement);}}}
function slotSegHtml(event,seg){var html="<";var url=event.url;var skinCss=getSkinCss(event,opt);var classes=['fc-event','fc-event-vert'];if(isEventDraggable(event)){classes.push('fc-event-draggable');}
if(seg.isStart){classes.push('fc-event-start');}
if(seg.isEnd){classes.push('fc-event-end');}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[]);}
if(url){html+="a href='"+htmlEscape(event.url)+"'";}else{html+="div";}
html+=" class='"+classes.join(' ')+"'"+" style="+"'"+"position:absolute;"+"top:"+seg.top+"px;"+"left:"+seg.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>"+"<div class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</div>"+"<div class='fc-event-title'>"+
htmlEscape(event.title||'')+"</div>"+"</div>"+"<div class='fc-event-bg'></div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-s'>=</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function bindSlotSeg(event,eventElement,seg){var timeElement=eventElement.find('div.fc-event-time');if(isEventDraggable(event)){draggableSlotEvent(event,eventElement,timeElement);}
if(seg.isEnd&&isEventResizable(event)){resizableSlotEvent(event,eventElement,timeElement);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement,seg){var isStart=seg.isStart;var origWidth;var revert;var allDay=true;var dayDelta;var hoverListener=getHoverListener();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var minMinute=getMinMinute();eventElement.draggable({opacity:opt('dragOpacity','month'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origWidth=eventElement.width();hoverListener.start(function(cell,origCell){clearOverlays();if(cell){revert=false;var origDate=cellToDate(0,origCell.col);var date=cellToDate(0,cell.col);dayDelta=dayDiff(date,origDate);if(!cell.row){renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));resetElement();}else{if(isStart){if(allDay){eventElement.width(colWidth-10);setOuterHeight(eventElement,snapHeight*Math.round((event.end?((event.end-event.start)/MINUTE_MS):opt('defaultEventMinutes'))/snapMinutes));eventElement.draggable('option','grid',[colWidth,1]);allDay=false;}}else{revert=true;}}
revert=revert||(allDay&&!dayDelta);}else{resetElement();revert=true;}
eventElement.draggable('option','revert',revert);},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(revert){resetElement();eventElement.css('filter','');showEvents(event,eventElement);}else{var minuteDelta=0;if(!allDay){minuteDelta=Math.round((eventElement.offset().top-getSlotContainer().offset().top)/snapHeight)*snapMinutes
+minMinute
-(event.start.getHours()*60+event.start.getMinutes());}
eventDrop(this,event,dayDelta,minuteDelta,allDay,ev,ui);}}});function resetElement(){if(!allDay){eventElement.width(origWidth).height('').draggable('option','grid',null);allDay=true;}}}
function draggableSlotEvent(event,eventElement,timeElement){var coordinateGrid=t.getCoordinateGrid();var colCnt=getColCnt();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var origPosition;var origCell;var isInBounds,prevIsInBounds;var isAllDay,prevIsAllDay;var colDelta,prevColDelta;var dayDelta;var minuteDelta,prevMinuteDelta;eventElement.draggable({scroll:false,grid:[colWidth,snapHeight],axis:colCnt==1?'y':false,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);coordinateGrid.build();origPosition=eventElement.position();origCell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=prevIsInBounds=true;isAllDay=prevIsAllDay=getIsCellAllDay(origCell);colDelta=prevColDelta=0;dayDelta=0;minuteDelta=prevMinuteDelta=0;},drag:function(ev,ui){var cell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=!!cell;if(isInBounds){isAllDay=getIsCellAllDay(cell);colDelta=Math.round((ui.position.left-origPosition.left)/colWidth);if(colDelta!=prevColDelta){var origDate=cellToDate(0,origCell.col);var col=origCell.col+colDelta;col=Math.max(0,col);col=Math.min(colCnt-1,col);var date=cellToDate(0,col);dayDelta=dayDiff(date,origDate);}
if(!isAllDay){minuteDelta=Math.round((ui.position.top-origPosition.top)/snapHeight)*snapMinutes;}}
if(isInBounds!=prevIsInBounds||isAllDay!=prevIsAllDay||colDelta!=prevColDelta||minuteDelta!=prevMinuteDelta){updateUI();prevIsInBounds=isInBounds;prevIsAllDay=isAllDay;prevColDelta=colDelta;prevMinuteDelta=minuteDelta;}
eventElement.draggable('option','revert',!isInBounds);},stop:function(ev,ui){clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(isInBounds&&(isAllDay||dayDelta||minuteDelta)){eventDrop(this,event,dayDelta,isAllDay?0:minuteDelta,isAllDay,ev,ui);}
else{isInBounds=true;isAllDay=false;colDelta=0;dayDelta=0;minuteDelta=0;updateUI();eventElement.css('filter','');eventElement.css(origPosition);showEvents(event,eventElement);}}});function updateUI(){clearOverlays();if(isInBounds){if(isAllDay){timeElement.hide();eventElement.draggable('option','grid',null);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}
else{updateTimeText(minuteDelta);timeElement.css('display','');eventElement.draggable('option','grid',[colWidth,snapHeight]);}}}
function updateTimeText(minuteDelta){var newStart=addMinutes(cloneDate(event.start),minuteDelta);var newEnd;if(event.end){newEnd=addMinutes(cloneDate(event.end),minuteDelta);}
timeElement.text(formatDates(newStart,newEnd,opt('timeFormat')));}}
function resizableSlotEvent(event,eventElement,timeElement){var snapDelta,prevSnapDelta;var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();eventElement.resizable({handles:{s:'.ui-resizable-handle'},grid:snapHeight,start:function(ev,ui){snapDelta=prevSnapDelta=0;hideEvents(event,eventElement);trigger('eventResizeStart',this,event,ev,ui);},resize:function(ev,ui){snapDelta=Math.round((Math.max(snapHeight,eventElement.height())-ui.originalSize.height)/snapHeight);if(snapDelta!=prevSnapDelta){timeElement.text(formatDates(event.start,(!snapDelta&&!event.end)?null:addMinutes(eventEnd(event),snapMinutes*snapDelta),opt('timeFormat')));prevSnapDelta=snapDelta;}},stop:function(ev,ui){trigger('eventResizeStop',this,event,ev,ui);if(snapDelta){eventResize(this,event,0,snapMinutes*snapDelta,ev,ui);}else{showEvents(event,eventElement);}}});}}
function placeSlotSegs(segs){var levels=buildSlotSegLevels(segs);var level0=levels[0];var i;computeForwardSlotSegs(levels);if(level0){for(i=0;i<level0.length;i++){computeSlotSegPressures(level0[i]);}
for(i=0;i<level0.length;i++){computeSlotSegCoords(level0[i],0,0);}}
return flattenSlotSegLevels(levels);}
function buildSlotSegLevels(segs){var levels=[];var i,seg;var j;for(i=0;i<segs.length;i++){seg=segs[i];for(j=0;j<levels.length;j++){if(!computeSlotSegCollisions(seg,levels[j]).length){break;}}
(levels[j]||(levels[j]=[])).push(seg);}
return levels;}
function computeForwardSlotSegs(levels){var i,level;var j,seg;var k;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){seg=level[j];seg.forwardSegs=[];for(k=i+1;k<levels.length;k++){computeSlotSegCollisions(seg,levels[k],seg.forwardSegs);}}}}
function computeSlotSegPressures(seg){var forwardSegs=seg.forwardSegs;var forwardPressure=0;var i,forwardSeg;if(seg.forwardPressure===undefined){for(i=0;i<forwardSegs.length;i++){forwardSeg=forwardSegs[i];computeSlotSegPressures(forwardSeg);forwardPressure=Math.max(forwardPressure,1+forwardSeg.forwardPressure);}
seg.forwardPressure=forwardPressure;}}
function computeSlotSegCoords(seg,seriesBackwardPressure,seriesBackwardCoord){var forwardSegs=seg.forwardSegs;var i;if(seg.forwardCoord===undefined){if(!forwardSegs.length){seg.forwardCoord=1;}
else{forwardSegs.sort(compareForwardSlotSegs);computeSlotSegCoords(forwardSegs[0],seriesBackwardPressure+1,seriesBackwardCoord);seg.forwardCoord=forwardSegs[0].backwardCoord;}
seg.backwardCoord=seg.forwardCoord-
(seg.forwardCoord-seriesBackwardCoord)/(seriesBackwardPressure+1);for(i=0;i<forwardSegs.length;i++){computeSlotSegCoords(forwardSegs[i],0,seg.forwardCoord);}}}
function flattenSlotSegLevels(levels){var segs=[];var i,level;var j;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){segs.push(level[j]);}}
return segs;}
function computeSlotSegCollisions(seg,otherSegs,results){results=results||[];for(var i=0;i<otherSegs.length;i++){if(isSlotSegCollision(seg,otherSegs[i])){results.push(otherSegs[i]);}}
return results;}
function isSlotSegCollision(seg1,seg2){return seg1.end>seg2.start&&seg1.start<seg2.end;}
function compareForwardSlotSegs(seg1,seg2){return seg2.forwardPressure-seg1.forwardPressure||(seg1.backwardCoord||0)-(seg2.backwardCoord||0)||compareSlotSegs(seg1,seg2);}
function compareSlotSegs(seg1,seg2){return seg1.start-seg2.start||(seg2.end-seg2.start)-(seg1.end-seg1.start)||(seg1.event.title||'').localeCompare(seg2.event.title);};;function View(element,calendar,viewName){var t=this;t.element=element;t.calendar=calendar;t.name=viewName;t.opt=opt;t.trigger=trigger;t.isEventDraggable=isEventDraggable;t.isEventResizable=isEventResizable;t.setEventData=setEventData;t.clearEventData=clearEventData;t.eventEnd=eventEnd;t.reportEventElement=reportEventElement;t.triggerEventDestroy=triggerEventDestroy;t.eventElementHandlers=eventElementHandlers;t.showEvents=showEvents;t.hideEvents=hideEvents;t.eventDrop=eventDrop;t.eventResize=eventResize;var defaultEventEnd=t.defaultEventEnd;var normalizeEvent=calendar.normalizeEvent;var reportEventChange=calendar.reportEventChange;var eventsByID={};var eventElementsByID={};var eventElementCouples=[];var options=calendar.options;function opt(name,viewNameOverride){var v=options[name];if($.isPlainObject(v)){return smartProperty(v,viewNameOverride||viewName);}
return v;}
function trigger(name,thisObj){return calendar.trigger.apply(calendar,[name,thisObj||t].concat(Array.prototype.slice.call(arguments,2),[t]));}
function isEventDraggable(event){var source=event.source||{};return firstDefined(event.startEditable,source.startEditable,opt('eventStartEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableDragging');}
function isEventResizable(event){var source=event.source||{};return firstDefined(event.durationEditable,source.durationEditable,opt('eventDurationEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableResizing');}
function setEventData(events){eventsByID={};var i,len=events.length,event;for(i=0;i<len;i++){event=events[i];if(eventsByID[event._id]){eventsByID[event._id].push(event);}else{eventsByID[event._id]=[event];}}}
function clearEventData(){eventsByID={};eventElementsByID={};eventElementCouples=[];}
function eventEnd(event){return event.end?cloneDate(event.end):defaultEventEnd(event);}
function reportEventElement(event,element){eventElementCouples.push({event:event,element:element});if(eventElementsByID[event._id]){eventElementsByID[event._id].push(element);}else{eventElementsByID[event._id]=[element];}}
function triggerEventDestroy(){$.each(eventElementCouples,function(i,couple){t.trigger('eventDestroy',couple.event,couple.event,couple.element);});}
function eventElementHandlers(event,eventElement){eventElement.click(function(ev){if(!eventElement.hasClass('ui-draggable-dragging')&&!eventElement.hasClass('ui-resizable-resizing')){return trigger('eventClick',this,event,ev);}}).hover(function(ev){trigger('eventMouseover',this,event,ev);},function(ev){trigger('eventMouseout',this,event,ev);});}
function showEvents(event,exceptElement){eachEventElement(event,exceptElement,'show');}
function hideEvents(event,exceptElement){eachEventElement(event,exceptElement,'hide');}
function eachEventElement(event,exceptElement,funcName){var elements=eventElementsByID[event._id],i,len=elements.length;for(i=0;i<len;i++){if(!exceptElement||elements[i][0]!=exceptElement[0]){elements[i][funcName]();}}}
function eventDrop(e,event,dayDelta,minuteDelta,allDay,ev,ui){var oldAllDay=event.allDay;var eventId=event._id;moveEvents(eventsByID[eventId],dayDelta,minuteDelta,allDay);trigger('eventDrop',e,event,dayDelta,minuteDelta,allDay,function(){moveEvents(eventsByID[eventId],-dayDelta,-minuteDelta,oldAllDay);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function eventResize(e,event,dayDelta,minuteDelta,ev,ui){var eventId=event._id;elongateEvents(eventsByID[eventId],dayDelta,minuteDelta);trigger('eventResize',e,event,dayDelta,minuteDelta,function(){elongateEvents(eventsByID[eventId],-dayDelta,-minuteDelta);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function moveEvents(events,dayDelta,minuteDelta,allDay){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];if(allDay!==undefined){e.allDay=allDay;}
addMinutes(addDays(e.start,dayDelta,true),minuteDelta);if(e.end){e.end=addMinutes(addDays(e.end,dayDelta,true),minuteDelta);}
normalizeEvent(e,options);}}
function elongateEvents(events,dayDelta,minuteDelta){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];e.end=addMinutes(addDays(eventEnd(e),dayDelta,true),minuteDelta);normalizeEvent(e,options);}}
t.isHiddenDay=isHiddenDay;t.skipHiddenDays=skipHiddenDays;t.getCellsPerWeek=getCellsPerWeek;t.dateToCell=dateToCell;t.dateToDayOffset=dateToDayOffset;t.dayOffsetToCellOffset=dayOffsetToCellOffset;t.cellOffsetToCell=cellOffsetToCell;t.cellToDate=cellToDate;t.cellToCellOffset=cellToCellOffset;t.cellOffsetToDayOffset=cellOffsetToDayOffset;t.dayOffsetToDate=dayOffsetToDate;t.rangeToSegments=rangeToSegments;var hiddenDays=opt('hiddenDays')||[];var isHiddenDayHash=[];var cellsPerWeek;var dayToCellMap=[];var cellToDayMap=[];var isRTL=opt('isRTL');(function(){if(opt('weekends')===false){hiddenDays.push(0,6);}
for(var dayIndex=0,cellIndex=0;dayIndex<7;dayIndex++){dayToCellMap[dayIndex]=cellIndex;isHiddenDayHash[dayIndex]=$.inArray(dayIndex,hiddenDays)!=-1;if(!isHiddenDayHash[dayIndex]){cellToDayMap[cellIndex]=dayIndex;cellIndex++;}}
cellsPerWeek=cellIndex;if(!cellsPerWeek){throw'invalid hiddenDays';}})();function isHiddenDay(day){if(typeof day=='object'){day=day.getDay();}
return isHiddenDayHash[day];}
function getCellsPerWeek(){return cellsPerWeek;}
function skipHiddenDays(date,inc,isExclusive){inc=inc||1;while(isHiddenDayHash[(date.getDay()+(isExclusive?inc:0)+7)%7]){addDays(date,inc);}}
function cellToDate(){var cellOffset=cellToCellOffset.apply(null,arguments);var dayOffset=cellOffsetToDayOffset(cellOffset);var date=dayOffsetToDate(dayOffset);return date;}
function cellToCellOffset(row,col){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;if(typeof row=='object'){col=row.col;row=row.row;}
var cellOffset=row*colCnt+(col*dis+dit);return cellOffset;}
function cellOffsetToDayOffset(cellOffset){var day0=t.visStart.getDay();cellOffset+=dayToCellMap[day0];return Math.floor(cellOffset/cellsPerWeek)*7
+cellToDayMap[(cellOffset%cellsPerWeek+cellsPerWeek)%cellsPerWeek]
-day0;}
function dayOffsetToDate(dayOffset){var date=cloneDate(t.visStart);addDays(date,dayOffset);return date;}
function dateToCell(date){var dayOffset=dateToDayOffset(date);var cellOffset=dayOffsetToCellOffset(dayOffset);var cell=cellOffsetToCell(cellOffset);return cell;}
function dateToDayOffset(date){return dayDiff(date,t.visStart);}
function dayOffsetToCellOffset(dayOffset){var day0=t.visStart.getDay();dayOffset+=day0;return Math.floor(dayOffset/7)*cellsPerWeek
+dayToCellMap[(dayOffset%7+7)%7]
-dayToCellMap[day0];}
function cellOffsetToCell(cellOffset){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;var row=Math.floor(cellOffset/colCnt);var col=((cellOffset%colCnt+colCnt)%colCnt)*dis+dit;return{row:row,col:col};}
function rangeToSegments(startDate,endDate){var rowCnt=t.getRowCnt();var colCnt=t.getColCnt();var segments=[];var rangeDayOffsetStart=dateToDayOffset(startDate);var rangeDayOffsetEnd=dateToDayOffset(endDate);var rangeCellOffsetFirst=dayOffsetToCellOffset(rangeDayOffsetStart);var rangeCellOffsetLast=dayOffsetToCellOffset(rangeDayOffsetEnd)-1;for(var row=0;row<rowCnt;row++){var rowCellOffsetFirst=row*colCnt;var rowCellOffsetLast=rowCellOffsetFirst+colCnt-1;var segmentCellOffsetFirst=Math.max(rangeCellOffsetFirst,rowCellOffsetFirst);var segmentCellOffsetLast=Math.min(rangeCellOffsetLast,rowCellOffsetLast);if(segmentCellOffsetFirst<=segmentCellOffsetLast){var segmentCellFirst=cellOffsetToCell(segmentCellOffsetFirst);var segmentCellLast=cellOffsetToCell(segmentCellOffsetLast);var cols=[segmentCellFirst.col,segmentCellLast.col].sort();var isStart=cellOffsetToDayOffset(segmentCellOffsetFirst)==rangeDayOffsetStart;var isEnd=cellOffsetToDayOffset(segmentCellOffsetLast)+1==rangeDayOffsetEnd;segments.push({row:row,leftCol:cols[0],rightCol:cols[1],isStart:isStart,isEnd:isEnd});}}
return segments;}};;function DayEventRenderer(){var t=this;t.renderDayEvents=renderDayEvents;t.draggableDayEvent=draggableDayEvent;t.resizableDayEvent=resizableDayEvent;var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEventElement=t.reportEventElement;var eventElementHandlers=t.eventElementHandlers;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var allDayRow=t.allDayRow;var colLeft=t.colLeft;var colRight=t.colRight;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var dateToCell=t.dateToCell;var getDaySegmentContainer=t.getDaySegmentContainer;var formatDates=t.calendar.formatDates;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var clearSelection=t.clearSelection;var getHoverListener=t.getHoverListener;var rangeToSegments=t.rangeToSegments;var cellToDate=t.cellToDate;var cellToCellOffset=t.cellToCellOffset;var cellOffsetToDayOffset=t.cellOffsetToDayOffset;var dateToDayOffset=t.dateToDayOffset;var dayOffsetToCellOffset=t.dayOffsetToCellOffset;function renderDayEvents(events,modifiedEventId){var segments=_renderDayEvents(events,false,true);segmentElementEach(segments,function(segment,element){reportEventElement(segment.event,element);});attachHandlers(segments,modifiedEventId);segmentElementEach(segments,function(segment,element){trigger('eventAfterRender',segment.event,segment.event,element);});}
function renderTempDayEvent(event,adjustRow,adjustTop){var segments=_renderDayEvents([event],true,false);var elements=[];segmentElementEach(segments,function(segment,element){if(segment.row===adjustRow){element.css('top',adjustTop);}
elements.push(element[0]);});return elements;}
function _renderDayEvents(events,doAppend,doRowHeights){var finalContainer=getDaySegmentContainer();var renderContainer=doAppend?$("<div/>"):finalContainer;var segments=buildSegments(events);var html;var elements;calculateHorizontals(segments);html=buildHTML(segments);renderContainer[0].innerHTML=html;elements=renderContainer.children();if(doAppend){finalContainer.append(elements);}
resolveElements(segments,elements);segmentElementEach(segments,function(segment,element){segment.hsides=hsides(element,true);});segmentElementEach(segments,function(segment,element){element.width(Math.max(0,segment.outerWidth-segment.hsides));});segmentElementEach(segments,function(segment,element){segment.outerHeight=element.outerHeight(true);});setVerticals(segments,doRowHeights);return segments;}
function buildSegments(events){var segments=[];for(var i=0;i<events.length;i++){var eventSegments=buildSegmentsForEvent(events[i]);segments.push.apply(segments,eventSegments);}
return segments;}
function buildSegmentsForEvent(event){var startDate=event.start;var endDate=exclEndDay(event);var segments=rangeToSegments(startDate,endDate);for(var i=0;i<segments.length;i++){segments[i].event=event;}
return segments;}
function calculateHorizontals(segments){var isRTL=opt('isRTL');for(var i=0;i<segments.length;i++){var segment=segments[i];var leftFunc=(isRTL?segment.isEnd:segment.isStart)?colContentLeft:colLeft;var rightFunc=(isRTL?segment.isStart:segment.isEnd)?colContentRight:colRight;var left=leftFunc(segment.leftCol);var right=rightFunc(segment.rightCol);segment.left=left;segment.outerWidth=right-left;}}
function buildHTML(segments){var html='';for(var i=0;i<segments.length;i++){html+=buildHTMLForSegment(segments[i]);}
return html;}
function buildHTMLForSegment(segment){var html='';var isRTL=opt('isRTL');var event=segment.event;var url=event.url;var classNames=['fc-event','fc-event-hori'];if(isEventDraggable(event)){classNames.push('fc-event-draggable');}
if(segment.isStart){classNames.push('fc-event-start');}
if(segment.isEnd){classNames.push('fc-event-end');}
classNames=classNames.concat(event.className);if(event.source){classNames=classNames.concat(event.source.className||[]);}
var skinCss=getSkinCss(event,opt);if(url){html+="<a href='"+htmlEscape(url)+"'";}else{html+="<div";}
html+=" class='"+classNames.join(' ')+"'"+" style="+"'"+"position:absolute;"+"left:"+segment.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>";if(!event.allDay&&segment.isStart){html+="<span class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</span>";}
html+="<span class='fc-event-title'>"+
htmlEscape(event.title||'')+"</span>"+"</div>";if(segment.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-"+(isRTL?'w':'e')+"'>"+"&nbsp;&nbsp;&nbsp;"+"</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function resolveElements(segments,elements){for(var i=0;i<segments.length;i++){var segment=segments[i];var event=segment.event;var element=elements.eq(i);var triggerRes=trigger('eventRender',event,event,element);if(triggerRes===false){element.remove();}
else{if(triggerRes&&triggerRes!==true){triggerRes=$(triggerRes).css({position:'absolute',left:segment.left});element.replaceWith(triggerRes);element=triggerRes;}
segment.element=element;}}}
function setVerticals(segments,doRowHeights){var rowContentHeights=calculateVerticals(segments);var rowContentElements=getRowContentElements();var rowContentTops=[];if(doRowHeights){for(var i=0;i<rowContentElements.length;i++){rowContentElements[i].height(rowContentHeights[i]);}}
for(var i=0;i<rowContentElements.length;i++){rowContentTops.push(rowContentElements[i].position().top);}
segmentElementEach(segments,function(segment,element){element.css('top',rowContentTops[segment.row]+segment.top);});}
function calculateVerticals(segments){var rowCnt=getRowCnt();var colCnt=getColCnt();var rowContentHeights=[];var segmentRows=buildSegmentRows(segments);for(var rowI=0;rowI<rowCnt;rowI++){var segmentRow=segmentRows[rowI];var colHeights=[];for(var colI=0;colI<colCnt;colI++){colHeights.push(0);}
for(var segmentI=0;segmentI<segmentRow.length;segmentI++){var segment=segmentRow[segmentI];segment.top=arrayMax(colHeights.slice(segment.leftCol,segment.rightCol+1));for(var colI=segment.leftCol;colI<=segment.rightCol;colI++){colHeights[colI]=segment.top+segment.outerHeight;}}
rowContentHeights.push(arrayMax(colHeights));}
return rowContentHeights;}
function buildSegmentRows(segments){var rowCnt=getRowCnt();var segmentRows=[];var segmentI;var segment;var rowI;for(segmentI=0;segmentI<segments.length;segmentI++){segment=segments[segmentI];rowI=segment.row;if(segment.element){if(segmentRows[rowI]){segmentRows[rowI].push(segment);}
else{segmentRows[rowI]=[segment];}}}
for(rowI=0;rowI<rowCnt;rowI++){segmentRows[rowI]=sortSegmentRow(segmentRows[rowI]||[]);}
return segmentRows;}
function sortSegmentRow(segments){var sortedSegments=[];var subrows=buildSegmentSubrows(segments);for(var i=0;i<subrows.length;i++){sortedSegments.push.apply(sortedSegments,subrows[i]);}
return sortedSegments;}
function buildSegmentSubrows(segments){segments.sort(compareDaySegments);var subrows=[];for(var i=0;i<segments.length;i++){var segment=segments[i];for(var j=0;j<subrows.length;j++){if(!isDaySegmentCollision(segment,subrows[j])){break;}}
if(subrows[j]){subrows[j].push(segment);}
else{subrows[j]=[segment];}}
return subrows;}
function getRowContentElements(){var i;var rowCnt=getRowCnt();var rowDivs=[];for(i=0;i<rowCnt;i++){rowDivs[i]=allDayRow(i).find('div.fc-day-content > div');}
return rowDivs;}
function attachHandlers(segments,modifiedEventId){var segmentContainer=getDaySegmentContainer();segmentElementEach(segments,function(segment,element,i){var event=segment.event;if(event._id===modifiedEventId){bindDaySeg(event,element,segment);}else{element[0]._fci=i;}});lazySegBind(segmentContainer,segments,bindDaySeg);}
function bindDaySeg(event,eventElement,segment){if(isEventDraggable(event)){t.draggableDayEvent(event,eventElement,segment);}
if(segment.isEnd&&isEventResizable(event)){t.resizableDayEvent(event,eventElement,segment);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement){var hoverListener=getHoverListener();var dayDelta;eventElement.draggable({delay:50,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell||!rowDelta&&!colDelta);clearOverlays();if(cell){var origDate=cellToDate(origCell);var date=cellToDate(cell);dayDelta=dayDiff(date,origDate);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}else{dayDelta=0;}},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(dayDelta){eventDrop(this,event,dayDelta,0,event.allDay,ev,ui);}else{eventElement.css('filter','');showEvents(event,eventElement);}}});}
function resizableDayEvent(event,element,segment){var isRTL=opt('isRTL');var direction=isRTL?'w':'e';var handle=element.find('.ui-resizable-'+direction);var isResizing=false;disableTextSelection(element);element.mousedown(function(ev){ev.preventDefault();}).click(function(ev){if(isResizing){ev.preventDefault();ev.stopImmediatePropagation();}});handle.mousedown(function(ev){if(ev.which!=1){return;}
isResizing=true;var hoverListener=getHoverListener();var rowCnt=getRowCnt();var colCnt=getColCnt();var elementTop=element.css('top');var dayDelta;var helpers;var eventCopy=$.extend({},event);var minCellOffset=dayOffsetToCellOffset(dateToDayOffset(event.start));clearSelection();$('body').css('cursor',direction+'-resize').one('mouseup',mouseup);trigger('eventResizeStart',this,event,ev);hoverListener.start(function(cell,origCell){if(cell){var origCellOffset=cellToCellOffset(origCell);var cellOffset=cellToCellOffset(cell);cellOffset=Math.max(cellOffset,minCellOffset);dayDelta=cellOffsetToDayOffset(cellOffset)-
cellOffsetToDayOffset(origCellOffset);if(dayDelta){eventCopy.end=addDays(eventEnd(event),dayDelta,true);var oldHelpers=helpers;helpers=renderTempDayEvent(eventCopy,segment.row,elementTop);helpers=$(helpers);helpers.find('*').css('cursor',direction+'-resize');if(oldHelpers){oldHelpers.remove();}
hideEvents(event);}
else{if(helpers){showEvents(event);helpers.remove();helpers=null;}}
clearOverlays();renderDayOverlay(event.start,addDays(exclEndDay(event),dayDelta));}},ev);function mouseup(ev){trigger('eventResizeStop',this,event,ev);$('body').css('cursor','');hoverListener.stop();clearOverlays();if(dayDelta){eventResize(this,event,dayDelta,0,ev);}
setTimeout(function(){isResizing=false;},0);}});}}
function isDaySegmentCollision(segment,otherSegments){for(var i=0;i<otherSegments.length;i++){var otherSegment=otherSegments[i];if(otherSegment.leftCol<=segment.rightCol&&otherSegment.rightCol>=segment.leftCol){return true;}}
return false;}
function segmentElementEach(segments,callback){for(var i=0;i<segments.length;i++){var segment=segments[i];var element=segment.element;if(element){callback(segment,element,i);}}}
function compareDaySegments(a,b){return(b.rightCol-b.leftCol)-(a.rightCol-a.leftCol)||b.event.allDay-a.event.allDay||a.event.start-b.event.start||(a.event.title||'').localeCompare(b.event.title)};;function SelectionManager(){var t=this;t.select=select;t.unselect=unselect;t.reportSelection=reportSelection;t.daySelectionMousedown=daySelectionMousedown;var opt=t.opt;var trigger=t.trigger;var defaultSelectionEnd=t.defaultSelectionEnd;var renderSelection=t.renderSelection;var clearSelection=t.clearSelection;var selected=false;if(opt('selectable')&&opt('unselectAuto')){$(document).mousedown(function(ev){var ignore=opt('unselectCancel');if(ignore){if($(ev.target).parents(ignore).length){return;}}
unselect(ev);});}
function select(startDate,endDate,allDay){unselect();if(!endDate){endDate=defaultSelectionEnd(startDate,allDay);}
renderSelection(startDate,endDate,allDay);reportSelection(startDate,endDate,allDay);}
function unselect(ev){if(selected){selected=false;clearSelection();trigger('unselect',null,ev);}}
function reportSelection(startDate,endDate,allDay,ev){selected=true;trigger('select',null,startDate,endDate,allDay,ev);}
function daySelectionMousedown(ev){var cellToDate=t.cellToDate;var getIsCellAllDay=t.getIsCellAllDay;var hoverListener=t.getHoverListener();var reportDayClick=t.reportDayClick;if(ev.which==1&&opt('selectable')){unselect(ev);var _mousedownElement=this;var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&getIsCellAllDay(cell)){dates=[cellToDate(origCell),cellToDate(cell)].sort(dateCompare);renderSelection(dates[0],dates[1],true);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],true,ev);}
reportSelection(dates[0],dates[1],true,ev);}});}}};;function OverlayManager(){var t=this;t.renderOverlay=renderOverlay;t.clearOverlays=clearOverlays;var usedOverlays=[];var unusedOverlays=[];function renderOverlay(rect,parent){var e=unusedOverlays.shift();if(!e){e=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>");}
if(e[0].parentNode!=parent[0]){e.appendTo(parent);}
usedOverlays.push(e.css(rect).show());return e;}
function clearOverlays(){var e;while(e=usedOverlays.shift()){unusedOverlays.push(e.hide().unbind());}}};;function CoordinateGrid(buildFunc){var t=this;var rows;var cols;t.build=function(){rows=[];cols=[];buildFunc(rows,cols);};t.cell=function(x,y){var rowCnt=rows.length;var colCnt=cols.length;var i,r=-1,c=-1;for(i=0;i<rowCnt;i++){if(y>=rows[i][0]&&y<rows[i][1]){r=i;break;}}
for(i=0;i<colCnt;i++){if(x>=cols[i][0]&&x<cols[i][1]){c=i;break;}}
return(r>=0&&c>=0)?{row:r,col:c}:null;};t.rect=function(row0,col0,row1,col1,originElement){var origin=originElement.offset();return{top:rows[row0][0]-origin.top,left:cols[col0][0]-origin.left,width:cols[col1][1]-cols[col0][0],height:rows[row1][1]-rows[row0][0]};};};;function HoverListener(coordinateGrid){var t=this;var bindType;var change;var firstCell;var cell;t.start=function(_change,ev,_bindType){change=_change;firstCell=cell=null;coordinateGrid.build();mouse(ev);bindType=_bindType||'mousemove';$(document).bind(bindType,mouse);};function mouse(ev){_fixUIEvent(ev);var newCell=coordinateGrid.cell(ev.pageX,ev.pageY);if(!newCell!=!cell||newCell&&(newCell.row!=cell.row||newCell.col!=cell.col)){if(newCell){if(!firstCell){firstCell=newCell;}
change(newCell,firstCell,newCell.row-firstCell.row,newCell.col-firstCell.col);}else{change(newCell,firstCell);}
cell=newCell;}}
t.stop=function(){$(document).unbind(bindType,mouse);return cell;};}
function _fixUIEvent(event){if(event.pageX===undefined){event.pageX=event.originalEvent.pageX;event.pageY=event.originalEvent.pageY;}};;function HorizontalPositionCache(getElement){var t=this,elements={},lefts={},rights={};function e(i){return elements[i]=elements[i]||getElement(i);}
t.left=function(i){return lefts[i]=lefts[i]===undefined?e(i).position().left:lefts[i];};t.right=function(i){return rights[i]=rights[i]===undefined?t.left(i)+e(i).width():rights[i];};t.clear=function(){elements={};lefts={};rights={};};};;})(jQuery);;

/* /web_calendar/static/src/js/web_calendar.js defined in bundle 'web.assets_backend' */
_.str.toBoolElse=function(str,elseValues,trueValues,falseValues){var ret=_.str.toBool(str,trueValues,falseValues);if(_.isUndefined(ret)){return elseValues;}
return ret;};openerp.web_calendar=function(instance){var _t=instance.web._t,_lt=instance.web._lt,QWeb=instance.web.qweb;function get_class(name){return new instance.web.Registry({'tmp':name}).get_object("tmp");}
function get_fc_defaultOptions(){shortTimeformat=Date.CultureInfo.formatPatterns.shortTime;var dateFormat=Date.normalizeFormat(instance.web.strip_raw_chars(_t.database.parameters.date_format));return{weekNumberTitle:_t("W"),allDayText:_t("All day"),buttonText:{today:_t("Today"),month:_t("Month"),week:_t("Week"),day:_t("Day")},monthNames:Date.CultureInfo.monthNames,monthNamesShort:Date.CultureInfo.abbreviatedMonthNames,dayNames:Date.CultureInfo.dayNames,dayNamesShort:Date.CultureInfo.abbreviatedDayNames,firstDay:Date.CultureInfo.firstDayOfWeek,weekNumbers:true,axisFormat:shortTimeformat.replace(/:mm/,'(:mm)'),timeFormat:{agenda:shortTimeformat+'{ - '+shortTimeformat+'}','':shortTimeformat.replace(/:mm/,'(:mm)')},titleFormat:{month:'MMMM yyyy',week:dateFormat+"{ '&#8212;'"+dateFormat,day:dateFormat,},columnFormat:{month:'ddd',week:'ddd '+dateFormat,day:'dddd '+dateFormat,},weekMode:'liquid',aspectRatio:1.8,snapMinutes:15,};}
function is_virtual_id(id){return typeof id==="string"&&id.indexOf('-')>=0;}
function isNullOrUndef(value){return _.isUndefined(value)||_.isNull(value);}
instance.web.views.add('calendar','instance.web_calendar.CalendarView');instance.web_calendar.CalendarView=instance.web.View.extend({template:"CalendarView",display_name:_lt('Calendar'),quick_create_instance:'instance.web_calendar.QuickCreate',init:function(parent,dataset,view_id,options){this._super(parent);this.ready=$.Deferred();this.set_default_options(options);this.dataset=dataset;this.model=dataset.model;this.fields_view={};this.view_id=view_id;this.view_type='calendar';this.color_map={};this.range_start=null;this.range_stop=null;this.selected_filters=[];},set_default_options:function(options){this._super(options);_.defaults(this.options,{confirm_on_delete:true});},destroy:function(){this.$calendar.fullCalendar('destroy');if(this.$small_calendar){this.$small_calendar.datepicker('destroy');}
this._super.apply(this,arguments);},view_loading:function(fv){var attrs=fv.arch.attrs,self=this;this.fields_view=fv;this.$calendar=this.$el.find(".oe_calendar_widget");this.info_fields=[];this.$buttons=$(QWeb.render("CalendarView.buttons",{'widget':this}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}else{this.$el.find('.oe_calendar_buttons').replaceWith(this.$buttons);}
this.$buttons.on('click','button.oe_calendar_button_new',function(){self.dataset.index=null;self.do_switch_view('form');});if(!attrs.date_start){throw new Error(_t("Calendar view has not defined 'date_start' attribute."));}
this.$el.addClass(attrs['class']);this.name=fv.name||attrs.string;this.view_id=fv.view_id;this.mode=attrs.mode;this.date_start=attrs.date_start;this.date_delay=attrs.date_delay;this.date_stop=attrs.date_stop;this.all_day=attrs.all_day;this.how_display_event='';this.attendee_people=attrs.attendee;if(!isNullOrUndef(attrs.quick_create_instance)){self.quick_create_instance='instance.'+attrs.quick_create_instance;}
this.quick_add_pop=(isNullOrUndef(attrs.quick_add)||_.str.toBoolElse(attrs.quick_add,true));if(this.quick_add_pop&&!isNullOrUndef(attrs.quick_add)){self.quick_create_instance='instance.'+attrs.quick_add;}
if(!isNullOrUndef(attrs.display)){this.how_display_event=attrs.display;}
if(isNullOrUndef(attrs.event_open_popup)||!_.str.toBoolElse(attrs.event_open_popup,true)){this.open_popup_action=false;}else{this.open_popup_action=attrs.event_open_popup;}
this.useContacts=(!isNullOrUndef(attrs.use_contacts)&&_.str.toBool(attrs.use_contacts))&&(!isNullOrUndef(self.options.$sidebar));this.colorIsAttendee=(!(isNullOrUndef(attrs.color_is_attendee)||!_.str.toBoolElse(attrs.color_is_attendee,true)))&&(!isNullOrUndef(self.options.$sidebar));if(isNullOrUndef(self.options.$sidebar)){this.useContacts=false;this.colorIsAttendee=false;this.attendee_people=undefined;}
if(isNullOrUndef(attrs.avatar_model)){this.avatar_model=null;}else{this.avatar_model=attrs.avatar_model;}
if(isNullOrUndef(attrs.avatar_title)){this.avatar_title=this.avatar_model;}else{this.avatar_title=attrs.avatar_title;}
if(isNullOrUndef(attrs.avatar_filter)){this.avatar_filter=this.avatar_model;}else{this.avatar_filter=attrs.avatar_filter;}
this.color_field=attrs.color;if(this.color_field&&this.selected_filters.length===0){var default_filter;if((default_filter=this.dataset.context['calendar_default_'+this.color_field])){this.selected_filters.push(default_filter+'');}}
this.fields=fv.fields;for(var fld=0;fld<fv.arch.children.length;fld++){this.info_fields.push(fv.arch.children[fld].attrs.name);}
var edit_check=new instance.web.Model(this.dataset.model).call("check_access_rights",["write",false]).then(function(write_right){self.write_right=write_right;});var init=new instance.web.Model(this.dataset.model).call("check_access_rights",["create",false]).then(function(create_right){self.create_right=create_right;self.init_calendar().then(function(){$(window).trigger('resize');self.trigger('calendar_view_loaded',fv);self.ready.resolve();});});return $.when(edit_check,init);},get_fc_init_options:function(){var self=this;return $.extend({},get_fc_defaultOptions(),{defaultView:(this.mode=="month")?"month":(this.mode=="week"?"agendaWeek":(this.mode=="day"?"agendaDay":"month")),header:{left:'prev,next today',center:'title',right:'month,agendaWeek,agendaDay'},selectable:!this.options.read_only_mode&&this.create_right,selectHelper:true,editable:!this.options.read_only_mode,droppable:true,eventDrop:function(event,_day_delta,_minute_delta,_all_day,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventResize:function(event,_day_delta,_minute_delta,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventRender:function(event,element,view){element.find('.fc-event-title').html(event.title);},eventAfterRender:function(event,element,view){if((view.name!=='month')&&(((event.end-event.start)/60000)<=30)){var current_title=$(element.find('.fc-event-time')).text();var new_title=current_title.substr(0,current_title.indexOf("<img")>0?current_title.indexOf("<img"):current_title.length);element.find('.fc-event-time').html(new_title);}},eventClick:function(event){self.open_event(event._id,event.title);},select:function(start_date,end_date,all_day,_js_event,_view){var data_template=self.get_event_data({start:start_date,end:end_date,allDay:all_day,});self.open_quick_create(data_template);},unselectAuto:false,});},calendarMiniChanged:function(context){return function(datum,obj){var curView=context.$calendar.fullCalendar('getView');var curDate=new Date(obj.currentYear,obj.currentMonth,obj.currentDay);if(curView.name=="agendaWeek"){if(curDate<=curView.end&&curDate>=curView.start){context.$calendar.fullCalendar('changeView','agendaDay');}}
else if(curView.name!="agendaDay"||(curView.name=="agendaDay"&&curDate.compareTo(curView.start)===0)){context.$calendar.fullCalendar('changeView','agendaWeek');}
context.$calendar.fullCalendar('gotoDate',obj.currentYear,obj.currentMonth,obj.currentDay);};},init_calendar:function(){var self=this;if(!this.sidebar&&this.options.$sidebar){translate=get_fc_defaultOptions();this.sidebar=new instance.web_calendar.Sidebar(this);this.sidebar.appendTo(this.$el.find('.oe_calendar_sidebar_container'));this.$small_calendar=self.$el.find(".oe_calendar_mini");this.$small_calendar.datepicker({onSelect:self.calendarMiniChanged(self),dayNamesMin:translate.dayNamesShort,monthNames:translate.monthNamesShort,firstDay:translate.firstDay,});this.extraSideBar();}
self.$calendar.fullCalendar(self.get_fc_init_options());return $.when();},extraSideBar:function(){},open_quick_create:function(data_template){if(!isNullOrUndef(this.quick)){return this.quick.trigger('close');}
var QuickCreate=get_class(this.quick_create_instance);this.options.disable_quick_create=this.options.disable_quick_create||!this.quick_add_pop;this.quick=new QuickCreate(this,this.dataset,true,this.options,data_template);this.quick.on('added',this,this.quick_created).on('slowadded',this,this.slow_created).on('close',this,function(){this.quick.destroy();delete this.quick;this.$calendar.fullCalendar('unselect');});this.quick.replace(this.$el.find('.oe_calendar_qc_placeholder'));this.quick.focus();},refresh_event:function(id){var self=this;if(is_virtual_id(id)){console.warn("Unwise use of refresh_event on a virtual ID.");}
this.dataset.read_ids([id],_.keys(this.fields)).done(function(incomplete_records){self.perform_necessary_name_gets(incomplete_records).then(function(records){var new_event=self.event_data_transform(records[0]);var event_objs=self.$calendar.fullCalendar('clientEvents',id);if(event_objs.length==1){var event_obj=event_objs[0];_(new_event).each(function(value,key){event_obj[key]=value;});self.$calendar.fullCalendar('updateEvent',event_obj);}else{self.$calendar.fullCalendar('renderEvent',new_event);self.$calendar.fullCalendar('clientEvents',id)[0].source=self.event_source;}});});},get_color:function(key){if(this.color_map[key]){return this.color_map[key];}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},perform_necessary_name_gets:function(evts){var def=$.Deferred();var self=this;var to_get={};_(this.info_fields).each(function(fieldname){if(!_(["many2one","one2one"]).contains(self.fields[fieldname].type))
return;to_get[fieldname]=[];_(evts).each(function(evt){var value=evt[fieldname];if(value===false||(value instanceof Array)){return;}
to_get[fieldname].push(value);});if(to_get[fieldname].length===0){delete to_get[fieldname];}});var defs=_(to_get).map(function(ids,fieldname){return(new instance.web.Model(self.fields[fieldname].relation)).call('name_get',ids).then(function(vals){return[fieldname,vals];});});$.when.apply(this,defs).then(function(){var values=arguments;_(values).each(function(value){var fieldname=value[0];var name_gets=value[1];_(name_gets).each(function(name_get){_(evts).chain().filter(function(e){return e[fieldname]==name_get[0];}).each(function(evt){evt[fieldname]=name_get;});});});def.resolve(evts);});return def;},event_data_transform:function(evt){var self=this;var date_delay=evt[this.date_delay]||1.0,all_day=this.all_day?evt[this.all_day]:false,res_computed_text='',the_title='',attendees=[];if(!all_day){date_start=instance.web.auto_str_to_date(evt[this.date_start]);date_stop=this.date_stop?instance.web.auto_str_to_date(evt[this.date_stop]):null;}
else{date_start=instance.web.auto_str_to_date(evt[this.date_start].split(' ')[0],'start');date_stop=this.date_stop?instance.web.auto_str_to_date(evt[this.date_stop].split(' ')[0],'start'):null;}
if(this.info_fields){var temp_ret={};res_computed_text=this.how_display_event;_.each(this.info_fields,function(fieldname){var value=evt[fieldname];if(_.contains(["many2one","one2one"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value[1];}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else if(_.contains(["one2many","many2many"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value;}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else{temp_ret[fieldname]=value;}
res_computed_text=res_computed_text.replace("["+fieldname+"]",temp_ret[fieldname]);});if(res_computed_text.length){the_title=res_computed_text;}
else{var res_text=[];_.each(temp_ret,function(val,key){if(typeof(val)=='boolean'&&val==false){}
else{res_text.push(val)};});the_title=res_text.join(', ');}
the_title=_.escape(the_title);the_title_avatar='';if(!_.isUndefined(this.attendee_people)){var MAX_ATTENDEES=3;var attendee_showed=0;var attendee_other='';_.each(temp_ret[this.attendee_people],function(the_attendee_people){attendees.push(the_attendee_people);attendee_showed+=1;if(attendee_showed<=MAX_ATTENDEES){if(self.avatar_model!==null){the_title_avatar+='<img title="'+self.all_attendees[the_attendee_people]+'" class="attendee_head"  \
                                                            src="/web/binary/image?model='+self.avatar_model+'&field=image_small&id='+the_attendee_people+'"></img>';}
else{if(!self.colorIsAttendee||the_attendee_people!=temp_ret[self.color_field]){tempColor=(self.all_filters[the_attendee_people]!==undefined)?self.all_filters[the_attendee_people].color:(self.all_filters[-1]?self.all_filters[-1].color:1);the_title_avatar+='<i class="fa fa-user attendee_head color_'+tempColor+'" title="'+self.all_attendees[the_attendee_people]+'" ></i>';}}}
else{attendee_other+=self.all_attendees[the_attendee_people]+", ";}});if(attendee_other.length>2){the_title_avatar+='<span class="attendee_head" title="'+attendee_other.slice(0,-2)+'">+</span>';}
the_title=the_title_avatar+the_title;}}
if(!date_stop&&date_delay){date_stop=date_start.clone().addHours(date_delay);}
var r={'start':date_start.toString('yyyy-MM-dd HH:mm:ss'),'end':date_stop.toString('yyyy-MM-dd HH:mm:ss'),'title':the_title,'allDay':(this.fields[this.date_start].type=='date'||(this.all_day&&evt[this.all_day])||false),'id':evt.id,'attendees':attendees};if(!self.useContacts||self.all_filters[evt[this.color_field]]!==undefined){if(this.color_field&&evt[this.color_field]){var color_key=evt[this.color_field];if(typeof color_key==="object"){color_key=color_key[0];}
r.className='cal_opacity calendar_color_'+this.get_color(color_key);}}
else{r.className='cal_opacity calendar_color_'+self.all_filters[-1].color;}
return r;},get_event_data:function(event){var data={name:event.title};var event_end=event.end;if(event_end==null){event_end=new Date(event.start).addHours(2);}
if(event.allDay){if(event_end==null||_.isUndefined(event_end)){event_end=new Date(event.start);}
if(this.all_day){date_start_day=new Date(Date.UTC(event.start.getFullYear(),event.start.getMonth(),event.start.getDate()));date_stop_day=new Date(Date.UTC(event_end.getFullYear(),event_end.getMonth(),event_end.getDate()));}
else{date_start_day=new Date(event.start.getFullYear(),event.start.getMonth(),event.start.getDate(),7);date_stop_day=new Date(event_end.getFullYear(),event_end.getMonth(),event_end.getDate(),19);}
data[this.date_start]=instance.web.parse_value(date_start_day,this.fields[this.date_start]);if(this.date_stop){data[this.date_stop]=instance.web.parse_value(date_stop_day,this.fields[this.date_stop]);}
diff_seconds=Math.round((date_stop_day.getTime()-date_start_day.getTime())/1000);}
else{data[this.date_start]=instance.web.parse_value(event.start,this.fields[this.date_start]);if(this.date_stop){data[this.date_stop]=instance.web.parse_value(event_end,this.fields[this.date_stop]);}
diff_seconds=Math.round((event_end.getTime()-event.start.getTime())/1000);}
if(this.all_day){data[this.all_day]=event.allDay;}
if(this.date_delay){data[this.date_delay]=diff_seconds/3600;}
return data;},do_search:function(domain,context,_group_by){var self=this;if(!self.all_filters){self.all_filters={}}
if(!_.isUndefined(this.event_source)){this.$calendar.fullCalendar('removeEventSource',this.event_source);}
this.event_source={events:function(start,end,callback){var current_event_source=self.event_source;self.dataset.read_slice(_.keys(self.fields),{offset:0,domain:self.get_range_domain(domain,start,end),context:context,}).done(function(events){if(self.dataset.index===null){if(events.length){self.dataset.index=0;}}else if(self.dataset.index>=events.length){self.dataset.index=events.length?0:null;}
if(self.event_source!==current_event_source){console.log("Consecutive ``do_search`` called. Cancelling.");return;}
if(!self.useContacts){var filter_item;self.now_filter_ids=[];var color_field=self.fields[self.color_field];_.each(events,function(e){var key,val=null;if(self.color_field.type=="selection"){key=e[self.color_field];val=_.find(self.color_field.selection,function(name){return name[0]===key;});}
else{key=e[self.color_field][0];val=e[self.color_field];}
if(!self.all_filters[key]){filter_item={value:key,label:val[1],color:self.get_color(key),avatar_model:(_.str.toBoolElse(self.avatar_filter,true)?self.avatar_filter:false),is_checked:true};self.all_filters[key]=filter_item;}
if(!_.contains(self.now_filter_ids,key)){self.now_filter_ids.push(key);}});if(self.sidebar){self.sidebar.filter.events_loaded();self.sidebar.filter.set_filters();events=$.map(events,function(e){var key=self.color_field.type=="selection"?e[self.color_field]:e[self.color_field][0];if(_.contains(self.now_filter_ids,key)&&self.all_filters[key].is_checked){return e;}
return null;});}}
else{if(self.attendee_people!==undefined){if(!self.all_filters[-1]||!self.all_filters[-1].is_checked){var checked_filter=$.map(self.all_filters,function(o){if(o.is_checked){return o.value;}});events=$.map(events,function(e){if(_.intersection(checked_filter,e[self.attendee_people]).length){return e;}
return null;});}}}
var all_attendees=$.map(events,function(e){return e[self.attendee_people];});all_attendees=_.chain(all_attendees).flatten().uniq().value();self.all_attendees={};if(self.avatar_title!==null){new instance.web.Model(self.avatar_title).query(["name"]).filter([["id","in",all_attendees]]).all().then(function(result){_.each(result,function(item){self.all_attendees[item.id]=item.name;});}).done(function(){return self.perform_necessary_name_gets(events).then(callback);});}
else{_.each(all_attendees,function(item){self.all_attendees[item]='';});return self.perform_necessary_name_gets(events).then(callback);}});},eventDataTransform:function(event){return self.event_data_transform(event);},};this.$calendar.fullCalendar('addEventSource',this.event_source);},get_range_domain:function(domain,start,end){var format=instance.web.date_to_str;extend_domain=[[this.date_start,'>=',format(start.clone())],[this.date_start,'<=',format(end.clone())]];if(this.date_stop){extend_domain.splice(0,0,'|','|','&');extend_domain.push('&',[this.date_start,'<=',format(start.clone())],[this.date_stop,'>=',format(start.clone())],'&',[this.date_start,'<=',format(end.clone())],[this.date_stop,'>=',format(start.clone())]);}
return new instance.web.CompoundDomain(domain,extend_domain);},update_record:function(id,data){var self=this;delete(data.name);var index=this.dataset.get_id_index(id);if(index!==null){event_id=this.dataset.ids[index];this.dataset.write(event_id,data,{}).done(function(){if(is_virtual_id(event_id)){self.$calendar.fullCalendar('refetchEvents');}else{self.refresh_event(event_id);}});}
return false;},open_event:function(id,title){var self=this;if(!this.open_popup_action){var index=this.dataset.get_id_index(id);this.dataset.index=index;if(this.write_right){this.do_switch_view('form',null,{mode:"edit"});}else{this.do_switch_view('form',null,{mode:"view"});}}
else{var pop=new instance.web.form.FormOpenPopup(this);var id_cast=parseInt(id).toString()==id?parseInt(id):id;pop.show_element(this.dataset.model,id_cast,this.dataset.get_context(),{title:_.str.sprintf(_t("View: %s"),title),view_id:+this.open_popup_action,res_id:id_cast,target:'new',readonly:true});var form_controller=pop.view_form;form_controller.on("load_record",self,function(){button_delete=_.str.sprintf("<button class='oe_button oe_bold delme'><span> %s </span></button>",_t("Delete"));button_edit=_.str.sprintf("<button class='oe_button oe_bold editme oe_highlight'><span> %s </span></button>",_t("Edit Event"));pop.$el.closest(".modal").find(".modal-footer").prepend(button_delete);pop.$el.closest(".modal").find(".modal-footer").prepend(button_edit);$('.delme').click(function(){$('.oe_form_button_cancel').trigger('click');self.remove_event(id);});$('.editme').click(function(){$('.oe_form_button_cancel').trigger('click');self.dataset.index=self.dataset.get_id_index(id);self.do_switch_view('form',null,{mode:"edit"});});});}
return false;},do_show:function(){if(this.$buttons){this.$buttons.show();}
this.do_push_state({});return this._super();},do_hide:function(){if(this.$buttons){this.$buttons.hide();}
return this._super();},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable){return false;}
return this._super(action);},quick_created:function(id){this.dataset.ids=this.dataset.ids.concat([id]);this.dataset.trigger("dataset_changed",id);this.refresh_event(id);},slow_created:function(){var self=this;if(self.sidebar){self.sidebar.filter.is_loaded=false;}
self.$calendar.fullCalendar('refetchEvents');},remove_event:function(id){var self=this;function do_it(){return $.when(self.dataset.unlink([id])).then(function(){self.$calendar.fullCalendar('removeEvents',id);});}
if(this.options.confirm_on_delete){if(confirm(_t("Are you sure you want to delete this record ?"))){return do_it();}}else
return do_it();},});instance.web_calendar.QuickCreate=instance.web.Widget.extend({template:'CalendarView.quick_create',init:function(parent,dataset,buttons,options,data_template){this._super(parent);this.dataset=dataset;this._buttons=buttons||false;this.options=options;this.data_template=data_template||{};},get_title:function(){var parent=this.getParent();if(_.isUndefined(parent)){return _t("Create");}
var title=(_.isUndefined(parent.field_widget))?(parent.string||parent.name):parent.field_widget.string||parent.field_widget.name||'';return _t("Create: ")+title;},start:function(){var self=this;if(this.options.disable_quick_create){this.$el.hide();this.slow_create();return;}
self.$input=this.$el.find('input');self.$input.keyup(function enterHandler(event){if(event.keyCode==13){self.$input.off('keyup',enterHandler);if(!self.quick_add()){self.$input.on('keyup',enterHandler);}}});var submit=this.$el.find(".oe_calendar_quick_create_add");submit.click(function clickHandler(){submit.off('click',clickHandler);if(!self.quick_add()){submit.on('click',clickHandler);}
self.focus();});this.$el.find(".oe_calendar_quick_create_edit").click(function(){self.slow_add();self.focus();});this.$el.find(".oe_calendar_quick_create_close").click(function(ev){ev.preventDefault();self.trigger('close');});self.$input.keyup(function enterHandler(e){if(e.keyCode==27&&self._buttons){self.trigger('close');}});self.$el.dialog({title:this.get_title()});self.on('added',self,function(){self.trigger('close');});self.$el.on('dialogclose',self,function(){self.trigger('close');});},focus:function(){this.$el.find('input').focus();},quick_add:function(){var val=this.$input.val();if(/^\s*$/.test(val)){return false;}
return this.quick_create({'name':val}).always(function(){return true;});},slow_add:function(){var val=this.$input.val();this.slow_create({'name':val});},quick_create:function(data,options){var self=this;return this.dataset.create($.extend({},this.data_template,data),options).then(function(id){self.trigger('added',id);self.$input.val("");}).fail(function(r,event){event.preventDefault();self.slow_create(data);});},get_form_popup_infos:function(){var parent=this.getParent();var infos={view_id:false,title:this.name,};if(!_.isUndefined(parent)&&!(_.isUndefined(parent.ViewManager))){infos.view_id=parent.ViewManager.get_view_id('form');}
return infos;},slow_create:function(data){var self=this;var def=$.Deferred();var defaults={};var created=false;_.each($.extend({},this.data_template,data),function(val,field_name){defaults['default_'+field_name]=val;});var pop_infos=self.get_form_popup_infos();var pop=new instance.web.form.FormOpenPopup(this);var context=new instance.web.CompoundContext(this.dataset.context,defaults);pop.show_element(this.dataset.model,null,this.dataset.get_context(defaults),{title:this.get_title(),disable_multiple_selection:true,view_id:pop_infos.view_id,create_function:function(data,options){return self.dataset.create(data,options).done(function(r){}).fail(function(r,event){if(!r.data.message){throw new Error(r);}});},read_function:function(id,fields,options){return self.dataset.read_ids.apply(self.dataset,arguments).done(function(){}).fail(function(r,event){if(!r.data.message){throw new Error(r);}});},});pop.on('closed',self,function(){if(def.state()==="pending"){def.resolve();}});pop.on('create_completed',self,function(id){created=true;self.trigger('slowadded');});def.then(function(){if(created){var parent=self.getParent();parent.$calendar.fullCalendar('refetchEvents');}
self.trigger('close');});return def;},});function widget_calendar_lazy_init(){if(instance.web.form.Many2ManyCalendarView){return;}
instance.web_calendar.FieldCalendarView=instance.web_calendar.CalendarView.extend({init:function(parent){this._super.apply(this,arguments);this.field_widget=parent;},view_loading:function(fv){var self=this;return $.when(this._super.apply(this,arguments)).then(function(){self.on('event_rendered',this,function(event,element,view){});});},init_calendar:function(){if(this.$calendar.width()!==0){return this._super();}
var def=$.Deferred();var self=this;this.$calendar.parents(".ui-tabs").on('tabsactivate',this,function(){if(self.$calendar.width()!==0){self.$calendar.fullCalendar(self.get_fc_init_options());def.resolve();}});return def;},});}
instance.web_calendar.BufferedDataSet=instance.web.BufferedDataSet.extend({create:function(data,options){var def=$.Deferred();var self=this;var create=this._super;if(_.isUndefined(this.required_fields)){this.required_fields=(new instance.web.Model(this.model)).call('fields_get').then(function(fields_def){return _(fields_def).chain().map(function(value,key){return[key,value];}).filter(function(pair){return pair[0]!==self.field_widget.field.relation_field;}).filter(function(pair){return pair[1].required;}).map(function(pair){return pair[0];}).value();});}
$.when(this.required_fields).then(function(required_fields){var missing_fields=_(required_fields).filter(function(v){return _.isUndefined(data[v]);});var default_get=(missing_fields.length!==0)?self.default_get(missing_fields):[];$.when(default_get).then(function(defaults){missing_fields=_(missing_fields).filter(function(f){return _.isUndefined(defaults[f]);});if(missing_fields.length!==0){def.reject(_.str.sprintf(_t("Missing required fields %s"),missing_fields.join(", ")),$.Event());return;}
create.apply(self,[data,options]).then(function(result){def.resolve(result);});});});return def;},});instance.web_calendar.fields_dataset=new instance.web.Registry({'many2many':'instance.web.DataSetStatic','one2many':'instance.web_calendar.BufferedDataSet',});function get_field_dataset_class(type){var obj=instance.web_calendar.fields_dataset.get_any([type]);if(!obj){throw new Error(_.str.sprintf(_t("Dataset for type '%s' is not defined."),type));}
return obj.extend({init:function(parent){this._super.apply(this,arguments);this.field_widget=parent;},get_context:function(){this.context=this.field_widget.build_context();return this.context;}});}
instance.web_calendar.FieldCalendar=instance.web.form.AbstractField.extend({disable_utility_classes:true,calendar_view_class:'instance.web_calendar.FieldCalendarView',init:function(field_manager,node){this._super(field_manager,node);widget_calendar_lazy_init();this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;var self=this;var field_type=field_manager.fields_view.fields[node.attrs.name].type;this.dataset=new(get_field_dataset_class(field_type))(this,this.field.relation);this.dataset.on('unlink',this,function(_ids){this.dataset.trigger('dataset_changed');});this.quick_create=null;this.no_rerender=true;},start:function(){this._super.apply(this,arguments);var self=this;self.load_view();self.on("change:effective_readonly",self,function(){self.is_loaded=self.is_loaded.then(function(){self.calendar_view.destroy();return $.when(self.load_view()).done(function(){self.render_value();});});});},load_view:function(){var self=this;var calendar_view_class=get_class(this.calendar_view_class);this.calendar_view=new calendar_view_class(this,this.dataset,false,$.extend({'create_text':_t("Add"),'creatable':self.get("effective_readonly")?false:true,'quick_creatable':self.get("effective_readonly")?false:true,'read_only_mode':self.get("effective_readonly")?true:false,'confirm_on_delete':false,},this.options));var embedded=(this.field.views||{}).calendar;if(embedded){this.calendar_view.set_embedded_view(embedded);}
var loaded=$.Deferred();this.calendar_view.on("calendar_view_loaded",self,function(){self.initial_is_loaded.resolve();loaded.resolve();});this.calendar_view.on('switch_mode',this,this.open_popup);$.async_when().done(function(){self.calendar_view.appendTo(self.$el);});return loaded;},render_value:function(){var self=this;this.dataset.set_ids(this.get("value"));this.is_loaded=this.is_loaded.then(function(){return self.calendar_view.do_search(self.build_domain(),self.dataset.get_context(),[]);});},open_popup:function(type,unused){if(type!=="form"){return;}
if(this.dataset.index==null){if(typeof this.open_popup_add==="function"){this.open_popup_add();}}else{if(typeof this.open_popup_edit==="function"){this.open_popup_edit();}}},open_popup_add:function(){throw new Error("Not Implemented");},open_popup_edit:function(){var id=this.dataset.ids[this.dataset.index];var self=this;var pop=(new instance.web.form.FormOpenPopup(this));pop.show_element(this.field.relation,id,this.build_context(),{title:_t("Open: ")+this.string,write_function:function(id,data,_options){return self.dataset.write(id,data,{}).done(function(){self.calendar_view.refresh_event(id);});},read_function:function(id,fields,options){return self.dataset.read_ids.apply(self.dataset,arguments).done(function(){}).fail(function(r,event){throw new Error(r);});},alternative_form_view:this.field.views?this.field.views.form:undefined,parent_view:this.view,child_name:this.name,readonly:this.get("effective_readonly")});}});instance.web_calendar.Sidebar=instance.web.Widget.extend({template:'CalendarView.sidebar',start:function(){this._super();this.filter=new instance.web_calendar.SidebarFilter(this,this.getParent());this.filter.appendTo(this.$el.find('.oe_calendar_filter'));}});instance.web_calendar.SidebarFilter=instance.web.Widget.extend({events:{'change input:checkbox':'filter_click','click span.color_filter':'select_previous',},init:function(parent,view){this._super(parent);this.view=view;},set_filters:function(){var self=this;_.forEach(self.view.all_filters,function(o){if(_.contains(self.view.now_filter_ids,o.value)){self.$('div.oe_calendar_responsible input[value='+o.value+']').prop('checked',o.is_checked);}});},events_loaded:function(filters){var self=this;if(filters==null){filters=[];_.forEach(self.view.all_filters,function(o){if(_.contains(self.view.now_filter_ids,o.value)){filters.push(o);}});}
this.$el.html(QWeb.render('CalendarView.sidebar.responsible',{filters:filters}));},filter_click:function(e){var self=this;if(self.view.all_filters[0]&&e.target.value==self.view.all_filters[0].value){self.view.all_filters[0].is_checked=e.target.checked;}else{self.view.all_filters[e.target.value].is_checked=e.target.checked;}
self.view.$calendar.fullCalendar('refetchEvents');},select_previous:function(e){$(e.target).siblings('input').trigger('click');}});};;

/* /web_ckeditor4/static/src/js/ckeditor_basepath.js defined in bundle 'web.assets_backend' */
CKEDITOR_BASEPATH='/web_ckeditor4/static/lib/ckeditor/';

/* /web_ckeditor4/static/lib/ckeditor/ckeditor.js defined in bundle 'web.assets_backend' */
﻿
(function(){if(window.CKEDITOR&&window.CKEDITOR.dom)return;window.CKEDITOR||(window.CKEDITOR=function(){var a=/(^|.*[\\\/])ckeditor\.js(?:\?.*|;.*)?$/i,e={timestamp:"EAPE",version:"4.4.6",revision:"08188c4",rnd:Math.floor(900*Math.random())+100,_:{pending:[],basePathSrcPattern:a},status:"unloaded",basePath:function(){var f=window.CKEDITOR_BASEPATH||"";if(!f)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var b=d[c].src.match(a);if(b){f=b[1];break}}-1==f.indexOf(":/")&&"//"!=f.slice(0,2)&&(f=0===f.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+
f:location.href.match(/^[^\?]*\/(?:)/)[0]+f);if(!f)throw'The CKEditor installation path could not be automatically detected. Please set the global variable "CKEDITOR_BASEPATH" before creating editor instances.';return f}(),getUrl:function(a){-1==a.indexOf(":/")&&0!==a.indexOf("/")&&(a=this.basePath+a);this.timestamp&&("/"!=a.charAt(a.length-1)&&!/[&?]t=/.test(a))&&(a+=(0<=a.indexOf("?")?"&":"?")+"t="+this.timestamp);return a},domReady:function(){function a(){try{document.addEventListener?(document.removeEventListener("DOMContentLoaded",a,!1),d()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",a),d())}catch(c){}}function d(){for(var a;a=c.shift();)a()}var c=[];return function(d){function b(){try{document.documentElement.doScroll("left")}catch(m){setTimeout(b,1);return}a()}c.push(d);"complete"===document.readyState&&setTimeout(a,1);if(1==c.length)if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",a);window.attachEvent("onload",a);d=!1;try{d=!window.frameElement}catch(e){}document.documentElement.doScroll&&d&&b()}}}()},b=window.CKEDITOR_GETURL;if(b){var c=e.getUrl;e.getUrl=function(a){return b.call(e,a)||c.call(e,a)}}return e}());CKEDITOR.event||(CKEDITOR.event=function(){},CKEDITOR.event.implementOn=function(a){var e=CKEDITOR.event.prototype,b;for(b in e)a[b]==null&&(a[b]=e[b])},CKEDITOR.event.prototype=function(){function a(a){var f=e(this);return f[a]||(f[a]=new b(a))}var e=function(a){a=a.getPrivate&&a.getPrivate()||a._||(a._={});return a.events||(a.events={})},b=function(a){this.name=a;this.listeners=[]};b.prototype={getListenerIndex:function(a){for(var f=0,d=this.listeners;f<d.length;f++)if(d[f].fn==a)return f;return-1}};return{define:function(b,f){var d=a.call(this,b);CKEDITOR.tools.extend(d,f,true)},on:function(b,f,d,e,l){function i(a,m,t,j){a={name:b,sender:this,editor:a,data:m,listenerData:e,stop:t,cancel:j,removeListener:g};return f.call(d,a)===false?false:a.data}function g(){t.removeListener(b,f)}var m=a.call(this,b);if(m.getListenerIndex(f)<0){m=m.listeners;d||(d=this);isNaN(l)&&(l=10);var t=this;i.fn=f;i.priority=l;for(var s=m.length-1;s>=0;s--)if(m[s].priority<=l){m.splice(s+1,0,i);return{removeListener:g}}m.unshift(i)}return{removeListener:g}},once:function(){var a=Array.prototype.slice.call(arguments),f=a[1];a[1]=function(a){a.removeListener();return f.apply(this,arguments)};return this.on.apply(this,a)},capture:function(){CKEDITOR.event.useCapture=1;var a=this.on.apply(this,arguments);CKEDITOR.event.useCapture=0;return a},fire:function(){var a=0,f=function(){a=1},d=0,b=function(){d=1};return function(l,i,g){var m=e(this)[l],l=a,t=d;a=d=0;if(m){var s=m.listeners;if(s.length)for(var s=s.slice(0),y,p=0;p<s.length;p++){if(m.errorProof)try{y=s[p].call(this,g,i,f,b)}catch(q){}else y=s[p].call(this,g,i,f,b);y===false?d=1:typeof y!="undefined"&&(i=y);if(a||d)break}}i=d?false:typeof i=="undefined"?true:i;a=l;d=t;return i}}(),fireOnce:function(a,f,d){f=this.fire(a,f,d);delete e(this)[a];return f},removeListener:function(a,f){var d=e(this)[a];if(d){var b=d.getListenerIndex(f);b>=0&&d.listeners.splice(b,1)}},removeAllListeners:function(){var a=e(this),f;for(f in a)delete a[f]},hasListeners:function(a){return(a=e(this)[a])&&a.listeners.length>0}}}());CKEDITOR.editor||(CKEDITOR.editor=function(){CKEDITOR._.pending.push([this,arguments]);CKEDITOR.event.call(this)},CKEDITOR.editor.prototype.fire=function(a,e){a in{instanceReady:1,loaded:1}&&(this[a]=true);return CKEDITOR.event.prototype.fire.call(this,a,e,this)},CKEDITOR.editor.prototype.fireOnce=function(a,e){a in{instanceReady:1,loaded:1}&&(this[a]=true);return CKEDITOR.event.prototype.fireOnce.call(this,a,e,this)},CKEDITOR.event.implementOn(CKEDITOR.editor.prototype));CKEDITOR.env||(CKEDITOR.env=function(){var a=navigator.userAgent.toLowerCase(),e={ie:a.indexOf("trident/")>-1,webkit:a.indexOf(" applewebkit/")>-1,air:a.indexOf(" adobeair/")>-1,mac:a.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"&&(!document.documentMode||document.documentMode<10),mobile:a.indexOf("mobile")>-1,iOS:/(ipad|iphone|ipod)/.test(a),isCustomDomain:function(){if(!this.ie)return false;var a=document.domain,d=window.location.hostname;return a!=d&&a!="["+d+"]"},secure:location.protocol=="https:"};e.gecko=navigator.product=="Gecko"&&!e.webkit&&!e.ie;if(e.webkit)a.indexOf("chrome")>-1?e.chrome=true:e.safari=true;var b=0;if(e.ie){b=e.quirks||!document.documentMode?parseFloat(a.match(/msie (\d+)/)[1]):document.documentMode;e.ie9Compat=b==9;e.ie8Compat=b==8;e.ie7Compat=b==7;e.ie6Compat=b<7||e.quirks}if(e.gecko){var c=a.match(/rv:([\d\.]+)/);if(c){c=c[1].split(".");b=c[0]*1E4+(c[1]||0)*100+(c[2]||0)*1}}e.air&&(b=parseFloat(a.match(/ adobeair\/(\d+)/)[1]));e.webkit&&(b=parseFloat(a.match(/ applewebkit\/(\d+)/)[1]));e.version=b;e.isCompatible=e.iOS&&b>=534||!e.mobile&&(e.ie&&b>6||e.gecko&&b>=2E4||e.air&&b>=1||e.webkit&&b>=522||false);e.hidpi=window.devicePixelRatio>=2;e.needsBrFiller=e.gecko||e.webkit||e.ie&&b>10;e.needsNbspFiller=e.ie&&b<11;e.cssClass="cke_browser_"+(e.ie?"ie":e.gecko?"gecko":e.webkit?"webkit":"unknown");if(e.quirks)e.cssClass=e.cssClass+" cke_browser_quirks";if(e.ie)e.cssClass=e.cssClass+(" cke_browser_ie"+(e.quirks?"6 cke_browser_iequirks":e.version));if(e.air)e.cssClass=e.cssClass+" cke_browser_air";if(e.iOS)e.cssClass=e.cssClass+" cke_browser_ios";if(e.hidpi)e.cssClass=e.cssClass+" cke_hidpi";return e}());"unloaded"==CKEDITOR.status&&function(){CKEDITOR.event.implementOn(CKEDITOR);CKEDITOR.loadFullCore=function(){if(CKEDITOR.status!="basic_ready")CKEDITOR.loadFullCore._load=1;else{delete CKEDITOR.loadFullCore;var a=document.createElement("script");a.type="text/javascript";a.src=CKEDITOR.basePath+"ckeditor.js";document.getElementsByTagName("head")[0].appendChild(a)}};CKEDITOR.loadFullCoreTimeout=0;CKEDITOR.add=function(a){(this._.pending||(this._.pending=[])).push(a)};(function(){CKEDITOR.domReady(function(){var a=CKEDITOR.loadFullCore,e=CKEDITOR.loadFullCoreTimeout;if(a){CKEDITOR.status="basic_ready";a&&a._load?a():e&&setTimeout(function(){CKEDITOR.loadFullCore&&CKEDITOR.loadFullCore()},e*1E3)}})})();CKEDITOR.status="basic_loaded"}();CKEDITOR.dom={};(function(){var a=[],e=CKEDITOR.env.gecko?"-moz-":CKEDITOR.env.webkit?"-webkit-":CKEDITOR.env.ie?"-ms-":"",b=/&/g,c=/>/g,f=/</g,d=/"/g,h=/&amp;/g,l=/&gt;/g,i=/&lt;/g,g=/&quot;/g;CKEDITOR.on("reset",function(){a=[]});CKEDITOR.tools={arrayCompare:function(a,f){if(!a&&!f)return true;if(!a||!f||a.length!=f.length)return false;for(var d=0;d<a.length;d++)if(a[d]!=f[d])return false;return true},clone:function(a){var f;if(a&&a instanceof Array){f=[];for(var d=0;d<a.length;d++)f[d]=CKEDITOR.tools.clone(a[d]);return f}if(a===null||typeof a!="object"||a instanceof String||a instanceof Number||a instanceof Boolean||a instanceof Date||a instanceof RegExp||a.nodeType||a.window===a)return a;f=new a.constructor;for(d in a)f[d]=CKEDITOR.tools.clone(a[d]);return f},capitalize:function(a,f){return a.charAt(0).toUpperCase()+(f?a.slice(1):a.slice(1).toLowerCase())},extend:function(a){var f=arguments.length,d,b;if(typeof(d=arguments[f-1])=="boolean")f--;else if(typeof(d=arguments[f-2])=="boolean"){b=arguments[f-1];f=f-2}for(var c=1;c<f;c++){var e=arguments[c],j;for(j in e)if(d===true||a[j]==null)if(!b||j in b)a[j]=e[j]}return a},prototypedCopy:function(a){var f=function(){};f.prototype=a;return new f},copy:function(a){var f={},d;for(d in a)f[d]=a[d];return f},isArray:function(a){return Object.prototype.toString.call(a)=="[object Array]"},isEmpty:function(a){for(var f in a)if(a.hasOwnProperty(f))return false;return true},cssVendorPrefix:function(a,f,d){if(d)return e+a+":"+f+";"+a+":"+f;d={};d[a]=f;d[e+a]=f;return d},cssStyleToDomStyle:function(){var a=document.createElement("div").style,f=typeof a.cssFloat!="undefined"?"cssFloat":typeof a.styleFloat!="undefined"?"styleFloat":"float";return function(a){return a=="float"?f:a.replace(/-./g,function(a){return a.substr(1).toUpperCase()})}}(),buildStyleHtml:function(a){for(var a=[].concat(a),f,d=[],b=0;b<a.length;b++)if(f=a[b])/@import|[{}]/.test(f)?d.push("<style>"+f+"</style>"):d.push('<link type="text/css" rel=stylesheet href="'+f+'">');return d.join("")},htmlEncode:function(a){return(""+a).replace(b,"&amp;").replace(c,"&gt;").replace(f,"&lt;")},htmlDecode:function(a){return a.replace(h,"&").replace(l,">").replace(i,"<")},htmlEncodeAttr:function(a){return a.replace(d,"&quot;").replace(f,"&lt;").replace(c,"&gt;")},htmlDecodeAttr:function(a){return a.replace(g,'"').replace(i,"<").replace(l,">")},getNextNumber:function(){var a=0;return function(){return++a}}(),getNextId:function(){return"cke_"+this.getNextNumber()},override:function(a,f){var d=f(a);d.prototype=a.prototype;return d},setTimeout:function(a,f,d,b,c){c||(c=window);d||(d=c);return c.setTimeout(function(){b?a.apply(d,[].concat(b)):a.apply(d)},f||0)},trim:function(){var a=/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g;return function(f){return f.replace(a,"")}}(),ltrim:function(){var a=/^[ \t\n\r]+/g;return function(f){return f.replace(a,"")}}(),rtrim:function(){var a=/[ \t\n\r]+$/g;return function(f){return f.replace(a,"")}}(),indexOf:function(a,f){if(typeof f=="function")for(var d=0,b=a.length;d<b;d++){if(f(a[d]))return d}else{if(a.indexOf)return a.indexOf(f);d=0;for(b=a.length;d<b;d++)if(a[d]===f)return d}return-1},search:function(a,f){var d=CKEDITOR.tools.indexOf(a,f);return d>=0?a[d]:null},bind:function(a,f){return function(){return a.apply(f,arguments)}},createClass:function(a){var f=a.$,d=a.base,b=a.privates||a._,c=a.proto,a=a.statics;!f&&(f=function(){d&&this.base.apply(this,arguments)});if(b)var e=f,f=function(){var a=this._||(this._={}),f;for(f in b){var d=b[f];a[f]=typeof d=="function"?CKEDITOR.tools.bind(d,this):d}e.apply(this,arguments)};if(d){f.prototype=this.prototypedCopy(d.prototype);f.prototype.constructor=f;f.base=d;f.baseProto=d.prototype;f.prototype.base=function(){this.base=d.prototype.base;d.apply(this,arguments);this.base=arguments.callee}}c&&this.extend(f.prototype,c,true);a&&this.extend(f,a,true);return f},addFunction:function(f,d){return a.push(function(){return f.apply(d||this,arguments)})-1},removeFunction:function(f){a[f]=null},callFunction:function(f){var d=a[f];return d&&d.apply(window,Array.prototype.slice.call(arguments,1))},cssLength:function(){var a=/^-?\d+\.?\d*px$/,f;return function(d){f=CKEDITOR.tools.trim(d+"")+"px";return a.test(f)?f:d||""}}(),convertToPx:function(){var a;return function(f){if(!a){a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(a)}if(!/%$/.test(f)){a.setStyle("width",f);return a.$.clientWidth}return f}}(),repeat:function(a,f){return Array(f+1).join(a)},tryThese:function(){for(var a,f=0,d=arguments.length;f<d;f++){var b=arguments[f];try{a=b();break}catch(c){}}return a},genKey:function(){return Array.prototype.slice.call(arguments).join("-")},defer:function(a){return function(){var f=arguments,d=this;window.setTimeout(function(){a.apply(d,f)},0)}},normalizeCssText:function(a,f){var d=[],b,c=CKEDITOR.tools.parseCssText(a,true,f);for(b in c)d.push(b+":"+c[b]);d.sort();return d.length?d.join(";")+";":""},convertRgbToHex:function(a){return a.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(a,f,d,b){a=[f,d,b];for(f=0;f<3;f++)a[f]=("0"+parseInt(a[f],10).toString(16)).slice(-2);return"#"+a.join("")})},parseCssText:function(a,f,d){var b={};if(d){d=new CKEDITOR.dom.element("span");d.setAttribute("style",a);a=CKEDITOR.tools.convertRgbToHex(d.getAttribute("style")||"")}if(!a||a==";")return b;a.replace(/&quot;/g,'"').replace(/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,d,m){if(f){d=d.toLowerCase();d=="font-family"&&(m=m.toLowerCase().replace(/["']/g,"").replace(/\s*,\s*/g,","));m=CKEDITOR.tools.trim(m)}b[d]=m});return b},writeCssText:function(a,f){var d,b=[];for(d in a)b.push(d+":"+a[d]);f&&b.sort();return b.join("; ")},objectCompare:function(a,f,d){var b;if(!a&&!f)return true;if(!a||!f)return false;for(b in a)if(a[b]!=f[b])return false;if(!d)for(b in f)if(a[b]!=f[b])return false;return true},objectKeys:function(a){var f=[],d;for(d in a)f.push(d);return f},convertArrayToObject:function(a,f){var d={};arguments.length==1&&(f=true);for(var b=0,c=a.length;b<c;++b)d[a[b]]=f;return d},fixDomain:function(){for(var a;;)try{a=window.parent.document.domain;break}catch(f){a=a?a.replace(/.+?(?:\.|$)/,""):document.domain;if(!a)break;document.domain=a}return!!a},eventsBuffer:function(a,f){function d(){c=(new Date).getTime();b=false;f()}var b,c=0;return{input:function(){if(!b){var f=(new Date).getTime()-c;f<a?b=setTimeout(d,a-f):d()}},reset:function(){b&&clearTimeout(b);b=c=0}}},enableHtml5Elements:function(a,f){for(var d=["abbr","article","aside","audio","bdi","canvas","data","datalist","details","figcaption","figure","footer","header","hgroup","mark","meter","nav","output","progress","section","summary","time","video"],b=d.length,c;b--;){c=a.createElement(d[b]);f&&a.appendChild(c)}},checkIfAnyArrayItemMatches:function(a,f){for(var d=0,b=a.length;d<b;++d)if(a[d].match(f))return true;return false},checkIfAnyObjectPropertyMatches:function(a,f){for(var d in a)if(d.match(f))return true;return false},transparentImageData:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="}})();CKEDITOR.dtd=function(){var a=CKEDITOR.tools.extend,e=function(a,f){for(var d=CKEDITOR.tools.clone(a),b=1;b<arguments.length;b++){var f=arguments[b],c;for(c in f)delete d[c]}return d},b={},c={},f={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},d={command:1,link:1,meta:1,noscript:1,script:1,style:1},h={},l={"#":1},i={center:1,dir:1,noframes:1};a(b,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},l,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1});a(c,f,b,i);e={a:e(b,{a:1,button:1}),abbr:b,address:c,area:h,article:c,aside:c,audio:a({source:1,track:1},c),b:b,base:h,bdi:b,bdo:b,blockquote:c,body:c,br:h,button:e(b,{a:1,button:1}),canvas:b,caption:c,cite:b,code:b,col:h,colgroup:{col:1},command:h,datalist:a({option:1},b),dd:c,del:b,details:a({summary:1},c),dfn:b,div:c,dl:{dt:1,dd:1},dt:c,em:b,embed:h,fieldset:a({legend:1},c),figcaption:c,figure:a({figcaption:1},c),footer:c,form:c,h1:b,h2:b,h3:b,h4:b,h5:b,h6:b,head:a({title:1,base:1},d),header:c,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:h,html:a({head:1,body:1},c,d),i:b,iframe:l,img:h,input:h,ins:b,kbd:b,keygen:h,label:b,legend:b,li:c,link:h,main:c,map:c,mark:b,menu:a({li:1},c),meta:h,meter:e(b,{meter:1}),nav:c,noscript:a({link:1,meta:1,style:1},b),object:a({param:1},b),ol:{li:1},optgroup:{option:1},option:l,output:b,p:b,param:h,pre:b,progress:e(b,{progress:1}),q:b,rp:b,rt:b,ruby:a({rp:1,rt:1},b),s:b,samp:b,script:l,section:c,select:{optgroup:1,option:1},small:b,source:h,span:b,strong:b,style:l,sub:b,summary:b,sup:b,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:c,textarea:l,tfoot:{tr:1},th:c,thead:{tr:1},time:e(b,{time:1}),title:l,tr:{th:1,td:1},track:h,u:b,ul:{li:1},"var":b,video:a({source:1,track:1},c),wbr:h,acronym:b,applet:a({param:1},c),basefont:h,big:b,center:c,dialog:h,dir:{li:1},font:b,isindex:h,noframes:c,strike:b,tt:b};a(e,{$block:a({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},f,i),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,main:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,main:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:b,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:a({body:1,head:1,html:1},e.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}});return e}();CKEDITOR.dom.event=function(a){this.$=a};CKEDITOR.dom.event.prototype={getKey:function(){return this.$.keyCode||this.$.which},getKeystroke:function(){var a=this.getKey();if(this.$.ctrlKey||this.$.metaKey)a=a+CKEDITOR.CTRL;this.$.shiftKey&&(a=a+CKEDITOR.SHIFT);this.$.altKey&&(a=a+CKEDITOR.ALT);return a},preventDefault:function(a){var e=this.$;e.preventDefault?e.preventDefault():e.returnValue=false;a&&this.stopPropagation()},stopPropagation:function(){var a=this.$;a.stopPropagation?a.stopPropagation():a.cancelBubble=true},getTarget:function(){var a=this.$.target||this.$.srcElement;return a?new CKEDITOR.dom.node(a):null},getPhase:function(){return this.$.eventPhase||2},getPageOffset:function(){var a=this.getTarget().getDocument().$;return{x:this.$.pageX||this.$.clientX+(a.documentElement.scrollLeft||a.body.scrollLeft),y:this.$.pageY||this.$.clientY+(a.documentElement.scrollTop||a.body.scrollTop)}}};CKEDITOR.CTRL=1114112;CKEDITOR.SHIFT=2228224;CKEDITOR.ALT=4456448;CKEDITOR.EVENT_PHASE_CAPTURING=1;CKEDITOR.EVENT_PHASE_AT_TARGET=2;CKEDITOR.EVENT_PHASE_BUBBLING=3;CKEDITOR.dom.domObject=function(a){if(a)this.$=a};CKEDITOR.dom.domObject.prototype=function(){var a=function(a,b){return function(c){typeof CKEDITOR!="undefined"&&a.fire(b,new CKEDITOR.dom.event(c))}};return{getPrivate:function(){var a;if(!(a=this.getCustomData("_")))this.setCustomData("_",a={});return a},on:function(e){var b=this.getCustomData("_cke_nativeListeners");if(!b){b={};this.setCustomData("_cke_nativeListeners",b)}if(!b[e]){b=b[e]=a(this,e);this.$.addEventListener?this.$.addEventListener(e,b,!!CKEDITOR.event.useCapture):this.$.attachEvent&&this.$.attachEvent("on"+e,b)}return CKEDITOR.event.prototype.on.apply(this,arguments)},removeListener:function(a){CKEDITOR.event.prototype.removeListener.apply(this,arguments);if(!this.hasListeners(a)){var b=this.getCustomData("_cke_nativeListeners"),c=b&&b[a];if(c){this.$.removeEventListener?this.$.removeEventListener(a,c,false):this.$.detachEvent&&this.$.detachEvent("on"+a,c);delete b[a]}}},removeAllListeners:function(){var a=this.getCustomData("_cke_nativeListeners"),b;for(b in a){var c=a[b];this.$.detachEvent?this.$.detachEvent("on"+b,c):this.$.removeEventListener&&this.$.removeEventListener(b,c,false);delete a[b]}CKEDITOR.event.prototype.removeAllListeners.call(this)}}}();(function(a){var e={};CKEDITOR.on("reset",function(){e={}});a.equals=function(a){try{return a&&a.$===this.$}catch(c){return false}};a.setCustomData=function(a,c){var f=this.getUniqueId();(e[f]||(e[f]={}))[a]=c;return this};a.getCustomData=function(a){var c=this.$["data-cke-expando"];return(c=c&&e[c])&&a in c?c[a]:null};a.removeCustomData=function(a){var c=this.$["data-cke-expando"],c=c&&e[c],f,d;if(c){f=c[a];d=a in c;delete c[a]}return d?f:null};a.clearCustomData=function(){this.removeAllListeners();var a=this.$["data-cke-expando"];a&&delete e[a]};a.getUniqueId=function(){return this.$["data-cke-expando"]||(this.$["data-cke-expando"]=CKEDITOR.tools.getNextNumber())};CKEDITOR.event.implementOn(a)})(CKEDITOR.dom.domObject.prototype);CKEDITOR.dom.node=function(a){return a?new CKEDITOR.dom[a.nodeType==CKEDITOR.NODE_DOCUMENT?"document":a.nodeType==CKEDITOR.NODE_ELEMENT?"element":a.nodeType==CKEDITOR.NODE_TEXT?"text":a.nodeType==CKEDITOR.NODE_COMMENT?"comment":a.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT?"documentFragment":"domObject"](a):this};CKEDITOR.dom.node.prototype=new CKEDITOR.dom.domObject;CKEDITOR.NODE_ELEMENT=1;CKEDITOR.NODE_DOCUMENT=9;CKEDITOR.NODE_TEXT=3;CKEDITOR.NODE_COMMENT=8;CKEDITOR.NODE_DOCUMENT_FRAGMENT=11;CKEDITOR.POSITION_IDENTICAL=0;CKEDITOR.POSITION_DISCONNECTED=1;CKEDITOR.POSITION_FOLLOWING=2;CKEDITOR.POSITION_PRECEDING=4;CKEDITOR.POSITION_IS_CONTAINED=8;CKEDITOR.POSITION_CONTAINS=16;CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{appendTo:function(a,e){a.append(this,e);return a},clone:function(a,e){var b=this.$.cloneNode(a),c=function(f){f["data-cke-expando"]&&(f["data-cke-expando"]=false);if(f.nodeType==CKEDITOR.NODE_ELEMENT){e||f.removeAttribute("id",false);if(a)for(var f=f.childNodes,d=0;d<f.length;d++)c(f[d])}};c(b);return new CKEDITOR.dom.node(b)},hasPrevious:function(){return!!this.$.previousSibling},hasNext:function(){return!!this.$.nextSibling},insertAfter:function(a){a.$.parentNode.insertBefore(this.$,a.$.nextSibling);return a},insertBefore:function(a){a.$.parentNode.insertBefore(this.$,a.$);return a},insertBeforeMe:function(a){this.$.parentNode.insertBefore(a.$,this.$);return a},getAddress:function(a){for(var e=[],b=this.getDocument().$.documentElement,c=this.$;c&&c!=b;){var f=c.parentNode;f&&e.unshift(this.getIndex.call({$:c},a));c=f}return e},getDocument:function(){return new CKEDITOR.dom.document(this.$.ownerDocument||this.$.parentNode.ownerDocument)},getIndex:function(a){function e(a,f){var b=f?a.nextSibling:a.previousSibling;return!b||b.nodeType!=CKEDITOR.NODE_TEXT?null:b.nodeValue?b:e(b,f)}var b=this.$,c=-1,f;if(!this.$.parentNode||a&&b.nodeType==CKEDITOR.NODE_TEXT&&!b.nodeValue&&!e(b)&&!e(b,true))return-1;do if(!a||!(b!=this.$&&b.nodeType==CKEDITOR.NODE_TEXT&&(f||!b.nodeValue))){c++;f=b.nodeType==CKEDITOR.NODE_TEXT}while(b=b.previousSibling);return c},getNextSourceNode:function(a,e,b){if(b&&!b.call)var c=b,b=function(a){return!a.equals(c)};var a=!a&&this.getFirst&&this.getFirst(),f;if(!a){if(this.type==CKEDITOR.NODE_ELEMENT&&b&&b(this,true)===false)return null;a=this.getNext()}for(;!a&&(f=(f||this).getParent());){if(b&&b(f,true)===false)return null;a=f.getNext()}return!a||b&&b(a)===false?null:e&&e!=a.type?a.getNextSourceNode(false,e,b):a},getPreviousSourceNode:function(a,e,b){if(b&&!b.call)var c=b,b=function(a){return!a.equals(c)};var a=!a&&this.getLast&&this.getLast(),f;if(!a){if(this.type==CKEDITOR.NODE_ELEMENT&&b&&b(this,true)===false)return null;a=this.getPrevious()}for(;!a&&(f=(f||this).getParent());){if(b&&b(f,true)===false)return null;a=f.getPrevious()}return!a||b&&b(a)===false?null:e&&a.type!=e?a.getPreviousSourceNode(false,e,b):a},getPrevious:function(a){var e=this.$,b;do b=(e=e.previousSibling)&&e.nodeType!=10&&new CKEDITOR.dom.node(e);while(b&&a&&!a(b));return b},getNext:function(a){var e=this.$,b;do b=(e=e.nextSibling)&&new CKEDITOR.dom.node(e);while(b&&a&&!a(b));return b},getParent:function(a){var e=this.$.parentNode;return e&&(e.nodeType==CKEDITOR.NODE_ELEMENT||a&&e.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)?new CKEDITOR.dom.node(e):null},getParents:function(a){var e=this,b=[];do b[a?"push":"unshift"](e);while(e=e.getParent());return b},getCommonAncestor:function(a){if(a.equals(this))return this;if(a.contains&&a.contains(this))return a;var e=this.contains?this:this.getParent();do if(e.contains(a))return e;while(e=e.getParent());return null},getPosition:function(a){var e=this.$,b=a.$;if(e.compareDocumentPosition)return e.compareDocumentPosition(b);if(e==b)return CKEDITOR.POSITION_IDENTICAL;if(this.type==CKEDITOR.NODE_ELEMENT&&a.type==CKEDITOR.NODE_ELEMENT){if(e.contains){if(e.contains(b))return CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING;if(b.contains(e))return CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING}if("sourceIndex"in e)return e.sourceIndex<0||b.sourceIndex<0?CKEDITOR.POSITION_DISCONNECTED:e.sourceIndex<b.sourceIndex?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING}for(var e=this.getAddress(),a=a.getAddress(),b=Math.min(e.length,a.length),c=0;c<=b-1;c++)if(e[c]!=a[c]){if(c<b)return e[c]<a[c]?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING;break}return e.length<a.length?CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING},getAscendant:function(a,e){var b=this.$,c,f;if(!e)b=b.parentNode;if(typeof a=="function"){f=true;c=a}else{f=false;c=function(f){f=typeof f.nodeName=="string"?f.nodeName.toLowerCase():"";return typeof a=="string"?f==a:f in a}}for(;b;){if(c(f?new CKEDITOR.dom.node(b):b))return new CKEDITOR.dom.node(b);try{b=b.parentNode}catch(d){b=null}}return null},hasAscendant:function(a,e){var b=this.$;if(!e)b=b.parentNode;for(;b;){if(b.nodeName&&b.nodeName.toLowerCase()==a)return true;b=b.parentNode}return false},move:function(a,e){a.append(this.remove(),e)},remove:function(a){var e=this.$,b=e.parentNode;if(b){if(a)for(;a=e.firstChild;)b.insertBefore(e.removeChild(a),e);b.removeChild(e)}return this},replace:function(a){this.insertBefore(a);a.remove()},trim:function(){this.ltrim();this.rtrim()},ltrim:function(){for(var a;this.getFirst&&(a=this.getFirst());){if(a.type==CKEDITOR.NODE_TEXT){var e=CKEDITOR.tools.ltrim(a.getText()),b=a.getLength();if(e){if(e.length<b){a.split(b-e.length);this.$.removeChild(this.$.firstChild)}}else{a.remove();continue}}break}},rtrim:function(){for(var a;this.getLast&&(a=this.getLast());){if(a.type==CKEDITOR.NODE_TEXT){var e=CKEDITOR.tools.rtrim(a.getText()),b=a.getLength();if(e){if(e.length<b){a.split(e.length);this.$.lastChild.parentNode.removeChild(this.$.lastChild)}}else{a.remove();continue}}break}if(CKEDITOR.env.needsBrFiller)(a=this.$.lastChild)&&(a.type==1&&a.nodeName.toLowerCase()=="br")&&a.parentNode.removeChild(a)},isReadOnly:function(){var a=this;this.type!=CKEDITOR.NODE_ELEMENT&&(a=this.getParent());if(a&&typeof a.$.isContentEditable!="undefined")return!(a.$.isContentEditable||a.data("cke-editable"));for(;a;){if(a.data("cke-editable"))break;if(a.getAttribute("contentEditable")=="false")return true;if(a.getAttribute("contentEditable")=="true")break;a=a.getParent()}return!a}});CKEDITOR.dom.window=function(a){CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.window.prototype=new CKEDITOR.dom.domObject;CKEDITOR.tools.extend(CKEDITOR.dom.window.prototype,{focus:function(){this.$.focus()},getViewPaneSize:function(){var a=this.$.document,e=a.compatMode=="CSS1Compat";return{width:(e?a.documentElement.clientWidth:a.body.clientWidth)||0,height:(e?a.documentElement.clientHeight:a.body.clientHeight)||0}},getScrollPosition:function(){var a=this.$;if("pageXOffset"in a)return{x:a.pageXOffset||0,y:a.pageYOffset||0};a=a.document;return{x:a.documentElement.scrollLeft||a.body.scrollLeft||0,y:a.documentElement.scrollTop||a.body.scrollTop||0}},getFrame:function(){var a=this.$.frameElement;return a?new CKEDITOR.dom.element.get(a):null}});CKEDITOR.dom.document=function(a){CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.document.prototype=new CKEDITOR.dom.domObject;CKEDITOR.tools.extend(CKEDITOR.dom.document.prototype,{type:CKEDITOR.NODE_DOCUMENT,appendStyleSheet:function(a){if(this.$.createStyleSheet)this.$.createStyleSheet(a);else{var e=new CKEDITOR.dom.element("link");e.setAttributes({rel:"stylesheet",type:"text/css",href:a});this.getHead().append(e)}},appendStyleText:function(a){if(this.$.createStyleSheet){var e=this.$.createStyleSheet("");e.cssText=a}else{var b=new CKEDITOR.dom.element("style",this);b.append(new CKEDITOR.dom.text(a,this));this.getHead().append(b)}return e||b.$.sheet},createElement:function(a,e){var b=new CKEDITOR.dom.element(a,this);if(e){e.attributes&&b.setAttributes(e.attributes);e.styles&&b.setStyles(e.styles)}return b},createText:function(a){return new CKEDITOR.dom.text(a,this)},focus:function(){this.getWindow().focus()},getActive:function(){var a;try{a=this.$.activeElement}catch(e){return null}return new CKEDITOR.dom.element(a)},getById:function(a){return(a=this.$.getElementById(a))?new CKEDITOR.dom.element(a):null},getByAddress:function(a,e){for(var b=this.$.documentElement,c=0;b&&c<a.length;c++){var f=a[c];if(e)for(var d=-1,h=0;h<b.childNodes.length;h++){var l=b.childNodes[h];if(!(e===true&&l.nodeType==3&&l.previousSibling&&l.previousSibling.nodeType==3)){d++;if(d==f){b=l;break}}}else b=b.childNodes[f]}return b?new CKEDITOR.dom.node(b):null},getElementsByTag:function(a,e){!(CKEDITOR.env.ie&&document.documentMode<=8)&&e&&(a=e+":"+a);return new CKEDITOR.dom.nodeList(this.$.getElementsByTagName(a))},getHead:function(){var a=this.$.getElementsByTagName("head")[0];return a=a?new CKEDITOR.dom.element(a):this.getDocumentElement().append(new CKEDITOR.dom.element("head"),true)},getBody:function(){return new CKEDITOR.dom.element(this.$.body)},getDocumentElement:function(){return new CKEDITOR.dom.element(this.$.documentElement)},getWindow:function(){return new CKEDITOR.dom.window(this.$.parentWindow||this.$.defaultView)},write:function(a){this.$.open("text/html","replace");CKEDITOR.env.ie&&(a=a.replace(/(?:^\s*<!DOCTYPE[^>]*?>)|^/i,'$&\n<script data-cke-temp="1">('+
CKEDITOR.tools.fixDomain+")();<\/script>"));this.$.write(a);this.$.close()},find:function(a){return new CKEDITOR.dom.nodeList(this.$.querySelectorAll(a))},findOne:function(a){return(a=this.$.querySelector(a))?new CKEDITOR.dom.element(a):null},_getHtml5ShivFrag:function(){var a=this.getCustomData("html5ShivFrag");if(!a){a=this.$.createDocumentFragment();CKEDITOR.tools.enableHtml5Elements(a,true);this.setCustomData("html5ShivFrag",a)}return a}});CKEDITOR.dom.nodeList=function(a){this.$=a};CKEDITOR.dom.nodeList.prototype={count:function(){return this.$.length},getItem:function(a){if(a<0||a>=this.$.length)return null;return(a=this.$[a])?new CKEDITOR.dom.node(a):null}};CKEDITOR.dom.element=function(a,e){typeof a=="string"&&(a=(e?e.$:document).createElement(a));CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.element.get=function(a){return(a=typeof a=="string"?document.getElementById(a)||document.getElementsByName(a)[0]:a)&&(a.$?a:new CKEDITOR.dom.element(a))};CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node;CKEDITOR.dom.element.createFromHtml=function(a,e){var b=new CKEDITOR.dom.element("div",e);b.setHtml(a);return b.getFirst().remove()};CKEDITOR.dom.element.setMarker=function(a,e,b,c){var f=e.getCustomData("list_marker_id")||e.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),d=e.getCustomData("list_marker_names")||e.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");a[f]=e;d[b]=1;return e.setCustomData(b,c)};CKEDITOR.dom.element.clearAllMarkers=function(a){for(var e in a)CKEDITOR.dom.element.clearMarkers(a,a[e],1)};CKEDITOR.dom.element.clearMarkers=function(a,e,b){var c=e.getCustomData("list_marker_names"),f=e.getCustomData("list_marker_id"),d;for(d in c)e.removeCustomData(d);e.removeCustomData("list_marker_names");if(b){e.removeCustomData("list_marker_id");delete a[f]}};(function(){function a(a){var d=true;if(!a.$.id){a.$.id="cke_tmp_"+CKEDITOR.tools.getNextNumber();d=false}return function(){d||a.removeAttribute("id")}}function e(a,d){return"#"+a.$.id+" "+d.split(/,\s*/).join(", #"+a.$.id+" ")}function b(a){for(var d=0,b=0,e=c[a].length;b<e;b++)d=d+(parseInt(this.getComputedStyle(c[a][b])||0,10)||0);return d}CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:function(a){var d=this.$.className;d&&(RegExp("(?:^|\\s)"+a+"(?:\\s|$)","").test(d)||(d=d+(" "+a)));this.$.className=d||a;return this},removeClass:function(a){var d=this.getAttribute("class");if(d){a=RegExp("(?:^|\\s+)"+a+"(?=\\s|$)","i");if(a.test(d))(d=d.replace(a,"").replace(/^\s+/,""))?this.setAttribute("class",d):this.removeAttribute("class")}return this},hasClass:function(a){return RegExp("(?:^|\\s+)"+a+"(?=\\s|$)","").test(this.getAttribute("class"))},append:function(a,d){typeof a=="string"&&(a=this.getDocument().createElement(a));d?this.$.insertBefore(a.$,this.$.firstChild):this.$.appendChild(a.$);return a},appendHtml:function(a){if(this.$.childNodes.length){var d=new CKEDITOR.dom.element("div",this.getDocument());d.setHtml(a);d.moveChildren(this)}else this.setHtml(a)},appendText:function(a){this.$.text!=null?this.$.text=this.$.text+a:this.append(new CKEDITOR.dom.text(a))},appendBogus:function(a){if(a||CKEDITOR.env.needsBrFiller){for(a=this.getLast();a&&a.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(a.getText());)a=a.getPrevious();if(!a||!a.is||!a.is("br")){a=this.getDocument().createElement("br");CKEDITOR.env.gecko&&a.setAttribute("type","_moz");this.append(a)}}},breakParent:function(a){var d=new CKEDITOR.dom.range(this.getDocument());d.setStartAfter(this);d.setEndAfter(a);a=d.extractContents();d.insertNode(this.remove());a.insertAfterNode(this)},contains:CKEDITOR.env.ie||CKEDITOR.env.webkit?function(a){var d=this.$;return a.type!=CKEDITOR.NODE_ELEMENT?d.contains(a.getParent().$):d!=a.$&&d.contains(a.$)}:function(a){return!!(this.$.compareDocumentPosition(a.$)&16)},focus:function(){function a(){try{this.$.focus()}catch(f){}}
return function(d){d?CKEDITOR.tools.setTimeout(a,100,this):a.call(this)}}(),getHtml:function(){var a=this.$.innerHTML;return CKEDITOR.env.ie?a.replace(/<\?[^>]*>/g,""):a},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var a=this.$.ownerDocument.createElement("div");a.appendChild(this.$.cloneNode(true));return a.innerHTML},getClientRect:function(){var a=CKEDITOR.tools.extend({},this.$.getBoundingClientRect());!a.width&&(a.width=a.right-a.left);!a.height&&(a.height=a.bottom-a.top);return a},setHtml:CKEDITOR.env.ie&&CKEDITOR.env.version<9?function(a){try{var d=this.$;if(this.getParent())return d.innerHTML=a;var b=this.getDocument()._getHtml5ShivFrag();b.appendChild(d);d.innerHTML=a;b.removeChild(d);return a}catch(c){this.$.innerHTML="";d=new CKEDITOR.dom.element("body",this.getDocument());d.$.innerHTML=a;for(d=d.getChildren();d.count();)this.append(d.getItem(0));return a}}:function(a){return this.$.innerHTML=a},setText:function(){var a=document.createElement("p");a.innerHTML="x";a=a.textContent;return function(d){this.$[a?"textContent":"innerText"]=d}}(),getAttribute:function(){var a=function(a){return this.$.getAttribute(a,2)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(a){switch(a){case"class":a="className";break;case"http-equiv":a="httpEquiv";break;case"name":return this.$.name;case"tabindex":a=this.$.getAttribute(a,2);a!==0&&this.$.tabIndex===0&&(a=null);return a;case"checked":a=this.$.attributes.getNamedItem(a);return(a.specified?a.nodeValue:this.$.checked)?"checked":null;case"hspace":case"value":return this.$[a];case"style":return this.$.style.cssText;case"contenteditable":case"contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return this.$.getAttribute(a,2)}:a}(),getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getComputedStyle:CKEDITOR.env.ie?function(a){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(a)]}:function(a){var d=this.getWindow().$.getComputedStyle(this.$,null);return d?d.getPropertyValue(a):""},getDtd:function(){var a=CKEDITOR.dtd[this.getName()];this.getDtd=function(){return a};return a},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:CKEDITOR.env.ie?function(){var a=this.$.tabIndex;a===0&&(!CKEDITOR.dtd.$tabIndex[this.getName()]&&parseInt(this.getAttribute("tabindex"),10)!==0)&&(a=-1);return a}:CKEDITOR.env.webkit?function(){var a=this.$.tabIndex;if(a===void 0){a=parseInt(this.getAttribute("tabindex"),10);isNaN(a)&&(a=-1)}return a}:function(){return this.$.tabIndex},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var a=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&document.documentMode<=8){var d=this.$.scopeName;d!="HTML"&&(a=d.toLowerCase()+":"+a)}this.getName=function(){return a};return this.getName()},getValue:function(){return this.$.value},getFirst:function(a){var d=this.$.firstChild;(d=d&&new CKEDITOR.dom.node(d))&&(a&&!a(d))&&(d=d.getNext(a));return d},getLast:function(a){var d=this.$.lastChild;(d=d&&new CKEDITOR.dom.node(d))&&(a&&!a(d))&&(d=d.getPrevious(a));return d},getStyle:function(a){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(a)]},is:function(){var a=this.getName();if(typeof arguments[0]=="object")return!!arguments[0][a];for(var d=0;d<arguments.length;d++)if(arguments[d]==a)return true;return false},isEditable:function(a){var d=this.getName();if(this.isReadOnly()||this.getComputedStyle("display")=="none"||this.getComputedStyle("visibility")=="hidden"||CKEDITOR.dtd.$nonEditable[d]||CKEDITOR.dtd.$empty[d]||this.is("a")&&(this.data("cke-saved-name")||this.hasAttribute("name"))&&!this.getChildCount())return false;if(a!==false){a=CKEDITOR.dtd[d]||CKEDITOR.dtd.span;return!(!a||!a["#"])}return true},isIdentical:function(a){var d=this.clone(0,1),a=a.clone(0,1);d.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]);a.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]);if(d.$.isEqualNode){d.$.style.cssText=CKEDITOR.tools.normalizeCssText(d.$.style.cssText);a.$.style.cssText=CKEDITOR.tools.normalizeCssText(a.$.style.cssText);return d.$.isEqualNode(a.$)}d=d.getOuterHtml();a=a.getOuterHtml();if(CKEDITOR.env.ie&&CKEDITOR.env.version<9&&this.is("a")){var b=this.getParent();if(b.type==CKEDITOR.NODE_ELEMENT){b=b.clone();b.setHtml(d);d=b.getHtml();b.setHtml(a);a=b.getHtml()}}return d==a},isVisible:function(){var a=(this.$.offsetHeight||this.$.offsetWidth)&&this.getComputedStyle("visibility")!="hidden",d,b;if(a&&CKEDITOR.env.webkit){d=this.getWindow();if(!d.equals(CKEDITOR.document.getWindow())&&(b=d.$.frameElement))a=(new CKEDITOR.dom.element(b)).isVisible()}return!!a},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return false;for(var a=this.getChildren(),d=0,b=a.count();d<b;d++){var c=a.getItem(d);if(!(c.type==CKEDITOR.NODE_ELEMENT&&c.data("cke-bookmark"))&&(c.type==CKEDITOR.NODE_ELEMENT&&!c.isEmptyInlineRemoveable()||c.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(c.getText())))return false}return true},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(){for(var a=this.$.attributes,d=0;d<a.length;d++){var b=a[d];switch(b.nodeName){case"class":if(this.getAttribute("class"))return true;case"data-cke-expando":continue;default:if(b.specified)return true}}return false}:function(){var a=this.$.attributes,d=a.length,b={"data-cke-expando":1,_moz_dirty:1};return d>0&&(d>2||!b[a[0].nodeName]||d==2&&!b[a[1].nodeName])},hasAttribute:function(){function a(d){var f=this.$.attributes.getNamedItem(d);if(this.getName()=="input")switch(d){case"class":return this.$.className.length>0;case"checked":return!!this.$.checked;case"value":d=this.getAttribute("type");return d=="checkbox"||d=="radio"?this.$.value!="on":!!this.$.value}return!f?false:f.specified}return CKEDITOR.env.ie?CKEDITOR.env.version<8?function(d){return d=="name"?!!this.$.name:a.call(this,d)}:a:function(a){return!!this.$.attributes.getNamedItem(a)}}(),hide:function(){this.setStyle("display","none")},moveChildren:function(a,d){var b=this.$,a=a.$;if(b!=a){var c;if(d)for(;c=b.lastChild;)a.insertBefore(b.removeChild(c),a.firstChild);else for(;c=b.firstChild;)a.appendChild(b.removeChild(c))}},mergeSiblings:function(){function a(d,b,f){if(b&&b.type==CKEDITOR.NODE_ELEMENT){for(var c=[];b.data("cke-bookmark")||b.isEmptyInlineRemoveable();){c.push(b);b=f?b.getNext():b.getPrevious();if(!b||b.type!=CKEDITOR.NODE_ELEMENT)return}if(d.isIdentical(b)){for(var e=f?d.getLast():d.getFirst();c.length;)c.shift().move(d,!f);b.moveChildren(d,!f);b.remove();e&&e.type==CKEDITOR.NODE_ELEMENT&&e.mergeSiblings()}}}return function(d){if(d===false||CKEDITOR.dtd.$removeEmpty[this.getName()]||this.is("a")){a(this,this.getNext(),true);a(this,this.getPrevious())}}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var a=function(a,b){this.$.setAttribute(a,b);return this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(d,b){d=="class"?this.$.className=b:d=="style"?this.$.style.cssText=b:d=="tabindex"?this.$.tabIndex=b:d=="checked"?this.$.checked=b:d=="contenteditable"?a.call(this,"contentEditable",b):a.apply(this,arguments);return this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(d,b){if(d=="src"&&b.match(/^http:\/\//))try{a.apply(this,arguments)}catch(c){}else a.apply(this,arguments);return this}:a}(),setAttributes:function(a){for(var d in a)this.setAttribute(d,a[d]);return this},setValue:function(a){this.$.value=a;return this},removeAttribute:function(){var a=function(a){this.$.removeAttribute(a)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(a){a=="class"?a="className":a=="tabindex"?a="tabIndex":a=="contenteditable"&&(a="contentEditable");this.$.removeAttribute(a)}:a}(),removeAttributes:function(a){if(CKEDITOR.tools.isArray(a))for(var b=0;b<a.length;b++)this.removeAttribute(a[b]);else for(b in a)a.hasOwnProperty(b)&&this.removeAttribute(b)},removeStyle:function(a){var b=this.$.style;if(!b.removeProperty&&(a=="border"||a=="margin"||a=="padding")){var c=["top","left","right","bottom"],e;a=="border"&&(e=["color","style","width"]);for(var b=[],i=0;i<c.length;i++)if(e)for(var g=0;g<e.length;g++)b.push([a,c[i],e[g]].join("-"));else b.push([a,c[i]].join("-"));for(a=0;a<b.length;a++)this.removeStyle(b[a])}else{b.removeProperty?b.removeProperty(a):b.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(a));this.$.style.cssText||this.removeAttribute("style")}},setStyle:function(a,b){this.$.style[CKEDITOR.tools.cssStyleToDomStyle(a)]=b;return this},setStyles:function(a){for(var b in a)this.setStyle(b,a[b]);return this},setOpacity:function(a){if(CKEDITOR.env.ie&&CKEDITOR.env.version<9){a=Math.round(a*100);this.setStyle("filter",a>=100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+a+")")}else this.setStyle("opacity",a)},unselectable:function(){this.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","none"));if(CKEDITOR.env.ie){this.setAttribute("unselectable","on");for(var a,b=this.getElementsByTag("*"),c=0,e=b.count();c<e;c++){a=b.getItem(c);a.setAttribute("unselectable","on")}}},getPositionedAncestor:function(){for(var a=this;a.getName()!="html";){if(a.getComputedStyle("position")!="static")return a;a=a.getParent()}return null},getDocumentPosition:function(a){var b=0,c=0,e=this.getDocument(),i=e.getBody(),g=e.$.compatMode=="BackCompat";if(document.documentElement.getBoundingClientRect){var m=this.$.getBoundingClientRect(),t=e.$.documentElement,s=t.clientTop||i.$.clientTop||0,y=t.clientLeft||i.$.clientLeft||0,p=true;if(CKEDITOR.env.ie){p=e.getDocumentElement().contains(this);e=e.getBody().contains(this);p=g&&e||!g&&p}if(p){b=m.left+(!g&&t.scrollLeft||i.$.scrollLeft);b=b-y;c=m.top+(!g&&t.scrollTop||i.$.scrollTop);c=c-s}}else{i=this;for(e=null;i&&!(i.getName()=="body"||i.getName()=="html");){b=b+(i.$.offsetLeft-i.$.scrollLeft);c=c+(i.$.offsetTop-i.$.scrollTop);if(!i.equals(this)){b=b+(i.$.clientLeft||0);c=c+(i.$.clientTop||0)}for(;e&&!e.equals(i);){b=b-e.$.scrollLeft;c=c-e.$.scrollTop;e=e.getParent()}e=i;i=(m=i.$.offsetParent)?new CKEDITOR.dom.element(m):null}}if(a){i=this.getWindow();e=a.getWindow();if(!i.equals(e)&&i.$.frameElement){a=(new CKEDITOR.dom.element(i.$.frameElement)).getDocumentPosition(a);b=b+a.x;c=c+a.y}}if(!document.documentElement.getBoundingClientRect&&CKEDITOR.env.gecko&&!g){b=b+(this.$.clientLeft?1:0);c=c+(this.$.clientTop?1:0)}return{x:b,y:c}},scrollIntoView:function(a){var b=this.getParent();if(b){do{(b.$.clientWidth&&b.$.clientWidth<b.$.scrollWidth||b.$.clientHeight&&b.$.clientHeight<b.$.scrollHeight)&&!b.is("body")&&this.scrollIntoParent(b,a,1);if(b.is("html")){var c=b.getWindow();try{var e=c.$.frameElement;e&&(b=new CKEDITOR.dom.element(e))}catch(i){}}}while(b=b.getParent())}},scrollIntoParent:function(a,b,c){var e,i,g,m;function t(b,d){if(/body|html/.test(a.getName()))a.getWindow().$.scrollBy(b,d);else{a.$.scrollLeft=a.$.scrollLeft+b;a.$.scrollTop=a.$.scrollTop+d}}
function s(a,b){var d={x:0,y:0};if(!a.is(p?"body":"html")){var c=a.$.getBoundingClientRect();d.x=c.left;d.y=c.top}c=a.getWindow();if(!c.equals(b)){c=s(CKEDITOR.dom.element.get(c.$.frameElement),b);d.x=d.x+c.x;d.y=d.y+c.y}return d}function y(a,b){return parseInt(a.getComputedStyle("margin-"+b)||0,10)||0}!a&&(a=this.getWindow());g=a.getDocument();var p=g.$.compatMode=="BackCompat";a instanceof CKEDITOR.dom.window&&(a=p?g.getBody():g.getDocumentElement());g=a.getWindow();i=s(this,g);var q=s(a,g),j=this.$.offsetHeight;e=this.$.offsetWidth;var u=a.$.clientHeight,v=a.$.clientWidth;g=i.x-y(this,"left")-q.x||0;m=i.y-y(this,"top")-q.y||0;e=i.x+e+y(this,"right")-(q.x+v)||0;i=i.y+j+y(this,"bottom")-(q.y+u)||0;if(m<0||i>0)t(0,b===true?m:b===false?i:m<0?m:i);if(c&&(g<0||e>0))t(g<0?g:e,0)},setState:function(a,b,c){b=b||"cke";switch(a){case CKEDITOR.TRISTATE_ON:this.addClass(b+"_on");this.removeClass(b+"_off");this.removeClass(b+"_disabled");c&&this.setAttribute("aria-pressed",true);c&&this.removeAttribute("aria-disabled");break;case CKEDITOR.TRISTATE_DISABLED:this.addClass(b+"_disabled");this.removeClass(b+"_off");this.removeClass(b+"_on");c&&this.setAttribute("aria-disabled",true);c&&this.removeAttribute("aria-pressed");break;default:this.addClass(b+"_off");this.removeClass(b+"_on");this.removeClass(b+"_disabled");c&&this.removeAttribute("aria-pressed");c&&this.removeAttribute("aria-disabled")}},getFrameDocument:function(){var a=this.$;try{a.contentWindow.document}catch(b){a.src=a.src}return a&&new CKEDITOR.dom.document(a.contentWindow.document)},copyAttributes:function(a,b){for(var c=this.$.attributes,b=b||{},e=0;e<c.length;e++){var i=c[e],g=i.nodeName.toLowerCase(),m;if(!(g in b))if(g=="checked"&&(m=this.getAttribute(g)))a.setAttribute(g,m);else if(!CKEDITOR.env.ie||this.hasAttribute(g)){m=this.getAttribute(g);if(m===null)m=i.nodeValue;a.setAttribute(g,m)}}if(this.$.style.cssText!=="")a.$.style.cssText=this.$.style.cssText},renameNode:function(a){if(this.getName()!=a){var b=this.getDocument(),a=new CKEDITOR.dom.element(a,b);this.copyAttributes(a);this.moveChildren(a);this.getParent()&&this.$.parentNode.replaceChild(a.$,this.$);a.$["data-cke-expando"]=this.$["data-cke-expando"];this.$=a.$;delete this.getName}},getChild:function(){function a(b,c){var f=b.childNodes;if(c>=0&&c<f.length)return f[c]}return function(b){var c=this.$;if(b.slice)for(;b.length>0&&c;)c=a(c,b.shift());else c=a(c,b);return c?new CKEDITOR.dom.node(c):null}}(),getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){this.on("contextmenu",function(a){a.data.getTarget().hasClass("cke_enable_context_menu")||a.data.preventDefault()})},getDirection:function(a){return a?this.getComputedStyle("direction")||this.getDirection()||this.getParent()&&this.getParent().getDirection(1)||this.getDocument().$.dir||"ltr":this.getStyle("direction")||this.getAttribute("dir")},data:function(a,b){a="data-"+a;if(b===void 0)return this.getAttribute(a);b===false?this.removeAttribute(a):this.setAttribute(a,b);return null},getEditor:function(){var a=CKEDITOR.instances,b,c;for(b in a){c=a[b];if(c.element.equals(this)&&c.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO)return c}return null},find:function(b){var c=a(this),b=new CKEDITOR.dom.nodeList(this.$.querySelectorAll(e(this,b)));c();return b},findOne:function(b){var c=a(this),b=this.$.querySelector(e(this,b));c();return b?new CKEDITOR.dom.element(b):null},forEach:function(a,b,c){if(!c&&(!b||this.type==b))var e=a(this);if(e!==false)for(var c=this.getChildren(),i=0;i<c.count();i++){e=c.getItem(i);e.type==CKEDITOR.NODE_ELEMENT?e.forEach(a,b):(!b||e.type==b)&&a(e)}}});var c={width:["border-left-width","border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(a,c,e){if(typeof c=="number"){if(e&&(!CKEDITOR.env.ie||!CKEDITOR.env.quirks))c=c-b.call(this,a);this.setStyle(a,c+"px")}};CKEDITOR.dom.element.prototype.getSize=function(a,c){var e=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(a)],this.$["client"+CKEDITOR.tools.capitalize(a)])||0;c&&(e=e-b.call(this,a));return e}})();CKEDITOR.dom.documentFragment=function(a){a=a||CKEDITOR.document;this.$=a.type==CKEDITOR.NODE_DOCUMENT?a.$.createDocumentFragment():a};CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,insertAfterNode:function(a){a=a.$;a.parentNode.insertBefore(this.$,a.nextSibling)}},!0,{append:1,appendBogus:1,getFirst:1,getLast:1,getParent:1,getNext:1,getPrevious:1,appendTo:1,moveChildren:1,insertBefore:1,insertAfterNode:1,replace:1,trim:1,type:1,ltrim:1,rtrim:1,getDocument:1,getChildCount:1,getChild:1,getChildren:1});(function(){function a(a,b){var c=this.range;if(this._.end)return null;if(!this._.start){this._.start=1;if(c.collapsed){this.end();return null}c.optimize()}var d,f=c.startContainer;d=c.endContainer;var m=c.startOffset,e=c.endOffset,h,E=this.guard,k=this.type,n=a?"getPreviousSourceNode":"getNextSourceNode";if(!a&&!this._.guardLTR){var r=d.type==CKEDITOR.NODE_ELEMENT?d:d.getParent(),o=d.type==CKEDITOR.NODE_ELEMENT?d.getChild(e):d.getNext();this._.guardLTR=function(a,b){return(!b||!r.equals(a))&&(!o||!a.equals(o))&&(a.type!=CKEDITOR.NODE_ELEMENT||!b||!a.equals(c.root))}}if(a&&!this._.guardRTL){var g=f.type==CKEDITOR.NODE_ELEMENT?f:f.getParent(),D=f.type==CKEDITOR.NODE_ELEMENT?m?f.getChild(m-1):null:f.getPrevious();this._.guardRTL=function(a,b){return(!b||!g.equals(a))&&(!D||!a.equals(D))&&(a.type!=CKEDITOR.NODE_ELEMENT||!b||!a.equals(c.root))}}var i=a?this._.guardRTL:this._.guardLTR;h=E?function(a,b){return i(a,b)===false?false:E(a,b)}:i;if(this.current)d=this.current[n](false,k,h);else{if(a)d.type==CKEDITOR.NODE_ELEMENT&&(d=e>0?d.getChild(e-1):h(d,true)===false?null:d.getPreviousSourceNode(true,k,h));else{d=f;if(d.type==CKEDITOR.NODE_ELEMENT&&!(d=d.getChild(m)))d=h(f,true)===false?null:f.getNextSourceNode(true,k,h)}d&&h(d)===false&&(d=null)}for(;d&&!this._.end;){this.current=d;if(!this.evaluator||this.evaluator(d)!==false){if(!b)return d}else if(b&&this.evaluator)return false;d=d[n](false,k,h)}this.end();return this.current=null}function e(b){for(var c,d=null;c=a.call(this,b);)d=c;return d}
function b(a){if(g(a))return false;if(a.type==CKEDITOR.NODE_TEXT)return true;if(a.type==CKEDITOR.NODE_ELEMENT){if(a.is(CKEDITOR.dtd.$inline)||a.is("hr")||a.getAttribute("contenteditable")=="false")return true;var b;if(b=!CKEDITOR.env.needsBrFiller)if(b=a.is(m))a:{b=0;for(var c=a.getChildCount();b<c;++b)if(!g(a.getChild(b))){b=false;break a}b=true}if(b)return true}return false}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(a){this.range=a;this._={}},proto:{end:function(){this._.end=1},next:function(){return a.call(this)},previous:function(){return a.call(this,1)},checkForward:function(){return a.call(this,0,1)!==false},checkBackward:function(){return a.call(this,1,1)!==false},lastForward:function(){return e.call(this)},lastBackward:function(){return e.call(this,1)},reset:function(){delete this.current;this._={}}}});var c={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},f={absolute:1,fixed:1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(a){return this.getComputedStyle("float")=="none"&&!(this.getComputedStyle("position")in f)&&c[this.getComputedStyle("display")]?true:!!(this.is(CKEDITOR.dtd.$block)||a&&this.is(a))};CKEDITOR.dom.walker.blockBoundary=function(a){return function(b){return!(b.type==CKEDITOR.NODE_ELEMENT&&b.isBlockBoundary(a))}};CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})};CKEDITOR.dom.walker.bookmark=function(a,b){function c(a){return a&&a.getName&&a.getName()=="span"&&a.data("cke-bookmark")}return function(d){var f,m;f=d&&d.type!=CKEDITOR.NODE_ELEMENT&&(m=d.getParent())&&c(m);f=a?f:f||c(d);return!!(b^f)}};CKEDITOR.dom.walker.whitespaces=function(a){return function(b){var c;b&&b.type==CKEDITOR.NODE_TEXT&&(c=!CKEDITOR.tools.trim(b.getText())||CKEDITOR.env.webkit&&b.getText()=="​");return!!(a^c)}};CKEDITOR.dom.walker.invisible=function(a){var b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.env.webkit?1:0;return function(d){if(b(d))d=1;else{d.type==CKEDITOR.NODE_TEXT&&(d=d.getParent());d=d.$.offsetWidth<=c}return!!(a^d)}};CKEDITOR.dom.walker.nodeType=function(a,b){return function(c){return!!(b^c.type==a)}};CKEDITOR.dom.walker.bogus=function(a){function b(a){return!h(a)&&!l(a)}return function(c){var f=CKEDITOR.env.needsBrFiller?c.is&&c.is("br"):c.getText&&d.test(c.getText());if(f){f=c.getParent();c=c.getNext(b);f=f.isBlockBoundary()&&(!c||c.type==CKEDITOR.NODE_ELEMENT&&c.isBlockBoundary())}return!!(a^f)}};CKEDITOR.dom.walker.temp=function(a){return function(b){b.type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent());b=b&&b.hasAttribute("data-cke-temp");return!!(a^b)}};var d=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,h=CKEDITOR.dom.walker.whitespaces(),l=CKEDITOR.dom.walker.bookmark(),i=CKEDITOR.dom.walker.temp();CKEDITOR.dom.walker.ignored=function(a){return function(b){b=h(b)||l(b)||i(b);return!!(a^b)}};var g=CKEDITOR.dom.walker.ignored(),m=function(a){var b={},c;for(c in a)CKEDITOR.dtd[c]["#"]&&(b[c]=1);return b}(CKEDITOR.dtd.$block);CKEDITOR.dom.walker.editable=function(a){return function(c){return!!(a^b(c))}};CKEDITOR.dom.element.prototype.getBogus=function(){var a=this;do a=a.getPreviousSourceNode();while(l(a)||h(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.is(CKEDITOR.dtd.$inline)&&!a.is(CKEDITOR.dtd.$empty));return a&&(CKEDITOR.env.needsBrFiller?a.is&&a.is("br"):a.getText&&d.test(a.getText()))?a:false}})();CKEDITOR.dom.range=function(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=true;var e=a instanceof CKEDITOR.dom.document;this.document=e?a:a.getDocument();this.root=e?a.getBody():a};(function(){function a(){var a=false,b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(true),f=CKEDITOR.dom.walker.bogus();return function(e){if(c(e)||b(e))return true;if(f(e)&&!a)return a=true;return e.type==CKEDITOR.NODE_TEXT&&(e.hasAscendant("pre")||CKEDITOR.tools.trim(e.getText()).length)||e.type==CKEDITOR.NODE_ELEMENT&&!e.is(d)?false:true}}function e(a){var b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(1);return function(d){return c(d)||b(d)?true:!a&&h(d)||d.type==CKEDITOR.NODE_ELEMENT&&d.is(CKEDITOR.dtd.$removeEmpty)}}function b(a){return function(){var b;return this[a?"getPreviousNode":"getNextNode"](function(a){!b&&g(a)&&(b=a);return i(a)&&!(h(a)&&a.equals(b))})}}var c=function(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer.equals(a.endContainer)&&a.startOffset==a.endOffset},f=function(a,b,c,d){a.optimizeBookmark();var f=a.startContainer,e=a.endContainer,j=a.startOffset,u=a.endOffset,h,g;if(e.type==CKEDITOR.NODE_TEXT)e=e.split(u);else if(e.getChildCount()>0)if(u>=e.getChildCount()){e=e.append(a.document.createText(""));g=true}else e=e.getChild(u);if(f.type==CKEDITOR.NODE_TEXT){f.split(j);f.equals(e)&&(e=f.getNext())}else if(j)if(j>=f.getChildCount()){f=f.append(a.document.createText(""));h=true}else f=f.getChild(j).getPrevious();else{f=f.append(a.document.createText(""),1);h=true}var j=f.getParents(),u=e.getParents(),k,n,r;for(k=0;k<j.length;k++){n=j[k];r=u[k];if(!n.equals(r))break}for(var o=c,i,D,l,z=k;z<j.length;z++){i=j[z];o&&!i.equals(f)&&(D=o.append(i.clone()));for(i=i.getNext();i;){if(i.equals(u[z])||i.equals(e))break;l=i.getNext();if(b==2)o.append(i.clone(true));else{i.remove();b==1&&o.append(i)}i=l}o&&(o=D)}o=c;for(c=k;c<u.length;c++){i=u[c];b>0&&!i.equals(e)&&(D=o.append(i.clone()));if(!j[c]||i.$.parentNode!=j[c].$.parentNode)for(i=i.getPrevious();i;){if(i.equals(j[c])||i.equals(f))break;l=i.getPrevious();if(b==2)o.$.insertBefore(i.$.cloneNode(true),o.$.firstChild);else{i.remove();b==1&&o.$.insertBefore(i.$,o.$.firstChild)}i=l}o&&(o=D)}if(b==2){n=a.startContainer;if(n.type==CKEDITOR.NODE_TEXT){n.$.data=n.$.data+n.$.nextSibling.data;n.$.parentNode.removeChild(n.$.nextSibling)}a=a.endContainer;if(a.type==CKEDITOR.NODE_TEXT&&a.$.nextSibling){a.$.data=a.$.data+a.$.nextSibling.data;a.$.parentNode.removeChild(a.$.nextSibling)}}else{if(n&&r&&(f.$.parentNode!=n.$.parentNode||e.$.parentNode!=r.$.parentNode)){b=r.getIndex();h&&r.$.parentNode==f.$.parentNode&&b--;if(d&&n.type==CKEDITOR.NODE_ELEMENT){d=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',a.document);d.insertAfter(n);n.mergeSiblings(false);a.moveToBookmark({startNode:d})}else a.setStart(r.getParent(),b)}a.collapse(true)}h&&f.remove();g&&e.$.parentNode&&e.remove()},d={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},h=CKEDITOR.dom.walker.bogus(),l=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,i=CKEDITOR.dom.walker.editable(),g=CKEDITOR.dom.walker.ignored(true);CKEDITOR.dom.range.prototype={clone:function(){var a=new CKEDITOR.dom.range(this.root);a._setStartContainer(this.startContainer);a.startOffset=this.startOffset;a._setEndContainer(this.endContainer);a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},collapse:function(a){if(a){this._setEndContainer(this.startContainer);this.endOffset=this.startOffset}else{this._setStartContainer(this.endContainer);this.startOffset=this.endOffset}this.collapsed=true},cloneContents:function(){var a=new CKEDITOR.dom.documentFragment(this.document);this.collapsed||f(this,2,a);return a},deleteContents:function(a){this.collapsed||f(this,0,null,a)},extractContents:function(a){var b=new CKEDITOR.dom.documentFragment(this.document);this.collapsed||f(this,1,b,a);return b},createBookmark:function(a){var b,c,d,f,e=this.collapsed;b=this.document.createElement("span");b.data("cke-bookmark",1);b.setStyle("display","none");b.setHtml("&nbsp;");if(a){d="cke_bm_"+CKEDITOR.tools.getNextNumber();b.setAttribute("id",d+(e?"C":"S"))}if(!e){c=b.clone();c.setHtml("&nbsp;");a&&c.setAttribute("id",d+"E");f=this.clone();f.collapse();f.insertNode(c)}f=this.clone();f.collapse(true);f.insertNode(b);if(c){this.setStartAfter(b);this.setEndBefore(c)}else this.moveToPosition(b,CKEDITOR.POSITION_AFTER_END);return{startNode:a?d+(e?"C":"S"):b,endNode:a?d+"E":c,serializable:a,collapsed:e}},createBookmark2:function(){function a(c){var d=c.container,f=c.offset,e;e=d;var m=f;e=e.type!=CKEDITOR.NODE_ELEMENT||m===0||m==e.getChildCount()?0:e.getChild(m-1).type==CKEDITOR.NODE_TEXT&&e.getChild(m).type==CKEDITOR.NODE_TEXT;if(e){d=d.getChild(f-1);f=d.getLength()}d.type==CKEDITOR.NODE_ELEMENT&&f>1&&(f=d.getChild(f-1).getIndex(true)+1);if(d.type==CKEDITOR.NODE_TEXT){e=d;for(m=0;(e=e.getPrevious())&&e.type==CKEDITOR.NODE_TEXT;)m=m+e.getLength();e=m;if(d.getText())f=f+e;else{m=d.getPrevious(b);if(e){f=e;d=m?m.getNext():d.getParent().getFirst()}else{d=d.getParent();f=m?m.getIndex(true)+1:0}}}c.container=d;c.offset=f}var b=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_TEXT,true);return function(b){var c=this.collapsed,d={container:this.startContainer,offset:this.startOffset},f={container:this.endContainer,offset:this.endOffset};if(b){a(d);c||a(f)}return{start:d.container.getAddress(b),end:c?null:f.container.getAddress(b),startOffset:d.offset,endOffset:f.offset,normalized:b,collapsed:c,is2:true}}}(),moveToBookmark:function(a){if(a.is2){var b=this.document.getByAddress(a.start,a.normalized),c=a.startOffset,d=a.end&&this.document.getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(b,c);d?this.setEnd(d,a):this.collapse(true)}else{b=(c=a.serializable)?this.document.getById(a.startNode):a.startNode;a=c?this.document.getById(a.endNode):a.endNode;this.setStartBefore(b);b.remove();if(a){this.setEndBefore(a);a.remove()}else this.collapse(true)}},getBoundaryNodes:function(){var a=this.startContainer,b=this.endContainer,c=this.startOffset,d=this.endOffset,f;if(a.type==CKEDITOR.NODE_ELEMENT){f=a.getChildCount();if(f>c)a=a.getChild(c);else if(f<1)a=a.getPreviousSourceNode();else{for(a=a.$;a.lastChild;)a=a.lastChild;a=new CKEDITOR.dom.node(a);a=a.getNextSourceNode()||a}}if(b.type==CKEDITOR.NODE_ELEMENT){f=b.getChildCount();if(f>d)b=b.getChild(d).getPreviousSourceNode(true);else if(f<1)b=b.getPreviousSourceNode();else{for(b=b.$;b.lastChild;)b=b.lastChild;b=new CKEDITOR.dom.node(b)}}a.getPosition(b)&CKEDITOR.POSITION_FOLLOWING&&(a=b);return{startNode:a,endNode:b}},getCommonAncestor:function(a,b){var c=this.startContainer,d=this.endContainer,c=c.equals(d)?a&&c.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-
1?c.getChild(this.startOffset):c:c.getCommonAncestor(d);return b&&!c.is?c.getParent():c},optimize:function(){var a=this.startContainer,b=this.startOffset;a.type!=CKEDITOR.NODE_ELEMENT&&(b?b>=a.getLength()&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;b=this.endOffset;a.type!=CKEDITOR.NODE_ELEMENT&&(b?b>=a.getLength()&&this.setEndAfter(a):this.setEndBefore(a))},optimizeBookmark:function(){var a=this.startContainer,b=this.endContainer;a.is&&(a.is("span")&&a.data("cke-bookmark"))&&this.setStartAt(a,CKEDITOR.POSITION_BEFORE_START);b&&(b.is&&b.is("span")&&b.data("cke-bookmark"))&&this.setEndAt(b,CKEDITOR.POSITION_AFTER_END)},trim:function(a,b){var c=this.startContainer,d=this.startOffset,f=this.collapsed;if((!a||f)&&c&&c.type==CKEDITOR.NODE_TEXT){if(d)if(d>=c.getLength()){d=c.getIndex()+1;c=c.getParent()}else{var e=c.split(d),d=c.getIndex()+1,c=c.getParent();if(this.startContainer.equals(this.endContainer))this.setEnd(e,this.endOffset-this.startOffset);else if(c.equals(this.endContainer))this.endOffset=this.endOffset+1}else{d=c.getIndex();c=c.getParent()}this.setStart(c,d);if(f){this.collapse(true);return}}c=this.endContainer;d=this.endOffset;if(!b&&!f&&c&&c.type==CKEDITOR.NODE_TEXT){if(d){d>=c.getLength()||c.split(d);d=c.getIndex()+1}else d=c.getIndex();c=c.getParent();this.setEnd(c,d)}},enlarge:function(a,b){function c(a){return a&&a.type==CKEDITOR.NODE_ELEMENT&&a.hasAttribute("contenteditable")?null:a}var d=RegExp(/[^\s\ufeff]/);switch(a){case CKEDITOR.ENLARGE_INLINE:var f=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)break;var e=this.getCommonAncestor(),j=this.root,h,i,g,k,n,r=false,o,l;o=this.startContainer;var D=this.startOffset;if(o.type==CKEDITOR.NODE_TEXT){if(D){o=!CKEDITOR.tools.trim(o.substring(0,D)).length&&o;r=!!o}if(o&&!(k=o.getPrevious()))g=o.getParent()}else{D&&(k=o.getChild(D-1)||o.getLast());k||(g=o)}for(g=c(g);g||k;){if(g&&!k){!n&&g.equals(e)&&(n=true);if(f?g.isBlockBoundary():!j.contains(g))break;if(!r||g.getComputedStyle("display")!="inline"){r=false;n?h=g:this.setStartBefore(g)}k=g.getPrevious()}for(;k;){o=false;if(k.type==CKEDITOR.NODE_COMMENT)k=k.getPrevious();else{if(k.type==CKEDITOR.NODE_TEXT){l=k.getText();d.test(l)&&(k=null);o=/[\s\ufeff]$/.test(l)}else if((k.$.offsetWidth>(CKEDITOR.env.webkit?1:0)||b&&k.is("br"))&&!k.data("cke-bookmark"))if(r&&CKEDITOR.dtd.$removeEmpty[k.getName()]){l=k.getText();if(d.test(l))k=null;else for(var D=k.$.getElementsByTagName("*"),J=0,z;z=D[J++];)if(!CKEDITOR.dtd.$removeEmpty[z.nodeName.toLowerCase()]){k=null;break}k&&(o=!!l.length)}else k=null;o&&(r?n?h=g:g&&this.setStartBefore(g):r=true);if(k){o=k.getPrevious();if(!g&&!o){g=k;k=null;break}k=o}else g=null}}g&&(g=c(g.getParent()))}o=this.endContainer;D=this.endOffset;g=k=null;n=r=false;var L=function(a,b){var c=new CKEDITOR.dom.range(j);c.setStart(a,b);c.setEndAt(j,CKEDITOR.POSITION_BEFORE_END);var c=new CKEDITOR.dom.walker(c),f;for(c.guard=function(a){return!(a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary())};f=c.next();){if(f.type!=CKEDITOR.NODE_TEXT)return false;l=f!=a?f.getText():f.substring(b);if(d.test(l))return false}return true};if(o.type==CKEDITOR.NODE_TEXT)if(CKEDITOR.tools.trim(o.substring(D)).length)r=true;else{r=!o.getLength();if(D==o.getLength()){if(!(k=o.getNext()))g=o.getParent()}else L(o,D)&&(g=o.getParent())}else(k=o.getChild(D))||(g=o);for(;g||k;){if(g&&!k){!n&&g.equals(e)&&(n=true);if(f?g.isBlockBoundary():!j.contains(g))break;if(!r||g.getComputedStyle("display")!="inline"){r=false;n?i=g:g&&this.setEndAfter(g)}k=g.getNext()}for(;k;){o=false;if(k.type==CKEDITOR.NODE_TEXT){l=k.getText();L(k,0)||(k=null);o=/^[\s\ufeff]/.test(l)}else if(k.type==CKEDITOR.NODE_ELEMENT){if((k.$.offsetWidth>0||b&&k.is("br"))&&!k.data("cke-bookmark"))if(r&&CKEDITOR.dtd.$removeEmpty[k.getName()]){l=k.getText();if(d.test(l))k=null;else{D=k.$.getElementsByTagName("*");for(J=0;z=D[J++];)if(!CKEDITOR.dtd.$removeEmpty[z.nodeName.toLowerCase()]){k=null;break}}k&&(o=!!l.length)}else k=null}else o=1;o&&r&&(n?i=g:this.setEndAfter(g));if(k){o=k.getNext();if(!g&&!o){g=k;k=null;break}k=o}else g=null}g&&(g=c(g.getParent()))}if(h&&i){e=h.contains(i)?i:h;this.setStartBefore(e);this.setEndAfter(e)}break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:g=new CKEDITOR.dom.range(this.root);j=this.root;g.setStartAt(j,CKEDITOR.POSITION_AFTER_START);g.setEnd(this.startContainer,this.startOffset);g=new CKEDITOR.dom.walker(g);var B,w,H=CKEDITOR.dom.walker.blockBoundary(a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),C=null,A=function(a){if(a.type==CKEDITOR.NODE_ELEMENT&&a.getAttribute("contenteditable")=="false")if(C){if(C.equals(a)){C=null;return}}else C=a;else if(C)return;var b=H(a);b||(B=a);return b},f=function(a){var b=A(a);!b&&(a.is&&a.is("br"))&&(w=a);return b};g.guard=A;g=g.lastBackward();B=B||j;this.setStartAt(B,!B.is("br")&&(!g&&this.checkStartOfBlock()||g&&B.contains(g))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END);if(a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){g=this.clone();g=new CKEDITOR.dom.walker(g);var x=CKEDITOR.dom.walker.whitespaces(),F=CKEDITOR.dom.walker.bookmark();g.evaluator=function(a){return!x(a)&&!F(a)};if((g=g.previous())&&g.type==CKEDITOR.NODE_ELEMENT&&g.is("br"))break}g=this.clone();g.collapse();g.setEndAt(j,CKEDITOR.POSITION_BEFORE_END);g=new CKEDITOR.dom.walker(g);g.guard=a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?f:A;B=C=w=null;g=g.lastForward();B=B||j;this.setEndAt(B,!g&&this.checkEndOfBlock()||g&&B.contains(g)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START);w&&this.setEndAfter(w)}},shrink:function(a,b,c){if(!this.collapsed){var a=a||CKEDITOR.SHRINK_TEXT,d=this.clone(),f=this.startContainer,e=this.endContainer,j=this.startOffset,g=this.endOffset,h=1,i=1;if(f&&f.type==CKEDITOR.NODE_TEXT)if(j)if(j>=f.getLength())d.setStartAfter(f);else{d.setStartBefore(f);h=0}else d.setStartBefore(f);if(e&&e.type==CKEDITOR.NODE_TEXT)if(g)if(g>=e.getLength())d.setEndAfter(e);else{d.setEndAfter(e);i=0}else d.setEndBefore(e);var d=new CKEDITOR.dom.walker(d),k=CKEDITOR.dom.walker.bookmark();d.evaluator=function(b){return b.type==(a==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var n;d.guard=function(b,d){if(k(b))return true;if(a==CKEDITOR.SHRINK_ELEMENT&&b.type==CKEDITOR.NODE_TEXT||d&&b.equals(n)||c===false&&b.type==CKEDITOR.NODE_ELEMENT&&b.isBlockBoundary()||b.type==CKEDITOR.NODE_ELEMENT&&b.hasAttribute("contenteditable"))return false;!d&&b.type==CKEDITOR.NODE_ELEMENT&&(n=b);return true};if(h)(f=d[a==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(f,b?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START);if(i){d.reset();(d=d[a==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(d,b?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)}return!(!h&&!i)}},insertNode:function(a){this.optimizeBookmark();this.trim(false,true);var b=this.startContainer,c=b.getChild(this.startOffset);c?a.insertBefore(c):b.append(a);a.getParent()&&a.getParent().equals(this.endContainer)&&this.endOffset++;this.setStartBefore(a)},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(true)},moveToRange:function(a){this.setStart(a.startContainer,a.startOffset);this.setEnd(a.endContainer,a.endOffset)},selectNodeContents:function(a){this.setStart(a,0);this.setEnd(a,a.type==CKEDITOR.NODE_TEXT?a.getLength():a.getChildCount())},setStart:function(a,b){if(a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]){b=a.getIndex();a=a.getParent()}this._setStartContainer(a);this.startOffset=b;if(!this.endContainer){this._setEndContainer(a);this.endOffset=b}c(this)},setEnd:function(a,b){if(a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]){b=a.getIndex()+1;a=a.getParent()}this._setEndContainer(a);this.endOffset=b;if(!this.startContainer){this._setStartContainer(a);this.startOffset=b}c(this)},setStartAfter:function(a){this.setStart(a.getParent(),a.getIndex()+1)},setStartBefore:function(a){this.setStart(a.getParent(),a.getIndex())},setEndAfter:function(a){this.setEnd(a.getParent(),a.getIndex()+1)},setEndBefore:function(a){this.setEnd(a.getParent(),a.getIndex())},setStartAt:function(a,b){switch(b){case CKEDITOR.POSITION_AFTER_START:this.setStart(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setStart(a,a.getLength()):this.setStart(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(a)}c(this)},setEndAt:function(a,b){switch(b){case CKEDITOR.POSITION_AFTER_START:this.setEnd(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setEnd(a,a.getLength()):this.setEnd(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(a)}c(this)},fixBlock:function(a,b){var c=this.createBookmark(),d=this.document.createElement(b);this.collapse(a);this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS);this.extractContents().appendTo(d);d.trim();d.appendBogus();this.insertNode(d);this.moveToBookmark(c);return d},splitBlock:function(a){var b=new CKEDITOR.dom.elementPath(this.startContainer,this.root),c=new CKEDITOR.dom.elementPath(this.endContainer,this.root),d=b.block,f=c.block,e=null;if(!b.blockLimit.equals(c.blockLimit))return null;if(a!="br"){if(!d){d=this.fixBlock(true,a);f=(new CKEDITOR.dom.elementPath(this.endContainer,this.root)).block}f||(f=this.fixBlock(false,a))}a=d&&this.checkStartOfBlock();b=f&&this.checkEndOfBlock();this.deleteContents();if(d&&d.equals(f))if(b){e=new CKEDITOR.dom.elementPath(this.startContainer,this.root);this.moveToPosition(f,CKEDITOR.POSITION_AFTER_END);f=null}else if(a){e=new CKEDITOR.dom.elementPath(this.startContainer,this.root);this.moveToPosition(d,CKEDITOR.POSITION_BEFORE_START);d=null}else{f=this.splitElement(d);d.is("ul","ol")||d.appendBogus()}return{previousBlock:d,nextBlock:f,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:e}},splitElement:function(a){if(!this.collapsed)return null;this.setEndAt(a,CKEDITOR.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(false);b.appendTo(c);c.insertAfter(a);this.moveToPosition(a,CKEDITOR.POSITION_AFTER_END);return c},removeEmptyBlocksAtEnd:function(){function a(d){return function(a){return b(a)||(c(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.isEmptyInlineRemoveable())||d.is("table")&&a.is("caption")?false:true}}var b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(false);return function(b){for(var c=this.createBookmark(),d=this[b?"endPath":"startPath"](),f=d.block||d.blockLimit,e;f&&!f.equals(d.root)&&!f.getFirst(a(f));){e=f.getParent();this[b?"setEndAt":"setStartAt"](f,CKEDITOR.POSITION_AFTER_END);f.remove(1);f=e}this.moveToBookmark(c)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(a,b){var c=b==CKEDITOR.START,d=this.clone();d.collapse(c);d[c?"setStartAt":"setEndAt"](a,c?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END);d=new CKEDITOR.dom.walker(d);d.evaluator=e(c);return d[c?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var b=this.startContainer,c=this.startOffset;if(CKEDITOR.env.ie&&c&&b.type==CKEDITOR.NODE_TEXT){b=CKEDITOR.tools.ltrim(b.substring(0,c));l.test(b)&&this.trim(0,1)}this.trim();b=new CKEDITOR.dom.elementPath(this.startContainer,this.root);c=this.clone();c.collapse(true);c.setStartAt(b.block||b.blockLimit,CKEDITOR.POSITION_AFTER_START);b=new CKEDITOR.dom.walker(c);b.evaluator=a();return b.checkBackward()},checkEndOfBlock:function(){var b=this.endContainer,c=this.endOffset;if(CKEDITOR.env.ie&&b.type==CKEDITOR.NODE_TEXT){b=CKEDITOR.tools.rtrim(b.substring(c));l.test(b)&&this.trim(1,0)}this.trim();b=new CKEDITOR.dom.elementPath(this.endContainer,this.root);c=this.clone();c.collapse(false);c.setEndAt(b.block||b.blockLimit,CKEDITOR.POSITION_BEFORE_END);b=new CKEDITOR.dom.walker(c);b.evaluator=a();return b.checkForward()},getPreviousNode:function(a,b,c){var d=this.clone();d.collapse(1);d.setStartAt(c||this.root,CKEDITOR.POSITION_AFTER_START);c=new CKEDITOR.dom.walker(d);c.evaluator=a;c.guard=b;return c.previous()},getNextNode:function(a,b,c){var d=this.clone();d.collapse();d.setEndAt(c||this.root,CKEDITOR.POSITION_BEFORE_END);c=new CKEDITOR.dom.walker(d);c.evaluator=a;c.guard=b;return c.next()},checkReadOnly:function(){function a(b,c){for(;b;){if(b.type==CKEDITOR.NODE_ELEMENT){if(b.getAttribute("contentEditable")=="false"&&!b.data("cke-editable"))return 0;if(b.is("html")||b.getAttribute("contentEditable")=="true"&&(b.contains(c)||b.equals(c)))break}b=b.getParent()}return 1}return function(){var b=this.startContainer,c=this.endContainer;return!(a(b,c)&&a(c,b))}}(),moveToElementEditablePosition:function(a,b){if(a.type==CKEDITOR.NODE_ELEMENT&&!a.isEditable(false)){this.moveToPosition(a,b?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START);return true}for(var c=0;a;){if(a.type==CKEDITOR.NODE_TEXT){b&&this.endContainer&&this.checkEndOfBlock()&&l.test(a.getText())?this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(a,b?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START);c=1;break}if(a.type==CKEDITOR.NODE_ELEMENT)if(a.isEditable()){this.moveToPosition(a,b?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START);c=1}else if(b&&a.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START);else if(a.getAttribute("contenteditable")=="false"&&a.is(CKEDITOR.dtd.$block)){this.setStartBefore(a);this.setEndAfter(a);return true}var d=a,f=c,e=void 0;d.type==CKEDITOR.NODE_ELEMENT&&d.isEditable(false)&&(e=d[b?"getLast":"getFirst"](g));!f&&!e&&(e=d[b?"getPrevious":"getNext"](g));a=e}return!!c},moveToClosestEditablePosition:function(a,b){var c=new CKEDITOR.dom.range(this.root),d=0,f,e=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];c.moveToPosition(a,e[b?0:1]);if(a.is(CKEDITOR.dtd.$block)){if(f=c[b?"getNextEditableNode":"getPreviousEditableNode"]()){d=1;if(f.type==CKEDITOR.NODE_ELEMENT&&f.is(CKEDITOR.dtd.$block)&&f.getAttribute("contenteditable")=="false"){c.setStartAt(f,CKEDITOR.POSITION_BEFORE_START);c.setEndAt(f,CKEDITOR.POSITION_AFTER_END)}else c.moveToPosition(f,e[b?1:0])}}else d=1;d&&this.moveToRange(c);return!!d},moveToElementEditStart:function(a){return this.moveToElementEditablePosition(a)},moveToElementEditEnd:function(a){return this.moveToElementEditablePosition(a,true)},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer.type!=CKEDITOR.NODE_ELEMENT||a.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var a=new CKEDITOR.dom.walker(a),b=CKEDITOR.dom.walker.bookmark(false,true),c=CKEDITOR.dom.walker.whitespaces(true);a.evaluator=function(a){return c(a)&&b(a)};var d=a.next();a.reset();return d&&d.equals(a.previous())?d:null},getTouchedStartNode:function(){var a=this.startContainer;return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.startOffset)||a},getTouchedEndNode:function(){var a=this.endContainer;return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.endOffset-1)||a},getNextEditableNode:b(),getPreviousEditableNode:b(1),scrollIntoView:function(){var a=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),b,c,d,f=this.clone();f.optimize();if(d=f.startContainer.type==CKEDITOR.NODE_TEXT){c=f.startContainer.getText();b=f.startContainer.split(f.startOffset);a.insertAfter(f.startContainer)}else f.insertNode(a);a.scrollIntoView();if(d){f.startContainer.setText(c);b.remove()}a.remove()},_setStartContainer:function(a){this.startContainer=a},_setEndContainer:function(a){this.endContainer=a}}})();CKEDITOR.POSITION_AFTER_START=1;CKEDITOR.POSITION_BEFORE_END=2;CKEDITOR.POSITION_BEFORE_START=3;CKEDITOR.POSITION_AFTER_END=4;CKEDITOR.ENLARGE_ELEMENT=1;CKEDITOR.ENLARGE_BLOCK_CONTENTS=2;CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3;CKEDITOR.ENLARGE_INLINE=4;CKEDITOR.START=1;CKEDITOR.END=2;CKEDITOR.SHRINK_ELEMENT=1;CKEDITOR.SHRINK_TEXT=2;"use strict";(function(){function a(a){if(!(arguments.length<1)){this.range=a;this.forceBrBreak=0;this.enlargeBr=1;this.enforceRealBlocks=0;this._||(this._={})}}function e(a){var b=[];a.forEach(function(a){if(a.getAttribute("contenteditable")=="true"){b.push(a);return false}},CKEDITOR.NODE_ELEMENT,true);return b}function b(a,c,d,f){a:{f==null&&(f=e(d));for(var h;h=f.shift();)if(h.getDtd().p){f={element:h,remaining:f};break a}f=null}if(!f)return 0;if((h=CKEDITOR.filter.instances[f.element.data("cke-filter")])&&!h.check(c))return b(a,c,d,f.remaining);c=new CKEDITOR.dom.range(f.element);c.selectNodeContents(f.element);c=c.createIterator();c.enlargeBr=a.enlargeBr;c.enforceRealBlocks=a.enforceRealBlocks;c.activeFilter=c.filter=h;a._.nestedEditable={element:f.element,container:d,remaining:f.remaining,iterator:c};return 1}function c(a,b,c){if(!b)return false;a=a.clone();a.collapse(!c);return a.checkBoundaryOfElement(b,c?CKEDITOR.START:CKEDITOR.END)}var f=/^[\r\n\t ]+$/,d=CKEDITOR.dom.walker.bookmark(false,true),h=CKEDITOR.dom.walker.whitespaces(true),l=function(a){return d(a)&&h(a)},i={dd:1,dt:1,li:1};a.prototype={getNextParagraph:function(a){var e,h,s,y,p,a=a||"p";if(this._.nestedEditable){if(e=this._.nestedEditable.iterator.getNextParagraph(a)){this.activeFilter=this._.nestedEditable.iterator.activeFilter;return e}this.activeFilter=this.filter;if(b(this,a,this._.nestedEditable.container,this._.nestedEditable.remaining)){this.activeFilter=this._.nestedEditable.iterator.activeFilter;return this._.nestedEditable.iterator.getNextParagraph(a)}this._.nestedEditable=null}if(!this.range.root.getDtd()[a])return null;if(!this._.started){var q=this.range.clone();h=q.startPath();var j=q.endPath(),u=!q.collapsed&&c(q,h.block),v=!q.collapsed&&c(q,j.block,1);q.shrink(CKEDITOR.SHRINK_ELEMENT,true);u&&q.setStartAt(h.block,CKEDITOR.POSITION_BEFORE_END);v&&q.setEndAt(j.block,CKEDITOR.POSITION_AFTER_START);h=q.endContainer.hasAscendant("pre",true)||q.startContainer.hasAscendant("pre",true);q.enlarge(this.forceBrBreak&&!h||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS);if(!q.collapsed){h=new CKEDITOR.dom.walker(q.clone());j=CKEDITOR.dom.walker.bookmark(true,true);h.evaluator=j;this._.nextNode=h.next();h=new CKEDITOR.dom.walker(q.clone());h.evaluator=j;h=h.previous();this._.lastNode=h.getNextSourceNode(true,null,q.root);if(this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()){j=this.range.clone();j.moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END);if(j.checkEndOfBlock()){j=new CKEDITOR.dom.elementPath(j.endContainer,j.root);this._.lastNode=(j.block||j.blockLimit).getNextSourceNode(true)}}if(!this._.lastNode||!q.root.contains(this._.lastNode)){this._.lastNode=this._.docEndMarker=q.document.createText("");this._.lastNode.insertAfter(h)}q=null}this._.started=1;h=q}j=this._.nextNode;q=this._.lastNode;for(this._.nextNode=null;j;){var u=0,v=j.hasAscendant("pre"),E=j.type!=CKEDITOR.NODE_ELEMENT,k=0;if(E)j.type==CKEDITOR.NODE_TEXT&&f.test(j.getText())&&(E=0);else{var n=j.getName();if(CKEDITOR.dtd.$block[n]&&j.getAttribute("contenteditable")=="false"){e=j;b(this,a,e);break}else if(j.isBlockBoundary(this.forceBrBreak&&!v&&{br:1})){if(n=="br")E=1;else if(!h&&!j.getChildCount()&&n!="hr"){e=j;s=j.equals(q);break}if(h){h.setEndAt(j,CKEDITOR.POSITION_BEFORE_START);if(n!="br")this._.nextNode=j}u=1}else{if(j.getFirst()){if(!h){h=this.range.clone();h.setStartAt(j,CKEDITOR.POSITION_BEFORE_START)}j=j.getFirst();continue}E=1}}if(E&&!h){h=this.range.clone();h.setStartAt(j,CKEDITOR.POSITION_BEFORE_START)}s=(!u||E)&&j.equals(q);if(h&&!u)for(;!j.getNext(l)&&!s;){n=j.getParent();if(n.isBlockBoundary(this.forceBrBreak&&!v&&{br:1})){u=1;E=0;s||n.equals(q);h.setEndAt(n,CKEDITOR.POSITION_BEFORE_END);break}j=n;E=1;s=j.equals(q);k=1}E&&h.setEndAt(j,CKEDITOR.POSITION_AFTER_END);j=this._getNextSourceNode(j,k,q);if((s=!j)||u&&h)break}if(!e){if(!h){this._.docEndMarker&&this._.docEndMarker.remove();return this._.nextNode=null}e=new CKEDITOR.dom.elementPath(h.startContainer,h.root);j=e.blockLimit;u={div:1,th:1,td:1};e=e.block;if(!e&&j&&!this.enforceRealBlocks&&u[j.getName()]&&h.checkStartOfBlock()&&h.checkEndOfBlock()&&!j.equals(h.root))e=j;else if(!e||this.enforceRealBlocks&&e.is(i)){e=this.range.document.createElement(a);h.extractContents().appendTo(e);e.trim();h.insertNode(e);y=p=true}else if(e.getName()!="li"){if(!h.checkStartOfBlock()||!h.checkEndOfBlock()){e=e.clone(false);h.extractContents().appendTo(e);e.trim();p=h.splitBlock();y=!p.wasStartOfBlock;p=!p.wasEndOfBlock;h.insertNode(e)}}else if(!s)this._.nextNode=e.equals(q)?null:this._getNextSourceNode(h.getBoundaryNodes().endNode,1,q)}if(y)(y=e.getPrevious())&&y.type==CKEDITOR.NODE_ELEMENT&&(y.getName()=="br"?y.remove():y.getLast()&&y.getLast().$.nodeName.toLowerCase()=="br"&&y.getLast().remove());if(p)(y=e.getLast())&&y.type==CKEDITOR.NODE_ELEMENT&&y.getName()=="br"&&(!CKEDITOR.env.needsBrFiller||y.getPrevious(d)||y.getNext(d))&&y.remove();if(!this._.nextNode)this._.nextNode=s||e.equals(q)||!q?null:this._getNextSourceNode(e,1,q);return e},_getNextSourceNode:function(a,b,c){function f(a){return!(a.equals(c)||a.equals(e))}for(var e=this.range.root,a=a.getNextSourceNode(b,null,f);!d(a);)a=a.getNextSourceNode(b,null,f);return a}};CKEDITOR.dom.range.prototype.createIterator=function(){return new a(this)}})();CKEDITOR.command=function(a,e){this.uiItems=[];this.exec=function(b){if(this.state==CKEDITOR.TRISTATE_DISABLED||!this.checkAllowed())return false;this.editorFocus&&a.focus();return this.fire("exec")===false?true:e.exec.call(this,a,b)!==false};this.refresh=function(a,b){if(!this.readOnly&&a.readOnly)return true;if(this.context&&!b.isContextFor(this.context)){this.disable();return true}if(!this.checkAllowed(true)){this.disable();return true}this.startDisabled||this.enable();this.modes&&!this.modes[a.mode]&&this.disable();return this.fire("refresh",{editor:a,path:b})===false?true:e.refresh&&e.refresh.apply(this,arguments)!==false};var b;this.checkAllowed=function(c){return!c&&typeof b=="boolean"?b:b=a.activeFilter.checkFeature(this)};CKEDITOR.tools.extend(this,e,{modes:{wysiwyg:1},editorFocus:1,contextSensitive:!!e.context,state:CKEDITOR.TRISTATE_DISABLED});CKEDITOR.event.call(this)};CKEDITOR.command.prototype={enable:function(){this.state==CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()&&this.setState(!this.preserveState||typeof this.previousState=="undefined"?CKEDITOR.TRISTATE_OFF:this.previousState)},disable:function(){this.setState(CKEDITOR.TRISTATE_DISABLED)},setState:function(a){if(this.state==a||a!=CKEDITOR.TRISTATE_DISABLED&&!this.checkAllowed())return false;this.previousState=this.state;this.state=a;this.fire("state");return true},toggleState:function(){this.state==CKEDITOR.TRISTATE_OFF?this.setState(CKEDITOR.TRISTATE_ON):this.state==CKEDITOR.TRISTATE_ON&&this.setState(CKEDITOR.TRISTATE_OFF)}};CKEDITOR.event.implementOn(CKEDITOR.command.prototype);CKEDITOR.ENTER_P=1;CKEDITOR.ENTER_BR=2;CKEDITOR.ENTER_DIV=3;CKEDITOR.config={customConfig:"config.js",autoUpdateElement:!0,language:"",defaultLanguage:"en",contentsLangDirection:"",enterMode:CKEDITOR.ENTER_P,forceEnterMode:!1,shiftEnterMode:CKEDITOR.ENTER_BR,docType:"<!DOCTYPE html>",bodyId:"",bodyClass:"",fullPage:!1,height:200,extraPlugins:"",removePlugins:"",protectedSource:[],tabIndex:0,width:"",baseFloatZIndex:1E4,blockedKeystrokes:[CKEDITOR.CTRL+66,CKEDITOR.CTRL+73,CKEDITOR.CTRL+85]};(function(){function a(a,b,c,d,f){var e,n,a=[];for(e in b){n=b[e];n=typeof n=="boolean"?{}:typeof n=="function"?{match:n}:L(n);if(e.charAt(0)!="$")n.elements=e;if(c)n.featureName=c.toLowerCase();var j=n;j.elements=h(j.elements,/\s+/)||null;j.propertiesOnly=j.propertiesOnly||j.elements===true;var k=/\s*,\s*/,r=void 0;for(r in C){j[r]=h(j[r],k)||null;var x=j,o=A[r],w=h(j[A[r]],k),p=j[r],g=[],i=true,F=void 0;w?i=false:w={};for(F in p)if(F.charAt(0)=="!"){F=F.slice(1);g.push(F);w[F]=true;i=false}for(;F=g.pop();){p[F]=p["!"+F];delete p["!"+F]}x[o]=(i?false:w)||null}j.match=j.match||null;d.push(n);a.push(n)}for(var b=f.elements,f=f.generic,D,c=0,d=a.length;c<d;++c){e=L(a[c]);n=e.classes===true||e.styles===true||e.attributes===true;j=e;r=o=k=void 0;for(k in C)j[k]=u(j[k]);x=true;for(r in A){k=A[r];o=j[k];w=[];p=void 0;for(p in o)p.indexOf("*")>-1?w.push(RegExp("^"+p.replace(/\*/g,".*")+"$")):w.push(p);o=w;if(o.length){j[k]=o;x=false}}j.nothingRequired=x;j.noProperties=!(j.attributes||j.classes||j.styles);if(e.elements===true||e.elements===null)f[n?"unshift":"push"](e);else{j=e.elements;delete e.elements;for(D in j)if(b[D])b[D][n?"unshift":"push"](e);else b[D]=[e]}}}function e(a,c,d,f){if(!a.match||a.match(c))if(f||l(a,c)){if(!a.propertiesOnly)d.valid=true;if(!d.allAttributes)d.allAttributes=b(a.attributes,c.attributes,d.validAttributes);if(!d.allStyles)d.allStyles=b(a.styles,c.styles,d.validStyles);if(!d.allClasses){a=a.classes;c=c.classes;f=d.validClasses;if(a)if(a===true)a=true;else{for(var e=0,n=c.length,j;e<n;++e){j=c[e];f[j]||(f[j]=a(j))}a=false}else a=false;d.allClasses=a}}}function b(a,b,c){if(!a)return false;if(a===true)return true;for(var d in b)c[d]||(c[d]=a(d));return false}function c(a,b,c){if(!a.match||a.match(b)){if(a.noProperties)return false;c.hadInvalidAttribute=f(a.attributes,b.attributes)||c.hadInvalidAttribute;c.hadInvalidStyle=f(a.styles,b.styles)||c.hadInvalidStyle;a=a.classes;b=b.classes;if(a){for(var d=false,e=a===true,n=b.length;n--;)if(e||a(b[n])){b.splice(n,1);d=true}a=d}else a=false;c.hadInvalidClass=a||c.hadInvalidClass}}function f(a,b){if(!a)return false;var c=false,d=a===true,f;for(f in b)if(d||a(f)){delete b[f];c=true}return c}function d(a,b,c){if(a.disabled||a.customConfig&&!c||!b)return false;a._.cachedChecks={};return true}function h(a,b){if(!a)return false;if(a===true)return a;if(typeof a=="string"){a=B(a);return a=="*"?true:CKEDITOR.tools.convertArrayToObject(a.split(b))}if(CKEDITOR.tools.isArray(a))return a.length?CKEDITOR.tools.convertArrayToObject(a):false;var c={},d=0,f;for(f in a){c[f]=a[f];d++}return d?c:false}function l(a,b){if(a.nothingRequired)return true;var c,d,f,e;if(f=a.requiredClasses){e=b.classes;for(c=0;c<f.length;++c){d=f[c];if(typeof d=="string"){if(CKEDITOR.tools.indexOf(e,d)==-1)return false}else if(!CKEDITOR.tools.checkIfAnyArrayItemMatches(e,d))return false}}return i(b.styles,a.requiredStyles)&&i(b.attributes,a.requiredAttributes)}function i(a,b){if(!b)return true;for(var c=0,d;c<b.length;++c){d=b[c];if(typeof d=="string"){if(!(d in
a))return false}else if(!CKEDITOR.tools.checkIfAnyObjectPropertyMatches(a,d))return false}return true}function g(a){if(!a)return{};for(var a=a.split(/\s*,\s*/).sort(),b={};a.length;)b[a.shift()]=w;return b}function m(a){for(var b,c,d,f,e={},n=1,a=B(a);b=a.match(x);){if(c=b[2]){d=t(c,"styles");f=t(c,"attrs");c=t(c,"classes")}else d=f=c=null;e["$"+n++]={elements:b[1],classes:c,styles:d,attributes:f};a=a.slice(b[0].length)}return e}function t(a,b){var c=a.match(F[b]);return c?B(c[1]):null}function s(a){var b=a.styleBackup=a.attributes.style,c=a.classBackup=a.attributes["class"];if(!a.styles)a.styles=CKEDITOR.tools.parseCssText(b||"",1);if(!a.classes)a.classes=c?c.split(/\s+/):[]}function y(a,b,d,f){var k=0,r;if(f.toHtml)b.name=b.name.replace(G,"$1");if(f.doCallbacks&&a.elementCallbacks){a:for(var x=a.elementCallbacks,h=0,o=x.length,w;h<o;++h)if(w=x[h](b)){r=w;break a}if(r)return r}if(f.doTransform)if(r=a._.transformations[b.name]){s(b);for(x=0;x<r.length;++x)n(a,b,r[x]);q(b)}if(f.doFilter){a:{x=b.name;h=a._;a=h.allowedRules.elements[x];r=h.allowedRules.generic;x=h.disallowedRules.elements[x];h=h.disallowedRules.generic;o=f.skipRequired;w={valid:false,validAttributes:{},validClasses:{},validStyles:{},allAttributes:false,allClasses:false,allStyles:false,hadInvalidAttribute:false,hadInvalidClass:false,hadInvalidStyle:false};var p,g;if(!a&&!r)a=null;else{s(b);if(x){p=0;for(g=x.length;p<g;++p)if(c(x[p],b,w)===false){a=null;break a}}if(h){p=0;for(g=h.length;p<g;++p)c(h[p],b,w)}if(a){p=0;for(g=a.length;p<g;++p)e(a[p],b,w,o)}if(r){p=0;for(g=r.length;p<g;++p)e(r[p],b,w,o)}a=w}}if(!a){d.push(b);return z}if(!a.valid){d.push(b);return z}g=a.validAttributes;var i=a.validStyles;r=a.validClasses;var x=b.attributes,F=b.styles,h=b.classes,o=b.classBackup,C=b.styleBackup,u,A,D=[];w=[];var v=/^data-cke-/;p=false;delete x.style;delete x["class"];delete b.classBackup;delete b.styleBackup;if(!a.allAttributes)for(u in x)if(!g[u])if(v.test(u)){if(u!=(A=u.replace(/^data-cke-saved-/,""))&&!g[A]){delete x[u];p=true}}else{delete x[u];p=true}if(!a.allStyles||a.hadInvalidStyle){for(u in F)a.allStyles||i[u]?D.push(u+":"+F[u]):p=true;if(D.length)x.style=D.sort().join("; ")}else if(C)x.style=C;if(!a.allClasses||a.hadInvalidClass){for(u=0;u<h.length;++u)(a.allClasses||r[h[u]])&&w.push(h[u]);w.length&&(x["class"]=w.sort().join(" "));o&&w.length<o.split(/\s+/).length&&(p=true)}else o&&(x["class"]=o);p&&(k=z);if(!f.skipFinalValidation&&!j(b)){d.push(b);return z}}if(f.toHtml)b.name=b.name.replace($,"cke:$1");return k}function p(a){var b=[],c;for(c in a)c.indexOf("*")>-1&&b.push(c.replace(/\*/g,".*"));return b.length?RegExp("^(?:"+b.join("|")+")$"):null}function q(a){var b=a.attributes,c;delete b.style;delete b["class"];if(c=CKEDITOR.tools.writeCssText(a.styles,true))b.style=c;a.classes.length&&(b["class"]=a.classes.sort().join(" "))}function j(a){switch(a.name){case"a":if(!a.children.length&&!a.attributes.name)return false;break;case"img":if(!a.attributes.src)return false}return true}function u(a){if(!a)return false;if(a===true)return true;var b=p(a);return function(c){return c in a||b&&c.match(b)}}function v(){return new CKEDITOR.htmlParser.element("br")}function E(a){return a.type==CKEDITOR.NODE_ELEMENT&&(a.name=="br"||J.$block[a.name])}function k(a,b,c){var d=a.name;if(J.$empty[d]||!a.children.length)if(d=="hr"&&b=="br")a.replaceWith(v());else{a.parent&&c.push({check:"it",el:a.parent});a.remove()}else if(J.$block[d]||d=="tr")if(b=="br"){if(a.previous&&!E(a.previous)){b=v();b.insertBefore(a)}if(a.next&&!E(a.next)){b=v();b.insertAfter(a)}a.replaceWithChildren()}else{var d=a.children,f;b:{f=J[b];for(var e=0,n=d.length,j;e<n;++e){j=d[e];if(j.type==CKEDITOR.NODE_ELEMENT&&!f[j.name]){f=false;break b}}f=true}if(f){a.name=b;a.attributes={};c.push({check:"parent-down",el:a})}else{f=a.parent;for(var e=f.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||f.name=="body",k,r,n=d.length;n>0;){j=d[--n];if(e&&(j.type==CKEDITOR.NODE_TEXT||j.type==CKEDITOR.NODE_ELEMENT&&J.$inline[j.name])){if(!k){k=new CKEDITOR.htmlParser.element(b);k.insertAfter(a);c.push({check:"parent-down",el:k})}k.add(j,0)}else{k=null;r=J[f.name]||J.span;j.insertAfter(a);f.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(j.type==CKEDITOR.NODE_ELEMENT&&!r[j.name])&&c.push({check:"el-up",el:j})}}a.remove()}}else if(d=="style")a.remove();else{a.parent&&c.push({check:"it",el:a.parent});a.replaceWithChildren()}}function n(a,b,c){var d,f;for(d=0;d<c.length;++d){f=c[d];if((!f.check||a.check(f.check,false))&&(!f.left||f.left(b))){f.right(b,aa);break}}}function r(a,b){var c=b.getDefinition(),d=c.attributes,f=c.styles,e,n,j,k;if(a.name!=c.element)return false;for(e in d)if(e=="class"){c=d[e].split(/\s+/);for(j=a.classes.join("|");k=c.pop();)if(j.indexOf(k)==-1)return false}else if(a.attributes[e]!=d[e])return false;for(n in f)if(a.styles[n]!=f[n])return false;return true}function o(a,b){var c,d;if(typeof a=="string")c=a;else if(a instanceof CKEDITOR.style)d=a;else{c=a[0];d=a[1]}return[{element:c,left:d,right:function(a,c){c.transform(a,b)}}]}function M(a){return function(b){return r(b,a)}}function D(a){return function(b,c){c[a](b)}}
var J=CKEDITOR.dtd,z=1,L=CKEDITOR.tools.copy,B=CKEDITOR.tools.trim,w="cke-test",H=["","p","br","div"];CKEDITOR.FILTER_SKIP_TREE=2;CKEDITOR.filter=function(a){this.allowedContent=[];this.disallowedContent=[];this.elementCallbacks=null;this.disabled=false;this.editor=null;this.id=CKEDITOR.tools.getNextNumber();this._={allowedRules:{elements:{},generic:[]},disallowedRules:{elements:{},generic:[]},transformations:{},cachedTests:{}};CKEDITOR.filter.instances[this.id]=this;if(a instanceof CKEDITOR.editor){a=this.editor=a;this.customConfig=true;var b=a.config.allowedContent;if(b===true)this.disabled=true;else{if(!b)this.customConfig=false;this.allow(b,"config",1);this.allow(a.config.extraAllowedContent,"extra",1);this.allow(H[a.enterMode]+" "+H[a.shiftEnterMode],"default",1);this.disallow(a.config.disallowedContent)}}else{this.customConfig=false;this.allow(a,"default",1)}};CKEDITOR.filter.instances={};CKEDITOR.filter.prototype={allow:function(b,c,f){if(!d(this,b,f))return false;var e,n;if(typeof b=="string")b=m(b);else if(b instanceof CKEDITOR.style){if(b.toAllowedContentRules)return this.allow(b.toAllowedContentRules(this.editor),c,f);e=b.getDefinition();b={};f=e.attributes;b[e.element]=e={styles:e.styles,requiredStyles:e.styles&&CKEDITOR.tools.objectKeys(e.styles)};if(f){f=L(f);e.classes=f["class"]?f["class"].split(/\s+/):null;e.requiredClasses=e.classes;delete f["class"];e.attributes=f;e.requiredAttributes=f&&CKEDITOR.tools.objectKeys(f)}}else if(CKEDITOR.tools.isArray(b)){for(e=0;e<b.length;++e)n=this.allow(b[e],c,f);return n}a(this,b,c,this.allowedContent,this._.allowedRules);return true},applyTo:function(a,b,c,d){if(this.disabled)return false;var f=this,e=[],n=this.editor&&this.editor.config.protectedSource,r,x=false,h={doFilter:!c,doTransform:true,doCallbacks:true,toHtml:b};a.forEach(function(a){if(a.type==CKEDITOR.NODE_ELEMENT){if(a.attributes["data-cke-filter"]=="off")return false;if(!b||!(a.name=="span"&&~CKEDITOR.tools.objectKeys(a.attributes).join("|").indexOf("data-cke-"))){r=y(f,a,e,h);if(r&z)x=true;else if(r&2)return false}}else if(a.type==CKEDITOR.NODE_COMMENT&&a.value.match(/^\{cke_protected\}(?!\{C\})/)){var c;a:{var d=decodeURIComponent(a.value.replace(/^\{cke_protected\}/,""));c=[];var j,k,o;if(n)for(k=0;k<n.length;++k)if((o=d.match(n[k]))&&o[0].length==d.length){c=true;break a}d=CKEDITOR.htmlParser.fragment.fromHtml(d);d.children.length==1&&(j=d.children[0]).type==CKEDITOR.NODE_ELEMENT&&y(f,j,c,h);c=!c.length}c||e.push(a)}},null,true);e.length&&(x=true);for(var o,a=[],d=H[d||(this.editor?this.editor.enterMode:CKEDITOR.ENTER_P)],p;c=e.pop();)c.type==CKEDITOR.NODE_ELEMENT?k(c,d,a):c.remove();for(;o=a.pop();){c=o.el;if(c.parent){p=J[c.parent.name]||J.span;switch(o.check){case"it":J.$removeEmpty[c.name]&&!c.children.length?k(c,d,a):j(c)||k(c,d,a);break;case"el-up":c.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!p[c.name]&&k(c,d,a);break;case"parent-down":c.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!p[c.name]&&k(c.parent,d,a)}}}return x},checkFeature:function(a){if(this.disabled||!a)return true;a.toFeature&&(a=a.toFeature(this.editor));return!a.requiredContent||this.check(a.requiredContent)},disable:function(){this.disabled=true},disallow:function(b){if(!d(this,b,true))return false;typeof b=="string"&&(b=m(b));a(this,b,null,this.disallowedContent,this._.disallowedRules);return true},addContentForms:function(a){if(!this.disabled&&a){var b,c,d=[],f;for(b=0;b<a.length&&!f;++b){c=a[b];if((typeof c=="string"||c instanceof CKEDITOR.style)&&this.check(c))f=c}if(f){for(b=0;b<a.length;++b)d.push(o(a[b],f));this.addTransformations(d)}}},addElementCallback:function(a){if(!this.elementCallbacks)this.elementCallbacks=[];this.elementCallbacks.push(a)},addFeature:function(a){if(this.disabled||!a)return true;a.toFeature&&(a=a.toFeature(this.editor));this.allow(a.allowedContent,a.name);this.addTransformations(a.contentTransformations);this.addContentForms(a.contentForms);return a.requiredContent&&(this.customConfig||this.disallowedContent.length)?this.check(a.requiredContent):true},addTransformations:function(a){var b,c;if(!this.disabled&&a){var d=this._.transformations,f;for(f=0;f<a.length;++f){b=a[f];var e=void 0,n=void 0,j=void 0,k=void 0,r=void 0,x=void 0;c=[];for(n=0;n<b.length;++n){j=b[n];if(typeof j=="string"){j=j.split(/\s*:\s*/);k=j[0];r=null;x=j[1]}else{k=j.check;r=j.left;x=j.right}if(!e){e=j;e=e.element?e.element:k?k.match(/^([a-z0-9]+)/i)[0]:e.left.getDefinition().element}r instanceof CKEDITOR.style&&(r=M(r));c.push({check:k==e?null:k,left:r,right:typeof x=="string"?D(x):x})}b=e;d[b]||(d[b]=[]);d[b].push(c)}}},check:function(a,b,c){if(this.disabled)return true;if(CKEDITOR.tools.isArray(a)){for(var d=a.length;d--;)if(this.check(a[d],b,c))return true;return false}var f,e;if(typeof a=="string"){e=a+"<"+(b===false?"0":"1")+(c?"1":"0")+">";if(e in this._.cachedChecks)return this._.cachedChecks[e];d=m(a).$1;f=d.styles;var j=d.classes;d.name=d.elements;d.classes=j=j?j.split(/\s*,\s*/):[];d.styles=g(f);d.attributes=g(d.attributes);d.children=[];j.length&&(d.attributes["class"]=j.join(" "));if(f)d.attributes.style=CKEDITOR.tools.writeCssText(d.styles);f=d}else{d=a.getDefinition();f=d.styles;j=d.attributes||{};if(f){f=L(f);j.style=CKEDITOR.tools.writeCssText(f,true)}else f={};f={name:d.element,attributes:j,classes:j["class"]?j["class"].split(/\s+/):[],styles:f,children:[]}}var j=CKEDITOR.tools.clone(f),k=[],r;if(b!==false&&(r=this._.transformations[f.name])){for(d=0;d<r.length;++d)n(this,f,r[d]);q(f)}y(this,j,k,{doFilter:true,doTransform:b!==false,skipRequired:!c,skipFinalValidation:!c});b=k.length>0?false:CKEDITOR.tools.objectCompare(f.attributes,j.attributes,true)?true:false;typeof a=="string"&&(this._.cachedChecks[e]=b);return b},getAllowedEnterMode:function(){var a=["p","div","br"],b={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(c,d){var f=a.slice(),e;if(this.check(H[c]))return c;for(d||(f=f.reverse());e=f.pop();)if(this.check(e))return b[e];return CKEDITOR.ENTER_BR}}(),destroy:function(){delete CKEDITOR.filter.instances[this.id];delete this._;delete this.allowedContent;delete this.disallowedContent}};var C={styles:1,attributes:1,classes:1},A={styles:"requiredStyles",attributes:"requiredAttributes",classes:"requiredClasses"},x=/^([a-z0-9\-*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,F={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},G=/^cke:(object|embed|param)$/,$=/^(object|embed|param)$/,aa=CKEDITOR.filter.transformationsTools={sizeToStyle:function(a){this.lengthToStyle(a,"width");this.lengthToStyle(a,"height")},sizeToAttribute:function(a){this.lengthToAttribute(a,"width");this.lengthToAttribute(a,"height")},lengthToStyle:function(a,b,c){c=c||b;if(!(c in a.styles)){var d=a.attributes[b];if(d){/^\d+$/.test(d)&&(d=d+"px");a.styles[c]=d}}delete a.attributes[b]},lengthToAttribute:function(a,b,c){c=c||b;if(!(c in a.attributes)){var d=a.styles[b],f=d&&d.match(/^(\d+)(?:\.\d*)?px$/);f?a.attributes[c]=f[1]:d==w&&(a.attributes[c]=w)}delete a.styles[b]},alignmentToStyle:function(a){if(!("float"in a.styles)){var b=a.attributes.align;if(b=="left"||b=="right")a.styles["float"]=b}delete a.attributes.align},alignmentToAttribute:function(a){if(!("align"in a.attributes)){var b=a.styles["float"];if(b=="left"||b=="right")a.attributes.align=b}delete a.styles["float"]},matchesStyle:r,transform:function(a,b){if(typeof b=="string")a.name=b;else{var c=b.getDefinition(),d=c.styles,f=c.attributes,e,j,n,k;a.name=c.element;for(e in f)if(e=="class"){c=a.classes.join("|");for(n=f[e].split(/\s+/);k=n.pop();)c.indexOf(k)==-1&&a.classes.push(k)}else a.attributes[e]=f[e];for(j in d)a.styles[j]=d[j]}}}})();(function(){CKEDITOR.focusManager=function(a){if(a.focusManager)return a.focusManager;this.hasFocus=false;this.currentActive=null;this._={editor:a};return this};CKEDITOR.focusManager._={blurDelay:200};CKEDITOR.focusManager.prototype={focus:function(a){this._.timer&&clearTimeout(this._.timer);if(a)this.currentActive=a;if(!this.hasFocus&&!this._.locked){(a=CKEDITOR.currentInstance)&&a.focusManager.blur(1);this.hasFocus=true;(a=this._.editor.container)&&a.addClass("cke_focus");this._.editor.fire("focus")}},lock:function(){this._.locked=1},unlock:function(){delete this._.locked},blur:function(a){function e(){if(this.hasFocus){this.hasFocus=false;var a=this._.editor.container;a&&a.removeClass("cke_focus");this._.editor.fire("blur")}}if(!this._.locked){this._.timer&&clearTimeout(this._.timer);var b=CKEDITOR.focusManager._.blurDelay;a||!b?e.call(this):this._.timer=CKEDITOR.tools.setTimeout(function(){delete this._.timer;e.call(this)},b,this)}},add:function(a,e){var b=a.getCustomData("focusmanager");if(!b||b!=this){b&&b.remove(a);var b="focus",c="blur";if(e)if(CKEDITOR.env.ie){b="focusin";c="focusout"}else CKEDITOR.event.useCapture=1;var f={blur:function(){a.equals(this.currentActive)&&this.blur()},focus:function(){this.focus(a)}};a.on(b,f.focus,this);a.on(c,f.blur,this);if(e)CKEDITOR.event.useCapture=0;a.setCustomData("focusmanager",this);a.setCustomData("focusmanager_handlers",f)}},remove:function(a){a.removeCustomData("focusmanager");var e=a.removeCustomData("focusmanager_handlers");a.removeListener("blur",e.blur);a.removeListener("focus",e.focus)}}})();CKEDITOR.keystrokeHandler=function(a){if(a.keystrokeHandler)return a.keystrokeHandler;this.keystrokes={};this.blockedKeystrokes={};this._={editor:a};return this};(function(){var a,e=function(b){var b=b.data,f=b.getKeystroke(),d=this.keystrokes[f],e=this._.editor;a=e.fire("key",{keyCode:f,domEvent:b})===false;if(!a){d&&(a=e.execCommand(d,{from:"keystrokeHandler"})!==false);a||(a=!!this.blockedKeystrokes[f])}a&&b.preventDefault(true);return!a},b=function(b){if(a){a=false;b.data.preventDefault(true)}};CKEDITOR.keystrokeHandler.prototype={attach:function(a){a.on("keydown",e,this);if(CKEDITOR.env.gecko&&CKEDITOR.env.mac)a.on("keypress",b,this)}}})();(function(){CKEDITOR.lang={languages:{af:1,ar:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,ms:1,nb:1,nl:1,no:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,"zh-cn":1,zh:1},rtl:{ar:1,fa:1,he:1,ku:1,ug:1},load:function(a,e,b){if(!a||!CKEDITOR.lang.languages[a])a=this.detect(e,a);var c=this,e=function(){c[a].dir=c.rtl[a]?"rtl":"ltr";b(a,c[a])};this[a]?e():CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("lang/"+a+".js"),e,this)},detect:function(a,e){var b=this.languages,e=e||navigator.userLanguage||navigator.language||a,c=e.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),f=c[1],c=c[2];b[f+"-"+c]?f=f+"-"+c:b[f]||(f=null);CKEDITOR.lang.detect=f?function(){return f}:function(a){return a};return f||a}}})();CKEDITOR.scriptLoader=function(){var a={},e={};return{load:function(b,c,f,d){var h=typeof b=="string";h&&(b=[b]);f||(f=CKEDITOR);var l=b.length,i=[],g=[],m=function(a){c&&(h?c.call(f,a):c.call(f,i,g))};if(l===0)m(true);else{var t=function(a,b){(b?i:g).push(a);if(--l<=0){d&&CKEDITOR.document.getDocumentElement().removeStyle("cursor");m(b)}},s=function(b,c){a[b]=1;var d=e[b];delete e[b];for(var f=0;f<d.length;f++)d[f](b,c)},y=function(b){if(a[b])t(b,true);else{var d=e[b]||(e[b]=[]);d.push(t);if(!(d.length>1)){var f=new CKEDITOR.dom.element("script");f.setAttributes({type:"text/javascript",src:b});if(c)if(CKEDITOR.env.ie&&CKEDITOR.env.version<11)f.$.onreadystatechange=function(){if(f.$.readyState=="loaded"||f.$.readyState=="complete"){f.$.onreadystatechange=null;s(b,true)}};else{f.$.onload=function(){setTimeout(function(){s(b,true)},0)};f.$.onerror=function(){s(b,false)}}f.appendTo(CKEDITOR.document.getHead())}}};d&&CKEDITOR.document.getDocumentElement().setStyle("cursor","wait");for(var p=0;p<l;p++)y(b[p])}},queue:function(){function a(){var b;(b=c[0])&&this.load(b.scriptUrl,b.callback,CKEDITOR,0)}var c=[];return function(f,d){var e=this;c.push({scriptUrl:f,callback:function(){d&&d.apply(this,arguments);c.shift();a.call(e)}});c.length==1&&a.call(this)}}()}}();CKEDITOR.resourceManager=function(a,e){this.basePath=a;this.fileName=e;this.registered={};this.loaded={};this.externals={};this._={waitingList:{}}};CKEDITOR.resourceManager.prototype={add:function(a,e){if(this.registered[a])throw'[CKEDITOR.resourceManager.add] The resource name "'+a+'" is already registered.';var b=this.registered[a]=e||{};b.name=a;b.path=this.getPath(a);CKEDITOR.fire(a+CKEDITOR.tools.capitalize(this.fileName)+"Ready",b);return this.get(a)},get:function(a){return this.registered[a]||null},getPath:function(a){var e=this.externals[a];return CKEDITOR.getUrl(e&&e.dir||this.basePath+a+"/")},getFilePath:function(a){var e=this.externals[a];return CKEDITOR.getUrl(this.getPath(a)+(e?e.file:this.fileName+".js"))},addExternal:function(a,e,b){for(var a=a.split(","),c=0;c<a.length;c++){var f=a[c];b||(e=e.replace(/[^\/]+$/,function(a){b=a;return""}));this.externals[f]={dir:e,file:b||this.fileName+".js"}}},load:function(a,e,b){CKEDITOR.tools.isArray(a)||(a=a?[a]:[]);for(var c=this.loaded,f=this.registered,d=[],h={},l={},i=0;i<a.length;i++){var g=a[i];if(g)if(!c[g]&&!f[g]){var m=this.getFilePath(g);d.push(m);m in h||(h[m]=[]);h[m].push(g)}else l[g]=this.get(g)}CKEDITOR.scriptLoader.load(d,function(a,d){if(d.length)throw'[CKEDITOR.resourceManager.load] Resource name "'+h[d[0]].join(",")+'" was not found at "'+d[0]+'".';for(var f=0;f<a.length;f++)for(var p=h[a[f]],g=0;g<p.length;g++){var j=p[g];l[j]=this.get(j);c[j]=1}e.call(b,l)},this)}};CKEDITOR.plugins=new CKEDITOR.resourceManager("plugins/","plugin");CKEDITOR.plugins.load=CKEDITOR.tools.override(CKEDITOR.plugins.load,function(a){var e={};return function(b,c,f){var d={},h=function(b){a.call(this,b,function(a){CKEDITOR.tools.extend(d,a);var b=[],m;for(m in a){var l=a[m],s=l&&l.requires;if(!e[m]){if(l.icons)for(var y=l.icons.split(","),p=y.length;p--;)CKEDITOR.skin.addIcon(y[p],l.path+"icons/"+(CKEDITOR.env.hidpi&&l.hidpi?"hidpi/":"")+y[p]+".png");e[m]=1}if(s){s.split&&(s=s.split(","));for(l=0;l<s.length;l++)d[s[l]]||b.push(s[l])}}if(b.length)h.call(this,b);else{for(m in d){l=d[m];if(l.onLoad&&!l.onLoad._called){l.onLoad()===false&&delete d[m];l.onLoad._called=1}}c&&c.call(f||window,d)}},this)};h.call(this,b)}});CKEDITOR.plugins.setLang=function(a,e,b){var c=this.get(a),a=c.langEntries||(c.langEntries={}),c=c.lang||(c.lang=[]);c.split&&(c=c.split(","));CKEDITOR.tools.indexOf(c,e)==-1&&c.push(e);a[e]=b};CKEDITOR.ui=function(a){if(a.ui)return a.ui;this.items={};this.instances={};this.editor=a;this._={handlers:{}};return this};CKEDITOR.ui.prototype={add:function(a,e,b){b.name=a.toLowerCase();var c=this.items[a]={type:e,command:b.command||null,args:Array.prototype.slice.call(arguments,2)};CKEDITOR.tools.extend(c,b)},get:function(a){return this.instances[a]},create:function(a){var e=this.items[a],b=e&&this._.handlers[e.type],c=e&&e.command&&this.editor.getCommand(e.command),b=b&&b.create.apply(this,e.args);this.instances[a]=b;c&&c.uiItems.push(b);if(b&&!b.type)b.type=e.type;return b},addHandler:function(a,e){this._.handlers[a]=e},space:function(a){return CKEDITOR.document.getById(this.spaceId(a))},spaceId:function(a){return this.editor.id+"_"+a}};CKEDITOR.event.implementOn(CKEDITOR.ui);(function(){function a(a,c,d){CKEDITOR.event.call(this);a=a&&CKEDITOR.tools.clone(a);if(c!==void 0){if(c instanceof CKEDITOR.dom.element){if(!d)throw Error("One of the element modes must be specified.");}else throw Error("Expect element of type CKEDITOR.dom.element.");if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&d==CKEDITOR.ELEMENT_MODE_INLINE)throw Error("Inline element mode is not supported on IE quirks.");if(!(d==CKEDITOR.ELEMENT_MODE_INLINE?c.is(CKEDITOR.dtd.$editable)||c.is("textarea"):d==CKEDITOR.ELEMENT_MODE_REPLACE?!c.is(CKEDITOR.dtd.$nonBodyContent):1))throw Error('The specified element mode is not supported on element: "'+c.getName()+'".');this.element=c;this.elementMode=d;this.name=this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO&&(c.getId()||c.getNameAtt())}else this.elementMode=CKEDITOR.ELEMENT_MODE_NONE;this._={};this.commands={};this.templates={};this.name=this.name||e();this.id=CKEDITOR.tools.getNextId();this.status="unloaded";this.config=CKEDITOR.tools.prototypedCopy(CKEDITOR.config);this.ui=new CKEDITOR.ui(this);this.focusManager=new CKEDITOR.focusManager(this);this.keystrokeHandler=new CKEDITOR.keystrokeHandler(this);this.on("readOnly",b);this.on("selectionChange",function(a){f(this,a.data.path)});this.on("activeFilterChange",function(){f(this,this.elementPath(),true)});this.on("mode",b);this.on("instanceReady",function(){this.config.startupFocus&&this.focus()});CKEDITOR.fire("instanceCreated",null,this);CKEDITOR.add(this);CKEDITOR.tools.setTimeout(function(){h(this,a)},0,this)}function e(){do var a="editor"+
++s;while(CKEDITOR.instances[a]);return a}function b(){var a=this.commands,b;for(b in a)c(this,a[b])}function c(a,b){b[b.startDisabled?"disable":a.readOnly&&!b.readOnly?"disable":b.modes[a.mode]?"enable":"disable"]()}function f(a,b,c){if(b){var d,f,e=a.commands;for(f in e){d=e[f];(c||d.contextSensitive)&&d.refresh(a,b)}}}function d(a){var b=a.config.customConfig;if(!b)return false;var b=CKEDITOR.getUrl(b),c=y[b]||(y[b]={});if(c.fn){c.fn.call(a,a.config);(CKEDITOR.getUrl(a.config.customConfig)==b||!d(a))&&a.fireOnce("customConfigLoaded")}else CKEDITOR.scriptLoader.queue(b,function(){c.fn=CKEDITOR.editorConfig?CKEDITOR.editorConfig:function(){};d(a)});return true}function h(a,b){a.on("customConfigLoaded",function(){if(b){if(b.on)for(var c in b.on)a.on(c,b.on[c]);CKEDITOR.tools.extend(a.config,b,true);delete a.config.on}c=a.config;a.readOnly=!(!c.readOnly&&!(a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.element.is("textarea")?a.element.hasAttribute("disabled"):a.element.isReadOnly():a.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&a.element.hasAttribute("disabled")));a.blockless=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?!(a.element.is("textarea")||CKEDITOR.dtd[a.element.getName()].p):false;a.tabIndex=c.tabIndex||a.element&&a.element.getAttribute("tabindex")||0;a.activeEnterMode=a.enterMode=a.blockless?CKEDITOR.ENTER_BR:c.enterMode;a.activeShiftEnterMode=a.shiftEnterMode=a.blockless?CKEDITOR.ENTER_BR:c.shiftEnterMode;if(c.skin)CKEDITOR.skinName=c.skin;a.fireOnce("configLoaded");a.dataProcessor=new CKEDITOR.htmlDataProcessor(a);a.filter=a.activeFilter=new CKEDITOR.filter(a);l(a)});if(b&&b.customConfig!=null)a.config.customConfig=b.customConfig;d(a)||a.fireOnce("customConfigLoaded")}function l(a){CKEDITOR.skin.loadPart("editor",function(){i(a)})}function i(a){CKEDITOR.lang.load(a.config.language,a.config.defaultLanguage,function(b,c){var d=a.config.title;a.langCode=b;a.lang=CKEDITOR.tools.prototypedCopy(c);a.title=typeof d=="string"||d===false?d:[a.lang.editor,a.name].join(", ");if(!a.config.contentsLangDirection)a.config.contentsLangDirection=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.element.getDirection(1):a.lang.dir;a.fire("langLoaded");g(a)})}function g(a){a.getStylesSet(function(b){a.once("loaded",function(){a.fire("stylesSet",{styles:b})},null,null,1);m(a)})}function m(a){var b=a.config,c=b.plugins,d=b.extraPlugins,f=b.removePlugins;if(d)var e=RegExp("(?:^|,)(?:"+d.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),c=c.replace(e,""),c=c+(","+d);if(f)var k=RegExp("(?:^|,)(?:"+f.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),c=c.replace(k,"");CKEDITOR.env.air&&(c=c+",adobeair");CKEDITOR.plugins.load(c.split(","),function(c){var d=[],f=[],e=[];a.plugins=c;for(var j in c){var h=c[j],g=h.lang,i=null,u=h.requires,w;CKEDITOR.tools.isArray(u)&&(u=u.join(","));if(u&&(w=u.match(k)))for(;u=w.pop();)CKEDITOR.tools.setTimeout(function(a,b){throw Error('Plugin "'+a.replace(",","")+'" cannot be removed from the plugins list, because it\'s required by "'+b+'" plugin.');},0,null,[u,j]);if(g&&!a.lang[j]){g.split&&(g=g.split(","));if(CKEDITOR.tools.indexOf(g,a.langCode)>=0)i=a.langCode;else{i=a.langCode.replace(/-.*/,"");i=i!=a.langCode&&CKEDITOR.tools.indexOf(g,i)>=0?i:CKEDITOR.tools.indexOf(g,"en")>=0?"en":g[0]}if(!h.langEntries||!h.langEntries[i])e.push(CKEDITOR.getUrl(h.path+"lang/"+i+".js"));else{a.lang[j]=h.langEntries[i];i=null}}f.push(i);d.push(h)}CKEDITOR.scriptLoader.load(e,function(){for(var c=["beforeInit","init","afterInit"],e=0;e<c.length;e++)for(var n=0;n<d.length;n++){var j=d[n];e===0&&(f[n]&&j.lang&&j.langEntries)&&(a.lang[j.name]=j.langEntries[f[n]]);if(j[c[e]])j[c[e]](a)}a.fireOnce("pluginsLoaded");b.keystrokes&&a.setKeystroke(a.config.keystrokes);for(n=0;n<a.config.blockedKeystrokes.length;n++)a.keystrokeHandler.blockedKeystrokes[a.config.blockedKeystrokes[n]]=1;a.status="loaded";a.fireOnce("loaded");CKEDITOR.fire("instanceLoaded",null,a)})})}function t(){var a=this.element;if(a&&this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO){var b=this.getData();this.config.htmlEncodeOutput&&(b=CKEDITOR.tools.htmlEncode(b));a.is("textarea")?a.setValue(b):a.setHtml(b);return true}return false}a.prototype=CKEDITOR.editor.prototype;CKEDITOR.editor=a;var s=0,y={};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{addCommand:function(a,b){b.name=a.toLowerCase();var d=new CKEDITOR.command(this,b);this.mode&&c(this,d);return this.commands[a]=d},_attachToForm:function(){function a(d){b.updateElement();b._.required&&(!c.getValue()&&b.fire("required")===false)&&d.data.preventDefault()}var b=this,c=b.element,d=new CKEDITOR.dom.element(c.$.form);if(c.is("textarea")&&d){d.on("submit",a);if(d.$.submit&&d.$.submit.call&&d.$.submit.apply)d.$.submit=CKEDITOR.tools.override(d.$.submit,function(b){return function(){a();b.apply?b.apply(this):b()}});b.on("destroy",function(){d.removeListener("submit",a)})}},destroy:function(a){this.fire("beforeDestroy");!a&&t.call(this);this.editable(null);this.filter.destroy();delete this.filter;delete this.activeFilter;this.status="destroyed";this.fire("destroy");this.removeAllListeners();CKEDITOR.remove(this);CKEDITOR.fire("instanceDestroyed",null,this)},elementPath:function(a){if(!a){a=this.getSelection();if(!a)return null;a=a.getStartElement()}return a?new CKEDITOR.dom.elementPath(a,this.editable()):null},createRange:function(){var a=this.editable();return a?new CKEDITOR.dom.range(a):null},execCommand:function(a,b){var c=this.getCommand(a),d={name:a,commandData:b,command:c};if(c&&c.state!=CKEDITOR.TRISTATE_DISABLED&&this.fire("beforeCommandExec",d)!==false){d.returnValue=c.exec(d.commandData);if(!c.async&&this.fire("afterCommandExec",d)!==false)return d.returnValue}return false},getCommand:function(a){return this.commands[a]},getData:function(a){!a&&this.fire("beforeGetData");var b=this._.data;if(typeof b!="string")b=(b=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?b.is("textarea")?b.getValue():b.getHtml():"";b={dataValue:b};!a&&this.fire("getData",b);return b.dataValue},getSnapshot:function(){var a=this.fire("getSnapshot");if(typeof a!="string"){var b=this.element;b&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(a=b.is("textarea")?b.getValue():b.getHtml())}return a},loadSnapshot:function(a){this.fire("loadSnapshot",a)},setData:function(a,b,c){var d=true,f=b;if(b&&typeof b=="object"){c=b.internal;f=b.callback;d=!b.noSnapshot}!c&&d&&this.fire("saveSnapshot");if(f||!c)this.once("dataReady",function(a){!c&&d&&this.fire("saveSnapshot");f&&f.call(a.editor)});a={dataValue:a};!c&&this.fire("setData",a);this._.data=a.dataValue;!c&&this.fire("afterSetData",a)},setReadOnly:function(a){a=a==null||a;if(this.readOnly!=a){this.readOnly=a;this.keystrokeHandler.blockedKeystrokes[8]=+a;this.editable().setReadOnly(a);this.fire("readOnly")}},insertHtml:function(a,b){this.fire("insertHtml",{dataValue:a,mode:b})},insertText:function(a){this.fire("insertText",a)},insertElement:function(a){this.fire("insertElement",a)},focus:function(){this.fire("beforeFocus")},checkDirty:function(){return this.status=="ready"&&this._.previousValue!==this.getSnapshot()},resetDirty:function(){this._.previousValue=this.getSnapshot()},updateElement:function(){return t.call(this)},setKeystroke:function(){for(var a=this.keystrokeHandler.keystrokes,b=CKEDITOR.tools.isArray(arguments[0])?arguments[0]:[[].slice.call(arguments,0)],c,d,f=b.length;f--;){c=b[f];d=0;if(CKEDITOR.tools.isArray(c)){d=c[1];c=c[0]}d?a[c]=d:delete a[c]}},addFeature:function(a){return this.filter.addFeature(a)},setActiveFilter:function(a){if(!a)a=this.filter;if(this.activeFilter!==a){this.activeFilter=a;this.fire("activeFilterChange");a===this.filter?this.setActiveEnterMode(null,null):this.setActiveEnterMode(a.getAllowedEnterMode(this.enterMode),a.getAllowedEnterMode(this.shiftEnterMode,true))}},setActiveEnterMode:function(a,b){a=a?this.blockless?CKEDITOR.ENTER_BR:a:this.enterMode;b=b?this.blockless?CKEDITOR.ENTER_BR:b:this.shiftEnterMode;if(this.activeEnterMode!=a||this.activeShiftEnterMode!=b){this.activeEnterMode=a;this.activeShiftEnterMode=b;this.fire("activeEnterModeChange")}}})})();CKEDITOR.ELEMENT_MODE_NONE=0;CKEDITOR.ELEMENT_MODE_REPLACE=1;CKEDITOR.ELEMENT_MODE_APPENDTO=2;CKEDITOR.ELEMENT_MODE_INLINE=3;CKEDITOR.htmlParser=function(){this._={htmlPartsRegex:/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)--\>)|(?:([^\/\s>]+)((?:\s+[\w\-:.]+(?:\s*=\s*?(?:(?:"[^"]*")|(?:'[^']*')|[^\s"'\/>]+))?)*)[\S\s]*?(\/?)>))/g}};(function(){var a=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,e={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};CKEDITOR.htmlParser.prototype={onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(b){for(var c,f,d=0,h;c=this._.htmlPartsRegex.exec(b);){f=c.index;if(f>d){d=b.substring(d,f);if(h)h.push(d);else this.onText(d)}d=this._.htmlPartsRegex.lastIndex;if(f=c[1]){f=f.toLowerCase();if(h&&CKEDITOR.dtd.$cdata[f]){this.onCDATA(h.join(""));h=null}if(!h){this.onTagClose(f);continue}}if(h)h.push(c[0]);else if(f=c[3]){f=f.toLowerCase();if(!/="/.test(f)){var l={},i,g=c[4];c=!!c[5];if(g)for(;i=a.exec(g);){var m=i[1].toLowerCase();i=i[2]||i[3]||i[4]||"";l[m]=!i&&e[m]?m:CKEDITOR.tools.htmlDecodeAttr(i)}this.onTagOpen(f,l,c);!h&&CKEDITOR.dtd.$cdata[f]&&(h=[])}}else if(f=c[2])this.onComment(f)}if(b.length>d)this.onText(b.substring(d,b.length))}}})();CKEDITOR.htmlParser.basicWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[]}},proto:{openTag:function(a){this._.output.push("<",a)},openTagClose:function(a,e){e?this._.output.push(" />"):this._.output.push(">")},attribute:function(a,e){typeof e=="string"&&(e=CKEDITOR.tools.htmlEncodeAttr(e));this._.output.push(" ",a,'="',e,'"')},closeTag:function(a){this._.output.push("</",a,">")},text:function(a){this._.output.push(a)},comment:function(a){this._.output.push("<\!--",a,"--\>")},write:function(a){this._.output.push(a)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(a){var e=this._.output.join("");a&&this.reset();return e}}});"use strict";(function(){CKEDITOR.htmlParser.node=function(){};CKEDITOR.htmlParser.node.prototype={remove:function(){var a=this.parent.children,e=CKEDITOR.tools.indexOf(a,this),b=this.previous,c=this.next;b&&(b.next=c);c&&(c.previous=b);a.splice(e,1);this.parent=null},replaceWith:function(a){var e=this.parent.children,b=CKEDITOR.tools.indexOf(e,this),c=a.previous=this.previous,f=a.next=this.next;c&&(c.next=a);f&&(f.previous=a);e[b]=a;a.parent=this.parent;this.parent=null},insertAfter:function(a){var e=a.parent.children,b=CKEDITOR.tools.indexOf(e,a),c=a.next;e.splice(b+1,0,this);this.next=a.next;this.previous=a;a.next=this;c&&(c.previous=this);this.parent=a.parent},insertBefore:function(a){var e=a.parent.children,b=CKEDITOR.tools.indexOf(e,a);e.splice(b,0,this);this.next=a;(this.previous=a.previous)&&(a.previous.next=this);a.previous=this;this.parent=a.parent},getAscendant:function(a){var e=typeof a=="function"?a:typeof a=="string"?function(b){return b.name==a}:function(b){return b.name in a},b=this.parent;for(;b&&b.type==CKEDITOR.NODE_ELEMENT;){if(e(b))return b;b=b.parent}return null},wrapWith:function(a){this.replaceWith(a);a.add(this);return a},getIndex:function(){return CKEDITOR.tools.indexOf(this.parent.children,this)},getFilterContext:function(a){return a||{}}}})();"use strict";CKEDITOR.htmlParser.comment=function(a){this.value=a;this._={isBlockLike:false}};CKEDITOR.htmlParser.comment.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_COMMENT,filter:function(a,e){var b=this.value;if(!(b=a.onComment(e,b,this))){this.remove();return false}if(typeof b!="string"){this.replaceWith(b);return false}this.value=b;return true},writeHtml:function(a,e){e&&this.filter(e);a.comment(this.value)}});"use strict";(function(){CKEDITOR.htmlParser.text=function(a){this.value=a;this._={isBlockLike:false}};CKEDITOR.htmlParser.text.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(a,e){if(!(this.value=a.onText(e,this.value,this))){this.remove();return false}},writeHtml:function(a,e){e&&this.filter(e);a.text(this.value)}})})();"use strict";(function(){CKEDITOR.htmlParser.cdata=function(a){this.value=a};CKEDITOR.htmlParser.cdata.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(){},writeHtml:function(a){a.write(this.value)}})})();"use strict";CKEDITOR.htmlParser.fragment=function(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false}};(function(){function a(a){return a.attributes["data-cke-survive"]?false:a.name=="a"&&a.attributes.href||CKEDITOR.dtd.$removeEmpty[a.name]}var e=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),b={ol:1,ul:1},c=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1}),f={ul:"li",ol:"li",dl:"dd",table:"tbody",tbody:"tr",thead:"tr",tfoot:"tr",tr:"td"};CKEDITOR.htmlParser.fragment.fromHtml=function(d,h,l){function i(a){var b;if(j.length>0)for(var c=0;c<j.length;c++){var d=j[c],f=d.name,e=CKEDITOR.dtd[f],k=v.name&&CKEDITOR.dtd[v.name];if((!k||k[f])&&(!a||!e||e[a]||!CKEDITOR.dtd[a])){if(!b){g();b=1}d=d.clone();d.parent=v;v=d;j.splice(c,1);c--}else if(f==v.name){t(v,v.parent,1);c--}}}function g(){for(;u.length;)t(u.shift(),v)}function m(a){if(a._.isBlockLike&&a.name!="pre"&&a.name!="textarea"){var b=a.children.length,c=a.children[b-1],d;if(c&&c.type==CKEDITOR.NODE_TEXT)(d=CKEDITOR.tools.rtrim(c.value))?c.value=d:a.children.length=b-1}}function t(b,c,d){var c=c||v||q,f=v;if(b.previous===void 0){if(s(c,b)){v=c;p.onTagOpen(l,{});b.returnPoint=c=v}m(b);(!a(b)||b.children.length)&&c.add(b);b.name=="pre"&&(k=false);b.name=="textarea"&&(E=false)}if(b.returnPoint){v=b.returnPoint;delete b.returnPoint}else v=d?c:f}function s(a,b){if((a==q||a.name=="body")&&l&&(!a.name||CKEDITOR.dtd[a.name][l])){var c,d;return(c=b.attributes&&(d=b.attributes["data-cke-real-element-type"])?d:b.name)&&c in CKEDITOR.dtd.$inline&&!(c in CKEDITOR.dtd.head)&&!b.isOrphan||b.type==CKEDITOR.NODE_TEXT}}function y(a,b){return a in CKEDITOR.dtd.$listItem||a in CKEDITOR.dtd.$tableContent?a==b||a=="dt"&&b=="dd"||a=="dd"&&b=="dt":false}var p=new CKEDITOR.htmlParser,q=h instanceof CKEDITOR.htmlParser.element?h:typeof h=="string"?new CKEDITOR.htmlParser.element(h):new CKEDITOR.htmlParser.fragment,j=[],u=[],v=q,E=q.name=="textarea",k=q.name=="pre";p.onTagOpen=function(d,f,h,l){f=new CKEDITOR.htmlParser.element(d,f);if(f.isUnknown&&h)f.isEmpty=true;f.isOptionalClose=l;if(a(f))j.push(f);else{if(d=="pre")k=true;else{if(d=="br"&&k){v.add(new CKEDITOR.htmlParser.text("\n"));return}d=="textarea"&&(E=true)}if(d=="br")u.push(f);else{for(;;){l=(h=v.name)?CKEDITOR.dtd[h]||(v._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):c;if(!f.isUnknown&&!v.isUnknown&&!l[d])if(v.isOptionalClose)p.onTagClose(h);else if(d in b&&h in b){h=v.children;(h=h[h.length-1])&&h.name=="li"||t(h=new CKEDITOR.htmlParser.element("li"),v);!f.returnPoint&&(f.returnPoint=v);v=h}else if(d in CKEDITOR.dtd.$listItem&&!y(d,h))p.onTagOpen(d=="li"?"ul":"dl",{},0,1);else if(h in e&&!y(d,h)){!f.returnPoint&&(f.returnPoint=v);v=v.parent}else{h in CKEDITOR.dtd.$inline&&j.unshift(v);if(v.parent)t(v,v.parent,1);else{f.isOrphan=1;break}}else break}i(d);g();f.parent=v;f.isEmpty?t(f):v=f}}};p.onTagClose=function(a){for(var b=j.length-1;b>=0;b--)if(a==j[b].name){j.splice(b,1);return}for(var c=[],d=[],f=v;f!=q&&f.name!=a;){f._.isBlockLike||d.unshift(f);c.push(f);f=f.returnPoint||f.parent}if(f!=q){for(b=0;b<c.length;b++){var e=c[b];t(e,e.parent)}v=f;f._.isBlockLike&&g();t(f,f.parent);if(f==v)v=v.parent;j=j.concat(d)}a=="body"&&(l=false)};p.onText=function(a){if((!v._.hasInlineStarted||u.length)&&!k&&!E){a=CKEDITOR.tools.ltrim(a);if(a.length===0)return}var b=v.name,d=b?CKEDITOR.dtd[b]||(v._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):c;if(!E&&!d["#"]&&b in e){p.onTagOpen(f[b]||"");p.onText(a)}else{g();i();!k&&!E&&(a=a.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));a=new CKEDITOR.htmlParser.text(a);if(s(v,a))this.onTagOpen(l,{},0,1);v.add(a)}};p.onCDATA=function(a){v.add(new CKEDITOR.htmlParser.cdata(a))};p.onComment=function(a){g();i();v.add(new CKEDITOR.htmlParser.comment(a))};p.parse(d);for(g();v!=q;)t(v,v.parent,1);m(q);return q};CKEDITOR.htmlParser.fragment.prototype={type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,add:function(a,b){isNaN(b)&&(b=this.children.length);var c=b>0?this.children[b-1]:null;if(c){if(a._.isBlockLike&&c.type==CKEDITOR.NODE_TEXT){c.value=CKEDITOR.tools.rtrim(c.value);if(c.value.length===0){this.children.pop();this.add(a);return}}c.next=a}a.previous=c;a.parent=this;this.children.splice(b,0,a);if(!this._.hasInlineStarted)this._.hasInlineStarted=a.type==CKEDITOR.NODE_TEXT||a.type==CKEDITOR.NODE_ELEMENT&&!a._.isBlockLike},filter:function(a,b){b=this.getFilterContext(b);a.onRoot(b,this);this.filterChildren(a,false,b)},filterChildren:function(a,b,c){if(this.childrenFilteredBy!=a.id){c=this.getFilterContext(c);if(b&&!this.parent)a.onRoot(c,this);this.childrenFilteredBy=a.id;for(b=0;b<this.children.length;b++)this.children[b].filter(a,c)===false&&b--}},writeHtml:function(a,b){b&&this.filter(b);this.writeChildrenHtml(a)},writeChildrenHtml:function(a,b,c){var f=this.getFilterContext();if(c&&!this.parent&&b)b.onRoot(f,this);b&&this.filterChildren(b,false,f);b=0;c=this.children;for(f=c.length;b<f;b++)c[b].writeHtml(a)},forEach:function(a,b,c){if(!c&&(!b||this.type==b))var f=a(this);if(f!==false)for(var c=this.children,e=0;e<c.length;e++){f=c[e];f.type==CKEDITOR.NODE_ELEMENT?f.forEach(a,b):(!b||f.type==b)&&a(f)}},getFilterContext:function(a){return a||{}}}})();"use strict";(function(){function a(){this.rules=[]}function e(b,c,f,d){var e,l;for(e in c){(l=b[e])||(l=b[e]=new a);l.add(c[e],f,d)}}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(b){this.id=CKEDITOR.tools.getNextNumber();this.elementNameRules=new a;this.attributeNameRules=new a;this.elementsRules={};this.attributesRules={};this.textRules=new a;this.commentRules=new a;this.rootRules=new a;b&&this.addRules(b,10)},proto:{addRules:function(a,c){var f;if(typeof c=="number")f=c;else if(c&&"priority"in
c)f=c.priority;typeof f!="number"&&(f=10);typeof c!="object"&&(c={});a.elementNames&&this.elementNameRules.addMany(a.elementNames,f,c);a.attributeNames&&this.attributeNameRules.addMany(a.attributeNames,f,c);a.elements&&e(this.elementsRules,a.elements,f,c);a.attributes&&e(this.attributesRules,a.attributes,f,c);a.text&&this.textRules.add(a.text,f,c);a.comment&&this.commentRules.add(a.comment,f,c);a.root&&this.rootRules.add(a.root,f,c)},applyTo:function(a){a.filter(this)},onElementName:function(a,c){return this.elementNameRules.execOnName(a,c)},onAttributeName:function(a,c){return this.attributeNameRules.execOnName(a,c)},onText:function(a,c,f){return this.textRules.exec(a,c,f)},onComment:function(a,c,f){return this.commentRules.exec(a,c,f)},onRoot:function(a,c){return this.rootRules.exec(a,c)},onElement:function(a,c){for(var f=[this.elementsRules["^"],this.elementsRules[c.name],this.elementsRules.$],d,e=0;e<3;e++)if(d=f[e]){d=d.exec(a,c,this);if(d===false)return null;if(d&&d!=c)return this.onNode(a,d);if(c.parent&&!c.name)break}return c},onNode:function(a,c){var f=c.type;return f==CKEDITOR.NODE_ELEMENT?this.onElement(a,c):f==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(a,c.value)):f==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(a,c.value)):null},onAttribute:function(a,c,f,d){return(f=this.attributesRules[f])?f.exec(a,d,c,this):d}}});CKEDITOR.htmlParser.filterRulesGroup=a;a.prototype={add:function(a,c,f){this.rules.splice(this.findIndex(c),0,{value:a,priority:c,options:f})},addMany:function(a,c,f){for(var d=[this.findIndex(c),0],e=0,l=a.length;e<l;e++)d.push({value:a[e],priority:c,options:f});this.rules.splice.apply(this.rules,d)},findIndex:function(a){for(var c=this.rules,f=c.length-1;f>=0&&a<c[f].priority;)f--;return f+1},exec:function(a,c){var f=c instanceof CKEDITOR.htmlParser.node||c instanceof CKEDITOR.htmlParser.fragment,d=Array.prototype.slice.call(arguments,1),e=this.rules,l=e.length,i,g,m,t;for(t=0;t<l;t++){if(f){i=c.type;g=c.name}m=e[t];if(!(a.nonEditable&&!m.options.applyToAll||a.nestedEditable&&m.options.excludeNestedEditable)){m=m.value.apply(null,d);if(m===false||f&&m&&(m.name!=g||m.type!=i))return m;m!=null&&(d[0]=c=m)}}return c},execOnName:function(a,c){for(var f=0,d=this.rules,e=d.length,l;c&&f<e;f++){l=d[f];!(a.nonEditable&&!l.options.applyToAll||a.nestedEditable&&l.options.excludeNestedEditable)&&(c=c.replace(l.value[0],l.value[1]))}return c}}})();(function(){function a(a,e){function n(a){return a||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text(" "):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function r(a,f){return function(e){if(e.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var j=[],k=b(e),x,r;if(k)for(w(k,1)&&j.push(k);k;){if(d(k)&&(x=c(k))&&w(x))if((r=c(x))&&!d(r))j.push(x);else{n(o).insertAfter(x);x.remove()}k=k.previous}for(k=0;k<j.length;k++)j[k].remove();if(j=(typeof f=="function"?f(e):f)!==false)if(!o&&!CKEDITOR.env.needsBrFiller&&e.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)j=false;else if(!o&&!CKEDITOR.env.needsBrFiller&&(document.documentMode>7||e.name in CKEDITOR.dtd.tr||e.name in CKEDITOR.dtd.$listItem))j=false;else{j=b(e);j=!j||e.name=="form"&&j.name=="input"}j&&e.add(n(a))}}}function w(a,b){if((!o||CKEDITOR.env.needsBrFiller)&&a.type==CKEDITOR.NODE_ELEMENT&&a.name=="br"&&!a.attributes["data-cke-eol"])return true;var c;if(a.type==CKEDITOR.NODE_TEXT&&(c=a.value.match(j))){if(c.index){(new CKEDITOR.htmlParser.text(a.value.substring(0,c.index))).insertBefore(a);a.value=c[0]}if(!CKEDITOR.env.needsBrFiller&&o&&(!b||a.parent.name in i))return true;if(!o)if((c=a.previous)&&c.name=="br"||!c||d(c))return true}return false}var g={elements:{}},o=e=="html",i=CKEDITOR.tools.extend({},k),C;for(C in i)"#"in v[C]||delete i[C];for(C in i)g.elements[C]=r(o,a.config.fillEmptyBlocks);g.root=r(o,false);g.elements.br=function(a){return function(b){if(b.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var e=b.attributes;if("data-cke-bogus"in e||"data-cke-eol"in
e)delete e["data-cke-bogus"];else{for(e=b.next;e&&f(e);)e=e.next;var j=c(b);!e&&d(b.parent)?h(b.parent,n(a)):d(e)&&(j&&!d(j))&&n(a).insertBefore(e)}}}}(o);return g}function e(a,b){return a!=CKEDITOR.ENTER_BR&&b!==false?a==CKEDITOR.ENTER_DIV?"div":"p":false}function b(a){for(a=a.children[a.children.length-1];a&&f(a);)a=a.previous;return a}function c(a){for(a=a.previous;a&&f(a);)a=a.previous;return a}function f(a){return a.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(a.value)||a.type==CKEDITOR.NODE_ELEMENT&&a.attributes["data-cke-bookmark"]}function d(a){return a&&(a.type==CKEDITOR.NODE_ELEMENT&&a.name in k||a.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function h(a,b){var c=a.children[a.children.length-1];a.children.push(b);b.parent=a;if(c){c.next=b;b.previous=c}}function l(a){a=a.attributes;a.contenteditable!="false"&&(a["data-cke-editable"]=a.contenteditable?"true":1);a.contenteditable="false"}function i(a){a=a.attributes;switch(a["data-cke-editable"]){case"true":a.contenteditable="true";break;case"1":delete a.contenteditable}}
function g(a){return a.replace(D,function(a,b,c){return"<"+b+c.replace(J,function(a,b){return z.test(b)&&c.indexOf("data-cke-saved-"+b)==-1?" data-cke-saved-"+a+" data-cke-"+CKEDITOR.rnd+"-"+a:a})+">"})}function m(a,b){return a.replace(b,function(a,b,c){a.indexOf("<textarea")===0&&(a=b+y(c).replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>");return"<cke:encoded>"+encodeURIComponent(a)+"</cke:encoded>"})}function t(a){return a.replace(w,function(a,b){return decodeURIComponent(b)})}function s(a){return a.replace(/<\!--(?!{cke_protected})[\s\S]+?--\>/g,function(a){return"<\!--"+u+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function y(a){return a.replace(/<\!--\{cke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}function p(a,b){var c=b._.dataStore;return a.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)}).replace(/\{cke_protected_(\d+)\}/g,function(a,b){return c&&c[b]||""})}function q(a,b){for(var c=[],d=b.config.protectedSource,f=b._.dataStore||(b._.dataStore={id:1}),e=/<\!--\{cke_temp(comment)?\}(\d*?)--\>/g,d=[/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<meta[\s\S]*?\/?>/gi].concat(d),a=a.replace(/<\!--[\s\S]*?--\>/g,function(a){return"<\!--{cke_tempcomment}"+(c.push(a)-1)+"--\>"}),j=0;j<d.length;j++)a=a.replace(d[j],function(a){a=a.replace(e,function(a,b,d){return c[d]});return/cke_temp(comment)?/.test(a)?a:"<\!--{cke_temp}"+(c.push(a)-1)+"--\>"});a=a.replace(e,function(a,b,d){return"<\!--"+u+(b?"{C}":"")+encodeURIComponent(c[d]).replace(/--/g,"%2D%2D")+"--\>"});a=a.replace(/<\w+(?:\s+(?:(?:[^\s=>]+\s*=\s*(?:[^'"\s>]+|'[^']*'|"[^"]*"))|[^\s=>]+))+\s*>/g,function(a){return a.replace(/<\!--\{cke_protected\}([^>]*)--\>/g,function(a,b){f[f.id]=decodeURIComponent(b);return"{cke_protected_"+f.id++ +"}"})});return a=a.replace(/<(title|iframe|textarea)([^>]*)>([\s\S]*?)<\/\1>/g,function(a,c,d,f){return"<"+c+d+">"+p(y(f),b)+"</"+c+">"})}CKEDITOR.htmlDataProcessor=function(b){var c,d,f=this;this.editor=b;this.dataFilter=c=new CKEDITOR.htmlParser.filter;this.htmlFilter=d=new CKEDITOR.htmlParser.filter;this.writer=new CKEDITOR.htmlParser.basicWriter;c.addRules(n);c.addRules(r,{applyToAll:true});c.addRules(a(b,"data"),{applyToAll:true});d.addRules(o);d.addRules(M,{applyToAll:true});d.addRules(a(b,"html"),{applyToAll:true});b.on("toHtml",function(a){var a=a.data,c=a.dataValue,d,c=q(c,b),c=m(c,B),c=g(c),c=m(c,L),c=c.replace(H,"$1cke:$2"),c=c.replace(A,"<cke:$1$2></cke:$1>"),c=c.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),c=c.replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,"$1data-cke-"+CKEDITOR.rnd+"-$2");d=a.context||b.editable().getName();var f;if(CKEDITOR.env.ie&&CKEDITOR.env.version<9&&d=="pre"){d="div";c="<pre>"+c+"</pre>";f=1}d=b.document.createElement(d);d.setHtml("a"+c);c=d.getHtml().substr(1);c=c.replace(RegExp("data-cke-"+CKEDITOR.rnd+"-","ig"),"");f&&(c=c.replace(/^<pre>|<\/pre>$/gi,""));c=c.replace(C,"$1$2");c=t(c);c=y(c);d=a.fixForBody===false?false:e(a.enterMode,b.config.autoParagraph);c=CKEDITOR.htmlParser.fragment.fromHtml(c,a.context,d);if(d){f=c;if(!f.children.length&&CKEDITOR.dtd[f.name][d]){d=new CKEDITOR.htmlParser.element(d);f.add(d)}}a.dataValue=c},null,null,5);b.on("toHtml",function(a){a.data.filter.applyTo(a.data.dataValue,true,a.data.dontFilter,a.data.enterMode)&&b.fire("dataFiltered")},null,null,6);b.on("toHtml",function(a){a.data.dataValue.filterChildren(f.dataFilter,true)},null,null,10);b.on("toHtml",function(a){var a=a.data,b=a.dataValue,c=new CKEDITOR.htmlParser.basicWriter;b.writeChildrenHtml(c);b=c.getHtml(true);a.dataValue=s(b)},null,null,15);b.on("toDataFormat",function(a){var c=a.data.dataValue;a.data.enterMode!=CKEDITOR.ENTER_BR&&(c=c.replace(/^<br *\/?>/i,""));a.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(c,a.data.context,e(a.data.enterMode,b.config.autoParagraph))},null,null,5);b.on("toDataFormat",function(a){a.data.dataValue.filterChildren(f.htmlFilter,true)},null,null,10);b.on("toDataFormat",function(a){a.data.filter.applyTo(a.data.dataValue,false,true)},null,null,11);b.on("toDataFormat",function(a){var c=a.data.dataValue,d=f.writer;d.reset();c.writeChildrenHtml(d);c=d.getHtml(true);c=y(c);c=p(c,b);a.data.dataValue=c},null,null,15)};CKEDITOR.htmlDataProcessor.prototype={toHtml:function(a,b,c,d){var f=this.editor,e,j,k;if(b&&typeof b=="object"){e=b.context;c=b.fixForBody;d=b.dontFilter;j=b.filter;k=b.enterMode}else e=b;!e&&e!==null&&(e=f.editable().getName());return f.fire("toHtml",{dataValue:a,context:e,fixForBody:c,dontFilter:d,filter:j||f.filter,enterMode:k||f.enterMode}).dataValue},toDataFormat:function(a,b){var c,d,f;if(b){c=b.context;d=b.filter;f=b.enterMode}!c&&c!==null&&(c=this.editor.editable().getName());return this.editor.fire("toDataFormat",{dataValue:a,filter:d||this.editor.filter,context:c,enterMode:f||this.editor.enterMode}).dataValue}};var j=/(?:&nbsp;|\xa0)$/,u="{cke_protected}",v=CKEDITOR.dtd,E=["caption","colgroup","col","thead","tfoot","tbody"],k=CKEDITOR.tools.extend({},v.$blockLimit,v.$block),n={elements:{input:l,textarea:l}},r={attributeNames:[[/^on/,"data-cke-pa-on"],[/^data-cke-expando$/,""]]},o={elements:{embed:function(a){var b=a.parent;if(b&&b.name=="object"){var c=b.attributes.width,b=b.attributes.height;if(c)a.attributes.width=c;if(b)a.attributes.height=b}},a:function(a){if(!a.children.length&&!a.attributes.name&&!a.attributes["data-cke-saved-name"])return false}}},M={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(a){var b=a.attributes;if(b){if(b["data-cke-temp"])return false;for(var c=["name","href","src"],d,f=0;f<c.length;f++){d="data-cke-saved-"+c[f];d in b&&delete b[c[f]]}}return a},table:function(a){a.children.slice(0).sort(function(a,b){var c,d;if(a.type==CKEDITOR.NODE_ELEMENT&&b.type==a.type){c=CKEDITOR.tools.indexOf(E,a.name);d=CKEDITOR.tools.indexOf(E,b.name)}if(!(c>-1&&d>-1&&c!=d)){c=a.parent?a.getIndex():-1;d=b.parent?b.getIndex():-1}return c>d?1:-1})},param:function(a){a.children=[];a.isEmpty=true;return a},span:function(a){a.attributes["class"]=="Apple-style-span"&&delete a.name},html:function(a){delete a.attributes.contenteditable;delete a.attributes["class"]},body:function(a){delete a.attributes.spellcheck;delete a.attributes.contenteditable},style:function(a){var b=a.children[0];if(b&&b.value)b.value=CKEDITOR.tools.trim(b.value);if(!a.attributes.type)a.attributes.type="text/css"},title:function(a){var b=a.children[0];!b&&h(a,b=new CKEDITOR.htmlParser.text);b.value=a.attributes["data-cke-title"]||""},input:i,textarea:i},attributes:{"class":function(a){return CKEDITOR.tools.ltrim(a.replace(/(?:^|\s+)cke_[^\s]*/g,""))||false}}};if(CKEDITOR.env.ie)M.attributes.style=function(a){return a.replace(/(^|;)([^\:]+)/g,function(a){return a.toLowerCase()})};var D=/<(a|area|img|input|source)\b([^>]*)>/gi,J=/([\w-]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,z=/^(href|src|name)$/i,L=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,B=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,w=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,H=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,C=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,A=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi})();"use strict";CKEDITOR.htmlParser.element=function(a,e){this.name=a;this.attributes=e||{};this.children=[];var b=a||"",c=b.match(/^cke:(.*)/);c&&(b=c[1]);b=!(!CKEDITOR.dtd.$nonBodyContent[b]&&!CKEDITOR.dtd.$block[b]&&!CKEDITOR.dtd.$listItem[b]&&!CKEDITOR.dtd.$tableContent[b]&&!(CKEDITOR.dtd.$nonEditable[b]||b=="br"));this.isEmpty=!!CKEDITOR.dtd.$empty[a];this.isUnknown=!CKEDITOR.dtd[a];this._={isBlockLike:b,hasInlineStarted:this.isEmpty||!b}};CKEDITOR.htmlParser.cssStyle=function(a){var e={};((a instanceof CKEDITOR.htmlParser.element?a.attributes.style:a)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,f){c=="font-family"&&(f=f.replace(/["']/g,""));e[c.toLowerCase()]=f});return{rules:e,populate:function(a){var c=this.toString();if(c)a instanceof CKEDITOR.dom.element?a.setAttribute("style",c):a instanceof CKEDITOR.htmlParser.element?a.attributes.style=c:a.style=c},toString:function(){var a=[],c;for(c in e)e[c]&&a.push(c,":",e[c],";");return a.join("")}}};(function(){function a(a){return function(b){return b.type==CKEDITOR.NODE_ELEMENT&&(typeof a=="string"?b.name==a:b.name in a)}}var e=function(a,b){a=a[0];b=b[0];return a<b?-1:a>b?1:0},b=CKEDITOR.htmlParser.fragment.prototype;CKEDITOR.htmlParser.element.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_ELEMENT,add:b.add,clone:function(){return new CKEDITOR.htmlParser.element(this.name,this.attributes)},filter:function(a,b){var d=this,e,l,b=d.getFilterContext(b);if(b.off)return true;if(!d.parent)a.onRoot(b,d);for(;;){e=d.name;if(!(l=a.onElementName(b,e))){this.remove();return false}d.name=l;if(!(d=a.onElement(b,d))){this.remove();return false}if(d!==this){this.replaceWith(d);return false}if(d.name==e)break;if(d.type!=CKEDITOR.NODE_ELEMENT){this.replaceWith(d);return false}if(!d.name){this.replaceWithChildren();return false}}e=d.attributes;var i,g;for(i in e){g=i;for(l=e[i];;)if(g=a.onAttributeName(b,i))if(g!=i){delete e[i];i=g}else break;else{delete e[i];break}g&&((l=a.onAttribute(b,d,g,l))===false?delete e[g]:e[g]=l)}d.isEmpty||this.filterChildren(a,false,b);return true},filterChildren:b.filterChildren,writeHtml:function(a,b){b&&this.filter(b);var d=this.name,h=[],l=this.attributes,i,g;a.openTag(d,l);for(i in l)h.push([i,l[i]]);a.sortAttributes&&h.sort(e);i=0;for(g=h.length;i<g;i++){l=h[i];a.attribute(l[0],l[1])}a.openTagClose(d,this.isEmpty);this.writeChildrenHtml(a);this.isEmpty||a.closeTag(d)},writeChildrenHtml:b.writeChildrenHtml,replaceWithChildren:function(){for(var a=this.children,b=a.length;b;)a[--b].insertAfter(this);this.remove()},forEach:b.forEach,getFirst:function(b){if(!b)return this.children.length?this.children[0]:null;typeof b!="function"&&(b=a(b));for(var f=0,d=this.children.length;f<d;++f)if(b(this.children[f]))return this.children[f];return null},getHtml:function(){var a=new CKEDITOR.htmlParser.basicWriter;this.writeChildrenHtml(a);return a.getHtml()},setHtml:function(a){for(var a=this.children=CKEDITOR.htmlParser.fragment.fromHtml(a).children,b=0,d=a.length;b<d;++b)a[b].parent=this},getOuterHtml:function(){var a=new CKEDITOR.htmlParser.basicWriter;this.writeHtml(a);return a.getHtml()},split:function(a){for(var b=this.children.splice(a,this.children.length-a),d=this.clone(),e=0;e<b.length;++e)b[e].parent=d;d.children=b;if(b[0])b[0].previous=null;if(a>0)this.children[a-1].next=null;this.parent.add(d,this.getIndex()+1);return d},addClass:function(a){if(!this.hasClass(a)){var b=this.attributes["class"]||"";this.attributes["class"]=b+(b?" ":"")+
a}},removeClass:function(a){var b=this.attributes["class"];if(b)(b=CKEDITOR.tools.trim(b.replace(RegExp("(?:\\s+|^)"+a+"(?:\\s+|$)")," ")))?this.attributes["class"]=b:delete this.attributes["class"]},hasClass:function(a){var b=this.attributes["class"];return!b?false:RegExp("(?:^|\\s)"+a+"(?=\\s|$)").test(b)},getFilterContext:function(a){var b=[];a||(a={off:false,nonEditable:false,nestedEditable:false});!a.off&&this.attributes["data-cke-processor"]=="off"&&b.push("off",true);!a.nonEditable&&this.attributes.contenteditable=="false"?b.push("nonEditable",true):a.nonEditable&&(!a.nestedEditable&&this.attributes.contenteditable=="true")&&b.push("nestedEditable",true);if(b.length)for(var a=CKEDITOR.tools.copy(a),d=0;d<b.length;d=d+2)a[b[d]]=b[d+1];return a}},true)})();(function(){var a={},e=/{([^}]+)}/g,b=/([\\'])/g,c=/\n/g,f=/\r/g;CKEDITOR.template=function(d){if(a[d])this.output=a[d];else{var h=d.replace(b,"\\$1").replace(c,"\\n").replace(f,"\\r").replace(e,function(a,b){return"',data['"+b+"']==undefined?'{"+b+"}':data['"+b+"'],'"});this.output=a[d]=Function("data","buffer","return buffer?buffer.push('"+h+"'):['"+h+"'].join('');")}}})();delete CKEDITOR.loadFullCore;CKEDITOR.instances={};CKEDITOR.document=new CKEDITOR.dom.document(document);CKEDITOR.add=function(a){CKEDITOR.instances[a.name]=a;a.on("focus",function(){if(CKEDITOR.currentInstance!=a){CKEDITOR.currentInstance=a;CKEDITOR.fire("currentInstance")}});a.on("blur",function(){if(CKEDITOR.currentInstance==a){CKEDITOR.currentInstance=null;CKEDITOR.fire("currentInstance")}});CKEDITOR.fire("instance",null,a)};CKEDITOR.remove=function(a){delete CKEDITOR.instances[a.name]};(function(){var a={};CKEDITOR.addTemplate=function(e,b){var c=a[e];if(c)return c;c={name:e,source:b};CKEDITOR.fire("template",c);return a[e]=new CKEDITOR.template(c.source)};CKEDITOR.getTemplate=function(e){return a[e]}})();(function(){var a=[];CKEDITOR.addCss=function(e){a.push(e)};CKEDITOR.getCss=function(){return a.join("\n")}})();CKEDITOR.on("instanceDestroyed",function(){CKEDITOR.tools.isEmpty(this.instances)&&CKEDITOR.fire("reset")});CKEDITOR.TRISTATE_ON=1;CKEDITOR.TRISTATE_OFF=2;CKEDITOR.TRISTATE_DISABLED=0;(function(){CKEDITOR.inline=function(a,e){if(!CKEDITOR.env.isCompatible)return null;a=CKEDITOR.dom.element.get(a);if(a.getEditor())throw'The editor instance "'+a.getEditor().name+'" is already attached to the provided element.';var b=new CKEDITOR.editor(e,a,CKEDITOR.ELEMENT_MODE_INLINE),c=a.is("textarea")?a:null;if(c){b.setData(c.getValue(),null,true);a=CKEDITOR.dom.element.createFromHtml('<div contenteditable="'+!!b.readOnly+'" class="cke_textarea_inline">'+c.getValue()+"</div>",CKEDITOR.document);a.insertAfter(c);c.hide();c.$.form&&b._attachToForm()}else b.setData(a.getHtml(),null,true);b.on("loaded",function(){b.fire("uiReady");b.editable(a);b.container=a;b.setData(b.getData(1));b.resetDirty();b.fire("contentDom");b.mode="wysiwyg";b.fire("mode");b.status="ready";b.fireOnce("instanceReady");CKEDITOR.fire("instanceReady",null,b)},null,null,1E4);b.on("destroy",function(){if(c){b.container.clearCustomData();b.container.remove();c.show()}b.element.clearCustomData();delete b.element});return b};CKEDITOR.inlineAll=function(){var a,e,b;for(b in CKEDITOR.dtd.$editable)for(var c=CKEDITOR.document.getElementsByTag(b),f=0,d=c.count();f<d;f++){a=c.getItem(f);if(a.getAttribute("contenteditable")=="true"){e={element:a,config:{}};CKEDITOR.fire("inline",e)!==false&&CKEDITOR.inline(a,e.config)}}};CKEDITOR.domReady(function(){!CKEDITOR.disableAutoInline&&CKEDITOR.inlineAll()})})();CKEDITOR.replaceClass="ckeditor";(function(){function a(a,f,d,h){if(!CKEDITOR.env.isCompatible)return null;a=CKEDITOR.dom.element.get(a);if(a.getEditor())throw'The editor instance "'+a.getEditor().name+'" is already attached to the provided element.';var l=new CKEDITOR.editor(f,a,h);if(h==CKEDITOR.ELEMENT_MODE_REPLACE){a.setStyle("visibility","hidden");l._.required=a.hasAttribute("required");a.removeAttribute("required")}d&&l.setData(d,null,true);l.on("loaded",function(){b(l);h==CKEDITOR.ELEMENT_MODE_REPLACE&&(l.config.autoUpdateElement&&a.$.form)&&l._attachToForm();l.setMode(l.config.startupMode,function(){l.resetDirty();l.status="ready";l.fireOnce("instanceReady");CKEDITOR.fire("instanceReady",null,l)})});l.on("destroy",e);return l}function e(){var a=this.container,b=this.element;if(a){a.clearCustomData();a.remove()}if(b){b.clearCustomData();if(this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE){b.show();this._.required&&b.setAttribute("required","required")}delete this.element}}function b(a){var b=a.name,d=a.element,e=a.elementMode,l=a.fire("uiSpace",{space:"top",html:""}).html,i=a.fire("uiSpace",{space:"bottom",html:""}).html,g=new CKEDITOR.template('<{outerEl} id="cke_{name}" class="{id} cke cke_reset cke_chrome cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'"  dir="{langDir}" lang="{langCode}" role="application"'+(a.title?' aria-labelledby="cke_{name}_arialbl"':"")+">"+(a.title?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':"")+'<{outerEl} class="cke_inner cke_reset" role="presentation">{topHtml}<{outerEl} id="{contentId}" class="cke_contents cke_reset" role="presentation"></{outerEl}>{bottomHtml}</{outerEl}></{outerEl}>'),b=CKEDITOR.dom.element.createFromHtml(g.output({id:a.id,name:b,langDir:a.lang.dir,langCode:a.langCode,voiceLabel:a.title,topHtml:l?'<span id="'+a.ui.spaceId("top")+'" class="cke_top cke_reset_all" role="presentation" style="height:auto">'+l+"</span>":"",contentId:a.ui.spaceId("contents"),bottomHtml:i?'<span id="'+a.ui.spaceId("bottom")+'" class="cke_bottom cke_reset_all" role="presentation">'+i+"</span>":"",outerEl:CKEDITOR.env.ie?"span":"div"}));if(e==CKEDITOR.ELEMENT_MODE_REPLACE){d.hide();b.insertAfter(d)}else d.append(b);a.container=b;l&&a.ui.space("top").unselectable();i&&a.ui.space("bottom").unselectable();d=a.config.width;e=a.config.height;d&&b.setStyle("width",CKEDITOR.tools.cssLength(d));e&&a.ui.space("contents").setStyle("height",CKEDITOR.tools.cssLength(e));b.disableContextMenu();CKEDITOR.env.webkit&&b.on("focus",function(){a.focus()});a.fireOnce("uiReady")}CKEDITOR.replace=function(b,f){return a(b,f,null,CKEDITOR.ELEMENT_MODE_REPLACE)};CKEDITOR.appendTo=function(b,f,d){return a(b,f,d,CKEDITOR.ELEMENT_MODE_APPENDTO)};CKEDITOR.replaceAll=function(){for(var a=document.getElementsByTagName("textarea"),b=0;b<a.length;b++){var d=null,e=a[b];if(e.name||e.id){if(typeof arguments[0]=="string"){if(!RegExp("(?:^|\\s)"+arguments[0]+"(?:$|\\s)").test(e.className))continue}else if(typeof arguments[0]=="function"){d={};if(arguments[0](e,d)===false)continue}this.replace(e,d)}}};CKEDITOR.editor.prototype.addMode=function(a,b){(this._.modes||(this._.modes={}))[a]=b};CKEDITOR.editor.prototype.setMode=function(a,b){var d=this,e=this._.modes;if(!(a==d.mode||!e||!e[a])){d.fire("beforeSetMode",a);if(d.mode){var l=d.checkDirty(),e=d._.previousModeData,i,g=0;d.fire("beforeModeUnload");d.editable(0);d._.previousMode=d.mode;d._.previousModeData=i=d.getData(1);if(d.mode=="source"&&e==i){d.fire("lockSnapshot",{forceUpdate:true});g=1}d.ui.space("contents").setHtml("");d.mode=""}else d._.previousModeData=d.getData(1);this._.modes[a](function(){d.mode=a;l!==void 0&&!l&&d.resetDirty();g?d.fire("unlockSnapshot"):a=="wysiwyg"&&d.fire("saveSnapshot");setTimeout(function(){d.fire("mode");b&&b.call(d)},0)})}};CKEDITOR.editor.prototype.resize=function(a,b,d,e){var l=this.container,i=this.ui.space("contents"),g=CKEDITOR.env.webkit&&this.document&&this.document.getWindow().$.frameElement,e=e?this.container.getFirst(function(a){return a.type==CKEDITOR.NODE_ELEMENT&&a.hasClass("cke_inner")}):l;e.setSize("width",a,true);g&&(g.style.width="1%");i.setStyle("height",Math.max(b-(d?0:(e.$.offsetHeight||0)-(i.$.clientHeight||0)),0)+"px");g&&(g.style.width="100%");this.fire("resize")};CKEDITOR.editor.prototype.getResizable=function(a){return a?this.ui.space("contents"):this.container};CKEDITOR.domReady(function(){CKEDITOR.replaceClass&&CKEDITOR.replaceAll(CKEDITOR.replaceClass)})})();CKEDITOR.config.startupMode="wysiwyg";(function(){function a(a){var b=a.editor,d=a.data.path,f=d.blockLimit,k=a.data.selection,n=k.getRanges()[0],r;if(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)if(k=e(k,d)){k.appendBogus();r=CKEDITOR.env.ie}if(h(b,d.block,f)&&n.collapsed&&!n.getCommonAncestor().isReadOnly()){d=n.clone();d.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS);f=new CKEDITOR.dom.walker(d);f.guard=function(a){return!c(a)||a.type==CKEDITOR.NODE_COMMENT||a.isReadOnly()};if(!f.checkForward()||d.checkStartOfBlock()&&d.checkEndOfBlock()){b=n.fixBlock(true,b.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p");if(!CKEDITOR.env.needsBrFiller)(b=b.getFirst(c))&&(b.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(b.getText()).match(/^(?:&nbsp;|\xa0)$/))&&b.remove();r=1;a.cancel()}}r&&n.select()}function e(a,b){if(a.isFake)return 0;var d=b.block||b.blockLimit,e=d&&d.getLast(c);if(d&&d.isBlockBoundary()&&(!e||!(e.type==CKEDITOR.NODE_ELEMENT&&e.isBlockBoundary()))&&!d.is("pre")&&!d.getBogus())return d}function b(a){var b=a.data.getTarget();if(b.is("input")){b=b.getAttribute("type");(b=="submit"||b=="reset")&&a.data.preventDefault()}}function c(a){return s(a)&&y(a)}function f(a,b){return function(c){var d=CKEDITOR.dom.element.get(c.data.$.toElement||c.data.$.fromElement||c.data.$.relatedTarget);(!d||!b.equals(d)&&!b.contains(d))&&a.call(this,c)}}function d(a){function b(a){return function(b,e){e&&(b.type==CKEDITOR.NODE_ELEMENT&&b.is(f))&&(d=b);if(!e&&c(b)&&(!a||!m(b)))return false}}var d,e=a.getRanges()[0],a=a.root,f={table:1,ul:1,ol:1,dl:1};if(e.startPath().contains(f)){var n=e.clone();n.collapse(1);n.setStartAt(a,CKEDITOR.POSITION_AFTER_START);a=new CKEDITOR.dom.walker(n);a.guard=b();a.checkBackward();if(d){n=e.clone();n.collapse();n.setEndAt(d,CKEDITOR.POSITION_AFTER_END);a=new CKEDITOR.dom.walker(n);a.guard=b(true);d=false;a.checkForward();return d}}return null}function h(a,b,c){return a.config.autoParagraph!==false&&a.activeEnterMode!=CKEDITOR.ENTER_BR&&a.editable().equals(c)&&!b||b&&b.getAttribute("contenteditable")=="true"}
function l(a){a.editor.focus();a.editor.fire("saveSnapshot")}function i(a){var b=a.editor;b.getSelection().scrollIntoView();setTimeout(function(){b.fire("saveSnapshot")},0)}function g(a,b,c){for(var d=a.getCommonAncestor(b),b=a=c?b:a;(a=a.getParent())&&!d.equals(a)&&a.getChildCount()==1;)b=a;b.remove()}CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(a,b){this.base(b.$||b);this.editor=a;this.status="unloaded";this.hasFocus=false;this.setup()},proto:{focus:function(){var a;if(CKEDITOR.env.webkit&&!this.hasFocus){a=this.editor._.previousActive||this.getDocument().getActive();if(this.contains(a)){a.focus();return}}try{this.$[CKEDITOR.env.ie&&this.getDocument().equals(CKEDITOR.document)?"setActive":"focus"]()}catch(b){if(!CKEDITOR.env.ie)throw b;}if(CKEDITOR.env.safari&&!this.isInline()){a=CKEDITOR.document.getActive();a.equals(this.getWindow().getFrame())||this.getWindow().focus()}},on:function(a,b){var c=Array.prototype.slice.call(arguments,0);if(CKEDITOR.env.ie&&/^focus|blur$/.exec(a)){a=a=="focus"?"focusin":"focusout";b=f(b,this);c[0]=a;c[1]=b}return CKEDITOR.dom.element.prototype.on.apply(this,c)},attachListener:function(a){!this._.listeners&&(this._.listeners=[]);var b=Array.prototype.slice.call(arguments,1),b=a.on.apply(a,b);this._.listeners.push(b);return b},clearListeners:function(){var a=this._.listeners;try{for(;a.length;)a.pop().removeListener()}catch(b){}},restoreAttrs:function(){var a=this._.attrChanges,b,c;for(c in a)if(a.hasOwnProperty(c)){b=a[c];b!==null?this.setAttribute(c,b):this.removeAttribute(c)}},attachClass:function(a){var b=this.getCustomData("classes");if(!this.hasClass(a)){!b&&(b=[]);b.push(a);this.setCustomData("classes",b);this.addClass(a)}},changeAttr:function(a,b){var c=this.getAttribute(a);if(b!==c){!this._.attrChanges&&(this._.attrChanges={});a in this._.attrChanges||(this._.attrChanges[a]=c);this.setAttribute(a,b)}},insertHtml:function(a,b){l(this);p(this,b||"html",a)},insertText:function(a){l(this);var b=this.editor,c=b.getSelection().getStartElement().hasAscendant("pre",true)?CKEDITOR.ENTER_BR:b.activeEnterMode,b=c==CKEDITOR.ENTER_BR,d=CKEDITOR.tools,a=d.htmlEncode(a.replace(/\r\n/g,"\n")),a=a.replace(/\t/g,"&nbsp;&nbsp; &nbsp;"),c=c==CKEDITOR.ENTER_P?"p":"div";if(!b){var e=/\n{2}/g;if(e.test(a))var f="<"+c+">",r="</"+c+">",a=f+a.replace(e,function(){return r+f})+r}a=a.replace(/\n/g,"<br>");b||(a=a.replace(RegExp("<br>(?=</"+c+">)"),function(a){return d.repeat(a,2)}));a=a.replace(/^ | $/g,"&nbsp;");a=a.replace(/(>|\s) /g,function(a,b){return b+"&nbsp;"}).replace(/ (?=<)/g,"&nbsp;");p(this,"text",a)},insertElement:function(a,b){b?this.insertElementIntoRange(a,b):this.insertElementIntoSelection(a)},insertElementIntoRange:function(a,b){var c=this.editor,d=c.config.enterMode,e=a.getName(),f=CKEDITOR.dtd.$block[e];if(b.checkReadOnly())return false;b.deleteContents(1);b.startContainer.type==CKEDITOR.NODE_ELEMENT&&b.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})&&q(b);var r,g;if(f)for(;(r=b.getCommonAncestor(0,1))&&(g=CKEDITOR.dtd[r.getName()])&&(!g||!g[e]);)if(r.getName()in
CKEDITOR.dtd.span)b.splitElement(r);else if(b.checkStartOfBlock()&&b.checkEndOfBlock()){b.setStartBefore(r);b.collapse(true);r.remove()}else b.splitBlock(d==CKEDITOR.ENTER_DIV?"div":"p",c.editable());b.insertNode(a);return true},insertElementIntoSelection:function(a){l(this);var b=this.editor,d=b.activeEnterMode,b=b.getSelection(),e=b.getRanges()[0],f=a.getName(),f=CKEDITOR.dtd.$block[f];if(this.insertElementIntoRange(a,e)){e.moveToPosition(a,CKEDITOR.POSITION_AFTER_END);if(f)if((f=a.getNext(function(a){return c(a)&&!m(a)}))&&f.type==CKEDITOR.NODE_ELEMENT&&f.is(CKEDITOR.dtd.$block))f.getDtd()["#"]?e.moveToElementEditStart(f):e.moveToElementEditEnd(a);else if(!f&&d!=CKEDITOR.ENTER_BR){f=e.fixBlock(true,d==CKEDITOR.ENTER_DIV?"div":"p");e.moveToElementEditStart(f)}}b.selectRanges([e]);i(this)},setData:function(a,b){b||(a=this.editor.dataProcessor.toHtml(a));this.setHtml(a);this.fixInitialSelection();if(this.status=="unloaded")this.status="ready";this.editor.fire("dataReady")},getData:function(a){var b=this.getHtml();a||(b=this.editor.dataProcessor.toDataFormat(b));return b},setReadOnly:function(a){this.setAttribute("contenteditable",!a)},detach:function(){this.removeClass("cke_editable");this.status="detached";var a=this.editor;this._.detach();delete a.document;delete a.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},fixInitialSelection:function(){function a(){var b=c.getDocument().$,d=b.getSelection(),e;if(d.anchorNode&&d.anchorNode==c.$)e=true;else if(CKEDITOR.env.webkit){var f=c.getDocument().getActive();f&&(f.equals(c)&&!d.anchorNode)&&(e=true)}if(e){e=new CKEDITOR.dom.range(c);e.moveToElementEditStart(c);b=b.createRange();b.setStart(e.startContainer.$,e.startOffset);b.collapse(true);d.removeAllRanges();d.addRange(b)}}function b(){var a=c.getDocument().$,d=a.selection,e=c.getDocument().getActive();if(d.type=="None"&&e.equals(c)){d=new CKEDITOR.dom.range(c);a=a.body.createTextRange();d.moveToElementEditStart(c);d=d.startContainer;d.type!=CKEDITOR.NODE_ELEMENT&&(d=d.getParent());a.moveToElementText(d.$);a.collapse(true);a.select()}}var c=this;if(CKEDITOR.env.ie&&CKEDITOR.env.version<9){if(this.hasFocus){this.focus();b()}}else if(this.hasFocus){this.focus();a()}else this.once("focus",function(){a()},null,null,-999)},setup:function(){var a=this.editor;this.attachListener(a,"beforeGetData",function(){var b=this.getData();this.is("textarea")||a.config.ignoreEmptyParagraph!==false&&(b=b.replace(t,function(a,b){return b}));a.setData(b,null,1)},this);this.attachListener(a,"getSnapshot",function(a){a.data=this.getData(1)},this);this.attachListener(a,"afterSetData",function(){this.setData(a.getData(1))},this);this.attachListener(a,"loadSnapshot",function(a){this.setData(a.data,1)},this);this.attachListener(a,"beforeFocus",function(){var b=a.getSelection();(b=b&&b.getNative())&&b.type=="Control"||this.focus()},this);this.attachListener(a,"insertHtml",function(a){this.insertHtml(a.data.dataValue,a.data.mode)},this);this.attachListener(a,"insertElement",function(a){this.insertElement(a.data)},this);this.attachListener(a,"insertText",function(a){this.insertText(a.data)},this);this.setReadOnly(a.readOnly);this.attachClass("cke_editable");this.attachClass(a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"cke_editable_inline":a.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE||a.elementMode==CKEDITOR.ELEMENT_MODE_APPENDTO?"cke_editable_themed":"");this.attachClass("cke_contents_"+a.config.contentsLangDirection);a.keystrokeHandler.blockedKeystrokes[8]=+a.readOnly;a.keystrokeHandler.attach(this);this.on("blur",function(){this.hasFocus=false},null,null,-1);this.on("focus",function(){this.hasFocus=true},null,null,-1);a.focusManager.add(this);if(this.equals(CKEDITOR.document.getActive())){this.hasFocus=true;a.once("contentDom",function(){a.focusManager.focus(this)},this)}this.isInline()&&this.changeAttr("tabindex",a.tabIndex);if(!this.is("textarea")){a.document=this.getDocument();a.window=this.getWindow();var e=a.document;this.changeAttr("spellcheck",!a.config.disableNativeSpellChecker);var f=a.config.contentsLangDirection;this.getDirection(1)!=f&&this.changeAttr("dir",f);var h=CKEDITOR.getCss();if(h){f=e.getHead();if(!f.getCustomData("stylesheet")){h=e.appendStyleText(h);h=new CKEDITOR.dom.element(h.ownerNode||h.owningElement);f.setCustomData("stylesheet",h);h.data("cke-temp",1)}}f=e.getCustomData("stylesheet_ref")||0;e.setCustomData("stylesheet_ref",f+1);this.setCustomData("cke_includeReadonly",!a.config.disableReadonlyStyling);this.attachListener(this,"click",function(a){var a=a.data,b=(new CKEDITOR.dom.elementPath(a.getTarget(),this)).contains("a");b&&(a.$.button!=2&&b.isReadOnly())&&a.preventDefault()});var k={8:1,46:1};this.attachListener(a,"key",function(b){if(a.readOnly)return true;var c=b.data.domEvent.getKey(),e;if(c in k){var b=a.getSelection(),f,g=b.getRanges()[0],h=g.startPath(),i,m,l,c=c==8;if(CKEDITOR.env.ie&&CKEDITOR.env.version<11&&(f=b.getSelectedElement())||(f=d(b))){a.fire("saveSnapshot");g.moveToPosition(f,CKEDITOR.POSITION_BEFORE_START);f.remove();g.select();a.fire("saveSnapshot");e=1}else if(g.collapsed)if((i=h.block)&&(l=i[c?"getPrevious":"getNext"](s))&&l.type==CKEDITOR.NODE_ELEMENT&&l.is("table")&&g[c?"checkStartOfBlock":"checkEndOfBlock"]()){a.fire("saveSnapshot");g[c?"checkEndOfBlock":"checkStartOfBlock"]()&&i.remove();g["moveToElementEdit"+(c?"End":"Start")](l);g.select();a.fire("saveSnapshot");e=1}else if(h.blockLimit&&h.blockLimit.is("td")&&(m=h.blockLimit.getAscendant("table"))&&g.checkBoundaryOfElement(m,c?CKEDITOR.START:CKEDITOR.END)&&(l=m[c?"getPrevious":"getNext"](s))){a.fire("saveSnapshot");g["moveToElementEdit"+(c?"End":"Start")](l);g.checkStartOfBlock()&&g.checkEndOfBlock()?l.remove():g.select();a.fire("saveSnapshot");e=1}else if((m=h.contains(["td","th","caption"]))&&g.checkBoundaryOfElement(m,c?CKEDITOR.START:CKEDITOR.END))e=1}return!e});a.blockless&&(CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)&&this.attachListener(this,"keyup",function(b){if(b.data.getKeystroke()in k&&!this.getFirst(c)){this.appendBogus();b=a.createRange();b.moveToPosition(this,CKEDITOR.POSITION_AFTER_START);b.select()}});this.attachListener(this,"dblclick",function(b){if(a.readOnly)return false;b={element:b.data.getTarget()};a.fire("doubleclick",b)});CKEDITOR.env.ie&&this.attachListener(this,"click",b);CKEDITOR.env.ie||this.attachListener(this,"mousedown",function(b){var c=b.data.getTarget();if(c.is("img","hr","input","textarea","select")&&!c.isReadOnly()){a.getSelection().selectElement(c);c.is("input","textarea","select")&&b.data.preventDefault()}});CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(b){if(b.data.$.button==2){b=b.data.getTarget();if(!b.getOuterHtml().replace(t,"")){var c=a.createRange();c.moveToElementEditStart(b);c.select(true)}}});if(CKEDITOR.env.webkit){this.attachListener(this,"click",function(a){a.data.getTarget().is("input","select")&&a.data.preventDefault()});this.attachListener(this,"mouseup",function(a){a.data.getTarget().is("input","textarea")&&a.data.preventDefault()})}CKEDITOR.env.webkit&&this.attachListener(a,"key",function(b){b=b.data.domEvent.getKey();if(b in k){var c=b==8,d=a.getSelection().getRanges()[0],b=d.startPath();if(d.collapsed){var e;a:{var f=b.block;if(f)if(d[c?"checkStartOfBlock":"checkEndOfBlock"]())if(!d.moveToClosestEditablePosition(f,!c)||!d.collapsed)e=false;else{if(d.startContainer.type==CKEDITOR.NODE_ELEMENT){var h=d.startContainer.getChild(d.startOffset-(c?1:0));if(h&&h.type==CKEDITOR.NODE_ELEMENT&&h.is("hr")){a.fire("saveSnapshot");h.remove();e=true;break a}}if((d=d.startPath().block)&&(!d||!d.contains(f))){a.fire("saveSnapshot");var i;(i=(c?d:f).getBogus())&&i.remove();e=a.getSelection();i=e.createBookmarks();(c?f:d).moveChildren(c?d:f,false);b.lastElement.mergeSiblings();g(f,d,!c);e.selectBookmarks(i);e=true}}else e=false;else e=false}if(!e)return}else{c=d;e=b.block;i=c.endPath().block;if(!e||!i||e.equals(i))b=false;else{a.fire("saveSnapshot");(f=e.getBogus())&&f.remove();c.deleteContents();if(i.getParent()){i.moveChildren(e,false);b.lastElement.mergeSiblings();g(e,i,true)}c=a.getSelection().getRanges()[0];c.collapse(1);c.select();b=true}if(!b)return}a.getSelection().scrollIntoView();a.fire("saveSnapshot");return false}},this,null,100)}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1);this.clearListeners();this.restoreAttrs();var a;if(a=this.removeCustomData("classes"))for(;a.length;)this.removeClass(a.pop());if(!this.is("textarea")){a=this.getDocument();var b=a.getHead();if(b.getCustomData("stylesheet")){var c=a.getCustomData("stylesheet_ref");if(--c)a.setCustomData("stylesheet_ref",c);else{a.removeCustomData("stylesheet_ref");b.removeCustomData("stylesheet").remove()}}}this.editor.fire("contentDomUnload");delete this.editor}}});CKEDITOR.editor.prototype.editable=function(a){var b=this._.editable;if(b&&a)return 0;if(arguments.length)b=this._.editable=a?a instanceof CKEDITOR.editable?a:new CKEDITOR.editable(this,a):(b&&b.detach(),null);return b};var m=CKEDITOR.dom.walker.bogus(),t=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,s=CKEDITOR.dom.walker.whitespaces(true),y=CKEDITOR.dom.walker.bookmark(false,true);CKEDITOR.on("instanceLoaded",function(b){var c=b.editor;c.on("insertElement",function(a){a=a.data;if(a.type==CKEDITOR.NODE_ELEMENT&&(a.is("input")||a.is("textarea"))){a.getAttribute("contentEditable")!="false"&&a.data("cke-editable",a.hasAttribute("contenteditable")?"true":"1");a.setAttribute("contentEditable",false)}});c.on("selectionChange",function(b){if(!c.readOnly){var d=c.getSelection();if(d&&!d.isLocked){d=c.checkDirty();c.fire("lockSnapshot");a(b);c.fire("unlockSnapshot");!d&&c.resetDirty()}}})});CKEDITOR.on("instanceCreated",function(a){var b=a.editor;b.on("mode",function(){var a=b.editable();if(a&&a.isInline()){var c=b.title;a.changeAttr("role","textbox");a.changeAttr("aria-label",c);c&&a.changeAttr("title",c);var d=b.fire("ariaEditorHelpLabel",{}).label;if(d)if(c=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents")){var e=CKEDITOR.tools.getNextId(),d=CKEDITOR.dom.element.createFromHtml('<span id="'+e+'" class="cke_voice_label">'+d+"</span>");c.append(d);a.changeAttr("aria-describedby",e)}}})});CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}");var p=function(){function a(b){return b.type==CKEDITOR.NODE_ELEMENT}function b(c,d){var e,f,k,n,h=[],i=d.range.startContainer;e=d.range.startPath();for(var i=g[i.getName()],o=0,l=c.getChildren(),m=l.count(),D=-1,p=-1,M=0,s=e.contains(g.$list);o<m;++o){e=l.getItem(o);if(a(e)){k=e.getName();if(s&&k in CKEDITOR.dtd.$list)h=h.concat(b(e,d));else{n=!!i[k];if(k=="br"&&e.data("cke-eol")&&(!o||o==m-1)){M=(f=o?h[o-1].node:l.getItem(o+1))&&(!a(f)||!f.is("br"));f=f&&a(f)&&g.$block[f.getName()]}D==-1&&!n&&(D=o);n||(p=o);h.push({isElement:1,isLineBreak:M,isBlock:e.isBlockBoundary(),hasBlockSibling:f,node:e,name:k,allowed:n});f=M=0}}else h.push({isElement:0,node:e,allowed:1})}if(D>-1)h[D].firstNotAllowed=1;if(p>-1)h[p].lastNotAllowed=1;return h}function d(b,c){var e=[],f=b.getChildren(),k=f.count(),n,h=0,i=g[c],o=!b.is(g.$inline)||b.is("br");for(o&&e.push(" ");h<k;h++){n=f.getItem(h);a(n)&&!n.is(i)?e=e.concat(d(n,c)):e.push(n)}o&&e.push(" ");return e}function e(b){return b&&a(b)&&(b.is(g.$removeEmpty)||b.is("a")&&!b.isBlockBoundary())}function f(b,c,d,e){var n=b.clone(),g,h;n.setEndAt(c,CKEDITOR.POSITION_BEFORE_END);if((g=(new CKEDITOR.dom.walker(n)).next())&&a(g)&&o[g.getName()]&&(h=g.getPrevious())&&a(h)&&!h.getParent().equals(b.startContainer)&&d.contains(h)&&e.contains(g)&&g.isIdentical(h)){g.moveChildren(h);g.remove();f(b,c,d,e)}}function n(b,c){function d(b,c){if(c.isBlock&&c.isElement&&!c.node.is("br")&&a(b)&&b.is("br")){b.remove();return 1}}var e=c.endContainer.getChild(c.endOffset),f=c.endContainer.getChild(c.endOffset-1);e&&d(e,b[b.length-1]);if(f&&d(f,b[0])){c.setEnd(c.endContainer,c.endOffset-1);c.collapse()}}var g=CKEDITOR.dtd,o={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},l={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},m=CKEDITOR.tools.extend({},g.$inline);delete m.br;return function(o,z,p){var B=o.editor,w=B.getSelection().getRanges()[0],H=false;if(z=="unfiltered_html"){z="html";H=true}if(!w.checkReadOnly()){var C=(new CKEDITOR.dom.elementPath(w.startContainer,w.root)).blockLimit||w.root,z={type:z,dontFilter:H,editable:o,editor:B,range:w,blockLimit:C,mergeCandidates:[],zombies:[]},B=z.range,H=z.mergeCandidates,A,x,F,G;if(z.type=="text"&&B.shrink(CKEDITOR.SHRINK_ELEMENT,true,false)){A=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",B.document);B.insertNode(A);B.setStartAfter(A)}x=new CKEDITOR.dom.elementPath(B.startContainer);z.endPath=F=new CKEDITOR.dom.elementPath(B.endContainer);if(!B.collapsed){var C=F.block||F.blockLimit,s=B.getCommonAncestor();C&&(!C.equals(s)&&!C.contains(s)&&B.checkEndOfBlock())&&z.zombies.push(C);B.deleteContents()}for(;(G=a(B.startContainer)&&B.startContainer.getChild(B.startOffset-1))&&a(G)&&G.isBlockBoundary()&&x.contains(G);)B.moveToPosition(G,CKEDITOR.POSITION_BEFORE_END);f(B,z.blockLimit,x,F);if(A){B.setEndBefore(A);B.collapse();A.remove()}A=B.startPath();if(C=A.contains(e,false,1)){B.splitElement(C);z.inlineStylesRoot=C;z.inlineStylesPeak=A.lastElement}A=B.createBookmark();(C=A.startNode.getPrevious(c))&&a(C)&&e(C)&&H.push(C);(C=A.startNode.getNext(c))&&a(C)&&e(C)&&H.push(C);for(C=A.startNode;(C=C.getParent())&&e(C);)H.push(C);B.moveToBookmark(A);if(A=p){A=z.range;if(z.type=="text"&&z.inlineStylesRoot){G=z.inlineStylesPeak;B=G.getDocument().createText("{cke-peak}");for(H=z.inlineStylesRoot.getParent();!G.equals(H);){B=B.appendTo(G.clone());G=G.getParent()}p=B.getOuterHtml().split("{cke-peak}").join(p)}G=z.blockLimit.getName();if(/^\s+|\s+$/.test(p)&&"span"in CKEDITOR.dtd[G])var y='<span data-cke-marker="1">&nbsp;</span>',p=y+p+y;p=z.editor.dataProcessor.toHtml(p,{context:null,fixForBody:false,dontFilter:z.dontFilter,filter:z.editor.activeFilter,enterMode:z.editor.activeEnterMode});G=A.document.createElement("body");G.setHtml(p);if(y){G.getFirst().remove();G.getLast().remove()}if((y=A.startPath().block)&&!(y.getChildCount()==1&&y.getBogus()))a:{var t;if(G.getChildCount()==1&&a(t=G.getFirst())&&t.is(l)){y=t.getElementsByTag("*");A=0;for(H=y.count();A<H;A++){B=y.getItem(A);if(!B.is(m))break a}t.moveChildren(t.getParent(1));t.remove()}}z.dataWrapper=G;A=p}if(A){t=z.range;var y=t.document,q,p=z.blockLimit;A=0;var K;G=[];var I,Q,H=B=0,N,S;x=t.startContainer;var C=z.endPath.elements[0],T;F=C.getPosition(x);s=!!C.getCommonAncestor(x)&&F!=CKEDITOR.POSITION_IDENTICAL&&!(F&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED);x=b(z.dataWrapper,z);for(n(x,t);A<x.length;A++){F=x[A];if(q=F.isLineBreak){q=t;N=p;var P=void 0,V=void 0;if(F.hasBlockSibling)q=1;else{P=q.startContainer.getAscendant(g.$block,1);if(!P||!P.is({div:1,p:1}))q=0;else{V=P.getPosition(N);if(V==CKEDITOR.POSITION_IDENTICAL||V==CKEDITOR.POSITION_CONTAINS)q=0;else{N=q.splitElement(P);q.moveToPosition(N,CKEDITOR.POSITION_AFTER_START);q=1}}}}if(q)H=A>0;else{q=t.startPath();if(!F.isBlock&&h(z.editor,q.block,q.blockLimit)&&(Q=z.editor.activeEnterMode!=CKEDITOR.ENTER_BR&&z.editor.config.autoParagraph!==false?z.editor.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p":false)){Q=y.createElement(Q);Q.appendBogus();t.insertNode(Q);CKEDITOR.env.needsBrFiller&&(K=Q.getBogus())&&K.remove();t.moveToPosition(Q,CKEDITOR.POSITION_BEFORE_END)}if((q=t.startPath().block)&&!q.equals(I)){if(K=q.getBogus()){K.remove();G.push(q)}I=q}F.firstNotAllowed&&(B=1);if(B&&F.isElement){q=t.startContainer;for(N=null;q&&!g[q.getName()][F.name];){if(q.equals(p)){q=null;break}N=q;q=q.getParent()}if(q){if(N){S=t.splitElement(N);z.zombies.push(S);z.zombies.push(N)}}else{N=p.getName();T=!A;q=A==x.length-1;N=d(F.node,N);for(var P=[],V=N.length,W=0,Y=void 0,Z=0,U=-1;W<V;W++){Y=N[W];if(Y==" "){if(!Z&&(!T||W)){P.push(new CKEDITOR.dom.text(" "));U=P.length}Z=1}else{P.push(Y);Z=0}}q&&U==P.length&&P.pop();T=P}}if(T){for(;q=T.pop();)t.insertNode(q);T=0}else t.insertNode(F.node);if(F.lastNotAllowed&&A<x.length-1){(S=s?C:S)&&t.setEndAt(S,CKEDITOR.POSITION_AFTER_START);B=0}t.collapse()}}z.dontMoveCaret=H;z.bogusNeededBlocks=G}K=z.range;var O;S=z.bogusNeededBlocks;for(T=K.createBookmark();I=z.zombies.pop();)if(I.getParent()){Q=K.clone();Q.moveToElementEditStart(I);Q.removeEmptyBlocksAtEnd()}if(S)for(;I=S.pop();)CKEDITOR.env.needsBrFiller?I.appendBogus():I.append(K.document.createText(" "));for(;I=z.mergeCandidates.pop();)I.mergeSiblings();K.moveToBookmark(T);if(!z.dontMoveCaret){for(I=a(K.startContainer)&&K.startContainer.getChild(K.startOffset-1);I&&a(I)&&!I.is(g.$empty);){if(I.isBlockBoundary())K.moveToPosition(I,CKEDITOR.POSITION_BEFORE_END);else{if(e(I)&&I.getHtml().match(/(\s|&nbsp;)$/g)){O=null;break}O=K.clone();O.moveToPosition(I,CKEDITOR.POSITION_BEFORE_END)}I=I.getLast(c)}O&&K.moveToRange(O)}w.select();i(o)}}}(),q=function(){function a(b){b=new CKEDITOR.dom.walker(b);b.guard=function(a,b){if(b)return false;if(a.type==CKEDITOR.NODE_ELEMENT)return a.is(CKEDITOR.dtd.$tableContent)};b.evaluator=function(a){return a.type==CKEDITOR.NODE_ELEMENT};return b}function b(a,c,d){c=a.getDocument().createElement(c);a.append(c,d);return c}function c(a){var b=a.count(),d;for(b;b-->0;){d=a.getItem(b);if(!CKEDITOR.tools.trim(d.getHtml())){d.appendBogus();CKEDITOR.env.ie&&(CKEDITOR.env.version<9&&d.getChildCount())&&d.getFirst().remove()}}}return function(d){var e=d.startContainer,f=e.getAscendant("table",1),g=false;c(f.getElementsByTag("td"));c(f.getElementsByTag("th"));f=d.clone();f.setStart(e,0);f=a(f).lastBackward();if(!f){f=d.clone();f.setEndAt(e,CKEDITOR.POSITION_BEFORE_END);f=a(f).lastForward();g=true}f||(f=e);if(f.is("table")){d.setStartAt(f,CKEDITOR.POSITION_BEFORE_START);d.collapse(true);f.remove()}else{f.is({tbody:1,thead:1,tfoot:1})&&(f=b(f,"tr",g));f.is("tr")&&(f=b(f,f.getParent().is("thead")?"th":"td",g));(e=f.getBogus())&&e.remove();d.moveToPosition(f,g?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END)}}}()})();(function(){function a(){var a=this._.fakeSelection,b;if(a){b=this.getSelection(1);if(!b||!b.isHidden()){a.reset();a=0}}if(!a){a=b||this.getSelection(1);if(!a||a.getType()==CKEDITOR.SELECTION_NONE)return}this.fire("selectionCheck",a);b=this.elementPath();if(!b.compare(this._.selectionPreviousPath)){if(CKEDITOR.env.webkit)this._.previousActive=this.document.getActive();this._.selectionPreviousPath=b;this.fire("selectionChange",{selection:a,path:b})}}function e(){p=true;if(!y){b.call(this);y=CKEDITOR.tools.setTimeout(b,200,this)}}function b(){y=null;if(p){CKEDITOR.tools.setTimeout(a,0,this);p=false}}function c(a){return q(a)||a.type==CKEDITOR.NODE_ELEMENT&&!a.is(CKEDITOR.dtd.$empty)?true:false}function f(a){function b(c,d){return!c||c.type==CKEDITOR.NODE_TEXT?false:a.clone()["moveToElementEdit"+(d?"End":"Start")](c)}if(!(a.root instanceof CKEDITOR.editable))return false;var d=a.startContainer,e=a.getPreviousNode(c,null,d),f=a.getNextNode(c,null,d);return b(e)||b(f,1)||!e&&!f&&!(d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()&&d.getBogus())?true:false}function d(a){return a.getCustomData("cke-fillingChar")}function h(a,b){var c=a&&a.removeCustomData("cke-fillingChar");if(c){if(b!==false){var d,e=a.getDocument().getSelection().getNative(),f=e&&e.type!="None"&&e.getRangeAt(0);if(c.getLength()>1&&f&&f.intersectsNode(c.$)){d=i(e);f=e.focusNode==c.$&&e.focusOffset>0;e.anchorNode==c.$&&e.anchorOffset>0&&d[0].offset--;f&&d[1].offset--}}c.setText(l(c.getText()));d&&g(a.getDocument().$,d)}}function l(a){return a.replace(/\u200B( )?/g,function(a){return a[1]?" ":""})}function i(a){return[{node:a.anchorNode,offset:a.anchorOffset},{node:a.focusNode,offset:a.focusOffset}]}function g(a,b){var c=a.getSelection(),d=a.createRange();d.setStart(b[0].node,b[0].offset);d.collapse(true);c.removeAllRanges();c.addRange(d);c.extend(b[1].node,b[1].offset)}function m(a){var b=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+(CKEDITOR.env.ie?"display:none":"position:fixed;top:0;left:-1000px")+'">&nbsp;</div>',a.document);a.fire("lockSnapshot");a.editable().append(b);var c=a.getSelection(1),d=a.createRange(),e=c.root.on("selectionchange",function(a){a.cancel()},null,null,0);d.setStartAt(b,CKEDITOR.POSITION_AFTER_START);d.setEndAt(b,CKEDITOR.POSITION_BEFORE_END);c.selectRanges([d]);e.removeListener();a.fire("unlockSnapshot");a._.hiddenSelectionContainer=b}function t(a){var b={37:1,39:1,8:1,46:1};return function(c){var d=c.data.getKeystroke();if(b[d]){var e=a.getSelection().getRanges(),f=e[0];if(e.length==1&&f.collapsed)if((d=f[d<38?"getPreviousEditableNode":"getNextEditableNode"]())&&d.type==CKEDITOR.NODE_ELEMENT&&d.getAttribute("contenteditable")=="false"){a.getSelection().fake(d);c.data.preventDefault();c.cancel()}}}}function s(a){for(var b=0;b<a.length;b++){var c=a[b];c.getCommonAncestor().isReadOnly()&&a.splice(b,1);if(!c.collapsed){if(c.startContainer.isReadOnly())for(var d=c.startContainer,e;d;){if((e=d.type==CKEDITOR.NODE_ELEMENT)&&d.is("body")||!d.isReadOnly())break;e&&d.getAttribute("contentEditable")=="false"&&c.setStartAfter(d);d=d.getParent()}d=c.startContainer;e=c.endContainer;var f=c.startOffset,g=c.endOffset,h=c.clone();d&&d.type==CKEDITOR.NODE_TEXT&&(f>=d.getLength()?h.setStartAfter(d):h.setStartBefore(d));e&&e.type==CKEDITOR.NODE_TEXT&&(g?h.setEndAfter(e):h.setEndBefore(e));d=new CKEDITOR.dom.walker(h);d.evaluator=function(d){if(d.type==CKEDITOR.NODE_ELEMENT&&d.isReadOnly()){var e=c.clone();c.setEndBefore(d);c.collapsed&&a.splice(b--,1);if(!(d.getPosition(h.endContainer)&CKEDITOR.POSITION_CONTAINS)){e.setStartAfter(d);e.collapsed||a.splice(b+1,0,e)}return true}return false};d.next()}}return a}var y,p,q=CKEDITOR.dom.walker.invisible(1),j=function(){function a(b){return function(a){var c=a.editor.createRange();c.moveToClosestEditablePosition(a.selected,b)&&a.editor.getSelection().selectRanges([c]);return false}}function b(a){return function(b){var c=b.editor,d=c.createRange(),e;if(!(e=d.moveToClosestEditablePosition(b.selected,a)))e=d.moveToClosestEditablePosition(b.selected,!a);e&&c.getSelection().selectRanges([d]);c.fire("saveSnapshot");b.selected.remove();if(!e){d.moveToElementEditablePosition(c.editable());c.getSelection().selectRanges([d])}c.fire("saveSnapshot");return false}}var c=a(),d=a(1);return{37:c,38:c,39:d,40:d,8:b(),46:b(1)}}();CKEDITOR.on("instanceCreated",function(b){function c(){var a=d.getSelection();a&&a.removeAllRanges()}var d=b.editor;d.on("contentDom",function(){function b(){C=new CKEDITOR.dom.selection(d.getSelection());C.lock()}function c(){g.removeListener("mouseup",c);n.removeListener("mouseup",c);var a=CKEDITOR.document.$.selection,b=a.createRange();a.type!="None"&&b.parentElement().ownerDocument==f.$&&b.select()}var f=d.document,g=CKEDITOR.document,k=d.editable(),i=f.getBody(),n=f.getDocumentElement(),w=k.isInline(),j,C;CKEDITOR.env.gecko&&k.attachListener(k,"focus",function(a){a.removeListener();if(j!==0)if((a=d.getSelection().getNative())&&a.isCollapsed&&a.anchorNode==k.$){a=d.createRange();a.moveToElementEditStart(k);a.select()}},null,null,-2);k.attachListener(k,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){j&&CKEDITOR.env.webkit&&(j=d._.previousActive&&d._.previousActive.equals(f.getActive()));d.unlockSelection(j);j=0},null,null,-1);k.attachListener(k,"mousedown",function(){j=0});if(CKEDITOR.env.ie||w){u?k.attachListener(k,"beforedeactivate",b,null,null,-1):k.attachListener(d,"selectionCheck",b,null,null,-1);k.attachListener(k,CKEDITOR.env.webkit?"DOMFocusOut":"blur",function(){d.lockSelection(C);j=1},null,null,-1);k.attachListener(k,"mousedown",function(){j=0})}if(CKEDITOR.env.ie&&!w){var A;k.attachListener(k,"mousedown",function(a){if(a.data.$.button==2){a=d.document.getSelection();if(!a||a.getType()==CKEDITOR.SELECTION_NONE)A=d.window.getScrollPosition()}});k.attachListener(k,"mouseup",function(a){if(a.data.$.button==2&&A){d.document.$.documentElement.scrollLeft=A.x;d.document.$.documentElement.scrollTop=A.y}A=null});if(f.$.compatMode!="BackCompat"){if(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)n.on("mousedown",function(a){function b(a){a=a.data.$;if(d){var c=i.$.createTextRange();try{c.moveToPoint(a.clientX,a.clientY)}catch(e){}d.setEndPoint(f.compareEndPoints("StartToStart",c)<0?"EndToEnd":"StartToStart",c);d.select()}}function c(){n.removeListener("mousemove",b);g.removeListener("mouseup",c);n.removeListener("mouseup",c);d.select()}a=a.data;if(a.getTarget().is("html")&&a.$.y<n.$.clientHeight&&a.$.x<n.$.clientWidth){var d=i.$.createTextRange();try{d.moveToPoint(a.$.clientX,a.$.clientY)}catch(e){}var f=d.duplicate();n.on("mousemove",b);g.on("mouseup",c);n.on("mouseup",c)}});if(CKEDITOR.env.version>7&&CKEDITOR.env.version<11)n.on("mousedown",function(a){if(a.data.getTarget().is("html")){g.on("mouseup",c);n.on("mouseup",c)}})}}k.attachListener(k,"selectionchange",a,d);k.attachListener(k,"keyup",e,d);k.attachListener(k,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){d.forceNextSelectionCheck();d.selectionChange(1)});if(w&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)){var x;k.attachListener(k,"mousedown",function(){x=1});k.attachListener(f.getDocumentElement(),"mouseup",function(){x&&e.call(d);x=0})}else k.attachListener(CKEDITOR.env.ie?k:f.getDocumentElement(),"mouseup",e,d);CKEDITOR.env.webkit&&k.attachListener(f,"keydown",function(a){switch(a.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:h(k)}},null,null,-1);k.attachListener(k,"keydown",t(d),null,null,-1)});d.on("setData",function(){d.unlockSelection();CKEDITOR.env.webkit&&c()});d.on("contentDomUnload",function(){d.unlockSelection()});if(CKEDITOR.env.ie9Compat)d.on("beforeDestroy",c,null,null,9);d.on("dataReady",function(){delete d._.fakeSelection;delete d._.hiddenSelectionContainer;d.selectionChange(1)});d.on("loadSnapshot",function(){var a=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT),b=d.editable().getLast(a);if(b&&b.hasAttribute("data-cke-hidden-sel")){b.remove();if(CKEDITOR.env.gecko)(a=d.editable().getFirst(a))&&(a.is("br")&&a.getAttribute("_moz_editor_bogus_node"))&&a.remove()}},null,null,100);d.on("key",function(a){if(d.mode=="wysiwyg"){var b=d.getSelection();if(b.isFake){var c=j[a.data.keyCode];if(c)return c({editor:d,selected:b.getSelectedElement(),selection:b,keyEvent:a})}}})});CKEDITOR.on("instanceReady",function(a){function b(){var a=e.editable();if(a)if(a=d(a)){var c=e.document.$.getSelection();if(c.type!="None"&&(c.anchorNode==a.$||c.focusNode==a.$))j=i(c);f=a.getText();a.setText(l(f))}}function c(){var a=e.editable();if(a)if(a=d(a)){a.setText(f);if(j){g(e.document.$,j);j=null}}}var e=a.editor,f,j;if(CKEDITOR.env.webkit){e.on("selectionChange",function(){var a=e.editable(),b=d(a);b&&(b.getCustomData("ready")?h(a):b.setCustomData("ready",1))},null,null,-1);e.on("beforeSetMode",function(){h(e.editable())},null,null,-1);e.on("beforeUndoImage",b);e.on("afterUndoImage",c);e.on("beforeGetData",b,null,null,0);e.on("getData",c)}});CKEDITOR.editor.prototype.selectionChange=function(b){(b?a:e).call(this)};CKEDITOR.editor.prototype.getSelection=function(a){if((this._.savedSelection||this._.fakeSelection)&&!a)return this._.savedSelection||this._.fakeSelection;return(a=this.editable())&&this.mode=="wysiwyg"?new CKEDITOR.dom.selection(a):null};CKEDITOR.editor.prototype.lockSelection=function(a){a=a||this.getSelection(1);if(a.getType()!=CKEDITOR.SELECTION_NONE){!a.isLocked&&a.lock();this._.savedSelection=a;return true}return false};CKEDITOR.editor.prototype.unlockSelection=function(a){var b=this._.savedSelection;if(b){b.unlock(a);delete this._.savedSelection;return true}return false};CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath};CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)};CKEDITOR.dom.range.prototype.select=function(){var a=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);a.selectRanges([this]);return a};CKEDITOR.SELECTION_NONE=1;CKEDITOR.SELECTION_TEXT=2;CKEDITOR.SELECTION_ELEMENT=3;var u=typeof window.getSelection!="function",v=1;CKEDITOR.dom.selection=function(a){if(a instanceof CKEDITOR.dom.selection)var b=a,a=a.root;var c=a instanceof CKEDITOR.dom.element;this.rev=b?b.rev:v++;this.document=a instanceof CKEDITOR.dom.document?a:a.getDocument();this.root=c?a:this.document.getBody();this.isLocked=0;this._={cache:{}};if(b){CKEDITOR.tools.extend(this._.cache,b._.cache);this.isFake=b.isFake;this.isLocked=b.isLocked;return this}var a=this.getNative(),d,e;if(a)if(a.getRangeAt)d=(e=a.rangeCount&&a.getRangeAt(0))&&new CKEDITOR.dom.node(e.commonAncestorContainer);else{try{e=a.createRange()}catch(f){}d=e&&CKEDITOR.dom.element.get(e.item&&e.item(0)||e.parentElement())}if(!d||!(d.type==CKEDITOR.NODE_ELEMENT||d.type==CKEDITOR.NODE_TEXT)||!this.root.equals(d)&&!this.root.contains(d)){this._.cache.type=CKEDITOR.SELECTION_NONE;this._.cache.startElement=null;this._.cache.selectedElement=null;this._.cache.selectedText="";this._.cache.ranges=new CKEDITOR.dom.rangeList}return this};var E={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:function(){return this._.cache.nativeSel!==void 0?this._.cache.nativeSel:this._.cache.nativeSel=u?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:u?function(){var a=this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_NONE;try{var c=this.getNative(),d=c.type;if(d=="Text")b=CKEDITOR.SELECTION_TEXT;if(d=="Control")b=CKEDITOR.SELECTION_ELEMENT;if(c.createRange().parentElement())b=CKEDITOR.SELECTION_TEXT}catch(e){}return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_TEXT,c=this.getNative();if(!c||!c.rangeCount)b=CKEDITOR.SELECTION_NONE;else if(c.rangeCount==1){var c=c.getRangeAt(0),d=c.startContainer;if(d==c.endContainer&&d.nodeType==1&&c.endOffset-c.startOffset==1&&E[d.childNodes[c.startOffset].nodeName.toLowerCase()])b=CKEDITOR.SELECTION_ELEMENT}return a.type=b},getRanges:function(){var a=u?function(){function a(b){return(new CKEDITOR.dom.node(b)).getIndex()}var b=function(b,c){b=b.duplicate();b.collapse(c);var d=b.parentElement();if(!d.hasChildNodes())return{container:d,offset:0};for(var e=d.children,f,g,h=b.duplicate(),k=0,i=e.length-1,j=-1,A,x;k<=i;){j=Math.floor((k+i)/2);f=e[j];h.moveToElementText(f);A=h.compareEndPoints("StartToStart",b);if(A>0)i=j-1;else if(A<0)k=j+1;else return{container:d,offset:a(f)}}if(j==-1||j==e.length-1&&A<0){h.moveToElementText(d);h.setEndPoint("StartToStart",b);h=h.text.replace(/(\r\n|\r)/g,"\n").length;e=d.childNodes;if(!h){f=e[e.length-1];return f.nodeType!=CKEDITOR.NODE_TEXT?{container:d,offset:e.length}:{container:f,offset:f.nodeValue.length}}for(d=e.length;h>0&&d>0;){g=e[--d];if(g.nodeType==CKEDITOR.NODE_TEXT){x=g;h=h-g.nodeValue.length}}return{container:x,offset:-h}}h.collapse(A>0?true:false);h.setEndPoint(A>0?"StartToStart":"EndToStart",b);h=h.text.replace(/(\r\n|\r)/g,"\n").length;if(!h)return{container:d,offset:a(f)+(A>0?0:1)};for(;h>0;)try{g=f[A>0?"previousSibling":"nextSibling"];if(g.nodeType==CKEDITOR.NODE_TEXT){h=h-g.nodeValue.length;x=g}f=g}catch(l){return{container:d,offset:a(f)}}return{container:x,offset:A>0?-h:x.nodeValue.length+h}};return function(){var a=this.getNative(),c=a&&a.createRange(),d=this.getType();if(!a)return[];if(d==CKEDITOR.SELECTION_TEXT){a=new CKEDITOR.dom.range(this.root);d=b(c,true);a.setStart(new CKEDITOR.dom.node(d.container),d.offset);d=b(c);a.setEnd(new CKEDITOR.dom.node(d.container),d.offset);a.endContainer.getPosition(a.startContainer)&CKEDITOR.POSITION_PRECEDING&&a.endOffset<=a.startContainer.getIndex()&&a.collapse();return[a]}if(d==CKEDITOR.SELECTION_ELEMENT){for(var d=[],e=0;e<c.length;e++){for(var f=c.item(e),g=f.parentNode,h=0,a=new CKEDITOR.dom.range(this.root);h<g.childNodes.length&&g.childNodes[h]!=f;h++);a.setStart(new CKEDITOR.dom.node(g),h);a.setEnd(new CKEDITOR.dom.node(g),h+1);d.push(a)}return d}return[]}}():function(){var a=[],b,c=this.getNative();if(!c)return a;for(var d=0;d<c.rangeCount;d++){var e=c.getRangeAt(d);b=new CKEDITOR.dom.range(this.root);b.setStart(new CKEDITOR.dom.node(e.startContainer),e.startOffset);b.setEnd(new CKEDITOR.dom.node(e.endContainer),e.endOffset);a.push(b)}return a};return function(b){var c=this._.cache,d=c.ranges;if(!d)c.ranges=d=new CKEDITOR.dom.rangeList(a.call(this));return!b?d:s(new CKEDITOR.dom.rangeList(d.slice()))}}(),getStartElement:function(){var a=this._.cache;if(a.startElement!==void 0)return a.startElement;var b;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var c=this.getRanges()[0];if(c){if(c.collapsed){b=c.startContainer;b.type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent())}else{for(c.optimize();;){b=c.startContainer;if(c.startOffset==(b.getChildCount?b.getChildCount():b.getLength())&&!b.isBlockBoundary())c.setStartAfter(b);else break}b=c.startContainer;if(b.type!=CKEDITOR.NODE_ELEMENT)return b.getParent();b=b.getChild(c.startOffset);if(!b||b.type!=CKEDITOR.NODE_ELEMENT)b=c.startContainer;else for(c=b.getFirst();c&&c.type==CKEDITOR.NODE_ELEMENT;){b=c;c=c.getFirst()}}b=b.$}}return a.startElement=b?new CKEDITOR.dom.element(b):null},getSelectedElement:function(){var a=this._.cache;if(a.selectedElement!==void 0)return a.selectedElement;var b=this,c=CKEDITOR.tools.tryThese(function(){return b.getNative().createRange().item(0)},function(){for(var a=b.getRanges()[0].clone(),c,d,e=2;e&&(!(c=a.getEnclosedNode())||!(c.type==CKEDITOR.NODE_ELEMENT&&E[c.getName()]&&(d=c)));e--)a.shrink(CKEDITOR.SHRINK_ELEMENT);return d&&d.$});return a.selectedElement=c?new CKEDITOR.dom.element(c):null},getSelectedText:function(){var a=this._.cache;if(a.selectedText!==void 0)return a.selectedText;var b=this.getNative(),b=u?b.type=="Control"?"":b.createRange().text:b.toString();return a.selectedText=b},lock:function(){this.getRanges();this.getStartElement();this.getSelectedElement();this.getSelectedText();this._.cache.nativeSel=null;this.isLocked=1},unlock:function(a){if(this.isLocked){if(a)var b=this.getSelectedElement(),c=!b&&this.getRanges(),d=this.isFake;this.isLocked=0;this.reset();if(a)(a=b||c[0]&&c[0].getCommonAncestor())&&a.getAscendant("body",1)&&(d?this.fake(b):b?this.selectElement(b):this.selectRanges(c))}},reset:function(){this._.cache={};this.isFake=0;var a=this.root.editor;if(a&&a._.fakeSelection&&this.rev==a._.fakeSelection.rev){delete a._.fakeSelection;var b=a._.hiddenSelectionContainer;if(b){var c=a.checkDirty();a.fire("lockSnapshot");b.remove();a.fire("unlockSnapshot");!c&&a.resetDirty()}delete a._.hiddenSelectionContainer}this.rev=v++},selectElement:function(a){var b=new CKEDITOR.dom.range(this.root);b.setStartBefore(a);b.setEndAfter(a);this.selectRanges([b])},selectRanges:function(a){var b=this.root.editor,b=b&&b._.hiddenSelectionContainer;this.reset();if(b)for(var b=this.root,c,d=0;d<a.length;++d){c=a[d];if(c.endContainer.equals(b))c.endOffset=Math.min(c.endOffset,b.getChildCount())}if(a.length)if(this.isLocked){var e=CKEDITOR.document.getActive();this.unlock();this.selectRanges(a);this.lock();e&&!e.equals(this.root)&&e.focus()}else{var g;a:{var i,j;if(a.length==1&&!(j=a[0]).collapsed&&(g=j.getEnclosedNode())&&g.type==CKEDITOR.NODE_ELEMENT){j=j.clone();j.shrink(CKEDITOR.SHRINK_ELEMENT,true);if((i=j.getEnclosedNode())&&i.type==CKEDITOR.NODE_ELEMENT)g=i;if(g.getAttribute("contenteditable")=="false")break a}g=void 0}if(g)this.fake(g);else{if(u){j=CKEDITOR.dom.walker.whitespaces(true);i=/\ufeff|\u00a0/;b={table:1,tbody:1,tr:1};if(a.length>1){g=a[a.length-1];a[0].setEnd(g.endContainer,g.endOffset)}g=a[0];var a=g.collapsed,l,m,w;if((c=g.getEnclosedNode())&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in E&&(!c.is("a")||!c.getText()))try{w=c.$.createControlRange();w.addElement(c.$);w.select();return}catch(H){}if(g.startContainer.type==CKEDITOR.NODE_ELEMENT&&g.startContainer.getName()in b||g.endContainer.type==CKEDITOR.NODE_ELEMENT&&g.endContainer.getName()in b){g.shrink(CKEDITOR.NODE_ELEMENT,true);a=g.collapsed}w=g.createBookmark();b=w.startNode;if(!a)e=w.endNode;w=g.document.$.body.createTextRange();w.moveToElementText(b.$);w.moveStart("character",1);if(e){i=g.document.$.body.createTextRange();i.moveToElementText(e.$);w.setEndPoint("EndToEnd",i);w.moveEnd("character",-1)}else{l=b.getNext(j);m=b.hasAscendant("pre");l=!(l&&l.getText&&l.getText().match(i))&&(m||!b.hasPrevious()||b.getPrevious().is&&b.getPrevious().is("br"));m=g.document.createElement("span");m.setHtml("&#65279;");m.insertBefore(b);l&&g.document.createText("﻿").insertBefore(b)}g.setStartBefore(b);b.remove();if(a){if(l){w.moveStart("character",-1);w.select();g.document.$.selection.clear()}else w.select();g.moveToPosition(m,CKEDITOR.POSITION_BEFORE_START);m.remove()}else{g.setEndBefore(e);e.remove();w.select()}}else{e=this.getNative();if(!e)return;this.removeAllRanges();for(w=0;w<a.length;w++){if(w<a.length-1){l=a[w];m=a[w+1];i=l.clone();i.setStart(l.endContainer,l.endOffset);i.setEnd(m.startContainer,m.startOffset);if(!i.collapsed){i.shrink(CKEDITOR.NODE_ELEMENT,true);g=i.getCommonAncestor();i=i.getEnclosedNode();if(g.isReadOnly()||i&&i.isReadOnly()){m.setStart(l.startContainer,l.startOffset);a.splice(w--,1);continue}}}g=a[w];m=this.document.$.createRange();if(g.collapsed&&CKEDITOR.env.webkit&&f(g)){l=this.root;h(l,false);i=l.getDocument().createText("​");l.setCustomData("cke-fillingChar",i);g.insertNode(i);if((l=i.getNext())&&!i.getPrevious()&&l.type==CKEDITOR.NODE_ELEMENT&&l.getName()=="br"){h(this.root);g.moveToPosition(l,CKEDITOR.POSITION_BEFORE_START)}else g.moveToPosition(i,CKEDITOR.POSITION_AFTER_END)}m.setStart(g.startContainer.$,g.startOffset);try{m.setEnd(g.endContainer.$,g.endOffset)}catch(C){if(C.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){g.collapse(1);m.setEnd(g.endContainer.$,g.endOffset)}else throw C;}e.addRange(m)}}this.reset();this.root.fire("selectionchange")}}},fake:function(a){var b=this.root.editor;this.reset();m(b);var c=this._.cache,d=new CKEDITOR.dom.range(this.root);d.setStartBefore(a);d.setEndAfter(a);c.ranges=new CKEDITOR.dom.rangeList(d);c.selectedElement=c.startElement=a;c.type=CKEDITOR.SELECTION_ELEMENT;c.selectedText=c.nativeSel=null;this.isFake=1;this.rev=v++;b._.fakeSelection=this;this.root.fire("selectionchange")},isHidden:function(){var a=this.getCommonAncestor();a&&a.type==CKEDITOR.NODE_TEXT&&(a=a.getParent());return!(!a||!a.data("cke-hidden-sel"))},createBookmarks:function(a){a=this.getRanges().createBookmarks(a);this.isFake&&(a.isFake=1);return a},createBookmarks2:function(a){a=this.getRanges().createBookmarks2(a);this.isFake&&(a.isFake=1);return a},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var d=new CKEDITOR.dom.range(this.root);d.moveToBookmark(a[c]);b.push(d)}a.isFake?this.fake(b[0].getEnclosedNode()):this.selectRanges(b);return this},getCommonAncestor:function(){var a=this.getRanges();return!a.length?null:a[0].startContainer.getCommonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){this.type!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var a=this.getNative();try{a&&a[u?"empty":"removeAllRanges"]()}catch(b){}this.reset()}}}})();"use strict";CKEDITOR.STYLE_BLOCK=1;CKEDITOR.STYLE_INLINE=2;CKEDITOR.STYLE_OBJECT=3;(function(){function a(a,b){for(var c,d;a=a.getParent();){if(a.equals(b))break;if(a.getAttribute("data-nostyle"))c=a;else if(!d){var e=a.getAttribute("contentEditable");e=="false"?c=a:e=="true"&&(d=1)}}return c}function e(b){var d=b.document;if(b.collapsed){d=j(this,d);b.insertNode(d);b.moveToPosition(d,CKEDITOR.POSITION_BEFORE_END)}else{var f=this.element,g=this._.definition,h,i=g.ignoreReadonly,k=i||g.includeReadonly;k==null&&(k=b.root.getCustomData("cke_includeReadonly"));var l=CKEDITOR.dtd[f];if(!l){h=true;l=CKEDITOR.dtd.span}b.enlarge(CKEDITOR.ENLARGE_INLINE,1);b.trim();var m=b.createBookmark(),n=m.startNode,p=m.endNode,o=n,q;if(!i){var t=b.getCommonAncestor(),i=a(n,t),t=a(p,t);i&&(o=i.getNextSourceNode(true));t&&(p=t)}for(o.getPosition(p)==CKEDITOR.POSITION_FOLLOWING&&(o=0);o;){i=false;if(o.equals(p)){o=null;i=true}else{var s=o.type==CKEDITOR.NODE_ELEMENT?o.getName():null,t=s&&o.getAttribute("contentEditable")=="false",r=s&&o.getAttribute("data-nostyle");if(s&&o.data("cke-bookmark")){o=o.getNextSourceNode(true);continue}if(t&&k&&CKEDITOR.dtd.$block[s])for(var v=o,u=c(v),z=void 0,D=u.length,E=0,v=D&&new CKEDITOR.dom.range(v.getDocument());E<D;++E){var z=u[E],M=CKEDITOR.filter.instances[z.data("cke-filter")];if(M?M.check(this):1){v.selectNodeContents(z);e.call(this,v)}}u=s?!l[s]||r?0:t&&!k?0:(o.getPosition(p)|L)==L&&(!g.childRule||g.childRule(o)):1;if(u)if((u=o.getParent())&&((u.getDtd()||CKEDITOR.dtd.span)[f]||h)&&(!g.parentRule||g.parentRule(u))){if(!q&&(!s||!CKEDITOR.dtd.$removeEmpty[s]||(o.getPosition(p)|L)==L)){q=b.clone();q.setStartBefore(o)}s=o.type;if(s==CKEDITOR.NODE_TEXT||t||s==CKEDITOR.NODE_ELEMENT&&!o.getChildCount()){for(var s=o,U;(i=!s.getNext(J))&&(U=s.getParent(),l[U.getName()])&&(U.getPosition(n)|B)==B&&(!g.childRule||g.childRule(U));)s=U;q.setEndAfter(s)}}else i=true;else i=true;o=o.getNextSourceNode(r||t)}if(i&&q&&!q.collapsed){for(var i=j(this,d),t=i.hasAttributes(),r=q.getCommonAncestor(),s={},u={},z={},D={},O,R,X;i&&r;){if(r.getName()==f){for(O in g.attributes)if(!D[O]&&(X=r.getAttribute(R)))i.getAttribute(O)==X?u[O]=1:D[O]=1;for(R in g.styles)if(!z[R]&&(X=r.getStyle(R)))i.getStyle(R)==X?s[R]=1:z[R]=1}r=r.getParent()}for(O in u)i.removeAttribute(O);for(R in s)i.removeStyle(R);t&&!i.hasAttributes()&&(i=null);if(i){q.extractContents().appendTo(i);q.insertNode(i);y.call(this,i);i.mergeSiblings();CKEDITOR.env.ie||i.$.normalize()}else{i=new CKEDITOR.dom.element("span");q.extractContents().appendTo(i);q.insertNode(i);y.call(this,i);i.remove(true)}q=null}}b.moveToBookmark(m);b.shrink(CKEDITOR.SHRINK_TEXT);b.shrink(CKEDITOR.NODE_ELEMENT,true)}}function b(a){function b(){for(var a=new CKEDITOR.dom.elementPath(d.getParent()),c=new CKEDITOR.dom.elementPath(j.getParent()),e=null,f=null,g=0;g<a.elements.length;g++){var h=a.elements[g];if(h==a.block||h==a.blockLimit)break;k.checkElementRemovable(h,true)&&(e=h)}for(g=0;g<c.elements.length;g++){h=c.elements[g];if(h==c.block||h==c.blockLimit)break;k.checkElementRemovable(h,true)&&(f=h)}f&&j.breakParent(f);e&&d.breakParent(e)}a.enlarge(CKEDITOR.ENLARGE_INLINE,1);var c=a.createBookmark(),d=c.startNode;if(a.collapsed){for(var e=new CKEDITOR.dom.elementPath(d.getParent(),a.root),f,g=0,h;g<e.elements.length&&(h=e.elements[g]);g++){if(h==e.block||h==e.blockLimit)break;if(this.checkElementRemovable(h)){var i;if(a.collapsed&&(a.checkBoundaryOfElement(h,CKEDITOR.END)||(i=a.checkBoundaryOfElement(h,CKEDITOR.START)))){f=h;f.match=i?"start":"end"}else{h.mergeSiblings();h.is(this.element)?s.call(this,h):p(h,E(this)[h.getName()])}}}if(f){h=d;for(g=0;;g++){i=e.elements[g];if(i.equals(f))break;else if(i.match)continue;else i=i.clone();i.append(h);h=i}h[f.match=="start"?"insertBefore":"insertAfter"](f)}}else{var j=c.endNode,k=this;b();for(e=d;!e.equals(j);){f=e.getNextSourceNode();if(e.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(e)){e.getName()==this.element?s.call(this,e):p(e,E(this)[e.getName()]);if(f.type==CKEDITOR.NODE_ELEMENT&&f.contains(d)){b();f=d.getNext()}}e=f}}a.moveToBookmark(c);a.shrink(CKEDITOR.NODE_ELEMENT,true)}function c(a){var b=[];a.forEach(function(a){if(a.getAttribute("contenteditable")=="true"){b.push(a);return false}},CKEDITOR.NODE_ELEMENT,true);return b}function f(a){var b=a.getEnclosedNode()||a.getCommonAncestor(false,true);(a=(new CKEDITOR.dom.elementPath(b,a.root)).contains(this.element,1))&&!a.isReadOnly()&&u(a,this)}function d(a){var b=a.getCommonAncestor(true,true);if(a=(new CKEDITOR.dom.elementPath(b,a.root)).contains(this.element,1)){var b=this._.definition,c=b.attributes;if(c)for(var d in c)a.removeAttribute(d,c[d]);if(b.styles)for(var e in b.styles)b.styles.hasOwnProperty(e)&&a.removeStyle(e)}}function h(a){var b=a.createBookmark(true),c=a.createIterator();c.enforceRealBlocks=true;if(this._.enterMode)c.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var d,e=a.document,f;d=c.getNextParagraph();)if(!d.isReadOnly()&&(c.activeFilter?c.activeFilter.check(this):1)){f=j(this,e,d);i(d,f)}a.moveToBookmark(b)}function l(a){var b=a.createBookmark(1),c=a.createIterator();c.enforceRealBlocks=true;c.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var d,e;d=c.getNextParagraph();)if(this.checkElementRemovable(d))if(d.is("pre")){(e=this._.enterMode==CKEDITOR.ENTER_BR?null:a.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&d.copyAttributes(e);i(d,e)}else s.call(this,d);a.moveToBookmark(b)}function i(a,b){var c=!b;if(c){b=a.getDocument().createElement("div");a.copyAttributes(b)}var d=b&&b.is("pre"),e=a.is("pre"),f=!d&&e;if(d&&!e){e=b;(f=a.getBogus())&&f.remove();f=a.getHtml();f=m(f,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");f=f.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");f=f.replace(/([ \t\n\r]+|&nbsp;)/g," ");f=f.replace(/<br\b[^>]*>/gi,"\n");if(CKEDITOR.env.ie){var h=a.getDocument().createElement("div");h.append(e);e.$.outerHTML="<pre>"+f+"</pre>";e.copyAttributes(h.getFirst());e=h.getFirst().remove()}else e.setHtml(f);b=e}else f?b=t(c?[a.getHtml()]:g(a),b):a.moveChildren(b);b.replace(a);if(d){var c=b,i;if((i=c.getPrevious(z))&&i.type==CKEDITOR.NODE_ELEMENT&&i.is("pre")){d=m(i.getHtml(),/\n$/,"")+"\n\n"+m(c.getHtml(),/^\n/,"");CKEDITOR.env.ie?c.$.outerHTML="<pre>"+d+"</pre>":c.setHtml(d);i.remove()}}else c&&q(b)}function g(a){var b=[];m(a.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,c){b.push(c)});return b}function m(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(e=c);return""});return d+a.replace(b,c)+e}function t(a,b){var c;a.length>1&&(c=new CKEDITOR.dom.documentFragment(b.getDocument()));for(var d=0;d<a.length;d++){var e=a[d],e=e.replace(/(\r\n|\r)/g,"\n"),e=m(e,/^[ \t]*\n/,""),e=m(e,/\n$/,""),e=m(e,/^[ \t]+|[ \t]+$/g,function(a,b){return a.length==1?"&nbsp;":b?" "+CKEDITOR.tools.repeat("&nbsp;",a.length-1):CKEDITOR.tools.repeat("&nbsp;",a.length-1)+" "}),e=e.replace(/\n/g,"<br>"),e=e.replace(/[ \t]{2,}/g,function(a){return CKEDITOR.tools.repeat("&nbsp;",a.length-1)+" "});if(c){var f=b.clone();f.setHtml(e);c.append(f)}else b.setHtml(e)}return c||b}function s(a,b){var c=this._.definition,d=c.attributes,c=c.styles,e=E(this)[a.getName()],f=CKEDITOR.tools.isEmpty(d)&&CKEDITOR.tools.isEmpty(c),g;for(g in d)if(!((g=="class"||this._.definition.fullMatch)&&a.getAttribute(g)!=k(g,d[g]))&&!(b&&g.slice(0,5)=="data-")){f=a.hasAttribute(g);a.removeAttribute(g)}for(var h in c)if(!(this._.definition.fullMatch&&a.getStyle(h)!=k(h,c[h],true))){f=f||!!a.getStyle(h);a.removeStyle(h)}p(a,e,r[a.getName()]);f&&(this._.definition.alwaysRemoveElement?q(a,1):!CKEDITOR.dtd.$block[a.getName()]||this._.enterMode==CKEDITOR.ENTER_BR&&!a.hasAttributes()?q(a):a.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function y(a){for(var b=E(this),c=a.getElementsByTag(this.element),d,e=c.count();--e>=0;){d=c.getItem(e);d.isReadOnly()||s.call(this,d,true)}for(var f in b)if(f!=this.element){c=a.getElementsByTag(f);for(e=c.count()-1;e>=0;e--){d=c.getItem(e);d.isReadOnly()||p(d,b[f])}}}function p(a,b,c){if(b=b&&b.attributes)for(var d=0;d<b.length;d++){var e=b[d][0],f;if(f=a.getAttribute(e)){var g=b[d][1];(g===null||g.test&&g.test(f)||typeof g=="string"&&f==g)&&a.removeAttribute(e)}}c||q(a)}function q(a,b){if(!a.hasAttributes()||b)if(CKEDITOR.dtd.$block[a.getName()]){var c=a.getPrevious(z),d=a.getNext(z);c&&(c.type==CKEDITOR.NODE_TEXT||!c.isBlockBoundary({br:1}))&&a.append("br",1);d&&(d.type==CKEDITOR.NODE_TEXT||!d.isBlockBoundary({br:1}))&&a.append("br");a.remove(true)}else{c=a.getFirst();d=a.getLast();a.remove(true);if(c){c.type==CKEDITOR.NODE_ELEMENT&&c.mergeSiblings();d&&(!c.equals(d)&&d.type==CKEDITOR.NODE_ELEMENT)&&d.mergeSiblings()}}}function j(a,b,c){var d;d=a.element;d=="*"&&(d="span");d=new CKEDITOR.dom.element(d,b);c&&c.copyAttributes(d);d=u(d,a);b.getCustomData("doc_processing_style")&&d.hasAttribute("id")?d.removeAttribute("id"):b.setCustomData("doc_processing_style",1);return d}function u(a,b){var c=b._.definition,d=c.attributes,c=CKEDITOR.style.getStyleText(c);if(d)for(var e in d)a.setAttribute(e,d[e]);c&&a.setAttribute("style",c);return a}function v(a,b){for(var c in a)a[c]=a[c].replace(D,function(a,c){return b[c]})}function E(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;if(c){CKEDITOR.tools.isArray(c)||(c=[c]);for(var d=0;d<c.length;d++){var e=c[d],f,g;if(typeof e=="string")f=e.toLowerCase();else{f=e.element?e.element.toLowerCase():a.element;g=e.attributes}e=b[f]||(b[f]={});if(g){var e=e.attributes=e.attributes||[],h;for(h in g)e.push([h.toLowerCase(),g[h]])}}}return b}function k(a,b,c){var d=new CKEDITOR.dom.element("span");d[c?"setStyle":"setAttribute"](a,b);return d[c?"getStyle":"getAttribute"](a)}function n(a,b,c){for(var d=a.document,e=a.getRanges(),b=b?this.removeFromRange:this.applyToRange,f,g=e.createIterator();f=g.getNextRange();)b.call(this,f,c);a.selectRanges(e);d.removeCustomData("doc_processing_style")}var r={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},o={a:1,blockquote:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},M=/\s*(?:;\s*|$)/,D=/#\((.+?)\)/g,J=CKEDITOR.dom.walker.bookmark(0,1),z=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(a,b){if(typeof a.type=="string")return new CKEDITOR.style.customHandlers[a.type](a);var c=a.attributes;if(c&&c.style){a.styles=CKEDITOR.tools.extend({},a.styles,CKEDITOR.tools.parseCssText(c.style));delete c.style}if(b){a=CKEDITOR.tools.clone(a);v(a.attributes,b);v(a.styles,b)}c=this.element=a.element?typeof a.element=="string"?a.element.toLowerCase():a.element:"*";this.type=a.type||(r[c]?CKEDITOR.STYLE_BLOCK:o[c]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE);if(typeof this.element=="object")this.type=CKEDITOR.STYLE_OBJECT;this._={definition:a}};CKEDITOR.style.prototype={apply:function(a){if(a instanceof CKEDITOR.dom.document)return n.call(this,a.getSelection());if(this.checkApplicable(a.elementPath(),a)){var b=this._.enterMode;if(!b)this._.enterMode=a.activeEnterMode;n.call(this,a.getSelection(),0,a);this._.enterMode=b}},remove:function(a){if(a instanceof CKEDITOR.dom.document)return n.call(this,a.getSelection(),1);if(this.checkApplicable(a.elementPath(),a)){var b=this._.enterMode;if(!b)this._.enterMode=a.activeEnterMode;n.call(this,a.getSelection(),1,a);this._.enterMode=b}},applyToRange:function(a){this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?e:this.type==CKEDITOR.STYLE_BLOCK?h:this.type==CKEDITOR.STYLE_OBJECT?f:null;return this.applyToRange(a)},removeFromRange:function(a){this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?b:this.type==CKEDITOR.STYLE_BLOCK?l:this.type==CKEDITOR.STYLE_OBJECT?d:null;return this.removeFromRange(a)},applyToObject:function(a){u(a,this)},checkActive:function(a,b){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,true,b);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var c=a.elements,d=0,e;d<c.length;d++){e=c[d];if(!(this.type==CKEDITOR.STYLE_INLINE&&(e==a.block||e==a.blockLimit))){if(this.type==CKEDITOR.STYLE_OBJECT){var f=e.getName();if(!(typeof this.element=="string"?f==this.element:f in this.element))continue}if(this.checkElementRemovable(e,true,b))return true}}}return false},checkApplicable:function(a,b,c){b&&b instanceof CKEDITOR.filter&&(c=b);if(c&&!c.check(this))return false;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!a.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!a.blockLimit.getDtd()[this.element]}return true},checkElementMatch:function(a,b){var c=this._.definition;if(!a||!c.ignoreReadonly&&a.isReadOnly())return false;var d=a.getName();if(typeof this.element=="string"?d==this.element:d in this.element){if(!b&&!a.hasAttributes())return true;if(d=c._AC)c=d;else{var d={},e=0,f=c.attributes;if(f)for(var g in f){e++;d[g]=f[g]}if(g=CKEDITOR.style.getStyleText(c)){d.style||e++;d.style=g}d._length=e;c=c._AC=d}if(c._length){for(var h in c)if(h!="_length"){e=a.getAttribute(h)||"";if(h=="style")a:{d=c[h];typeof d=="string"&&(d=CKEDITOR.tools.parseCssText(d));typeof e=="string"&&(e=CKEDITOR.tools.parseCssText(e,true));g=void 0;for(g in d)if(!(g in e&&(e[g]==d[g]||d[g]=="inherit"||e[g]=="inherit"))){d=false;break a}d=true}else d=c[h]==e;if(d){if(!b)return true}else if(b)return false}if(b)return true}else return true}return false},checkElementRemovable:function(a,b,c){if(this.checkElementMatch(a,b,c))return true;if(b=E(this)[a.getName()]){var d;if(!(b=b.attributes))return true;for(c=0;c<b.length;c++){d=b[c][0];if(d=a.getAttribute(d)){var e=b[c][1];if(e===null)return true;if(typeof e=="string"){if(d==e)return true}else if(e.test(d))return true}}}return false},buildPreview:function(a){var b=this._.definition,c=[],d=b.element;d=="bdo"&&(d="span");var c=["<",d],e=b.attributes;if(e)for(var f in e)c.push(" ",f,'="',e[f],'"');(e=CKEDITOR.style.getStyleText(b))&&c.push(' style="',e,'"');c.push(">",a||b.name,"</",d,">");return c.join("")},getDefinition:function(){return this._.definition}};CKEDITOR.style.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(M,";"));for(var e in b){var f=b[e],g=(e+":"+f).replace(M,";");f=="inherit"?d=d+g:c=c+g}c.length&&(c=CKEDITOR.tools.normalizeCssText(c,true));return a._ST=c+d};CKEDITOR.style.customHandlers={};CKEDITOR.style.addCustomHandler=function(a){var b=function(a){this._={definition:a};this.setup&&this.setup(a)};b.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.style.prototype),{assignedTo:CKEDITOR.STYLE_OBJECT},a,true);return this.customHandlers[a.type]=b};var L=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,B=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED})();CKEDITOR.styleCommand=function(a,e){this.requiredContent=this.allowedContent=this.style=a;CKEDITOR.tools.extend(this,e,true)};CKEDITOR.styleCommand.prototype.exec=function(a){a.focus();this.state==CKEDITOR.TRISTATE_OFF?a.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&a.removeStyle(this.style)};CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet");CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet);CKEDITOR.loadStylesSet=function(a,e,b){CKEDITOR.stylesSet.addExternal(a,e,"");CKEDITOR.stylesSet.load(a,b)};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{attachStyleStateChange:function(a,e){var b=this._.styleStateChangeCallbacks;if(!b){b=this._.styleStateChangeCallbacks=[];this.on("selectionChange",function(a){for(var e=0;e<b.length;e++){var d=b[e],h=d.style.checkActive(a.data.path,this)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;d.fn.call(this,h)}})}b.push({style:a,fn:e})},applyStyle:function(a){a.apply(this)},removeStyle:function(a){a.remove(this)},getStylesSet:function(a){if(this._.stylesDefinitions)a(this._.stylesDefinitions);else{var e=this,b=e.config.stylesCombo_stylesSet||e.config.stylesSet;if(b===false)a(null);else if(b instanceof Array){e._.stylesDefinitions=b;a(b)}else{b||(b="default");var b=b.split(":"),c=b[0];CKEDITOR.stylesSet.addExternal(c,b[1]?b.slice(1).join(":"):CKEDITOR.getUrl("styles.js"),"");CKEDITOR.stylesSet.load(c,function(b){e._.stylesDefinitions=b[c];a(e._.stylesDefinitions)})}}}});CKEDITOR.dom.comment=function(a,e){typeof a=="string"&&(a=(e?e.$:document).createComment(a));CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.comment.prototype=new CKEDITOR.dom.node;CKEDITOR.tools.extend(CKEDITOR.dom.comment.prototype,{type:CKEDITOR.NODE_COMMENT,getOuterHtml:function(){return"<\!--"+this.$.nodeValue+"--\>"}});"use strict";(function(){var a={},e={},b;for(b in CKEDITOR.dtd.$blockLimit)b in CKEDITOR.dtd.$list||(a[b]=1);for(b in CKEDITOR.dtd.$block)b in CKEDITOR.dtd.$blockLimit||b in CKEDITOR.dtd.$empty||(e[b]=1);CKEDITOR.dom.elementPath=function(b,f){var d=null,h=null,l=[],i=b,g,f=f||b.getDocument().getBody();do if(i.type==CKEDITOR.NODE_ELEMENT){l.push(i);if(!this.lastElement){this.lastElement=i;if(i.is(CKEDITOR.dtd.$object)||i.getAttribute("contenteditable")=="false")continue}if(i.equals(f))break;if(!h){g=i.getName();i.getAttribute("contenteditable")=="true"?h=i:!d&&e[g]&&(d=i);if(a[g]){var m;if(m=!d){if(g=g=="div"){a:{g=i.getChildren();m=0;for(var t=g.count();m<t;m++){var s=g.getItem(m);if(s.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$block[s.getName()]){g=true;break a}}g=false}g=!g}m=g}m?d=i:h=i}}}while(i=i.getParent());h||(h=f);this.block=d;this.blockLimit=h;this.root=f;this.elements=l}})();CKEDITOR.dom.elementPath.prototype={compare:function(a){var e=this.elements,a=a&&a.elements;if(!a||e.length!=a.length)return false;for(var b=0;b<e.length;b++)if(!e[b].equals(a[b]))return false;return true},contains:function(a,e,b){var c;typeof a=="string"&&(c=function(b){return b.getName()==a});a instanceof CKEDITOR.dom.element?c=function(b){return b.equals(a)}:CKEDITOR.tools.isArray(a)?c=function(b){return CKEDITOR.tools.indexOf(a,b.getName())>-1}:typeof a=="function"?c=a:typeof a=="object"&&(c=function(b){return b.getName()in a});var f=this.elements,d=f.length;e&&d--;if(b){f=Array.prototype.slice.call(f,0);f.reverse()}for(e=0;e<d;e++)if(c(f[e]))return f[e];return null},isContextFor:function(a){var e;if(a in CKEDITOR.dtd.$block){e=this.contains(CKEDITOR.dtd.$intermediate)||this.root.equals(this.block)&&this.block||this.blockLimit;return!!e.getDtd()[a]}return true},direction:function(){return(this.block||this.blockLimit||this.root).getDirection(1)}};CKEDITOR.dom.text=function(a,e){typeof a=="string"&&(a=(e?e.$:document).createTextNode(a));this.$=a};CKEDITOR.dom.text.prototype=new CKEDITOR.dom.node;CKEDITOR.tools.extend(CKEDITOR.dom.text.prototype,{type:CKEDITOR.NODE_TEXT,getLength:function(){return this.$.nodeValue.length},getText:function(){return this.$.nodeValue},setText:function(a){this.$.nodeValue=a},split:function(a){var e=this.$.parentNode,b=e.childNodes.length,c=this.getLength(),f=this.getDocument(),d=new CKEDITOR.dom.text(this.$.splitText(a),f);if(e.childNodes.length==b)if(a>=c){d=f.createText("");d.insertAfter(this)}else{a=f.createText("");a.insertAfter(d);a.remove()}return d},substring:function(a,e){return typeof e!="number"?this.$.nodeValue.substr(a):this.$.nodeValue.substring(a,e)}});(function(){function a(a,c,e){var d=a.serializable,h=c[e?"endContainer":"startContainer"],l=e?"endOffset":"startOffset",i=d?c.document.getById(a.startNode):a.startNode,a=d?c.document.getById(a.endNode):a.endNode;if(h.equals(i.getPrevious())){c.startOffset=c.startOffset-h.getLength()-a.getPrevious().getLength();h=a.getNext()}else if(h.equals(a.getPrevious())){c.startOffset=c.startOffset-h.getLength();h=a.getNext()}h.equals(i.getParent())&&c[l]++;h.equals(a.getParent())&&c[l]++;c[e?"endContainer":"startContainer"]=h;return c}CKEDITOR.dom.rangeList=function(a){if(a instanceof CKEDITOR.dom.rangeList)return a;a?a instanceof CKEDITOR.dom.range&&(a=[a]):a=[];return CKEDITOR.tools.extend(a,e)};var e={createIterator:function(){var a=this,c=CKEDITOR.dom.walker.bookmark(),e=[],d;return{getNextRange:function(h){d=d===void 0?0:d+1;var l=a[d];if(l&&a.length>1){if(!d)for(var i=a.length-1;i>=0;i--)e.unshift(a[i].createBookmark(true));if(h)for(var g=0;a[d+g+1];){for(var m=l.document,h=0,i=m.getById(e[g].endNode),m=m.getById(e[g+
1].startNode);;){i=i.getNextSourceNode(false);if(m.equals(i))h=1;else if(c(i)||i.type==CKEDITOR.NODE_ELEMENT&&i.isBlockBoundary())continue;break}if(!h)break;g++}for(l.moveToBookmark(e.shift());g--;){i=a[++d];i.moveToBookmark(e.shift());l.setEnd(i.endContainer,i.endOffset)}}return l}}},createBookmarks:function(b){for(var c=[],e,d=0;d<this.length;d++){c.push(e=this[d].createBookmark(b,true));for(var h=d+1;h<this.length;h++){this[h]=a(e,this[h]);this[h]=a(e,this[h],true)}}return c},createBookmarks2:function(a){for(var c=[],e=0;e<this.length;e++)c.push(this[e].createBookmark2(a));return c},moveToBookmarks:function(a){for(var c=0;c<this.length;c++)this[c].moveToBookmark(a[c])}}})();(function(){function a(){return CKEDITOR.getUrl(CKEDITOR.skinName.split(",")[1]||"skins/"+CKEDITOR.skinName.split(",")[0]+"/")}function e(b){var c=CKEDITOR.skin["ua_"+b],d=CKEDITOR.env;if(c)for(var c=c.split(",").sort(function(a,b){return a>b?-1:1}),e=0,f;e<c.length;e++){f=c[e];if(d.ie&&(f.replace(/^ie/,"")==d.version||d.quirks&&f=="iequirks"))f="ie";if(d[f]){b=b+("_"+c[e]);break}}return CKEDITOR.getUrl(a()+b+".css")}function b(a,b){if(!d[a]){CKEDITOR.document.appendStyleSheet(e(a));d[a]=1}b&&b()}
function c(a){var b=a.getById(h);if(!b){b=a.getHead().append("style");b.setAttribute("id",h);b.setAttribute("type","text/css")}return b}function f(a,b,c){var d,e,f;if(CKEDITOR.env.webkit){b=b.split("}").slice(0,-1);for(e=0;e<b.length;e++)b[e]=b[e].split("{")}for(var h=0;h<a.length;h++)if(CKEDITOR.env.webkit)for(e=0;e<b.length;e++){f=b[e][1];for(d=0;d<c.length;d++)f=f.replace(c[d][0],c[d][1]);a[h].$.sheet.addRule(b[e][0],f)}else{f=b;for(d=0;d<c.length;d++)f=f.replace(c[d][0],c[d][1]);CKEDITOR.env.ie&&CKEDITOR.env.version<11?a[h].$.styleSheet.cssText=a[h].$.styleSheet.cssText+f:a[h].$.innerHTML=a[h].$.innerHTML+f}}var d={};CKEDITOR.skin={path:a,loadPart:function(c,d){CKEDITOR.skin.name!=CKEDITOR.skinName.split(",")[0]?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(a()+"skin.js"),function(){b(c,d)}):b(c,d)},getPath:function(a){return CKEDITOR.getUrl(e(a))},icons:{},addIcon:function(a,b,c,d){a=a.toLowerCase();this.icons[a]||(this.icons[a]={path:b,offset:c||0,bgsize:d||"16px"})},getIconStyle:function(a,b,c,d,e){var f;if(a){a=a.toLowerCase();b&&(f=this.icons[a+"-rtl"]);f||(f=this.icons[a])}a=c||f&&f.path||"";d=d||f&&f.offset;e=e||f&&f.bgsize||"16px";return a&&"background-image:url("+CKEDITOR.getUrl(a)+");background-position:0 "+d+"px;background-size:"+e+";"}};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{getUiColor:function(){return this.uiColor},setUiColor:function(a){var b=c(CKEDITOR.document);return(this.setUiColor=function(a){var c=CKEDITOR.skin.chameleon,d=[[i,a]];this.uiColor=a;f([b],c(this,"editor"),d);f(l,c(this,"panel"),d)}).call(this,a)}});var h="cke_ui_color",l=[],i=/\$color/g;CKEDITOR.on("instanceLoaded",function(a){if(!CKEDITOR.env.ie||!CKEDITOR.env.quirks){var b=a.editor,a=function(a){a=(a.data[0]||a.data).element.getElementsByTag("iframe").getItem(0).getFrameDocument();if(!a.getById("cke_ui_color")){a=c(a);l.push(a);var d=b.getUiColor();d&&f([a],CKEDITOR.skin.chameleon(b,"panel"),[[i,d]])}};b.on("panelShow",a);b.on("menuShow",a);b.config.uiColor&&b.setUiColor(b.config.uiColor)}})})();(function(){if(CKEDITOR.env.webkit)CKEDITOR.env.hc=false;else{var a=CKEDITOR.dom.element.createFromHtml('<div style="width:0;height:0;position:absolute;left:-10000px;border:1px solid;border-color:red blue"></div>',CKEDITOR.document);a.appendTo(CKEDITOR.document.getHead());try{var e=a.getComputedStyle("border-top-color"),b=a.getComputedStyle("border-right-color");CKEDITOR.env.hc=!!(e&&e==b)}catch(c){CKEDITOR.env.hc=false}a.remove()}if(CKEDITOR.env.hc)CKEDITOR.env.cssClass=CKEDITOR.env.cssClass+" cke_hc";CKEDITOR.document.appendStyleText(".cke{visibility:hidden;}");CKEDITOR.status="loaded";CKEDITOR.fireOnce("loaded");if(a=CKEDITOR._.pending){delete CKEDITOR._.pending;for(e=0;e<a.length;e++){CKEDITOR.editor.prototype.constructor.apply(a[e][0],a[e][1]);CKEDITOR.add(a[e][0])}}})();CKEDITOR.skin.name="moono";CKEDITOR.skin.ua_editor="ie,iequirks,ie7,ie8,gecko";CKEDITOR.skin.ua_dialog="ie,iequirks,ie7,ie8";CKEDITOR.skin.chameleon=function(){var b=function(){return function(b,e){for(var a=b.match(/[^#]./g),c=0;3>c;c++){var f=a,h=c,d;d=parseInt(a[c],16);d=("0"+(0>e?0|d*(1+e):0|d+(255-d)*e).toString(16)).slice(-2);f[h]=d}return"#"+a.join("")}}(),c=function(){var b=new CKEDITOR.template("background:#{to};background-image:-webkit-gradient(linear,lefttop,leftbottom,from({from}),to({to}));background-image:-moz-linear-gradient(top,{from},{to});background-image:-webkit-linear-gradient(top,{from},{to});background-image:-o-linear-gradient(top,{from},{to});background-image:-ms-linear-gradient(top,{from},{to});background-image:linear-gradient(top,{from},{to});filter:progid:DXImageTransform.Microsoft.gradient(gradientType=0,startColorstr='{from}',endColorstr='{to}');");return function(c,a){return b.output({from:c,to:a})}}(),f={editor:new CKEDITOR.template("{id}.cke_chrome [border-color:{defaultBorder};] {id} .cke_top [ {defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_bottom [{defaultGradient}border-top-color:{defaultBorder};] {id} .cke_resizer [border-right-color:{ckeResizer}] {id} .cke_dialog_title [{defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_dialog_footer [{defaultGradient}outline-color:{defaultBorder};border-top-color:{defaultBorder};] {id} .cke_dialog_tab [{lightGradient}border-color:{defaultBorder};] {id} .cke_dialog_tab:hover [{mediumGradient}] {id} .cke_dialog_contents [border-top-color:{defaultBorder};] {id} .cke_dialog_tab_selected, {id} .cke_dialog_tab_selected:hover [background:{dialogTabSelected};border-bottom-color:{dialogTabSelectedBorder};] {id} .cke_dialog_body [background:{dialogBody};border-color:{defaultBorder};] {id} .cke_toolgroup [{lightGradient}border-color:{defaultBorder};] {id} a.cke_button_off:hover, {id} a.cke_button_off:focus, {id} a.cke_button_off:active [{mediumGradient}] {id} .cke_button_on [{ckeButtonOn}] {id} .cke_toolbar_separator [background-color: {ckeToolbarSeparator};] {id} .cke_combo_button [border-color:{defaultBorder};{lightGradient}] {id} a.cke_combo_button:hover, {id} a.cke_combo_button:focus, {id} .cke_combo_on a.cke_combo_button [border-color:{defaultBorder};{mediumGradient}] {id} .cke_path_item [color:{elementsPathColor};] {id} a.cke_path_item:hover, {id} a.cke_path_item:focus, {id} a.cke_path_item:active [background-color:{elementsPathBg};] {id}.cke_panel [border-color:{defaultBorder};] "),panel:new CKEDITOR.template(".cke_panel_grouptitle [{lightGradient}border-color:{defaultBorder};] .cke_menubutton_icon [background-color:{menubuttonIcon};] .cke_menubutton:hover .cke_menubutton_icon, .cke_menubutton:focus .cke_menubutton_icon, .cke_menubutton:active .cke_menubutton_icon [background-color:{menubuttonIconHover};] .cke_menuseparator [background-color:{menubuttonIcon};] a:hover.cke_colorbox, a:focus.cke_colorbox, a:active.cke_colorbox [border-color:{defaultBorder};] a:hover.cke_colorauto, a:hover.cke_colormore, a:focus.cke_colorauto, a:focus.cke_colormore, a:active.cke_colorauto, a:active.cke_colormore [background-color:{ckeColorauto};border-color:{defaultBorder};] ")};return function(g,e){var a=g.uiColor,a={id:"."+g.id,defaultBorder:b(a,-0.1),defaultGradient:c(b(a,0.9),a),lightGradient:c(b(a,1),b(a,0.7)),mediumGradient:c(b(a,0.8),b(a,0.5)),ckeButtonOn:c(b(a,0.6),b(a,0.7)),ckeResizer:b(a,-0.4),ckeToolbarSeparator:b(a,0.5),ckeColorauto:b(a,0.8),dialogBody:b(a,0.7),dialogTabSelected:c("#FFFFFF","#FFFFFF"),dialogTabSelectedBorder:"#FFF",elementsPathColor:b(a,-0.6),elementsPathBg:a,menubuttonIcon:b(a,0.5),menubuttonIconHover:b(a,0.3)};return f[e].output(a).replace(/\[/g,"{").replace(/\]/g,"}")}}();CKEDITOR.plugins.add("dialogui",{onLoad:function(){var h=function(b){this._||(this._={});this._["default"]=this._.initValue=b["default"]||"";this._.required=b.required||!1;for(var a=[this._],d=1;d<arguments.length;d++)a.push(arguments[d]);a.push(!0);CKEDITOR.tools.extend.apply(CKEDITOR.tools,a);return this._},r={build:function(b,a,d){return new CKEDITOR.ui.dialog.textInput(b,a,d)}},l={build:function(b,a,d){return new CKEDITOR.ui.dialog[a.type](b,a,d)}},n={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(b){this.setValue(this.getInitValue(),b)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._["default"]},getInitValue:function(){return this._.initValue}},o=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(b,a){this._.domOnChangeRegistered||(b.on("load",function(){this.getInputElement().on("change",function(){b.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0);this.on("change",a)}},!0),s=/^on([A-Z]\w+)/,p=function(b){for(var a in b)(s.test(a)||"title"==a||"type"==a)&&delete b[a];return b};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(b,a,d,f){if(!(4>arguments.length)){var c=h.call(this,a);c.labelId=CKEDITOR.tools.getNextId()+"_label";this._.children=[];var e={role:a.role||"presentation"};a.includeLabel&&(e["aria-labelledby"]=c.labelId);CKEDITOR.ui.dialog.uiElement.call(this,b,a,d,"div",null,e,function(){var e=[],g=a.required?" cke_required":"";if(a.labelLayout!="horizontal")e.push('<label class="cke_dialog_ui_labeled_label'+g+'" ',' id="'+c.labelId+'"',c.inputId?' for="'+c.inputId+'"':"",(a.labelStyle?' style="'+a.labelStyle+'"':"")+">",a.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',a.controlStyle?' style="'+a.controlStyle+'"':"",' role="presentation">',f.call(this,b,a),"</div>");else{g={type:"hbox",widths:a.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+
g+'" id="'+c.labelId+'" for="'+c.inputId+'"'+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(a.label)+"</span>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(a.controlStyle?' style="'+a.controlStyle+'"':"")+">"+f.call(this,b,a)+"</span>"}]};CKEDITOR.dialog._.uiElementBuilders.hbox.build(b,g,e)}return e.join("")})}},textInput:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",c={"class":"cke_dialog_ui_input_"+
a.type,id:f,type:a.type};a.validate&&(this.validate=a.validate);a.maxLength&&(c.maxlength=a.maxLength);a.size&&(c.size=a.size);a.inputStyle&&(c.style=a.inputStyle);var e=this,k=!1;b.on("load",function(){e.getInputElement().on("keydown",function(a){a.data.getKeystroke()==13&&(k=true)});e.getInputElement().on("keyup",function(a){if(a.data.getKeystroke()==13&&k){b.getButton("ok")&&setTimeout(function(){b.getButton("ok").click()},0);k=false}},null,null,1E3)});CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){var b=['<div class="cke_dialog_ui_input_',a.type,'" role="presentation"'];a.width&&b.push('style="width:'+a.width+'" ');b.push("><input ");c["aria-labelledby"]=this._.labelId;this._.required&&(c["aria-required"]=this._.required);for(var e in c)b.push(e+'="'+c[e]+'" ');b.push(" /></div>");return b.join("")})}},textarea:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this,c=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",e={};a.validate&&(this.validate=a.validate);e.rows=a.rows||5;e.cols=a.cols||20;e["class"]="cke_dialog_ui_input_textarea "+(a["class"]||"");"undefined"!=typeof a.inputStyle&&(e.style=a.inputStyle);a.dir&&(e.dir=a.dir);CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){e["aria-labelledby"]=this._.labelId;this._.required&&(e["aria-required"]=this._.required);var a=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',c,'" '],b;for(b in e)a.push(b+'="'+CKEDITOR.tools.htmlEncode(e[b])+'" ');a.push(">",CKEDITOR.tools.htmlEncode(f._["default"]),"</textarea></div>");return a.join("")})}},checkbox:function(b,a,d){if(!(3>arguments.length)){var f=h.call(this,a,{"default":!!a["default"]});a.validate&&(this.validate=a.validate);CKEDITOR.ui.dialog.uiElement.call(this,b,a,d,"span",null,null,function(){var c=CKEDITOR.tools.extend({},a,{id:a.id?a.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},true),e=[],d=CKEDITOR.tools.getNextId()+"_label",g={"class":"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":d};p(c);if(a["default"])g.checked="checked";if(typeof c.inputStyle!="undefined")c.style=c.inputStyle;f.checkbox=new CKEDITOR.ui.dialog.uiElement(b,c,e,"input",null,g);e.push(' <label id="',d,'" for="',g.id,'"'+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(a.label),"</label>");return e.join("")})}},radio:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);this._["default"]||(this._["default"]=this._.initValue=a.items[0][1]);a.validate&&(this.validate=a.valdiate);var f=[],c=this;a.role="radiogroup";a.includeLabel=!0;CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){for(var e=[],d=[],g=(a.id?a.id:CKEDITOR.tools.getNextId())+"_radio",i=0;i<a.items.length;i++){var j=a.items[i],h=j[2]!==void 0?j[2]:j[0],l=j[1]!==void 0?j[1]:j[0],m=CKEDITOR.tools.getNextId()+"_radio_input",n=m+"_label",m=CKEDITOR.tools.extend({},a,{id:m,title:null,type:null},true),h=CKEDITOR.tools.extend({},m,{title:h},true),o={type:"radio","class":"cke_dialog_ui_radio_input",name:g,value:l,"aria-labelledby":n},q=[];if(c._["default"]==l)o.checked="checked";p(m);p(h);if(typeof m.inputStyle!="undefined")m.style=m.inputStyle;m.keyboardFocusable=true;f.push(new CKEDITOR.ui.dialog.uiElement(b,m,q,"input",null,o));q.push(" ");new CKEDITOR.ui.dialog.uiElement(b,h,q,"label",null,{id:n,"for":o.id},j[0]);e.push(q.join(""))}new CKEDITOR.ui.dialog.hbox(b,f,e,d);return d.join("")});this._.children=f}},button:function(b,a,d){if(arguments.length){"function"==typeof a&&(a=a(b.getParentEditor()));h.call(this,a,{disabled:a.disabled||!1});CKEDITOR.event.implementOn(this);var f=this;b.on("load",function(){var a=this.getElement();(function(){a.on("click",function(a){f.click();a.data.preventDefault()});a.on("keydown",function(a){a.data.getKeystroke()in{32:1}&&(f.click(),a.data.preventDefault())})})();a.unselectable()},this);var c=CKEDITOR.tools.extend({},a);delete c.style;var e=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,b,c,d,"a",null,{style:a.style,href:"javascript:void(0)",title:a.label,hidefocus:"true","class":a["class"],role:"button","aria-labelledby":e},'<span id="'+e+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(a.label)+"</span>")}},select:function(b,a,d){if(!(3>arguments.length)){var f=h.call(this,a);a.validate&&(this.validate=a.validate);f.inputId=CKEDITOR.tools.getNextId()+"_select";CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){var c=CKEDITOR.tools.extend({},a,{id:a.id?a.id+"_select":CKEDITOR.tools.getNextId()+"_select"},true),e=[],d=[],g={id:f.inputId,"class":"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};e.push('<div class="cke_dialog_ui_input_',a.type,'" role="presentation"');a.width&&e.push('style="width:'+a.width+'" ');e.push(">");if(a.size!=void 0)g.size=a.size;if(a.multiple!=void 0)g.multiple=a.multiple;p(c);for(var i=0,j;i<a.items.length&&(j=a.items[i]);i++)d.push('<option value="',CKEDITOR.tools.htmlEncode(j[1]!==void 0?j[1]:j[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(j[0]));if(typeof c.inputStyle!="undefined")c.style=c.inputStyle;f.select=new CKEDITOR.ui.dialog.uiElement(b,c,e,"select",null,g,d.join(""));e.push("</div>");return e.join("")})}},file:function(b,a,d){if(!(3>arguments.length)){void 0===a["default"]&&(a["default"]="");var f=CKEDITOR.tools.extend(h.call(this,a),{definition:a,buttons:[]});a.validate&&(this.validate=a.validate);b.on("load",function(){CKEDITOR.document.getById(f.frameId).getParent().addClass("cke_dialog_ui_input_file")});CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){f.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var b=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',f.frameId,'" title="',a.label,'" src="javascript:void('];b.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0");b.push(')"></iframe>');return b.join("")})}},fileButton:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this;a.validate&&(this.validate=a.validate);var c=CKEDITOR.tools.extend({},a),e=c.onClick;c.className=(c.className?c.className+" ":"")+"cke_dialog_ui_button";c.onClick=function(c){var d=a["for"];if(!e||e.call(this,c)!==false){b.getContentElement(d[0],d[1]).submit();this.disable()}};b.on("load",function(){b.getContentElement(a["for"][0],a["for"][1])._.buttons.push(f)});CKEDITOR.ui.dialog.button.call(this,b,c,d)}},html:function(){var b=/^\s*<[\w:]+\s+([^>]*)?>/,a=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,d=/\/$/;return function(f,c,e){if(!(3>arguments.length)){var k=[],g=c.html;"<"!=g.charAt(0)&&(g="<span>"+g+"</span>");var i=c.focus;if(i){var j=this.focus;this.focus=function(){("function"==typeof i?i:j).call(this);this.fire("focus")};c.isFocusable&&(this.isFocusable=this.isFocusable);this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,f,c,k,"span",null,null,"");k=k.join("").match(b);g=g.match(a)||["","",""];d.test(g[1])&&(g[1]=g[1].slice(0,-1),g[2]="/"+g[2]);e.push([g[1]," ",k[1]||"",g[2]].join(""))}}}(),fieldset:function(b,a,d,f,c){var e=c.label;this._={children:a};CKEDITOR.ui.dialog.uiElement.call(this,b,c,f,"fieldset",null,null,function(){var a=[];e&&a.push("<legend"+
(c.labelStyle?' style="'+c.labelStyle+'"':"")+">"+e+"</legend>");for(var b=0;b<d.length;b++)a.push(d[b]);return a.join("")})}},!0);CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement;CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(b){var a=CKEDITOR.document.getById(this._.labelId);1>a.getChildCount()?(new CKEDITOR.dom.text(b,CKEDITOR.document)).appendTo(a):a.getChild(0).$.nodeValue=b;return this},getLabel:function(){var b=CKEDITOR.document.getById(this._.labelId);return!b||1>b.getChildCount()?"":b.getChild(0).getText()},eventProcessors:o},!0);CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return!this._.disabled?this.fire("click",{dialog:this._.dialog}):!1},enable:function(){this._.disabled=!1;var b=this.getElement();b&&b.removeClass("cke_disabled")},disable:function(){this._.disabled=!0;this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(b,a){this.on("click",function(){a.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0);CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var b=this.selectParentTab();setTimeout(function(){var a=b.getInputElement();a&&a.$.focus()},0)},select:function(){var b=this.selectParentTab();setTimeout(function(){var a=b.getInputElement();a&&(a.$.focus(),a.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(b){!b&&(b="");return CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},keyboardFocusable:!0},n,!0);CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput;CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(b,a,d){var f=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),c=this.getInputElement().$;f.$.text=b;f.$.value=void 0===a||null===a?b:a;void 0===d||null===d?CKEDITOR.env.ie?c.add(f.$):c.add(f.$,null):c.add(f.$,d);return this},remove:function(b){this.getInputElement().$.remove(b);return this},clear:function(){for(var b=this.getInputElement().$;0<b.length;)b.remove(0);return this},keyboardFocusable:!0},n,!0);CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(b,a){this.getInputElement().$.checked=b;!a&&this.fire("change",{value:b})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(b,a){if(!CKEDITOR.env.ie||8<CKEDITOR.env.version)return o.onChange.apply(this,arguments);b.on("load",function(){var a=this._.checkbox.getElement();a.on("propertychange",function(b){b=b.data.$;"checked"==b.propertyName&&this.fire("change",{value:a.$.checked})},this)},this);this.on("change",a);return null}},keyboardFocusable:!0},n,!0);CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(b,a){for(var d=this._.children,f,c=0;c<d.length&&(f=d[c]);c++)f.getElement().$.checked=f.getValue()==b;!a&&this.fire("change",{value:b})},getValue:function(){for(var b=this._.children,a=0;a<b.length;a++)if(b[a].getElement().$.checked)return b[a].getValue();return null},accessKeyUp:function(){var b=this._.children,a;for(a=0;a<b.length;a++)if(b[a].getElement().$.checked){b[a].getElement().focus();return}b[0].getElement().focus()},eventProcessors:{onChange:function(b,a){if(CKEDITOR.env.ie)b.on("load",function(){for(var a=this._.children,b=this,c=0;c<a.length;c++)a[c].getElement().on("propertychange",function(a){a=a.data.$;"checked"==a.propertyName&&this.$.checked&&b.fire("change",{value:this.getAttribute("value")})})},this),this.on("change",a);else return o.onChange.apply(this,arguments);return null}}},n,!0);CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,n,{getInputElement:function(){var b=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return 0<b.$.forms.length?new CKEDITOR.dom.element(b.$.forms[0].elements[0]):this.getElement()},submit:function(){this.getInputElement().getParent().$.submit();return this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(b){var a=/^on([A-Z]\w+)/,d,f=function(a,b,c,d){a.on("formLoaded",function(){a.getInputElement().on(c,d,a)})},c;for(c in b)if(d=c.match(a))this.eventProcessors[c]?this.eventProcessors[c].call(this,this._.dialog,b[c]):f(this,this._.dialog,d[1].toLowerCase(),b[c]);return this},reset:function(){function b(){d.$.open();var b="";f.size&&(b=f.size-(CKEDITOR.env.ie?7:0));var h=a.frameId+"_input";d.$.write(['<html dir="'+g+'" lang="'+i+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+g+'" lang="'+i+'" action="',CKEDITOR.tools.htmlEncode(f.action),'"><label id="',a.labelId,'" for="',h,'" style="display:none">',CKEDITOR.tools.htmlEncode(f.label),'</label><input style="width:100%" id="',h,'" aria-labelledby="',a.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(f.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(0<b?b:""),'" /></form></body></html><script>',CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+e+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+k+")}","<\/script>"].join(""));d.$.close();for(b=0;b<c.length;b++)c[b].enable()}var a=this._,d=CKEDITOR.document.getById(a.frameId).getFrameDocument(),f=a.definition,c=a.buttons,e=this.formLoadedNumber,k=this.formUnloadNumber,g=a.dialog._.editor.lang.dir,i=a.dialog._.editor.langCode;e||(e=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),k=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(e);CKEDITOR.tools.removeFunction(k)}));CKEDITOR.env.gecko?setTimeout(b,500):b()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(b,a){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0);this.on("change",a)}},keyboardFocusable:!0},!0);CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button;CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype);CKEDITOR.dialog.addUIElement("text",r);CKEDITOR.dialog.addUIElement("password",r);CKEDITOR.dialog.addUIElement("textarea",l);CKEDITOR.dialog.addUIElement("checkbox",l);CKEDITOR.dialog.addUIElement("radio",l);CKEDITOR.dialog.addUIElement("button",l);CKEDITOR.dialog.addUIElement("select",l);CKEDITOR.dialog.addUIElement("file",l);CKEDITOR.dialog.addUIElement("fileButton",l);CKEDITOR.dialog.addUIElement("html",l);CKEDITOR.dialog.addUIElement("fieldset",{build:function(b,a,d){for(var f=a.children,c,e=[],h=[],g=0;g<f.length&&(c=f[g]);g++){var i=[];e.push(i);h.push(CKEDITOR.dialog._.uiElementBuilders[c.type].build(b,c,i))}return new CKEDITOR.ui.dialog[a.type](b,h,e,d,a)}})}});CKEDITOR.DIALOG_RESIZE_NONE=0;CKEDITOR.DIALOG_RESIZE_WIDTH=1;CKEDITOR.DIALOG_RESIZE_HEIGHT=2;CKEDITOR.DIALOG_RESIZE_BOTH=3;(function(){function t(){for(var a=this._.tabIdList.length,b=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId)+a,c=b-1;c>b-a;c--)if(this._.tabs[this._.tabIdList[c%a]][0].$.offsetHeight)return this._.tabIdList[c%a];return null}function u(){for(var a=this._.tabIdList.length,b=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId),c=b+1;c<b+a;c++)if(this._.tabs[this._.tabIdList[c%a]][0].$.offsetHeight)return this._.tabIdList[c%a];return null}function G(a,b){for(var c=a.$.getElementsByTagName("input"),e=0,d=c.length;e<d;e++){var g=new CKEDITOR.dom.element(c[e]);"text"==g.getAttribute("type").toLowerCase()&&(b?(g.setAttribute("value",g.getCustomData("fake_value")||""),g.removeCustomData("fake_value")):(g.setCustomData("fake_value",g.getAttribute("value")),g.setAttribute("value","")))}}function P(a,b){var c=this.getInputElement();c&&(a?c.removeAttribute("aria-invalid"):c.setAttribute("aria-invalid",!0));a||(this.select?this.select():this.focus());b&&alert(b);this.fire("validated",{valid:a,msg:b})}
function Q(){var a=this.getInputElement();a&&a.removeAttribute("aria-invalid")}function R(a){var a=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",S).output({id:CKEDITOR.tools.getNextNumber(),editorId:a.id,langDir:a.lang.dir,langCode:a.langCode,editorDialogClass:"cke_editor_"+a.name.replace(/\./g,"\\.")+"_dialog",closeTitle:a.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""})),b=a.getChild([0,0,0,0,0]),c=b.getChild(0),e=b.getChild(1);if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var d="javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())";CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+d+'" tabIndex="-1"></iframe>').appendTo(b.getParent())}c.unselectable();e.unselectable();return{element:a,parts:{dialog:a.getChild(0),title:c,close:e,tabs:b.getChild(2),contents:b.getChild([3,0,0,0]),footer:b.getChild([3,0,1,0])}}}function H(a,b,c){this.element=b;this.focusIndex=c;this.tabIndex=0;this.isFocusable=function(){return!b.getAttribute("disabled")&&b.isVisible()};this.focus=function(){a._.currentFocusIndex=this.focusIndex;this.element.focus()};b.on("keydown",function(a){a.data.getKeystroke()in{32:1,13:1}&&this.fire("click")});b.on("focus",function(){this.fire("mouseover")});b.on("blur",function(){this.fire("mouseout")})}function T(a){function b(){a.layout()}var c=CKEDITOR.document.getWindow();c.on("resize",b);a.on("hide",function(){c.removeListener("resize",b)})}function I(a,b){this._={dialog:a};CKEDITOR.tools.extend(this,b)}function U(a){function b(b){var c=a.getSize(),i=CKEDITOR.document.getWindow().getViewPaneSize(),o=b.data.$.screenX,j=b.data.$.screenY,n=o-e.x,l=j-e.y;e={x:o,y:j};d.x+=n;d.y+=l;a.move(d.x+h[3]<f?-h[3]:d.x-h[1]>i.width-c.width-f?i.width-c.width+("rtl"==g.lang.dir?0:h[1]):d.x,d.y+h[0]<f?-h[0]:d.y-h[2]>i.height-c.height-f?i.height-c.height+h[2]:d.y,1);b.data.preventDefault()}function c(){CKEDITOR.document.removeListener("mousemove",b);CKEDITOR.document.removeListener("mouseup",c);if(CKEDITOR.env.ie6Compat){var a=q.getChild(0).getFrameDocument();a.removeListener("mousemove",b);a.removeListener("mouseup",c)}}var e=null,d=null;a.getElement().getFirst();var g=a.getParentEditor(),f=g.config.dialog_magnetDistance,h=CKEDITOR.skin.margins||[0,0,0,0];"undefined"==typeof f&&(f=20);a.parts.title.on("mousedown",function(f){e={x:f.data.$.screenX,y:f.data.$.screenY};CKEDITOR.document.on("mousemove",b);CKEDITOR.document.on("mouseup",c);d=a.getPosition();if(CKEDITOR.env.ie6Compat){var h=q.getChild(0).getFrameDocument();h.on("mousemove",b);h.on("mouseup",c)}f.data.preventDefault()},a)}function V(a){var b,c;function e(d){var e="rtl"==h.lang.dir,j=o.width,C=o.height,D=j+(d.data.$.screenX-b)*(e?-1:1)*(a._.moved?1:2),n=C+(d.data.$.screenY-c)*(a._.moved?1:2),x=a._.element.getFirst(),x=e&&x.getComputedStyle("right"),y=a.getPosition();y.y+n>i.height&&(n=i.height-y.y);if((e?x:y.x)+D>i.width)D=i.width-(e?x:y.x);if(f==CKEDITOR.DIALOG_RESIZE_WIDTH||f==CKEDITOR.DIALOG_RESIZE_BOTH)j=Math.max(g.minWidth||0,D-m);if(f==CKEDITOR.DIALOG_RESIZE_HEIGHT||f==CKEDITOR.DIALOG_RESIZE_BOTH)C=Math.max(g.minHeight||0,n-k);a.resize(j,C);a._.moved||a.layout();d.data.preventDefault()}function d(){CKEDITOR.document.removeListener("mouseup",d);CKEDITOR.document.removeListener("mousemove",e);j&&(j.remove(),j=null);if(CKEDITOR.env.ie6Compat){var a=q.getChild(0).getFrameDocument();a.removeListener("mouseup",d);a.removeListener("mousemove",e)}}var g=a.definition,f=g.resizable;if(f!=CKEDITOR.DIALOG_RESIZE_NONE){var h=a.getParentEditor(),m,k,i,o,j,n=CKEDITOR.tools.addFunction(function(f){o=a.getSize();var h=a.parts.contents;h.$.getElementsByTagName("iframe").length&&(j=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%;"></div>'),h.append(j));k=o.height-a.parts.contents.getSize("height",!(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.quirks));m=o.width-a.parts.contents.getSize("width",1);b=f.screenX;c=f.screenY;i=CKEDITOR.document.getWindow().getViewPaneSize();CKEDITOR.document.on("mousemove",e);CKEDITOR.document.on("mouseup",d);CKEDITOR.env.ie6Compat&&(h=q.getChild(0).getFrameDocument(),h.on("mousemove",e),h.on("mouseup",d));f.preventDefault&&f.preventDefault()});a.on("load",function(){var b="";f==CKEDITOR.DIALOG_RESIZE_WIDTH?b=" cke_resizer_horizontal":f==CKEDITOR.DIALOG_RESIZE_HEIGHT&&(b=" cke_resizer_vertical");b=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+b+" cke_resizer_"+h.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(h.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+n+', event )">'+("ltr"==h.lang.dir?"◢":"◣")+"</div>");a.parts.footer.append(b,1)});h.on("destroy",function(){CKEDITOR.tools.removeFunction(n)})}}function E(a){a.data.preventDefault(1)}function J(a){var b=CKEDITOR.document.getWindow(),c=a.config,e=c.dialog_backgroundCoverColor||"white",d=c.dialog_backgroundCoverOpacity,g=c.baseFloatZIndex,c=CKEDITOR.tools.genKey(e,d,g),f=w[c];f?f.show():(g=['<div tabIndex="-1" style="position: ',CKEDITOR.env.ie6Compat?"absolute":"fixed","; z-index: ",g,"; top: 0px; left: 0px; ",!CKEDITOR.env.ie6Compat?"background-color: "+e:"",'" class="cke_dialog_background_cover">'],CKEDITOR.env.ie6Compat&&(e="<html><body style=\\'background-color:"+e+";\\'></body></html>",g.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:'),g.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+e+"' );document.close();")+"})())"),g.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>')),g.push("</div>"),f=CKEDITOR.dom.element.createFromHtml(g.join("")),f.setOpacity(void 0!=d?d:0.5),f.on("keydown",E),f.on("keypress",E),f.on("keyup",E),f.appendTo(CKEDITOR.document.getBody()),w[c]=f);a.focusManager.add(f);q=f;var a=function(){var a=b.getViewPaneSize();f.setStyles({width:a.width+"px",height:a.height+"px"})},h=function(){var a=b.getScrollPosition(),c=CKEDITOR.dialog._.currentTop;f.setStyles({left:a.x+"px",top:a.y+"px"});if(c){do{a=c.getPosition();c.move(a.x,a.y)}while(c=c._.parentDialog)}};F=a;b.on("resize",a);a();(!CKEDITOR.env.mac||!CKEDITOR.env.webkit)&&f.focus();if(CKEDITOR.env.ie6Compat){var m=function(){h();arguments.callee.prevScrollHandler.apply(this,arguments)};b.$.setTimeout(function(){m.prevScrollHandler=window.onscroll||function(){};window.onscroll=m},0);h()}}function K(a){q&&(a.focusManager.remove(q),a=CKEDITOR.document.getWindow(),q.hide(),a.removeListener("resize",F),CKEDITOR.env.ie6Compat&&a.$.setTimeout(function(){window.onscroll=window.onscroll&&window.onscroll.prevScrollHandler||null},0),F=null)}var r=CKEDITOR.tools.cssLength,S='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';CKEDITOR.dialog=function(a,b){function c(){var a=l._.focusList;a.sort(function(a,b){return a.tabIndex!=b.tabIndex?b.tabIndex-a.tabIndex:a.focusIndex-b.focusIndex});for(var b=a.length,c=0;c<b;c++)a[c].focusIndex=c}function e(a){var b=l._.focusList,a=a||0;if(!(1>b.length)){var c=l._.currentFocusIndex;try{b[c].getInputElement().$.blur()}catch(f){}for(var d=c=(c+a+b.length)%b.length;a&&!b[d].isFocusable()&&!(d=(d+a+b.length)%b.length,d==c););b[d].focus();"text"==b[d].type&&b[d].select()}}function d(b){if(l==CKEDITOR.dialog._.currentTop){var c=b.data.getKeystroke(),d="rtl"==a.lang.dir;o=j=0;if(9==c||c==CKEDITOR.SHIFT+9)c=c==CKEDITOR.SHIFT+9,l._.tabBarMode?(c=c?t.call(l):u.call(l),l.selectPage(c),l._.tabs[c][0].focus()):e(c?-1:1),o=1;else if(c==CKEDITOR.ALT+121&&!l._.tabBarMode&&1<l.getPageCount())l._.tabBarMode=!0,l._.tabs[l._.currentTabId][0].focus(),o=1;else if((37==c||39==c)&&l._.tabBarMode)c=c==(d?39:37)?t.call(l):u.call(l),l.selectPage(c),l._.tabs[c][0].focus(),o=1;else if((13==c||32==c)&&l._.tabBarMode)this.selectPage(this._.currentTabId),this._.tabBarMode=!1,this._.currentFocusIndex=-1,e(1),o=1;else if(13==c){c=b.data.getTarget();if(!c.is("a","button","select","textarea")&&(!c.is("input")||"button"!=c.$.type))(c=this.getButton("ok"))&&CKEDITOR.tools.setTimeout(c.click,0,c),o=1;j=1}else if(27==c)(c=this.getButton("cancel"))?CKEDITOR.tools.setTimeout(c.click,0,c):!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),j=1;else return;g(b)}}function g(a){o?a.data.preventDefault(1):j&&a.data.stopPropagation()}var f=CKEDITOR.dialog._.dialogDefinitions[b],h=CKEDITOR.tools.clone(W),m=a.config.dialog_buttonsOrder||"OS",k=a.lang.dir,i={},o,j;("OS"==m&&CKEDITOR.env.mac||"rtl"==m&&"ltr"==k||"ltr"==m&&"rtl"==k)&&h.buttons.reverse();f=CKEDITOR.tools.extend(f(a),h);f=CKEDITOR.tools.clone(f);f=new L(this,f);h=R(a);this._={editor:a,element:h.element,name:b,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:!1,focusList:[],currentFocusIndex:0,hasFocus:!1};this.parts=h.parts;CKEDITOR.tools.setTimeout(function(){a.fire("ariaWidget",this.parts.contents)},0,this);h={position:CKEDITOR.env.ie6Compat?"absolute":"fixed",top:0,visibility:"hidden"};h["rtl"==k?"right":"left"]=0;this.parts.dialog.setStyles(h);CKEDITOR.event.call(this);this.definition=f=CKEDITOR.fire("dialogDefinition",{name:b,definition:f},a).definition;if(!("removeDialogTabs"in a._)&&a.config.removeDialogTabs){h=a.config.removeDialogTabs.split(";");for(k=0;k<h.length;k++)if(m=h[k].split(":"),2==m.length){var n=m[0];i[n]||(i[n]=[]);i[n].push(m[1])}a._.removeDialogTabs=i}if(a._.removeDialogTabs&&(i=a._.removeDialogTabs[b]))for(k=0;k<i.length;k++)f.removeContents(i[k]);if(f.onLoad)this.on("load",f.onLoad);if(f.onShow)this.on("show",f.onShow);if(f.onHide)this.on("hide",f.onHide);if(f.onOk)this.on("ok",function(b){a.fire("saveSnapshot");setTimeout(function(){a.fire("saveSnapshot")},0);!1===f.onOk.call(this,b)&&(b.data.hide=!1)});if(f.onCancel)this.on("cancel",function(a){!1===f.onCancel.call(this,a)&&(a.data.hide=!1)});var l=this,p=function(a){var b=l._.contents,c=!1,d;for(d in b)for(var f in b[d])if(c=a.call(this,b[d][f]))return};this.on("ok",function(a){p(function(b){if(b.validate){var c=b.validate(this),d="string"==typeof c||!1===c;d&&(a.data.hide=!1,a.stop());P.call(b,!d,"string"==typeof c?c:void 0);return d}})},this,null,0);this.on("cancel",function(b){p(function(c){if(c.isChanged())return!a.config.dialog_noConfirmCancel&&!confirm(a.lang.common.confirmCancel)&&(b.data.hide=!1),!0})},this,null,0);this.parts.close.on("click",function(a){!1!==this.fire("cancel",{hide:!0}).hide&&this.hide();a.data.preventDefault()},this);this.changeFocus=e;var v=this._.element;a.focusManager.add(v,1);this.on("show",function(){v.on("keydown",d,this);if(CKEDITOR.env.gecko)v.on("keypress",g,this)});this.on("hide",function(){v.removeListener("keydown",d);CKEDITOR.env.gecko&&v.removeListener("keypress",g);p(function(a){Q.apply(a)})});this.on("iframeAdded",function(a){(new CKEDITOR.dom.document(a.data.iframe.$.contentWindow.document)).on("keydown",d,this,null,0)});this.on("show",function(){c();if(a.config.dialog_startupFocusTab&&1<l._.pageCount)l._.tabBarMode=!0,l._.tabs[l._.currentTabId][0].focus();else if(!this._.hasFocus)if(this._.currentFocusIndex=-1,f.onFocus){var b=f.onFocus.call(this);b&&b.focus()}else e(1)},this,null,4294967295);if(CKEDITOR.env.ie6Compat)this.on("load",function(){var a=this.getElement(),b=a.getFirst();b.remove();b.appendTo(a)},this);U(this);V(this);(new CKEDITOR.dom.text(f.title,CKEDITOR.document)).appendTo(this.parts.title);for(k=0;k<f.contents.length;k++)(i=f.contents[k])&&this.addPage(i);this.parts.tabs.on("click",function(a){var b=a.data.getTarget();b.hasClass("cke_dialog_tab")&&(b=b.$.id,this.selectPage(b.substring(4,b.lastIndexOf("_"))),this._.tabBarMode&&(this._.tabBarMode=!1,this._.currentFocusIndex=-1,e(1)),a.data.preventDefault())},this);k=[];i=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:f.buttons},k).getChild();this.parts.footer.setHtml(k.join(""));for(k=0;k<i.length;k++)this._.buttons[i[k].id]=i[k]};CKEDITOR.dialog.prototype={destroy:function(){this.hide();this._.element.remove()},resize:function(){return function(a,b){if(!this._.contentSize||!(this._.contentSize.width==a&&this._.contentSize.height==b))CKEDITOR.dialog.fire("resize",{dialog:this,width:a,height:b},this._.editor),this.fire("resize",{width:a,height:b},this._.editor),this.parts.contents.setStyles({width:a+"px",height:b+"px"}),"rtl"==this._.editor.lang.dir&&this._.position&&(this._.position.x=CKEDITOR.document.getWindow().getViewPaneSize().width-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10)),this._.contentSize={width:a,height:b}}}(),getSize:function(){var a=this._.element.getFirst();return{width:a.$.offsetWidth||0,height:a.$.offsetHeight||0}},move:function(a,b,c){var e=this._.element.getFirst(),d="rtl"==this._.editor.lang.dir,g="fixed"==e.getComputedStyle("position");CKEDITOR.env.ie&&e.setStyle("zoom","100%");if(!g||!this._.position||!(this._.position.x==a&&this._.position.y==b))this._.position={x:a,y:b},g||(g=CKEDITOR.document.getWindow().getScrollPosition(),a+=g.x,b+=g.y),d&&(g=this.getSize(),a=CKEDITOR.document.getWindow().getViewPaneSize().width-g.width-a),b={top:(0<b?b:0)+"px"},b[d?"right":"left"]=(0<a?a:0)+"px",e.setStyles(b),c&&(this._.moved=1)},getPosition:function(){return CKEDITOR.tools.extend({},this._.position)},show:function(){var a=this._.element,b=this.definition;!a.getParent()||!a.getParent().equals(CKEDITOR.document.getBody())?a.appendTo(CKEDITOR.document.getBody()):a.setStyle("display","block");this.resize(this._.contentSize&&this._.contentSize.width||b.width||b.minWidth,this._.contentSize&&this._.contentSize.height||b.height||b.minHeight);this.reset();this.selectPage(this.definition.contents[0].id);null===CKEDITOR.dialog._.currentZIndex&&(CKEDITOR.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex);this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex+=10);null===CKEDITOR.dialog._.currentTop?(CKEDITOR.dialog._.currentTop=this,this._.parentDialog=null,J(this._.editor)):(this._.parentDialog=CKEDITOR.dialog._.currentTop,this._.parentDialog.getElement().getFirst().$.style.zIndex-=Math.floor(this._.editor.config.baseFloatZIndex/2),CKEDITOR.dialog._.currentTop=this);a.on("keydown",M);a.on("keyup",N);this._.hasFocus=!1;for(var c in b.contents)if(b.contents[c]){var a=b.contents[c],e=this._.tabs[a.id],d=a.requiredContent,g=0;if(e){for(var f in this._.contents[a.id]){var h=this._.contents[a.id][f];"hbox"==h.type||("vbox"==h.type||!h.getInputElement())||(h.requiredContent&&!this._.editor.activeFilter.check(h.requiredContent)?h.disable():(h.enable(),g++))}!g||d&&!this._.editor.activeFilter.check(d)?e[0].addClass("cke_dialog_tab_disabled"):e[0].removeClass("cke_dialog_tab_disabled")}}CKEDITOR.tools.setTimeout(function(){this.layout();T(this);this.parts.dialog.setStyle("visibility","");this.fireOnce("load",{});CKEDITOR.ui.fire("ready",this);this.fire("show",{});this._.editor.fire("dialogShow",this);this._.parentDialog||this._.editor.focusManager.lock();this.foreach(function(a){a.setInitValue&&a.setInitValue()})},100,this)},layout:function(){var a=this.parts.dialog,b=this.getSize(),c=CKEDITOR.document.getWindow().getViewPaneSize(),e=(c.width-b.width)/2,d=(c.height-b.height)/2;CKEDITOR.env.ie6Compat||(b.height+(0<d?d:0)>c.height||b.width+(0<e?e:0)>c.width?a.setStyle("position","absolute"):a.setStyle("position","fixed"));this.move(this._.moved?this._.position.x:e,this._.moved?this._.position.y:d)},foreach:function(a){for(var b in this._.contents)for(var c in this._.contents[b])a.call(this,this._.contents[b][c]);return this},reset:function(){var a=function(a){a.reset&&a.reset(1)};return function(){this.foreach(a);return this}}(),setupContent:function(){var a=arguments;this.foreach(function(b){b.setup&&b.setup.apply(b,a)})},commitContent:function(){var a=arguments;this.foreach(function(b){CKEDITOR.env.ie&&this._.currentFocusIndex==b.focusIndex&&b.getInputElement().$.blur();b.commit&&b.commit.apply(b,a)})},hide:function(){if(this.parts.dialog.isVisible()){this.fire("hide",{});this._.editor.fire("dialogHide",this);this.selectPage(this._.tabIdList[0]);var a=this._.element;a.setStyle("display","none");this.parts.dialog.setStyle("visibility","hidden");for(X(this);CKEDITOR.dialog._.currentTop!=this;)CKEDITOR.dialog._.currentTop.hide();if(this._.parentDialog){var b=this._.parentDialog.getElement().getFirst();b.setStyle("z-index",parseInt(b.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2))}else K(this._.editor);if(CKEDITOR.dialog._.currentTop=this._.parentDialog)CKEDITOR.dialog._.currentZIndex-=10;else{CKEDITOR.dialog._.currentZIndex=null;a.removeListener("keydown",M);a.removeListener("keyup",N);var c=this._.editor;c.focus();setTimeout(function(){c.focusManager.unlock();CKEDITOR.env.iOS&&c.window.focus()},0)}delete this._.parentDialog;this.foreach(function(a){a.resetInitValue&&a.resetInitValue()})}},addPage:function(a){if(!a.requiredContent||this._.editor.filter.check(a.requiredContent)){for(var b=[],c=a.label?' title="'+CKEDITOR.tools.htmlEncode(a.label)+'"':"",e=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",className:"cke_dialog_page_contents",children:a.elements,expand:!!a.expand,padding:a.padding,style:a.style||"width: 100%;"},b),d=this._.contents[a.id]={},g=e.getChild(),f=0;e=g.shift();)!e.notAllowed&&("hbox"!=e.type&&"vbox"!=e.type)&&f++,d[e.id]=e,"function"==typeof e.getChild&&g.push.apply(g,e.getChild());f||(a.hidden=!0);b=CKEDITOR.dom.element.createFromHtml(b.join(""));b.setAttribute("role","tabpanel");e=CKEDITOR.env;d="cke_"+a.id+"_"+CKEDITOR.tools.getNextNumber();c=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',0<this._.pageCount?" cke_last":"cke_first",c,a.hidden?' style="display:none"':"",' id="',d,'"',e.gecko&&!e.hc?"":' href="javascript:void(0)"',' tabIndex="-1" hidefocus="true" role="tab">',a.label,"</a>"].join(""));b.setAttribute("aria-labelledby",d);this._.tabs[a.id]=[c,b];this._.tabIdList.push(a.id);!a.hidden&&this._.pageCount++;this._.lastTab=c;this.updateStyle();b.setAttribute("name",a.id);b.appendTo(this.parts.contents);c.unselectable();this.parts.tabs.append(c);a.accessKey&&(O(this,this,"CTRL+"+
a.accessKey,Y,Z),this._.accessKeyMap["CTRL+"+a.accessKey]=a.id)}},selectPage:function(a){if(this._.currentTabId!=a&&!this._.tabs[a][0].hasClass("cke_dialog_tab_disabled")&&!1!==this.fire("selectPage",{page:a,currentPage:this._.currentTabId})){for(var b in this._.tabs){var c=this._.tabs[b][0],e=this._.tabs[b][1];b!=a&&(c.removeClass("cke_dialog_tab_selected"),e.hide());e.setAttribute("aria-hidden",b!=a)}var d=this._.tabs[a];d[0].addClass("cke_dialog_tab_selected");CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?(G(d[1]),d[1].show(),setTimeout(function(){G(d[1],1)},0)):d[1].show();this._.currentTabId=a;this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,a)}},updateStyle:function(){this.parts.dialog[(1===this._.pageCount?"add":"remove")+"Class"]("cke_single_page")},hidePage:function(a){var b=this._.tabs[a]&&this._.tabs[a][0];b&&(1!=this._.pageCount&&b.isVisible())&&(a==this._.currentTabId&&this.selectPage(t.call(this)),b.hide(),this._.pageCount--,this.updateStyle())},showPage:function(a){if(a=this._.tabs[a]&&this._.tabs[a][0])a.show(),this._.pageCount++,this.updateStyle()},getElement:function(){return this._.element},getName:function(){return this._.name},getContentElement:function(a,b){var c=this._.contents[a];return c&&c[b]},getValueOf:function(a,b){return this.getContentElement(a,b).getValue()},setValueOf:function(a,b,c){return this.getContentElement(a,b).setValue(c)},getButton:function(a){return this._.buttons[a]},click:function(a){return this._.buttons[a].click()},disableButton:function(a){return this._.buttons[a].disable()},enableButton:function(a){return this._.buttons[a].enable()},getPageCount:function(){return this._.pageCount},getParentEditor:function(){return this._.editor},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement()},addFocusable:function(a,b){if("undefined"==typeof b)b=this._.focusList.length,this._.focusList.push(new H(this,a,b));else{this._.focusList.splice(b,0,new H(this,a,b));for(var c=b+1;c<this._.focusList.length;c++)this._.focusList[c].focusIndex++}}};CKEDITOR.tools.extend(CKEDITOR.dialog,{add:function(a,b){if(!this._.dialogDefinitions[a]||"function"==typeof b)this._.dialogDefinitions[a]=b},exists:function(a){return!!this._.dialogDefinitions[a]},getCurrent:function(){return CKEDITOR.dialog._.currentTop},isTabEnabled:function(a,b,c){a=a.config.removeDialogTabs;return!(a&&a.match(RegExp("(?:^|;)"+b+":"+c+"(?:$|;)","i")))},okButton:function(){var a=function(a,c){c=c||{};return CKEDITOR.tools.extend({id:"ok",type:"button",label:a.lang.common.ok,"class":"cke_dialog_ui_button_ok",onClick:function(a){a=a.data.dialog;!1!==a.fire("ok",{hide:!0}).hide&&a.hide()}},c,!0)};a.type="button";a.override=function(b){return CKEDITOR.tools.extend(function(c){return a(c,b)},{type:"button"},!0)};return a}(),cancelButton:function(){var a=function(a,c){c=c||{};return CKEDITOR.tools.extend({id:"cancel",type:"button",label:a.lang.common.cancel,"class":"cke_dialog_ui_button_cancel",onClick:function(a){a=a.data.dialog;!1!==a.fire("cancel",{hide:!0}).hide&&a.hide()}},c,!0)};a.type="button";a.override=function(b){return CKEDITOR.tools.extend(function(c){return a(c,b)},{type:"button"},!0)};return a}(),addUIElement:function(a,b){this._.uiElementBuilders[a]=b}});CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null};CKEDITOR.event.implementOn(CKEDITOR.dialog);CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype);var W={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]},z=function(a,b,c){for(var e=0,d;d=a[e];e++)if(d.id==b||c&&d[c]&&(d=z(d[c],b,c)))return d;return null},A=function(a,b,c,e,d){if(c){for(var g=0,f;f=a[g];g++){if(f.id==c)return a.splice(g,0,b),b;if(e&&f[e]&&(f=A(f[e],b,c,e,!0)))return f}if(d)return null}a.push(b);return b},B=function(a,b,c){for(var e=0,d;d=a[e];e++){if(d.id==b)return a.splice(e,1);if(c&&d[c]&&(d=B(d[c],b,c)))return d}return null},L=function(a,b){this.dialog=a;for(var c=b.contents,e=0,d;d=c[e];e++)c[e]=d&&new I(a,d);CKEDITOR.tools.extend(this,b)};L.prototype={getContents:function(a){return z(this.contents,a)},getButton:function(a){return z(this.buttons,a)},addContents:function(a,b){return A(this.contents,a,b)},addButton:function(a,b){return A(this.buttons,a,b)},removeContents:function(a){B(this.contents,a)},removeButton:function(a){B(this.buttons,a)}};I.prototype={get:function(a){return z(this.elements,a,"children")},add:function(a,b){return A(this.elements,a,b,"children")},remove:function(a){B(this.elements,a,"children")}};var F,w={},q,s={},M=function(a){var b=a.data.$.ctrlKey||a.data.$.metaKey,c=a.data.$.altKey,e=a.data.$.shiftKey,d=String.fromCharCode(a.data.$.keyCode);if((b=s[(b?"CTRL+":"")+(c?"ALT+":"")+(e?"SHIFT+":"")+d])&&b.length)b=b[b.length-1],b.keydown&&b.keydown.call(b.uiElement,b.dialog,b.key),a.data.preventDefault()},N=function(a){var b=a.data.$.ctrlKey||a.data.$.metaKey,c=a.data.$.altKey,e=a.data.$.shiftKey,d=String.fromCharCode(a.data.$.keyCode);if((b=s[(b?"CTRL+":"")+(c?"ALT+":"")+(e?"SHIFT+":"")+d])&&b.length)b=b[b.length-
1],b.keyup&&(b.keyup.call(b.uiElement,b.dialog,b.key),a.data.preventDefault())},O=function(a,b,c,e,d){(s[c]||(s[c]=[])).push({uiElement:a,dialog:b,key:c,keyup:d||a.accessKeyUp,keydown:e||a.accessKeyDown})},X=function(a){for(var b in s){for(var c=s[b],e=c.length-1;0<=e;e--)(c[e].dialog==a||c[e].uiElement==a)&&c.splice(e,1);0===c.length&&delete s[b]}},Z=function(a,b){a._.accessKeyMap[b]&&a.selectPage(a._.accessKeyMap[b])},Y=function(){};(function(){CKEDITOR.ui.dialog={uiElement:function(a,b,c,e,d,g,f){if(!(4>arguments.length)){var h=(e.call?e(b):e)||"div",m=["<",h," "],k=(d&&d.call?d(b):d)||{},i=(g&&g.call?g(b):g)||{},o=(f&&f.call?f.call(this,a,b):f)||"",j=this.domId=i.id||CKEDITOR.tools.getNextId()+"_uiElement";this.id=b.id;b.requiredContent&&!a.getParentEditor().filter.check(b.requiredContent)&&(k.display="none",this.notAllowed=!0);i.id=j;var n={};b.type&&(n["cke_dialog_ui_"+b.type]=1);b.className&&(n[b.className]=1);b.disabled&&(n.cke_disabled=1);for(var l=i["class"]&&i["class"].split?i["class"].split(" "):[],j=0;j<l.length;j++)l[j]&&(n[l[j]]=1);l=[];for(j in n)l.push(j);i["class"]=l.join(" ");b.title&&(i.title=b.title);n=(b.style||"").split(";");b.align&&(l=b.align,k["margin-left"]="left"==l?0:"auto",k["margin-right"]="right"==l?0:"auto");for(j in k)n.push(j+":"+k[j]);b.hidden&&n.push("display:none");for(j=n.length-1;0<=j;j--)""===n[j]&&n.splice(j,1);0<n.length&&(i.style=(i.style?i.style+"; ":"")+n.join("; "));for(j in i)m.push(j+'="'+CKEDITOR.tools.htmlEncode(i[j])+'" ');m.push(">",o,"</",h,">");c.push(m.join(""));(this._||(this._={})).dialog=a;"boolean"==typeof b.isChanged&&(this.isChanged=function(){return b.isChanged});"function"==typeof b.isChanged&&(this.isChanged=b.isChanged);"function"==typeof b.setValue&&(this.setValue=CKEDITOR.tools.override(this.setValue,function(a){return function(c){a.call(this,b.setValue.call(this,c))}}));"function"==typeof b.getValue&&(this.getValue=CKEDITOR.tools.override(this.getValue,function(a){return function(){return b.getValue.call(this,a.call(this))}}));CKEDITOR.event.implementOn(this);this.registerEvents(b);this.accessKeyUp&&(this.accessKeyDown&&b.accessKey)&&O(this,a,"CTRL+"+b.accessKey);var p=this;a.on("load",function(){var b=p.getInputElement();if(b){var c=p.type in{checkbox:1,ratio:1}&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?"cke_dialog_ui_focused":"";b.on("focus",function(){a._.tabBarMode=false;a._.hasFocus=true;p.fire("focus");c&&this.addClass(c)});b.on("blur",function(){p.fire("blur");c&&this.removeClass(c)})}});CKEDITOR.tools.extend(this,b);this.keyboardFocusable&&(this.tabIndex=b.tabIndex||0,this.focusIndex=a._.focusList.push(this)-1,this.on("focus",function(){a._.currentFocusIndex=p.focusIndex}))}},hbox:function(a,b,c,e,d){if(!(4>arguments.length)){this._||(this._={});var g=this._.children=b,f=d&&d.widths||null,h=d&&d.height||null,m,k={role:"presentation"};d&&d.align&&(k.align=d.align);CKEDITOR.ui.dialog.uiElement.call(this,a,d||{type:"hbox"},e,"table",{},k,function(){var a=['<tbody><tr class="cke_dialog_ui_hbox">'];for(m=0;m<c.length;m++){var b="cke_dialog_ui_hbox_child",e=[];0===m&&(b="cke_dialog_ui_hbox_first");m==c.length-1&&(b="cke_dialog_ui_hbox_last");a.push('<td class="',b,'" role="presentation" ');f?f[m]&&e.push("width:"+r(f[m])):e.push("width:"+Math.floor(100/c.length)+"%");h&&e.push("height:"+r(h));d&&void 0!=d.padding&&e.push("padding:"+r(d.padding));CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&g[m].align)&&e.push("text-align:"+g[m].align);0<e.length&&a.push('style="'+e.join("; ")+'" ');a.push(">",c[m],"</td>")}a.push("</tr></tbody>");return a.join("")})}},vbox:function(a,b,c,e,d){if(!(3>arguments.length)){this._||(this._={});var g=this._.children=b,f=d&&d.width||null,h=d&&d.heights||null;CKEDITOR.ui.dialog.uiElement.call(this,a,d||{type:"vbox"},e,"div",null,{role:"presentation"},function(){var b=['<table role="presentation" cellspacing="0" border="0" '];b.push('style="');d&&d.expand&&b.push("height:100%;");b.push("width:"+r(f||"100%"),";");CKEDITOR.env.webkit&&b.push("float:none;");b.push('"');b.push('align="',CKEDITOR.tools.htmlEncode(d&&d.align||("ltr"==a.getParentEditor().lang.dir?"left":"right")),'" ');b.push("><tbody>");for(var e=0;e<c.length;e++){var i=[];b.push('<tr><td role="presentation" ');f&&i.push("width:"+r(f||"100%"));h?i.push("height:"+r(h[e])):d&&d.expand&&i.push("height:"+Math.floor(100/c.length)+"%");d&&void 0!=d.padding&&i.push("padding:"+r(d.padding));CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&g[e].align)&&i.push("text-align:"+g[e].align);0<i.length&&b.push('style="',i.join("; "),'" ');b.push(' class="cke_dialog_ui_vbox_child">',c[e],"</td></tr>")}b.push("</tbody></table>");return b.join("")})}}}})();CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId)},getInputElement:function(){return this.getElement()},getDialog:function(){return this._.dialog},setValue:function(a,b){this.getInputElement().setValue(a);!b&&this.fire("change",{value:a});return this},getValue:function(){return this.getInputElement().getValue()},isChanged:function(){return!1},selectParentTab:function(){for(var a=this.getInputElement();(a=a.getParent())&&-1==a.$.className.search("cke_dialog_page_contents"););if(!a)return this;a=a.getAttribute("name");this._.dialog._.currentTabId!=a&&this._.dialog.selectPage(a);return this},focus:function(){this.selectParentTab().getInputElement().focus();return this},registerEvents:function(a){var b=/^on([A-Z]\w+)/,c,e=function(a,b,c,d){b.on("load",function(){a.getInputElement().on(c,d,a)})},d;for(d in a)if(c=d.match(b))this.eventProcessors[d]?this.eventProcessors[d].call(this,this._.dialog,a[d]):e(this,this._.dialog,c[1].toLowerCase(),a[d]);return this},eventProcessors:{onLoad:function(a,b){a.on("load",b,this)},onShow:function(a,b){a.on("show",b,this)},onHide:function(a,b){a.on("hide",b,this)}},accessKeyDown:function(){this.focus()},accessKeyUp:function(){},disable:function(){var a=this.getElement();this.getInputElement().setAttribute("disabled","true");a.addClass("cke_disabled")},enable:function(){var a=this.getElement();this.getInputElement().removeAttribute("disabled");a.removeClass("cke_disabled")},isEnabled:function(){return!this.getElement().hasClass("cke_disabled")},isVisible:function(){return this.getInputElement().isVisible()},isFocusable:function(){return!this.isEnabled()||!this.isVisible()?!1:!0}};CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(a){if(1>arguments.length)return this._.children.concat();a.splice||(a=[a]);return 2>a.length?this._.children[a[0]]:this._.children[a[0]]&&this._.children[a[0]].getChild?this._.children[a[0]].getChild(a.slice(1,a.length)):null}},!0);CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox;(function(){var a={build:function(a,c,e){for(var d=c.children,g,f=[],h=[],m=0;m<d.length&&(g=d[m]);m++){var k=[];f.push(k);h.push(CKEDITOR.dialog._.uiElementBuilders[g.type].build(a,g,k))}return new CKEDITOR.ui.dialog[c.type](a,h,f,e,c)}};CKEDITOR.dialog.addUIElement("hbox",a);CKEDITOR.dialog.addUIElement("vbox",a)})();CKEDITOR.dialogCommand=function(a,b){this.dialogName=a;CKEDITOR.tools.extend(this,b,!0)};CKEDITOR.dialogCommand.prototype={exec:function(a){a.openDialog(this.dialogName)},canUndo:!1,editorFocus:1};(function(){var a=/^([a]|[^a])+$/,b=/^\d*$/,c=/^\d*(?:\.\d+)?$/,e=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,d=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,g=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/;CKEDITOR.VALIDATE_OR=1;CKEDITOR.VALIDATE_AND=2;CKEDITOR.dialog.validate={functions:function(){var a=arguments;return function(){var b=this&&this.getValue?this.getValue():a[0],c=void 0,d=CKEDITOR.VALIDATE_AND,e=[],g;for(g=0;g<a.length;g++)if("function"==typeof a[g])e.push(a[g]);else break;g<a.length&&"string"==typeof a[g]&&(c=a[g],g++);g<a.length&&"number"==typeof a[g]&&(d=a[g]);var j=d==CKEDITOR.VALIDATE_AND?!0:!1;for(g=0;g<e.length;g++)j=d==CKEDITOR.VALIDATE_AND?j&&e[g](b):j||e[g](b);return!j?c:!0}},regex:function(a,b){return function(c){c=this&&this.getValue?this.getValue():c;return!a.test(c)?b:!0}},notEmpty:function(b){return this.regex(a,b)},integer:function(a){return this.regex(b,a)},number:function(a){return this.regex(c,a)},cssLength:function(a){return this.functions(function(a){return d.test(CKEDITOR.tools.trim(a))},a)},htmlLength:function(a){return this.functions(function(a){return e.test(CKEDITOR.tools.trim(a))},a)},inlineStyle:function(a){return this.functions(function(a){return g.test(CKEDITOR.tools.trim(a))},a)},equals:function(a,b){return this.functions(function(b){return b==a},b)},notEqual:function(a,b){return this.functions(function(b){return b!=a},b)}};CKEDITOR.on("instanceDestroyed",function(a){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){for(var b;b=CKEDITOR.dialog._.currentTop;)b.hide();for(var c in w)w[c].remove();w={}}var a=a.editor._.storedDialogs,d;for(d in a)a[d].destroy()})})();CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(a,b){var c=null,e=CKEDITOR.dialog._.dialogDefinitions[a];null===CKEDITOR.dialog._.currentTop&&J(this);if("function"==typeof e)c=this._.storedDialogs||(this._.storedDialogs={}),c=c[a]||(c[a]=new CKEDITOR.dialog(this,a)),b&&b.call(c,c),c.show();else{if("failed"==e)throw K(this),Error('[CKEDITOR.dialog.openDialog] Dialog "'+a+'" failed when loading definition.');"string"==typeof e&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(e),function(){"function"!=typeof CKEDITOR.dialog._.dialogDefinitions[a]&&(CKEDITOR.dialog._.dialogDefinitions[a]="failed");this.openDialog(a,b)},this,0,1)}CKEDITOR.skin.loadPart("dialog");return c}})})();CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(t){t.on("doubleclick",function(u){u.data.dialog&&t.openDialog(u.data.dialog)},null,null,999)}});CKEDITOR.plugins.add("about",{requires:"dialog",init:function(a){var b=a.addCommand("about",new CKEDITOR.dialogCommand("about"));b.modes={wysiwyg:1,source:1};b.canUndo=!1;b.readOnly=1;a.ui.addButton&&a.ui.addButton("About",{label:a.lang.about.title,command:"about",toolbar:"about"});CKEDITOR.dialog.add("about",this.path+"dialogs/about.js")}});(function(){CKEDITOR.plugins.add("a11yhelp",{requires:"dialog",availableLangs:{af:1,ar:1,bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,sr:1,"sr-latn":1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},init:function(b){var c=this;b.addCommand("a11yHelp",{exec:function(){var a=b.langCode,a=c.availableLangs[a]?a:c.availableLangs[a.replace(/-.*/,"")]?a.replace(/-.*/,""):"en";CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(c.path+"dialogs/lang/"+a+".js"),function(){b.lang.a11yhelp=c.langEntries[a];b.openDialog("a11yHelp")})},modes:{wysiwyg:1,source:1},readOnly:1,canUndo:!1});b.setKeystroke(CKEDITOR.ALT+48,"a11yHelp");CKEDITOR.dialog.add("a11yHelp",this.path+"dialogs/a11yhelp.js");b.on("ariaEditorHelpLabel",function(a){a.data.label=b.lang.common.editorHelp})}})})();(function(){function f(c){var a=this.att,c=c&&c.hasAttribute(a)&&c.getAttribute(a)||"";void 0!==c&&this.setValue(c)}function g(){for(var c,a=0;a<arguments.length;a++)if(arguments[a]instanceof CKEDITOR.dom.element){c=arguments[a];break}if(c){var a=this.att,b=this.getValue();b?c.setAttribute(a,b):c.removeAttribute(a,b)}}var i={id:1,dir:1,classes:1,styles:1};CKEDITOR.plugins.add("dialogadvtab",{requires:"dialog",allowedContent:function(c){c||(c=i);var a=[];c.id&&a.push("id");c.dir&&a.push("dir");var b="";a.length&&(b+="["+a.join(",")+"]");c.classes&&(b+="(*)");c.styles&&(b+="{*}");return b},createAdvancedTab:function(c,a,b){a||(a=i);var d=c.lang.common,h={id:"advanced",label:d.advancedTab,title:d.advancedTab,elements:[{type:"vbox",padding:1,children:[]}]},e=[];if(a.id||a.dir)a.id&&e.push({id:"advId",att:"id",type:"text",requiredContent:b?b+"[id]":null,label:d.id,setup:f,commit:g}),a.dir&&e.push({id:"advLangDir",att:"dir",type:"select",requiredContent:b?b+"[dir]":null,label:d.langDir,"default":"",style:"width:100%",items:[[d.notSet,""],[d.langDirLTR,"ltr"],[d.langDirRTL,"rtl"]],setup:f,commit:g}),h.elements[0].children.push({type:"hbox",widths:["50%","50%"],children:[].concat(e)});if(a.styles||a.classes)e=[],a.styles&&e.push({id:"advStyles",att:"style",type:"text",requiredContent:b?b+"{cke-xyz}":null,label:d.styles,"default":"",validate:CKEDITOR.dialog.validate.inlineStyle(d.invalidInlineStyle),onChange:function(){},getStyle:function(a,c){var b=this.getValue().match(RegExp("(?:^|;)\\s*"+a+"\\s*:\\s*([^;]*)","i"));return b?b[1]:c},updateStyle:function(a,b){var d=this.getValue(),e=c.document.createElement("span");e.setAttribute("style",d);e.setStyle(a,b);d=CKEDITOR.tools.normalizeCssText(e.getAttribute("style"));this.setValue(d,1)},setup:f,commit:g}),a.classes&&e.push({type:"hbox",widths:["45%","55%"],children:[{id:"advCSSClasses",att:"class",type:"text",requiredContent:b?b+"(cke-xyz)":null,label:d.cssClasses,"default":"",setup:f,commit:g}]}),h.elements[0].children.push({type:"hbox",widths:["50%","50%"],children:[].concat(e)});return h}})})();CKEDITOR.plugins.add("basicstyles",{init:function(c){var e=0,d=function(g,d,b,a){if(a){var a=new CKEDITOR.style(a),f=h[b];f.unshift(a);c.attachStyleStateChange(a,function(a){!c.readOnly&&c.getCommand(b).setState(a)});c.addCommand(b,new CKEDITOR.styleCommand(a,{contentForms:f}));c.ui.addButton&&c.ui.addButton(g,{label:d,command:b,toolbar:"basicstyles,"+(e+=10)})}},h={bold:["strong","b",["span",function(a){a=a.styles["font-weight"];return"bold"==a||700<=+a}]],italic:["em","i",["span",function(a){return"italic"==a.styles["font-style"]}]],underline:["u",["span",function(a){return"underline"==a.styles["text-decoration"]}]],strike:["s","strike",["span",function(a){return"line-through"==a.styles["text-decoration"]}]],subscript:["sub"],superscript:["sup"]},b=c.config,a=c.lang.basicstyles;d("Bold",a.bold,"bold",b.coreStyles_bold);d("Italic",a.italic,"italic",b.coreStyles_italic);d("Underline",a.underline,"underline",b.coreStyles_underline);d("Strike",a.strike,"strike",b.coreStyles_strike);d("Subscript",a.subscript,"subscript",b.coreStyles_subscript);d("Superscript",a.superscript,"superscript",b.coreStyles_superscript);c.setKeystroke([[CKEDITOR.CTRL+66,"bold"],[CKEDITOR.CTRL+73,"italic"],[CKEDITOR.CTRL+85,"underline"]])}});CKEDITOR.config.coreStyles_bold={element:"strong",overrides:"b"};CKEDITOR.config.coreStyles_italic={element:"em",overrides:"i"};CKEDITOR.config.coreStyles_underline={element:"u"};CKEDITOR.config.coreStyles_strike={element:"s",overrides:"strike"};CKEDITOR.config.coreStyles_subscript={element:"sub"};CKEDITOR.config.coreStyles_superscript={element:"sup"};(function(){function n(a,f,d,b){if(!a.isReadOnly()&&!a.equals(d.editable())){CKEDITOR.dom.element.setMarker(b,a,"bidi_processed",1);for(var b=a,c=d.editable();(b=b.getParent())&&!b.equals(c);)if(b.getCustomData("bidi_processed")){a.removeStyle("direction");a.removeAttribute("dir");return}b="useComputedState"in d.config?d.config.useComputedState:1;if((b?a.getComputedStyle("direction"):a.getStyle("direction")||a.hasAttribute("dir"))!=f)a.removeStyle("direction"),b?(a.removeAttribute("dir"),f!=a.getComputedStyle("direction")&&a.setAttribute("dir",f)):a.setAttribute("dir",f),d.forceNextSelectionCheck()}}function r(a,f,d){var b=a.getCommonAncestor(!1,!0),a=a.clone();a.enlarge(d==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS);if(a.checkBoundaryOfElement(b,CKEDITOR.START)&&a.checkBoundaryOfElement(b,CKEDITOR.END)){for(var c;b&&b.type==CKEDITOR.NODE_ELEMENT&&(c=b.getParent())&&1==c.getChildCount()&&!(b.getName()in f);)b=c;return b.type==CKEDITOR.NODE_ELEMENT&&b.getName()in f&&b}}function m(a){return{context:"p",allowedContent:{"h1 h2 h3 h4 h5 h6 table ul ol blockquote div tr p div li td":{propertiesOnly:!0,attributes:"dir"}},requiredContent:"p[dir]",refresh:function(a,d){var b=a.config.useComputedState,c,b=void 0===b||b;if(!b){c=d.lastElement;for(var h=a.editable();c&&!(c.getName()in q||c.equals(h));){var e=c.getParent();if(!e)break;c=e}}c=c||d.block||d.blockLimit;c.equals(a.editable())&&(h=a.getSelection().getRanges()[0].getEnclosedNode())&&h.type==CKEDITOR.NODE_ELEMENT&&(c=h);c&&(b=b?c.getComputedStyle("direction"):c.getStyle("direction")||c.getAttribute("dir"),a.getCommand("bidirtl").setState("rtl"==b?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),a.getCommand("bidiltr").setState("ltr"==b?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF));b=(d.block||d.blockLimit||a.editable()).getDirection(1);if(b!=(a._.selDir||a.lang.dir))a._.selDir=b,a.fire("contentDirChanged",b)},exec:function(f){var d=f.getSelection(),b=f.config.enterMode,c=d.getRanges();if(c&&c.length){for(var h={},e=d.createBookmarks(),c=c.createIterator(),g,j=0;g=c.getNextRange(1);){var i=g.getEnclosedNode();if(!i||i&&!(i.type==CKEDITOR.NODE_ELEMENT&&i.getName()in o))i=r(g,p,b);i&&n(i,a,f,h);var k=new CKEDITOR.dom.walker(g),l=e[j].startNode,m=e[j++].endNode;k.evaluator=function(a){return!!(a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in p&&!(a.getName()==(b==CKEDITOR.ENTER_P?"p":"div")&&a.getParent().type==CKEDITOR.NODE_ELEMENT&&"blockquote"==a.getParent().getName())&&a.getPosition(l)&CKEDITOR.POSITION_FOLLOWING&&(a.getPosition(m)&CKEDITOR.POSITION_PRECEDING+
CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING)};for(;i=k.next();)n(i,a,f,h);g=g.createIterator();for(g.enlargeBr=b!=CKEDITOR.ENTER_BR;i=g.getNextParagraph(b==CKEDITOR.ENTER_P?"p":"div");)n(i,a,f,h)}CKEDITOR.dom.element.clearAllMarkers(h);f.forceNextSelectionCheck();d.selectBookmarks(e);f.focus()}}}}function s(a){var f=a==j.setAttribute,d=a==j.removeAttribute,b=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(c,h){if(!this.isReadOnly()){var e;if(e=c==(f||d?"dir":"direction")||"style"==c&&(d||b.test(h))){a:{e=this;for(var g=e.getDocument().getBody().getParent();e;){if(e.equals(g)){e=!1;break a}e=e.getParent()}e=!0}e=!e}if(e&&(e=this.getDirection(1),g=a.apply(this,arguments),e!=this.getDirection(1)))return this.getDocument().fire("dirChanged",this),g}return a.apply(this,arguments)}}var p={table:1,ul:1,ol:1,blockquote:1,div:1},o={},q={};CKEDITOR.tools.extend(o,p,{tr:1,p:1,div:1,li:1});CKEDITOR.tools.extend(q,o,{td:1});CKEDITOR.plugins.add("bidi",{init:function(a){function f(b,c,d,e,f){a.addCommand(d,new CKEDITOR.command(a,e));a.ui.addButton&&a.ui.addButton(b,{label:c,command:d,toolbar:"bidi,"+f})}if(!a.blockless){var d=a.lang.bidi;f("BidiLtr",d.ltr,"bidiltr",m("ltr"),10);f("BidiRtl",d.rtl,"bidirtl",m("rtl"),20);a.on("contentDom",function(){a.document.on("dirChanged",function(b){a.fire("dirChanged",{node:b.data,dir:b.data.getDirection(1)})})});a.on("contentDirChanged",function(b){var b=(a.lang.dir!=b.data?"add":"remove")+"Class",c=a.ui.space(a.config.toolbarLocation);if(c)c[b]("cke_mixed_dir_content")})}}});for(var j=CKEDITOR.dom.element.prototype,l=["setStyle","removeStyle","setAttribute","removeAttribute"],k=0;k<l.length;k++)j[l[k]]=CKEDITOR.tools.override(j[l[k]],s)})();(function(){var k={exec:function(g){var a=g.getCommand("blockquote").state,i=g.getSelection(),c=i&&i.getRanges()[0];if(c){var h=i.createBookmarks();if(CKEDITOR.env.ie){var e=h[0].startNode,b=h[0].endNode,d;if(e&&"blockquote"==e.getParent().getName())for(d=e;d=d.getNext();)if(d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()){e.move(d,!0);break}if(b&&"blockquote"==b.getParent().getName())for(d=b;d=d.getPrevious();)if(d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()){b.move(d);break}}var f=c.createIterator();f.enlargeBr=g.config.enterMode!=CKEDITOR.ENTER_BR;if(a==CKEDITOR.TRISTATE_OFF){for(e=[];a=f.getNextParagraph();)e.push(a);1>e.length&&(a=g.document.createElement(g.config.enterMode==CKEDITOR.ENTER_P?"p":"div"),b=h.shift(),c.insertNode(a),a.append(new CKEDITOR.dom.text("﻿",g.document)),c.moveToBookmark(b),c.selectNodeContents(a),c.collapse(!0),b=c.createBookmark(),e.push(a),h.unshift(b));d=e[0].getParent();c=[];for(b=0;b<e.length;b++)a=e[b],d=d.getCommonAncestor(a.getParent());for(a={table:1,tbody:1,tr:1,ol:1,ul:1};a[d.getName()];)d=d.getParent();for(b=null;0<e.length;){for(a=e.shift();!a.getParent().equals(d);)a=a.getParent();a.equals(b)||c.push(a);b=a}for(;0<c.length;)if(a=c.shift(),"blockquote"==a.getName()){for(b=new CKEDITOR.dom.documentFragment(g.document);a.getFirst();)b.append(a.getFirst().remove()),e.push(b.getLast());b.replace(a)}else e.push(a);c=g.document.createElement("blockquote");for(c.insertBefore(e[0]);0<e.length;)a=e.shift(),c.append(a)}else if(a==CKEDITOR.TRISTATE_ON){b=[];for(d={};a=f.getNextParagraph();){for(e=c=null;a.getParent();){if("blockquote"==a.getParent().getName()){c=a.getParent();e=a;break}a=a.getParent()}c&&(e&&!e.getCustomData("blockquote_moveout"))&&(b.push(e),CKEDITOR.dom.element.setMarker(d,e,"blockquote_moveout",!0))}CKEDITOR.dom.element.clearAllMarkers(d);a=[];e=[];for(d={};0<b.length;)f=b.shift(),c=f.getParent(),f.getPrevious()?f.getNext()?(f.breakParent(f.getParent()),e.push(f.getNext())):f.remove().insertAfter(c):f.remove().insertBefore(c),c.getCustomData("blockquote_processed")||(e.push(c),CKEDITOR.dom.element.setMarker(d,c,"blockquote_processed",!0)),a.push(f);CKEDITOR.dom.element.clearAllMarkers(d);for(b=e.length-1;0<=b;b--){c=e[b];a:{d=c;for(var f=0,k=d.getChildCount(),j=void 0;f<k&&(j=d.getChild(f));f++)if(j.type==CKEDITOR.NODE_ELEMENT&&j.isBlockBoundary()){d=!1;break a}d=!0}d&&c.remove()}if(g.config.enterMode==CKEDITOR.ENTER_BR)for(c=!0;a.length;)if(f=a.shift(),"div"==f.getName()){b=new CKEDITOR.dom.documentFragment(g.document);c&&(f.getPrevious()&&!(f.getPrevious().type==CKEDITOR.NODE_ELEMENT&&f.getPrevious().isBlockBoundary()))&&b.append(g.document.createElement("br"));for(c=f.getNext()&&!(f.getNext().type==CKEDITOR.NODE_ELEMENT&&f.getNext().isBlockBoundary());f.getFirst();)f.getFirst().remove().appendTo(b);c&&b.append(g.document.createElement("br"));b.replace(f);c=!1}}i.selectBookmarks(h);g.focus()}},refresh:function(g,a){this.setState(g.elementPath(a.block||a.blockLimit).contains("blockquote",1)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)},context:"blockquote",allowedContent:"blockquote",requiredContent:"blockquote"};CKEDITOR.plugins.add("blockquote",{init:function(g){g.blockless||(g.addCommand("blockquote",k),g.ui.addButton&&g.ui.addButton("Blockquote",{label:g.lang.blockquote.toolbar,command:"blockquote",toolbar:"blocks,10"}))}})})();(function(){function v(b){function a(){var e=b.editable();e.on(p,function(b){(!CKEDITOR.env.ie||!n)&&u(b)});CKEDITOR.env.ie&&e.on("paste",function(e){q||(g(),e.data.preventDefault(),u(e),h("paste")||b.openDialog("paste"))});CKEDITOR.env.ie&&(e.on("contextmenu",i,null,null,0),e.on("beforepaste",function(b){b.data&&(!b.data.$.ctrlKey&&!b.data.$.shiftKey)&&i()},null,null,0));e.on("beforecut",function(){!n&&j(b)});var a;e.attachListener(CKEDITOR.env.ie?e:b.document.getDocumentElement(),"mouseup",function(){a=setTimeout(function(){r()},0)});b.on("destroy",function(){clearTimeout(a)});e.on("keyup",r)}function c(e){return{type:e,canUndo:"cut"==e,startDisabled:!0,exec:function(){"cut"==this.type&&j();var e;var a=this.type;if(CKEDITOR.env.ie)e=h(a);else try{e=b.document.$.execCommand(a,!1,null)}catch(d){e=!1}e||alert(b.lang.clipboard[this.type+"Error"]);return e}}}function d(){return{canUndo:!1,async:!0,exec:function(b,a){var d=function(a,d){a&&f(a.type,a.dataValue,!!d);b.fire("afterCommandExec",{name:"paste",command:c,returnValue:!!a})},c=this;"string"==typeof a?d({type:"auto",dataValue:a},1):b.getClipboardData(d)}}}function g(){q=1;setTimeout(function(){q=0},100)}function i(){n=1;setTimeout(function(){n=0},10)}function h(e){var a=b.document,d=a.getBody(),c=!1,j=function(){c=!0};d.on(e,j);(7<CKEDITOR.env.version?a.$:a.$.selection.createRange()).execCommand(e);d.removeListener(e,j);return c}function f(e,a,d){e={type:e};if(d&&!1===b.fire("beforePaste",e)||!a)return!1;e.dataValue=a;return b.fire("paste",e)}function j(){if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var e=b.getSelection(),a,d,c;if(e.getType()==CKEDITOR.SELECTION_ELEMENT&&(a=e.getSelectedElement()))d=e.getRanges()[0],c=b.document.createText(""),c.insertBefore(a),d.setStartBefore(c),d.setEndAfter(a),e.selectRanges([d]),setTimeout(function(){a.getParent()&&(c.remove(),e.selectElement(a))},0)}}function l(a,d){var c=b.document,j=b.editable(),l=function(b){b.cancel()},g;if(!c.getById("cke_pastebin")){var i=b.getSelection(),s=i.createBookmarks();CKEDITOR.env.ie&&i.root.fire("selectionchange");var k=new CKEDITOR.dom.element((CKEDITOR.env.webkit||j.is("body"))&&!CKEDITOR.env.ie?"body":"div",c);k.setAttributes({id:"cke_pastebin","data-cke-temp":"1"});var f=0,c=c.getWindow();CKEDITOR.env.webkit?(j.append(k),k.addClass("cke_editable"),j.is("body")||(f="static"!=j.getComputedStyle("position")?j:CKEDITOR.dom.element.get(j.$.offsetParent),f=f.getDocumentPosition().y)):j.getAscendant(CKEDITOR.env.ie?"body":"html",1).append(k);k.setStyles({position:"absolute",top:c.getScrollPosition().y-f+10+"px",width:"1px",height:Math.max(1,c.getViewPaneSize().height-20)+"px",overflow:"hidden",margin:0,padding:0});CKEDITOR.env.safari&&k.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","text"));(f=k.getParent().isReadOnly())?(k.setOpacity(0),k.setAttribute("contenteditable",!0)):k.setStyle("ltr"==b.config.contentsLangDirection?"left":"right","-1000px");b.on("selectionChange",l,null,null,0);if(CKEDITOR.env.webkit||CKEDITOR.env.gecko)g=j.once("blur",l,null,null,-100);f&&k.focus();f=new CKEDITOR.dom.range(k);f.selectNodeContents(k);var h=f.select();CKEDITOR.env.ie&&(g=j.once("blur",function(){b.lockSelection(h)}));var m=CKEDITOR.document.getWindow().getScrollPosition().y;setTimeout(function(){if(CKEDITOR.env.webkit)CKEDITOR.document.getBody().$.scrollTop=m;g&&g.removeListener();CKEDITOR.env.ie&&j.focus();i.selectBookmarks(s);k.remove();var a;if(CKEDITOR.env.webkit&&(a=k.getFirst())&&a.is&&a.hasClass("Apple-style-span"))k=a;b.removeListener("selectionChange",l);d(k.getHtml())},0)}}function s(){if(CKEDITOR.env.ie){b.focus();g();var a=b.focusManager;a.lock();if(b.editable().fire(p)&&!h("paste"))return a.unlock(),!1;a.unlock()}else try{if(b.editable().fire(p)&&!b.document.$.execCommand("Paste",!1,null))throw 0;}catch(d){return!1}return!0}function o(a){if("wysiwyg"==b.mode)switch(a.data.keyCode){case CKEDITOR.CTRL+86:case CKEDITOR.SHIFT+45:a=b.editable();g();!CKEDITOR.env.ie&&a.fire("beforepaste");break;case CKEDITOR.CTRL+88:case CKEDITOR.SHIFT+46:b.fire("saveSnapshot"),setTimeout(function(){b.fire("saveSnapshot")},50)}}function u(a){var d={type:"auto"},c=b.fire("beforePaste",d);l(a,function(b){b=b.replace(/<span[^>]+data-cke-bookmark[^<]*?<\/span>/ig,"");c&&f(d.type,b,0,1)})}function r(){if("wysiwyg"==b.mode){var a=m("paste");b.getCommand("cut").setState(m("cut"));b.getCommand("copy").setState(m("copy"));b.getCommand("paste").setState(a);b.fire("pasteState",a)}}function m(a){if(t&&a in{paste:1,cut:1})return CKEDITOR.TRISTATE_DISABLED;if("paste"==a)return CKEDITOR.TRISTATE_OFF;var a=b.getSelection(),d=a.getRanges();return a.getType()==CKEDITOR.SELECTION_NONE||1==d.length&&d[0].collapsed?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF}var n=0,q=0,t=0,p=CKEDITOR.env.ie?"beforepaste":"paste";(function(){b.on("key",o);b.on("contentDom",a);b.on("selectionChange",function(b){t=b.data.selection.getRanges()[0].checkReadOnly();r()});b.contextMenu&&b.contextMenu.addListener(function(b,a){t=a.getRanges()[0].checkReadOnly();return{cut:m("cut"),copy:m("copy"),paste:m("paste")}})})();(function(){function a(d,c,j,e,l){var g=b.lang.clipboard[c];b.addCommand(c,j);b.ui.addButton&&b.ui.addButton(d,{label:g,command:c,toolbar:"clipboard,"+e});b.addMenuItems&&b.addMenuItem(c,{label:g,command:c,group:"clipboard",order:l})}a("Cut","cut",c("cut"),10,1);a("Copy","copy",c("copy"),20,4);a("Paste","paste",d(),30,8)})();b.getClipboardData=function(a,d){function c(a){a.removeListener();a.cancel();d(a.data)}function j(a){a.removeListener();a.cancel();i=!0;d({type:f,dataValue:a.data})}function l(){this.customTitle=a&&a.title}var g=!1,f="auto",i=!1;d||(d=a,a=null);b.on("paste",c,null,null,0);b.on("beforePaste",function(a){a.removeListener();g=true;f=a.data.type},null,null,1E3);!1===s()&&(b.removeListener("paste",c),g&&b.fire("pasteDialog",l)?(b.on("pasteDialogCommit",j),b.on("dialogHide",function(a){a.removeListener();a.data.removeListener("pasteDialogCommit",j);setTimeout(function(){i||d(null)},10)})):d(null))}}function w(b){if(CKEDITOR.env.webkit){if(!b.match(/^[^<]*$/g)&&!b.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return"html"}else if(CKEDITOR.env.ie){if(!b.match(/^([^<]|<br( ?\/)?>)*$/gi)&&!b.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return"html"}else if(CKEDITOR.env.gecko){if(!b.match(/^([^<]|<br( ?\/)?>)*$/gi))return"html"}else return"html";return"htmlifiedtext"}function x(b,a){function c(a){return CKEDITOR.tools.repeat("</p><p>",~~(a/2))+(1==a%2?"<br>":"")}a=a.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>");a=a.replace(/<\/?[A-Z]+>/g,function(a){return a.toLowerCase()});if(a.match(/^[^<]$/))return a;CKEDITOR.env.webkit&&-1<a.indexOf("<div>")&&(a=a.replace(/^(<div>(<br>|)<\/div>)(?!$|(<div>(<br>|)<\/div>))/g,"<br>").replace(/^(<div>(<br>|)<\/div>){2}(?!$)/g,"<div></div>"),a.match(/<div>(<br>|)<\/div>/)&&(a="<p>"+a.replace(/(<div>(<br>|)<\/div>)+/g,function(a){return c(a.split("</div><div>").length+1)})+"</p>"),a=a.replace(/<\/div><div>/g,"<br>"),a=a.replace(/<\/?div>/g,""));CKEDITOR.env.gecko&&b.enterMode!=CKEDITOR.ENTER_BR&&(CKEDITOR.env.gecko&&(a=a.replace(/^<br><br>$/,"<br>")),-1<a.indexOf("<br><br>")&&(a="<p>"+a.replace(/(<br>){2,}/g,function(a){return c(a.length/4)})+"</p>"));return o(b,a)}function y(){var b=new CKEDITOR.htmlParser.filter,a={blockquote:1,dl:1,fieldset:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ol:1,p:1,table:1,ul:1},c=CKEDITOR.tools.extend({br:0},CKEDITOR.dtd.$inline),d={p:1,br:1,"cke:br":1},g=CKEDITOR.dtd,i=CKEDITOR.tools.extend({area:1,basefont:1,embed:1,iframe:1,map:1,object:1,param:1},CKEDITOR.dtd.$nonBodyContent,CKEDITOR.dtd.$cdata),h=function(a){delete a.name;a.add(new CKEDITOR.htmlParser.text(" "))},f=function(a){for(var b=a,c;(b=b.next)&&b.name&&b.name.match(/^h\d$/);){c=new CKEDITOR.htmlParser.element("cke:br");c.isEmpty=!0;for(a.add(c);c=b.children.shift();)a.add(c)}};b.addRules({elements:{h1:f,h2:f,h3:f,h4:f,h5:f,h6:f,img:function(a){var a=CKEDITOR.tools.trim(a.attributes.alt||""),b=" ";a&&!a.match(/(^http|\.(jpe?g|gif|png))/i)&&(b=" ["+a+"] ");return new CKEDITOR.htmlParser.text(b)},td:h,th:h,$:function(b){var f=b.name,h;if(i[f])return!1;b.attributes={};if("br"==f)return b;if(a[f])b.name="p";else if(c[f])delete b.name;else if(g[f]){h=new CKEDITOR.htmlParser.element("cke:br");h.isEmpty=!0;if(CKEDITOR.dtd.$empty[f])return h;b.add(h,0);h=h.clone();h.isEmpty=!0;b.add(h);delete b.name}d[b.name]||delete b.name;return b}}},{applyToAll:!0});return b}function z(b,a,c){var a=new CKEDITOR.htmlParser.fragment.fromHtml(a),d=new CKEDITOR.htmlParser.basicWriter;a.writeHtml(d,c);var a=d.getHtml(),a=a.replace(/\s*(<\/?[a-z:]+ ?\/?>)\s*/g,"$1").replace(/(<cke:br \/>){2,}/g,"<cke:br />").replace(/(<cke:br \/>)(<\/?p>|<br \/>)/g,"$2").replace(/(<\/?p>|<br \/>)(<cke:br \/>)/g,"$1").replace(/<(cke:)?br( \/)?>/g,"<br>").replace(/<p><\/p>/g,""),g=0,a=a.replace(/<\/?p>/g,function(a){if("<p>"==a){if(1<++g)return"</p><p>"}else if(0<--g)return"</p><p>";return a}).replace(/<p><\/p>/g,"");return o(b,a)}function o(b,a){b.enterMode==CKEDITOR.ENTER_BR?a=a.replace(/(<\/p><p>)+/g,function(a){return CKEDITOR.tools.repeat("<br>",2*(a.length/7))}).replace(/<\/?p>/g,""):b.enterMode==CKEDITOR.ENTER_DIV&&(a=a.replace(/<(\/)?p>/g,"<$1div>"));return a}CKEDITOR.plugins.add("clipboard",{requires:"dialog",init:function(b){var a;v(b);CKEDITOR.dialog.add("paste",CKEDITOR.getUrl(this.path+"dialogs/paste.js"));b.on("paste",function(a){var b=a.data.dataValue,g=CKEDITOR.dtd.$block;-1<b.indexOf("Apple-")&&(b=b.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),"html"!=a.data.type&&(b=b.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(a,b){return b.replace(/\t/g,"&nbsp;&nbsp; &nbsp;")})),-1<b.indexOf('<br class="Apple-interchange-newline">')&&(a.data.startsWithEOL=1,a.data.preSniffing="html",b=b.replace(/<br class="Apple-interchange-newline">/,"")),b=b.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1"));if(b.match(/^<[^<]+cke_(editable|contents)/i)){var i,h,f=new CKEDITOR.dom.element("div");for(f.setHtml(b);1==f.getChildCount()&&(i=f.getFirst())&&i.type==CKEDITOR.NODE_ELEMENT&&(i.hasClass("cke_editable")||i.hasClass("cke_contents"));)f=h=i;h&&(b=h.getHtml().replace(/<br>$/i,""))}CKEDITOR.env.ie?b=b.replace(/^&nbsp;(?: |\r\n)?<(\w+)/g,function(b,d){if(d.toLowerCase()in g){a.data.preSniffing="html";return"<"+d}return b}):CKEDITOR.env.webkit?b=b.replace(/<\/(\w+)><div><br><\/div>$/,function(b,d){if(d in g){a.data.endsWithEOL=1;return"</"+d+">"}return b}):CKEDITOR.env.gecko&&(b=b.replace(/(\s)<br>$/,"$1"));a.data.dataValue=b},null,null,3);b.on("paste",function(c){var c=c.data,d=c.type,g=c.dataValue,i,h=b.config.clipboard_defaultContentType||"html";i="html"==d||"html"==c.preSniffing?"html":w(g);"htmlifiedtext"==i?g=x(b.config,g):"text"==d&&"html"==i&&(g=z(b.config,g,a||(a=y(b))));c.startsWithEOL&&(g='<br data-cke-eol="1">'+g);c.endsWithEOL&&(g+='<br data-cke-eol="1">');"auto"==d&&(d="html"==i||"html"==h?"html":"text");c.type=d;c.dataValue=g;delete c.preSniffing;delete c.startsWithEOL;delete c.endsWithEOL},null,null,6);b.on("paste",function(a){a=a.data;b.insertHtml(a.dataValue,a.type);setTimeout(function(){b.fire("afterPaste")},0)},null,null,1E3);b.on("pasteDialog",function(a){setTimeout(function(){b.openDialog("paste",a.data)},0)})}})})();(function(){var c='<a id="{id}" class="cke_button cke_button__{name} cke_button_{state} {cls}"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' title="{title}" tabindex="-1" hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="{hasArrow}" aria-disabled="{ariaDisabled}"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(c+=' onkeypress="return false;"');CKEDITOR.env.gecko&&(c+=' onblur="this.style.cssText = this.style.cssText;"');var c=c+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+
(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span class="cke_button_icon cke_button__{iconName}_icon" style="{style}"'),c=c+'>&nbsp;</span><span id="{id}_label" class="cke_button_label cke_button__{name}_label" aria-hidden="false">{label}</span>{arrowHtml}</a>',m=CKEDITOR.addTemplate("buttonArrow",'<span class="cke_button_arrow">'+(CKEDITOR.env.hc?"&#9660;":"")+"</span>"),n=CKEDITOR.addTemplate("button",c);CKEDITOR.plugins.add("button",{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}});CKEDITOR.UI_BUTTON="button";CKEDITOR.ui.button=function(a){CKEDITOR.tools.extend(this,a,{title:a.label,click:a.click||function(b){b.execCommand(a.command)}});this._={}};CKEDITOR.ui.button.handler={create:function(a){return new CKEDITOR.ui.button(a)}};CKEDITOR.ui.button.prototype={render:function(a,b){var c=CKEDITOR.env,i=this._.id=CKEDITOR.tools.getNextId(),e="",f=this.command,k;this._.editor=a;var d={id:i,button:this,editor:a,focus:function(){CKEDITOR.document.getById(i).focus()},execute:function(){this.button.click(a)},attach:function(a){this.button.attach(a)}},o=CKEDITOR.tools.addFunction(function(a){if(d.onkey)return a=new CKEDITOR.dom.event(a),!1!==d.onkey(d,a.getKeystroke())}),p=CKEDITOR.tools.addFunction(function(a){var b;d.onfocus&&(b=!1!==d.onfocus(d,new CKEDITOR.dom.event(a)));return b}),l=0;d.clickFn=k=CKEDITOR.tools.addFunction(function(){l&&(a.unlockSelection(1),l=0);d.execute();c.iOS&&a.focus()});if(this.modes){var j={},g=function(){var b=a.mode;b&&(b=this.modes[b]?void 0!=j[b]?j[b]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,b=a.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:b,this.setState(b),this.refresh&&this.refresh())};a.on("beforeModeUnload",function(){a.mode&&this._.state!=CKEDITOR.TRISTATE_DISABLED&&(j[a.mode]=this._.state)},this);a.on("activeFilterChange",g,this);a.on("mode",g,this);!this.readOnly&&a.on("readOnly",g,this)}else if(f&&(f=a.getCommand(f)))f.on("state",function(){this.setState(f.state)},this),e+=f.state==CKEDITOR.TRISTATE_ON?"on":f.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";if(this.directional)a.on("contentDirChanged",function(b){var c=CKEDITOR.document.getById(this._.id),d=c.getFirst(),b=b.data;b!=a.lang.dir?c.addClass("cke_"+b):c.removeClass("cke_ltr").removeClass("cke_rtl");d.setAttribute("style",CKEDITOR.skin.getIconStyle(h,"rtl"==b,this.icon,this.iconOffset))},this);f||(e+="off");var h=g=this.name||this.command;this.icon&&!/\./.test(this.icon)&&(h=this.icon,this.icon=null);e={id:i,name:g,iconName:h,label:this.label,cls:this.className||"",state:e,ariaDisabled:"disabled"==e?"true":"false",title:this.title,titleJs:c.gecko&&!c.hc?"":(this.title||"").replace("'",""),hasArrow:this.hasArrow?"true":"false",keydownFn:o,focusFn:p,clickFn:k,style:CKEDITOR.skin.getIconStyle(h,"rtl"==a.lang.dir,this.icon,this.iconOffset),arrowHtml:this.hasArrow?m.output():""};n.output(e,b);if(this.onRender)this.onRender();return d},setState:function(a){if(this._.state==a)return!1;this._.state=a;var b=CKEDITOR.document.getById(this._.id);return b?(b.setState(a,"cke_button"),a==CKEDITOR.TRISTATE_DISABLED?b.setAttribute("aria-disabled",!0):b.removeAttribute("aria-disabled"),this.hasArrow?(a=a==CKEDITOR.TRISTATE_ON?this._.editor.lang.button.selectedLabel.replace(/%1/g,this.label):this.label,CKEDITOR.document.getById(this._.id+"_label").setText(a)):a==CKEDITOR.TRISTATE_ON?b.setAttribute("aria-pressed",!0):b.removeAttribute("aria-pressed"),!0):!1},getState:function(){return this._.state},toFeature:function(a){if(this._.feature)return this._.feature;var b=this;!this.allowedContent&&(!this.requiredContent&&this.command)&&(b=a.getCommand(this.command)||b);return this._.feature=b}};CKEDITOR.ui.prototype.addButton=function(a,b){this.add(a,CKEDITOR.UI_BUTTON,b)}})();CKEDITOR.plugins.add("panelbutton",{requires:"button",onLoad:function(){function e(c){var a=this._;a.state!=CKEDITOR.TRISTATE_DISABLED&&(this.createPanel(c),a.on?a.panel.hide():a.panel.showBlock(this._.id,this.document.getById(this._.id),4))}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(c){var a=c.panel||{};delete c.panel;this.base(c);this.document=a.parent&&a.parent.getDocument()||CKEDITOR.document;a.block={attributes:a.attributes};this.hasArrow=a.toolbarRelated=!0;this.click=e;this._={panelDefinition:a}},statics:{handler:{create:function(c){return new CKEDITOR.ui.panelButton(c)}}},proto:{createPanel:function(c){var a=this._;if(!a.panel){var f=this._.panelDefinition,e=this._.panelDefinition.block,g=f.parent||CKEDITOR.document.getBody(),d=this._.panel=new CKEDITOR.ui.floatPanel(c,g,f),f=d.addBlock(a.id,e),b=this;d.onShow=function(){b.className&&this.element.addClass(b.className+"_panel");b.setState(CKEDITOR.TRISTATE_ON);a.on=1;b.editorFocus&&c.focus();if(b.onOpen)b.onOpen()};d.onHide=function(d){b.className&&this.element.getFirst().removeClass(b.className+"_panel");b.setState(b.modes&&b.modes[c.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);a.on=0;if(!d&&b.onClose)b.onClose()};d.onEscape=function(){d.hide(1);b.document.getById(a.id).focus()};if(this.onBlock)this.onBlock(d,f);f.onHide=function(){a.on=0;b.setState(CKEDITOR.TRISTATE_OFF)}}}}})},beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}});CKEDITOR.UI_PANELBUTTON="panelbutton";(function(){CKEDITOR.plugins.add("panel",{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}});CKEDITOR.UI_PANEL="panel";CKEDITOR.ui.panel=function(a,b){b&&CKEDITOR.tools.extend(this,b);CKEDITOR.tools.extend(this,{className:"",css:[]});this.id=CKEDITOR.tools.getNextId();this.document=a;this.isFramed=this.forceIFrame||this.css.length;this._={blocks:{}}};CKEDITOR.ui.panel.handler={create:function(a){return new CKEDITOR.ui.panel(a)}};var f=CKEDITOR.addTemplate("panel",'<div lang="{langCode}" id="{id}" dir={dir} class="cke cke_reset_all {editorId} cke_panel cke_panel {cls} cke_{dir}" style="z-index:{z-index}" role="presentation">{frame}</div>'),g=CKEDITOR.addTemplate("panel-frame",'<iframe id="{id}" class="cke_panel_frame" role="presentation" frameborder="0" src="{src}"></iframe>'),h=CKEDITOR.addTemplate("panel-frame-inner",'<!DOCTYPE html><html class="cke_panel_container {env}" dir="{dir}" lang="{langCode}"><head>{css}</head><body class="cke_{dir}" style="margin:0;padding:0" onload="{onload}"></body></html>');CKEDITOR.ui.panel.prototype={render:function(a,b){this.getHolderElement=function(){var a=this._.holder;if(!a){if(this.isFramed){var a=this.document.getById(this.id+"_frame"),b=a.getParent(),a=a.getFrameDocument();CKEDITOR.env.iOS&&b.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"});b=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=!0;if(this.onLoad)this.onLoad()},this));a.write(h.output(CKEDITOR.tools.extend({css:CKEDITOR.tools.buildStyleHtml(this.css),onload:"window.parent.CKEDITOR.tools.callFunction("+
b+");"},d)));a.getWindow().$.CKEDITOR=CKEDITOR;a.on("keydown",function(a){var b=a.data.getKeystroke(),c=this.document.getById(this.id).getAttribute("dir");this._.onKeyDown&&!1===this._.onKeyDown(b)?a.data.preventDefault():(27==b||b==("rtl"==c?39:37))&&this.onEscape&&!1===this.onEscape(b)&&a.data.preventDefault()},this);a=a.getBody();a.unselectable();CKEDITOR.env.air&&CKEDITOR.tools.callFunction(b)}else a=this.document.getById(this.id);this._.holder=a}return a};var d={editorId:a.id,id:this.id,langCode:a.langCode,dir:a.lang.dir,cls:this.className,frame:"",env:CKEDITOR.env.cssClass,"z-index":a.config.baseFloatZIndex+1};if(this.isFramed){var e=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())":"";d.frame=g.output({id:this.id+"_frame",src:e})}e=f.output(d);b&&b.push(e);return e},addBlock:function(a,b){b=this._.blocks[a]=b instanceof CKEDITOR.ui.panel.block?b:new CKEDITOR.ui.panel.block(this.getHolderElement(),b);this._.currentBlock||this.showBlock(a);return b},getBlock:function(a){return this._.blocks[a]},showBlock:function(a){var a=this._.blocks[a],b=this._.currentBlock,d=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");b&&b.hide();this._.currentBlock=a;CKEDITOR.fire("ariaWidget",d);a._.focusIndex=-1;this._.onKeyDown=a.onKeyDown&&CKEDITOR.tools.bind(a.onKeyDown,a);a.show();return a},destroy:function(){this.element&&this.element.remove()}};CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(a,b){this.element=a.append(a.getDocument().createElement("div",{attributes:{tabindex:-1,"class":"cke_panel_block"},styles:{display:"none"}}));b&&CKEDITOR.tools.extend(this,b);this.element.setAttributes({role:this.attributes.role||"presentation","aria-label":this.attributes["aria-label"],title:this.attributes.title||this.attributes["aria-label"]});this.keys={};this._.focusIndex=-1;this.element.disableContextMenu()},_:{markItem:function(a){-1!=a&&(a=this.element.getElementsByTag("a").getItem(this._.focusIndex=a),CKEDITOR.env.webkit&&a.getDocument().getWindow().focus(),a.focus(),this.onMark&&this.onMark(a))}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){(!this.onHide||!0!==this.onHide.call(this))&&this.element.setStyle("display","none")},onKeyDown:function(a,b){var d=this.keys[a];switch(d){case"next":for(var e=this._.focusIndex,d=this.element.getElementsByTag("a"),c;c=d.getItem(++e);)if(c.getAttribute("_cke_focus")&&c.$.offsetWidth){this._.focusIndex=e;c.focus();break}return!c&&!b?(this._.focusIndex=-1,this.onKeyDown(a,1)):!1;case"prev":e=this._.focusIndex;for(d=this.element.getElementsByTag("a");0<e&&(c=d.getItem(--e));){if(c.getAttribute("_cke_focus")&&c.$.offsetWidth){this._.focusIndex=e;c.focus();break}c=null}return!c&&!b?(this._.focusIndex=d.count(),this.onKeyDown(a,1)):!1;case"click":case"mouseup":return e=this._.focusIndex,(c=0<=e&&this.element.getElementsByTag("a").getItem(e))&&(c.$[d]?c.$[d]():c.$["on"+d]()),!1}return!0}}})})();CKEDITOR.plugins.add("floatpanel",{requires:"panel"});(function(){function r(a,b,c,i,f){var f=CKEDITOR.tools.genKey(b.getUniqueId(),c.getUniqueId(),a.lang.dir,a.uiColor||"",i.css||"",f||""),h=g[f];h||(h=g[f]=new CKEDITOR.ui.panel(b,i),h.element=c.append(CKEDITOR.dom.element.createFromHtml(h.render(a),b)),h.element.setStyles({display:"none",position:"absolute"}));return h}var g={};CKEDITOR.ui.floatPanel=CKEDITOR.tools.createClass({$:function(a,b,c,i){function f(){d.hide()}c.forceIFrame=1;c.toolbarRelated&&a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(b=CKEDITOR.document.getById("cke_"+a.name));var h=b.getDocument(),i=r(a,h,b,c,i||0),j=i.element,l=j.getFirst(),d=this;j.disableContextMenu();this.element=j;this._={editor:a,panel:i,parentElement:b,definition:c,document:h,iframe:l,children:[],dir:a.lang.dir};a.on("mode",f);a.on("resize",f);if(!CKEDITOR.env.iOS)h.getWindow().on("resize",f)},proto:{addBlock:function(a,b){return this._.panel.addBlock(a,b)},addListBlock:function(a,b){return this._.panel.addListBlock(a,b)},getBlock:function(a){return this._.panel.getBlock(a)},showBlock:function(a,b,c,i,f,h){var j=this._.panel,l=j.showBlock(a);this.allowBlur(!1);a=this._.editor.editable();this._.returnFocus=a.hasFocus?a:new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement);this._.hideTimeout=0;var d=this.element,a=this._.iframe,a=CKEDITOR.env.ie?a:new CKEDITOR.dom.window(a.$.contentWindow),g=d.getDocument(),o=this._.parentElement.getPositionedAncestor(),p=b.getDocumentPosition(g),g=o?o.getDocumentPosition(g):{x:0,y:0},m="rtl"==this._.dir,e=p.x+(i||0)-g.x,k=p.y+(f||0)-g.y;if(m&&(1==c||4==c))e+=b.$.offsetWidth;else if(!m&&(2==c||3==c))e+=b.$.offsetWidth-1;if(3==c||4==c)k+=b.$.offsetHeight-1;this._.panel._.offsetParentId=b.getId();d.setStyles({top:k+"px",left:0,display:""});d.setOpacity(0);d.getFirst().removeStyle("width");this._.editor.focusManager.add(a);this._.blurSet||(CKEDITOR.event.useCapture=!0,a.on("blur",function(a){function q(){delete this._.returnFocus;this.hide()}this.allowBlur()&&a.data.getPhase()==CKEDITOR.EVENT_PHASE_AT_TARGET&&(this.visible&&!this._.activeChild)&&(CKEDITOR.env.iOS?this._.hideTimeout||(this._.hideTimeout=CKEDITOR.tools.setTimeout(q,0,this)):q.call(this))},this),a.on("focus",function(){this._.focused=!0;this.hideChild();this.allowBlur(!0)},this),CKEDITOR.env.iOS&&(a.on("touchstart",function(){clearTimeout(this._.hideTimeout)},this),a.on("touchend",function(){this._.hideTimeout=0;this.focus()},this)),CKEDITOR.event.useCapture=!1,this._.blurSet=1);j.onEscape=CKEDITOR.tools.bind(function(a){if(this.onEscape&&this.onEscape(a)===false)return false},this);CKEDITOR.tools.setTimeout(function(){var a=CKEDITOR.tools.bind(function(){d.removeStyle("width");if(l.autoSize){var a=l.element.getDocument(),a=(CKEDITOR.env.webkit?l.element:a.getBody()).$.scrollWidth;CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&a>0)&&(a=a+((d.$.offsetWidth||0)-(d.$.clientWidth||0)+3));d.setStyle("width",a+10+"px");a=l.element.$.scrollHeight;CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&a>0)&&(a=a+((d.$.offsetHeight||0)-(d.$.clientHeight||0)+3));d.setStyle("height",a+"px");j._.currentBlock.element.setStyle("display","none").removeStyle("display")}else d.removeStyle("height");m&&(e=e-d.$.offsetWidth);d.setStyle("left",e+"px");var b=j.element.getWindow(),a=d.$.getBoundingClientRect(),b=b.getViewPaneSize(),c=a.width||a.right-a.left,f=a.height||a.bottom-a.top,i=m?a.right:b.width-a.left,g=m?b.width-a.right:a.left;m?i<c&&(e=g>c?e+c:b.width>c?e-a.left:e-a.right+b.width):i<c&&(e=g>c?e-c:b.width>c?e-a.right+b.width:e-a.left);c=a.top;b.height-a.top<f&&(k=c>f?k-f:b.height>f?k-a.bottom+b.height:k-a.top);if(CKEDITOR.env.ie){b=a=new CKEDITOR.dom.element(d.$.offsetParent);b.getName()=="html"&&(b=b.getDocument().getBody());b.getComputedStyle("direction")=="rtl"&&(e=CKEDITOR.env.ie8Compat?e-d.getDocument().getDocumentElement().$.scrollLeft*2:e-(a.$.scrollWidth-a.$.clientWidth))}var a=d.getFirst(),n;(n=a.getCustomData("activePanel"))&&n.onHide&&n.onHide.call(this,1);a.setCustomData("activePanel",this);d.setStyles({top:k+"px",left:e+"px"});d.setOpacity(1);h&&h()},this);j.isLoaded?a():j.onLoad=a;CKEDITOR.tools.setTimeout(function(){var a=CKEDITOR.env.webkit&&CKEDITOR.document.getWindow().getScrollPosition().y;this.focus();l.element.focus();if(CKEDITOR.env.webkit)CKEDITOR.document.getBody().$.scrollTop=a;this.allowBlur(true);this._.editor.fire("panelShow",this)},0,this)},CKEDITOR.env.air?200:0,this);this.visible=1;this.onShow&&this.onShow.call(this)},focus:function(){if(CKEDITOR.env.webkit){var a=CKEDITOR.document.getActive();a&&!a.equals(this._.iframe)&&a.$.blur()}(this._.lastFocused||this._.iframe.getFrameDocument().getWindow()).focus()},blur:function(){var a=this._.iframe.getFrameDocument().getActive();a&&a.is("a")&&(this._.lastFocused=a)},hide:function(a){if(this.visible&&(!this.onHide||!0!==this.onHide.call(this))){this.hideChild();CKEDITOR.env.gecko&&this._.iframe.getFrameDocument().$.activeElement.blur();this.element.setStyle("display","none");this.visible=0;this.element.getFirst().removeCustomData("activePanel");if(a=a&&this._.returnFocus)CKEDITOR.env.webkit&&a.type&&a.getWindow().$.focus(),a.focus();delete this._.lastFocused;this._.editor.fire("panelHide",this)}},allowBlur:function(a){var b=this._.panel;void 0!=a&&(b.allowBlur=a);return b.allowBlur},showAsChild:function(a,b,c,g,f,h){this._.activeChild==a&&a._.panel._.offsetParentId==c.getId()||(this.hideChild(),a.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){this._.focused||this.hide()},0,this)},this),this._.activeChild=a,this._.focused=!1,a.showBlock(b,c,g,f,h),this.blur(),(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&setTimeout(function(){a.element.getChild(0).$.style.cssText+=""},100))},hideChild:function(a){var b=this._.activeChild;b&&(delete b.onHide,delete this._.activeChild,b.hide(),a&&this.focus())}}});CKEDITOR.on("instanceDestroyed",function(){var a=CKEDITOR.tools.isEmpty(CKEDITOR.instances),b;for(b in g){var c=g[b];a?c.destroy():c.element.hide()}a&&(g={})})})();CKEDITOR.plugins.add("colorbutton",{requires:"panelbutton,floatpanel",init:function(c){function o(m,g,d,h){var i=new CKEDITOR.style(j["colorButton_"+g+"Style"]),k=CKEDITOR.tools.getNextId()+"_colorBox";c.ui.add(m,CKEDITOR.UI_PANELBUTTON,{label:d,title:d,modes:{wysiwyg:1},editorFocus:0,toolbar:"colors,"+h,allowedContent:i,requiredContent:i,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":f.panelTitle}},onBlock:function(a,b){b.autoSize=!0;b.element.addClass("cke_colorblock");b.element.setHtml(q(a,g,k));b.element.getDocument().getBody().setStyle("overflow","hidden");CKEDITOR.ui.fire("ready",this);var e=b.keys,d="rtl"==c.lang.dir;e[d?37:39]="next";e[40]="next";e[9]="next";e[d?39:37]="prev";e[38]="prev";e[CKEDITOR.SHIFT+9]="prev";e[32]="click"},refresh:function(){c.activeFilter.check(i)||this.setState(CKEDITOR.TRISTATE_DISABLED)},onOpen:function(){var a=c.getSelection(),a=a&&a.getStartElement(),a=c.elementPath(a),b;if(a){a=a.block||a.blockLimit||c.document.getBody();do b=a&&a.getComputedStyle("back"==g?"background-color":"color")||"transparent";while("back"==g&&"transparent"==b&&a&&(a=a.getParent()));if(!b||"transparent"==b)b="#ffffff";this._.panel._.iframe.getFrameDocument().getById(k).setStyle("background-color",b);return b}}})}function q(m,g,d){var h=[],i=j.colorButton_colors.split(","),k=c.plugins.colordialog&&!1!==j.colorButton_enableMore,a=i.length+(k?2:1),b=CKEDITOR.tools.addFunction(function(a,b){if("?"==a){var e=arguments.callee,d=function(a){this.removeListener("ok",d);this.removeListener("cancel",d);"ok"==a.name&&e(this.getContentElement("picker","selectedColor").getValue(),b)};c.openDialog("colordialog",function(){this.on("ok",d);this.on("cancel",d)})}else{c.focus();m.hide();c.fire("saveSnapshot");c.removeStyle(new CKEDITOR.style(j["colorButton_"+b+"Style"],{color:"inherit"}));if(a){var f=j["colorButton_"+b+"Style"];f.childRule="back"==b?function(a){return p(a)}:function(a){return!(a.is("a")||a.getElementsByTag("a").count())||p(a)};c.applyStyle(new CKEDITOR.style(f,{color:a}))}c.fire("saveSnapshot")}});h.push('<a class="cke_colorauto" _cke_focus=1 hidefocus=true title="',f.auto,'" onclick="CKEDITOR.tools.callFunction(',b,",null,'",g,"');return false;\" href=\"javascript:void('",f.auto,'\')" role="option" aria-posinset="1" aria-setsize="',a,'"><table role="presentation" cellspacing=0 cellpadding=0 width="100%"><tr><td><span class="cke_colorbox" id="',d,'"></span></td><td colspan=7 align=center>',f.auto,'</td></tr></table></a><table role="presentation" cellspacing=0 cellpadding=0 width="100%">');for(d=0;d<i.length;d++){0===d%8&&h.push("</tr><tr>");var e=i[d].split("/"),l=e[0],n=e[1]||l;e[1]||(l="#"+l.replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3"));e=c.lang.colorbutton.colors[n]||n;h.push('<td><a class="cke_colorbox" _cke_focus=1 hidefocus=true title="',e,'" onclick="CKEDITOR.tools.callFunction(',b,",'",l,"','",g,"'); return false;\" href=\"javascript:void('",e,'\')" role="option" aria-posinset="',d+2,'" aria-setsize="',a,'"><span class="cke_colorbox" style="background-color:#',n,'"></span></a></td>')}k&&h.push('</tr><tr><td colspan=8 align=center><a class="cke_colormore" _cke_focus=1 hidefocus=true title="',f.more,'" onclick="CKEDITOR.tools.callFunction(',b,",'?','",g,"');return false;\" href=\"javascript:void('",f.more,"')\"",' role="option" aria-posinset="',a,'" aria-setsize="',a,'">',f.more,"</a></td>");h.push("</tr></table>");return h.join("")}function p(c){return"false"==c.getAttribute("contentEditable")||c.getAttribute("data-nostyle")}var j=c.config,f=c.lang.colorbutton;CKEDITOR.env.hc||(o("TextColor","fore",f.textColorTitle,10),o("BGColor","back",f.bgColorTitle,20))}});CKEDITOR.config.colorButton_colors="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF";CKEDITOR.config.colorButton_foreStyle={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]};CKEDITOR.config.colorButton_backStyle={element:"span",styles:{"background-color":"#(color)"}};CKEDITOR.plugins.colordialog={requires:"dialog",init:function(b){var c=new CKEDITOR.dialogCommand("colordialog");c.editorFocus=!1;b.addCommand("colordialog",c);CKEDITOR.dialog.add("colordialog",this.path+"dialogs/colordialog.js");b.getColorFromDialog=function(c,f){var d=function(a){this.removeListener("ok",d);this.removeListener("cancel",d);a="ok"==a.name?this.getValueOf("picker","selectedColor"):null;c.call(f,a)},e=function(a){a.on("ok",d);a.on("cancel",d)};b.execCommand("colordialog");if(b._.storedDialogs&&b._.storedDialogs.colordialog)e(b._.storedDialogs.colordialog);else CKEDITOR.on("dialogDefinition",function(a){if("colordialog"==a.data.name){var b=a.data.definition;a.removeListener();b.onLoad=CKEDITOR.tools.override(b.onLoad,function(a){return function(){e(this);b.onLoad=a;"function"==typeof a&&a.call(this)}})}})}}};CKEDITOR.plugins.add("colordialog",CKEDITOR.plugins.colordialog);(function(){CKEDITOR.plugins.add("templates",{requires:"dialog",init:function(a){CKEDITOR.dialog.add("templates",CKEDITOR.getUrl(this.path+"dialogs/templates.js"));a.addCommand("templates",new CKEDITOR.dialogCommand("templates"));a.ui.addButton&&a.ui.addButton("Templates",{label:a.lang.templates.button,command:"templates",toolbar:"doctools,10"})}});var c={},f={};CKEDITOR.addTemplates=function(a,d){c[a]=d};CKEDITOR.getTemplates=function(a){return c[a]};CKEDITOR.loadTemplates=function(a,d){for(var e=[],b=0,c=a.length;b<c;b++)f[a[b]]||(e.push(a[b]),f[a[b]]=1);e.length?CKEDITOR.scriptLoader.load(e,d):setTimeout(d,0)}})();CKEDITOR.config.templates_files=[CKEDITOR.getUrl("plugins/templates/templates/default.js")];CKEDITOR.config.templates_replaceContent=!0;CKEDITOR.plugins.add("menu",{requires:"floatpanel",beforeInit:function(g){for(var h=g.config.menu_groups.split(","),m=g._.menuGroups={},l=g._.menuItems={},a=0;a<h.length;a++)m[h[a]]=a+1;g.addMenuGroup=function(b,a){m[b]=a||100};g.addMenuItem=function(a,c){m[c.group]&&(l[a]=new CKEDITOR.menuItem(this,a,c))};g.addMenuItems=function(a){for(var c in a)this.addMenuItem(c,a[c])};g.getMenuItem=function(a){return l[a]};g.removeMenuItem=function(a){delete l[a]}}});(function(){function g(a){a.sort(function(a,c){return a.group<c.group?-1:a.group>c.group?1:a.order<c.order?-1:a.order>c.order?1:0})}var h='<span class="cke_menuitem"><a id="{id}" class="cke_menubutton cke_menubutton__{name} cke_menubutton_{state} {cls}" href="{href}" title="{title}" tabindex="-1"_cke_focus=1 hidefocus="true" role="{role}" aria-haspopup="{hasPopup}" aria-disabled="{disabled}" {ariaChecked}';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(h+=' onkeypress="return false;"');CKEDITOR.env.gecko&&(h+=' onblur="this.style.cssText = this.style.cssText;"');var h=h+(' onmouseover="CKEDITOR.tools.callFunction({hoverFn},{index});" onmouseout="CKEDITOR.tools.callFunction({moveOutFn},{index});" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},{index}); return false;">'),m=CKEDITOR.addTemplate("menuItem",h+'<span class="cke_menubutton_inner"><span class="cke_menubutton_icon"><span class="cke_button_icon cke_button__{iconName}_icon" style="{iconStyle}"></span></span><span class="cke_menubutton_label">{label}</span>{arrowHtml}</span></a></span>'),l=CKEDITOR.addTemplate("menuArrow",'<span class="cke_menuarrow"><span>{label}</span></span>');CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(a,b){b=this._.definition=b||{};this.id=CKEDITOR.tools.getNextId();this.editor=a;this.items=[];this._.listeners=[];this._.level=b.level||1;var c=CKEDITOR.tools.extend({},b.panel,{css:[CKEDITOR.skin.getPath("editor")],level:this._.level-1,block:{}}),k=c.block.attributes=c.attributes||{};!k.role&&(k.role="menu");this._.panelDefinition=c},_:{onShow:function(){var a=this.editor.getSelection(),b=a&&a.getStartElement(),c=this.editor.elementPath(),k=this._.listeners;this.removeAll();for(var e=0;e<k.length;e++){var j=k[e](b,a,c);if(j)for(var i in j){var f=this.editor.getMenuItem(i);if(f&&(!f.command||this.editor.getCommand(f.command).state))f.state=j[i],this.add(f)}}},onClick:function(a){this.hide();if(a.onClick)a.onClick();else a.command&&this.editor.execCommand(a.command)},onEscape:function(a){var b=this.parent;b?b._.panel.hideChild(1):27==a&&this.hide(1);return!1},onHide:function(){this.onHide&&this.onHide()},showSubMenu:function(a){var b=this._.subMenu,c=this.items[a];if(c=c.getItems&&c.getItems()){b?b.removeAll():(b=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},!0)),b.parent=this,b._.onClick=CKEDITOR.tools.bind(this._.onClick,this));for(var k in c){var e=this.editor.getMenuItem(k);e&&(e.state=c[k],b.add(e))}var j=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+(""+a));setTimeout(function(){b.show(j,2)},0)}else this._.panel.hideChild(1)}},proto:{add:function(a){a.order||(a.order=this.items.length);this.items.push(a)},removeAll:function(){this.items=[]},show:function(a,b,c,k){if(!this.parent&&(this._.onShow(),!this.items.length))return;var b=b||("rtl"==this.editor.lang.dir?2:1),e=this.items,j=this.editor,i=this._.panel,f=this._.element;if(!i){i=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level);i.onEscape=CKEDITOR.tools.bind(function(a){if(!1===this._.onEscape(a))return!1},this);i.onShow=function(){i._.panel.getHolderElement().getParent().addClass("cke cke_reset_all")};i.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this);f=i.addBlock(this.id,this._.panelDefinition.block);f.autoSize=!0;var d=f.keys;d[40]="next";d[9]="next";d[38]="prev";d[CKEDITOR.SHIFT+9]="prev";d["rtl"==j.lang.dir?37:39]=CKEDITOR.env.ie?"mouseup":"click";d[32]=CKEDITOR.env.ie?"mouseup":"click";CKEDITOR.env.ie&&(d[13]="mouseup");f=this._.element=f.element;d=f.getDocument();d.getBody().setStyle("overflow","hidden");d.getElementsByTag("html").getItem(0).setStyle("overflow","hidden");this._.itemOverFn=CKEDITOR.tools.addFunction(function(a){clearTimeout(this._.showSubTimeout);this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,j.config.menu_subMenuDelay||400,this,[a])},this);this._.itemOutFn=CKEDITOR.tools.addFunction(function(){clearTimeout(this._.showSubTimeout)},this);this._.itemClickFn=CKEDITOR.tools.addFunction(function(a){var b=this.items[a];if(b.state==CKEDITOR.TRISTATE_DISABLED)this.hide(1);else if(b.getItems)this._.showSubMenu(a);else this._.onClick(b)},this)}g(e);for(var d=j.elementPath(),d=['<div class="cke_menu'+(d&&d.direction()!=j.lang.dir?" cke_mixed_dir_content":"")+'" role="presentation">'],h=e.length,m=h&&e[0].group,l=0;l<h;l++){var n=e[l];m!=n.group&&(d.push('<div class="cke_menuseparator" role="separator"></div>'),m=n.group);n.render(this,l,d)}d.push("</div>");f.setHtml(d.join(""));CKEDITOR.ui.fire("ready",this);this.parent?this.parent._.panel.showAsChild(i,this.id,a,b,c,k):i.showBlock(this.id,a,b,c,k);j.fire("menuShow",[i])},addListener:function(a){this._.listeners.push(a)},hide:function(a){this._.onHide&&this._.onHide();this._.panel&&this._.panel.hide(a)}}});CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(a,b,c){CKEDITOR.tools.extend(this,c,{order:0,className:"cke_menubutton__"+b});this.group=a._.menuGroups[this.group];this.editor=a;this.name=b},proto:{render:function(a,b,c){var h=a.id+(""+
b),e="undefined"==typeof this.state?CKEDITOR.TRISTATE_OFF:this.state,j="",i=e==CKEDITOR.TRISTATE_ON?"on":e==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";this.role in{menuitemcheckbox:1,menuitemradio:1}&&(j=' aria-checked="'+(e==CKEDITOR.TRISTATE_ON?"true":"false")+'"');var f=this.getItems,d="&#"+("rtl"==this.editor.lang.dir?"9668":"9658")+";",g=this.name;this.icon&&!/\./.test(this.icon)&&(g=this.icon);a={id:h,name:this.name,iconName:g,label:this.label,cls:this.className||"",state:i,hasPopup:f?"true":"false",disabled:e==CKEDITOR.TRISTATE_DISABLED,title:this.label,href:"javascript:void('"+(this.label||"").replace("'")+"')",hoverFn:a._.itemOverFn,moveOutFn:a._.itemOutFn,clickFn:a._.itemClickFn,index:b,iconStyle:CKEDITOR.skin.getIconStyle(g,"rtl"==this.editor.lang.dir,g==this.icon?null:this.icon,this.iconOffset),arrowHtml:f?l.output({label:d}):"",role:this.role?this.role:"menuitem",ariaChecked:j};m.output(a,c)}}})})();CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div";CKEDITOR.plugins.add("contextmenu",{requires:"menu",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(a){this.base.call(this,a,{panel:{className:"cke_menu_panel",attributes:{"aria-label":a.lang.contextmenu.options}}})},proto:{addTarget:function(a,e){a.on("contextmenu",function(a){var a=a.data,c=CKEDITOR.env.webkit?f:CKEDITOR.env.mac?a.$.metaKey:a.$.ctrlKey;if(!e||!c){a.preventDefault();if(CKEDITOR.env.mac&&CKEDITOR.env.webkit){var c=this.editor,b=(new CKEDITOR.dom.elementPath(a.getTarget(),c.editable())).contains(function(a){return a.hasAttribute("contenteditable")},!0);b&&"false"==b.getAttribute("contenteditable")&&c.getSelection().fake(b)}var b=a.getTarget().getDocument(),d=a.getTarget().getDocument().getDocumentElement(),c=!b.equals(CKEDITOR.document),b=b.getWindow().getScrollPosition(),g=c?a.$.clientX:a.$.pageX||b.x+a.$.clientX,h=c?a.$.clientY:a.$.pageY||b.y+a.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(d,null,g,h)},CKEDITOR.env.ie?200:0,this)}},this);if(CKEDITOR.env.webkit){var f,d=function(){f=0};a.on("keydown",function(a){f=CKEDITOR.env.mac?a.data.$.metaKey:a.data.$.ctrlKey});a.on("keyup",d);a.on("contextmenu",d)}},open:function(a,e,f,d){this.editor.focus();a=a||CKEDITOR.document.getDocumentElement();this.editor.selectionChange(1);this.show(a,e,f,d)}}})},beforeInit:function(a){var e=a.contextMenu=new CKEDITOR.plugins.contextMenu(a);a.on("contentDom",function(){e.addTarget(a.editable(),!1!==a.config.browserContextMenuOnCtrl)});a.addCommand("contextMenu",{exec:function(){a.contextMenu.open(a.document.getBody())}});a.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu");a.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}});(function(){CKEDITOR.plugins.add("div",{requires:"dialog",init:function(a){if(!a.blockless){var c=a.lang.div,b="div(*)";CKEDITOR.dialog.isTabEnabled(a,"editdiv","advanced")&&(b+=";div[dir,id,lang,title]{*}");a.addCommand("creatediv",new CKEDITOR.dialogCommand("creatediv",{allowedContent:b,requiredContent:"div",contextSensitive:!0,refresh:function(a,c){this.setState("div"in(a.config.div_wrapTable?c.root:c.blockLimit).getDtd()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}}));a.addCommand("editdiv",new CKEDITOR.dialogCommand("editdiv",{requiredContent:"div"}));a.addCommand("removediv",{requiredContent:"div",exec:function(a){function c(b){if((b=CKEDITOR.plugins.div.getSurroundDiv(a,b))&&!b.data("cke-div-added"))f.push(b),b.data("cke-div-added")}for(var b=a.getSelection(),g=b&&b.getRanges(),e,h=b.createBookmarks(),f=[],d=0;d<g.length;d++)e=g[d],e.collapsed?c(b.getStartElement()):(e=new CKEDITOR.dom.walker(e),e.evaluator=c,e.lastForward());for(d=0;d<f.length;d++)f[d].remove(!0);b.selectBookmarks(h)}});a.ui.addButton&&a.ui.addButton("CreateDiv",{label:c.toolbar,command:"creatediv",toolbar:"blocks,50"});a.addMenuItems&&(a.addMenuItems({editdiv:{label:c.edit,command:"editdiv",group:"div",order:1},removediv:{label:c.remove,command:"removediv",group:"div",order:5}}),a.contextMenu&&a.contextMenu.addListener(function(b){return!b||b.isReadOnly()?null:CKEDITOR.plugins.div.getSurroundDiv(a)?{editdiv:CKEDITOR.TRISTATE_OFF,removediv:CKEDITOR.TRISTATE_OFF}:null}));CKEDITOR.dialog.add("creatediv",this.path+"dialogs/div.js");CKEDITOR.dialog.add("editdiv",this.path+"dialogs/div.js")}}});CKEDITOR.plugins.div={getSurroundDiv:function(a,c){var b=a.elementPath(c);return a.elementPath(b.blockLimit).contains(function(a){return a.is("div")&&!a.isReadOnly()},1)}}})();CKEDITOR.plugins.add("resize",{init:function(b){var f,g,n,o,a=b.config,q=b.ui.spaceId("resizer"),h=b.element?b.element.getDirection(1):"ltr";!a.resize_dir&&(a.resize_dir="vertical");void 0==a.resize_maxWidth&&(a.resize_maxWidth=3E3);void 0==a.resize_maxHeight&&(a.resize_maxHeight=3E3);void 0==a.resize_minWidth&&(a.resize_minWidth=750);void 0==a.resize_minHeight&&(a.resize_minHeight=250);if(!1!==a.resize_enabled){var c=null,i=("both"==a.resize_dir||"horizontal"==a.resize_dir)&&a.resize_minWidth!=a.resize_maxWidth,l=("both"==a.resize_dir||"vertical"==a.resize_dir)&&a.resize_minHeight!=a.resize_maxHeight,j=function(d){var e=f,m=g,c=e+(d.data.$.screenX-n)*("rtl"==h?-1:1),d=m+(d.data.$.screenY-o);i&&(e=Math.max(a.resize_minWidth,Math.min(c,a.resize_maxWidth)));l&&(m=Math.max(a.resize_minHeight,Math.min(d,a.resize_maxHeight)));b.resize(i?e:null,m)},k=function(){CKEDITOR.document.removeListener("mousemove",j);CKEDITOR.document.removeListener("mouseup",k);b.document&&(b.document.removeListener("mousemove",j),b.document.removeListener("mouseup",k))},p=CKEDITOR.tools.addFunction(function(d){c||(c=b.getResizable());f=c.$.offsetWidth||0;g=c.$.offsetHeight||0;n=d.screenX;o=d.screenY;a.resize_minWidth>f&&(a.resize_minWidth=f);a.resize_minHeight>g&&(a.resize_minHeight=g);CKEDITOR.document.on("mousemove",j);CKEDITOR.document.on("mouseup",k);b.document&&(b.document.on("mousemove",j),b.document.on("mouseup",k));d.preventDefault&&d.preventDefault()});b.on("destroy",function(){CKEDITOR.tools.removeFunction(p)});b.on("uiSpace",function(a){if("bottom"==a.data.space){var e="";i&&!l&&(e=" cke_resizer_horizontal");!i&&l&&(e=" cke_resizer_vertical");var c='<span id="'+q+'" class="cke_resizer'+e+" cke_resizer_"+h+'" title="'+CKEDITOR.tools.htmlEncode(b.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+p+', event)">'+("ltr"==h?"◢":"◣")+"</span>";"ltr"==h&&"ltr"==e?a.data.html+=c:a.data.html=c+a.data.html}},b,null,100);b.on("maximize",function(a){b.ui.space("resizer")[a.data==CKEDITOR.TRISTATE_ON?"hide":"show"]()})}}});(function(){function w(a){function d(){for(var b=g(),e=CKEDITOR.tools.clone(a.config.toolbarGroups)||n(a),f=0;f<e.length;f++){var k=e[f];if("/"!=k){"string"==typeof k&&(k=e[f]={name:k});var i,d=k.groups;if(d)for(var h=0;h<d.length;h++)i=d[h],(i=b[i])&&c(k,i);(i=b[k.name])&&c(k,i)}}return e}function g(){var b={},c,f,e;for(c in a.ui.items)f=a.ui.items[c],e=f.toolbar||"others",e=e.split(","),f=e[0],e=parseInt(e[1]||-1,10),b[f]||(b[f]=[]),b[f].push({name:c,order:e});for(f in b)b[f]=b[f].sort(function(b,a){return b.order==a.order?0:0>a.order?-1:0>b.order?1:b.order<a.order?-1:1});return b}function c(c,e){if(e.length){c.items?c.items.push(a.ui.create("-")):c.items=[];for(var f;f=e.shift();)if(f="string"==typeof f?f:f.name,!b||-1==CKEDITOR.tools.indexOf(b,f))(f=a.ui.create(f))&&a.addFeature(f)&&c.items.push(f)}}function h(b){var a=[],e,d,h;for(e=0;e<b.length;++e)d=b[e],h={},"/"==d?a.push(d):CKEDITOR.tools.isArray(d)?(c(h,CKEDITOR.tools.clone(d)),a.push(h)):d.items&&(c(h,CKEDITOR.tools.clone(d.items)),h.name=d.name,a.push(h));return a}var b=a.config.removeButtons,b=b&&b.split(","),e=a.config.toolbar;"string"==typeof e&&(e=a.config["toolbar_"+e]);return a.toolbar=e?h(e):d()}function n(a){return a._.toolbarGroups||(a._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var u=function(){this.toolbars=[];this.focusCommandExecuted=!1};u.prototype.focus=function(){for(var a=0,d;d=this.toolbars[a++];)for(var g=0,c;c=d.items[g++];)if(c.focus){c.focus();return}};var x={modes:{wysiwyg:1,source:1},readOnly:1,exec:function(a){a.toolbox&&(a.toolbox.focusCommandExecuted=!0,CKEDITOR.env.ie||CKEDITOR.env.air?setTimeout(function(){a.toolbox.focus()},100):a.toolbox.focus())}};CKEDITOR.plugins.add("toolbar",{requires:"button",init:function(a){var d,g=function(c,h){var b,e="rtl"==a.lang.dir,j=a.config.toolbarGroupCycling,o=e?37:39,e=e?39:37,j=void 0===j||j;switch(h){case 9:case CKEDITOR.SHIFT+9:for(;!b||!b.items.length;)if(b=9==h?(b?b.next:c.toolbar.next)||a.toolbox.toolbars[0]:(b?b.previous:c.toolbar.previous)||a.toolbox.toolbars[a.toolbox.toolbars.length-1],b.items.length)for(c=b.items[d?b.items.length-1:0];c&&!c.focus;)(c=d?c.previous:c.next)||(b=0);c&&c.focus();return!1;case o:b=c;do b=b.next,!b&&j&&(b=c.toolbar.items[0]);while(b&&!b.focus);b?b.focus():g(c,9);return!1;case 40:return c.button&&c.button.hasArrow?(a.once("panelShow",function(b){b.data._.panel._.currentBlock.onKeyDown(40)}),c.execute()):g(c,40==h?o:e),!1;case e:case 38:b=c;do b=b.previous,!b&&j&&(b=c.toolbar.items[c.toolbar.items.length-1]);while(b&&!b.focus);b?b.focus():(d=1,g(c,CKEDITOR.SHIFT+9),d=0);return!1;case 27:return a.focus(),!1;case 13:case 32:return c.execute(),!1}return!0};a.on("uiSpace",function(c){if(c.data.space==a.config.toolbarLocation){c.removeListener();a.toolbox=new u;var d=CKEDITOR.tools.getNextId(),b=['<span id="',d,'" class="cke_voice_label">',a.lang.toolbar.toolbars,"</span>",'<span id="'+a.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',d,'" onmousedown="return false;">'],d=!1!==a.config.toolbarStartupExpanded,e,j;a.config.toolbarCanCollapse&&a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&b.push('<span class="cke_toolbox_main"'+
(d?">":' style="display:none">'));for(var o=a.toolbox.toolbars,f=w(a),k=0;k<f.length;k++){var i,l=0,r,m=f[k],s;if(m)if(e&&(b.push("</span>"),j=e=0),"/"===m)b.push('<span class="cke_toolbar_break"></span>');else{s=m.items||m;for(var t=0;t<s.length;t++){var p=s[t],n;if(p)if(p.type==CKEDITOR.UI_SEPARATOR)j=e&&p;else{n=!1!==p.canGroup;if(!l){i=CKEDITOR.tools.getNextId();l={id:i,items:[]};r=m.name&&(a.lang.toolbar.toolbarGroups[m.name]||m.name);b.push('<span id="',i,'" class="cke_toolbar"',r?' aria-labelledby="'+
i+'_label"':"",' role="toolbar">');r&&b.push('<span id="',i,'_label" class="cke_voice_label">',r,"</span>");b.push('<span class="cke_toolbar_start"></span>');var q=o.push(l)-1;0<q&&(l.previous=o[q-1],l.previous.next=l)}n?e||(b.push('<span class="cke_toolgroup" role="presentation">'),e=1):e&&(b.push("</span>"),e=0);i=function(c){c=c.render(a,b);q=l.items.push(c)-1;if(q>0){c.previous=l.items[q-1];c.previous.next=c}c.toolbar=l;c.onkey=g;c.onfocus=function(){a.toolbox.focusCommandExecuted||a.focus()}};j&&(i(j),j=0);i(p)}}e&&(b.push("</span>"),j=e=0);l&&b.push('<span class="cke_toolbar_end"></span></span>')}}a.config.toolbarCanCollapse&&b.push("</span>");if(a.config.toolbarCanCollapse&&a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var v=CKEDITOR.tools.addFunction(function(){a.execCommand("toolbarCollapse")});a.on("destroy",function(){CKEDITOR.tools.removeFunction(v)});a.addCommand("toolbarCollapse",{readOnly:1,exec:function(b){var a=b.ui.space("toolbar_collapser"),c=a.getPrevious(),e=b.ui.space("contents"),d=c.getParent(),f=parseInt(e.$.style.height,10),h=d.$.offsetHeight,g=a.hasClass("cke_toolbox_collapser_min");g?(c.show(),a.removeClass("cke_toolbox_collapser_min"),a.setAttribute("title",b.lang.toolbar.toolbarCollapse)):(c.hide(),a.addClass("cke_toolbox_collapser_min"),a.setAttribute("title",b.lang.toolbar.toolbarExpand));a.getFirst().setText(g?"▲":"◀");e.setStyle("height",f-(d.$.offsetHeight-h)+"px");b.fire("resize")},modes:{wysiwyg:1,source:1}});a.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?189:109),"toolbarCollapse");b.push('<a title="'+(d?a.lang.toolbar.toolbarCollapse:a.lang.toolbar.toolbarExpand)+'" id="'+a.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser');d||b.push(" cke_toolbox_collapser_min");b.push('" onclick="CKEDITOR.tools.callFunction('+v+')">','<span class="cke_arrow">&#9650;</span>',"</a>")}b.push("</span>");c.data.html+=b.join("")}});a.on("destroy",function(){if(this.toolbox){var a,d=0,b,e,g;for(a=this.toolbox.toolbars;d<a.length;d++){e=a[d].items;for(b=0;b<e.length;b++)g=e[b],g.clickFn&&CKEDITOR.tools.removeFunction(g.clickFn),g.keyDownFn&&CKEDITOR.tools.removeFunction(g.keyDownFn)}}});a.on("uiReady",function(){var c=a.ui.space("toolbox");c&&a.focusManager.add(c,1)});a.addCommand("toolbarFocus",x);a.setKeystroke(CKEDITOR.ALT+121,"toolbarFocus");a.ui.add("-",CKEDITOR.UI_SEPARATOR,{});a.ui.addHandler(CKEDITOR.UI_SEPARATOR,{create:function(){return{render:function(a,d){d.push('<span class="cke_toolbar_separator" role="separator"></span>');return{}}}}})}});CKEDITOR.ui.prototype.addToolbarGroup=function(a,d,g){var c=n(this.editor),h=0===d,b={name:a};if(g){if(g=CKEDITOR.tools.search(c,function(a){return a.name==g})){!g.groups&&(g.groups=[]);if(d&&(d=CKEDITOR.tools.indexOf(g.groups,d),0<=d)){g.groups.splice(d+1,0,a);return}h?g.groups.splice(0,0,a):g.groups.push(a);return}d=null}d&&(d=CKEDITOR.tools.indexOf(c,function(a){return a.name==d}));h?c.splice(0,0,a):"number"==typeof d?c.splice(d+1,0,b):c.push(a)}})();CKEDITOR.UI_SEPARATOR="separator";CKEDITOR.config.toolbarLocation="top";(function(){var k;function n(a,c){function j(d){d=i.list[d];if(d.equals(a.editable())||"true"==d.getAttribute("contenteditable")){var e=a.createRange();e.selectNodeContents(d);e.select()}else a.getSelection().selectElement(d);a.focus()}function s(){l&&l.setHtml(o);delete i.list}var m=a.ui.spaceId("path"),l,i=a._.elementsPath,n=i.idBase;c.html+='<span id="'+m+'_label" class="cke_voice_label">'+a.lang.elementspath.eleLabel+'</span><span id="'+m+'" class="cke_path" role="group" aria-labelledby="'+m+'_label">'+o+"</span>";a.on("uiReady",function(){var d=a.ui.space("path");d&&a.focusManager.add(d,1)});i.onClick=j;var t=CKEDITOR.tools.addFunction(j),u=CKEDITOR.tools.addFunction(function(d,e){var g=i.idBase,b,e=new CKEDITOR.dom.event(e);b="rtl"==a.lang.dir;switch(e.getKeystroke()){case b?39:37:case 9:return(b=CKEDITOR.document.getById(g+(d+1)))||(b=CKEDITOR.document.getById(g+"0")),b.focus(),!1;case b?37:39:case CKEDITOR.SHIFT+9:return(b=CKEDITOR.document.getById(g+(d-1)))||(b=CKEDITOR.document.getById(g+
(i.list.length-1))),b.focus(),!1;case 27:return a.focus(),!1;case 13:case 32:return j(d),!1}return!0});a.on("selectionChange",function(){a.editable();for(var d=[],e=i.list=[],g=[],b=i.filters,c=!0,j=a.elementPath().elements,f,k=j.length;k--;){var h=j[k],p=0;f=h.data("cke-display-name")?h.data("cke-display-name"):h.data("cke-real-element-type")?h.data("cke-real-element-type"):h.getName();c=h.hasAttribute("contenteditable")?"true"==h.getAttribute("contenteditable"):c;!c&&!h.hasAttribute("contenteditable")&&(p=1);for(var q=0;q<b.length;q++){var r=b[q](h,f);if(!1===r){p=1;break}f=r||f}p||(e.unshift(h),g.unshift(f))}e=e.length;for(b=0;b<e;b++)f=g[b],c=a.lang.elementspath.eleTitle.replace(/%1/,f),f=v.output({id:n+b,label:c,text:f,jsTitle:"javascript:void('"+f+"')",index:b,keyDownFn:u,clickFn:t}),d.unshift(f);l||(l=CKEDITOR.document.getById(m));g=l;g.setHtml(d.join("")+o);a.fire("elementsPathUpdate",{space:g})});a.on("readOnly",s);a.on("contentDomUnload",s);a.addCommand("elementsPathFocus",k);a.setKeystroke(CKEDITOR.ALT+
122,"elementsPathFocus")}k={editorFocus:!1,readOnly:1,exec:function(a){(a=CKEDITOR.document.getById(a._.elementsPath.idBase+"0"))&&a.focus(CKEDITOR.env.ie||CKEDITOR.env.air)}};var o='<span class="cke_path_empty">&nbsp;</span>',c="";CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(c+=' onkeypress="return false;"');CKEDITOR.env.gecko&&(c+=' onblur="this.style.cssText = this.style.cssText;"');var v=CKEDITOR.addTemplate("pathItem",'<a id="{id}" href="{jsTitle}" tabindex="-1" class="cke_path_item" title="{label}"'+
c+' hidefocus="true"  onkeydown="return CKEDITOR.tools.callFunction({keyDownFn},{index}, event );" onclick="CKEDITOR.tools.callFunction({clickFn},{index}); return false;" role="button" aria-label="{label}">{text}</a>');CKEDITOR.plugins.add("elementspath",{init:function(a){a._.elementsPath={idBase:"cke_elementspath_"+CKEDITOR.tools.getNextNumber()+"_",filters:[]};a.on("uiSpace",function(c){"bottom"==c.data.space&&n(a,c.data)})}})})();(function(){function m(b,d,a){a=b.config.forceEnterMode||a;"wysiwyg"==b.mode&&(d||(d=b.activeEnterMode),b.elementPath().isContextFor("p")||(d=CKEDITOR.ENTER_BR,a=1),b.fire("saveSnapshot"),d==CKEDITOR.ENTER_BR?p(b,d,null,a):q(b,d,null,a),b.fire("saveSnapshot"))}function r(b){for(var b=b.getSelection().getRanges(!0),d=b.length-1;0<d;d--)b[d].deleteContents();return b[0]}function u(b){var d=b.startContainer.getAscendant(function(a){return a.type==CKEDITOR.NODE_ELEMENT&&"true"==a.getAttribute("contenteditable")},!0);if(b.root.equals(d))return b;d=new CKEDITOR.dom.range(d);d.moveToRange(b);return d}CKEDITOR.plugins.add("enterkey",{init:function(b){b.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(b){m(b)}});b.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(b){m(b,b.activeShiftEnterMode,1)}});b.setKeystroke([[13,"enter"],[CKEDITOR.SHIFT+13,"shiftEnter"]])}});var v=CKEDITOR.dom.walker.whitespaces(),w=CKEDITOR.dom.walker.bookmark();CKEDITOR.plugins.enterkey={enterBlock:function(b,d,a,h){if(a=a||r(b)){var a=u(a),f=a.document,i=a.checkStartOfBlock(),k=a.checkEndOfBlock(),j=b.elementPath(a.startContainer),c=j.block,l=d==CKEDITOR.ENTER_DIV?"div":"p",e;if(i&&k){if(c&&(c.is("li")||c.getParent().is("li"))){c.is("li")||(c=c.getParent());a=c.getParent();e=a.getParent();var h=!c.hasPrevious(),n=!c.hasNext(),l=b.getSelection(),g=l.createBookmarks(),i=c.getDirection(1),k=c.getAttribute("class"),o=c.getAttribute("style"),m=e.getDirection(1)!=i,b=b.enterMode!=CKEDITOR.ENTER_BR||m||o||k;if(e.is("li"))if(h||n)c[h?"insertBefore":"insertAfter"](e);else c.breakParent(e);else{if(b)if(j.block.is("li")?(e=f.createElement(d==CKEDITOR.ENTER_P?"p":"div"),m&&e.setAttribute("dir",i),o&&e.setAttribute("style",o),k&&e.setAttribute("class",k),c.moveChildren(e)):e=j.block,h||n)e[h?"insertBefore":"insertAfter"](a);else c.breakParent(a),e.insertAfter(a);else if(c.appendBogus(!0),h||n)for(;f=c[h?"getFirst":"getLast"]();)f[h?"insertBefore":"insertAfter"](a);else for(c.breakParent(a);f=c.getLast();)f.insertAfter(a);c.remove()}l.selectBookmarks(g);return}if(c&&c.getParent().is("blockquote")){c.breakParent(c.getParent());c.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||c.getPrevious().remove();c.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||c.getNext().remove();a.moveToElementEditStart(c);a.select();return}}else if(c&&c.is("pre")&&!k){p(b,d,a,h);return}if(i=a.splitBlock(l)){d=i.previousBlock;c=i.nextBlock;j=i.wasStartOfBlock;b=i.wasEndOfBlock;if(c)g=c.getParent(),g.is("li")&&(c.breakParent(g),c.move(c.getNext(),1));else if(d&&(g=d.getParent())&&g.is("li"))d.breakParent(g),g=d.getNext(),a.moveToElementEditStart(g),d.move(d.getPrevious());if(!j&&!b)c.is("li")&&(e=a.clone(),e.selectNodeContents(c),e=new CKEDITOR.dom.walker(e),e.evaluator=function(a){return!(w(a)||v(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in CKEDITOR.dtd.$inline&&!(a.getName()in CKEDITOR.dtd.$empty))},(g=e.next())&&(g.type==CKEDITOR.NODE_ELEMENT&&g.is("ul","ol"))&&(CKEDITOR.env.needsBrFiller?f.createElement("br"):f.createText(" ")).insertBefore(g)),c&&a.moveToElementEditStart(c);else{if(d){if(d.is("li")||!s.test(d.getName())&&!d.is("pre"))e=d.clone()}else c&&(e=c.clone());e?h&&!e.is("li")&&e.renameNode(l):g&&g.is("li")?e=g:(e=f.createElement(l),d&&(n=d.getDirection())&&e.setAttribute("dir",n));if(f=i.elementPath){h=0;for(l=f.elements.length;h<l;h++){g=f.elements[h];if(g.equals(f.block)||g.equals(f.blockLimit))break;CKEDITOR.dtd.$removeEmpty[g.getName()]&&(g=g.clone(),e.moveChildren(g),e.append(g))}}e.appendBogus();e.getParent()||a.insertNode(e);e.is("li")&&e.removeAttribute("value");if(CKEDITOR.env.ie&&j&&(!b||!d.getChildCount()))a.moveToElementEditStart(b?d:e),a.select();a.moveToElementEditStart(j&&!b?c:e)}a.select();a.scrollIntoView()}}},enterBr:function(b,d,a,h){if(a=a||r(b)){var f=a.document,i=a.checkEndOfBlock(),k=new CKEDITOR.dom.elementPath(b.getSelection().getStartElement()),j=k.block,c=j&&k.block.getName();!h&&"li"==c?q(b,d,a,h):(!h&&i&&s.test(c)?(i=j.getDirection())?(f=f.createElement("div"),f.setAttribute("dir",i),f.insertAfter(j),a.setStart(f,0)):(f.createElement("br").insertAfter(j),CKEDITOR.env.gecko&&f.createText("").insertAfter(j),a.setStartAt(j.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(b="pre"==c&&CKEDITOR.env.ie&&8>CKEDITOR.env.version?f.createText("\r"):f.createElement("br"),a.deleteContents(),a.insertNode(b),CKEDITOR.env.needsBrFiller?(f.createText("﻿").insertAfter(b),i&&(j||k.blockLimit).appendBogus(),b.getNext().$.nodeValue="",a.setStartAt(b.getNext(),CKEDITOR.POSITION_AFTER_START)):a.setStartAt(b,CKEDITOR.POSITION_AFTER_END)),a.collapse(!0),a.select(),a.scrollIntoView())}}};var t=CKEDITOR.plugins.enterkey,p=t.enterBr,q=t.enterBlock,s=/^h[1-6]$/})();(function(){function j(a,b){var d={},e=[],f={nbsp:" ",shy:"­",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},a=a.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,function(a,h){var c=b?"&"+h+";":f[h];d[c]=b?f[h]:"&"+h+";";e.push(c);return""});if(!b&&a){var a=a.split(","),c=document.createElement("div"),g;c.innerHTML="&"+a.join(";&")+";";g=c.innerHTML;c=null;for(c=0;c<g.length;c++){var i=g.charAt(c);d[i]="&"+a[c]+";";e.push(i)}}d.regex=e.join(b?"|":"");return d}CKEDITOR.plugins.add("entities",{afterInit:function(a){var b=a.config;if(a=(a=a.dataProcessor)&&a.htmlFilter){var d=[];!1!==b.basicEntities&&d.push("nbsp,gt,lt,amp");b.entities&&(d.length&&d.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),b.entities_latin&&d.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),b.entities_greek&&d.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),b.entities_additional&&d.push(b.entities_additional));var e=j(d.join(",")),f=e.regex?"["+e.regex+"]":"a^";delete e.regex;b.entities&&b.entities_processNumerical&&(f="[^ -~]|"+f);var f=RegExp(f,"g"),c=function(a){return b.entities_processNumerical=="force"||!e[a]?"&#"+a.charCodeAt(0)+";":e[a]},g=j("nbsp,gt,lt,amp,shy",!0),i=RegExp(g.regex,"g"),k=function(a){return g[a]};a.addRules({text:function(a){return a.replace(i,k).replace(f,c)}},{applyToAll:!0,excludeNestedEditable:!0})}}})})();CKEDITOR.config.basicEntities=!0;CKEDITOR.config.entities=!0;CKEDITOR.config.entities_latin=!0;CKEDITOR.config.entities_greek=!0;CKEDITOR.config.entities_additional="#39";CKEDITOR.plugins.add("popup");CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{popup:function(e,a,b,d){a=a||"80%";b=b||"70%";"string"==typeof a&&(1<a.length&&"%"==a.substr(a.length-1,1))&&(a=parseInt(window.screen.width*parseInt(a,10)/100,10));"string"==typeof b&&(1<b.length&&"%"==b.substr(b.length-1,1))&&(b=parseInt(window.screen.height*parseInt(b,10)/100,10));640>a&&(a=640);420>b&&(b=420);var f=parseInt((window.screen.height-b)/2,10),g=parseInt((window.screen.width-a)/2,10),d=(d||"location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes")+",width="+
a+",height="+b+",top="+f+",left="+g,c=window.open("",null,d,!0);if(!c)return!1;try{-1==navigator.userAgent.toLowerCase().indexOf(" chrome/")&&(c.moveTo(g,f),c.resizeTo(a,b)),c.focus(),c.location.href=e}catch(h){window.open(e,null,d,!0)}return!0}});(function(){function g(a,c){var d=[];if(c)for(var b in c)d.push(b+"="+encodeURIComponent(c[b]));else return a;return a+(-1!=a.indexOf("?")?"&":"?")+d.join("&")}function i(a){a+="";return a.charAt(0).toUpperCase()+a.substr(1)}function k(){var a=this.getDialog(),c=a.getParentEditor();c._.filebrowserSe=this;var d=c.config["filebrowser"+i(a.getName())+"WindowWidth"]||c.config.filebrowserWindowWidth||"80%",a=c.config["filebrowser"+i(a.getName())+"WindowHeight"]||c.config.filebrowserWindowHeight||"70%",b=this.filebrowser.params||{};b.CKEditor=c.name;b.CKEditorFuncNum=c._.filebrowserFn;b.langCode||(b.langCode=c.langCode);b=g(this.filebrowser.url,b);c.popup(b,d,a,c.config.filebrowserWindowFeatures||c.config.fileBrowserWindowFeatures)}function l(){var a=this.getDialog();a.getParentEditor()._.filebrowserSe=this;return!a.getContentElement(this["for"][0],this["for"][1]).getInputElement().$.value||!a.getContentElement(this["for"][0],this["for"][1]).getAction()?!1:!0}function m(a,c,d){var b=d.params||{};b.CKEditor=a.name;b.CKEditorFuncNum=a._.filebrowserFn;b.langCode||(b.langCode=a.langCode);c.action=g(d.url,b);c.filebrowser=d}function j(a,c,d,b){if(b&&b.length)for(var e,g=b.length;g--;)if(e=b[g],("hbox"==e.type||"vbox"==e.type||"fieldset"==e.type)&&j(a,c,d,e.children),e.filebrowser)if("string"==typeof e.filebrowser&&(e.filebrowser={action:"fileButton"==e.type?"QuickUpload":"Browse",target:e.filebrowser}),"Browse"==e.filebrowser.action){var f=e.filebrowser.url;void 0===f&&(f=a.config["filebrowser"+
i(c)+"BrowseUrl"],void 0===f&&(f=a.config.filebrowserBrowseUrl));f&&(e.onClick=k,e.filebrowser.url=f,e.hidden=!1)}else if("QuickUpload"==e.filebrowser.action&&e["for"]&&(f=e.filebrowser.url,void 0===f&&(f=a.config["filebrowser"+i(c)+"UploadUrl"],void 0===f&&(f=a.config.filebrowserUploadUrl)),f)){var h=e.onClick;e.onClick=function(a){var b=a.sender;return h&&h.call(b,a)===false?false:l.call(b,a)};e.filebrowser.url=f;e.hidden=!1;m(a,d.getContents(e["for"][0]).get(e["for"][1]),e.filebrowser)}}function h(a,c,d){if(-1!==d.indexOf(";")){for(var d=d.split(";"),b=0;b<d.length;b++)if(h(a,c,d[b]))return!0;return!1}return(a=a.getContents(c).get(d).filebrowser)&&a.url}function n(a,c){var d=this._.filebrowserSe.getDialog(),b=this._.filebrowserSe["for"],e=this._.filebrowserSe.filebrowser.onSelect;b&&d.getContentElement(b[0],b[1]).reset();if(!("function"==typeof c&&!1===c.call(this._.filebrowserSe))&&!(e&&!1===e.call(this._.filebrowserSe,a,c))&&("string"==typeof c&&c&&alert(c),a&&(b=this._.filebrowserSe,d=b.getDialog(),b=b.filebrowser.target||null)))if(b=b.split(":"),e=d.getContentElement(b[0],b[1]))e.setValue(a),d.selectPage(b[0])}CKEDITOR.plugins.add("filebrowser",{requires:"popup",init:function(a){a._.filebrowserFn=CKEDITOR.tools.addFunction(n,a);a.on("destroy",function(){CKEDITOR.tools.removeFunction(this._.filebrowserFn)})}});CKEDITOR.on("dialogDefinition",function(a){if(a.editor.plugins.filebrowser)for(var c=a.data.definition,d,b=0;b<c.contents.length;++b)if(d=c.contents[b])j(a.editor,a.data.name,c,d.elements),d.hidden&&d.filebrowser&&(d.hidden=!h(c,d.id,d.filebrowser))})})();CKEDITOR.plugins.add("find",{requires:"dialog",init:function(a){var b=a.addCommand("find",new CKEDITOR.dialogCommand("find"));b.canUndo=!1;b.readOnly=1;a.addCommand("replace",new CKEDITOR.dialogCommand("replace")).canUndo=!1;a.ui.addButton&&(a.ui.addButton("Find",{label:a.lang.find.find,command:"find",toolbar:"find,10"}),a.ui.addButton("Replace",{label:a.lang.find.replace,command:"replace",toolbar:"find,20"}));CKEDITOR.dialog.add("find",this.path+"dialogs/find.js");CKEDITOR.dialog.add("replace",this.path+"dialogs/find.js")}});CKEDITOR.config.find_highlight={element:"span",styles:{"background-color":"#004",color:"#fff"}};(function(){function g(a,b){var c=j.exec(a),d=j.exec(b);if(c){if(!c[2]&&"px"==d[2])return d[1];if("px"==c[2]&&!d[2])return d[1]+"px"}return b}var i=CKEDITOR.htmlParser.cssStyle,h=CKEDITOR.tools.cssLength,j=/^((?:\d*(?:\.\d+))|(?:\d+))(.*)?$/i,k={elements:{$:function(a){var b=a.attributes;if((b=(b=(b=b&&b["data-cke-realelement"])&&new CKEDITOR.htmlParser.fragment.fromHtml(decodeURIComponent(b)))&&b.children[0])&&a.attributes["data-cke-resizable"]){var c=(new i(a)).rules,a=b.attributes,d=c.width,c=c.height;d&&(a.width=g(a.width,d));c&&(a.height=g(a.height,c))}return b}}};CKEDITOR.plugins.add("fakeobjects",{init:function(a){a.filter.allow("img[!data-cke-realelement,src,alt,title](*){*}","fakeobjects")},afterInit:function(a){(a=(a=a.dataProcessor)&&a.htmlFilter)&&a.addRules(k,{applyToAll:!0})}});CKEDITOR.editor.prototype.createFakeElement=function(a,b,c,d){var e=this.lang.fakeobjects,e=e[c]||e.unknown,b={"class":b,"data-cke-realelement":encodeURIComponent(a.getOuterHtml()),"data-cke-real-node-type":a.type,alt:e,title:e,align:a.getAttribute("align")||""};CKEDITOR.env.hc||(b.src=CKEDITOR.tools.transparentImageData);c&&(b["data-cke-real-element-type"]=c);d&&(b["data-cke-resizable"]=d,c=new i,d=a.getAttribute("width"),a=a.getAttribute("height"),d&&(c.rules.width=h(d)),a&&(c.rules.height=h(a)),c.populate(b));return this.document.createElement("img",{attributes:b})};CKEDITOR.editor.prototype.createFakeParserElement=function(a,b,c,d){var e=this.lang.fakeobjects,e=e[c]||e.unknown,f;f=new CKEDITOR.htmlParser.basicWriter;a.writeHtml(f);f=f.getHtml();b={"class":b,"data-cke-realelement":encodeURIComponent(f),"data-cke-real-node-type":a.type,alt:e,title:e,align:a.attributes.align||""};CKEDITOR.env.hc||(b.src=CKEDITOR.tools.transparentImageData);c&&(b["data-cke-real-element-type"]=c);d&&(b["data-cke-resizable"]=d,d=a.attributes,a=new i,c=d.width,d=d.height,void 0!=c&&(a.rules.width=h(c)),void 0!=d&&(a.rules.height=h(d)),a.populate(b));return new CKEDITOR.htmlParser.element("img",b)};CKEDITOR.editor.prototype.restoreRealElement=function(a){if(a.data("cke-real-node-type")!=CKEDITOR.NODE_ELEMENT)return null;var b=CKEDITOR.dom.element.createFromHtml(decodeURIComponent(a.data("cke-realelement")),this.document);if(a.data("cke-resizable")){var c=a.getStyle("width"),a=a.getStyle("height");c&&b.setAttribute("width",g(b.getAttribute("width"),c));a&&b.setAttribute("height",g(b.getAttribute("height"),a))}return b}})();(function(){function d(a){a=a.attributes;return"application/x-shockwave-flash"==a.type||f.test(a.src||"")}function e(a,b){return a.createFakeParserElement(b,"cke_flash","flash",!0)}var f=/\.swf(?:$|\?)/i;CKEDITOR.plugins.add("flash",{requires:"dialog,fakeobjects",onLoad:function(){CKEDITOR.addCss("img.cke_flash{background-image: url("+CKEDITOR.getUrl(this.path+"images/placeholder.png")+");background-position: center center;background-repeat: no-repeat;border: 1px solid #a9a9a9;width: 80px;height: 80px;}")},init:function(a){var b="object[classid,codebase,height,hspace,vspace,width];param[name,value];embed[height,hspace,pluginspage,src,type,vspace,width]";CKEDITOR.dialog.isTabEnabled(a,"flash","properties")&&(b+=";object[align]; embed[allowscriptaccess,quality,scale,wmode]");CKEDITOR.dialog.isTabEnabled(a,"flash","advanced")&&(b+=";object[id]{*}; embed[bgcolor]{*}(*)");a.addCommand("flash",new CKEDITOR.dialogCommand("flash",{allowedContent:b,requiredContent:"embed"}));a.ui.addButton&&a.ui.addButton("Flash",{label:a.lang.common.flash,command:"flash",toolbar:"insert,20"});CKEDITOR.dialog.add("flash",this.path+"dialogs/flash.js");a.addMenuItems&&a.addMenuItems({flash:{label:a.lang.flash.properties,command:"flash",group:"flash"}});a.on("doubleclick",function(a){var b=a.data.element;b.is("img")&&"flash"==b.data("cke-real-element-type")&&(a.data.dialog="flash")});a.contextMenu&&a.contextMenu.addListener(function(a){if(a&&a.is("img")&&!a.isReadOnly()&&"flash"==a.data("cke-real-element-type"))return{flash:CKEDITOR.TRISTATE_OFF}})},afterInit:function(a){var b=a.dataProcessor;(b=b&&b.dataFilter)&&b.addRules({elements:{"cke:object":function(b){var c=b.attributes;if((!c.classid||!(""+c.classid).toLowerCase())&&!d(b)){for(c=0;c<b.children.length;c++)if("cke:embed"==b.children[c].name){if(!d(b.children[c]))break;return e(a,b)}return null}return e(a,b)},"cke:embed":function(b){return!d(b)?null:e(a,b)}}},5)}})})();CKEDITOR.tools.extend(CKEDITOR.config,{flashEmbedTagOnly:!1,flashAddEmbedTag:!0,flashConvertOnEdit:!1});(function(){function i(a){var j=a.config,m=a.fire("uiSpace",{space:"top",html:""}).html,p=function(){function f(a,c,e){b.setStyle(c,s(e));b.setStyle("position",a)}function e(a){var b=i.getDocumentPosition();switch(a){case"top":f("absolute","top",b.y-n-o);break;case"pin":f("fixed","top",t);break;case"bottom":f("absolute","top",b.y+(c.height||c.bottom-c.top)+o)}k=a}var k,i,l,c,h,n,r,m=j.floatSpaceDockedOffsetX||0,o=j.floatSpaceDockedOffsetY||0,q=j.floatSpacePinnedOffsetX||0,t=j.floatSpacePinnedOffsetY||0;return function(d){if(i=a.editable())if(d&&"focus"==d.name&&b.show(),b.removeStyle("left"),b.removeStyle("right"),l=b.getClientRect(),c=i.getClientRect(),h=g.getViewPaneSize(),n=l.height,r="pageXOffset"in g.$?g.$.pageXOffset:CKEDITOR.document.$.documentElement.scrollLeft,k){n+o<=c.top?e("top"):n+o>h.height-c.bottom?e("pin"):e("bottom");var d=h.width/2,d=0<c.left&&c.right<h.width&&c.width>l.width?"rtl"==a.config.contentsLangDirection?"right":"left":d-c.left>c.right-d?"left":"right",f;l.width>h.width?(d="left",f=0):(f="left"==d?0<c.left?c.left:0:c.right<h.width?h.width-c.right:0,f+l.width>h.width&&(d="left"==d?"right":"left",f=0));b.setStyle(d,s(("pin"==k?q:m)+f+("pin"==k?0:"left"==d?r:-r)))}else k="pin",e("pin"),p(d)}}();if(m){var i=new CKEDITOR.template('<div id="cke_{name}" class="cke {id} cke_reset_all cke_chrome cke_editor_{name} cke_float cke_{langDir} '+CKEDITOR.env.cssClass+'" dir="{langDir}" title="'+(CKEDITOR.env.gecko?" ":"")+'" lang="{langCode}" role="application" style="{style}"'+
(a.title?' aria-labelledby="cke_{name}_arialbl"':" ")+">"+(a.title?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':" ")+'<div class="cke_inner"><div id="{topId}" class="cke_top" role="presentation">{content}</div></div></div>'),b=CKEDITOR.document.getBody().append(CKEDITOR.dom.element.createFromHtml(i.output({content:m,id:a.id,langDir:a.lang.dir,langCode:a.langCode,name:a.name,style:"display:none;z-index:"+(j.baseFloatZIndex-1),topId:a.ui.spaceId("top"),voiceLabel:a.title}))),q=CKEDITOR.tools.eventsBuffer(500,p),e=CKEDITOR.tools.eventsBuffer(100,p);b.unselectable();b.on("mousedown",function(a){a=a.data;a.getTarget().hasAscendant("a",1)||a.preventDefault()});a.on("focus",function(b){p(b);a.on("change",q.input);g.on("scroll",e.input);g.on("resize",e.input)});a.on("blur",function(){b.hide();a.removeListener("change",q.input);g.removeListener("scroll",e.input);g.removeListener("resize",e.input)});a.on("destroy",function(){g.removeListener("scroll",e.input);g.removeListener("resize",e.input);b.clearCustomData();b.remove()});a.focusManager.hasFocus&&b.show();a.focusManager.add(b,1)}}var g=CKEDITOR.document.getWindow(),s=CKEDITOR.tools.cssLength;CKEDITOR.plugins.add("floatingspace",{init:function(a){a.on("loaded",function(){i(this)},null,null,20)}})})();CKEDITOR.plugins.add("listblock",{requires:"panel",onLoad:function(){var f=CKEDITOR.addTemplate("panel-list",'<ul role="presentation" class="cke_panel_list">{items}</ul>'),g=CKEDITOR.addTemplate("panel-list-item",'<li id="{id}" class="cke_panel_listItem" role=presentation><a id="{id}_option" _cke_focus=1 hidefocus=true title="{title}" href="javascript:void(\'{val}\')"  {onclick}="CKEDITOR.tools.callFunction({clickFn},\'{val}\'); return false;" role="option">{text}</a></li>'),h=CKEDITOR.addTemplate("panel-list-group",'<h1 id="{id}" class="cke_panel_grouptitle" role="presentation" >{label}</h1>'),i=/\'/g;CKEDITOR.ui.panel.prototype.addListBlock=function(a,b){return this.addBlock(a,new CKEDITOR.ui.listBlock(this.getHolderElement(),b))};CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(a,b){var b=b||{},c=b.attributes||(b.attributes={});(this.multiSelect=!!b.multiSelect)&&(c["aria-multiselectable"]=!0);!c.role&&(c.role="listbox");this.base.apply(this,arguments);this.element.setAttribute("role",c.role);c=this.keys;c[40]="next";c[9]="next";c[38]="prev";c[CKEDITOR.SHIFT+9]="prev";c[32]=CKEDITOR.env.ie?"mouseup":"click";CKEDITOR.env.ie&&(c[13]="mouseup");this._.pendingHtml=[];this._.pendingList=[];this._.items={};this._.groups={}},_:{close:function(){if(this._.started){var a=f.output({items:this._.pendingList.join("")});this._.pendingList=[];this._.pendingHtml.push(a);delete this._.started}},getClick:function(){this._.click||(this._.click=CKEDITOR.tools.addFunction(function(a){var b=this.toggle(a);if(this.onClick)this.onClick(a,b)},this));return this._.click}},proto:{add:function(a,b,c){var d=CKEDITOR.tools.getNextId();this._.started||(this._.started=1,this._.size=this._.size||0);this._.items[a]=d;var e;e=CKEDITOR.tools.htmlEncodeAttr(a).replace(i,"\\'");a={id:d,val:e,onclick:CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick",clickFn:this._.getClick(),title:CKEDITOR.tools.htmlEncodeAttr(c||a),text:b||a};this._.pendingList.push(g.output(a))},startGroup:function(a){this._.close();var b=CKEDITOR.tools.getNextId();this._.groups[a]=b;this._.pendingHtml.push(h.output({id:b,label:a}))},commit:function(){this._.close();this.element.appendHtml(this._.pendingHtml.join(""));delete this._.size;this._.pendingHtml=[]},toggle:function(a){var b=this.isMarked(a);b?this.unmark(a):this.mark(a);return!b},hideGroup:function(a){var b=(a=this.element.getDocument().getById(this._.groups[a]))&&a.getNext();a&&(a.setStyle("display","none"),b&&"ul"==b.getName()&&b.setStyle("display","none"))},hideItem:function(a){this.element.getDocument().getById(this._.items[a]).setStyle("display","none")},showAll:function(){var a=this._.items,b=this._.groups,c=this.element.getDocument(),d;for(d in a)c.getById(a[d]).setStyle("display","");for(var e in b)a=c.getById(b[e]),d=a.getNext(),a.setStyle("display",""),d&&"ul"==d.getName()&&d.setStyle("display","")},mark:function(a){this.multiSelect||this.unmarkAll();var a=this._.items[a],b=this.element.getDocument().getById(a);b.addClass("cke_selected");this.element.getDocument().getById(a+"_option").setAttribute("aria-selected",!0);this.onMark&&this.onMark(b)},unmark:function(a){var b=this.element.getDocument(),a=this._.items[a],c=b.getById(a);c.removeClass("cke_selected");b.getById(a+"_option").removeAttribute("aria-selected");this.onUnmark&&this.onUnmark(c)},unmarkAll:function(){var a=this._.items,b=this.element.getDocument(),c;for(c in a){var d=a[c];b.getById(d).removeClass("cke_selected");b.getById(d+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(a){return this.element.getDocument().getById(this._.items[a]).hasClass("cke_selected")},focus:function(a){this._.focusIndex=-1;var b=this.element.getElementsByTag("a"),c,d=-1;if(a)for(c=this.element.getDocument().getById(this._.items[a]).getFirst();a=b.getItem(++d);){if(a.equals(c)){this._.focusIndex=d;break}}else this.element.focus();c&&setTimeout(function(){c.focus()},0)}}})}});CKEDITOR.plugins.add("richcombo",{requires:"floatpanel,listblock,button",beforeInit:function(d){d.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}});(function(){var d='<span id="{id}" class="cke_combo cke_combo__{name} {cls}" role="presentation"><span id="{id}_label" class="cke_combo_label">{label}</span><a class="cke_combo_button" title="{title}" tabindex="-1"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="true"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(d+=' onkeypress="return false;"');CKEDITOR.env.gecko&&(d+=' onblur="this.style.cssText = this.style.cssText;"');var d=d+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event,this);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span id="{id}_text" class="cke_combo_text cke_combo_inlinelabel">{label}</span><span class="cke_combo_open"><span class="cke_combo_arrow">'+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span>"),i=CKEDITOR.addTemplate("combo",d);CKEDITOR.UI_RICHCOMBO="richcombo";CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(a){CKEDITOR.tools.extend(this,a,{canGroup:!1,title:a.label,modes:{wysiwyg:1},editorFocus:1});a=this.panel||{};delete this.panel;this.id=CKEDITOR.tools.getNextNumber();this.document=a.parent&&a.parent.getDocument()||CKEDITOR.document;a.className="cke_combopanel";a.block={multiSelect:a.multiSelect,attributes:a.attributes};a.toolbarRelated=!0;this._={panelDefinition:a,items:{}}},proto:{renderHtml:function(a){var b=[];this.render(a,b);return b.join("")},render:function(a,b){function g(){if(this.getState()!=CKEDITOR.TRISTATE_ON){var c=this.modes[a.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;a.readOnly&&!this.readOnly&&(c=CKEDITOR.TRISTATE_DISABLED);this.setState(c);this.setValue("");c!=CKEDITOR.TRISTATE_DISABLED&&this.refresh&&this.refresh()}}var d=CKEDITOR.env,h="cke_"+this.id,e=CKEDITOR.tools.addFunction(function(b){j&&(a.unlockSelection(1),j=0);c.execute(b)},this),f=this,c={id:h,combo:this,focus:function(){CKEDITOR.document.getById(h).getChild(1).focus()},execute:function(c){var b=f._;if(b.state!=CKEDITOR.TRISTATE_DISABLED)if(f.createPanel(a),b.on)b.panel.hide();else{f.commit();var d=f.getValue();d?b.list.mark(d):b.list.unmarkAll();b.panel.showBlock(f.id,new CKEDITOR.dom.element(c),4)}},clickFn:e};a.on("activeFilterChange",g,this);a.on("mode",g,this);a.on("selectionChange",g,this);!this.readOnly&&a.on("readOnly",g,this);var k=CKEDITOR.tools.addFunction(function(b,d){var b=new CKEDITOR.dom.event(b),g=b.getKeystroke();if(40==g)a.once("panelShow",function(a){a.data._.panel._.currentBlock.onKeyDown(40)});switch(g){case 13:case 32:case 40:CKEDITOR.tools.callFunction(e,d);break;default:c.onkey(c,g)}b.preventDefault()}),l=CKEDITOR.tools.addFunction(function(){c.onfocus&&c.onfocus()}),j=0;c.keyDownFn=k;d={id:h,name:this.name||this.command,label:this.label,title:this.title,cls:this.className||"",titleJs:d.gecko&&!d.hc?"":(this.title||"").replace("'",""),keydownFn:k,focusFn:l,clickFn:e};i.output(d,b);if(this.onRender)this.onRender();return c},createPanel:function(a){if(!this._.panel){var b=this._.panelDefinition,d=this._.panelDefinition.block,i=b.parent||CKEDITOR.document.getBody(),h="cke_combopanel__"+this.name,e=new CKEDITOR.ui.floatPanel(a,i,b),f=e.addListBlock(this.id,d),c=this;e.onShow=function(){this.element.addClass(h);c.setState(CKEDITOR.TRISTATE_ON);c._.on=1;c.editorFocus&&!a.focusManager.hasFocus&&a.focus();if(c.onOpen)c.onOpen();a.once("panelShow",function(){f.focus(!f.multiSelect&&c.getValue())})};e.onHide=function(b){this.element.removeClass(h);c.setState(c.modes&&c.modes[a.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);c._.on=0;if(!b&&c.onClose)c.onClose()};e.onEscape=function(){e.hide(1)};f.onClick=function(a,b){c.onClick&&c.onClick.call(c,a,b);e.hide()};this._.panel=e;this._.list=f;e.getBlock(this.id).onHide=function(){c._.on=0;c.setState(CKEDITOR.TRISTATE_OFF)};this.init&&this.init()}},setValue:function(a,b){this._.value=a;var d=this.document.getById("cke_"+this.id+"_text");d&&(!a&&!b?(b=this.label,d.addClass("cke_combo_inlinelabel")):d.removeClass("cke_combo_inlinelabel"),d.setText("undefined"!=typeof b?b:a))},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(a){this._.list.mark(a)},hideItem:function(a){this._.list.hideItem(a)},hideGroup:function(a){this._.list.hideGroup(a)},showAll:function(){this._.list.showAll()},add:function(a,b,d){this._.items[a]=d||a;this._.list.add(a,b,d)},startGroup:function(a){this._.list.startGroup(a)},commit:function(){this._.committed||(this._.list.commit(),this._.committed=1,CKEDITOR.ui.fire("ready",this));this._.committed=1},setState:function(a){if(this._.state!=a){var b=this.document.getById("cke_"+this.id);b.setState(a,"cke_combo");a==CKEDITOR.TRISTATE_DISABLED?b.setAttribute("aria-disabled",!0):b.removeAttribute("aria-disabled");this._.state=a}},getState:function(){return this._.state},enable:function(){this._.state==CKEDITOR.TRISTATE_DISABLED&&this.setState(this._.lastState)},disable:function(){this._.state!=CKEDITOR.TRISTATE_DISABLED&&(this._.lastState=this._.state,this.setState(CKEDITOR.TRISTATE_DISABLED))}},statics:{handler:{create:function(a){return new CKEDITOR.ui.richCombo(a)}}}});CKEDITOR.ui.prototype.addRichCombo=function(a,b){this.add(a,CKEDITOR.UI_RICHCOMBO,b)}})();(function(){function j(a,b,c,f,m,j,p,r){for(var s=a.config,n=new CKEDITOR.style(p),i=m.split(";"),m=[],k={},d=0;d<i.length;d++){var h=i[d];if(h){var h=h.split("/"),q={},l=i[d]=h[0];q[c]=m[d]=h[1]||l;k[l]=new CKEDITOR.style(p,q);k[l]._.definition.name=l}else i.splice(d--,1)}a.ui.addRichCombo(b,{label:f.label,title:f.panelTitle,toolbar:"styles,"+r,allowedContent:n,requiredContent:n,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(s.contentsCss),multiSelect:!1,attributes:{"aria-label":f.panelTitle}},init:function(){this.startGroup(f.panelTitle);for(var a=0;a<i.length;a++){var b=i[a];this.add(b,k[b].buildPreview(),b)}},onClick:function(b){a.focus();a.fire("saveSnapshot");var c=this.getValue(),f=k[b];if(c&&b!=c){var i=k[c],e=a.getSelection().getRanges()[0];if(e.collapsed){var d=a.elementPath(),g=d.contains(function(a){return i.checkElementRemovable(a)});if(g){var h=e.checkBoundaryOfElement(g,CKEDITOR.START),j=e.checkBoundaryOfElement(g,CKEDITOR.END);if(h&&j){for(h=e.createBookmark();d=g.getFirst();)d.insertBefore(g);g.remove();e.moveToBookmark(h)}else h?e.moveToPosition(g,CKEDITOR.POSITION_BEFORE_START):j?e.moveToPosition(g,CKEDITOR.POSITION_AFTER_END):(e.splitElement(g),e.moveToPosition(g,CKEDITOR.POSITION_AFTER_END),o(e,d.elements.slice(),g));a.getSelection().selectRanges([e])}}else a.removeStyle(i)}a[c==b?"removeStyle":"applyStyle"](f);a.fire("saveSnapshot")},onRender:function(){a.on("selectionChange",function(b){for(var c=this.getValue(),b=b.data.path.elements,d=0,f;d<b.length;d++){f=b[d];for(var e in k)if(k[e].checkElementMatch(f,!0,a)){e!=c&&this.setValue(e);return}}this.setValue("",j)},this)},refresh:function(){a.activeFilter.check(n)||this.setState(CKEDITOR.TRISTATE_DISABLED)}})}function o(a,b,c){var f=b.pop();if(f){if(c)return o(a,b,f.equals(c)?null:c);c=f.clone();a.insertNode(c);a.moveToPosition(c,CKEDITOR.POSITION_AFTER_START);o(a,b)}}CKEDITOR.plugins.add("font",{requires:"richcombo",init:function(a){var b=a.config;j(a,"Font","family",a.lang.font,b.font_names,b.font_defaultLabel,b.font_style,30);j(a,"FontSize","size",a.lang.font.fontSize,b.fontSize_sizes,b.fontSize_defaultLabel,b.fontSize_style,40)}})})();CKEDITOR.config.font_names="Arial/Arial, Helvetica, sans-serif;Comic Sans MS/Comic Sans MS, cursive;Courier New/Courier New, Courier, monospace;Georgia/Georgia, serif;Lucida Sans Unicode/Lucida Sans Unicode, Lucida Grande, sans-serif;Tahoma/Tahoma, Geneva, sans-serif;Times New Roman/Times New Roman, Times, serif;Trebuchet MS/Trebuchet MS, Helvetica, sans-serif;Verdana/Verdana, Geneva, sans-serif";CKEDITOR.config.font_defaultLabel="";CKEDITOR.config.font_style={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]};CKEDITOR.config.fontSize_sizes="8/8px;9/9px;10/10px;11/11px;12/12px;14/14px;16/16px;18/18px;20/20px;22/22px;24/24px;26/26px;28/28px;36/36px;48/48px;72/72px";CKEDITOR.config.fontSize_defaultLabel="";CKEDITOR.config.fontSize_style={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};CKEDITOR.plugins.add("forms",{requires:"dialog,fakeobjects",onLoad:function(){CKEDITOR.addCss(".cke_editable form{border: 1px dotted #FF0000;padding: 2px;}\n");CKEDITOR.addCss("img.cke_hidden{background-image: url("+CKEDITOR.getUrl(this.path+"images/hiddenfield.gif")+");background-position: center center;background-repeat: no-repeat;border: 1px solid #a9a9a9;width: 16px !important;height: 16px !important;}")},init:function(a){var b=a.lang,g=0,h={email:1,password:1,search:1,tel:1,text:1,url:1},j={checkbox:"input[type,name,checked]",radio:"input[type,name,checked]",textfield:"input[type,name,value,size,maxlength]",textarea:"textarea[cols,rows,name]",select:"select[name,size,multiple]; option[value,selected]",button:"input[type,name,value]",form:"form[action,name,id,enctype,target,method]",hiddenfield:"input[type,name,value]",imagebutton:"input[type,alt,src]{width,height,border,border-width,border-style,margin,float}"},k={checkbox:"input",radio:"input",textfield:"input",textarea:"textarea",select:"select",button:"input",form:"form",hiddenfield:"input",imagebutton:"input"},e=function(d,c,e){var h={allowedContent:j[c],requiredContent:k[c]};"form"==c&&(h.context="form");a.addCommand(c,new CKEDITOR.dialogCommand(c,h));a.ui.addButton&&a.ui.addButton(d,{label:b.common[d.charAt(0).toLowerCase()+d.slice(1)],command:c,toolbar:"forms,"+(g+=10)});CKEDITOR.dialog.add(c,e)},f=this.path+"dialogs/";!a.blockless&&e("Form","form",f+"form.js");e("Checkbox","checkbox",f+"checkbox.js");e("Radio","radio",f+"radio.js");e("TextField","textfield",f+"textfield.js");e("Textarea","textarea",f+"textarea.js");e("Select","select",f+"select.js");e("Button","button",f+"button.js");var i=a.plugins.image;i&&!a.plugins.image2&&e("ImageButton","imagebutton",CKEDITOR.plugins.getPath("image")+"dialogs/image.js");e("HiddenField","hiddenfield",f+"hiddenfield.js");a.addMenuItems&&(e={checkbox:{label:b.forms.checkboxAndRadio.checkboxTitle,command:"checkbox",group:"checkbox"},radio:{label:b.forms.checkboxAndRadio.radioTitle,command:"radio",group:"radio"},textfield:{label:b.forms.textfield.title,command:"textfield",group:"textfield"},hiddenfield:{label:b.forms.hidden.title,command:"hiddenfield",group:"hiddenfield"},button:{label:b.forms.button.title,command:"button",group:"button"},select:{label:b.forms.select.title,command:"select",group:"select"},textarea:{label:b.forms.textarea.title,command:"textarea",group:"textarea"}},i&&(e.imagebutton={label:b.image.titleButton,command:"imagebutton",group:"imagebutton"}),!a.blockless&&(e.form={label:b.forms.form.menu,command:"form",group:"form"}),a.addMenuItems(e));a.contextMenu&&(!a.blockless&&a.contextMenu.addListener(function(d,c,a){if((d=a.contains("form",1))&&!d.isReadOnly())return{form:CKEDITOR.TRISTATE_OFF}}),a.contextMenu.addListener(function(d){if(d&&!d.isReadOnly()){var c=d.getName();if(c=="select")return{select:CKEDITOR.TRISTATE_OFF};if(c=="textarea")return{textarea:CKEDITOR.TRISTATE_OFF};if(c=="input"){var a=d.getAttribute("type")||"text";switch(a){case"button":case"submit":case"reset":return{button:CKEDITOR.TRISTATE_OFF};case"checkbox":return{checkbox:CKEDITOR.TRISTATE_OFF};case"radio":return{radio:CKEDITOR.TRISTATE_OFF};case"image":return i?{imagebutton:CKEDITOR.TRISTATE_OFF}:null}if(h[a])return{textfield:CKEDITOR.TRISTATE_OFF}}if(c=="img"&&d.data("cke-real-element-type")=="hiddenfield")return{hiddenfield:CKEDITOR.TRISTATE_OFF}}}));a.on("doubleclick",function(d){var c=d.data.element;if(!a.blockless&&c.is("form"))d.data.dialog="form";else if(c.is("select"))d.data.dialog="select";else if(c.is("textarea"))d.data.dialog="textarea";else if(c.is("img")&&c.data("cke-real-element-type")=="hiddenfield")d.data.dialog="hiddenfield";else if(c.is("input")){c=c.getAttribute("type")||"text";switch(c){case"button":case"submit":case"reset":d.data.dialog="button";break;case"checkbox":d.data.dialog="checkbox";break;case"radio":d.data.dialog="radio";break;case"image":d.data.dialog="imagebutton"}if(h[c])d.data.dialog="textfield"}})},afterInit:function(a){var b=a.dataProcessor,g=b&&b.htmlFilter,b=b&&b.dataFilter;CKEDITOR.env.ie&&g&&g.addRules({elements:{input:function(a){var a=a.attributes,b=a.type;b||(a.type="text");("checkbox"==b||"radio"==b)&&"on"==a.value&&delete a.value}}},{applyToAll:!0});b&&b.addRules({elements:{input:function(b){if("hidden"==b.attributes.type)return a.createFakeParserElement(b,"cke_hidden","hiddenfield")}}},{applyToAll:!0})}});CKEDITOR.plugins.add("format",{requires:"richcombo",init:function(a){if(!a.blockless){for(var f=a.config,c=a.lang.format,j=f.format_tags.split(";"),d={},k=0,l=[],g=0;g<j.length;g++){var h=j[g],i=new CKEDITOR.style(f["format_"+h]);if(!a.filter.customConfig||a.filter.check(i))k++,d[h]=i,d[h]._.enterMode=a.config.enterMode,l.push(i)}0!==k&&a.ui.addRichCombo("Format",{label:c.label,title:c.panelTitle,toolbar:"styles,20",allowedContent:l,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(f.contentsCss),multiSelect:!1,attributes:{"aria-label":c.panelTitle}},init:function(){this.startGroup(c.panelTitle);for(var a in d){var e=c["tag_"+a];this.add(a,d[a].buildPreview(e),e)}},onClick:function(b){a.focus();a.fire("saveSnapshot");var b=d[b],e=a.elementPath();a[b.checkActive(e,a)?"removeStyle":"applyStyle"](b);setTimeout(function(){a.fire("saveSnapshot")},0)},onRender:function(){a.on("selectionChange",function(b){var e=this.getValue(),b=b.data.path;this.refresh();for(var c in d)if(d[c].checkActive(b,a)){c!=e&&this.setValue(c,a.lang.format["tag_"+c]);return}this.setValue("")},this)},onOpen:function(){this.showAll();for(var b in d)a.activeFilter.check(d[b])||this.hideItem(b)},refresh:function(){var b=a.elementPath();if(b){if(b.isContextFor("p"))for(var c in d)if(a.activeFilter.check(d[c]))return;this.setState(CKEDITOR.TRISTATE_DISABLED)}}})}}});CKEDITOR.config.format_tags="p;h1;h2;h3;h4;h5;h6;pre;address;div";CKEDITOR.config.format_p={element:"p"};CKEDITOR.config.format_div={element:"div"};CKEDITOR.config.format_pre={element:"pre"};CKEDITOR.config.format_address={element:"address"};CKEDITOR.config.format_h1={element:"h1"};CKEDITOR.config.format_h2={element:"h2"};CKEDITOR.config.format_h3={element:"h3"};CKEDITOR.config.format_h4={element:"h4"};CKEDITOR.config.format_h5={element:"h5"};CKEDITOR.config.format_h6={element:"h6"};(function(){var b={canUndo:!1,exec:function(a){var b=a.document.createElement("hr");a.insertElement(b)},allowedContent:"hr",requiredContent:"hr"};CKEDITOR.plugins.add("horizontalrule",{init:function(a){a.blockless||(a.addCommand("horizontalrule",b),a.ui.addButton&&a.ui.addButton("HorizontalRule",{label:a.lang.horizontalrule.toolbar,command:"horizontalrule",toolbar:"insert,40"}))}})})();CKEDITOR.plugins.add("htmlwriter",{init:function(b){var a=new CKEDITOR.htmlWriter;a.forceSimpleAmpersand=b.config.forceSimpleAmpersand;a.indentationChars=b.config.dataIndentationChars||"\t";b.dataProcessor.writer=a}});CKEDITOR.htmlWriter=CKEDITOR.tools.createClass({base:CKEDITOR.htmlParser.basicWriter,$:function(){this.base();this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.sortAttributes=1;this._.indent=0;this._.indentation="";this._.inPre=0;this._.rules={};var b=CKEDITOR.dtd,a;for(a in CKEDITOR.tools.extend({},b.$nonBodyContent,b.$block,b.$listItem,b.$tableContent))this.setRules(a,{indent:!b[a]["#"],breakBeforeOpen:1,breakBeforeClose:!b[a]["#"],breakAfterClose:1,needsSpace:a in
b.$block&&!(a in{li:1,dt:1,dd:1})});this.setRules("br",{breakAfterOpen:1});this.setRules("title",{indent:0,breakAfterOpen:0});this.setRules("style",{indent:0,breakBeforeClose:1});this.setRules("pre",{breakAfterOpen:1,indent:0})},proto:{openTag:function(b){var a=this._.rules[b];this._.afterCloser&&(a&&a.needsSpace&&this._.needsSpace)&&this._.output.push("\n");this._.indent?this.indentation():a&&a.breakBeforeOpen&&(this.lineBreak(),this.indentation());this._.output.push("<",b);this._.afterCloser=0},openTagClose:function(b,a){var c=this._.rules[b];a?(this._.output.push(this.selfClosingEnd),c&&c.breakAfterClose&&(this._.needsSpace=c.needsSpace)):(this._.output.push(">"),c&&c.indent&&(this._.indentation+=this.indentationChars));c&&c.breakAfterOpen&&this.lineBreak();"pre"==b&&(this._.inPre=1)},attribute:function(b,a){"string"==typeof a&&(this.forceSimpleAmpersand&&(a=a.replace(/&amp;/g,"&")),a=CKEDITOR.tools.htmlEncodeAttr(a));this._.output.push(" ",b,'="',a,'"')},closeTag:function(b){var a=this._.rules[b];a&&a.indent&&(this._.indentation=this._.indentation.substr(this.indentationChars.length));this._.indent?this.indentation():a&&a.breakBeforeClose&&(this.lineBreak(),this.indentation());this._.output.push("</",b,">");"pre"==b&&(this._.inPre=0);a&&a.breakAfterClose&&(this.lineBreak(),this._.needsSpace=a.needsSpace);this._.afterCloser=1},text:function(b){this._.indent&&(this.indentation(),!this._.inPre&&(b=CKEDITOR.tools.ltrim(b)));this._.output.push(b)},comment:function(b){this._.indent&&this.indentation();this._.output.push("<\!--",b,"--\>")},lineBreak:function(){!this._.inPre&&0<this._.output.length&&this._.output.push(this.lineBreakChars);this._.indent=1},indentation:function(){!this._.inPre&&this._.indentation&&this._.output.push(this._.indentation);this._.indent=0},reset:function(){this._.output=[];this._.indent=0;this._.indentation="";this._.afterCloser=0;this._.inPre=0},setRules:function(b,a){var c=this._.rules[b];c?CKEDITOR.tools.extend(c,a,!0):this._.rules[b]=a}}});(function(){CKEDITOR.plugins.add("iframe",{requires:"dialog,fakeobjects",onLoad:function(){CKEDITOR.addCss("img.cke_iframe{background-image: url("+CKEDITOR.getUrl(this.path+"images/placeholder.png")+");background-position: center center;background-repeat: no-repeat;border: 1px solid #a9a9a9;width: 80px;height: 80px;}")},init:function(a){var b=a.lang.iframe,c="iframe[align,longdesc,frameborder,height,name,scrolling,src,title,width]";a.plugins.dialogadvtab&&(c+=";iframe"+a.plugins.dialogadvtab.allowedContent({id:1,classes:1,styles:1}));CKEDITOR.dialog.add("iframe",this.path+"dialogs/iframe.js");a.addCommand("iframe",new CKEDITOR.dialogCommand("iframe",{allowedContent:c,requiredContent:"iframe"}));a.ui.addButton&&a.ui.addButton("Iframe",{label:b.toolbar,command:"iframe",toolbar:"insert,80"});a.on("doubleclick",function(a){var b=a.data.element;b.is("img")&&"iframe"==b.data("cke-real-element-type")&&(a.data.dialog="iframe")});a.addMenuItems&&a.addMenuItems({iframe:{label:b.title,command:"iframe",group:"image"}});a.contextMenu&&a.contextMenu.addListener(function(a){if(a&&a.is("img")&&"iframe"==a.data("cke-real-element-type"))return{iframe:CKEDITOR.TRISTATE_OFF}})},afterInit:function(a){var b=a.dataProcessor;(b=b&&b.dataFilter)&&b.addRules({elements:{iframe:function(b){return a.createFakeParserElement(b,"cke_iframe","iframe",!0)}}})}})})();(function(){function k(a){var d=this.editor,b=a.document,c=b.body,e=b.getElementById("cke_actscrpt");e&&e.parentNode.removeChild(e);(e=b.getElementById("cke_shimscrpt"))&&e.parentNode.removeChild(e);(e=b.getElementById("cke_basetagscrpt"))&&e.parentNode.removeChild(e);c.contentEditable=!0;CKEDITOR.env.ie&&(c.hideFocus=!0,c.disabled=!0,c.removeAttribute("disabled"));delete this._.isLoadingData;this.$=c;b=new CKEDITOR.dom.document(b);this.setup();this.fixInitialSelection();CKEDITOR.env.ie&&(b.getDocumentElement().addClass(b.$.compatMode),d.config.enterMode!=CKEDITOR.ENTER_P&&this.attachListener(b,"selectionchange",function(){var a=b.getBody(),c=d.getSelection(),e=c&&c.getRanges()[0];e&&(a.getHtml().match(/^<p>(?:&nbsp;|<br>)<\/p>$/i)&&e.startContainer.equals(a))&&setTimeout(function(){e=d.getSelection().getRanges()[0];if(!e.startContainer.equals("body")){a.getFirst().remove(1);e.moveToElementEditEnd(a);e.select()}},0)}));if(CKEDITOR.env.webkit||CKEDITOR.env.ie&&10<CKEDITOR.env.version)b.getDocumentElement().on("mousedown",function(a){a.data.getTarget().is("html")&&setTimeout(function(){d.editable().focus()})});l(d);try{d.document.$.execCommand("2D-position",!1,!0)}catch(g){}(CKEDITOR.env.gecko||CKEDITOR.env.ie&&"CSS1Compat"==d.document.$.compatMode)&&this.attachListener(this,"keydown",function(a){var b=a.data.getKeystroke();if(b==33||b==34)if(CKEDITOR.env.ie)setTimeout(function(){d.getSelection().scrollIntoView()},0);else if(d.window.$.innerHeight>this.$.offsetHeight){var c=d.createRange();c[b==33?"moveToElementEditStart":"moveToElementEditEnd"](this);c.select();a.data.preventDefault()}});CKEDITOR.env.ie&&this.attachListener(b,"blur",function(){try{b.$.selection.empty()}catch(a){}});CKEDITOR.env.iOS&&this.attachListener(b,"touchend",function(){a.focus()});c=d.document.getElementsByTag("title").getItem(0);c.data("cke-title",c.getText());CKEDITOR.env.ie&&(d.document.$.title=this._.docTitle);CKEDITOR.tools.setTimeout(function(){if(this.status=="unloaded")this.status="ready";d.fire("contentDom");if(this._.isPendingFocus){d.focus();this._.isPendingFocus=false}setTimeout(function(){d.fire("dataReady")},0);CKEDITOR.env.ie&&setTimeout(function(){if(d.document){var a=d.document.$.body;a.runtimeStyle.marginBottom="0px";a.runtimeStyle.marginBottom=""}},1E3)},0,this)}function l(a){function d(){var c;a.editable().attachListener(a,"selectionChange",function(){var d=a.getSelection().getSelectedElement();d&&(c&&(c.detachEvent("onresizestart",b),c=null),d.$.attachEvent("onresizestart",b),c=d.$)})}function b(a){a.returnValue=!1}if(CKEDITOR.env.gecko)try{var c=a.document.$;c.execCommand("enableObjectResizing",!1,!a.config.disableObjectResizing);c.execCommand("enableInlineTableEditing",!1,!a.config.disableNativeTableHandles)}catch(e){}else CKEDITOR.env.ie&&(11>CKEDITOR.env.version&&a.config.disableObjectResizing)&&d(a)}function m(){var a=[];if(8<=CKEDITOR.document.$.documentMode){a.push("html.CSS1Compat [contenteditable=false]{min-height:0 !important}");var d=[],b;for(b in CKEDITOR.dtd.$removeEmpty)d.push("html.CSS1Compat "+b+"[contenteditable=false]");a.push(d.join(",")+"{display:inline-block}")}else CKEDITOR.env.gecko&&(a.push("html{height:100% !important}"),a.push("img:-moz-broken{-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"));a.push("html{cursor:text;*cursor:auto}");a.push("img,input,textarea{cursor:default}");return a.join("\n")}CKEDITOR.plugins.add("wysiwygarea",{init:function(a){a.config.fullPage&&a.addFeature({allowedContent:"html head title; style [media,type]; body (*)[id]; meta link [*]",requiredContent:"body"});a.addMode("wysiwyg",function(d){function b(b){b&&b.removeListener();a.editable(new j(a,e.$.contentWindow.document.body));a.setData(a.getData(1),d)}var c="document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+"document.close();",c=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent(c)+"}())":"",e=CKEDITOR.dom.element.createFromHtml('<iframe src="'+c+'" frameBorder="0"></iframe>');e.setStyles({width:"100%",height:"100%"});e.addClass("cke_wysiwyg_frame cke_reset");var g=a.ui.space("contents");g.append(e);if(c=CKEDITOR.env.ie||CKEDITOR.env.gecko)e.on("load",b);var f=a.title,h=a.fire("ariaEditorHelpLabel",{}).label;f&&(CKEDITOR.env.ie&&h&&(f+=", "+h),e.setAttribute("title",f));if(h){var f=CKEDITOR.tools.getNextId(),i=CKEDITOR.dom.element.createFromHtml('<span id="'+f+'" class="cke_voice_label">'+h+"</span>");g.append(i,1);e.setAttribute("aria-describedby",f)}a.on("beforeModeUnload",function(a){a.removeListener();i&&i.remove()});e.setAttributes({tabIndex:a.tabIndex,allowTransparency:"true"});!c&&b();CKEDITOR.env.webkit&&(c=function(){g.setStyle("width","100%");e.hide();e.setSize("width",g.getSize("width"));g.removeStyle("width");e.show()},e.setCustomData("onResize",c),CKEDITOR.document.getWindow().on("resize",c));a.fire("ariaWidget",e)})}});CKEDITOR.editor.prototype.addContentsCss=function(a){var d=this.config,b=d.contentsCss;CKEDITOR.tools.isArray(b)||(d.contentsCss=b?[b]:[]);d.contentsCss.push(a)};var j=CKEDITOR.tools.createClass({$:function(a){this.base.apply(this,arguments);this._.frameLoadedHandler=CKEDITOR.tools.addFunction(function(a){CKEDITOR.tools.setTimeout(k,0,this,a)},this);this._.docTitle=this.getWindow().getFrame().getAttribute("title")},base:CKEDITOR.editable,proto:{setData:function(a,d){var b=this.editor;if(d)this.setHtml(a),this.fixInitialSelection(),b.fire("dataReady");else{this._.isLoadingData=!0;b._.dataStore={id:1};var c=b.config,e=c.fullPage,g=c.docType,f=CKEDITOR.tools.buildStyleHtml(m()).replace(/<style>/,'<style data-cke-temp="1">');e||(f+=CKEDITOR.tools.buildStyleHtml(b.config.contentsCss));var h=c.baseHref?'<base href="'+c.baseHref+'" data-cke-temp="1" />':"";e&&(a=a.replace(/<!DOCTYPE[^>]*>/i,function(a){b.docType=g=a;return""}).replace(/<\?xml\s[^\?]*\?>/i,function(a){b.xmlDeclaration=a;return""}));a=b.dataProcessor.toHtml(a);e?(/<body[\s|>]/.test(a)||(a="<body>"+a),/<html[\s|>]/.test(a)||(a="<html>"+a+"</html>"),/<head[\s|>]/.test(a)?/<title[\s|>]/.test(a)||(a=a.replace(/<head[^>]*>/,"$&<title></title>")):a=a.replace(/<html[^>]*>/,"$&<head><title></title></head>"),h&&(a=a.replace(/<head[^>]*?>/,"$&"+h)),a=a.replace(/<\/head\s*>/,f+"$&"),a=g+a):a=c.docType+'<html dir="'+c.contentsLangDirection+'" lang="'+(c.contentsLanguage||b.langCode)+'"><head><title>'+this._.docTitle+"</title>"+h+f+"</head><body"+(c.bodyId?' id="'+c.bodyId+'"':"")+(c.bodyClass?' class="'+c.bodyClass+'"':"")+">"+a+"</body></html>";CKEDITOR.env.gecko&&(a=a.replace(/<body/,'<body contenteditable="true" '),2E4>CKEDITOR.env.version&&(a=a.replace(/<body[^>]*>/,"$&<\!-- cke-content-start --\>")));c='<script id="cke_actscrpt" type="text/javascript"'+(CKEDITOR.env.ie?' defer="defer" ':"")+">var wasLoaded=0;function onload(){if(!wasLoaded)window.parent.CKEDITOR.tools.callFunction("+this._.frameLoadedHandler+",window);wasLoaded=1;}"+(CKEDITOR.env.ie?"onload();":'document.addEventListener("DOMContentLoaded", onload, false );')+"<\/script>";CKEDITOR.env.ie&&9>CKEDITOR.env.version&&(c+='<script id="cke_shimscrpt">window.parent.CKEDITOR.tools.enableHtml5Elements(document)<\/script>');h&&(CKEDITOR.env.ie&&10>CKEDITOR.env.version)&&(c+='<script id="cke_basetagscrpt">var baseTag = document.querySelector( "base" );baseTag.href = baseTag.href;<\/script>');a=a.replace(/(?=\s*<\/(:?head)>)/,c);this.clearCustomData();this.clearListeners();b.fire("contentDomUnload");var i=this.getDocument();try{i.write(a)}catch(j){setTimeout(function(){i.write(a)},0)}}},getData:function(a){if(a)return this.getHtml();var a=this.editor,d=a.config,b=d.fullPage,c=b&&a.docType,e=b&&a.xmlDeclaration,g=this.getDocument(),b=b?g.getDocumentElement().getOuterHtml():g.getBody().getHtml();CKEDITOR.env.gecko&&d.enterMode!=CKEDITOR.ENTER_BR&&(b=b.replace(/<br>(?=\s*(:?$|<\/body>))/,""));b=a.dataProcessor.toDataFormat(b);e&&(b=e+"\n"+b);c&&(b=c+"\n"+b);return b},focus:function(){this._.isLoadingData?this._.isPendingFocus=!0:j.baseProto.focus.call(this)},detach:function(){var a=this.editor,d=a.document,a=a.window.getFrame();j.baseProto.detach.call(this);this.clearCustomData();d.getDocumentElement().clearCustomData();if(a)a.clearCustomData();CKEDITOR.tools.removeFunction(this._.frameLoadedHandler);if(a){(d=a.removeCustomData("onResize"))&&d.removeListener();a.remove()}}}})})();CKEDITOR.config.disableObjectResizing=!1;CKEDITOR.config.disableNativeTableHandles=!0;CKEDITOR.config.disableNativeSpellChecker=!0;CKEDITOR.config.contentsCss=CKEDITOR.getUrl("contents.css");(function(){function e(b,a){a||(a=b.getSelection().getSelectedElement());if(a&&a.is("img")&&!a.data("cke-realelement")&&!a.isReadOnly())return a}function f(b){var a=b.getStyle("float");if("inherit"==a||"none"==a)a=0;a||(a=b.getAttribute("align"));return a}CKEDITOR.plugins.add("image",{requires:"dialog",init:function(b){if(!b.plugins.image2){CKEDITOR.dialog.add("image",this.path+"dialogs/image.js");var a="img[alt,!src]{border-style,border-width,float,height,margin,margin-bottom,margin-left,margin-right,margin-top,width}";CKEDITOR.dialog.isTabEnabled(b,"image","advanced")&&(a="img[alt,dir,id,lang,longdesc,!src,title]{*}(*)");b.addCommand("image",new CKEDITOR.dialogCommand("image",{allowedContent:a,requiredContent:"img[alt,src]",contentTransformations:[["img{width}: sizeToStyle","img[width]: sizeToAttribute"],["img{float}: alignmentToStyle","img[align]: alignmentToAttribute"]]}));b.ui.addButton&&b.ui.addButton("Image",{label:b.lang.common.image,command:"image",toolbar:"insert,10"});b.on("doubleclick",function(b){var a=b.data.element;a.is("img")&&(!a.data("cke-realelement")&&!a.isReadOnly())&&(b.data.dialog="image")});b.addMenuItems&&b.addMenuItems({image:{label:b.lang.image.menu,command:"image",group:"image"}});b.contextMenu&&b.contextMenu.addListener(function(a){if(e(b,a))return{image:CKEDITOR.TRISTATE_OFF}})}},afterInit:function(b){function a(a){var d=b.getCommand("justify"+a);if(d){if("left"==a||"right"==a)d.on("exec",function(d){var c=e(b),g;c&&(g=f(c),g==a?(c.removeStyle("float"),a==f(c)&&c.removeAttribute("align")):c.setStyle("float",a),d.cancel())});d.on("refresh",function(d){var c=e(b);c&&(c=f(c),this.setState(c==a?CKEDITOR.TRISTATE_ON:"right"==a||"left"==a?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),d.cancel())})}}b.plugins.image2||(a("left"),a("right"),a("center"),a("block"))}})})();CKEDITOR.config.image_removeLinkByEmptyURL=!0;(function(){function k(a,b){var e,f;b.on("refresh",function(a){var b=[i],c;for(c in a.data.states)b.push(a.data.states[c]);this.setState(CKEDITOR.tools.search(b,m)?m:i)},b,null,100);b.on("exec",function(b){e=a.getSelection();f=e.createBookmarks(1);b.data||(b.data={});b.data.done=!1},b,null,0);b.on("exec",function(){a.forceNextSelectionCheck();e.selectBookmarks(f)},b,null,100)}var i=CKEDITOR.TRISTATE_DISABLED,m=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indent",{init:function(a){var b=CKEDITOR.plugins.indent.genericDefinition;k(a,a.addCommand("indent",new b(!0)));k(a,a.addCommand("outdent",new b));a.ui.addButton&&(a.ui.addButton("Indent",{label:a.lang.indent.indent,command:"indent",directional:!0,toolbar:"indent,20"}),a.ui.addButton("Outdent",{label:a.lang.indent.outdent,command:"outdent",directional:!0,toolbar:"indent,10"}));a.on("dirChanged",function(b){var f=a.createRange(),j=b.data.node;f.setStartBefore(j);f.setEndAfter(j);for(var l=new CKEDITOR.dom.walker(f),c;c=l.next();)if(c.type==CKEDITOR.NODE_ELEMENT)if(!c.equals(j)&&c.getDirection()){f.setStartAfter(c);l=new CKEDITOR.dom.walker(f)}else{var d=a.config.indentClasses;if(d)for(var g=b.data.dir=="ltr"?["_rtl",""]:["","_rtl"],h=0;h<d.length;h++)if(c.hasClass(d[h]+g[0])){c.removeClass(d[h]+g[0]);c.addClass(d[h]+g[1])}d=c.getStyle("margin-right");g=c.getStyle("margin-left");d?c.setStyle("margin-left",d):c.removeStyle("margin-left");g?c.setStyle("margin-right",g):c.removeStyle("margin-right")}})}});CKEDITOR.plugins.indent={genericDefinition:function(a){this.isIndent=!!a;this.startDisabled=!this.isIndent},specificDefinition:function(a,b,e){this.name=b;this.editor=a;this.jobs={};this.enterBr=a.config.enterMode==CKEDITOR.ENTER_BR;this.isIndent=!!e;this.relatedGlobal=e?"indent":"outdent";this.indentKey=e?9:CKEDITOR.SHIFT+9;this.database={}},registerCommands:function(a,b){a.on("pluginsLoaded",function(){for(var a in b)(function(a,b){var e=a.getCommand(b.relatedGlobal),c;for(c in b.jobs)e.on("exec",function(d){d.data.done||(a.fire("lockSnapshot"),b.execJob(a,c)&&(d.data.done=!0),a.fire("unlockSnapshot"),CKEDITOR.dom.element.clearAllMarkers(b.database))},this,null,c),e.on("refresh",function(d){d.data.states||(d.data.states={});d.data.states[b.name+"@"+c]=b.refreshJob(a,c,d.data.path)},this,null,c);a.addFeature(b)})(this,b[a])})}};CKEDITOR.plugins.indent.genericDefinition.prototype={context:"p",exec:function(){}};CKEDITOR.plugins.indent.specificDefinition.prototype={execJob:function(a,b){var e=this.jobs[b];if(e.state!=i)return e.exec.call(this,a)},refreshJob:function(a,b,e){b=this.jobs[b];b.state=a.activeFilter.checkFeature(this)?b.refresh.call(this,a,e):i;return b.state},getContext:function(a){return a.contains(this.context)}}})();(function(){function f(b,d,a){if(!b.getCustomData("indent_processed")){var e=this.editor,j=this.isIndent;if(d){e=b.$.className.match(this.classNameRegex);a=0;e&&(e=e[1],a=CKEDITOR.tools.indexOf(d,e)+1);if(0>(a+=j?1:-1))return;a=Math.min(a,d.length);a=Math.max(a,0);b.$.className=CKEDITOR.tools.ltrim(b.$.className.replace(this.classNameRegex,""));0<a&&b.addClass(d[a-1])}else{var d=k(b,a),a=parseInt(b.getStyle(d),10),g=e.config.indentOffset||40;isNaN(a)&&(a=0);a+=(j?1:-1)*g;if(0>a)return;a=Math.max(a,0);a=Math.ceil(a/g)*g;b.setStyle(d,a?a+(e.config.indentUnit||"px"):"");""===b.getAttribute("style")&&b.removeAttribute("style")}CKEDITOR.dom.element.setMarker(this.database,b,"indent_processed",1)}}function k(b,d){return"ltr"==(d||b.getComputedStyle("direction"))?"margin-left":"margin-right"}var h=CKEDITOR.dtd.$listItem,m=CKEDITOR.dtd.$list,i=CKEDITOR.TRISTATE_DISABLED,l=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentblock",{requires:"indent",init:function(b){function d(){a.specificDefinition.apply(this,arguments);this.allowedContent={"div h1 h2 h3 h4 h5 h6 ol p pre ul":{propertiesOnly:!0,styles:!e?"margin-left,margin-right":null,classes:e||null}};this.enterBr&&(this.allowedContent.div=!0);this.requiredContent=(this.enterBr?"div":"p")+(e?"("+e.join(",")+")":"{margin-left}");this.jobs={20:{refresh:function(a,b){var c=b.block||b.blockLimit;c.is(h)||(c=c.getAscendant(h)||c);c.is(h)&&(c=c.getParent());if(!this.enterBr&&!this.getContext(b))return i;if(e){var d;d=e;var c=c.$.className.match(this.classNameRegex),f=this.isIndent;d=c?f?c[1]!=d.slice(-1):true:f;return d?l:i}return this.isIndent?l:c?CKEDITOR[(parseInt(c.getStyle(k(c)),10)||0)<=0?"TRISTATE_DISABLED":"TRISTATE_OFF"]:i},exec:function(a){var b=a.getSelection(),b=b&&b.getRanges()[0],c;if(c=a.elementPath().contains(m))f.call(this,c,e);else{b=b.createIterator();a=a.config.enterMode;b.enforceRealBlocks=true;for(b.enlargeBr=a!=CKEDITOR.ENTER_BR;c=b.getNextParagraph(a==CKEDITOR.ENTER_P?"p":"div");)c.isReadOnly()||f.call(this,c,e)}return true}}}}var a=CKEDITOR.plugins.indent,e=b.config.indentClasses;a.registerCommands(b,{indentblock:new d(b,"indentblock",!0),outdentblock:new d(b,"outdentblock")});CKEDITOR.tools.extend(d.prototype,a.specificDefinition.prototype,{context:{div:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,p:1,pre:1,table:1},classNameRegex:e?RegExp("(?:^|\\s+)("+e.join("|")+")(?=$|\\s)"):null})}})})();(function(){function s(c){function f(b){for(var e=d.startContainer,a=d.endContainer;e&&!e.getParent().equals(b);)e=e.getParent();for(;a&&!a.getParent().equals(b);)a=a.getParent();if(!e||!a)return!1;for(var g=e,e=[],i=!1;!i;)g.equals(a)&&(i=!0),e.push(g),g=g.getNext();if(1>e.length)return!1;g=b.getParents(!0);for(a=0;a<g.length;a++)if(g[a].getName&&m[g[a].getName()]){b=g[a];break}for(var g=j.isIndent?1:-1,a=e[0],e=e[e.length-1],i=CKEDITOR.plugins.list.listToArray(b,n),l=i[e.getCustomData("listarray_index")].indent,a=a.getCustomData("listarray_index");a<=e.getCustomData("listarray_index");a++)if(i[a].indent+=g,0<g){var h=i[a].parent;i[a].parent=new CKEDITOR.dom.element(h.getName(),h.getDocument())}for(a=e.getCustomData("listarray_index")+1;a<i.length&&i[a].indent>l;a++)i[a].indent+=g;e=CKEDITOR.plugins.list.arrayToList(i,n,null,c.config.enterMode,b.getDirection());if(!j.isIndent){var f;if((f=b.getParent())&&f.is("li"))for(var g=e.listNode.getChildren(),o=[],k,a=g.count()-1;0<=a;a--)(k=g.getItem(a))&&(k.is&&k.is("li"))&&o.push(k)}e&&e.listNode.replace(b);if(o&&o.length)for(a=0;a<o.length;a++){for(k=b=o[a];(k=k.getNext())&&k.is&&k.getName()in m;)CKEDITOR.env.needsNbspFiller&&!b.getFirst(t)&&b.append(d.document.createText(" ")),b.append(k);b.insertAfter(f)}e&&c.fire("contentDomInvalidated");return!0}for(var j=this,n=this.database,m=this.context,l=c.getSelection(),l=(l&&l.getRanges()).createIterator(),d;d=l.getNextRange();){for(var b=d.getCommonAncestor();b&&!(b.type==CKEDITOR.NODE_ELEMENT&&m[b.getName()]);)b=b.getParent();b||(b=d.startPath().contains(m))&&d.setEndAt(b,CKEDITOR.POSITION_BEFORE_END);if(!b){var h=d.getEnclosedNode();h&&(h.type==CKEDITOR.NODE_ELEMENT&&h.getName()in m)&&(d.setStartAt(h,CKEDITOR.POSITION_AFTER_START),d.setEndAt(h,CKEDITOR.POSITION_BEFORE_END),b=h)}b&&(d.startContainer.type==CKEDITOR.NODE_ELEMENT&&d.startContainer.getName()in m)&&(h=new CKEDITOR.dom.walker(d),h.evaluator=p,d.startContainer=h.next());b&&(d.endContainer.type==CKEDITOR.NODE_ELEMENT&&d.endContainer.getName()in m)&&(h=new CKEDITOR.dom.walker(d),h.evaluator=p,d.endContainer=h.previous());if(b)return f(b)}return 0}function p(c){return c.type==CKEDITOR.NODE_ELEMENT&&c.is("li")}function t(c){return u(c)&&v(c)}var u=CKEDITOR.dom.walker.whitespaces(!0),v=CKEDITOR.dom.walker.bookmark(!1,!0),q=CKEDITOR.TRISTATE_DISABLED,r=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentlist",{requires:"indent",init:function(c){function f(c){j.specificDefinition.apply(this,arguments);this.requiredContent=["ul","ol"];c.on("key",function(f){if("wysiwyg"==c.mode&&f.data.keyCode==this.indentKey){var l=this.getContext(c.elementPath());if(l&&(!this.isIndent||!CKEDITOR.plugins.indentList.firstItemInPath(this.context,c.elementPath(),l)))c.execCommand(this.relatedGlobal),f.cancel()}},this);this.jobs[this.isIndent?10:30]={refresh:this.isIndent?function(c,f){var d=this.getContext(f),b=CKEDITOR.plugins.indentList.firstItemInPath(this.context,f,d);return!d||!this.isIndent||b?q:r}:function(c,f){return!this.getContext(f)||this.isIndent?q:r},exec:CKEDITOR.tools.bind(s,this)}}var j=CKEDITOR.plugins.indent;j.registerCommands(c,{indentlist:new f(c,"indentlist",!0),outdentlist:new f(c,"outdentlist")});CKEDITOR.tools.extend(f.prototype,j.specificDefinition.prototype,{context:{ol:1,ul:1}})}});CKEDITOR.plugins.indentList={};CKEDITOR.plugins.indentList.firstItemInPath=function(c,f,j){var n=f.contains(p);j||(j=f.contains(c));return j&&n&&n.equals(j.getFirst(p))}})();CKEDITOR.plugins.add("smiley",{requires:"dialog",init:function(a){a.config.smiley_path=a.config.smiley_path||this.path+"images/";a.addCommand("smiley",new CKEDITOR.dialogCommand("smiley",{allowedContent:"img[alt,height,!src,title,width]",requiredContent:"img"}));a.ui.addButton&&a.ui.addButton("Smiley",{label:a.lang.smiley.toolbar,command:"smiley",toolbar:"insert,50"});CKEDITOR.dialog.add("smiley",this.path+"dialogs/smiley.js")}});CKEDITOR.config.smiley_images="regular_smile.png sad_smile.png wink_smile.png teeth_smile.png confused_smile.png tongue_smile.png embarrassed_smile.png omg_smile.png whatchutalkingabout_smile.png angry_smile.png angel_smile.png shades_smile.png devil_smile.png cry_smile.png lightbulb.png thumbs_down.png thumbs_up.png heart.png broken_heart.png kiss.png envelope.png".split(" ");CKEDITOR.config.smiley_descriptions="smiley;sad;wink;laugh;frown;cheeky;blush;surprise;indecision;angry;angel;cool;devil;crying;enlightened;no;yes;heart;broken heart;kiss;mail".split(";");(function(){function l(a,c){var c=void 0===c||c,b;if(c)b=a.getComputedStyle("text-align");else{for(;!a.hasAttribute||!a.hasAttribute("align")&&!a.getStyle("text-align");){b=a.getParent();if(!b)break;a=b}b=a.getStyle("text-align")||a.getAttribute("align")||""}b&&(b=b.replace(/(?:-(?:moz|webkit)-)?(?:start|auto)/i,""));!b&&c&&(b="rtl"==a.getComputedStyle("direction")?"right":"left");return b}function g(a,c,b){this.editor=a;this.name=c;this.value=b;this.context="p";var c=a.config.justifyClasses,h=a.config.enterMode==CKEDITOR.ENTER_P?"p":"div";if(c){switch(b){case"left":this.cssClassName=c[0];break;case"center":this.cssClassName=c[1];break;case"right":this.cssClassName=c[2];break;case"justify":this.cssClassName=c[3]}this.cssClassRegex=RegExp("(?:^|\\s+)(?:"+c.join("|")+")(?=$|\\s)");this.requiredContent=h+"("+this.cssClassName+")"}else this.requiredContent=h+"{text-align}";this.allowedContent={"caption div h1 h2 h3 h4 h5 h6 p pre td th li":{propertiesOnly:!0,styles:this.cssClassName?null:"text-align",classes:this.cssClassName||null}};a.config.enterMode==CKEDITOR.ENTER_BR&&(this.allowedContent.div=!0)}function j(a){var c=a.editor,b=c.createRange();b.setStartBefore(a.data.node);b.setEndAfter(a.data.node);for(var h=new CKEDITOR.dom.walker(b),d;d=h.next();)if(d.type==CKEDITOR.NODE_ELEMENT)if(!d.equals(a.data.node)&&d.getDirection())b.setStartAfter(d),h=new CKEDITOR.dom.walker(b);else{var e=c.config.justifyClasses;e&&(d.hasClass(e[0])?(d.removeClass(e[0]),d.addClass(e[2])):d.hasClass(e[2])&&(d.removeClass(e[2]),d.addClass(e[0])));e=d.getStyle("text-align");"left"==e?d.setStyle("text-align","right"):"right"==e&&d.setStyle("text-align","left")}}g.prototype={exec:function(a){var c=a.getSelection(),b=a.config.enterMode;if(c){for(var h=c.createBookmarks(),d=c.getRanges(),e=this.cssClassName,g,f,i=a.config.useComputedState,i=void 0===i||i,k=d.length-1;0<=k;k--){g=d[k].createIterator();for(g.enlargeBr=b!=CKEDITOR.ENTER_BR;f=g.getNextParagraph(b==CKEDITOR.ENTER_P?"p":"div");)if(!f.isReadOnly()){f.removeAttribute("align");f.removeStyle("text-align");var j=e&&(f.$.className=CKEDITOR.tools.ltrim(f.$.className.replace(this.cssClassRegex,""))),m=this.state==CKEDITOR.TRISTATE_OFF&&(!i||l(f,!0)!=this.value);e?m?f.addClass(e):j||f.removeAttribute("class"):m&&f.setStyle("text-align",this.value)}}a.focus();a.forceNextSelectionCheck();c.selectBookmarks(h)}},refresh:function(a,c){var b=c.block||c.blockLimit;this.setState("body"!=b.getName()&&l(b,this.editor.config.useComputedState)==this.value?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}};CKEDITOR.plugins.add("justify",{init:function(a){if(!a.blockless){var c=new g(a,"justifyleft","left"),b=new g(a,"justifycenter","center"),h=new g(a,"justifyright","right"),d=new g(a,"justifyblock","justify");a.addCommand("justifyleft",c);a.addCommand("justifycenter",b);a.addCommand("justifyright",h);a.addCommand("justifyblock",d);a.ui.addButton&&(a.ui.addButton("JustifyLeft",{label:a.lang.justify.left,command:"justifyleft",toolbar:"align,10"}),a.ui.addButton("JustifyCenter",{label:a.lang.justify.center,command:"justifycenter",toolbar:"align,20"}),a.ui.addButton("JustifyRight",{label:a.lang.justify.right,command:"justifyright",toolbar:"align,30"}),a.ui.addButton("JustifyBlock",{label:a.lang.justify.block,command:"justifyblock",toolbar:"align,40"}));a.on("dirChanged",j)}}})})();CKEDITOR.plugins.add("menubutton",{requires:"button,menu",onLoad:function(){var d=function(c){var a=this._,b=a.menu;a.state!==CKEDITOR.TRISTATE_DISABLED&&(a.on&&b?b.hide():(a.previousState=a.state,b||(b=a.menu=new CKEDITOR.menu(c,{panel:{className:"cke_menu_panel",attributes:{"aria-label":c.lang.common.options}}}),b.onHide=CKEDITOR.tools.bind(function(){var b=this.command?c.getCommand(this.command).modes:this.modes;this.setState(!b||b[c.mode]?a.previousState:CKEDITOR.TRISTATE_DISABLED);a.on=0},this),this.onMenu&&b.addListener(this.onMenu)),this.setState(CKEDITOR.TRISTATE_ON),a.on=1,setTimeout(function(){b.show(CKEDITOR.document.getById(a.id),4)},0)))};CKEDITOR.ui.menuButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(c){delete c.panel;this.base(c);this.hasArrow=!0;this.click=d},statics:{handler:{create:function(c){return new CKEDITOR.ui.menuButton(c)}}}})},beforeInit:function(d){d.ui.addHandler(CKEDITOR.UI_MENUBUTTON,CKEDITOR.ui.menuButton.handler)}});CKEDITOR.UI_MENUBUTTON="menubutton";(function(){CKEDITOR.plugins.add("language",{requires:"menubutton",init:function(a){var b=a.config.language_list||["ar:Arabic:rtl","fr:French","es:Spanish"],c=this,d=a.lang.language,e={},g,h,i,f;a.addCommand("language",{allowedContent:"span[!lang,!dir]",requiredContent:"span[lang,dir]",contextSensitive:!0,exec:function(a,b){var c=e["language_"+b];if(c)a[c.style.checkActive(a.elementPath(),a)?"removeStyle":"applyStyle"](c.style)},refresh:function(a){this.setState(c.getCurrentLangElement(a)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}});for(f=0;f<b.length;f++)g=b[f].split(":"),h=g[0],i="language_"+h,e[i]={label:g[1],langId:h,group:"language",order:f,ltr:"rtl"!=(""+g[2]).toLowerCase(),onClick:function(){a.execCommand("language",this.langId)},role:"menuitemcheckbox"},e[i].style=new CKEDITOR.style({element:"span",attributes:{lang:h,dir:e[i].ltr?"ltr":"rtl"}});e.language_remove={label:d.remove,group:"language_remove",state:CKEDITOR.TRISTATE_DISABLED,order:e.length,onClick:function(){var b=c.getCurrentLangElement(a);b&&a.execCommand("language",b.getAttribute("lang"))}};a.addMenuGroup("language",1);a.addMenuGroup("language_remove");a.addMenuItems(e);a.ui.add("Language",CKEDITOR.UI_MENUBUTTON,{label:d.button,allowedContent:"span[!lang,!dir]",requiredContent:"span[lang,dir]",toolbar:"bidi,30",command:"language",onMenu:function(){var b={},d=c.getCurrentLangElement(a),f;for(f in e)b[f]=CKEDITOR.TRISTATE_OFF;b.language_remove=d?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;d&&(b["language_"+d.getAttribute("lang")]=CKEDITOR.TRISTATE_ON);return b}})},getCurrentLangElement:function(a){var b=a.elementPath(),a=b&&b.elements,c;if(b)for(var d=0;d<a.length;d++)b=a[d],!c&&("span"==b.getName()&&b.hasAttribute("dir")&&b.hasAttribute("lang"))&&(c=b);return c}})})();(function(){function m(c){return c.replace(/'/g,"\\$&")}function n(c){for(var b,a=c.length,f=[],e=0;e<a;e++)b=c.charCodeAt(e),f.push(b);return"String.fromCharCode("+f.join(",")+")"}function o(c,b){var a=c.plugins.link,f=a.compiledProtectionFunction.params,e,d;d=[a.compiledProtectionFunction.name,"("];for(var g=0;g<f.length;g++)a=f[g].toLowerCase(),e=b[a],0<g&&d.push(","),d.push("'",e?m(encodeURIComponent(b[a])):"","'");d.push(")");return d.join("")}function l(c){var c=c.config.emailProtection||"",b;c&&"encode"!=c&&(b={},c.replace(/^([^(]+)\(([^)]+)\)$/,function(a,c,e){b.name=c;b.params=[];e.replace(/[^,\s]+/g,function(a){b.params.push(a)})}));return b}CKEDITOR.plugins.add("link",{requires:"dialog,fakeobjects",onLoad:function(){function c(b){return a.replace(/%1/g,"rtl"==b?"right":"left").replace(/%2/g,"cke_contents_"+b)}var b="background:url("+CKEDITOR.getUrl(this.path+"images"+(CKEDITOR.env.hidpi?"/hidpi":"")+"/anchor.png")+") no-repeat %1 center;border:1px dotted #00f;background-size:16px;",a=".%2 a.cke_anchor,.%2 a.cke_anchor_empty,.cke_editable.%2 a[name],.cke_editable.%2 a[data-cke-saved-name]{"+b+"padding-%1:18px;cursor:auto;}.%2 img.cke_anchor{"+b+"width:16px;min-height:15px;height:1.15em;vertical-align:text-bottom;}";CKEDITOR.addCss(c("ltr")+c("rtl"))},init:function(c){var b="a[!href]";CKEDITOR.dialog.isTabEnabled(c,"link","advanced")&&(b=b.replace("]",",accesskey,charset,dir,id,lang,name,rel,tabindex,title,type]{*}(*)"));CKEDITOR.dialog.isTabEnabled(c,"link","target")&&(b=b.replace("]",",target,onclick]"));c.addCommand("link",new CKEDITOR.dialogCommand("link",{allowedContent:b,requiredContent:"a[href]"}));c.addCommand("anchor",new CKEDITOR.dialogCommand("anchor",{allowedContent:"a[!name,id]",requiredContent:"a[name]"}));c.addCommand("unlink",new CKEDITOR.unlinkCommand);c.addCommand("removeAnchor",new CKEDITOR.removeAnchorCommand);c.setKeystroke(CKEDITOR.CTRL+76,"link");c.ui.addButton&&(c.ui.addButton("Link",{label:c.lang.link.toolbar,command:"link",toolbar:"links,10"}),c.ui.addButton("Unlink",{label:c.lang.link.unlink,command:"unlink",toolbar:"links,20"}),c.ui.addButton("Anchor",{label:c.lang.link.anchor.toolbar,command:"anchor",toolbar:"links,30"}));CKEDITOR.dialog.add("link",this.path+"dialogs/link.js");CKEDITOR.dialog.add("anchor",this.path+"dialogs/anchor.js");c.on("doubleclick",function(a){var b=CKEDITOR.plugins.link.getSelectedLink(c)||a.data.element;if(!b.isReadOnly())if(b.is("a")){a.data.dialog=b.getAttribute("name")&&(!b.getAttribute("href")||!b.getChildCount())?"anchor":"link";a.data.link=b}else if(CKEDITOR.plugins.link.tryRestoreFakeAnchor(c,b))a.data.dialog="anchor"},null,null,0);c.on("doubleclick",function(a){a.data.dialog in{link:1,anchor:1}&&a.data.link&&c.getSelection().selectElement(a.data.link)},null,null,20);c.addMenuItems&&c.addMenuItems({anchor:{label:c.lang.link.anchor.menu,command:"anchor",group:"anchor",order:1},removeAnchor:{label:c.lang.link.anchor.remove,command:"removeAnchor",group:"anchor",order:5},link:{label:c.lang.link.menu,command:"link",group:"link",order:1},unlink:{label:c.lang.link.unlink,command:"unlink",group:"link",order:5}});c.contextMenu&&c.contextMenu.addListener(function(a){if(!a||a.isReadOnly())return null;a=CKEDITOR.plugins.link.tryRestoreFakeAnchor(c,a);if(!a&&!(a=CKEDITOR.plugins.link.getSelectedLink(c)))return null;var b={};a.getAttribute("href")&&a.getChildCount()&&(b={link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF});if(a&&a.hasAttribute("name"))b.anchor=b.removeAnchor=CKEDITOR.TRISTATE_OFF;return b});this.compiledProtectionFunction=l(c)},afterInit:function(c){c.dataProcessor.dataFilter.addRules({elements:{a:function(a){return!a.attributes.name?null:!a.children.length?c.createFakeParserElement(a,"cke_anchor","anchor"):null}}});var b=c._.elementsPath&&c._.elementsPath.filters;b&&b.push(function(a,b){if("a"==b&&(CKEDITOR.plugins.link.tryRestoreFakeAnchor(c,a)||a.getAttribute("name")&&(!a.getAttribute("href")||!a.getChildCount())))return"anchor"})}});var p=/^javascript:/,q=/^mailto:([^?]+)(?:\?(.+))?$/,r=/subject=([^;?:@&=$,\/]*)/,s=/body=([^;?:@&=$,\/]*)/,t=/^#(.*)$/,u=/^((?:http|https|ftp|news):\/\/)?(.*)$/,v=/^(_(?:self|top|parent|blank))$/,w=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,x=/^javascript:([^(]+)\(([^)]+)\)$/,y=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/,z=/(?:^|,)([^=]+)=(\d+|yes|no)/gi,j={id:"advId",dir:"advLangDir",accessKey:"advAccessKey",name:"advName",lang:"advLangCode",tabindex:"advTabIndex",title:"advTitle",type:"advContentType","class":"advCSSClasses",charset:"advCharset",style:"advStyles",rel:"advRel"};CKEDITOR.plugins.link={getSelectedLink:function(c){var b=c.getSelection(),a=b.getSelectedElement();return a&&a.is("a")?a:(b=b.getRanges()[0])?(b.shrink(CKEDITOR.SHRINK_TEXT),c.elementPath(b.getCommonAncestor()).contains("a",1)):null},getEditorAnchors:function(c){for(var b=c.editable(),a=b.isInline()&&!c.plugins.divarea?c.document:b,b=a.getElementsByTag("a"),a=a.getElementsByTag("img"),f=[],e=0,d;d=b.getItem(e++);)if(d.data("cke-saved-name")||d.hasAttribute("name"))f.push({name:d.data("cke-saved-name")||d.getAttribute("name"),id:d.getAttribute("id")});for(e=0;d=a.getItem(e++);)(d=this.tryRestoreFakeAnchor(c,d))&&f.push({name:d.getAttribute("name"),id:d.getAttribute("id")});return f},fakeAnchor:!0,tryRestoreFakeAnchor:function(c,b){if(b&&b.data("cke-real-element-type")&&"anchor"==b.data("cke-real-element-type")){var a=c.restoreRealElement(b);if(a.data("cke-saved-name"))return a}},parseLinkAttributes:function(c,b){var a=b&&(b.data("cke-saved-href")||b.getAttribute("href"))||"",f=c.plugins.link.compiledProtectionFunction,e=c.config.emailProtection,d,g={};a.match(p)&&("encode"==e?a=a.replace(w,function(a,b,c){return"mailto:"+String.fromCharCode.apply(String,b.split(","))+(c&&c.replace(/\\'/g,"'"))}):e&&a.replace(x,function(a,b,c){if(b==f.name){g.type="email";for(var a=g.email={},b=/(^')|('$)/g,c=c.match(/[^,\s]+/g),d=c.length,e,h,i=0;i<d;i++)e=decodeURIComponent,h=c[i].replace(b,"").replace(/\\'/g,"'"),h=e(h),e=f.params[i].toLowerCase(),a[e]=h;a.address=[a.name,a.domain].join("@")}}));if(!g.type)if(e=a.match(t))g.type="anchor",g.anchor={},g.anchor.name=g.anchor.id=e[1];else if(e=a.match(q)){d=a.match(r);a=a.match(s);g.type="email";var i=g.email={};i.address=e[1];d&&(i.subject=decodeURIComponent(d[1]));a&&(i.body=decodeURIComponent(a[1]))}else if(a&&(d=a.match(u)))g.type="url",g.url={},g.url.protocol=d[1],g.url.url=d[2];if(b){if(a=b.getAttribute("target"))g.target={type:a.match(v)?a:"frame",name:a};else if(a=(a=b.data("cke-pa-onclick")||b.getAttribute("onclick"))&&a.match(y))for(g.target={type:"popup",name:a[1]};e=z.exec(a[2]);)("yes"==e[2]||"1"==e[2])&&!(e[1]in{height:1,width:1,top:1,left:1})?g.target[e[1]]=!0:isFinite(e[2])&&(g.target[e[1]]=e[2]);var a={},h;for(h in j)(e=b.getAttribute(h))&&(a[j[h]]=e);if(h=b.data("cke-saved-name")||a.advName)a.advName=h;CKEDITOR.tools.isEmpty(a)||(g.advanced=a)}return g},getLinkAttributes:function(c,b){var a=c.config.emailProtection||"",f={};switch(b.type){case"url":var a=b.url&&void 0!=b.url.protocol?b.url.protocol:"http://",e=b.url&&CKEDITOR.tools.trim(b.url.url)||"";f["data-cke-saved-href"]=0===e.indexOf("/")?e:a+e;break;case"anchor":a=b.anchor&&b.anchor.id;f["data-cke-saved-href"]="#"+(b.anchor&&b.anchor.name||a||"");break;case"email":var d=b.email,e=d.address;switch(a){case"":case"encode":var g=encodeURIComponent(d.subject||""),i=encodeURIComponent(d.body||""),d=[];g&&d.push("subject="+g);i&&d.push("body="+i);d=d.length?"?"+d.join("&"):"";"encode"==a?(a=["javascript:void(location.href='mailto:'+",n(e)],d&&a.push("+'",m(d),"'"),a.push(")")):a=["mailto:",e,d];break;default:a=e.split("@",2),d.name=a[0],d.domain=a[1],a=["javascript:",o(c,d)]}f["data-cke-saved-href"]=a.join("")}if(b.target)if("popup"==b.target.type){for(var a=["window.open(this.href, '",b.target.name||"","', '"],h="resizable status location toolbar menubar fullscreen scrollbars dependent".split(" "),e=h.length,g=function(a){b.target[a]&&h.push(a+"="+b.target[a])},d=0;d<e;d++)h[d]+=b.target[h[d]]?"=yes":"=no";g("width");g("left");g("height");g("top");a.push(h.join(","),"'); return false;");f["data-cke-pa-onclick"]=a.join("")}else"notSet"!=b.target.type&&b.target.name&&(f.target=b.target.name);if(b.advanced){for(var k in j)(a=b.advanced[j[k]])&&(f[k]=a);f.name&&(f["data-cke-saved-name"]=f.name)}f["data-cke-saved-href"]&&(f.href=f["data-cke-saved-href"]);k=CKEDITOR.tools.extend({target:1,onclick:1,"data-cke-pa-onclick":1,"data-cke-saved-name":1},j);for(var l in f)delete k[l];return{set:f,removed:CKEDITOR.tools.objectKeys(k)}}};CKEDITOR.unlinkCommand=function(){};CKEDITOR.unlinkCommand.prototype={exec:function(c){var b=new CKEDITOR.style({element:"a",type:CKEDITOR.STYLE_INLINE,alwaysRemoveElement:1});c.removeStyle(b)},refresh:function(c,b){var a=b.lastElement&&b.lastElement.getAscendant("a",!0);a&&"a"==a.getName()&&a.getAttribute("href")&&a.getChildCount()?this.setState(CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_DISABLED)},contextSensitive:1,startDisabled:1,requiredContent:"a[href]"};CKEDITOR.removeAnchorCommand=function(){};CKEDITOR.removeAnchorCommand.prototype={exec:function(c){var b=c.getSelection(),a=b.createBookmarks(),f;if(b&&(f=b.getSelectedElement())&&(!f.getChildCount()?CKEDITOR.plugins.link.tryRestoreFakeAnchor(c,f):f.is("a")))f.remove(1);else if(f=CKEDITOR.plugins.link.getSelectedLink(c))f.hasAttribute("href")?(f.removeAttributes({name:1,"data-cke-saved-name":1}),f.removeClass("cke_anchor")):f.remove(1);b.selectBookmarks(a)},requiredContent:"a[name]"};CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:!0,linkShowTargetTab:!0})})();(function(){function E(c,j,e){function b(b){if((d=a[b?"getFirst":"getLast"]())&&(!d.is||!d.isBlockBoundary())&&(m=j.root[b?"getPrevious":"getNext"](CKEDITOR.dom.walker.invisible(!0)))&&(!m.is||!m.isBlockBoundary({br:1})))c.document.createElement("br")[b?"insertBefore":"insertAfter"](d)}for(var k=CKEDITOR.plugins.list.listToArray(j.root,e),g=[],h=0;h<j.contents.length;h++){var f=j.contents[h];if((f=f.getAscendant("li",!0))&&!f.getCustomData("list_item_processed"))g.push(f),CKEDITOR.dom.element.setMarker(e,f,"list_item_processed",!0)}f=null;for(h=0;h<g.length;h++)f=g[h].getCustomData("listarray_index"),k[f].indent=-1;for(h=f+1;h<k.length;h++)if(k[h].indent>k[h-1].indent+1){g=k[h-1].indent+1-k[h].indent;for(f=k[h].indent;k[h]&&k[h].indent>=f;)k[h].indent+=g,h++;h--}var a=CKEDITOR.plugins.list.arrayToList(k,e,null,c.config.enterMode,j.root.getAttribute("dir")).listNode,d,m;b(!0);b();a.replace(j.root);c.fire("contentDomInvalidated")}function x(c,j){this.name=c;this.context=this.type=j;this.allowedContent=j+" li";this.requiredContent=j}function A(c,j,e,b){for(var k,g;k=c[b?"getLast":"getFirst"](F);)(g=k.getDirection(1))!==j.getDirection(1)&&k.setAttribute("dir",g),k.remove(),e?k[b?"insertBefore":"insertAfter"](e):j.append(k,b)}function B(c){var j;(j=function(e){var b=c[e?"getPrevious":"getNext"](q);b&&(b.type==CKEDITOR.NODE_ELEMENT&&b.is(c.getName()))&&(A(c,b,null,!e),c.remove(),c=b)})();j(1)}function C(c){return c.type==CKEDITOR.NODE_ELEMENT&&(c.getName()in CKEDITOR.dtd.$block||c.getName()in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[c.getName()]["#"]}function y(c,j,e){c.fire("saveSnapshot");e.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var b=e.extractContents();j.trim(!1,!0);var k=j.createBookmark(),g=new CKEDITOR.dom.elementPath(j.startContainer),h=g.block,g=g.lastElement.getAscendant("li",1)||h,f=new CKEDITOR.dom.elementPath(e.startContainer),a=f.contains(CKEDITOR.dtd.$listItem),f=f.contains(CKEDITOR.dtd.$list);h?(h=h.getBogus())&&h.remove():f&&(h=f.getPrevious(q))&&v(h)&&h.remove();(h=b.getLast())&&(h.type==CKEDITOR.NODE_ELEMENT&&h.is("br"))&&h.remove();(h=j.startContainer.getChild(j.startOffset))?b.insertBefore(h):j.startContainer.append(b);if(a&&(b=w(a)))g.contains(a)?(A(b,a.getParent(),a),b.remove()):g.append(b);for(;e.checkStartOfBlock()&&e.checkEndOfBlock();){f=e.startPath();b=f.block;if(!b)break;b.is("li")&&(g=b.getParent(),b.equals(g.getLast(q))&&b.equals(g.getFirst(q))&&(b=g));e.moveToPosition(b,CKEDITOR.POSITION_BEFORE_START);b.remove()}e=e.clone();b=c.editable();e.setEndAt(b,CKEDITOR.POSITION_BEFORE_END);e=new CKEDITOR.dom.walker(e);e.evaluator=function(a){return q(a)&&!v(a)};(e=e.next())&&(e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in CKEDITOR.dtd.$list)&&B(e);j.moveToBookmark(k);j.select();c.fire("saveSnapshot")}function w(c){return(c=c.getLast(q))&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in r?c:null}var r={ol:1,ul:1},G=CKEDITOR.dom.walker.whitespaces(),D=CKEDITOR.dom.walker.bookmark(),q=function(c){return!(G(c)||D(c))},v=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(c,j,e,b,k){if(!r[c.getName()])return[];b||(b=0);e||(e=[]);for(var g=0,h=c.getChildCount();g<h;g++){var f=c.getChild(g);f.type==CKEDITOR.NODE_ELEMENT&&f.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(f,j,e,b+1);if("li"==f.$.nodeName.toLowerCase()){var a={parent:c,indent:b,element:f,contents:[]};k?a.grandparent=k:(a.grandparent=c.getParent(),a.grandparent&&"li"==a.grandparent.$.nodeName.toLowerCase()&&(a.grandparent=a.grandparent.getParent()));j&&CKEDITOR.dom.element.setMarker(j,f,"listarray_index",e.length);e.push(a);for(var d=0,m=f.getChildCount(),i;d<m;d++)i=f.getChild(d),i.type==CKEDITOR.NODE_ELEMENT&&r[i.getName()]?CKEDITOR.plugins.list.listToArray(i,j,e,b+1,a.grandparent):a.contents.push(i)}}return e},arrayToList:function(c,j,e,b,k){e||(e=0);if(!c||c.length<e+1)return null;for(var g,h=c[e].parent.getDocument(),f=new CKEDITOR.dom.documentFragment(h),a=null,d=e,m=Math.max(c[e].indent,0),i=null,n,l,p=b==CKEDITOR.ENTER_P?"p":"div";;){var o=c[d];g=o.grandparent;n=o.element.getDirection(1);if(o.indent==m){if(!a||c[d].parent.getName()!=a.getName())a=c[d].parent.clone(!1,1),k&&a.setAttribute("dir",k),f.append(a);i=a.append(o.element.clone(0,1));n!=a.getDirection(1)&&i.setAttribute("dir",n);for(g=0;g<o.contents.length;g++)i.append(o.contents[g].clone(1,1));d++}else if(o.indent==Math.max(m,0)+1)o=c[d-1].element.getDirection(1),d=CKEDITOR.plugins.list.arrayToList(c,null,d,b,o!=n?n:null),!i.getChildCount()&&(CKEDITOR.env.needsNbspFiller&&!(7<h.$.documentMode))&&i.append(h.createText(" ")),i.append(d.listNode),d=d.nextIndex;else if(-1==o.indent&&!e&&g){r[g.getName()]?(i=o.element.clone(!1,!0),n!=g.getDirection(1)&&i.setAttribute("dir",n)):i=new CKEDITOR.dom.documentFragment(h);var a=g.getDirection(1)!=n,u=o.element,z=u.getAttribute("class"),v=u.getAttribute("style"),w=i.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(b!=CKEDITOR.ENTER_BR||a||v||z),s,x=o.contents.length,t;for(g=0;g<x;g++)if(s=o.contents[g],D(s)&&1<x)w?t=s.clone(1,1):i.append(s.clone(1,1));else if(s.type==CKEDITOR.NODE_ELEMENT&&s.isBlockBoundary()){a&&!s.getDirection()&&s.setAttribute("dir",n);l=s;var y=u.getAttribute("style");y&&l.setAttribute("style",y.replace(/([^;])$/,"$1;")+(l.getAttribute("style")||""));z&&s.addClass(z);l=null;t&&(i.append(t),t=null);i.append(s.clone(1,1))}else w?(l||(l=h.createElement(p),i.append(l),a&&l.setAttribute("dir",n)),v&&l.setAttribute("style",v),z&&l.setAttribute("class",z),t&&(l.append(t),t=null),l.append(s.clone(1,1))):i.append(s.clone(1,1));t&&((l||i).append(t),t=null);i.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&d!=c.length-1&&(CKEDITOR.env.needsBrFiller&&(n=i.getLast())&&(n.type==CKEDITOR.NODE_ELEMENT&&n.is("br"))&&n.remove(),n=i.getLast(q),(!n||!(n.type==CKEDITOR.NODE_ELEMENT&&n.is(CKEDITOR.dtd.$block)))&&i.append(h.createElement("br")));n=i.$.nodeName.toLowerCase();("div"==n||"p"==n)&&i.appendBogus();f.append(i);a=null;d++}else return null;l=null;if(c.length<=d||Math.max(c[d].indent,0)<m)break}if(j)for(c=f.getFirst();c;){if(c.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(j,c),c.getName()in
CKEDITOR.dtd.$listItem&&(e=c,h=k=b=void 0,b=e.getDirection()))){for(k=e.getParent();k&&!(h=k.getDirection());)k=k.getParent();b==h&&e.removeAttribute("dir")}c=c.getNextSourceNode()}return{listNode:f,nextIndex:d}}};var H=/^h[1-6]$/,F=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);x.prototype={exec:function(c){this.refresh(c,c.elementPath());var j=c.config,e=c.getSelection(),b=e&&e.getRanges();if(this.state==CKEDITOR.TRISTATE_OFF){var k=c.editable();if(k.getFirst(q)){var g=1==b.length&&b[0];(j=g&&g.getEnclosedNode())&&(j.is&&this.type==j.getName())&&this.setState(CKEDITOR.TRISTATE_ON)}else j.enterMode==CKEDITOR.ENTER_BR?k.appendBogus():b[0].fixBlock(1,j.enterMode==CKEDITOR.ENTER_P?"p":"div"),e.selectRanges(b)}for(var j=e.createBookmarks(!0),k=[],h={},b=b.createIterator(),f=0;(g=b.getNextRange())&&++f;){var a=g.getBoundaryNodes(),d=a.startNode,m=a.endNode;d.type==CKEDITOR.NODE_ELEMENT&&"td"==d.getName()&&g.setStartAt(a.startNode,CKEDITOR.POSITION_AFTER_START);m.type==CKEDITOR.NODE_ELEMENT&&"td"==m.getName()&&g.setEndAt(a.endNode,CKEDITOR.POSITION_BEFORE_END);g=g.createIterator();for(g.forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;a=g.getNextParagraph();)if(!a.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(h,a,"list_block",1);for(var i=c.elementPath(a),d=i.elements,m=0,i=i.blockLimit,n,l=d.length-1;0<=l&&(n=d[l]);l--)if(r[n.getName()]&&i.contains(n)){i.removeCustomData("list_group_object_"+f);(d=n.getCustomData("list_group_object"))?d.contents.push(a):(d={root:n,contents:[a]},k.push(d),CKEDITOR.dom.element.setMarker(h,n,"list_group_object",d));m=1;break}m||(m=i,m.getCustomData("list_group_object_"+f)?m.getCustomData("list_group_object_"+f).contents.push(a):(d={root:m,contents:[a]},CKEDITOR.dom.element.setMarker(h,m,"list_group_object_"+f,d),k.push(d)))}}for(n=[];0<k.length;)if(d=k.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(r[d.root.getName()]){b=c;f=d;d=h;g=n;m=CKEDITOR.plugins.list.listToArray(f.root,d);i=[];for(a=0;a<f.contents.length;a++)if(l=f.contents[a],(l=l.getAscendant("li",!0))&&!l.getCustomData("list_item_processed"))i.push(l),CKEDITOR.dom.element.setMarker(d,l,"list_item_processed",!0);for(var l=f.root.getDocument(),p=void 0,o=void 0,a=0;a<i.length;a++){var u=i[a].getCustomData("listarray_index"),p=m[u].parent;p.is(this.type)||(o=l.createElement(this.type),p.copyAttributes(o,{start:1,type:1}),o.removeStyle("list-style-type"),m[u].parent=o)}d=CKEDITOR.plugins.list.arrayToList(m,d,null,b.config.enterMode);m=void 0;i=d.listNode.getChildCount();for(a=0;a<i&&(m=d.listNode.getChild(a));a++)m.getName()==this.type&&g.push(m);d.listNode.replace(f.root);b.fire("contentDomInvalidated")}else{m=c;a=d;g=n;i=a.contents;b=a.root.getDocument();f=[];1==i.length&&i[0].equals(a.root)&&(d=b.createElement("div"),i[0].moveChildren&&i[0].moveChildren(d),i[0].append(d),i[0]=d);a=a.contents[0].getParent();for(l=0;l<i.length;l++)a=a.getCommonAncestor(i[l].getParent());p=m.config.useComputedState;m=d=void 0;p=void 0===p||p;for(l=0;l<i.length;l++)for(o=i[l];u=o.getParent();){if(u.equals(a)){f.push(o);!m&&o.getDirection()&&(m=1);o=o.getDirection(p);null!==d&&(d=d&&d!=o?null:o);break}o=u}if(!(1>f.length)){i=f[f.length-1].getNext();l=b.createElement(this.type);g.push(l);for(p=g=void 0;f.length;)g=f.shift(),p=b.createElement("li"),g.is("pre")||H.test(g.getName())||"false"==g.getAttribute("contenteditable")?g.appendTo(p):(g.copyAttributes(p),d&&g.getDirection()&&(p.removeStyle("direction"),p.removeAttribute("dir")),g.moveChildren(p),g.remove()),p.appendTo(l);d&&m&&l.setAttribute("dir",d);i?l.insertBefore(i):l.appendTo(a)}}else this.state==CKEDITOR.TRISTATE_ON&&r[d.root.getName()]&&E.call(this,c,d,h);for(l=0;l<n.length;l++)B(n[l]);CKEDITOR.dom.element.clearAllMarkers(h);e.selectBookmarks(j);c.focus()},refresh:function(c,j){var e=j.contains(r,1),b=j.blockLimit||j.root;e&&b.contains(e)?this.setState(e.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_OFF)}};CKEDITOR.plugins.add("list",{requires:"indentlist",init:function(c){c.blockless||(c.addCommand("numberedlist",new x("numberedlist","ol")),c.addCommand("bulletedlist",new x("bulletedlist","ul")),c.ui.addButton&&(c.ui.addButton("NumberedList",{label:c.lang.list.numberedlist,command:"numberedlist",directional:!0,toolbar:"list,10"}),c.ui.addButton("BulletedList",{label:c.lang.list.bulletedlist,command:"bulletedlist",directional:!0,toolbar:"list,20"})),c.on("key",function(j){var e=j.data.domEvent.getKey();if(c.mode=="wysiwyg"&&e in{8:1,46:1}){var b=c.getSelection().getRanges()[0],k=b&&b.startPath();if(b&&b.collapsed){var g=e==8,h=c.editable(),f=new CKEDITOR.dom.walker(b.clone());f.evaluator=function(a){return q(a)&&!v(a)};f.guard=function(a,b){return!(b&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("table"))};e=b.clone();if(g){var a,d;if((a=k.contains(r))&&b.checkBoundaryOfElement(a,CKEDITOR.START)&&(a=a.getParent())&&a.is("li")&&(a=w(a))){d=a;a=a.getPrevious(q);e.moveToPosition(a&&v(a)?a:d,CKEDITOR.POSITION_BEFORE_START)}else{f.range.setStartAt(h,CKEDITOR.POSITION_AFTER_START);f.range.setEnd(b.startContainer,b.startOffset);if((a=f.previous())&&a.type==CKEDITOR.NODE_ELEMENT&&(a.getName()in
r||a.is("li"))){if(!a.is("li")){f.range.selectNodeContents(a);f.reset();f.evaluator=C;a=f.previous()}d=a;e.moveToElementEditEnd(d)}}if(d){y(c,e,b);j.cancel()}else if((e=k.contains(r))&&b.checkBoundaryOfElement(e,CKEDITOR.START)){d=e.getFirst(q);if(b.checkBoundaryOfElement(d,CKEDITOR.START)){a=e.getPrevious(q);if(w(d)){if(a){b.moveToElementEditEnd(a);b.select()}}else c.execCommand("outdent");j.cancel()}}}else if(d=k.contains("li")){f.range.setEndAt(h,CKEDITOR.POSITION_BEFORE_END);h=(k=d.getLast(q))&&C(k)?k:d;d=0;if((a=f.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in r&&a.equals(k)){d=1;a=f.next()}else b.checkBoundaryOfElement(h,CKEDITOR.END)&&(d=1);if(d&&a){b=b.clone();b.moveToElementEditStart(a);y(c,e,b);j.cancel()}}else{f.range.setEndAt(h,CKEDITOR.POSITION_BEFORE_END);if((a=f.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is(r)){a=a.getFirst(q);if(k.block&&b.checkStartOfBlock()&&b.checkEndOfBlock()){k.block.remove();b.moveToElementEditStart(a);b.select()}else if(w(a)){b.moveToElementEditStart(a);b.select()}else{b=b.clone();b.moveToElementEditStart(a);y(c,e,b)}j.cancel()}}setTimeout(function(){c.selectionChange(1)})}}}))}})})();(function(){CKEDITOR.plugins.liststyle={requires:"dialog,contextmenu",init:function(a){if(!a.blockless){var b;b=new CKEDITOR.dialogCommand("numberedListStyle",{requiredContent:"ol",allowedContent:"ol{list-style-type}[start]"});b=a.addCommand("numberedListStyle",b);a.addFeature(b);CKEDITOR.dialog.add("numberedListStyle",this.path+"dialogs/liststyle.js");b=new CKEDITOR.dialogCommand("bulletedListStyle",{requiredContent:"ul",allowedContent:"ul{list-style-type}"});b=a.addCommand("bulletedListStyle",b);a.addFeature(b);CKEDITOR.dialog.add("bulletedListStyle",this.path+"dialogs/liststyle.js");a.addMenuGroup("list",108);a.addMenuItems({numberedlist:{label:a.lang.liststyle.numberedTitle,group:"list",command:"numberedListStyle"},bulletedlist:{label:a.lang.liststyle.bulletedTitle,group:"list",command:"bulletedListStyle"}});a.contextMenu.addListener(function(a){if(!a||a.isReadOnly())return null;for(;a;){var b=a.getName();if("ol"==b)return{numberedlist:CKEDITOR.TRISTATE_OFF};if("ul"==b)return{bulletedlist:CKEDITOR.TRISTATE_OFF};a=a.getParent()}return null})}}};CKEDITOR.plugins.add("liststyle",CKEDITOR.plugins.liststyle)})();(function(){function Q(a,c,d){return m(c)&&m(d)&&d.equals(c.getNext(function(a){return!(z(a)||A(a)||p(a))}))}function u(a){this.upper=a[0];this.lower=a[1];this.set.apply(this,a.slice(2))}function J(a){var c=a.element;if(c&&m(c)&&(c=c.getAscendant(a.triggers,!0))&&a.editable.contains(c)){var d=K(c);if("true"==d.getAttribute("contenteditable"))return c;if(d.is(a.triggers))return d}return null}function ga(a,c,d){o(a,c);o(a,d);a=c.size.bottom;d=d.size.top;return a&&d?0|(a+d)/2:a||d}function r(a,c,d){return c=c[d?"getPrevious":"getNext"](function(b){return b&&b.type==CKEDITOR.NODE_TEXT&&!z(b)||m(b)&&!p(b)&&!v(a,b)})}function K(a,c){if(a.data("cke-editable"))return null;for(c||(a=a.getParent());a&&!a.data("cke-editable");){if(a.hasAttribute("contenteditable"))return a;a=a.getParent()}return null}function ha(a){var c=a.doc,d=B('<span contenteditable="false" style="'+L+"position:absolute;border-top:1px dashed "+a.boxColor+'"></span>',c),b=CKEDITOR.getUrl(this.path+"images/"+(n.hidpi?"hidpi/":"")+"icon"+(a.rtl?"-rtl":"")+".png");q(d,{attach:function(){this.wrap.getParent()||this.wrap.appendTo(a.editable,!0);return this},lineChildren:[q(B('<span title="'+a.editor.lang.magicline.title+'" contenteditable="false">&#8629;</span>',c),{base:L+"height:17px;width:17px;"+(a.rtl?"left":"right")+":17px;background:url("+b+") center no-repeat "+a.boxColor+";cursor:pointer;"+(n.hc?"font-size: 15px;line-height:14px;border:1px solid #fff;text-align:center;":"")+(n.hidpi?"background-size: 9px 10px;":""),looks:["top:-8px;"+
CKEDITOR.tools.cssVendorPrefix("border-radius","2px",1),"top:-17px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","2px 2px 0px 0px",1),"top:-1px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","0px 0px 2px 2px",1)]}),q(B(R,c),{base:S+"left:0px;border-left-color:"+a.boxColor+";",looks:["border-width:8px 0 8px 8px;top:-8px","border-width:8px 0 0 8px;top:-8px","border-width:0 0 8px 8px;top:0px"]}),q(B(R,c),{base:S+"right:0px;border-right-color:"+a.boxColor+";",looks:["border-width:8px 8px 8px 0;top:-8px","border-width:8px 8px 0 0;top:-8px","border-width:0 8px 8px 0;top:0px"]})],detach:function(){this.wrap.getParent()&&this.wrap.remove();return this},mouseNear:function(){o(a,this);var b=a.holdDistance,c=this.size;return c&&a.mouse.y>c.top-b&&a.mouse.y<c.bottom+b&&a.mouse.x>c.left-b&&a.mouse.x<c.right+b?!0:!1},place:function(){var b=a.view,c=a.editable,d=a.trigger,i=d.upper,h=d.lower,j=i||h,l=j.getParent(),k={};this.trigger=d;i&&o(a,i,!0);h&&o(a,h,!0);o(a,l,!0);a.inInlineMode&&C(a,!0);l.equals(c)?(k.left=b.scroll.x,k.right=-b.scroll.x,k.width=""):(k.left=j.size.left-j.size.margin.left+b.scroll.x-(a.inInlineMode?b.editable.left+b.editable.border.left:0),k.width=j.size.outerWidth+j.size.margin.left+j.size.margin.right+b.scroll.x,k.right="");i&&h?k.top=i.size.margin.bottom===h.size.margin.top?0|i.size.bottom+i.size.margin.bottom/2:i.size.margin.bottom<h.size.margin.top?i.size.bottom+i.size.margin.bottom:i.size.bottom+i.size.margin.bottom-h.size.margin.top:i?h||(k.top=i.size.bottom+i.size.margin.bottom):k.top=h.size.top-h.size.margin.top;d.is(x)||k.top>b.scroll.y-15&&k.top<b.scroll.y+5?(k.top=a.inInlineMode?0:b.scroll.y,this.look(x)):d.is(y)||k.top>b.pane.bottom-5&&k.top<b.pane.bottom+15?(k.top=a.inInlineMode?b.editable.height+b.editable.padding.top+b.editable.padding.bottom:b.pane.bottom-1,this.look(y)):(a.inInlineMode&&(k.top-=b.editable.top+b.editable.border.top),this.look(s));a.inInlineMode&&(k.top--,k.top+=b.editable.scroll.top,k.left+=b.editable.scroll.left);for(var T in k)k[T]=CKEDITOR.tools.cssLength(k[T]);this.setStyles(k)},look:function(a){if(this.oldLook!=a){for(var b=this.lineChildren.length,c;b--;)(c=this.lineChildren[b]).setAttribute("style",c.base+c.looks[0|a/2]);this.oldLook=a}},wrap:new M("span",a.doc)});for(c=d.lineChildren.length;c--;)d.lineChildren[c].appendTo(d);d.look(s);d.appendTo(d.wrap);d.unselectable();d.lineChildren[0].on("mouseup",function(b){d.detach();N(a,function(b){var c=a.line.trigger;b[c.is(D)?"insertBefore":"insertAfter"](c.is(D)?c.lower:c.upper)},!0);a.editor.focus();!n.ie&&a.enterMode!=CKEDITOR.ENTER_BR&&a.hotNode.scrollIntoView();b.data.preventDefault(!0)});d.on("mousedown",function(a){a.data.preventDefault(!0)});a.line=d}function N(a,c,d){var b=new CKEDITOR.dom.range(a.doc),e=a.editor,f;n.ie&&a.enterMode==CKEDITOR.ENTER_BR?f=a.doc.createText(E):(f=(f=K(a.element,!0))&&f.data("cke-enter-mode")||a.enterMode,f=new M(F[f],a.doc),f.is("br")||a.doc.createText(E).appendTo(f));d&&e.fire("saveSnapshot");c(f);b.moveToPosition(f,CKEDITOR.POSITION_AFTER_START);e.getSelection().selectRanges([b]);a.hotNode=f;d&&e.fire("saveSnapshot")}function U(a,c){return{canUndo:!0,modes:{wysiwyg:1},exec:function(){function d(b){var d=n.ie&&9>n.version?" ":E,f=a.hotNode&&a.hotNode.getText()==d&&a.element.equals(a.hotNode)&&a.lastCmdDirection===!!c;N(a,function(d){f&&a.hotNode&&a.hotNode.remove();d[c?"insertAfter":"insertBefore"](b);d.setAttributes({"data-cke-magicline-hot":1,"data-cke-magicline-dir":!!c});a.lastCmdDirection=!!c});!n.ie&&a.enterMode!=CKEDITOR.ENTER_BR&&a.hotNode.scrollIntoView();a.line.detach()}
return function(b){var b=b.getSelection().getStartElement(),e,b=b.getAscendant(V,1);if(!W(a,b)&&b&&!b.equals(a.editable)&&!b.contains(a.editable)){if((e=K(b))&&"false"==e.getAttribute("contenteditable"))b=e;a.element=b;e=r(a,b,!c);var f;m(e)&&e.is(a.triggers)&&e.is(ia)&&(!r(a,e,!c)||(f=r(a,e,!c))&&m(f)&&f.is(a.triggers))?d(e):(f=J(a,b),m(f)&&(r(a,f,!c)?(b=r(a,f,!c))&&(m(b)&&b.is(a.triggers))&&d(f):d(f)))}}}()}}function v(a,c){if(!c||!(c.type==CKEDITOR.NODE_ELEMENT&&c.$))return!1;var d=a.line;return d.wrap.equals(c)||d.wrap.contains(c)}function m(a){return a&&a.type==CKEDITOR.NODE_ELEMENT&&a.$}function p(a){if(!m(a))return!1;var c;if(!(c=X(a)))m(a)?(c={left:1,right:1,center:1},c=!(!c[a.getComputedStyle("float")]&&!c[a.getAttribute("align")])):c=!1;return c}function X(a){return!!{absolute:1,fixed:1}[a.getComputedStyle("position")]}function G(a,c){return m(c)?c.is(a.triggers):null}function W(a,c){if(!c)return!1;for(var d=c.getParents(1),b=d.length;b--;)for(var e=a.tabuList.length;e--;)if(d[b].hasAttribute(a.tabuList[e]))return!0;return!1}function ja(a,c,d){c=c[d?"getLast":"getFirst"](function(b){return a.isRelevant(b)&&!b.is(ka)});if(!c)return!1;o(a,c);return d?c.size.top>a.mouse.y:c.size.bottom<a.mouse.y}function Y(a){var c=a.editable,d=a.mouse,b=a.view,e=a.triggerOffset;C(a);var f=d.y>(a.inInlineMode?b.editable.top+b.editable.height/2:Math.min(b.editable.height,b.pane.height)/2),c=c[f?"getLast":"getFirst"](function(a){return!(z(a)||A(a))});if(!c)return null;v(a,c)&&(c=a.line.wrap[f?"getPrevious":"getNext"](function(a){return!(z(a)||A(a))}));if(!m(c)||p(c)||!G(a,c))return null;o(a,c);return!f&&0<=c.size.top&&0<d.y&&d.y<c.size.top+e?(a=a.inInlineMode||0===b.scroll.y?x:s,new u([null,c,D,H,a])):f&&c.size.bottom<=b.pane.height&&d.y>c.size.bottom-e&&d.y<b.pane.height?(a=a.inInlineMode||c.size.bottom>b.pane.height-e&&c.size.bottom<b.pane.height?y:s,new u([c,null,Z,H,a])):null}function $(a){var c=a.mouse,d=a.view,b=a.triggerOffset,e=J(a);if(!e)return null;o(a,e);var b=Math.min(b,0|e.size.outerHeight/2),f=[],g,i;if(c.y>e.size.top-1&&c.y<e.size.top+b)i=!1;else if(c.y>e.size.bottom-b&&c.y<e.size.bottom+1)i=!0;else return null;if(p(e)||ja(a,e,i)||e.getParent().is(aa))return null;var h=r(a,e,!i);if(h){if(h&&h.type==CKEDITOR.NODE_TEXT)return null;if(m(h)){if(p(h)||!G(a,h)||h.getParent().is(aa))return null;f=[h,e][i?"reverse":"concat"]().concat([O,H])}}else e.equals(a.editable[i?"getLast":"getFirst"](a.isRelevant))?(C(a),i&&c.y>e.size.bottom-b&&c.y<d.pane.height&&e.size.bottom>d.pane.height-b&&e.size.bottom<d.pane.height?g=y:0<c.y&&c.y<e.size.top+b&&(g=x)):g=s,f=[null,e][i?"reverse":"concat"]().concat([i?Z:D,H,g,e.equals(a.editable[i?"getLast":"getFirst"](a.isRelevant))?i?y:x:s]);return 0 in f?new u(f):null}function P(a,c,d,b){for(var e=function(){var b=n.ie?c.$.currentStyle:a.win.$.getComputedStyle(c.$,"");return n.ie?function(a){return b[CKEDITOR.tools.cssStyleToDomStyle(a)]}:function(a){return b.getPropertyValue(a)}}(),f=c.getDocumentPosition(),g={},i={},h={},j={},l=t.length;l--;)g[t[l]]=parseInt(e("border-"+t[l]+"-width"),10)||0,h[t[l]]=parseInt(e("padding-"+t[l]),10)||0,i[t[l]]=parseInt(e("margin-"+t[l]),10)||0;(!d||b)&&I(a,b);j.top=f.y-(d?0:a.view.scroll.y);j.left=f.x-(d?0:a.view.scroll.x);j.outerWidth=c.$.offsetWidth;j.outerHeight=c.$.offsetHeight;j.height=j.outerHeight-(h.top+h.bottom+g.top+g.bottom);j.width=j.outerWidth-(h.left+h.right+g.left+g.right);j.bottom=j.top+j.outerHeight;j.right=j.left+j.outerWidth;a.inInlineMode&&(j.scroll={top:c.$.scrollTop,left:c.$.scrollLeft});return q({border:g,padding:h,margin:i,ignoreScroll:d},j,!0)}function o(a,c,d){if(!m(c))return c.size=null;if(c.size){if(c.size.ignoreScroll==d&&c.size.date>new Date-ba)return null}else c.size={};return q(c.size,P(a,c,d),{date:+new Date},!0)}function C(a,c){a.view.editable=P(a,a.editable,c,!0)}function I(a,c){a.view||(a.view={});var d=a.view;if(c||!(d&&d.date>new Date-ba)){var b=a.win,d=b.getScrollPosition(),b=b.getViewPaneSize();q(a.view,{scroll:{x:d.x,y:d.y,width:a.doc.$.documentElement.scrollWidth-b.width,height:a.doc.$.documentElement.scrollHeight-
b.height},pane:{width:b.width,height:b.height,bottom:b.height+d.y},date:+new Date},!0)}}function la(a,c,d,b){for(var e=b,f=b,g=0,i=!1,h=!1,j=a.view.pane.height,l=a.mouse;l.y+g<j&&0<l.y-g;){i||(i=c(e,b));h||(h=c(f,b));!i&&0<l.y-g&&(e=d(a,{x:l.x,y:l.y-g}));!h&&l.y+g<j&&(f=d(a,{x:l.x,y:l.y+g}));if(i&&h)break;g+=2}return new u([e,f,null,null])}CKEDITOR.plugins.add("magicline",{init:function(a){var c=a.config,d=c.magicline_triggerOffset||30,b={editor:a,enterMode:c.enterMode,triggerOffset:d,holdDistance:0|d*(c.magicline_holdDistance||0.5),boxColor:c.magicline_color||"#ff0000",rtl:"rtl"==c.contentsLangDirection,tabuList:["data-cke-hidden-sel"].concat(c.magicline_tabuList||[]),triggers:c.magicline_everywhere?V:{table:1,hr:1,div:1,ul:1,ol:1,dl:1,form:1,blockquote:1}},e,f,g;b.isRelevant=function(a){return m(a)&&!v(b,a)&&!p(a)};a.on("contentDom",function(){var d=a.editable(),h=a.document,j=a.window;q(b,{editable:d,inInlineMode:d.isInline(),doc:h,win:j,hotNode:null},!0);b.boundary=b.inInlineMode?b.editable:b.doc.getDocumentElement();d.is(w.$inline)||(b.inInlineMode&&!X(d)&&d.setStyles({position:"relative",top:null,left:null}),ha.call(this,b),I(b),d.attachListener(a,"beforeUndoImage",function(){b.line.detach()}),d.attachListener(a,"beforeGetData",function(){b.line.wrap.getParent()&&(b.line.detach(),a.once("getData",function(){b.line.attach()},null,null,1E3))},null,null,0),d.attachListener(b.inInlineMode?h:h.getWindow().getFrame(),"mouseout",function(c){if("wysiwyg"==a.mode)if(b.inInlineMode){var d=c.data.$.clientX,c=c.data.$.clientY;I(b);C(b,!0);var e=b.view.editable,f=b.view.scroll;if(!(d>e.left-f.x&&d<e.right-f.x)||!(c>e.top-f.y&&c<e.bottom-f.y))clearTimeout(g),g=null,b.line.detach()}else clearTimeout(g),g=null,b.line.detach()}),d.attachListener(d,"keyup",function(){b.hiddenMode=0}),d.attachListener(d,"keydown",function(c){if("wysiwyg"==a.mode)switch(c=c.data.getKeystroke(),a.getSelection().getStartElement(),c){case 2228240:case 16:b.hiddenMode=1,b.line.detach()}}),d.attachListener(b.inInlineMode?d:h,"mousemove",function(c){f=!0;if(!("wysiwyg"!=a.mode||a.readOnly||g)){var d={x:c.data.$.clientX,y:c.data.$.clientY};g=setTimeout(function(){b.mouse=d;g=b.trigger=null;I(b);if(f&&!b.hiddenMode&&a.focusManager.hasFocus&&!b.line.mouseNear()&&(b.element=ca(b,!0)))(b.trigger=Y(b)||$(b)||da(b))&&!W(b,b.trigger.upper||b.trigger.lower)?b.line.attach().place():(b.trigger=null,b.line.detach()),f=!1},30)}}),d.attachListener(j,"scroll",function(){"wysiwyg"==a.mode&&(b.line.detach(),n.webkit&&(b.hiddenMode=1,clearTimeout(e),e=setTimeout(function(){b.mouseDown||(b.hiddenMode=0)},50)))}),d.attachListener(ea?h:j,"mousedown",function(){"wysiwyg"==a.mode&&(b.line.detach(),b.hiddenMode=1,b.mouseDown=1)}),d.attachListener(ea?h:j,"mouseup",function(){b.hiddenMode=0;b.mouseDown=0}),a.addCommand("accessPreviousSpace",U(b)),a.addCommand("accessNextSpace",U(b,!0)),a.setKeystroke([[c.magicline_keystrokePrevious,"accessPreviousSpace"],[c.magicline_keystrokeNext,"accessNextSpace"]]),a.on("loadSnapshot",function(){var c,d,e,f;for(f in{p:1,br:1,div:1}){c=a.document.getElementsByTag(f);for(e=c.count();e--;)if((d=c.getItem(e)).data("cke-magicline-hot")){b.hotNode=d;b.lastCmdDirection="true"===d.data("cke-magicline-dir")?!0:!1;return}}}),this.backdoor={accessFocusSpace:N,boxTrigger:u,isLine:v,getAscendantTrigger:J,getNonEmptyNeighbour:r,getSize:P,that:b,triggerEdge:$,triggerEditable:Y,triggerExpand:da})},this)}});var q=CKEDITOR.tools.extend,M=CKEDITOR.dom.element,B=M.createFromHtml,n=CKEDITOR.env,ea=CKEDITOR.env.ie&&9>CKEDITOR.env.version,w=CKEDITOR.dtd,F={},D=128,Z=64,O=32,H=16,fa=8,x=4,y=2,s=1,E=" ",aa=w.$listItem,ka=w.$tableContent,ia=q({},w.$nonEditable,w.$empty),V=w.$block,ba=100,L="width:0px;height:0px;padding:0px;margin:0px;display:block;z-index:9999;color:#fff;position:absolute;font-size: 0px;line-height:0px;",S=L+"border-color:transparent;display:block;border-style:solid;",R="<span>"+E+"</span>";F[CKEDITOR.ENTER_BR]="br";F[CKEDITOR.ENTER_P]="p";F[CKEDITOR.ENTER_DIV]="div";u.prototype={set:function(a,c,d){this.properties=a+
c+(d||s);return this},is:function(a){return(this.properties&a)==a}};var ca=function(){function a(a,d){var b=a.$.elementFromPoint(d.x,d.y);return b&&b.nodeType?new CKEDITOR.dom.element(b):null}return function(c,d,b){if(!c.mouse)return null;var e=c.doc,f=c.line.wrap,b=b||c.mouse,g=a(e,b);d&&v(c,g)&&(f.hide(),g=a(e,b),f.show());return!g||!(g.type==CKEDITOR.NODE_ELEMENT&&g.$)||n.ie&&9>n.version&&!c.boundary.equals(g)&&!c.boundary.contains(g)?null:g}}(),z=CKEDITOR.dom.walker.whitespaces(),A=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_COMMENT),da=function(){function a(a){var b=a.element,e,f,g;if(!m(b)||b.contains(a.editable)||b.isReadOnly())return null;g=la(a,function(a,b){return!b.equals(a)},function(a,b){return ca(a,!0,b)},b);e=g.upper;f=g.lower;if(Q(a,e,f))return g.set(O,fa);if(e&&b.contains(e))for(;!e.getParent().equals(b);)e=e.getParent();else e=b.getFirst(function(b){return c(a,b)});if(f&&b.contains(f))for(;!f.getParent().equals(b);)f=f.getParent();else f=b.getLast(function(b){return c(a,b)});if(!e||!f)return null;o(a,e);o(a,f);if(!(a.mouse.y>e.size.top&&a.mouse.y<f.size.bottom))return null;for(var b=Number.MAX_VALUE,i,h,j,l;f&&!f.equals(e)&&(h=e.getNext(a.isRelevant));)i=Math.abs(ga(a,e,h)-a.mouse.y),i<b&&(b=i,j=e,l=h),e=h,o(a,e);if(!j||!l||!(a.mouse.y>j.size.top&&a.mouse.y<l.size.bottom))return null;g.upper=j;g.lower=l;return g.set(O,fa)}function c(a,b){return!(b&&b.type==CKEDITOR.NODE_TEXT||A(b)||p(b)||v(a,b)||b.type==CKEDITOR.NODE_ELEMENT&&b.$&&b.is("br"))}return function(c){var b=a(c),e;if(e=b){e=b.upper;var f=b.lower;e=!e||!f||p(f)||p(e)||f.equals(e)||e.equals(f)||f.contains(e)||e.contains(f)?!1:G(c,e)&&G(c,f)&&Q(c,e,f)?!0:!1}return e?b:null}}(),t=["top","left","right","bottom"]})();CKEDITOR.config.magicline_keystrokePrevious=CKEDITOR.CTRL+CKEDITOR.SHIFT+51;CKEDITOR.config.magicline_keystrokeNext=CKEDITOR.CTRL+CKEDITOR.SHIFT+52;(function(){function l(a){if(!a||a.type!=CKEDITOR.NODE_ELEMENT||"form"!=a.getName())return[];for(var e=[],f=["style","className"],b=0;b<f.length;b++){var d=a.$.elements.namedItem(f[b]);d&&(d=new CKEDITOR.dom.element(d),e.push([d,d.nextSibling]),d.remove())}return e}function o(a,e){if(a&&!(a.type!=CKEDITOR.NODE_ELEMENT||"form"!=a.getName())&&0<e.length)for(var f=e.length-1;0<=f;f--){var b=e[f][0],d=e[f][1];d?b.insertBefore(d):b.appendTo(a)}}function n(a,e){var f=l(a),b={},d=a.$;e||(b["class"]=d.className||"",d.className="");b.inline=d.style.cssText||"";e||(d.style.cssText="position: static; overflow: visible");o(f);return b}function p(a,e){var f=l(a),b=a.$;"class"in e&&(b.className=e["class"]);"inline"in e&&(b.style.cssText=e.inline);o(f)}function q(a){if(!a.editable().isInline()){var e=CKEDITOR.instances,f;for(f in e){var b=e[f];"wysiwyg"==b.mode&&!b.readOnly&&(b=b.document.getBody(),b.setAttribute("contentEditable",!1),b.setAttribute("contentEditable",!0))}a.editable().hasFocus&&(a.toolbox.focus(),a.focus())}}CKEDITOR.plugins.add("maximize",{init:function(a){function e(){var b=d.getViewPaneSize();a.resize(b.width,b.height,null,!0)}if(a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var f=a.lang,b=CKEDITOR.document,d=b.getWindow(),j,k,m,l=CKEDITOR.TRISTATE_OFF;a.addCommand("maximize",{modes:{wysiwyg:!CKEDITOR.env.iOS,source:!CKEDITOR.env.iOS},readOnly:1,editorFocus:!1,exec:function(){var h=a.container.getFirst(function(a){return a.type==CKEDITOR.NODE_ELEMENT&&a.hasClass("cke_inner")}),g=a.ui.space("contents");if("wysiwyg"==a.mode){var c=a.getSelection();j=c&&c.getRanges();k=d.getScrollPosition()}else{var i=a.editable().$;j=!CKEDITOR.env.ie&&[i.selectionStart,i.selectionEnd];k=[i.scrollLeft,i.scrollTop]}if(this.state==CKEDITOR.TRISTATE_OFF){d.on("resize",e);m=d.getScrollPosition();for(c=a.container;c=c.getParent();)c.setCustomData("maximize_saved_styles",n(c)),c.setStyle("z-index",a.config.baseFloatZIndex-5);g.setCustomData("maximize_saved_styles",n(g,!0));h.setCustomData("maximize_saved_styles",n(h,!0));g={overflow:CKEDITOR.env.webkit?"":"hidden",width:0,height:0};b.getDocumentElement().setStyles(g);!CKEDITOR.env.gecko&&b.getDocumentElement().setStyle("position","fixed");(!CKEDITOR.env.gecko||!CKEDITOR.env.quirks)&&b.getBody().setStyles(g);CKEDITOR.env.ie?setTimeout(function(){d.$.scrollTo(0,0)},0):d.$.scrollTo(0,0);h.setStyle("position",CKEDITOR.env.gecko&&CKEDITOR.env.quirks?"fixed":"absolute");h.$.offsetLeft;h.setStyles({"z-index":a.config.baseFloatZIndex-5,left:"0px",top:"0px"});h.addClass("cke_maximized");e();g=h.getDocumentPosition();h.setStyles({left:-1*g.x+"px",top:-1*g.y+"px"});CKEDITOR.env.gecko&&q(a)}else if(this.state==CKEDITOR.TRISTATE_ON){d.removeListener("resize",e);g=[g,h];for(c=0;c<g.length;c++)p(g[c],g[c].getCustomData("maximize_saved_styles")),g[c].removeCustomData("maximize_saved_styles");for(c=a.container;c=c.getParent();)p(c,c.getCustomData("maximize_saved_styles")),c.removeCustomData("maximize_saved_styles");CKEDITOR.env.ie?setTimeout(function(){d.$.scrollTo(m.x,m.y)},0):d.$.scrollTo(m.x,m.y);h.removeClass("cke_maximized");CKEDITOR.env.webkit&&(h.setStyle("display","inline"),setTimeout(function(){h.setStyle("display","block")},0));a.fire("resize")}this.toggleState();if(c=this.uiItems[0])g=this.state==CKEDITOR.TRISTATE_OFF?f.maximize.maximize:f.maximize.minimize,c=CKEDITOR.document.getById(c._.id),c.getChild(1).setHtml(g),c.setAttribute("title",g),c.setAttribute("href",'javascript:void("'+g+'");');"wysiwyg"==a.mode?j?(CKEDITOR.env.gecko&&q(a),a.getSelection().selectRanges(j),(i=a.getSelection().getStartElement())&&i.scrollIntoView(!0)):d.$.scrollTo(k.x,k.y):(j&&(i.selectionStart=j[0],i.selectionEnd=j[1]),i.scrollLeft=k[0],i.scrollTop=k[1]);j=k=null;l=this.state;a.fire("maximize",this.state)},canUndo:!1});a.ui.addButton&&a.ui.addButton("Maximize",{label:f.maximize.maximize,command:"maximize",toolbar:"tools,10"});a.on("mode",function(){var b=a.getCommand("maximize");b.setState(b.state==CKEDITOR.TRISTATE_DISABLED?CKEDITOR.TRISTATE_DISABLED:l)},null,null,100)}}})})();CKEDITOR.plugins.add("newpage",{init:function(a){a.addCommand("newpage",{modes:{wysiwyg:1,source:1},exec:function(b){var a=this;b.setData(b.config.newpage_html||"",function(){b.focus();setTimeout(function(){b.fire("afterCommandExec",{name:"newpage",command:a});b.selectionChange()},200)})},async:!0});a.ui.addButton&&a.ui.addButton("NewPage",{label:a.lang.newpage.toolbar,command:"newpage",toolbar:"document,20"})}});(function(){function e(a){return{"aria-label":a,"class":"cke_pagebreak",contenteditable:"false","data-cke-display-name":"pagebreak","data-cke-pagebreak":1,style:"page-break-after: always",title:a}}CKEDITOR.plugins.add("pagebreak",{requires:"fakeobjects",onLoad:function(){var a=("background:url("+CKEDITOR.getUrl(this.path+"images/pagebreak.gif")+") no-repeat center center;clear:both;width:100%;border-top:#999 1px dotted;border-bottom:#999 1px dotted;padding:0;height:5px;cursor:default;").replace(/;/g," !important;");CKEDITOR.addCss("div.cke_pagebreak{"+a+"}")},init:function(a){a.blockless||(a.addCommand("pagebreak",CKEDITOR.plugins.pagebreakCmd),a.ui.addButton&&a.ui.addButton("PageBreak",{label:a.lang.pagebreak.toolbar,command:"pagebreak",toolbar:"insert,70"}),CKEDITOR.env.webkit&&a.on("contentDom",function(){a.document.on("click",function(b){b=b.data.getTarget();b.is("div")&&b.hasClass("cke_pagebreak")&&a.getSelection().selectElement(b)})}))},afterInit:function(a){function b(f){CKEDITOR.tools.extend(f.attributes,e(a.lang.pagebreak.alt),!0);f.children.length=0}var c=a.dataProcessor,g=c&&c.dataFilter,c=c&&c.htmlFilter,h=/page-break-after\s*:\s*always/i,i=/display\s*:\s*none/i;c&&c.addRules({attributes:{"class":function(a,b){var c=a.replace("cke_pagebreak","");if(c!=a){var d=CKEDITOR.htmlParser.fragment.fromHtml('<span style="display: none;">&nbsp;</span>').children[0];b.children.length=0;b.add(d);d=b.attributes;delete d["aria-label"];delete d.contenteditable;delete d.title}return c}}},{applyToAll:!0,priority:5});g&&g.addRules({elements:{div:function(a){if(a.attributes["data-cke-pagebreak"])b(a);else if(h.test(a.attributes.style)){var c=a.children[0];c&&("span"==c.name&&i.test(c.attributes.style))&&b(a)}}}})}});CKEDITOR.plugins.pagebreakCmd={exec:function(a){var b=a.document.createElement("div",{attributes:e(a.lang.pagebreak.alt)});a.insertElement(b)},context:"div",allowedContent:{div:{styles:"!page-break-after"},span:{match:function(a){return(a=a.parent)&&"div"==a.name&&a.styles&&a.styles["page-break-after"]},styles:"display"}},requiredContent:"div{page-break-after}"}})();(function(){var c={canUndo:!1,async:!0,exec:function(a){a.getClipboardData({title:a.lang.pastetext.title},function(b){b&&a.fire("paste",{type:"text",dataValue:b.dataValue});a.fire("afterCommandExec",{name:"pastetext",command:c,returnValue:!!b})})}};CKEDITOR.plugins.add("pastetext",{requires:"clipboard",init:function(a){a.addCommand("pastetext",c);a.ui.addButton&&a.ui.addButton("PasteText",{label:a.lang.pastetext.button,command:"pastetext",toolbar:"clipboard,40"});if(a.config.forcePasteAsPlainText)a.on("beforePaste",function(a){"html"!=a.data.type&&(a.data.type="text")});a.on("pasteState",function(b){a.getCommand("pastetext").setState(b.data)})}})})();(function(){function h(a,d,f){var b=CKEDITOR.cleanWord;b?f():(a=CKEDITOR.getUrl(a.config.pasteFromWordCleanupFile||d+"filter/default.js"),CKEDITOR.scriptLoader.load(a,f,null,!0));return!b}function i(a){a.data.type="html"}CKEDITOR.plugins.add("pastefromword",{requires:"clipboard",init:function(a){var d=0,f=this.path;a.addCommand("pastefromword",{canUndo:!1,async:!0,exec:function(a){var e=this;d=1;a.once("beforePaste",i);a.getClipboardData({title:a.lang.pastefromword.title},function(c){c&&a.fire("paste",{type:"html",dataValue:c.dataValue});a.fire("afterCommandExec",{name:"pastefromword",command:e,returnValue:!!c})})}});a.ui.addButton&&a.ui.addButton("PasteFromWord",{label:a.lang.pastefromword.toolbar,command:"pastefromword",toolbar:"clipboard,50"});a.on("pasteState",function(b){a.getCommand("pastefromword").setState(b.data)});a.on("paste",function(b){var e=b.data,c=e.dataValue;if(c&&(d||/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(c))){var g=h(a,f,function(){if(g)a.fire("paste",e);else if(!a.config.pasteFromWordPromptCleanup||d||confirm(a.lang.pastefromword.confirmCleanup))e.dataValue=CKEDITOR.cleanWord(c,a)});g&&b.cancel()}},null,null,3)}})})();(function(){var h,i={modes:{wysiwyg:1,source:1},canUndo:!1,readOnly:1,exec:function(a){var g,b=a.config,f=b.baseHref?'<base href="'+b.baseHref+'"/>':"";if(b.fullPage)g=a.getData().replace(/<head>/,"$&"+f).replace(/[^>]*(?=<\/title>)/,"$& &mdash; "+a.lang.preview.preview);else{var b="<body ",d=a.document&&a.document.getBody();d&&(d.getAttribute("id")&&(b+='id="'+d.getAttribute("id")+'" '),d.getAttribute("class")&&(b+='class="'+d.getAttribute("class")+'" '));g=a.config.docType+'<html dir="'+a.config.contentsLangDirection+'"><head>'+f+"<title>"+a.lang.preview.preview+"</title>"+CKEDITOR.tools.buildStyleHtml(a.config.contentsCss)+"</head>"+(b+">")+a.getData()+"</body></html>"}f=640;b=420;d=80;try{var c=window.screen,f=Math.round(0.8*c.width),b=Math.round(0.7*c.height),d=Math.round(0.1*c.width)}catch(i){}if(!1===a.fire("contentPreview",a={dataValue:g}))return!1;var c="",e;CKEDITOR.env.ie&&(window._cke_htmlToLoad=a.dataValue,e="javascript:void( (function(){document.open();"+("("+CKEDITOR.tools.fixDomain+")();").replace(/\/\/.*?\n/g,"").replace(/parent\./g,"window.opener.")+"document.write( window.opener._cke_htmlToLoad );document.close();window.opener._cke_htmlToLoad = null;})() )",c="");CKEDITOR.env.gecko&&(window._cke_htmlToLoad=a.dataValue,c=CKEDITOR.getUrl(h+"preview.html"));c=window.open(c,null,"toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+f+",height="+b+",left="+d);CKEDITOR.env.ie&&c&&(c.location=e);!CKEDITOR.env.ie&&!CKEDITOR.env.gecko&&(e=c.document,e.open(),e.write(a.dataValue),e.close());return!0}};CKEDITOR.plugins.add("preview",{init:function(a){a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&(h=this.path,a.addCommand("preview",i),a.ui.addButton&&a.ui.addButton("Preview",{label:a.lang.preview.preview,command:"preview",toolbar:"document,40"}))}})})();CKEDITOR.plugins.add("print",{init:function(a){a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&(a.addCommand("print",CKEDITOR.plugins.print),a.ui.addButton&&a.ui.addButton("Print",{label:a.lang.print.toolbar,command:"print",toolbar:"document,50"}))}});CKEDITOR.plugins.print={exec:function(a){CKEDITOR.env.gecko?a.window.$.print():a.document.$.execCommand("Print")},canUndo:!1,readOnly:1,modes:{wysiwyg:1}};CKEDITOR.plugins.add("removeformat",{init:function(a){a.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat);a.ui.addButton&&a.ui.addButton("RemoveFormat",{label:a.lang.removeformat.toolbar,command:"removeFormat",toolbar:"cleanup,10"})}});CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(a){for(var h=a._.removeFormatRegex||(a._.removeFormatRegex=RegExp("^(?:"+a.config.removeFormatTags.replace(/,/g,"|")+")$","i")),e=a._.removeAttributes||(a._.removeAttributes=a.config.removeFormatAttributes.split(",")),f=CKEDITOR.plugins.removeformat.filter,k=a.getSelection().getRanges(),l=k.createIterator(),m=function(a){return a.type==CKEDITOR.NODE_ELEMENT},c;c=l.getNextRange();){c.collapsed||c.enlarge(CKEDITOR.ENLARGE_ELEMENT);var j=c.createBookmark(),b=j.startNode,d=j.endNode,i=function(b){for(var c=a.elementPath(b),e=c.elements,d=1,g;(g=e[d])&&!g.equals(c.block)&&!g.equals(c.blockLimit);d++)h.test(g.getName())&&f(a,g)&&b.breakParent(g)};i(b);if(d){i(d);for(b=b.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);b&&!b.equals(d);)if(b.isReadOnly()){if(b.getPosition(d)&CKEDITOR.POSITION_CONTAINS)break;b=b.getNext(m)}else i=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),!("img"==b.getName()&&b.data("cke-realelement"))&&f(a,b)&&(h.test(b.getName())?b.remove(1):(b.removeAttributes(e),a.fire("removeFormatCleanup",b))),b=i}c.moveToBookmark(j)}a.forceNextSelectionCheck();a.getSelection().selectRanges(k)}}},filter:function(a,h){for(var e=a._.removeFormatFilters||[],f=0;f<e.length;f++)if(!1===e[f](h))return!1;return!0}};CKEDITOR.editor.prototype.addRemoveFormatFilter=function(a){this._.removeFormatFilters||(this._.removeFormatFilters=[]);this._.removeFormatFilters.push(a)};CKEDITOR.config.removeFormatTags="b,big,cite,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var";CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign";(function(){var b={readOnly:1,exec:function(a){if(a.fire("save")&&(a=a.element.$.form))try{a.submit()}catch(b){a.submit.click&&a.submit.click()}}};CKEDITOR.plugins.add("save",{init:function(a){a.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(a.addCommand("save",b).modes={wysiwyg:!!a.element.$.form},a.ui.addButton&&a.ui.addButton("Save",{label:a.lang.save.toolbar,command:"save",toolbar:"document,10"}))}})})();(function(){CKEDITOR.plugins.add("selectall",{init:function(b){b.addCommand("selectAll",{modes:{wysiwyg:1,source:1},exec:function(a){var b=a.editable();if(b.is("textarea"))a=b.$,CKEDITOR.env.ie?a.createTextRange().execCommand("SelectAll"):(a.selectionStart=0,a.selectionEnd=a.value.length),a.focus();else{if(b.is("body"))a.document.$.execCommand("SelectAll",!1,null);else{var c=a.createRange();c.selectNodeContents(b);c.select()}a.forceNextSelectionCheck();a.selectionChange()}},canUndo:!1});b.ui.addButton&&b.ui.addButton("SelectAll",{label:b.lang.selectall.toolbar,command:"selectAll",toolbar:"selection,10"})}})})();(function(){var i={readOnly:1,preserveState:!0,editorFocus:!1,exec:function(a){this.toggleState();this.refresh(a)},refresh:function(a){if(a.document){var c=this.state==CKEDITOR.TRISTATE_ON&&(a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE||a.focusManager.hasFocus)?"attachClass":"removeClass";a.editable()[c]("cke_show_blocks")}}};CKEDITOR.plugins.add("showblocks",{onLoad:function(){var a="p div pre address blockquote h1 h2 h3 h4 h5 h6".split(" "),c,b,e,f,i=CKEDITOR.getUrl(this.path),j=!(CKEDITOR.env.ie&&9>CKEDITOR.env.version),g=j?":not([contenteditable=false]):not(.cke_show_blocks_off)":"",d,h;for(c=b=e=f="";d=a.pop();)h=a.length?",":"",c+=".cke_show_blocks "+d+g+h,e+=".cke_show_blocks.cke_contents_ltr "+d+g+h,f+=".cke_show_blocks.cke_contents_rtl "+d+g+h,b+=".cke_show_blocks "+d+g+"{background-image:url("+CKEDITOR.getUrl(i+"images/block_"+d+".png")+")}";CKEDITOR.addCss((c+"{background-repeat:no-repeat;border:1px dotted gray;padding-top:8px}").concat(b,e+"{background-position:top left;padding-left:8px}",f+"{background-position:top right;padding-right:8px}"));j||CKEDITOR.addCss(".cke_show_blocks [contenteditable=false],.cke_show_blocks .cke_show_blocks_off{border:none;padding-top:0;background-image:none}.cke_show_blocks.cke_contents_rtl [contenteditable=false],.cke_show_blocks.cke_contents_rtl .cke_show_blocks_off{padding-right:0}.cke_show_blocks.cke_contents_ltr [contenteditable=false],.cke_show_blocks.cke_contents_ltr .cke_show_blocks_off{padding-left:0}")},init:function(a){function c(){b.refresh(a)}
if(!a.blockless){var b=a.addCommand("showblocks",i);b.canUndo=!1;a.config.startupOutlineBlocks&&b.setState(CKEDITOR.TRISTATE_ON);a.ui.addButton&&a.ui.addButton("ShowBlocks",{label:a.lang.showblocks.toolbar,command:"showblocks",toolbar:"tools,20"});a.on("mode",function(){b.state!=CKEDITOR.TRISTATE_DISABLED&&b.refresh(a)});a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(a.on("focus",c),a.on("blur",c));a.on("contentDom",function(){b.state!=CKEDITOR.TRISTATE_DISABLED&&b.refresh(a)})}}})})();(function(){var f={preserveState:!0,editorFocus:!1,readOnly:1,exec:function(a){this.toggleState();this.refresh(a)},refresh:function(a){if(a.document){var b=this.state==CKEDITOR.TRISTATE_ON?"attachClass":"removeClass";a.editable()[b]("cke_show_borders")}}};CKEDITOR.plugins.add("showborders",{modes:{wysiwyg:1},onLoad:function(){var a;a=(CKEDITOR.env.ie6Compat?[".%1 table.%2,",".%1 table.%2 td, .%1 table.%2 th","{","border : #d3d3d3 1px dotted","}"]:".%1 table.%2,;.%1 table.%2 > tr > td, .%1 table.%2 > tr > th,;.%1 table.%2 > tbody > tr > td, .%1 table.%2 > tbody > tr > th,;.%1 table.%2 > thead > tr > td, .%1 table.%2 > thead > tr > th,;.%1 table.%2 > tfoot > tr > td, .%1 table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,"cke_show_border").replace(/%1/g,"cke_show_borders ");CKEDITOR.addCss(a)},init:function(a){var b=a.addCommand("showborders",f);b.canUndo=!1;!1!==a.config.startupShowBorders&&b.setState(CKEDITOR.TRISTATE_ON);a.on("mode",function(){b.state!=CKEDITOR.TRISTATE_DISABLED&&b.refresh(a)},null,null,100);a.on("contentDom",function(){b.state!=CKEDITOR.TRISTATE_DISABLED&&b.refresh(a)});a.on("removeFormatCleanup",function(d){d=d.data;a.getCommand("showborders").state==CKEDITOR.TRISTATE_ON&&(d.is("table")&&(!d.hasAttribute("border")||0>=parseInt(d.getAttribute("border"),10)))&&d.addClass("cke_show_border")})},afterInit:function(a){var b=a.dataProcessor,a=b&&b.dataFilter,b=b&&b.htmlFilter;a&&a.addRules({elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if((!c||0>=c)&&(!b||-1==b.indexOf("cke_show_border")))a["class"]=(b||"")+" cke_show_border"}}});b&&b.addRules({elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=b.replace("cke_show_border","").replace(/\s{2}/," ").replace(/^\s+|\s+$/,""))}}})}});CKEDITOR.on("dialogDefinition",function(a){var b=a.data.name;if("table"==b||"tableProperties"==b)if(a=a.data.definition,b=a.getContents("info").get("txtBorder"),b.commit=CKEDITOR.tools.override(b.commit,function(a){return function(b,c){a.apply(this,arguments);var e=parseInt(this.getValue(),10);c[!e||0>=e?"addClass":"removeClass"]("cke_show_border")}}),a=(a=a.getContents("advanced"))&&a.get("advCSSClasses"))a.setup=CKEDITOR.tools.override(a.setup,function(a){return function(){a.apply(this,arguments);this.setValue(this.getValue().replace(/cke_show_border/,""))}}),a.commit=CKEDITOR.tools.override(a.commit,function(a){return function(b,c){a.apply(this,arguments);parseInt(c.getAttribute("border"),10)||c.addClass("cke_show_border")}})})})();(function(){CKEDITOR.plugins.add("sourcearea",{init:function(a){function d(){var a=e&&this.equals(CKEDITOR.document.getActive());this.hide();this.setStyle("height",this.getParent().$.clientHeight+"px");this.setStyle("width",this.getParent().$.clientWidth+"px");this.show();a&&this.focus()}if(a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var f=CKEDITOR.plugins.sourcearea;a.addMode("source",function(e){var b=a.ui.space("contents").getDocument().createElement("textarea");b.setStyles(CKEDITOR.tools.extend({width:CKEDITOR.env.ie7Compat?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"},CKEDITOR.tools.cssVendorPrefix("tab-size",a.config.sourceAreaTabSize||4)));b.setAttribute("dir","ltr");b.addClass("cke_source cke_reset cke_enable_context_menu");a.ui.space("contents").append(b);b=a.editable(new c(a,b));b.setData(a.getData(1));CKEDITOR.env.ie&&(b.attachListener(a,"resize",d,b),b.attachListener(CKEDITOR.document.getWindow(),"resize",d,b),CKEDITOR.tools.setTimeout(d,0,b));a.fire("ariaWidget",this);e()});a.addCommand("source",f.commands.source);a.ui.addButton&&a.ui.addButton("Source",{label:a.lang.sourcearea.toolbar,command:"source",toolbar:"mode,10"});a.on("mode",function(){a.getCommand("source").setState("source"==a.mode?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)});var e=CKEDITOR.env.ie&&9==CKEDITOR.env.version}}});var c=CKEDITOR.tools.createClass({base:CKEDITOR.editable,proto:{setData:function(a){this.setValue(a);this.status="ready";this.editor.fire("dataReady")},getData:function(){return this.getValue()},insertHtml:function(){},insertElement:function(){},insertText:function(){},setReadOnly:function(a){this[(a?"set":"remove")+"Attribute"]("readOnly","readonly")},detach:function(){c.baseProto.detach.call(this);this.clearCustomData();this.remove()}}})})();CKEDITOR.plugins.sourcearea={commands:{source:{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,exec:function(c){"wysiwyg"==c.mode&&c.fire("saveSnapshot");c.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED);c.setMode("source"==c.mode?"wysiwyg":"source")},canUndo:!1}}};CKEDITOR.plugins.add("specialchar",{availableLangs:{af:1,ar:1,bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,he:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ku:1,lt:1,lv:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ru:1,si:1,sk:1,sl:1,sq:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},requires:"dialog",init:function(a){var c=this;CKEDITOR.dialog.add("specialchar",this.path+"dialogs/specialchar.js");a.addCommand("specialchar",{exec:function(){var b=a.langCode,b=c.availableLangs[b]?b:c.availableLangs[b.replace(/-.*/,"")]?b.replace(/-.*/,""):"en";CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(c.path+"dialogs/lang/"+b+".js"),function(){CKEDITOR.tools.extend(a.lang.specialchar,c.langEntries[b]);a.openDialog("specialchar")})},modes:{wysiwyg:1},canUndo:!1});a.ui.addButton&&a.ui.addButton("SpecialChar",{label:a.lang.specialchar.toolbar,command:"specialchar",toolbar:"insert,50"})}});CKEDITOR.config.specialChars="! &quot; # $ % &amp; ' ( ) * + - . / 0 1 2 3 4 5 6 7 8 9 : ; &lt; = &gt; ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z [ ] ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z { | } ~ &euro; &lsquo; &rsquo; &ldquo; &rdquo; &ndash; &mdash; &iexcl; &cent; &pound; &curren; &yen; &brvbar; &sect; &uml; &copy; &ordf; &laquo; &not; &reg; &macr; &deg; &sup2; &sup3; &acute; &micro; &para; &middot; &cedil; &sup1; &ordm; &raquo; &frac14; &frac12; &frac34; &iquest; &Agrave; &Aacute; &Acirc; &Atilde; &Auml; &Aring; &AElig; &Ccedil; &Egrave; &Eacute; &Ecirc; &Euml; &Igrave; &Iacute; &Icirc; &Iuml; &ETH; &Ntilde; &Ograve; &Oacute; &Ocirc; &Otilde; &Ouml; &times; &Oslash; &Ugrave; &Uacute; &Ucirc; &Uuml; &Yacute; &THORN; &szlig; &agrave; &aacute; &acirc; &atilde; &auml; &aring; &aelig; &ccedil; &egrave; &eacute; &ecirc; &euml; &igrave; &iacute; &icirc; &iuml; &eth; &ntilde; &ograve; &oacute; &ocirc; &otilde; &ouml; &divide; &oslash; &ugrave; &uacute; &ucirc; &uuml; &yacute; &thorn; &yuml; &OElig; &oelig; &#372; &#374 &#373 &#375; &sbquo; &#8219; &bdquo; &hellip; &trade; &#9658; &bull; &rarr; &rArr; &hArr; &diams; &asymp;".split(" ");CKEDITOR.plugins.add("scayt",{requires:"menubutton,dialog",tabToOpen:null,dialogName:"scaytDialog",init:function(a){var c=this,d=CKEDITOR.plugins.scayt;this.bindEvents(a);this.parseConfig(a);this.addRule(a);CKEDITOR.dialog.add(this.dialogName,CKEDITOR.getUrl(this.path+"dialogs/options.js"));this.addMenuItems(a);var b=a.lang.scayt,e=CKEDITOR.env;a.ui.add("Scayt",CKEDITOR.UI_MENUBUTTON,{label:b.text_title,title:a.plugins.wsc?a.lang.wsc.title:b.text_title,modes:{wysiwyg:!(e.ie&&(8>e.version||e.quirks))},toolbar:"spellchecker,20",refresh:function(){var b=a.ui.instances.Scayt.getState();a.scayt&&(b=d.state[a.name]?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);a.fire("scaytButtonState",b)},onRender:function(){var d=this;a.on("scaytButtonState",function(a){void 0!==typeof a.data&&d.setState(a.data)})},onMenu:function(){var b=a.scayt;a.getMenuItem("scaytToggle").label=a.lang.scayt[b&&d.state[a.name]?"btn_disable":"btn_enable"];b={scaytToggle:CKEDITOR.TRISTATE_OFF,scaytOptions:b?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytLangs:b?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytDict:b?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytAbout:b?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,WSC:a.plugins.wsc?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED};a.config.scayt_uiTabs[0]||delete b.scaytOptions;a.config.scayt_uiTabs[1]||delete b.scaytLangs;a.config.scayt_uiTabs[2]||delete b.scaytDict;return b}});a.contextMenu&&a.addMenuItems&&(a.contextMenu.addListener(function(){var d=a.scayt,b;if(d){var e=d.getSelectionNode();if(e=e?e.getAttribute(d.getNodeAttribute()):e)b=c.menuGenerator(a,e,c),d.showBanner("."+a.contextMenu._.definition.panel.className.split(" ").join(" ."))}return b}),a.contextMenu._.onHide=CKEDITOR.tools.override(a.contextMenu._.onHide,function(d){return function(){var b=a.scayt;b&&b.hideBanner();return d.apply(this)}}))},addMenuItems:function(a){var c=this,d=CKEDITOR.plugins.scayt;a.addMenuGroup("scaytButton");var b=a.config.scayt_contextMenuItemsOrder.split("|");if(b&&b.length)for(var e=0;e<b.length;e++)a.addMenuGroup("scayt_"+b[e],e-10);b={scaytToggle:{label:a.lang.scayt.btn_enable,group:"scaytButton",onClick:function(){var b=a.scayt;d.state[a.name]=!d.state[a.name];!0===d.state[a.name]?b||d.createScayt(a):b&&d.destroy(a)}},scaytAbout:{label:a.lang.scayt.btn_about,group:"scaytButton",onClick:function(){a.scayt.tabToOpen="about";a.lockSelection();a.openDialog(c.dialogName)}},scaytOptions:{label:a.lang.scayt.btn_options,group:"scaytButton",onClick:function(){a.scayt.tabToOpen="options";a.lockSelection();a.openDialog(c.dialogName)}},scaytLangs:{label:a.lang.scayt.btn_langs,group:"scaytButton",onClick:function(){a.scayt.tabToOpen="langs";a.lockSelection();a.openDialog(c.dialogName)}},scaytDict:{label:a.lang.scayt.btn_dictionaries,group:"scaytButton",onClick:function(){a.scayt.tabToOpen="dictionaries";a.lockSelection();a.openDialog(c.dialogName)}}};a.plugins.wsc&&(b.WSC={label:a.lang.wsc.toolbar,group:"scaytButton",onClick:function(){var d=CKEDITOR.plugins.scayt,b=a.scayt,c=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.container.getText():a.document.getBody().getText();(c=c.replace(/\s/g,""))?(b&&(d.state[a.name]&&b.setMarkupPaused)&&b.setMarkupPaused(!0),a.lockSelection(),a.execCommand("checkspell")):alert("Nothing to check!")}});a.addMenuItems(b)},bindEvents:function(a){function c(){var d=a.scayt;d&&(d.removeMarkupInSelectionNode(),d.fire("startSpellCheck"))}var d=CKEDITOR.plugins.scayt,b=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE;CKEDITOR.on("dialogDefinition",function(a){if("scaytDialog"===a.data.name)a.data.definition.dialog.on("cancel",function(){return!1},this,null,-1)});var e=function(){a.scayt&&d.destroy(a)},g=function(){d.state[a.name]&&!a.readOnly&&d.createScayt(a)},f=function(){var d=a.editable();d.attachListener(d,"focus",function(){var d=CKEDITOR.plugins.scayt&&CKEDITOR.plugins.scayt.state[a.name]&&a.scayt,c,e;if((b||d)&&a._.savedSelection)for(var d=a._.savedSelection.getSelectedElement(),d=!d&&a._.savedSelection.getRanges(),i=0;i<d.length;i++)e=d[i],c=e.startContainer.getText().length,(c<e.startOffset||c<e.endOffset)&&a.unlockSelection(!1)},this,null,-10)},h=function(){b?(a.on("blur",e),a.on("focus",g),a.focusManager.hasFocus&&g()):g();f()};a.on("contentDom",h);a.on("beforeCommandExec",function(b){var c;if(b.data.name in d.options.disablingCommandExec&&"wysiwyg"==a.mode){if(c=a.scayt)d.destroy(a),a.fire("scaytButtonState",CKEDITOR.TRISTATE_DISABLED)}else if("bold"===b.data.name||"italic"===b.data.name||"underline"===b.data.name||"strike"===b.data.name||"subscript"===b.data.name||"superscript"===b.data.name)if(c=a.scayt)c.removeMarkupInSelectionNode(),setTimeout(function(){c.fire("startSpellCheck")},0)});a.on("beforeSetMode",function(b){if("source"==b.data){if(b=a.scayt)d.destroy(a),a.fire("scaytButtonState",CKEDITOR.TRISTATE_DISABLED);a.document&&(a.document.getBody().removeAttribute("_jquid"),a.document.getBody().removeAttribute("dir"))}});a.on("afterCommandExec",function(d){var b;if("wysiwyg"==a.mode&&("undo"==d.data.name||"redo"==d.data.name))(b=a.scayt)&&setTimeout(function(){b.fire("startSpellCheck")},250)});a.on("readOnly",function(b){var c;b&&(c=a.scayt,!0===b.editor.readOnly?c&&c.fire("removeMarkupInDocument",{}):c?c.fire("startSpellCheck"):"wysiwyg"==b.editor.mode&&!0===d.state[b.editor.name]&&(d.createScayt(a),b.editor.fire("scaytButtonState",CKEDITOR.TRISTATE_ON)))});a.on("beforeDestroy",e);a.on("setData",function(){e();a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&h()},this,null,50);a.on("insertElement",function(){CKEDITOR.env.ie?setTimeout(function(){c()},50):c()},this,null,50);a.on("insertHtml",function(){c()},this,null,50);a.on("insertText",function(){c()},this,null,50);a.on("scaytDialogShown",function(d){d.data.selectPage(a.scayt.tabToOpen)})},parseConfig:function(a){var c=CKEDITOR.plugins.scayt;c.replaceOldOptionsNames(a.config);"boolean"!==typeof a.config.scayt_autoStartup&&(a.config.scayt_autoStartup=!1);c.state[a.name]=a.config.scayt_autoStartup;a.config.scayt_contextCommands||(a.config.scayt_contextCommands="ignore|ignoreall|add");a.config.scayt_contextMenuItemsOrder||(a.config.scayt_contextMenuItemsOrder="suggest|moresuggest|control");a.config.scayt_sLang||(a.config.scayt_sLang="en_US");if(void 0===a.config.scayt_maxSuggestions||"number"!=typeof a.config.scayt_maxSuggestions||0>a.config.scayt_maxSuggestions)a.config.scayt_maxSuggestions=5;if(void 0===a.config.scayt_customDictionaryIds||"string"!==typeof a.config.scayt_customDictionaryIds)a.config.scayt_customDictionaryIds="";if(void 0===a.config.scayt_userDictionaryName||"string"!==typeof a.config.scayt_userDictionaryName)a.config.scayt_userDictionaryName=null;if("string"===typeof a.config.scayt_uiTabs&&3===a.config.scayt_uiTabs.split(",").length){var d=[],b=[];a.config.scayt_uiTabs=a.config.scayt_uiTabs.split(",");CKEDITOR.tools.search(a.config.scayt_uiTabs,function(a){if(Number(a)===1||Number(a)===0){b.push(true);d.push(Number(a))}else b.push(false)});a.config.scayt_uiTabs=null===CKEDITOR.tools.search(b,!1)?d:[1,1,1]}else a.config.scayt_uiTabs=[1,1,1];"string"!=typeof a.config.scayt_serviceProtocol&&(a.config.scayt_serviceProtocol=null);"string"!=typeof a.config.scayt_serviceHost&&(a.config.scayt_serviceHost=null);"string"!=typeof a.config.scayt_servicePort&&(a.config.scayt_servicePort=null);"string"!=typeof a.config.scayt_servicePath&&(a.config.scayt_servicePath=null);a.config.scayt_moreSuggestions||(a.config.scayt_moreSuggestions="on");"string"!==typeof a.config.scayt_customerId&&(a.config.scayt_customerId="1:WvF0D4-UtPqN1-43nkD4-NKvUm2-daQqk3-LmNiI-z7Ysb4-mwry24-T8YrS3-Q2tpq2");"string"!==typeof a.config.scayt_srcUrl&&(c=document.location.protocol,c=-1!=c.search(/https?:/)?c:"http:",a.config.scayt_srcUrl=c+"//svc.webspellchecker.net/spellcheck31/lf/scayt3/ckscayt/ckscayt.js");"boolean"!==typeof CKEDITOR.config.scayt_handleCheckDirty&&(CKEDITOR.config.scayt_handleCheckDirty=!0);"boolean"!==typeof CKEDITOR.config.scayt_handleUndoRedo&&(CKEDITOR.config.scayt_handleUndoRedo=!0);if(a.config.scayt_disableOptionsStorage){var c=CKEDITOR.tools.isArray(a.config.scayt_disableOptionsStorage)?a.config.scayt_disableOptionsStorage:"string"===typeof a.config.scayt_disableOptionsStorage?[a.config.scayt_disableOptionsStorage]:void 0,e="all options lang ignore-all-caps-words ignore-domain-names ignore-words-with-mixed-cases ignore-words-with-numbers".split(" "),g=["lang","ignore-all-caps-words","ignore-domain-names","ignore-words-with-mixed-cases","ignore-words-with-numbers"],f=CKEDITOR.tools.search,h=CKEDITOR.tools.indexOf;a.config.scayt_disableOptionsStorage=function(a){for(var d=[],b=0;b<a.length;b++){var c=a[b],j=!!f(a,"options");if(!f(e,c)||j&&f(g,function(a){if(a==="lang")return false}))return;f(g,c)&&g.splice(h(g,c),1);if(c==="all"||j&&f(a,"lang"))return[];c==="options"&&(g=["lang"])}return d=d.concat(g)}(c)}},addRule:function(a){var c=a.dataProcessor,d=c&&c.htmlFilter,b=a._.elementsPath&&a._.elementsPath.filters,c=c&&c.dataFilter,e=a.addRemoveFormatFilter,g=function(d){var b=CKEDITOR.plugins.scayt;if(a.scayt&&d.hasAttribute(b.options.data_attribute_name))return!1},f=function(d){var b=CKEDITOR.plugins.scayt,c=!0;a.scayt&&d.hasAttribute(b.options.data_attribute_name)&&(c=!1);return c};b&&b.push(g);c&&c.addRules({elements:{span:function(d){var b=CKEDITOR.plugins.scayt;b&&(b.state[a.name]&&d.classes&&CKEDITOR.tools.search(d.classes,b.options.misspelled_word_class))&&(d.classes&&d.parent.type===CKEDITOR.NODE_DOCUMENT_FRAGMENT?(delete d.attributes.style,delete d.name):delete d.classes[CKEDITOR.tools.indexOf(d.classes,b.options.misspelled_word_class)]);return d}}});d&&d.addRules({elements:{span:function(d){var b=CKEDITOR.plugins.scayt;b&&(b.state[a.name]&&d.hasClass(b.options.misspelled_word_class)&&d.attributes[b.options.data_attribute_name])&&(d.removeClass(b.options.misspelled_word_class),delete d.attributes[b.options.data_attribute_name],delete d.name);return d}}});e&&e.call(a,f)},scaytMenuDefinition:function(a){var c=this,a=a.scayt;return{scayt_ignore:{label:a.getLocal("btn_ignore"),group:"scayt_control",order:1,exec:function(a){a.scayt.ignoreWord()}},scayt_ignoreall:{label:a.getLocal("btn_ignoreAll"),group:"scayt_control",order:2,exec:function(a){a.scayt.ignoreAllWords()}},scayt_add:{label:a.getLocal("btn_addWord"),group:"scayt_control",order:3,exec:function(a){var b=a.scayt;setTimeout(function(){b.addWordToUserDictionary()},10)}},option:{label:a.getLocal("btn_options"),group:"scayt_control",order:4,exec:function(a){a.scayt.tabToOpen="options";a.lockSelection();a.openDialog(c.dialogName)},verification:function(a){return 1==a.config.scayt_uiTabs[0]?!0:!1}},language:{label:a.getLocal("btn_langs"),group:"scayt_control",order:5,exec:function(a){a.scayt.tabToOpen="langs";a.lockSelection();a.openDialog(c.dialogName)},verification:function(a){return 1==a.config.scayt_uiTabs[1]?!0:!1}},dictionary:{label:a.getLocal("btn_dictionaries"),group:"scayt_control",order:6,exec:function(a){a.scayt.tabToOpen="dictionaries";a.lockSelection();a.openDialog(c.dialogName)},verification:function(a){return 1==a.config.scayt_uiTabs[2]?!0:!1}},about:{label:a.getLocal("btn_about"),group:"scayt_control",order:7,exec:function(a){a.scayt.tabToOpen="about";a.lockSelection();a.openDialog(c.dialogName)}}}},buildSuggestionMenuItems:function(a,c){var d={},b={},e=a.scayt;if(0<c.length&&"no_any_suggestions"!==c[0])for(var g=0;g<c.length;g++){var f="scayt_suggest_"+CKEDITOR.plugins.scayt.suggestions[g].replace(" ","_");a.addCommand(f,this.createCommand(CKEDITOR.plugins.scayt.suggestions[g]));g<a.config.scayt_maxSuggestions?(a.addMenuItem(f,{label:c[g],command:f,group:"scayt_suggest",order:g+1}),d[f]=CKEDITOR.TRISTATE_OFF):(a.addMenuItem(f,{label:c[g],command:f,group:"scayt_moresuggest",order:g+1}),b[f]=CKEDITOR.TRISTATE_OFF,"on"===a.config.scayt_moreSuggestions&&(a.addMenuItem("scayt_moresuggest",{label:e.getLocal("btn_moreSuggestions"),group:"scayt_moresuggest",order:10,getItems:function(){return b}}),d.scayt_moresuggest=CKEDITOR.TRISTATE_OFF))}else d.no_scayt_suggest=CKEDITOR.TRISTATE_DISABLED,a.addCommand("no_scayt_suggest",{exec:function(){}}),a.addMenuItem("no_scayt_suggest",{label:e.getLocal("btn_noSuggestions")||"no_scayt_suggest",command:"no_scayt_suggest",group:"scayt_suggest",order:0});return d},menuGenerator:function(a,c){var d=a.scayt,b=this.scaytMenuDefinition(a),e={},g=a.config.scayt_contextCommands.split("|");d.fire("getSuggestionsList",{lang:d.getLang(),word:c});e=this.buildSuggestionMenuItems(a,CKEDITOR.plugins.scayt.suggestions);if("off"==a.config.scayt_contextCommands)return e;for(var f in b)-1==CKEDITOR.tools.indexOf(g,f.replace("scayt_",""))&&"all"!=a.config.scayt_contextCommands||(e[f]=CKEDITOR.TRISTATE_OFF,"function"===typeof b[f].verification&&!b[f].verification(a)&&delete e[f],a.addCommand(f,{exec:b[f].exec}),a.addMenuItem(f,{label:a.lang.scayt[b[f].label]||b[f].label,command:f,group:b[f].group,order:b[f].order}));return e},createCommand:function(a){return{exec:function(c){c.scayt.replaceSelectionNode({word:a})}}}});CKEDITOR.plugins.scayt={state:{},suggestions:[],loadingHelper:{loadOrder:[]},isLoading:!1,options:{disablingCommandExec:{source:!0,newpage:!0,templates:!0},data_attribute_name:"data-scayt-word",misspelled_word_class:"scayt-misspell-word"},backCompatibilityMap:{scayt_service_protocol:"scayt_serviceProtocol",scayt_service_host:"scayt_serviceHost",scayt_service_port:"scayt_servicePort",scayt_service_path:"scayt_servicePath",scayt_customerid:"scayt_customerId"},replaceOldOptionsNames:function(a){for(var c in a)c in
this.backCompatibilityMap&&(a[this.backCompatibilityMap[c]]=a[c],delete a[c])},createScayt:function(a){var c=this;this.loadScaytLibrary(a,function(a){var b={lang:a.config.scayt_sLang,container:"BODY"==a.editable().$.nodeName?a.document.getWindow().$.frameElement:a.editable().$,customDictionary:a.config.scayt_customDictionaryIds,userDictionaryName:a.config.scayt_userDictionaryName,localization:a.langCode,customer_id:a.config.scayt_customerId,debug:a.config.scayt_debug,data_attribute_name:c.options.data_attribute_name,misspelled_word_class:c.options.misspelled_word_class,"options-to-restore":a.config.scayt_disableOptionsStorage,focused:a.editable().hasFocus,ignoreElementsRegex:a.config.scayt_elementsToIgnore};a.config.scayt_serviceProtocol&&(b.service_protocol=a.config.scayt_serviceProtocol);a.config.scayt_serviceHost&&(b.service_host=a.config.scayt_serviceHost);a.config.scayt_servicePort&&(b.service_port=a.config.scayt_servicePort);a.config.scayt_servicePath&&(b.service_path=a.config.scayt_servicePath);b=new SCAYT.CKSCAYT(b,function(){},function(){});b.subscribe("suggestionListSend",function(a){for(var b={},d=[],c=0;c<a.suggestionList.length;c++)if(!b["word_"+a.suggestionList[c]]){b["word_"+a.suggestionList[c]]=a.suggestionList[c];d.push(a.suggestionList[c])}CKEDITOR.plugins.scayt.suggestions=d});a.scayt=b;a.fire("scaytButtonState",a.readOnly?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_ON)})},destroy:function(a){a.scayt&&a.scayt.destroy();delete a.scayt;a.fire("scaytButtonState",CKEDITOR.TRISTATE_OFF)},loadScaytLibrary:function(a,c){var d=this;"undefined"===typeof window.SCAYT||"function"!==typeof window.SCAYT.CKSCAYT?(this.loadingHelper[a.name]=c,this.loadingHelper.loadOrder.push(a.name),CKEDITOR.scriptLoader.load(a.config.scayt_srcUrl,function(){var a;CKEDITOR.fireOnce("scaytReady");for(var c=0;c<d.loadingHelper.loadOrder.length;c++){a=d.loadingHelper.loadOrder[c];if("function"===typeof d.loadingHelper[a])d.loadingHelper[a](CKEDITOR.instances[a]);delete d.loadingHelper[a]}d.loadingHelper.loadOrder=[]})):window.SCAYT&&"function"===typeof window.SCAYT.CKSCAYT&&(CKEDITOR.fireOnce("scaytReady"),a.scayt||"function"===typeof c&&c(a))}};CKEDITOR.on("scaytReady",function(){if(!0===CKEDITOR.config.scayt_handleCheckDirty){var a=CKEDITOR.editor.prototype;a.checkDirty=CKEDITOR.tools.override(a.checkDirty,function(a){return function(){var b=null,c=this.scayt;if(!CKEDITOR.plugins.scayt||!CKEDITOR.plugins.scayt.state[this.name]||!this.scayt)b=a.call(this);else if(b="ready"==this.status)var g=c.removeMarkupFromString(this.getSnapshot()),c=c.removeMarkupFromString(this._.previousValue),b=b&&c!==g;return b}});a.resetDirty=CKEDITOR.tools.override(a.resetDirty,function(a){return function(){var b=this.scayt;!CKEDITOR.plugins.scayt||!CKEDITOR.plugins.scayt.state[this.name]||!this.scayt?a.call(this):this._.previousValue=b.removeMarkupFromString(this.getSnapshot())}})}if(!0===CKEDITOR.config.scayt_handleUndoRedo){var a=CKEDITOR.plugins.undo.Image.prototype,c="function"==typeof a.equalsContent?"equalsContent":"equals";a[c]=CKEDITOR.tools.override(a[c],function(a){return function(b){var c=b.editor.scayt,g=this.contents,f=b.contents,h=null;CKEDITOR.plugins.scayt&&(CKEDITOR.plugins.scayt.state[b.editor.name]&&b.editor.scayt)&&(this.contents=c.removeMarkupFromString(g)||"",b.contents=c.removeMarkupFromString(f)||"");h=a.apply(this,arguments);this.contents=g;b.contents=f;return h}})}});(function(){CKEDITOR.plugins.add("stylescombo",{requires:"richcombo",init:function(c){var j=c.config,g=c.lang.stylescombo,f={},i=[],k=[];c.on("stylesSet",function(b){if(b=b.data.styles){for(var a,h,d,e=0,l=b.length;e<l;e++)if(a=b[e],!(c.blockless&&a.element in CKEDITOR.dtd.$block)&&(h=a.name,a=new CKEDITOR.style(a),!c.filter.customConfig||c.filter.check(a)))a._name=h,a._.enterMode=j.enterMode,a._.type=d=a.assignedTo||a.type,a._.weight=e+1E3*(d==CKEDITOR.STYLE_OBJECT?1:d==CKEDITOR.STYLE_BLOCK?2:3),f[h]=a,i.push(a),k.push(a);i.sort(function(a,b){return a._.weight-b._.weight})}});c.ui.addRichCombo("Styles",{label:g.label,title:g.panelTitle,toolbar:"styles,10",allowedContent:k,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(j.contentsCss),multiSelect:!0,attributes:{"aria-label":g.panelTitle}},init:function(){var b,a,c,d,e,f;e=0;for(f=i.length;e<f;e++)b=i[e],a=b._name,d=b._.type,d!=c&&(this.startGroup(g["panelTitle"+d]),c=d),this.add(a,b.type==CKEDITOR.STYLE_OBJECT?a:b.buildPreview(),a);this.commit()},onClick:function(b){c.focus();c.fire("saveSnapshot");var b=f[b],a=c.elementPath();c[b.checkActive(a,c)?"removeStyle":"applyStyle"](b);c.fire("saveSnapshot")},onRender:function(){c.on("selectionChange",function(b){for(var a=this.getValue(),b=b.data.path.elements,h=0,d=b.length,e;h<d;h++){e=b[h];for(var g in f)if(f[g].checkElementRemovable(e,!0,c)){g!=a&&this.setValue(g);return}}this.setValue("")},this)},onOpen:function(){var b=c.getSelection().getSelectedElement(),b=c.elementPath(b),a=[0,0,0,0];this.showAll();this.unmarkAll();for(var h in f){var d=f[h],e=d._.type;d.checkApplicable(b,c,c.activeFilter)?a[e]++:this.hideItem(h);d.checkActive(b,c)&&this.mark(h)}a[CKEDITOR.STYLE_BLOCK]||this.hideGroup(g["panelTitle"+CKEDITOR.STYLE_BLOCK]);a[CKEDITOR.STYLE_INLINE]||this.hideGroup(g["panelTitle"+CKEDITOR.STYLE_INLINE]);a[CKEDITOR.STYLE_OBJECT]||this.hideGroup(g["panelTitle"+CKEDITOR.STYLE_OBJECT])},refresh:function(){var b=c.elementPath();if(b){for(var a in f)if(f[a].checkApplicable(b,c,c.activeFilter))return;this.setState(CKEDITOR.TRISTATE_DISABLED)}},reset:function(){f={};i=[]}})}})})();(function(){function i(c){return{editorFocus:!1,canUndo:!1,modes:{wysiwyg:1},exec:function(d){if(d.editable().hasFocus){var e=d.getSelection(),b;if(b=(new CKEDITOR.dom.elementPath(e.getCommonAncestor(),e.root)).contains({td:1,th:1},1)){var e=d.createRange(),a=CKEDITOR.tools.tryThese(function(){var a=b.getParent().$.cells[b.$.cellIndex+(c?-1:1)];a.parentNode.parentNode;return a},function(){var a=b.getParent(),a=a.getAscendant("table").$.rows[a.$.rowIndex+(c?-1:1)];return a.cells[c?a.cells.length-1:0]});if(!a&&!c){for(var f=b.getAscendant("table").$,a=b.getParent().$.cells,f=new CKEDITOR.dom.element(f.insertRow(-1),d.document),g=0,h=a.length;g<h;g++)f.append((new CKEDITOR.dom.element(a[g],d.document)).clone(!1,!1)).appendBogus();e.moveToElementEditStart(f)}else if(a)a=new CKEDITOR.dom.element(a),e.moveToElementEditStart(a),(!e.checkStartOfBlock()||!e.checkEndOfBlock())&&e.selectNodeContents(a);else return!0;e.select(!0);return!0}}return!1}}}var h={editorFocus:!1,modes:{wysiwyg:1,source:1}},g={exec:function(c){c.container.focusNext(!0,c.tabIndex)}},f={exec:function(c){c.container.focusPrevious(!0,c.tabIndex)}};CKEDITOR.plugins.add("tab",{init:function(c){for(var d=!1!==c.config.enableTabKeyTools,e=c.config.tabSpaces||0,b="";e--;)b+=" ";if(b)c.on("key",function(a){9==a.data.keyCode&&(c.insertHtml(b),a.cancel())});if(d)c.on("key",function(a){(9==a.data.keyCode&&c.execCommand("selectNextCell")||a.data.keyCode==CKEDITOR.SHIFT+9&&c.execCommand("selectPreviousCell"))&&a.cancel()});c.addCommand("blur",CKEDITOR.tools.extend(g,h));c.addCommand("blurBack",CKEDITOR.tools.extend(f,h));c.addCommand("selectNextCell",i());c.addCommand("selectPreviousCell",i(!0))}})})();CKEDITOR.dom.element.prototype.focusNext=function(i,h){var g=void 0===h?this.getTabIndex():h,f,c,d,e,b,a;if(0>=g)for(b=this.getNextSourceNode(i,CKEDITOR.NODE_ELEMENT);b;){if(b.isVisible()&&0===b.getTabIndex()){d=b;break}b=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT)}else for(b=this.getDocument().getBody().getFirst();b=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!f)if(!c&&b.equals(this)){if(c=!0,i){if(!(b=b.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;f=1}}else c&&!this.contains(b)&&(f=1);if(b.isVisible()&&!(0>(a=b.getTabIndex()))){if(f&&a==g){d=b;break}a>g&&(!d||!e||a<e)?(d=b,e=a):!d&&0===a&&(d=b,e=a)}}d&&d.focus()};CKEDITOR.dom.element.prototype.focusPrevious=function(i,h){for(var g=void 0===h?this.getTabIndex():h,f,c,d,e=0,b,a=this.getDocument().getBody().getLast();a=a.getPreviousSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!f)if(!c&&a.equals(this)){if(c=!0,i){if(!(a=a.getPreviousSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;f=1}}else c&&!this.contains(a)&&(f=1);if(a.isVisible()&&!(0>(b=a.getTabIndex())))if(0>=g){if(f&&0===b){d=a;break}b>e&&(d=a,e=b)}else{if(f&&b==g){d=a;break}if(b<g&&(!d||b>e))d=a,e=b}}d&&d.focus()};CKEDITOR.plugins.add("table",{requires:"dialog",init:function(a){function e(a){return CKEDITOR.tools.extend(a||{},{contextSensitive:1,refresh:function(a,f){this.setState(f.contains("table",1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}if(!a.blockless){var c=a.lang.table;a.addCommand("table",new CKEDITOR.dialogCommand("table",{context:"table",allowedContent:"table{width,height}[align,border,cellpadding,cellspacing,summary];caption tbody thead tfoot;th td tr[scope];"+(a.plugins.dialogadvtab?"table"+a.plugins.dialogadvtab.allowedContent():""),requiredContent:"table",contentTransformations:[["table{width}: sizeToStyle","table[width]: sizeToAttribute"]]}));a.addCommand("tableProperties",new CKEDITOR.dialogCommand("tableProperties",e()));a.addCommand("tableDelete",e({exec:function(a){var b=a.elementPath().contains("table",1);if(b){var d=b.getParent(),c=a.editable();1==d.getChildCount()&&(!d.is("td","th")&&!d.equals(c))&&(b=d);a=a.createRange();a.moveToPosition(b,CKEDITOR.POSITION_BEFORE_START);b.remove();a.select()}}}));a.ui.addButton&&a.ui.addButton("Table",{label:c.toolbar,command:"table",toolbar:"insert,30"});CKEDITOR.dialog.add("table",this.path+"dialogs/table.js");CKEDITOR.dialog.add("tableProperties",this.path+"dialogs/table.js");a.addMenuItems&&a.addMenuItems({table:{label:c.menu,command:"tableProperties",group:"table",order:5},tabledelete:{label:c.deleteTable,command:"tableDelete",group:"table",order:1}});a.on("doubleclick",function(a){a.data.element.is("table")&&(a.data.dialog="tableProperties")});a.contextMenu&&a.contextMenu.addListener(function(){return{tabledelete:CKEDITOR.TRISTATE_OFF,table:CKEDITOR.TRISTATE_OFF}})}}});(function(){function p(e){function d(a){!(0<b.length)&&(a.type==CKEDITOR.NODE_ELEMENT&&y.test(a.getName())&&!a.getCustomData("selected_cell"))&&(CKEDITOR.dom.element.setMarker(c,a,"selected_cell",!0),b.push(a))}for(var e=e.getRanges(),b=[],c={},a=0;a<e.length;a++){var f=e[a];if(f.collapsed)f=f.getCommonAncestor(),(f=f.getAscendant("td",!0)||f.getAscendant("th",!0))&&b.push(f);else{var f=new CKEDITOR.dom.walker(f),g;for(f.guard=d;g=f.next();)if(g.type!=CKEDITOR.NODE_ELEMENT||!g.is(CKEDITOR.dtd.table))if((g=g.getAscendant("td",!0)||g.getAscendant("th",!0))&&!g.getCustomData("selected_cell"))CKEDITOR.dom.element.setMarker(c,g,"selected_cell",!0),b.push(g)}}CKEDITOR.dom.element.clearAllMarkers(c);return b}function o(e,d){for(var b=p(e),c=b[0],a=c.getAscendant("table"),c=c.getDocument(),f=b[0].getParent(),g=f.$.rowIndex,b=b[b.length-1],h=b.getParent().$.rowIndex+b.$.rowSpan-1,b=new CKEDITOR.dom.element(a.$.rows[h]),g=d?g:h,f=d?f:b,b=CKEDITOR.tools.buildTableMap(a),a=b[g],g=d?b[g-1]:b[g+1],b=b[0].length,c=c.createElement("tr"),h=0;a[h]&&h<b;h++){var i;1<a[h].rowSpan&&g&&a[h]==g[h]?(i=a[h],i.rowSpan+=1):(i=(new CKEDITOR.dom.element(a[h])).clone(),i.removeAttribute("rowSpan"),i.appendBogus(),c.append(i),i=i.$);h+=i.colSpan-1}d?c.insertBefore(f):c.insertAfter(f)}function q(e){if(e instanceof CKEDITOR.dom.selection){for(var d=p(e),b=d[0].getAscendant("table"),c=CKEDITOR.tools.buildTableMap(b),e=d[0].getParent().$.rowIndex,d=d[d.length-1],a=d.getParent().$.rowIndex+d.$.rowSpan-1,d=[],f=e;f<=a;f++){for(var g=c[f],h=new CKEDITOR.dom.element(b.$.rows[f]),i=0;i<g.length;i++){var j=new CKEDITOR.dom.element(g[i]),l=j.getParent().$.rowIndex;1==j.$.rowSpan?j.remove():(j.$.rowSpan-=1,l==f&&(l=c[f+1],l[i-1]?j.insertAfter(new CKEDITOR.dom.element(l[i-1])):(new CKEDITOR.dom.element(b.$.rows[f+1])).append(j,1)));i+=j.$.colSpan-1}d.push(h)}c=b.$.rows;b=new CKEDITOR.dom.element(c[a+1]||(0<e?c[e-1]:null)||b.$.parentNode);for(f=d.length;0<=f;f--)q(d[f]);return b}e instanceof CKEDITOR.dom.element&&(b=e.getAscendant("table"),1==b.$.rows.length?b.remove():e.remove());return null}function r(e,d){for(var b=d?Infinity:0,c=0;c<e.length;c++){var a;a=e[c];for(var f=d,g=a.getParent().$.cells,h=0,i=0;i<g.length;i++){var j=g[i],h=h+(f?1:j.colSpan);if(j==a.$)break}a=h-1;if(d?a<b:a>b)b=a}return b}function k(e,d){for(var b=p(e),c=b[0].getAscendant("table"),a=r(b,1),b=r(b),a=d?a:b,f=CKEDITOR.tools.buildTableMap(c),c=[],b=[],g=f.length,h=0;h<g;h++)c.push(f[h][a]),b.push(d?f[h][a-1]:f[h][a+1]);for(h=0;h<g;h++)c[h]&&(1<c[h].colSpan&&b[h]==c[h]?(a=c[h],a.colSpan+=1):(a=(new CKEDITOR.dom.element(c[h])).clone(),a.removeAttribute("colSpan"),a.appendBogus(),a[d?"insertBefore":"insertAfter"].call(a,new CKEDITOR.dom.element(c[h])),a=a.$),h+=a.rowSpan-1)}function u(e,d){var b=e.getStartElement();if(b=b.getAscendant("td",1)||b.getAscendant("th",1)){var c=b.clone();c.appendBogus();d?c.insertBefore(b):c.insertAfter(b)}}function t(e){if(e instanceof CKEDITOR.dom.selection){var e=p(e),d=e[0]&&e[0].getAscendant("table"),b;a:{var c=0;b=e.length-
1;for(var a={},f,g;f=e[c++];)CKEDITOR.dom.element.setMarker(a,f,"delete_cell",!0);for(c=0;f=e[c++];)if((g=f.getPrevious())&&!g.getCustomData("delete_cell")||(g=f.getNext())&&!g.getCustomData("delete_cell")){CKEDITOR.dom.element.clearAllMarkers(a);b=g;break a}CKEDITOR.dom.element.clearAllMarkers(a);g=e[0].getParent();(g=g.getPrevious())?b=g.getLast():(g=e[b].getParent(),b=(g=g.getNext())?g.getChild(0):null)}for(g=e.length-1;0<=g;g--)t(e[g]);b?m(b,!0):d&&d.remove()}else e instanceof CKEDITOR.dom.element&&(d=e.getParent(),1==d.getChildCount()?d.remove():e.remove())}function m(e,d){var b=e.getDocument(),c=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(c.focus(),b.focus());b=new CKEDITOR.dom.range(b);if(!b["moveToElementEdit"+(d?"End":"Start")](e))b.selectNodeContents(e),b.collapse(d?!1:!0);b.select(!0)}function v(e,d,b){e=e[d];if("undefined"==typeof b)return e;for(d=0;e&&d<e.length;d++){if(b.is&&e[d]==b.$)return d;if(d==b)return new CKEDITOR.dom.element(e[d])}return b.is?-1:null}function s(e,d,b){var c=p(e),a;if((d?1!=c.length:2>c.length)||(a=e.getCommonAncestor())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("table"))return!1;var f,e=c[0];a=e.getAscendant("table");var g=CKEDITOR.tools.buildTableMap(a),h=g.length,i=g[0].length,j=e.getParent().$.rowIndex,l=v(g,j,e);if(d){var n;try{var m=parseInt(e.getAttribute("rowspan"),10)||1;f=parseInt(e.getAttribute("colspan"),10)||1;n=g["up"==d?j-m:"down"==d?j+m:j]["left"==d?l-f:"right"==d?l+f:l]}catch(z){return!1}if(!n||e.$==n)return!1;c["up"==d||"left"==d?"unshift":"push"](new CKEDITOR.dom.element(n))}for(var d=e.getDocument(),o=j,m=n=0,q=!b&&new CKEDITOR.dom.documentFragment(d),s=0,d=0;d<c.length;d++){f=c[d];var k=f.getParent(),t=f.getFirst(),r=f.$.colSpan,u=f.$.rowSpan,k=k.$.rowIndex,w=v(g,k,f),s=s+r*u,m=Math.max(m,w-l+r);n=Math.max(n,k-j+u);if(!b){r=f;(u=r.getBogus())&&u.remove();r.trim();if(f.getChildren().count()){if(k!=o&&t&&(!t.isBlockBoundary||!t.isBlockBoundary({br:1})))(o=q.getLast(CKEDITOR.dom.walker.whitespaces(!0)))&&(!o.is||!o.is("br"))&&q.append("br");f.moveChildren(q)}d?f.remove():f.setHtml("")}o=k}if(b)return n*m==s;q.moveChildren(e);e.appendBogus();m>=i?e.removeAttribute("rowSpan"):e.$.rowSpan=n;n>=h?e.removeAttribute("colSpan"):e.$.colSpan=m;b=new CKEDITOR.dom.nodeList(a.$.rows);c=b.count();for(d=c-1;0<=d;d--)a=b.getItem(d),a.$.cells.length||(a.remove(),c++);return e}function w(e,d){var b=p(e);if(1<b.length)return!1;if(d)return!0;var b=b[0],c=b.getParent(),a=c.getAscendant("table"),f=CKEDITOR.tools.buildTableMap(a),g=c.$.rowIndex,h=v(f,g,b),i=b.$.rowSpan,j;if(1<i){j=Math.ceil(i/2);for(var i=Math.floor(i/2),c=g+j,a=new CKEDITOR.dom.element(a.$.rows[c]),f=v(f,c),l,c=b.clone(),g=0;g<f.length;g++)if(l=f[g],l.parentNode==a.$&&g>h){c.insertBefore(new CKEDITOR.dom.element(l));break}else l=null;l||a.append(c)}else{i=j=1;a=c.clone();a.insertAfter(c);a.append(c=b.clone());l=v(f,g);for(h=0;h<l.length;h++)l[h].rowSpan++}c.appendBogus();b.$.rowSpan=j;c.$.rowSpan=i;1==j&&b.removeAttribute("rowSpan");1==i&&c.removeAttribute("rowSpan");return c}
function x(e,d){var b=p(e);if(1<b.length)return!1;if(d)return!0;var b=b[0],c=b.getParent(),a=c.getAscendant("table"),a=CKEDITOR.tools.buildTableMap(a),f=v(a,c.$.rowIndex,b),g=b.$.colSpan;if(1<g)c=Math.ceil(g/2),g=Math.floor(g/2);else{for(var g=c=1,h=[],i=0;i<a.length;i++){var j=a[i];h.push(j[f]);1<j[f].rowSpan&&(i+=j[f].rowSpan-1)}for(a=0;a<h.length;a++)h[a].colSpan++}a=b.clone();a.insertAfter(b);a.appendBogus();b.$.colSpan=c;a.$.colSpan=g;1==c&&b.removeAttribute("colSpan");1==g&&a.removeAttribute("colSpan");return a}var y=/^(?:td|th)$/;CKEDITOR.plugins.tabletools={requires:"table,dialog,contextmenu",init:function(e){function d(a){return CKEDITOR.tools.extend(a||{},{contextSensitive:1,refresh:function(a,b){this.setState(b.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function b(a,b){var c=e.addCommand(a,b);e.addFeature(c)}var c=e.lang.table;b("cellProperties",new CKEDITOR.dialogCommand("cellProperties",d({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",requiredContent:"table"})));CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js");b("rowDelete",d({requiredContent:"table",exec:function(a){a=a.getSelection();m(q(a))}}));b("rowInsertBefore",d({requiredContent:"table",exec:function(a){a=a.getSelection();o(a,!0)}}));b("rowInsertAfter",d({requiredContent:"table",exec:function(a){a=a.getSelection();o(a)}}));b("columnDelete",d({requiredContent:"table",exec:function(a){for(var a=a.getSelection(),a=p(a),b=a[0],c=a[a.length-1],a=b.getAscendant("table"),d=CKEDITOR.tools.buildTableMap(a),e,j,l=[],n=0,o=d.length;n<o;n++)for(var k=0,q=d[n].length;k<q;k++)d[n][k]==b.$&&(e=k),d[n][k]==c.$&&(j=k);for(n=e;n<=j;n++)for(k=0;k<d.length;k++)c=d[k],b=new CKEDITOR.dom.element(a.$.rows[k]),c=new CKEDITOR.dom.element(c[n]),c.$&&(1==c.$.colSpan?c.remove():c.$.colSpan-=1,k+=c.$.rowSpan-1,b.$.cells.length||l.push(b));j=a.$.rows[0]&&a.$.rows[0].cells;e=new CKEDITOR.dom.element(j[e]||(e?j[e-1]:a.$.parentNode));l.length==o&&a.remove();e&&m(e,!0)}}));b("columnInsertBefore",d({requiredContent:"table",exec:function(a){a=a.getSelection();k(a,!0)}}));b("columnInsertAfter",d({requiredContent:"table",exec:function(a){a=a.getSelection();k(a)}}));b("cellDelete",d({requiredContent:"table",exec:function(a){a=a.getSelection();t(a)}}));b("cellMerge",d({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(a){m(s(a.getSelection()),!0)}}));b("cellMergeRight",d({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(a){m(s(a.getSelection(),"right"),!0)}}));b("cellMergeDown",d({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(a){m(s(a.getSelection(),"down"),!0)}}));b("cellVerticalSplit",d({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(a){m(w(a.getSelection()))}}));b("cellHorizontalSplit",d({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(a){m(x(a.getSelection()))}}));b("cellInsertBefore",d({requiredContent:"table",exec:function(a){a=a.getSelection();u(a,!0)}}));b("cellInsertAfter",d({requiredContent:"table",exec:function(a){a=a.getSelection();u(a)}}));e.addMenuItems&&e.addMenuItems({tablecell:{label:c.cell.menu,group:"tablecell",order:1,getItems:function(){var a=e.getSelection(),b=p(a);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:s(a,null,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:s(a,"right",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:s(a,"down",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:w(a,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:x(a,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:0<b.length?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:c.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:c.cell.insertAfter,group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:c.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:c.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:c.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:c.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:c.cell.splitHorizontal,group:"tablecell",command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:c.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:c.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:c.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:c.row.insertBefore,group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:c.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:c.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:c.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:c.column.insertBefore,group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:c.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:c.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}});e.contextMenu&&e.contextMenu.addListener(function(a,b,c){return(a=c.contains({td:1,th:1},1))&&!a.isReadOnly()?{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}:null})},getSelectedCells:p};CKEDITOR.plugins.add("tabletools",CKEDITOR.plugins.tabletools)})();CKEDITOR.tools.buildTableMap=function(p){for(var p=p.$.rows,o=-1,q=[],r=0;r<p.length;r++){o++;!q[o]&&(q[o]=[]);for(var k=-1,u=0;u<p[r].cells.length;u++){var t=p[r].cells[u];for(k++;q[o][k];)k++;for(var m=isNaN(t.colSpan)?1:t.colSpan,t=isNaN(t.rowSpan)?1:t.rowSpan,v=0;v<t;v++){q[o+v]||(q[o+v]=[]);for(var s=0;s<m;s++)q[o+v][k+s]=p[r].cells[u]}k+=m-1}}return q};(function(){var g=[CKEDITOR.CTRL+90,CKEDITOR.CTRL+89,CKEDITOR.CTRL+CKEDITOR.SHIFT+90],l={8:1,46:1};CKEDITOR.plugins.add("undo",{init:function(a){function b(a){d.enabled&&!1!==a.data.command.canUndo&&d.save()}function c(){d.enabled=a.readOnly?!1:"wysiwyg"==a.mode;d.onChange()}var d=a.undoManager=new e(a),j=d.editingHandler=new i(d),f=a.addCommand("undo",{exec:function(){d.undo()&&(a.selectionChange(),this.fire("afterUndo"))},startDisabled:!0,canUndo:!1}),h=a.addCommand("redo",{exec:function(){d.redo()&&(a.selectionChange(),this.fire("afterRedo"))},startDisabled:!0,canUndo:!1});a.setKeystroke([[g[0],"undo"],[g[1],"redo"],[g[2],"redo"]]);d.onChange=function(){f.setState(d.undoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);h.setState(d.redoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)};a.on("beforeCommandExec",b);a.on("afterCommandExec",b);a.on("saveSnapshot",function(a){d.save(a.data&&a.data.contentOnly)});a.on("contentDom",j.attachListeners,j);a.on("instanceReady",function(){a.fire("saveSnapshot")});a.on("beforeModeUnload",function(){"wysiwyg"==a.mode&&d.save(!0)});a.on("mode",c);a.on("readOnly",c);a.ui.addButton&&(a.ui.addButton("Undo",{label:a.lang.undo.undo,command:"undo",toolbar:"undo,10"}),a.ui.addButton("Redo",{label:a.lang.undo.redo,command:"redo",toolbar:"undo,20"}));a.resetUndo=function(){d.reset();a.fire("saveSnapshot")};a.on("updateSnapshot",function(){d.currentImage&&d.update()});a.on("lockSnapshot",function(a){a=a.data;d.lock(a&&a.dontUpdate,a&&a.forceUpdate)});a.on("unlockSnapshot",d.unlock,d)}});CKEDITOR.plugins.undo={};var e=CKEDITOR.plugins.undo.UndoManager=function(a){this.strokesRecorded=[0,0];this.locked=null;this.previousKeyGroup=-1;this.limit=a.config.undoStackSize||20;this.strokesLimit=25;this.editor=a;this.reset()};e.prototype={type:function(a,b){var c=e.getKeyGroup(a),d=this.strokesRecorded[c]+1,b=b||d>=this.strokesLimit;this.typing||(this.hasUndo=this.typing=!0,this.hasRedo=!1,this.onChange());b?(d=0,this.editor.fire("saveSnapshot")):this.editor.fire("change");this.strokesRecorded[c]=d;this.previousKeyGroup=c},keyGroupChanged:function(a){return e.getKeyGroup(a)!=this.previousKeyGroup},reset:function(){this.snapshots=[];this.index=-1;this.currentImage=null;this.hasRedo=this.hasUndo=!1;this.locked=null;this.resetType()},resetType:function(){this.strokesRecorded=[0,0];this.typing=!1;this.previousKeyGroup=-1},refreshState:function(){this.hasUndo=!!this.getNextImage(!0);this.hasRedo=!!this.getNextImage(!1);this.resetType();this.onChange()},save:function(a,b,c){var d=this.editor;if(this.locked||"ready"!=d.status||"wysiwyg"!=d.mode)return!1;var e=d.editable();if(!e||"ready"!=e.status)return!1;e=this.snapshots;b||(b=new f(d));if(!1===b.contents)return!1;if(this.currentImage)if(b.equalsContent(this.currentImage)){if(a||b.equalsSelection(this.currentImage))return!1}else!1!==c&&d.fire("change");e.splice(this.index+1,e.length-this.index-1);e.length==this.limit&&e.shift();this.index=e.push(b)-1;this.currentImage=b;!1!==c&&this.refreshState();return!0},restoreImage:function(a){var b=this.editor,c;a.bookmarks&&(b.focus(),c=b.getSelection());this.locked={level:999};this.editor.loadSnapshot(a.contents);a.bookmarks?c.selectBookmarks(a.bookmarks):CKEDITOR.env.ie&&(c=this.editor.document.getBody().$.createTextRange(),c.collapse(!0),c.select());this.locked=null;this.index=a.index;this.currentImage=this.snapshots[this.index];this.update();this.refreshState();b.fire("change")},getNextImage:function(a){var b=this.snapshots,c=this.currentImage,d;if(c)if(a)for(d=this.index-1;0<=d;d--){if(a=b[d],!c.equalsContent(a))return a.index=d,a}else for(d=this.index+1;d<b.length;d++)if(a=b[d],!c.equalsContent(a))return a.index=d,a;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var a=this.getNextImage(!0);if(a)return this.restoreImage(a),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var a=this.getNextImage(!1);if(a)return this.restoreImage(a),!0}return!1},update:function(a){if(!this.locked){a||(a=new f(this.editor));for(var b=this.index,c=this.snapshots;0<b&&this.currentImage.equalsContent(c[b-1]);)b-=1;c.splice(b,this.index-b+1,a);this.index=b;this.currentImage=a}},updateSelection:function(a){if(!this.snapshots.length)return!1;var b=this.snapshots,c=b[b.length-1];return c.equalsContent(a)&&!c.equalsSelection(a)?(this.currentImage=b[b.length-1]=a,!0):!1},lock:function(a,b){if(this.locked)this.locked.level++;else if(a)this.locked={level:1};else{var c=null;if(b)c=!0;else{var d=new f(this.editor,!0);this.currentImage&&this.currentImage.equalsContent(d)&&(c=d)}this.locked={update:c,level:1}}},unlock:function(){if(this.locked&&!--this.locked.level){var a=this.locked.update;this.locked=null;if(!0===a)this.update();else if(a){var b=new f(this.editor,!0);a.equalsContent(b)||this.update()}}}};e.navigationKeyCodes={37:1,38:1,39:1,40:1,36:1,35:1,33:1,34:1};e.keyGroups={PRINTABLE:0,FUNCTIONAL:1};e.isNavigationKey=function(a){return!!e.navigationKeyCodes[a]};e.getKeyGroup=function(a){var b=e.keyGroups;return l[a]?b.FUNCTIONAL:b.PRINTABLE};e.getOppositeKeyGroup=function(a){var b=e.keyGroups;return a==b.FUNCTIONAL?b.PRINTABLE:b.FUNCTIONAL};e.ieFunctionalKeysBug=function(a){return CKEDITOR.env.ie&&e.getKeyGroup(a)==e.keyGroups.FUNCTIONAL};var f=CKEDITOR.plugins.undo.Image=function(a,b){this.editor=a;a.fire("beforeUndoImage");var c=a.getSnapshot();CKEDITOR.env.ie&&c&&(c=c.replace(/\s+data-cke-expando=".*?"/g,""));this.contents=c;b||(this.bookmarks=(c=c&&a.getSelection())&&c.createBookmarks2(!0));a.fire("afterUndoImage")},h=/\b(?:href|src|name)="[^"]*?"/gi;f.prototype={equalsContent:function(a){var b=this.contents,a=a.contents;if(CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks))b=b.replace(h,""),a=a.replace(h,"");return b!=a?!1:!0},equalsSelection:function(a){var b=this.bookmarks,a=a.bookmarks;if(b||a){if(!b||!a||b.length!=a.length)return!1;for(var c=0;c<b.length;c++){var d=b[c],e=a[c];if(d.startOffset!=e.startOffset||d.endOffset!=e.endOffset||!CKEDITOR.tools.arrayCompare(d.start,e.start)||!CKEDITOR.tools.arrayCompare(d.end,e.end))return!1}}return!0}};var i=CKEDITOR.plugins.undo.NativeEditingHandler=function(a){this.undoManager=a;this.ignoreInputEvent=!1;this.keyEventsStack=new k;this.lastKeydownImage=null};i.prototype={onKeydown:function(a){if(-1<CKEDITOR.tools.indexOf(g,a.data.getKeystroke()))a.data.preventDefault();else{this.keyEventsStack.cleanUp(a);var a=a.data.getKey(),b=this.undoManager;this.keyEventsStack.getLast(a)||this.keyEventsStack.push(a);this.lastKeydownImage=new f(b.editor);if(e.isNavigationKey(a)||this.undoManager.keyGroupChanged(a))if(b.strokesRecorded[0]||b.strokesRecorded[1])b.save(!1,this.lastKeydownImage,!1),b.resetType()}},onInput:function(){if(this.ignoreInputEvent)this.ignoreInputEvent=!1;else{var a=this.keyEventsStack.getLast();a||(a=this.keyEventsStack.push(0));this.keyEventsStack.increment(a.keyCode);this.keyEventsStack.getTotalInputs()>=this.undoManager.strokesLimit&&(this.undoManager.type(a.keyCode,!0),this.keyEventsStack.resetInputs())}},onKeyup:function(a){var b=this.undoManager,a=a.data.getKey(),c=this.keyEventsStack.getTotalInputs();this.keyEventsStack.remove(a);if(!e.ieFunctionalKeysBug(a)||!this.lastKeydownImage||!this.lastKeydownImage.equalsContent(new f(b.editor,!0)))if(0<c)b.type(a);else if(e.isNavigationKey(a))this.onNavigationKey(!0)},onNavigationKey:function(a){var b=this.undoManager;(a||!b.save(!0,null,!1))&&b.updateSelection(new f(b.editor));b.resetType()},ignoreInputEventListener:function(){this.ignoreInputEvent=!0},attachListeners:function(){var a=this.undoManager.editor,b=a.editable(),c=this;b.attachListener(b,"keydown",function(a){c.onKeydown(a);if(e.ieFunctionalKeysBug(a.data.getKey()))c.onInput()},null,null,999);b.attachListener(b,CKEDITOR.env.ie?"keypress":"input",c.onInput,c,null,999);b.attachListener(b,"keyup",c.onKeyup,c,null,999);b.attachListener(b,"paste",c.ignoreInputEventListener,c,null,999);b.attachListener(b,"drop",c.ignoreInputEventListener,c,null,999);b.attachListener(b.isInline()?b:a.document.getDocumentElement(),"click",function(){c.onNavigationKey()},null,null,999);b.attachListener(this.undoManager.editor,"blur",function(){c.keyEventsStack.remove(9)},null,null,999)}};var k=CKEDITOR.plugins.undo.KeyEventsStack=function(){this.stack=[]};k.prototype={push:function(a){return this.stack[this.stack.push({keyCode:a,inputs:0})-1]},getLastIndex:function(a){if("number"!=typeof a)return this.stack.length-1;for(var b=this.stack.length;b--;)if(this.stack[b].keyCode==a)return b;return-1},getLast:function(a){a=this.getLastIndex(a);return-1!=a?this.stack[a]:null},increment:function(a){this.getLast(a).inputs++},remove:function(a){a=this.getLastIndex(a);-1!=a&&this.stack.splice(a,1)},resetInputs:function(a){if("number"==typeof a)this.getLast(a).inputs=0;else for(a=this.stack.length;a--;)this.stack[a].inputs=0},getTotalInputs:function(){for(var a=this.stack.length,b=0;a--;)b+=this.stack[a].inputs;return b},cleanUp:function(a){a=a.data.$;!a.ctrlKey&&!a.metaKey&&this.remove(17);a.shiftKey||this.remove(16);a.altKey||this.remove(18)}}})();CKEDITOR.plugins.add("wsc",{requires:"dialog",parseApi:function(a){a.config.wsc_onFinish="function"===typeof a.config.wsc_onFinish?a.config.wsc_onFinish:function(){};a.config.wsc_onClose="function"===typeof a.config.wsc_onClose?a.config.wsc_onClose:function(){}},parseConfig:function(a){a.config.wsc_customerId=a.config.wsc_customerId||CKEDITOR.config.wsc_customerId||"1:ua3xw1-2XyGJ3-GWruD3-6OFNT1-oXcuB1-nR6Bp4-hgQHc-EcYng3-sdRXG3-NOfFk";a.config.wsc_customDictionaryIds=a.config.wsc_customDictionaryIds||CKEDITOR.config.wsc_customDictionaryIds||"";a.config.wsc_userDictionaryName=a.config.wsc_userDictionaryName||CKEDITOR.config.wsc_userDictionaryName||"";a.config.wsc_customLoaderScript=a.config.wsc_customLoaderScript||CKEDITOR.config.wsc_customLoaderScript;CKEDITOR.config.wsc_cmd=a.config.wsc_cmd||CKEDITOR.config.wsc_cmd||"spell";CKEDITOR.config.wsc_version="v4.3.0-26-g5bcf855";CKEDITOR.config.wsc_removeGlobalVariable=!0},init:function(a){var b=CKEDITOR.env;this.parseConfig(a);this.parseApi(a);a.addCommand("checkspell",new CKEDITOR.dialogCommand("checkspell")).modes={wysiwyg:!CKEDITOR.env.opera&&!CKEDITOR.env.air&&document.domain==window.location.hostname&&!(b.ie&&(8>b.version||b.quirks))};"undefined"==typeof a.plugins.scayt&&a.ui.addButton&&a.ui.addButton("SpellChecker",{label:a.lang.wsc.toolbar,click:function(a){var b=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.container.getText():a.document.getBody().getText();(b=b.replace(/\s/g,""))?a.execCommand("checkspell"):alert("Nothing to check!")},toolbar:"spellchecker,10"});CKEDITOR.dialog.add("checkspell",this.path+(CKEDITOR.env.ie&&7>=CKEDITOR.env.version?"dialogs/wsc_ie.js":window.postMessage?"dialogs/wsc.js":"dialogs/wsc_ie.js"))}});CKEDITOR.config.plugins='dialogui,dialog,about,a11yhelp,dialogadvtab,basicstyles,bidi,blockquote,clipboard,button,panelbutton,panel,floatpanel,colorbutton,colordialog,templates,menu,contextmenu,div,resize,toolbar,elementspath,enterkey,entities,popup,filebrowser,find,fakeobjects,flash,floatingspace,listblock,richcombo,font,forms,format,horizontalrule,htmlwriter,iframe,wysiwygarea,image,indent,indentblock,indentlist,smiley,justify,menubutton,language,link,list,liststyle,magicline,maximize,newpage,pagebreak,pastetext,pastefromword,preview,print,removeformat,save,selectall,showblocks,showborders,sourcearea,specialchar,scayt,stylescombo,tab,table,tabletools,undo,wsc';CKEDITOR.config.skin='moono';(function(){var setIcons=function(icons,strip){var path=CKEDITOR.getUrl('plugins/'+strip);icons=icons.split(',');for(var i=0;i<icons.length;i++)CKEDITOR.skin.icons[icons[i]]={path:path,offset:-icons[++i],bgsize:icons[++i]};};if(CKEDITOR.env.hidpi)setIcons('about,0,,bold,24,,italic,48,,strike,72,,subscript,96,,superscript,120,,underline,144,,bidiltr,168,,bidirtl,192,,blockquote,216,,copy-rtl,240,,copy,264,,cut-rtl,288,,cut,312,,paste-rtl,336,,paste,360,,bgcolor,384,,textcolor,408,,templates-rtl,432,,templates,456,,creatediv,480,,find-rtl,504,,find,528,,replace,552,,flash,576,,button,600,,checkbox,624,,form,648,,hiddenfield,672,,imagebutton,696,,radio,720,,select-rtl,744,,select,768,,textarea-rtl,792,,textarea,816,,textfield-rtl,840,,textfield,864,,horizontalrule,888,,iframe,912,,image,936,,indent-rtl,960,,indent,984,,outdent-rtl,1008,,outdent,1032,,smiley,1056,,justifyblock,1080,,justifycenter,1104,,justifyleft,1128,,justifyright,1152,,language,1176,,anchor-rtl,1200,,anchor,1224,,link,1248,,unlink,1272,,bulletedlist-rtl,1296,,bulletedlist,1320,,numberedlist-rtl,1344,,numberedlist,1368,,maximize,1392,,newpage-rtl,1416,,newpage,1440,,pagebreak-rtl,1464,,pagebreak,1488,,pastetext-rtl,1512,,pastetext,1536,,pastefromword-rtl,1560,,pastefromword,1584,,preview-rtl,1608,,preview,1632,,print,1656,,removeformat,1680,,save,1704,,selectall,1728,,showblocks-rtl,1752,,showblocks,1776,,source-rtl,1800,,source,1824,,specialchar,1848,,scayt,1872,,table,1896,,redo-rtl,1920,,redo,1944,,undo-rtl,1968,,undo,1992,,spellchecker,2016,','icons_hidpi.png');else setIcons('about,0,auto,bold,24,auto,italic,48,auto,strike,72,auto,subscript,96,auto,superscript,120,auto,underline,144,auto,bidiltr,168,auto,bidirtl,192,auto,blockquote,216,auto,copy-rtl,240,auto,copy,264,auto,cut-rtl,288,auto,cut,312,auto,paste-rtl,336,auto,paste,360,auto,bgcolor,384,auto,textcolor,408,auto,templates-rtl,432,auto,templates,456,auto,creatediv,480,auto,find-rtl,504,auto,find,528,auto,replace,552,auto,flash,576,auto,button,600,auto,checkbox,624,auto,form,648,auto,hiddenfield,672,auto,imagebutton,696,auto,radio,720,auto,select-rtl,744,auto,select,768,auto,textarea-rtl,792,auto,textarea,816,auto,textfield-rtl,840,auto,textfield,864,auto,horizontalrule,888,auto,iframe,912,auto,image,936,auto,indent-rtl,960,auto,indent,984,auto,outdent-rtl,1008,auto,outdent,1032,auto,smiley,1056,auto,justifyblock,1080,auto,justifycenter,1104,auto,justifyleft,1128,auto,justifyright,1152,auto,language,1176,auto,anchor-rtl,1200,auto,anchor,1224,auto,link,1248,auto,unlink,1272,auto,bulletedlist-rtl,1296,auto,bulletedlist,1320,auto,numberedlist-rtl,1344,auto,numberedlist,1368,auto,maximize,1392,auto,newpage-rtl,1416,auto,newpage,1440,auto,pagebreak-rtl,1464,auto,pagebreak,1488,auto,pastetext-rtl,1512,auto,pastetext,1536,auto,pastefromword-rtl,1560,auto,pastefromword,1584,auto,preview-rtl,1608,auto,preview,1632,auto,print,1656,auto,removeformat,1680,auto,save,1704,auto,selectall,1728,auto,showblocks-rtl,1752,auto,showblocks,1776,auto,source-rtl,1800,auto,source,1824,auto,specialchar,1848,auto,scayt,1872,auto,table,1896,auto,redo-rtl,1920,auto,redo,1944,auto,undo-rtl,1968,auto,undo,1992,auto,spellchecker,2016,auto','icons.png');})();CKEDITOR.lang.languages={"af":1,"sq":1,"ar":1,"eu":1,"bn":1,"bs":1,"bg":1,"ca":1,"zh-cn":1,"zh":1,"hr":1,"cs":1,"da":1,"nl":1,"en":1,"en-au":1,"en-ca":1,"en-gb":1,"eo":1,"et":1,"fo":1,"fi":1,"fr":1,"fr-ca":1,"gl":1,"ka":1,"de":1,"el":1,"gu":1,"he":1,"hi":1,"hu":1,"is":1,"id":1,"it":1,"ja":1,"km":1,"ko":1,"ku":1,"lv":1,"lt":1,"mk":1,"ms":1,"mn":1,"no":1,"nb":1,"fa":1,"pl":1,"pt-br":1,"pt":1,"ro":1,"ru":1,"sr":1,"sr-latn":1,"si":1,"sk":1,"sl":1,"es":1,"sv":1,"tt":1,"th":1,"tr":1,"ug":1,"uk":1,"vi":1,"cy":1};}());;

/* /web_ckeditor4/static/lib/ckeditor/config.js defined in bundle 'web.assets_backend' */
CKEDITOR.editorConfig=function(config){};;

/* /web_ckeditor4/static/src/js/web_ckeditor4.js defined in bundle 'web.assets_backend' */
openerp.web_ckeditor4=function(instance)
{var ckeditor_addFunction_org=CKEDITOR.tools.addFunction;CKEDITOR.tools.addFunction=function(fn,scope)
{if(scope&&scope._&&scope._.attrChanges&&scope._.detach)
{var scope_reference=scope;return ckeditor_addFunction_org(function()
{var self=this,self_arguments=arguments;setTimeout(function()
{if(self.editor)
{fn.apply(self,self_arguments);}},0);},scope);}
return ckeditor_addFunction_org(fn,scope);};CKEDITOR.on('dialogDefinition',function(e)
{_.each(e.data.definition.contents,function(element)
{if(!element||element.filebrowser!='uploadButton')
{return}
_.each(element.elements,function(element)
{if(!element.onClick||element.type!='fileButton')
{return}
var onClick_org=element.onClick;element.onClick=function(e1)
{onClick_org.apply(this,arguments);_.each(jQuery('#'+this.domId).closest('table').find('iframe').contents().find(':file').get(0).files,function(file)
{var reader=new FileReader();reader.onload=function(load_event)
{CKEDITOR.tools.callFunction(e.editor._.filebrowserFn,load_event.target.result,'');}
reader.readAsDataURL(file);});return false;}});});});instance.web.form.widgets.add('text_ckeditor4','instance.web_ckeditor4.FieldCKEditor4');instance.web.form.widgets.add('text_ckeditor4_raw','instance.web_ckeditor4.FieldCKEditor4Raw');instance.web.form.widgets.add('text_html','instance.web_ckeditor4.FieldCKEditor4');instance.web.form.widgets.add('html','instance.web_ckeditor4.FieldCKEditor4');function filter_html(value,ckeditor_filter,ckeditor_writer)
{var fragment=CKEDITOR.htmlParser.fragment.fromHtml(value);ckeditor_filter.applyTo(fragment);ckeditor_writer.reset();fragment.writeHtml(ckeditor_writer);return ckeditor_writer.getHtml();};default_ckeditor_filter=new CKEDITOR.filter({'*':{attributes:'href,src,style,alt,width,height,dir',styles:'*',classes:'*',},'html head title meta style body p div span a h1 h2 h3 h4 h5 img br hr table tr th td ul ol li dd dt strong pre b i':true,});default_ckeditor_writer=new CKEDITOR.htmlParser.basicWriter();instance.web_ckeditor4.FieldCKEditor4=instance.web.form.FieldText.extend({ckeditor_config:{removePlugins:'iframe,flash,forms,smiley,pagebreak,stylescombo',filebrowserImageUploadUrl:'dummy',extraPlugins:'filebrowser',entities_additional:'',},ckeditor_filter:default_ckeditor_filter,ckeditor_writer:default_ckeditor_writer,start:function()
{this._super.apply(this,arguments);CKEDITOR.lang.load(instance.session.user_context.lang.split('_')[0],'en',function(){});},initialize_content:function()
{var self=this;this._super.apply(this,arguments);if(!this.$textarea)
{return;}
this.editor=CKEDITOR.replace(this.$textarea.get(0),_.extend({language:instance.session.user_context.lang.split('_')[0],on:{'change':function()
{self.store_dom_value();},},},this.ckeditor_config));},store_dom_value:function()
{this.internal_set_value(this.editor?this.editor.getData():instance.web.parse_value(this.get('value'),this));},filter_html:function(value)
{return filter_html(value,this.ckeditor_filter,this.ckeditor_writer);},render_value:function()
{if(this.get("effective_readonly"))
{this.$el.html(this.filter_html(this.get('value')));}
else
{if(this.editor)
{var self=this;if(this.editor.status!='ready')
{var instanceReady=function()
{self.editor.setData(self.get('value')||'');self.editor.removeListener('instanceReady',instanceReady);};this.editor.on('instanceReady',instanceReady);}
else
{self.editor.setData(self.get('value')||'');}}}},undelegateEvents:function()
{this._cleanup_editor();return this._super.apply(this,arguments);},_cleanup_editor:function()
{if(this.editor)
{this.editor.removeAllListeners();this.editor.destroy();this.editor=null;}},destroy:function()
{this.destroy_content();this._super();},destroy_content:function()
{this._cleanup_editor();}});instance.web_ckeditor4.FieldCKEditor4Raw=instance.web_ckeditor4.FieldCKEditor4.extend({filter_html:function(value)
{return value;}});};

/* /web_diagram/static/lib/js/jquery.mousewheel.js defined in bundle 'web.assets_backend' */
(function($){var types=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel");},unmousewheel:function(fn){return this.unbind("mousewheel",fn);}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){delta=-orgEvent.detail/3;}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);;

/* /web_diagram/static/lib/js/raphael.js defined in bundle 'web.assets_backend' */
(function(glob){var version="0.3.4",has="hasOwnProperty",separator=/[\.\/]/,wildcard="*",fun=function(){},numsort=function(a,b){return a-b;},current_event,stop,events={n:{}},eve=function(name,scope){var e=events,oldstop=stop,args=Array.prototype.slice.call(arguments,2),listeners=eve.listeners(name),z=0,f=false,l,indexed=[],queue={},out=[],ce=current_event,errors=[];current_event=name;stop=0;for(var i=0,ii=listeners.length;i<ii;i++)if("zIndex"in listeners[i]){indexed.push(listeners[i].zIndex);if(listeners[i].zIndex<0){queue[listeners[i].zIndex]=listeners[i];}}
indexed.sort(numsort);while(indexed[z]<0){l=queue[indexed[z++]];out.push(l.apply(scope,args));if(stop){stop=oldstop;return out;}}
for(i=0;i<ii;i++){l=listeners[i];if("zIndex"in l){if(l.zIndex==indexed[z]){out.push(l.apply(scope,args));if(stop){break;}
do{z++;l=queue[indexed[z]];l&&out.push(l.apply(scope,args));if(stop){break;}}while(l)}else{queue[l.zIndex]=l;}}else{out.push(l.apply(scope,args));if(stop){break;}}}
stop=oldstop;current_event=ce;return out.length?out:null;};eve.listeners=function(name){var names=name.split(separator),e=events,item,items,k,i,ii,j,jj,nes,es=[e],out=[];for(i=0,ii=names.length;i<ii;i++){nes=[];for(j=0,jj=es.length;j<jj;j++){e=es[j].n;items=[e[names[i]],e[wildcard]];k=2;while(k--){item=items[k];if(item){nes.push(item);out=out.concat(item.f||[]);}}}
es=nes;}
return out;};eve.on=function(name,f){var names=name.split(separator),e=events;for(var i=0,ii=names.length;i<ii;i++){e=e.n;!e[names[i]]&&(e[names[i]]={n:{}});e=e[names[i]];}
e.f=e.f||[];for(i=0,ii=e.f.length;i<ii;i++)if(e.f[i]==f){return fun;}
e.f.push(f);return function(zIndex){if(+zIndex==+zIndex){f.zIndex=+zIndex;}};};eve.stop=function(){stop=1;};eve.nt=function(subname){if(subname){return new RegExp("(?:\\.|\\/|^)"+subname+"(?:\\.|\\/|$)").test(current_event);}
return current_event;};eve.off=eve.unbind=function(name,f){var names=name.split(separator),e,key,splice,i,ii,j,jj,cur=[events];for(i=0,ii=names.length;i<ii;i++){for(j=0;j<cur.length;j+=splice.length-2){splice=[j,1];e=cur[j].n;if(names[i]!=wildcard){if(e[names[i]]){splice.push(e[names[i]]);}}else{for(key in e)if(e[has](key)){splice.push(e[key]);}}
cur.splice.apply(cur,splice);}}
for(i=0,ii=cur.length;i<ii;i++){e=cur[i];while(e.n){if(f){if(e.f){for(j=0,jj=e.f.length;j<jj;j++)if(e.f[j]==f){e.f.splice(j,1);break;}
!e.f.length&&delete e.f;}
for(key in e.n)if(e.n[has](key)&&e.n[key].f){var funcs=e.n[key].f;for(j=0,jj=funcs.length;j<jj;j++)if(funcs[j]==f){funcs.splice(j,1);break;}
!funcs.length&&delete e.n[key].f;}}else{delete e.f;for(key in e.n)if(e.n[has](key)&&e.n[key].f){delete e.n[key].f;}}
e=e.n;}}};eve.once=function(name,f){var f2=function(){var res=f.apply(this,arguments);eve.unbind(name,f2);return res;};return eve.on(name,f2);};eve.version=version;eve.toString=function(){return"You are running Eve "+version;};(typeof module!="undefined"&&module.exports)?(module.exports=eve):(typeof define!="undefined"?(define("eve",[],function(){return eve;})):(glob.eve=eve));})(this);(function(){function R(first){if(R.is(first,"function")){return loaded?first():eve.on("DOMload",first);}else if(R.is(first,array)){return R._engine.create[apply](R,first.splice(0,3+R.is(first[0],nu))).add(first);}else{var args=Array.prototype.slice.call(arguments,0);if(R.is(args[args.length-1],"function")){var f=args.pop();return loaded?f.call(R._engine.create[apply](R,args)):eve.on("DOMload",function(){f.call(R._engine.create[apply](R,args));});}else{return R._engine.create[apply](R,arguments);}}}
R.version="2.0.2";R.eve=eve;var loaded,separator=/[, ]+/,elements={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},formatrg=/\{(\d+)\}/g,proto="prototype",has="hasOwnProperty",g={doc:document,win:window},oldRaphael={was:Object.prototype[has].call(g.win,"Raphael"),is:g.win.Raphael},Paper=function(){this.ca=this.customAttributes={};},paperproto,appendChild="appendChild",apply="apply",concat="concat",supportsTouch="createTouch"in g.doc,E="",S=" ",Str=String,split="split",events="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[split](S),touchMap={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},lowerCase=Str.prototype.toLowerCase,math=Math,mmax=math.max,mmin=math.min,abs=math.abs,pow=math.pow,PI=math.PI,nu="number",string="string",array="array",toString="toString",fillString="fill",objectToString=Object.prototype.toString,paper={},push="push",ISURL=R._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,colourRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,isnan={"NaN":1,"Infinity":1,"-Infinity":1},bezierrg=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,round=math.round,setAttribute="setAttribute",toFloat=parseFloat,toInt=parseInt,upperCase=Str.prototype.toUpperCase,availableAttrs=R._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},availableAnimAttrs=R._availableAnimAttrs={blur:nu,"clip-rect":"csv",cx:nu,cy:nu,fill:"colour","fill-opacity":nu,"font-size":nu,height:nu,opacity:nu,path:"path",r:nu,rx:nu,ry:nu,stroke:"colour","stroke-opacity":nu,"stroke-width":nu,transform:"transform",width:nu,x:nu,y:nu},whitespace=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,commaSpaces=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,hsrg={hs:1,rg:1},p2s=/,?([achlmqrstvxz]),?/gi,pathCommand=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,tCommand=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,pathValues=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,radial_gradient=R._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,eldata={},sortByKey=function(a,b){return a.key-b.key;},sortByNumber=function(a,b){return toFloat(a)-toFloat(b);},fun=function(){},pipe=function(x){return x;},rectPath=R._rectPath=function(x,y,w,h,r){if(r){return[["M",x+r,y],["l",w-r*2,0],["a",r,r,0,0,1,r,r],["l",0,h-r*2],["a",r,r,0,0,1,-r,r],["l",r*2-w,0],["a",r,r,0,0,1,-r,-r],["l",0,r*2-h],["a",r,r,0,0,1,r,-r],["z"]];}
return[["M",x,y],["l",w,0],["l",0,h],["l",-w,0],["z"]];},ellipsePath=function(x,y,rx,ry){if(ry==null){ry=rx;}
return[["M",x,y],["m",0,-ry],["a",rx,ry,0,1,1,0,2*ry],["a",rx,ry,0,1,1,0,-2*ry],["z"]];},getPath=R._getPath={path:function(el){return el.attr("path");},circle:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.r);},ellipse:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.rx,a.ry);},rect:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height,a.r);},image:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height);},text:function(el){var bbox=el._getBBox();return rectPath(bbox.x,bbox.y,bbox.width,bbox.height);}},mapPath=R.mapPath=function(path,matrix){if(!matrix){return path;}
var x,y,i,j,ii,jj,pathi;path=path2curve(path);for(i=0,ii=path.length;i<ii;i++){pathi=path[i];for(j=1,jj=pathi.length;j<jj;j+=2){x=matrix.x(pathi[j],pathi[j+1]);y=matrix.y(pathi[j],pathi[j+1]);pathi[j]=x;pathi[j+1]=y;}}
return path;};R._g=g;R.type=(g.win.SVGAngle||g.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(R.type=="VML"){var d=g.doc.createElement("div"),b;d.innerHTML='<v:shape adj="1"/>';b=d.firstChild;b.style.behavior="url(#default#VML)";if(!(b&&typeof b.adj=="object")){return(R.type=E);}
d=null;}
R.svg=!(R.vml=R.type=="VML");R._Paper=Paper;R.fn=paperproto=Paper.prototype=R.prototype;R._id=0;R._oid=0;R.is=function(o,type){type=lowerCase.call(type);if(type=="finite"){return!isnan[has](+o);}
if(type=="array"){return o instanceof Array;}
return(type=="null"&&o===null)||(type==typeof o&&o!==null)||(type=="object"&&o===Object(o))||(type=="array"&&Array.isArray&&Array.isArray(o))||objectToString.call(o).slice(8,-1).toLowerCase()==type;};R.angle=function(x1,y1,x2,y2,x3,y3){if(x3==null){var x=x1-x2,y=y1-y2;if(!x&&!y){return 0;}
return(180+math.atan2(-y,-x)*180/PI+360)%360;}else{return R.angle(x1,y1,x3,y3)-R.angle(x2,y2,x3,y3);}};R.rad=function(deg){return deg%360*PI/180;};R.deg=function(rad){return rad*180/PI%360;};R.snapTo=function(values,value,tolerance){tolerance=R.is(tolerance,"finite")?tolerance:10;if(R.is(values,array)){var i=values.length;while(i--)if(abs(values[i]-value)<=tolerance){return values[i];}}else{values=+values;var rem=value%values;if(rem<tolerance){return value-rem;}
if(rem>values-tolerance){return value-rem+values;}}
return value;};var createUUID=R.createUUID=(function(uuidRegEx,uuidReplacer){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(uuidRegEx,uuidReplacer).toUpperCase();};})(/[xy]/g,function(c){var r=math.random()*16|0,v=c=="x"?r:(r&3|8);return v.toString(16);});R.setWindow=function(newwin){eve("setWindow",R,g.win,newwin);g.win=newwin;g.doc=g.win.document;if(R._engine.initWin){R._engine.initWin(g.win);}};var toHex=function(color){if(R.vml){var trim=/^\s+|\s+$/g;var bod;try{var docum=new ActiveXObject("htmlfile");docum.write("<body>");docum.close();bod=docum.body;}catch(e){bod=createPopup().document.body;}
var range=bod.createTextRange();toHex=cacher(function(color){try{bod.style.color=Str(color).replace(trim,E);var value=range.queryCommandValue("ForeColor");value=((value&255)<<16)|(value&65280)|((value&16711680)>>>16);return"#"+("000000"+value.toString(16)).slice(-6);}catch(e){return"none";}});}else{var i=g.doc.createElement("i");i.title="Rapha\xebl Colour Picker";i.style.display="none";g.doc.body.appendChild(i);toHex=cacher(function(color){i.style.color=color;return g.doc.defaultView.getComputedStyle(i,E).getPropertyValue("color");});}
return toHex(color);},hsbtoString=function(){return"hsb("+[this.h,this.s,this.b]+")";},hsltoString=function(){return"hsl("+[this.h,this.s,this.l]+")";},rgbtoString=function(){return this.hex;},prepareRGB=function(r,g,b){if(g==null&&R.is(r,"object")&&"r"in r&&"g"in r&&"b"in r){b=r.b;g=r.g;r=r.r;}
if(g==null&&R.is(r,string)){var clr=R.getRGB(r);r=clr.r;g=clr.g;b=clr.b;}
if(r>1||g>1||b>1){r/=255;g/=255;b/=255;}
return[r,g,b];},packageRGB=function(r,g,b,o){r*=255;g*=255;b*=255;var rgb={r:r,g:g,b:b,hex:R.rgb(r,g,b),toString:rgbtoString};R.is(o,"finite")&&(rgb.opacity=o);return rgb;};R.color=function(clr){var rgb;if(R.is(clr,"object")&&"h"in clr&&"s"in clr&&"b"in clr){rgb=R.hsb2rgb(clr);clr.r=rgb.r;clr.g=rgb.g;clr.b=rgb.b;clr.hex=rgb.hex;}else if(R.is(clr,"object")&&"h"in clr&&"s"in clr&&"l"in clr){rgb=R.hsl2rgb(clr);clr.r=rgb.r;clr.g=rgb.g;clr.b=rgb.b;clr.hex=rgb.hex;}else{if(R.is(clr,"string")){clr=R.getRGB(clr);}
if(R.is(clr,"object")&&"r"in clr&&"g"in clr&&"b"in clr){rgb=R.rgb2hsl(clr);clr.h=rgb.h;clr.s=rgb.s;clr.l=rgb.l;rgb=R.rgb2hsb(clr);clr.v=rgb.b;}else{clr={hex:"none"};clr.r=clr.g=clr.b=clr.h=clr.s=clr.v=clr.l=-1;}}
clr.toString=rgbtoString;return clr;};R.hsb2rgb=function(h,s,v,o){if(this.is(h,"object")&&"h"in h&&"s"in h&&"b"in h){v=h.b;s=h.s;h=h.h;o=h.o;}
h*=360;var R,G,B,X,C;h=(h%360)/60;C=v*s;X=C*(1-abs(h%2-1));R=G=B=v-C;h=~~h;R+=[C,X,0,0,X,C][h];G+=[X,C,C,X,0,0][h];B+=[0,0,X,C,C,X][h];return packageRGB(R,G,B,o);};R.hsl2rgb=function(h,s,l,o){if(this.is(h,"object")&&"h"in h&&"s"in h&&"l"in h){l=h.l;s=h.s;h=h.h;}
if(h>1||s>1||l>1){h/=360;s/=100;l/=100;}
h*=360;var R,G,B,X,C;h=(h%360)/60;C=2*s*(l<.5?l:1-l);X=C*(1-abs(h%2-1));R=G=B=l-C/2;h=~~h;R+=[C,X,0,0,X,C][h];G+=[X,C,C,X,0,0][h];B+=[0,0,X,C,C,X][h];return packageRGB(R,G,B,o);};R.rgb2hsb=function(r,g,b){b=prepareRGB(r,g,b);r=b[0];g=b[1];b=b[2];var H,S,V,C;V=mmax(r,g,b);C=V-mmin(r,g,b);H=(C==0?null:V==r?(g-b)/C:V==g?(b-r)/C+2:(r-g)/C+4);H=((H+360)%6)*60/360;S=C==0?0:C/V;return{h:H,s:S,b:V,toString:hsbtoString};};R.rgb2hsl=function(r,g,b){b=prepareRGB(r,g,b);r=b[0];g=b[1];b=b[2];var H,S,L,M,m,C;M=mmax(r,g,b);m=mmin(r,g,b);C=M-m;H=(C==0?null:M==r?(g-b)/C:M==g?(b-r)/C+2:(r-g)/C+4);H=((H+360)%6)*60/360;L=(M+m)/2;S=(C==0?0:L<.5?C/(2*L):C/(2-2*L));return{h:H,s:S,l:L,toString:hsltoString};};R._path2string=function(){return this.join(",").replace(p2s,"$1");};function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item){return array.push(array.splice(i,1)[0]);}}
function cacher(f,scope,postprocessor){function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join("\u2400"),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];if(cache[has](args)){repush(count,args);return postprocessor?postprocessor(cache[args]):cache[args];}
count.length>=1e3&&delete cache[count.shift()];count.push(args);cache[args]=f[apply](scope,arg);return postprocessor?postprocessor(cache[args]):cache[args];}
return newf;}
var preload=R._preload=function(src,f){var img=g.doc.createElement("img");img.style.cssText="position:absolute;left:-9999em;top:-9999em";img.onload=function(){f.call(this);this.onload=null;g.doc.body.removeChild(this);};img.onerror=function(){g.doc.body.removeChild(this);};g.doc.body.appendChild(img);img.src=src;};function clrToString(){return this.hex;}
R.getRGB=cacher(function(colour){if(!colour||!!((colour=Str(colour)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString};}
if(colour=="none"){return{r:-1,g:-1,b:-1,hex:"none",toString:clrToString};}
!(hsrg[has](colour.toLowerCase().substring(0,2))||colour.charAt()=="#")&&(colour=toHex(colour));var res,red,green,blue,opacity,t,values,rgb=colour.match(colourRegExp);if(rgb){if(rgb[2]){blue=toInt(rgb[2].substring(5),16);green=toInt(rgb[2].substring(3,5),16);red=toInt(rgb[2].substring(1,3),16);}
if(rgb[3]){blue=toInt((t=rgb[3].charAt(3))+t,16);green=toInt((t=rgb[3].charAt(2))+t,16);red=toInt((t=rgb[3].charAt(1))+t,16);}
if(rgb[4]){values=rgb[4][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);rgb[1].toLowerCase().slice(0,4)=="rgba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);}
if(rgb[5]){values=rgb[5][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsb2rgb(red,green,blue,opacity);}
if(rgb[6]){values=rgb[6][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsla"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsl2rgb(red,green,blue,opacity);}
rgb={r:red,g:green,b:blue,toString:clrToString};rgb.hex="#"+(16777216|blue|(green<<8)|(red<<16)).toString(16).slice(1);R.is(opacity,"finite")&&(rgb.opacity=opacity);return rgb;}
return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString};},R);R.hsb=cacher(function(h,s,b){return R.hsb2rgb(h,s,b).hex;});R.hsl=cacher(function(h,s,l){return R.hsl2rgb(h,s,l).hex;});R.rgb=cacher(function(r,g,b){return"#"+(16777216|b|(g<<8)|(r<<16)).toString(16).slice(1);});R.getColor=function(value){var start=this.getColor.start=this.getColor.start||{h:0,s:1,b:value||.75},rgb=this.hsb2rgb(start.h,start.s,start.b);start.h+=.075;if(start.h>1){start.h=0;start.s-=.2;start.s<=0&&(this.getColor.start={h:0,s:1,b:start.b});}
return rgb.hex;};R.getColor.reset=function(){delete this.start;};function catmullRom2bezier(crp,z){var d=[];for(var i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];if(z){if(!i){p[0]={x:+crp[iLen-2],y:+crp[iLen-1]};}else if(iLen-4==i){p[3]={x:+crp[0],y:+crp[1]};}else if(iLen-2==i){p[2]={x:+crp[0],y:+crp[1]};p[3]={x:+crp[2],y:+crp[3]};}}else{if(iLen-4==i){p[3]=p[2];}else if(!i){p[0]={x:+crp[i],y:+crp[i+1]};}}
d.push(["C",(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y]);}
return d;}
R.parsePathString=cacher(function(pathString){if(!pathString){return null;}
var paramCounts={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},data=[];if(R.is(pathString,array)&&R.is(pathString[0],array)){data=pathClone(pathString);}
if(!data.length){Str(pathString).replace(pathCommand,function(a,b,c){var params=[],name=b.toLowerCase();c.replace(pathValues,function(a,b){b&&params.push(+b);});if(name=="m"&&params.length>2){data.push([b][concat](params.splice(0,2)));name="l";b=b=="m"?"l":"L";}
if(name=="r"){data.push([b][concat](params));}else while(params.length>=paramCounts[name]){data.push([b][concat](params.splice(0,paramCounts[name])));if(!paramCounts[name]){break;}}});}
data.toString=R._path2string;return data;});R.parseTransformString=cacher(function(TString){if(!TString){return null;}
var paramCounts={r:3,s:4,t:2,m:6},data=[];if(R.is(TString,array)&&R.is(TString[0],array)){data=pathClone(TString);}
if(!data.length){Str(TString).replace(tCommand,function(a,b,c){var params=[],name=lowerCase.call(b);c.replace(pathValues,function(a,b){b&&params.push(+b);});data.push([b][concat](params));});}
data.toString=R._path2string;return data;});R.findDotsAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+t12*3*t*c1x+t1*3*t*t*c2x+t3*p2x,y=t13*p1y+t12*3*t*c1y+t1*3*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y),ax=t1*p1x+t*c1x,ay=t1*p1y+t*c1y,cx=t1*c2x+t*p2x,cy=t1*c2y+t*p2y,alpha=(90-math.atan2(mx-nx,my-ny)*180/PI);(mx>nx||my<ny)&&(alpha+=180);return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:ax,y:ay},end:{x:cx,y:cy},alpha:alpha};};R._removedFactory=function(methodname){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+methodname+"\u201d of removed object");};};var pathDimensions=cacher(function(path){if(!path){return{x:0,y:0,width:0,height:0};}
path=path2curve(path);var x=0,y=0,X=[],Y=[],p;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=="M"){x=p[1];y=p[2];X.push(x);Y.push(y);}else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X[concat](dim.min.x,dim.max.x);Y=Y[concat](dim.min.y,dim.max.y);x=p[5];y=p[6];}}
var xmin=mmin[apply](0,X),ymin=mmin[apply](0,Y);return{x:xmin,y:ymin,width:mmax[apply](0,X)-xmin,height:mmax[apply](0,Y)-ymin};},null,function(o){return{x:o.x,y:o.y,width:o.width,height:o.height};}),pathClone=function(pathArray){var res=[];if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
for(var i=0,ii=pathArray.length;i<ii;i++){res[i]=[];for(var j=0,jj=pathArray[i].length;j<jj;j++){res[i][j]=pathArray[i][j];}}
res.toString=R._path2string;return res;},pathToRelative=R._pathToRelative=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=pathArray[0][1];y=pathArray[0][2];mx=x;my=y;start++;res.push(["M",x,y]);}
for(var i=start,ii=pathArray.length;i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0])){r[0]=lowerCase.call(pa[0]);switch(r[0]){case"a":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]-x).toFixed(3);r[7]=+(pa[7]-y).toFixed(3);break;case"v":r[1]=+(pa[1]-y).toFixed(3);break;case"m":mx=pa[1];my=pa[2];default:for(var j=1,jj=pa.length;j<jj;j++){r[j]=+(pa[j]-((j%2)?x:y)).toFixed(3);}}}else{r=res[i]=[];if(pa[0]=="m"){mx=pa[1]+x;my=pa[2]+y;}
for(var k=0,kk=pa.length;k<kk;k++){res[i][k]=pa[k];}}
var len=res[i].length;switch(res[i][0]){case"z":x=mx;y=my;break;case"h":x+=+res[i][len-1];break;case"v":y+=+res[i][len-1];break;default:x+=+res[i][len-2];y+=+res[i][len-1];}}
res.toString=R._path2string;return res;},0,pathClone),pathToAbsolute=R._pathToAbsolute=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
if(!pathArray||!pathArray.length){return[["M",0,0]];}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=+pathArray[0][1];y=+pathArray[0][2];mx=x;my=y;start++;res[0]=["M",x,y];}
var crz=pathArray.length==3&&pathArray[0][0]=="M"&&pathArray[1][0].toUpperCase()=="R"&&pathArray[2][0].toUpperCase()=="Z";for(var r,pa,i=start,ii=pathArray.length;i<ii;i++){res.push(r=[]);pa=pathArray[i];if(pa[0]!=upperCase.call(pa[0])){r[0]=upperCase.call(pa[0]);switch(r[0]){case"A":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]+x);r[7]=+(pa[7]+y);break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"R":var dots=[x,y][concat](pa.slice(1));for(var j=2,jj=dots.length;j<jj;j++){dots[j]=+dots[j]+x;dots[++j]=+dots[j]+y;}
res.pop();res=res[concat](catmullRom2bezier(dots,crz));break;case"M":mx=+pa[1]+x;my=+pa[2]+y;default:for(j=1,jj=pa.length;j<jj;j++){r[j]=+pa[j]+((j%2)?x:y);}}}else if(pa[0]=="R"){dots=[x,y][concat](pa.slice(1));res.pop();res=res[concat](catmullRom2bezier(dots,crz));r=["R"][concat](pa.slice(-2));}else{for(var k=0,kk=pa.length;k<kk;k++){r[k]=pa[k];}}
switch(r[0]){case"Z":x=mx;y=my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2];my=r[r.length-1];default:x=r[r.length-2];y=r[r.length-1];}}
res.toString=R._path2string;return res;},null,pathClone),l2c=function(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2];},q2c=function(x1,y1,ax,ay,x2,y2){var _13=1/3,_23=2/3;return[_13*x1+_23*ax,_13*y1+_23*ay,_13*x2+_23*ax,_13*y2+_23*ay,x2,y2];},a2c=function(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var _120=PI*120/180,rad=PI/180*(+angle||0),res=[],xy,rotate=cacher(function(x,y,rad){var X=x*math.cos(rad)-y*math.sin(rad),Y=x*math.sin(rad)+y*math.cos(rad);return{x:X,y:Y};});if(!recursive){xy=rotate(x1,y1,-rad);x1=xy.x;y1=xy.y;xy=rotate(x2,y2,-rad);x2=xy.x;y2=xy.y;var cos=math.cos(PI/180*angle),sin=math.sin(PI/180*angle),x=(x1-x2)/2,y=(y1-y2)/2;var h=(x*x)/(rx*rx)+(y*y)/(ry*ry);if(h>1){h=math.sqrt(h);rx=h*rx;ry=h*ry;}
var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1;f2=x2<cx?PI-f2:f2;f1<0&&(f1=PI*2+f1);f2<0&&(f2=PI*2+f2);if(sweep_flag&&f1>f2){f1=f1-PI*2;}
if(!sweep_flag&&f2>f1){f2=f2-PI*2;}}else{f1=recursive[0];f2=recursive[1];cx=recursive[2];cy=recursive[3];}
var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);x2=cx+rx*math.cos(f2);y2=cy+ry*math.sin(f2);res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy]);}
df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];m2[0]=2*m1[0]-m2[0];m2[1]=2*m1[1]-m2[1];if(recursive){return[m2,m3,m4][concat](res);}else{res=[m2,m3,m4][concat](res).join()[split](",");var newres=[];for(var i=0,ii=res.length;i<ii;i++){newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;}
return newres;}},findDotAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t;return{x:pow(t1,3)*p1x+pow(t1,2)*3*t*c1x+t1*3*t*t*c2x+pow(t,3)*p2x,y:pow(t1,3)*p1y+pow(t1,2)*3*t*c1y+t1*3*t*t*c2y+pow(t,3)*p2y};},curveDim=cacher(function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){var a=(c2x-2*c1x+p1x)-(p2x-2*c2x+c1x),b=2*(c1x-p1x)-2*(c2x-c1x),c=p1x-c1x,t1=(-b+math.sqrt(b*b-4*a*c))/2/a,t2=(-b-math.sqrt(b*b-4*a*c))/2/a,y=[p1y,p2y],x=[p1x,p2x],dot;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x.push(dot.x);y.push(dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x.push(dot.x);y.push(dot.y);}
a=(c2y-2*c1y+p1y)-(p2y-2*c2y+c1y);b=2*(c1y-p1y)-2*(c2y-c1y);c=p1y-c1y;t1=(-b+math.sqrt(b*b-4*a*c))/2/a;t2=(-b-math.sqrt(b*b-4*a*c))/2/a;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x.push(dot.x);y.push(dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x.push(dot.x);y.push(dot.y);}
return{min:{x:mmin[apply](0,x),y:mmin[apply](0,y)},max:{x:mmax[apply](0,x),y:mmax[apply](0,y)}};}),path2curve=R._path2curve=cacher(function(path,path2){var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=function(path,d){var nx,ny;if(!path){return["C",d.x,d.y,d.x,d.y,d.x,d.y];}
!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null);switch(path[0]){case"M":d.X=path[1];d.Y=path[2];break;case"A":path=["C"][concat](a2c[apply](0,[d.x,d.y][concat](path.slice(1))));break;case"S":nx=d.x+(d.x-(d.bx||d.x));ny=d.y+(d.y-(d.by||d.y));path=["C",nx,ny][concat](path.slice(1));break;case"T":d.qx=d.x+(d.x-(d.qx||d.x));d.qy=d.y+(d.y-(d.qy||d.y));path=["C"][concat](q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1];d.qy=path[2];path=["C"][concat](q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"][concat](l2c(d.x,d.y,path[1],path[2]));break;case"H":path=["C"][concat](l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"][concat](l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"][concat](l2c(d.x,d.y,d.X,d.Y));break;}
return path;},fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();var pi=pp[i];while(pi.length){pp.splice(i++,0,["C"][concat](pi.splice(0,6)));}
pp.splice(i,1);ii=mmax(p.length,p2&&p2.length||0);}},fixM=function(path1,path2,a1,a2,i){if(path1&&path2&&path1[i][0]=="M"&&path2[i][0]!="M"){path2.splice(i,0,["M",a2.x,a2.y]);a1.bx=0;a1.by=0;a1.x=path1[i][1];a1.y=path1[i][2];ii=mmax(p.length,p2&&p2.length||0);}};for(var i=0,ii=mmax(p.length,p2&&p2.length||0);i<ii;i++){p[i]=processPath(p[i],attrs);fixArc(p,i);p2&&(p2[i]=processPath(p2[i],attrs2));p2&&fixArc(p2,i);fixM(p,p2,attrs,attrs2,i);fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2];attrs.y=seg[seglen-1];attrs.bx=toFloat(seg[seglen-4])||attrs.x;attrs.by=toFloat(seg[seglen-3])||attrs.y;attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x);attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y);attrs2.x=p2&&seg2[seg2len-2];attrs2.y=p2&&seg2[seg2len-1];}
return p2?[p,p2]:p;},null,pathClone),parseDots=R._parseDots=cacher(function(gradient){var dots=[];for(var i=0,ii=gradient.length;i<ii;i++){var dot={},par=gradient[i].match(/^([^:]*):?([\d\.]*)/);dot.color=R.getRGB(par[1]);if(dot.color.error){return null;}
dot.color=dot.color.hex;par[2]&&(dot.offset=par[2]+"%");dots.push(dot);}
for(i=1,ii=dots.length-1;i<ii;i++){if(!dots[i].offset){var start=toFloat(dots[i-1].offset||0),end=0;for(var j=i+1;j<ii;j++){if(dots[j].offset){end=dots[j].offset;break;}}
if(!end){end=100;j=ii;}
end=toFloat(end);var d=(end-start)/(j-i+1);for(;i<j;i++){start+=d;dots[i].offset=start+"%";}}}
return dots;}),tear=R._tear=function(el,paper){el==paper.top&&(paper.top=el.prev);el==paper.bottom&&(paper.bottom=el.next);el.next&&(el.next.prev=el.prev);el.prev&&(el.prev.next=el.next);},tofront=R._tofront=function(el,paper){if(paper.top===el){return;}
tear(el,paper);el.next=null;el.prev=paper.top;paper.top.next=el;paper.top=el;},toback=R._toback=function(el,paper){if(paper.bottom===el){return;}
tear(el,paper);el.next=paper.bottom;el.prev=null;paper.bottom.prev=el;paper.bottom=el;},insertafter=R._insertafter=function(el,el2,paper){tear(el,paper);el2==paper.top&&(paper.top=el);el2.next&&(el2.next.prev=el);el.next=el2.next;el.prev=el2;el2.next=el;},insertbefore=R._insertbefore=function(el,el2,paper){tear(el,paper);el2==paper.bottom&&(paper.bottom=el);el2.prev&&(el2.prev.next=el);el.prev=el2.prev;el2.prev=el;el.next=el2;},extractTransform=R._extractTransform=function(el,tstr){if(tstr==null){return el._.transform;}
tstr=Str(tstr).replace(/\.{3}|\u2026/g,el._.transform||E);var tdata=R.parseTransformString(tstr),deg=0,dx=0,dy=0,sx=1,sy=1,_=el._,m=new Matrix;_.transform=tdata||[];if(tdata){for(var i=0,ii=tdata.length;i<ii;i++){var t=tdata[i],tlen=t.length,command=Str(t[0]).toLowerCase(),absolute=t[0]!=command,inver=absolute?m.invert():0,x1,y1,x2,y2,bb;if(command=="t"&&tlen==3){if(absolute){x1=inver.x(0,0);y1=inver.y(0,0);x2=inver.x(t[1],t[2]);y2=inver.y(t[1],t[2]);m.translate(x2-x1,y2-y1);}else{m.translate(t[1],t[2]);}}else if(command=="r"){if(tlen==2){bb=bb||el.getBBox(1);m.rotate(t[1],bb.x+bb.width/2,bb.y+bb.height/2);deg+=t[1];}else if(tlen==4){if(absolute){x2=inver.x(t[2],t[3]);y2=inver.y(t[2],t[3]);m.rotate(t[1],x2,y2);}else{m.rotate(t[1],t[2],t[3]);}
deg+=t[1];}}else if(command=="s"){if(tlen==2||tlen==3){bb=bb||el.getBBox(1);m.scale(t[1],t[tlen-1],bb.x+bb.width/2,bb.y+bb.height/2);sx*=t[1];sy*=t[tlen-1];}else if(tlen==5){if(absolute){x2=inver.x(t[3],t[4]);y2=inver.y(t[3],t[4]);m.scale(t[1],t[2],x2,y2);}else{m.scale(t[1],t[2],t[3],t[4]);}
sx*=t[1];sy*=t[2];}}else if(command=="m"&&tlen==7){m.add(t[1],t[2],t[3],t[4],t[5],t[6]);}
_.dirtyT=1;el.matrix=m;}}
el.matrix=m;_.sx=sx;_.sy=sy;_.deg=deg;_.dx=dx=m.e;_.dy=dy=m.f;if(sx==1&&sy==1&&!deg&&_.bbox){_.bbox.x+=+dx;_.bbox.y+=+dy;}else{_.dirtyT=1;}},getEmpty=function(item){var l=item[0];switch(l.toLowerCase()){case"t":return[l,0,0];case"m":return[l,1,0,0,1,0,0];case"r":if(item.length==4){return[l,0,item[2],item[3]];}else{return[l,0];}
case"s":if(item.length==5){return[l,1,1,item[3],item[4]];}else if(item.length==3){return[l,1,1];}else{return[l,1];}}},equaliseTransform=R._equaliseTransform=function(t1,t2){t2=Str(t2).replace(/\.{3}|\u2026/g,t1);t1=R.parseTransformString(t1)||[];t2=R.parseTransformString(t2)||[];var maxlength=mmax(t1.length,t2.length),from=[],to=[],i=0,j,jj,tt1,tt2;for(;i<maxlength;i++){tt1=t1[i]||getEmpty(t2[i]);tt2=t2[i]||getEmpty(tt1);if((tt1[0]!=tt2[0])||(tt1[0].toLowerCase()=="r"&&(tt1[2]!=tt2[2]||tt1[3]!=tt2[3]))||(tt1[0].toLowerCase()=="s"&&(tt1[3]!=tt2[3]||tt1[4]!=tt2[4]))){return;}
from[i]=[];to[i]=[];for(j=0,jj=mmax(tt1.length,tt2.length);j<jj;j++){j in tt1&&(from[i][j]=tt1[j]);j in tt2&&(to[i][j]=tt2[j]);}}
return{from:from,to:to};};R._getContainer=function(x,y,w,h){var container;container=h==null&&!R.is(x,"object")?g.doc.getElementById(x):x;if(container==null){return;}
if(container.tagName){if(y==null){return{container:container,width:container.style.pixelWidth||container.offsetWidth,height:container.style.pixelHeight||container.offsetHeight};}else{return{container:container,width:y,height:w};}}
return{container:1,x:x,y:y,width:w,height:h};};R.pathToRelative=pathToRelative;R._engine={};R.path2curve=path2curve;R.matrix=function(a,b,c,d,e,f){return new Matrix(a,b,c,d,e,f);};function Matrix(a,b,c,d,e,f){if(a!=null){this.a=+a;this.b=+b;this.c=+c;this.d=+d;this.e=+e;this.f=+f;}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0;}}
(function(matrixproto){matrixproto.add=function(a,b,c,d,e,f){var out=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],matrix=[[a,c,e],[b,d,f],[0,0,1]],x,y,z,res;if(a&&a instanceof Matrix){matrix=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]];}
for(x=0;x<3;x++){for(y=0;y<3;y++){res=0;for(z=0;z<3;z++){res+=m[x][z]*matrix[z][y];}
out[x][y]=res;}}
this.a=out[0][0];this.b=out[1][0];this.c=out[0][1];this.d=out[1][1];this.e=out[0][2];this.f=out[1][2];};matrixproto.invert=function(){var me=this,x=me.a*me.d-me.b*me.c;return new Matrix(me.d/x,-me.b/x,-me.c/x,me.a/x,(me.c*me.f-me.d*me.e)/x,(me.b*me.e-me.a*me.f)/x);};matrixproto.clone=function(){return new Matrix(this.a,this.b,this.c,this.d,this.e,this.f);};matrixproto.translate=function(x,y){this.add(1,0,0,1,x,y);};matrixproto.scale=function(x,y,cx,cy){y==null&&(y=x);(cx||cy)&&this.add(1,0,0,1,cx,cy);this.add(x,0,0,y,0,0);(cx||cy)&&this.add(1,0,0,1,-cx,-cy);};matrixproto.rotate=function(a,x,y){a=R.rad(a);x=x||0;y=y||0;var cos=+math.cos(a).toFixed(9),sin=+math.sin(a).toFixed(9);this.add(cos,sin,-sin,cos,x,y);this.add(1,0,0,1,-x,-y);};matrixproto.x=function(x,y){return x*this.a+y*this.c+this.e;};matrixproto.y=function(x,y){return x*this.b+y*this.d+this.f;};matrixproto.get=function(i){return+this[Str.fromCharCode(97+i)].toFixed(4);};matrixproto.toString=function(){return R.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join();};matrixproto.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')";};matrixproto.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)];};function norm(a){return a[0]*a[0]+a[1]*a[1];}
function normalize(a){var mag=math.sqrt(norm(a));a[0]&&(a[0]/=mag);a[1]&&(a[1]/=mag);}
matrixproto.split=function(){var out={};out.dx=this.e;out.dy=this.f;var row=[[this.a,this.c],[this.b,this.d]];out.scalex=math.sqrt(norm(row[0]));normalize(row[0]);out.shear=row[0][0]*row[1][0]+row[0][1]*row[1][1];row[1]=[row[1][0]-row[0][0]*out.shear,row[1][1]-row[0][1]*out.shear];out.scaley=math.sqrt(norm(row[1]));normalize(row[1]);out.shear/=out.scaley;var sin=-row[0][1],cos=row[1][1];if(cos<0){out.rotate=R.deg(math.acos(cos));if(sin<0){out.rotate=360-out.rotate;}}else{out.rotate=R.deg(math.asin(sin));}
out.isSimple=!+out.shear.toFixed(9)&&(out.scalex.toFixed(9)==out.scaley.toFixed(9)||!out.rotate);out.isSuperSimple=!+out.shear.toFixed(9)&&out.scalex.toFixed(9)==out.scaley.toFixed(9)&&!out.rotate;out.noRotation=!+out.shear.toFixed(9)&&!out.rotate;return out;};matrixproto.toTransformString=function(shorter){var s=shorter||this[split]();if(s.isSimple){s.scalex=+s.scalex.toFixed(4);s.scaley=+s.scaley.toFixed(4);s.rotate=+s.rotate.toFixed(4);return(s.dx||s.dy?"t"+[s.dx,s.dy]:E)+
(s.scalex!=1||s.scaley!=1?"s"+[s.scalex,s.scaley,0,0]:E)+
(s.rotate?"r"+[s.rotate,0,0]:E);}else{return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)];}};})(Matrix.prototype);var version=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);if((navigator.vendor=="Apple Computer, Inc.")&&(version&&version[1]<4||navigator.platform.slice(0,2)=="iP")||(navigator.vendor=="Google Inc."&&version&&version[1]<8)){paperproto.safari=function(){var rect=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){rect.remove();});};}else{paperproto.safari=fun;}
var preventDefault=function(){this.returnValue=false;},preventTouch=function(){return this.originalEvent.preventDefault();},stopPropagation=function(){this.cancelBubble=true;},stopTouch=function(){return this.originalEvent.stopPropagation();},addEvent=(function(){if(g.doc.addEventListener){return function(obj,type,fn,element){var realName=supportsTouch&&touchMap[type]?touchMap[type]:type,f=function(e){var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,x=e.clientX+scrollX,y=e.clientY+scrollY;if(supportsTouch&&touchMap[has](type)){for(var i=0,ii=e.targetTouches&&e.targetTouches.length;i<ii;i++){if(e.targetTouches[i].target==obj){var olde=e;e=e.targetTouches[i];e.originalEvent=olde;e.preventDefault=preventTouch;e.stopPropagation=stopTouch;break;}}}
return fn.call(element,e,x,y);};obj.addEventListener(realName,f,false);return function(){obj.removeEventListener(realName,f,false);return true;};};}else if(g.doc.attachEvent){return function(obj,type,fn,element){var f=function(e){e=e||g.win.event;var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,x=e.clientX+scrollX,y=e.clientY+scrollY;e.preventDefault=e.preventDefault||preventDefault;e.stopPropagation=e.stopPropagation||stopPropagation;return fn.call(element,e,x,y);};obj.attachEvent("on"+type,f);var detacher=function(){obj.detachEvent("on"+type,f);return true;};return detacher;};}})(),drag=[],dragMove=function(e){var x=e.clientX,y=e.clientY,scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,dragi,j=drag.length;while(j--){dragi=drag[j];if(supportsTouch){var i=e.touches.length,touch;while(i--){touch=e.touches[i];if(touch.identifier==dragi.el._drag.id){x=touch.clientX;y=touch.clientY;(e.originalEvent?e.originalEvent:e).preventDefault();break;}}}else{e.preventDefault();}
var node=dragi.el.node,o,next=node.nextSibling,parent=node.parentNode,display=node.style.display;g.win.opera&&parent.removeChild(node);node.style.display="none";o=dragi.el.paper.getElementByPoint(x,y);node.style.display=display;g.win.opera&&(next?parent.insertBefore(node,next):parent.appendChild(node));o&&eve("drag.over."+dragi.el.id,dragi.el,o);x+=scrollX;y+=scrollY;eve("drag.move."+dragi.el.id,dragi.move_scope||dragi.el,x-dragi.el._drag.x,y-dragi.el._drag.y,x,y,e);}},dragUp=function(e){R.unmousemove(dragMove).unmouseup(dragUp);var i=drag.length,dragi;while(i--){dragi=drag[i];dragi.el._drag={};eve("drag.end."+dragi.el.id,dragi.end_scope||dragi.start_scope||dragi.move_scope||dragi.el,e);}
drag=[];},elproto=R.el={};for(var i=events.length;i--;){(function(eventName){R[eventName]=elproto[eventName]=function(fn,scope){if(R.is(fn,"function")){this.events=this.events||[];this.events.push({name:eventName,f:fn,unbind:addEvent(this.shape||this.node||g.doc,eventName,fn,scope||this)});}
return this;};R["un"+eventName]=elproto["un"+eventName]=function(fn){var events=this.events||[],l=events.length;while(l--)if(events[l].name==eventName&&events[l].f==fn){events[l].unbind();events.splice(l,1);!events.length&&delete this.events;return this;}
return this;};})(events[i]);}
elproto.data=function(key,value){var data=eldata[this.id]=eldata[this.id]||{};if(arguments.length==1){if(R.is(key,"object")){for(var i in key)if(key[has](i)){this.data(i,key[i]);}
return this;}
eve("data.get."+this.id,this,data[key],key);return data[key];}
data[key]=value;eve("data.set."+this.id,this,value,key);return this;};elproto.removeData=function(key){if(key==null){eldata[this.id]={};}else{eldata[this.id]&&delete eldata[this.id][key];}
return this;};elproto.hover=function(f_in,f_out,scope_in,scope_out){return this.mouseover(f_in,scope_in).mouseout(f_out,scope_out||scope_in);};elproto.unhover=function(f_in,f_out){return this.unmouseover(f_in).unmouseout(f_out);};var draggable=[];elproto.drag=function(onmove,onstart,onend,move_scope,start_scope,end_scope){function start(e){(e.originalEvent||e).preventDefault();var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft;this._drag.x=e.clientX+scrollX;this._drag.y=e.clientY+scrollY;this._drag.id=e.identifier;!drag.length&&R.mousemove(dragMove).mouseup(dragUp);drag.push({el:this,move_scope:move_scope,start_scope:start_scope,end_scope:end_scope});onstart&&eve.on("drag.start."+this.id,onstart);onmove&&eve.on("drag.move."+this.id,onmove);onend&&eve.on("drag.end."+this.id,onend);eve("drag.start."+this.id,start_scope||move_scope||this,e.clientX+scrollX,e.clientY+scrollY,e);}
this._drag={};draggable.push({el:this,start:start});this.mousedown(start);return this;};elproto.onDragOver=function(f){f?eve.on("drag.over."+this.id,f):eve.unbind("drag.over."+this.id);};elproto.undrag=function(){var i=draggable.length;while(i--)if(draggable[i].el==this){this.unmousedown(draggable[i].start);draggable.splice(i,1);eve.unbind("drag.*."+this.id);}
!draggable.length&&R.unmousemove(dragMove).unmouseup(dragUp);};paperproto.circle=function(x,y,r){var out=R._engine.circle(this,x||0,y||0,r||0);this.__set__&&this.__set__.push(out);return out;};paperproto.rect=function(x,y,w,h,r){var out=R._engine.rect(this,x||0,y||0,w||0,h||0,r||0);this.__set__&&this.__set__.push(out);return out;};paperproto.ellipse=function(x,y,rx,ry){var out=R._engine.ellipse(this,x||0,y||0,rx||0,ry||0);this.__set__&&this.__set__.push(out);return out;};paperproto.path=function(pathString){pathString&&!R.is(pathString,string)&&!R.is(pathString[0],array)&&(pathString+=E);var out=R._engine.path(R.format[apply](R,arguments),this);this.__set__&&this.__set__.push(out);return out;};paperproto.image=function(src,x,y,w,h){var out=R._engine.image(this,src||"about:blank",x||0,y||0,w||0,h||0);this.__set__&&this.__set__.push(out);return out;};paperproto.text=function(x,y,text){var out=R._engine.text(this,x||0,y||0,Str(text));this.__set__&&this.__set__.push(out);return out;};paperproto.set=function(itemsArray){!R.is(itemsArray,"array")&&(itemsArray=Array.prototype.splice.call(arguments,0,arguments.length));var out=new Set(itemsArray);this.__set__&&this.__set__.push(out);return out;};paperproto.setStart=function(set){this.__set__=set||this.set();};paperproto.setFinish=function(set){var out=this.__set__;delete this.__set__;return out;};paperproto.setSize=function(width,height){return R._engine.setSize.call(this,width,height);};paperproto.setViewBox=function(x,y,w,h,fit){return R._engine.setViewBox.call(this,x,y,w,h,fit);};paperproto.top=paperproto.bottom=null;paperproto.raphael=R;var getOffset=function(elem){var box=elem.getBoundingClientRect(),doc=elem.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+(g.win.pageYOffset||docElem.scrollTop||body.scrollTop)-clientTop,left=box.left+(g.win.pageXOffset||docElem.scrollLeft||body.scrollLeft)-clientLeft;return{y:top,x:left};};paperproto.getElementByPoint=function(x,y){var paper=this,svg=paper.canvas,target=g.doc.elementFromPoint(x,y);if(g.win.opera&&target.tagName=="svg"){var so=getOffset(svg),sr=svg.createSVGRect();sr.x=x-so.x;sr.y=y-so.y;sr.width=sr.height=1;var hits=svg.getIntersectionList(sr,null);if(hits.length){target=hits[hits.length-1];}}
if(!target){return null;}
while(target.parentNode&&target!=svg.parentNode&&!target.raphael){target=target.parentNode;}
target==paper.canvas.parentNode&&(target=svg);target=target&&target.raphael?paper.getById(target.raphaelid):null;return target;};paperproto.getById=function(id){var bot=this.bottom;while(bot){if(bot.id==id){return bot;}
bot=bot.next;}
return null;};paperproto.forEach=function(callback,thisArg){var bot=this.bottom;while(bot){if(callback.call(thisArg,bot)===false){return this;}
bot=bot.next;}
return this;};function x_y(){return this.x+S+this.y;}
function x_y_w_h(){return this.x+S+this.y+S+this.width+" \xd7 "+this.height;}
elproto.getBBox=function(isWithoutTransform){if(this.removed){return{};}
var _=this._;if(isWithoutTransform){if(_.dirty||!_.bboxwt){this.realPath=getPath[this.type](this);_.bboxwt=pathDimensions(this.realPath);_.bboxwt.toString=x_y_w_h;_.dirty=0;}
return _.bboxwt;}
if(_.dirty||_.dirtyT||!_.bbox){if(_.dirty||!this.realPath){_.bboxwt=0;this.realPath=getPath[this.type](this);}
_.bbox=pathDimensions(mapPath(this.realPath,this.matrix));_.bbox.toString=x_y_w_h;_.dirty=_.dirtyT=0;}
return _.bbox;};elproto.clone=function(){if(this.removed){return null;}
var out=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(out);return out;};elproto.glow=function(glow){if(this.type=="text"){return null;}
glow=glow||{};var s={width:(glow.width||10)+(+this.attr("stroke-width")||1),fill:glow.fill||false,opacity:glow.opacity||.5,offsetx:glow.offsetx||0,offsety:glow.offsety||0,color:glow.color||"#000"},c=s.width/2,r=this.paper,out=r.set(),path=this.realPath||getPath[this.type](this);path=this.matrix?mapPath(path,this.matrix):path;for(var i=1;i<c+1;i++){out.push(r.path(path).attr({stroke:s.color,fill:s.fill?s.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(s.width/c*i).toFixed(3),opacity:+(s.opacity/c).toFixed(3)}));}
return out.insertBefore(this).translate(s.offsetx,s.offsety);};var curveslengths={},getPointAtSegmentLength=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){var len=0,precision=100,name=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y].join(),cache=curveslengths[name],old,dot;!cache&&(curveslengths[name]=cache={data:[]});cache.timer&&clearTimeout(cache.timer);cache.timer=setTimeout(function(){delete curveslengths[name];},2e3);if(length!=null&&!cache.precision){var total=getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y);cache.precision=~~total*10;cache.data=[];}
precision=cache.precision||precision;for(var i=0;i<precision+1;i++){if(cache.data[i*precision]){dot=cache.data[i*precision];}else{dot=R.findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,i/precision);cache.data[i*precision]=dot;}
i&&(len+=pow(pow(old.x-dot.x,2)+pow(old.y-dot.y,2),.5));if(length!=null&&len>=length){return dot;}
old=dot;}
if(length==null){return len;}},getLengthFactory=function(istotal,subpath){return function(path,length,onlystart){path=path2curve(path);var x,y,p,l,sp="",subpaths={},point,len=0;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=="M"){x=+p[1];y=+p[2];}else{l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);if(len+l>length){if(subpath&&!subpaths.start){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);sp+=["C"+point.start.x,point.start.y,point.m.x,point.m.y,point.x,point.y];if(onlystart){return sp;}
subpaths.start=sp;sp=["M"+point.x,point.y+"C"+point.n.x,point.n.y,point.end.x,point.end.y,p[5],p[6]].join();len+=l;x=+p[5];y=+p[6];continue;}
if(!istotal&&!subpath){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);return{x:point.x,y:point.y,alpha:point.alpha};}}
len+=l;x=+p[5];y=+p[6];}
sp+=p.shift()+p;}
subpaths.end=sp;point=istotal?len:subpath?subpaths:R.findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1);point.alpha&&(point={x:point.x,y:point.y,alpha:point.alpha});return point;};};var getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory(),getSubpathsAtLength=getLengthFactory(0,1);R.getTotalLength=getTotalLength;R.getPointAtLength=getPointAtLength;R.getSubpath=function(path,from,to){if(this.getTotalLength(path)-to<1e-6){return getSubpathsAtLength(path,from).end;}
var a=getSubpathsAtLength(path,to,1);return from?getSubpathsAtLength(a,from).end:a;};elproto.getTotalLength=function(){if(this.type!="path"){return;}
if(this.node.getTotalLength){return this.node.getTotalLength();}
return getTotalLength(this.attrs.path);};elproto.getPointAtLength=function(length){if(this.type!="path"){return;}
return getPointAtLength(this.attrs.path,length);};elproto.getSubpath=function(from,to){if(this.type!="path"){return;}
return R.getSubpath(this.attrs.path,from,to);};var ef=R.easing_formulas={linear:function(n){return n;},"<":function(n){return pow(n,1.7);},">":function(n){return pow(n,.48);},"<>":function(n){var q=.48-n/1.04,Q=math.sqrt(.1734+q*q),x=Q-q,X=pow(abs(x),1/3)*(x<0?-1:1),y=-Q-q,Y=pow(abs(y),1/3)*(y<0?-1:1),t=X+Y+.5;return(1-t)*3*t*t+t*t*t;},backIn:function(n){var s=1.70158;return n*n*((s+1)*n-s);},backOut:function(n){n=n-1;var s=1.70158;return n*n*((s+1)*n+s)+1;},elastic:function(n){if(n==!!n){return n;}
return pow(2,-10*n)*math.sin((n-.075)*(2*PI)/.3)+1;},bounce:function(n){var s=7.5625,p=2.75,l;if(n<(1/p)){l=s*n*n;}else{if(n<(2/p)){n-=(1.5/p);l=s*n*n+.75;}else{if(n<(2.5/p)){n-=(2.25/p);l=s*n*n+.9375;}else{n-=(2.625/p);l=s*n*n+.984375;}}}
return l;}};ef.easeIn=ef["ease-in"]=ef["<"];ef.easeOut=ef["ease-out"]=ef[">"];ef.easeInOut=ef["ease-in-out"]=ef["<>"];ef["back-in"]=ef.backIn;ef["back-out"]=ef.backOut;var animationElements=[],requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,16);},animation=function(){var Now=+new Date,l=0;for(;l<animationElements.length;l++){var e=animationElements[l];if(e.el.removed||e.paused){continue;}
var time=Now-e.start,ms=e.ms,easing=e.easing,from=e.from,diff=e.diff,to=e.to,t=e.t,that=e.el,set={},now,init={},key;if(e.initstatus){time=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*ms;e.status=e.initstatus;delete e.initstatus;e.stop&&animationElements.splice(l--,1);}else{e.status=(e.prev+(e.percent-e.prev)*(time/ms))/e.anim.top;}
if(time<0){continue;}
if(time<ms){var pos=easing(time/ms);for(var attr in from)if(from[has](attr)){switch(availableAnimAttrs[attr]){case nu:now=+from[attr]+pos*ms*diff[attr];break;case"colour":now="rgb("+[upto255(round(from[attr].r+pos*ms*diff[attr].r)),upto255(round(from[attr].g+pos*ms*diff[attr].g)),upto255(round(from[attr].b+pos*ms*diff[attr].b))].join(",")+")";break;case"path":now=[];for(var i=0,ii=from[attr].length;i<ii;i++){now[i]=[from[attr][i][0]];for(var j=1,jj=from[attr][i].length;j<jj;j++){now[i][j]=+from[attr][i][j]+pos*ms*diff[attr][i][j];}
now[i]=now[i].join(S);}
now=now.join(S);break;case"transform":if(diff[attr].real){now=[];for(i=0,ii=from[attr].length;i<ii;i++){now[i]=[from[attr][i][0]];for(j=1,jj=from[attr][i].length;j<jj;j++){now[i][j]=from[attr][i][j]+pos*ms*diff[attr][i][j];}}}else{var get=function(i){return+from[attr][i]+pos*ms*diff[attr][i];};now=[["m",get(0),get(1),get(2),get(3),get(4),get(5)]];}
break;case"csv":if(attr=="clip-rect"){now=[];i=4;while(i--){now[i]=+from[attr][i]+pos*ms*diff[attr][i];}}
break;default:var from2=[][concat](from[attr]);now=[];i=that.paper.customAttributes[attr].length;while(i--){now[i]=+from2[i]+pos*ms*diff[attr][i];}
break;}
set[attr]=now;}
that.attr(set);(function(id,that,anim){setTimeout(function(){eve("anim.frame."+id,that,anim);});})(that.id,that,e.anim);}else{(function(f,el,a){setTimeout(function(){eve("anim.frame."+el.id,el,a);eve("anim.finish."+el.id,el,a);R.is(f,"function")&&f.call(el);});})(e.callback,that,e.anim);that.attr(to);animationElements.splice(l--,1);if(e.repeat>1&&!e.next){for(key in to)if(to[has](key)){init[key]=e.totalOrigin[key];}
e.el.attr(init);runAnimation(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1);}
if(e.next&&!e.stop){runAnimation(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat);}}}
R.svg&&that&&that.paper&&that.paper.safari();animationElements.length&&requestAnimFrame(animation);},upto255=function(color){return color>255?255:color<0?0:color;};elproto.animateWith=function(el,anim,params,ms,easing,callback){var element=this;if(element.removed){callback&&callback.call(element);return element;}
var a=params instanceof Animation?params:R.animation(params,ms,easing,callback),x,y;runAnimation(a,element,a.percents[0],null,element.attr());for(var i=0,ii=animationElements.length;i<ii;i++){if(animationElements[i].anim==anim&&animationElements[i].el==el){animationElements[ii-1].start=animationElements[i].start;break;}}
return element;};function CubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration){var cx=3*p1x,bx=3*(p2x-p1x)-cx,ax=1-cx-bx,cy=3*p1y,by=3*(p2y-p1y)-cy,ay=1-cy-by;function sampleCurveX(t){return((ax*t+bx)*t+cx)*t;}
function solve(x,epsilon){var t=solveCurveX(x,epsilon);return((ay*t+by)*t+cy)*t;}
function solveCurveX(x,epsilon){var t0,t1,t2,x2,d2,i;for(t2=x,i=0;i<8;i++){x2=sampleCurveX(t2)-x;if(abs(x2)<epsilon){return t2;}
d2=(3*ax*t2+2*bx)*t2+cx;if(abs(d2)<1e-6){break;}
t2=t2-x2/d2;}
t0=0;t1=1;t2=x;if(t2<t0){return t0;}
if(t2>t1){return t1;}
while(t0<t1){x2=sampleCurveX(t2);if(abs(x2-x)<epsilon){return t2;}
if(x>x2){t0=t2;}else{t1=t2;}
t2=(t1-t0)/2+t0;}
return t2;}
return solve(t,1/(200*duration));}
elproto.onAnimation=function(f){f?eve.on("anim.frame."+this.id,f):eve.unbind("anim.frame."+this.id);return this;};function Animation(anim,ms){var percents=[],newAnim={};this.ms=ms;this.times=1;if(anim){for(var attr in anim)if(anim[has](attr)){newAnim[toFloat(attr)]=anim[attr];percents.push(toFloat(attr));}
percents.sort(sortByNumber);}
this.anim=newAnim;this.top=percents[percents.length-1];this.percents=percents;}
Animation.prototype.delay=function(delay){var a=new Animation(this.anim,this.ms);a.times=this.times;a.del=+delay||0;return a;};Animation.prototype.repeat=function(times){var a=new Animation(this.anim,this.ms);a.del=this.del;a.times=math.floor(mmax(times,0))||1;return a;};function runAnimation(anim,element,percent,status,totalOrigin,times){percent=toFloat(percent);var params,isInAnim,isInAnimSet,percents=[],next,prev,timestamp,ms=anim.ms,from={},to={},diff={};if(status){for(i=0,ii=animationElements.length;i<ii;i++){var e=animationElements[i];if(e.el.id==element.id&&e.anim==anim){if(e.percent!=percent){animationElements.splice(i,1);isInAnimSet=1;}else{isInAnim=e;}
element.attr(e.totalOrigin);break;}}}else{status=+to;}
for(var i=0,ii=anim.percents.length;i<ii;i++){if(anim.percents[i]==percent||anim.percents[i]>status*anim.top){percent=anim.percents[i];prev=anim.percents[i-1]||0;ms=ms/anim.top*(percent-prev);next=anim.percents[i+1];params=anim.anim[percent];break;}else if(status){element.attr(anim.anim[anim.percents[i]]);}}
if(!params){return;}
if(!isInAnim){for(var attr in params)if(params[has](attr)){if(availableAnimAttrs[has](attr)||element.paper.customAttributes[has](attr)){from[attr]=element.attr(attr);(from[attr]==null)&&(from[attr]=availableAttrs[attr]);to[attr]=params[attr];switch(availableAnimAttrs[attr]){case nu:diff[attr]=(to[attr]-from[attr])/ms;break;case"colour":from[attr]=R.getRGB(from[attr]);var toColour=R.getRGB(to[attr]);diff[attr]={r:(toColour.r-from[attr].r)/ms,g:(toColour.g-from[attr].g)/ms,b:(toColour.b-from[attr].b)/ms};break;case"path":var pathes=path2curve(from[attr],to[attr]),toPath=pathes[1];from[attr]=pathes[0];diff[attr]=[];for(i=0,ii=from[attr].length;i<ii;i++){diff[attr][i]=[0];for(var j=1,jj=from[attr][i].length;j<jj;j++){diff[attr][i][j]=(toPath[i][j]-from[attr][i][j])/ms;}}
break;case"transform":var _=element._,eq=equaliseTransform(_[attr],to[attr]);if(eq){from[attr]=eq.from;to[attr]=eq.to;diff[attr]=[];diff[attr].real=true;for(i=0,ii=from[attr].length;i<ii;i++){diff[attr][i]=[from[attr][i][0]];for(j=1,jj=from[attr][i].length;j<jj;j++){diff[attr][i][j]=(to[attr][i][j]-from[attr][i][j])/ms;}}}else{var m=(element.matrix||new Matrix),to2={_:{transform:_.transform},getBBox:function(){return element.getBBox(1);}};from[attr]=[m.a,m.b,m.c,m.d,m.e,m.f];extractTransform(to2,to[attr]);to[attr]=to2._.transform;diff[attr]=[(to2.matrix.a-m.a)/ms,(to2.matrix.b-m.b)/ms,(to2.matrix.c-m.c)/ms,(to2.matrix.d-m.d)/ms,(to2.matrix.e-m.e)/ms,(to2.matrix.e-m.f)/ms];}
break;case"csv":var values=Str(params[attr])[split](separator),from2=Str(from[attr])[split](separator);if(attr=="clip-rect"){from[attr]=from2;diff[attr]=[];i=from2.length;while(i--){diff[attr][i]=(values[i]-from[attr][i])/ms;}}
to[attr]=values;break;default:values=[][concat](params[attr]);from2=[][concat](from[attr]);diff[attr]=[];i=element.paper.customAttributes[attr].length;while(i--){diff[attr][i]=((values[i]||0)-(from2[i]||0))/ms;}
break;}}}
var easing=params.easing,easyeasy=R.easing_formulas[easing];if(!easyeasy){easyeasy=Str(easing).match(bezierrg);if(easyeasy&&easyeasy.length==5){var curve=easyeasy;easyeasy=function(t){return CubicBezierAtTime(t,+curve[1],+curve[2],+curve[3],+curve[4],ms);};}else{easyeasy=pipe;}}
timestamp=params.start||anim.start||+new Date;e={anim:anim,percent:percent,timestamp:timestamp,start:timestamp+(anim.del||0),status:0,initstatus:status||0,stop:false,ms:ms,easing:easyeasy,from:from,diff:diff,to:to,el:element,callback:params.callback,prev:prev,next:next,repeat:times||anim.times,origin:element.attr(),totalOrigin:totalOrigin};animationElements.push(e);if(status&&!isInAnim&&!isInAnimSet){e.stop=true;e.start=new Date-ms*status;if(animationElements.length==1){return animation();}}
if(isInAnimSet){e.start=new Date-e.ms*status;}
animationElements.length==1&&requestAnimFrame(animation);}else{isInAnim.initstatus=status;isInAnim.start=new Date-isInAnim.ms*status;}
eve("anim.start."+element.id,element,anim);}
R.animation=function(params,ms,easing,callback){if(params instanceof Animation){return params;}
if(R.is(easing,"function")||!easing){callback=callback||easing||null;easing=null;}
params=Object(params);ms=+ms||0;var p={},json,attr;for(attr in params)if(params[has](attr)&&toFloat(attr)!=attr&&toFloat(attr)+"%"!=attr){json=true;p[attr]=params[attr];}
if(!json){return new Animation(params,ms);}else{easing&&(p.easing=easing);callback&&(p.callback=callback);return new Animation({100:p},ms);}};elproto.animate=function(params,ms,easing,callback){var element=this;if(element.removed){callback&&callback.call(element);return element;}
var anim=params instanceof Animation?params:R.animation(params,ms,easing,callback);runAnimation(anim,element,anim.percents[0],null,element.attr());return element;};elproto.setTime=function(anim,value){if(anim&&value!=null){this.status(anim,mmin(value,anim.ms)/anim.ms);}
return this;};elproto.status=function(anim,value){var out=[],i=0,len,e;if(value!=null){runAnimation(anim,this,-1,mmin(value,1));return this;}else{len=animationElements.length;for(;i<len;i++){e=animationElements[i];if(e.el.id==this.id&&(!anim||e.anim==anim)){if(anim){return e.status;}
out.push({anim:e.anim,status:e.status});}}
if(anim){return 0;}
return out;}};elproto.pause=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){if(eve("anim.pause."+this.id,this,animationElements[i].anim)!==false){animationElements[i].paused=true;}}
return this;};elproto.resume=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){var e=animationElements[i];if(eve("anim.resume."+this.id,this,e.anim)!==false){delete e.paused;this.status(e.anim,e.status);}}
return this;};elproto.stop=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){if(eve("anim.stop."+this.id,this,animationElements[i].anim)!==false){animationElements.splice(i--,1);}}
return this;};elproto.toString=function(){return"Rapha\xebl\u2019s object";};var Set=function(items){this.items=[];this.length=0;this.type="set";if(items){for(var i=0,ii=items.length;i<ii;i++){if(items[i]&&(items[i].constructor==elproto.constructor||items[i].constructor==Set)){this[this.items.length]=this.items[this.items.length]=items[i];this.length++;}}}},setproto=Set.prototype;setproto.push=function(){var item,len;for(var i=0,ii=arguments.length;i<ii;i++){item=arguments[i];if(item&&(item.constructor==elproto.constructor||item.constructor==Set)){len=this.items.length;this[len]=this.items[len]=item;this.length++;}}
return this;};setproto.pop=function(){this.length&&delete this[this.length--];return this.items.pop();};setproto.forEach=function(callback,thisArg){for(var i=0,ii=this.items.length;i<ii;i++){if(callback.call(thisArg,this.items[i],i)===false){return this;}}
return this;};for(var method in elproto)if(elproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname][apply](el,arg);});};})(method);}
setproto.attr=function(name,value){if(name&&R.is(name,array)&&R.is(name[0],"object")){for(var j=0,jj=name.length;j<jj;j++){this.items[j].attr(name[j]);}}else{for(var i=0,ii=this.items.length;i<ii;i++){this.items[i].attr(name,value);}}
return this;};setproto.clear=function(){while(this.length){this.pop();}};setproto.splice=function(index,count,insertion){index=index<0?mmax(this.length+index,0):index;count=mmax(0,mmin(this.length-index,count));var tail=[],todel=[],args=[],i;for(i=2;i<arguments.length;i++){args.push(arguments[i]);}
for(i=0;i<count;i++){todel.push(this[index+i]);}
for(;i<this.length-index;i++){tail.push(this[index+i]);}
var arglen=args.length;for(i=0;i<arglen+tail.length;i++){this.items[index+i]=this[index+i]=i<arglen?args[i]:tail[i-arglen];}
i=this.items.length=this.length-=count-arglen;while(this[i]){delete this[i++];}
return new Set(todel);};setproto.exclude=function(el){for(var i=0,ii=this.length;i<ii;i++)if(this[i]==el){this.splice(i,1);return true;}};setproto.animate=function(params,ms,easing,callback){(R.is(easing,"function")||!easing)&&(callback=easing||null);var len=this.items.length,i=len,item,set=this,collector;if(!len){return this;}
callback&&(collector=function(){!--len&&callback.call(set);});easing=R.is(easing,string)?easing:collector;var anim=R.animation(params,ms,easing,collector);item=this.items[--i].animate(anim);while(i--){this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(item,anim,anim);}
return this;};setproto.insertAfter=function(el){var i=this.items.length;while(i--){this.items[i].insertAfter(el);}
return this;};setproto.getBBox=function(){var x=[],y=[],w=[],h=[];for(var i=this.items.length;i--;)if(!this.items[i].removed){var box=this.items[i].getBBox();x.push(box.x);y.push(box.y);w.push(box.x+box.width);h.push(box.y+box.height);}
x=mmin[apply](0,x);y=mmin[apply](0,y);return{x:x,y:y,width:mmax[apply](0,w)-x,height:mmax[apply](0,h)-y};};setproto.clone=function(s){s=new Set;for(var i=0,ii=this.items.length;i<ii;i++){s.push(this.items[i].clone());}
return s;};setproto.toString=function(){return"Rapha\xebl\u2018s set";};R.registerFont=function(font){if(!font.face){return font;}
this.fonts=this.fonts||{};var fontcopy={w:font.w,face:{},glyphs:{}},family=font.face["font-family"];for(var prop in font.face)if(font.face[has](prop)){fontcopy.face[prop]=font.face[prop];}
if(this.fonts[family]){this.fonts[family].push(fontcopy);}else{this.fonts[family]=[fontcopy];}
if(!font.svg){fontcopy.face["units-per-em"]=toInt(font.face["units-per-em"],10);for(var glyph in font.glyphs)if(font.glyphs[has](glyph)){var path=font.glyphs[glyph];fontcopy.glyphs[glyph]={w:path.w,k:{},d:path.d&&"M"+path.d.replace(/[mlcxtrv]/g,function(command){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[command]||"M";})+"z"};if(path.k){for(var k in path.k)if(path[has](k)){fontcopy.glyphs[glyph].k[k]=path.k[k];}}}}
return font;};paperproto.getFont=function(family,weight,style,stretch){stretch=stretch||"normal";style=style||"normal";weight=+weight||{normal:400,bold:700,lighter:300,bolder:800}[weight]||400;if(!R.fonts){return;}
var font=R.fonts[family];if(!font){var name=new RegExp("(^|\\s)"+family.replace(/[^\w\d\s+!~.:_-]/g,E)+"(\\s|$)","i");for(var fontName in R.fonts)if(R.fonts[has](fontName)){if(name.test(fontName)){font=R.fonts[fontName];break;}}}
var thefont;if(font){for(var i=0,ii=font.length;i<ii;i++){thefont=font[i];if(thefont.face["font-weight"]==weight&&(thefont.face["font-style"]==style||!thefont.face["font-style"])&&thefont.face["font-stretch"]==stretch){break;}}}
return thefont;};paperproto.print=function(x,y,string,font,size,origin,letter_spacing){origin=origin||"middle";letter_spacing=mmax(mmin(letter_spacing||0,1),-1);var out=this.set(),letters=Str(string)[split](E),shift=0,path=E,scale;R.is(font,string)&&(font=this.getFont(font));if(font){scale=(size||16)/font.face["units-per-em"];var bb=font.face.bbox[split](separator),top=+bb[0],height=+bb[1]+(origin=="baseline"?bb[3]-bb[1]+(+font.face.descent):(bb[3]-bb[1])/2);for(var i=0,ii=letters.length;i<ii;i++){var prev=i&&font.glyphs[letters[i-1]]||{},curr=font.glyphs[letters[i]];shift+=i?(prev.w||font.w)+(prev.k&&prev.k[letters[i]]||0)+(font.w*letter_spacing):0;curr&&curr.d&&out.push(this.path(curr.d).attr({fill:"#000",stroke:"none",transform:[["t",shift*scale,0]]}));}
out.transform(["...s",scale,scale,top,height,"t",(x-top)/scale,(y-height)/scale]);}
return out;};paperproto.add=function(json){if(R.is(json,"array")){var res=this.set(),i=0,ii=json.length,j;for(;i<ii;i++){j=json[i]||{};elements[has](j.type)&&res.push(this[j.type]().attr(j));}}
return res;};R.format=function(token,params){var args=R.is(params,array)?[0][concat](params):arguments;token&&R.is(token,string)&&args.length-1&&(token=token.replace(formatrg,function(str,i){return args[++i]==null?E:args[i];}));return token||E;};R.fullfill=(function(){var tokenRegex=/\{([^\}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,replacer=function(all,key,obj){var res=obj;key.replace(objNotationRegex,function(all,name,quote,quotedName,isFunc){name=name||quotedName;if(res){if(name in res){res=res[name];}
typeof res=="function"&&isFunc&&(res=res());}});res=(res==null||res==obj?all:res)+"";return res;};return function(str,obj){return String(str).replace(tokenRegex,function(all,key){return replacer(all,key,obj);});};})();R.ninja=function(){oldRaphael.was?(g.win.Raphael=oldRaphael.is):delete Raphael;return R;};R.st=setproto;(function(doc,loaded,f){if(doc.readyState==null&&doc.addEventListener){doc.addEventListener(loaded,f=function(){doc.removeEventListener(loaded,f,false);doc.readyState="complete";},false);doc.readyState="loading";}
function isLoaded(){(/in/).test(doc.readyState)?setTimeout(isLoaded,9):R.eve("DOMload");}
isLoaded();})(document,"DOMContentLoaded");oldRaphael.was?(g.win.Raphael=R):(Raphael=R);eve.on("DOMload",function(){loaded=true;});})();window.Raphael.svg&&function(R){var has="hasOwnProperty",Str=String,toFloat=parseFloat,toInt=parseInt,math=Math,mmax=math.max,abs=math.abs,pow=math.pow,separator=/[, ]+/,eve=R.eve,E="",S=" ";var xlink="http://www.w3.org/1999/xlink",markers={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},markerCounter={};R.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version;};var $=function(el,attr){if(attr){if(typeof el=="string"){el=$(el);}
for(var key in attr)if(attr[has](key)){if(key.substring(0,6)=="xlink:"){el.setAttributeNS(xlink,key.substring(6),Str(attr[key]));}else{el.setAttribute(key,Str(attr[key]));}}}else{el=R._g.doc.createElementNS("http://www.w3.org/2000/svg",el);el.style&&(el.style.webkitTapHighlightColor="rgba(0,0,0,0)");}
return el;},addGradientFill=function(element,gradient){var type="linear",id=element.id+gradient,fx=.5,fy=.5,o=element.node,SVG=element.paper,s=o.style,el=R._g.doc.getElementById(id);if(!el){gradient=Str(gradient).replace(R._radial_gradient,function(all,_fx,_fy){type="radial";if(_fx&&_fy){fx=toFloat(_fx);fy=toFloat(_fy);var dir=((fy>.5)*2-1);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*dir+.5)&&fy!=.5&&(fy=fy.toFixed(5)-1e-5*dir);}
return E;});gradient=gradient.split(/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}
var vector=[0,0,math.cos(R.rad(angle)),math.sin(R.rad(angle))],max=1/(mmax(abs(vector[2]),abs(vector[3]))||1);vector[2]*=max;vector[3]*=max;if(vector[2]<0){vector[0]=-vector[2];vector[2]=0;}
if(vector[3]<0){vector[1]=-vector[3];vector[3]=0;}}
var dots=R._parseDots(gradient);if(!dots){return null;}
id=id.replace(/[\(\)\s,\xb0#]/g,"_");if(element.gradient&&id!=element.gradient.id){SVG.defs.removeChild(element.gradient);delete element.gradient;}
if(!element.gradient){el=$(type+"Gradient",{id:id});element.gradient=el;$(el,type=="radial"?{fx:fx,fy:fy}:{x1:vector[0],y1:vector[1],x2:vector[2],y2:vector[3],gradientTransform:element.matrix.invert()});SVG.defs.appendChild(el);for(var i=0,ii=dots.length;i<ii;i++){el.appendChild($("stop",{offset:dots[i].offset?dots[i].offset:i?"100%":"0%","stop-color":dots[i].color||"#fff"}));}}}
$(o,{fill:"url(#"+id+")",opacity:1,"fill-opacity":1});s.fill=E;s.opacity=1;s.fillOpacity=1;return 1;},updatePosition=function(o){var bbox=o.getBBox(1);$(o.pattern,{patternTransform:o.matrix.invert()+" translate("+bbox.x+","+bbox.y+")"});},addArrow=function(o,value,isEnd){if(o.type=="path"){var values=Str(value).toLowerCase().split("-"),p=o.paper,se=isEnd?"end":"start",node=o.node,attrs=o.attrs,stroke=attrs["stroke-width"],i=values.length,type="classic",from,to,dx,refX,attr,w=3,h=3,t=5;while(i--){switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":h=5;break;case"narrow":h=2;break;case"long":w=5;break;case"short":w=2;break;}}
if(type=="open"){w+=2;h+=2;t+=2;dx=1;refX=isEnd?4:1;attr={fill:"none",stroke:attrs.stroke};}else{refX=dx=w/2;attr={fill:attrs.stroke,stroke:"none"};}
if(o._.arrows){if(isEnd){o._.arrows.endPath&&markerCounter[o._.arrows.endPath]--;o._.arrows.endMarker&&markerCounter[o._.arrows.endMarker]--;}else{o._.arrows.startPath&&markerCounter[o._.arrows.startPath]--;o._.arrows.startMarker&&markerCounter[o._.arrows.startMarker]--;}}else{o._.arrows={};}
if(type!="none"){var pathId="raphael-marker-"+type,markerId="raphael-marker-"+se+type+w+h+o.id;if(!R._g.doc.getElementById(pathId)){p.defs.appendChild($($("path"),{"stroke-linecap":"round",d:markers[type],id:pathId}));markerCounter[pathId]=1;}else{markerCounter[pathId]++;}
var marker=R._g.doc.getElementById(markerId),use;if(!marker){marker=$($("marker"),{id:markerId,markerHeight:h,markerWidth:w,orient:"auto",refX:refX,refY:h/2});use=$($("use"),{"xlink:href":"#"+pathId,transform:(isEnd?"rotate(180 "+w/2+" "+h/2+") ":E)+"scale("+w/t+","+h/t+")","stroke-width":(1/((w/t+h/t)/2)).toFixed(4)});marker.appendChild(use);p.defs.appendChild(marker);markerCounter[markerId]=1;}else{markerCounter[markerId]++;use=marker.getElementsByTagName("use")[0];}
$(use,attr);var delta=dx*(type!="diamond"&&type!="oval");if(isEnd){from=o._.arrows.startdx*stroke||0;to=R.getTotalLength(attrs.path)-delta*stroke;}else{from=delta*stroke;to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0);}
attr={};attr["marker-"+se]="url(#"+markerId+")";if(to||from){attr.d=Raphael.getSubpath(attrs.path,from,to);}
$(node,attr);o._.arrows[se+"Path"]=pathId;o._.arrows[se+"Marker"]=markerId;o._.arrows[se+"dx"]=delta;o._.arrows[se+"Type"]=type;o._.arrows[se+"String"]=value;}else{if(isEnd){from=o._.arrows.startdx*stroke||0;to=R.getTotalLength(attrs.path)-from;}else{from=0;to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0);}
o._.arrows[se+"Path"]&&$(node,{d:Raphael.getSubpath(attrs.path,from,to)});delete o._.arrows[se+"Path"];delete o._.arrows[se+"Marker"];delete o._.arrows[se+"dx"];delete o._.arrows[se+"Type"];delete o._.arrows[se+"String"];}
for(attr in markerCounter)if(markerCounter[has](attr)&&!markerCounter[attr]){var item=R._g.doc.getElementById(attr);item&&item.parentNode.removeChild(item);}}},dasharray={"":[0],"none":[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},addDashes=function(o,value,params){value=dasharray[Str(value).toLowerCase()];if(value){var width=o.attrs["stroke-width"]||"1",butt={round:width,square:width,butt:0}[o.attrs["stroke-linecap"]||params["stroke-linecap"]]||0,dashes=[],i=value.length;while(i--){dashes[i]=value[i]*width+((i%2)?1:-1)*butt;}
$(o.node,{"stroke-dasharray":dashes.join(",")});}},setFillAndStroke=function(o,params){var node=o.node,attrs=o.attrs,vis=node.style.visibility;node.style.visibility="hidden";for(var att in params){if(params[has](att)){if(!R._availableAttrs[has](att)){continue;}
var value=params[att];attrs[att]=value;switch(att){case"blur":o.blur(value);break;case"href":case"title":case"target":var pn=node.parentNode;if(pn.tagName.toLowerCase()!="a"){var hl=$("a");pn.insertBefore(hl,node);hl.appendChild(node);pn=hl;}
if(att=="target"){pn.setAttributeNS(xlink,"show",value=="blank"?"new":value);}else{pn.setAttributeNS(xlink,att,value);}
break;case"cursor":node.style.cursor=value;break;case"transform":o.transform(value);break;case"arrow-start":addArrow(o,value);break;case"arrow-end":addArrow(o,value,1);break;case"clip-rect":var rect=Str(value).split(separator);if(rect.length==4){o.clip&&o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);var el=$("clipPath"),rc=$("rect");el.id=R.createUUID();$(rc,{x:rect[0],y:rect[1],width:rect[2],height:rect[3]});el.appendChild(rc);o.paper.defs.appendChild(el);$(node,{"clip-path":"url(#"+el.id+")"});o.clip=rc;}
if(!value){var path=node.getAttribute("clip-path");if(path){var clip=R._g.doc.getElementById(path.replace(/(^url\(#|\)$)/g,E));clip&&clip.parentNode.removeChild(clip);$(node,{"clip-path":E});delete o.clip;}}
break;case"path":if(o.type=="path"){$(node,{d:value?attrs.path=R._pathToAbsolute(value):"M0,0"});o._.dirty=1;if(o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}}
break;case"width":node.setAttribute(att,value);o._.dirty=1;if(attrs.fx){att="x";value=attrs.x;}else{break;}
case"x":if(attrs.fx){value=-attrs.x-(attrs.width||0);}
case"rx":if(att=="rx"&&o.type=="rect"){break;}
case"cx":node.setAttribute(att,value);o.pattern&&updatePosition(o);o._.dirty=1;break;case"height":node.setAttribute(att,value);o._.dirty=1;if(attrs.fy){att="y";value=attrs.y;}else{break;}
case"y":if(attrs.fy){value=-attrs.y-(attrs.height||0);}
case"ry":if(att=="ry"&&o.type=="rect"){break;}
case"cy":node.setAttribute(att,value);o.pattern&&updatePosition(o);o._.dirty=1;break;case"r":if(o.type=="rect"){$(node,{rx:value,ry:value});}else{node.setAttribute(att,value);}
o._.dirty=1;break;case"src":if(o.type=="image"){node.setAttributeNS(xlink,"href",value);}
break;case"stroke-width":if(o._.sx!=1||o._.sy!=1){value/=mmax(abs(o._.sx),abs(o._.sy))||1;}
if(o.paper._vbSize){value*=o.paper._vbSize;}
node.setAttribute(att,value);if(attrs["stroke-dasharray"]){addDashes(o,attrs["stroke-dasharray"],params);}
if(o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}
break;case"stroke-dasharray":addDashes(o,value,params);break;case"fill":var isURL=Str(value).match(R._ISURL);if(isURL){el=$("pattern");var ig=$("image");el.id=R.createUUID();$(el,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});$(ig,{x:0,y:0,"xlink:href":isURL[1]});el.appendChild(ig);(function(el){R._preload(isURL[1],function(){var w=this.offsetWidth,h=this.offsetHeight;$(el,{width:w,height:h});$(ig,{width:w,height:h});o.paper.safari();});})(el);o.paper.defs.appendChild(el);$(node,{fill:"url(#"+el.id+")"});o.pattern=el;o.pattern&&updatePosition(o);break;}
var clr=R.getRGB(value);if(!clr.error){delete params.gradient;delete attrs.gradient;!R.is(attrs.opacity,"undefined")&&R.is(params.opacity,"undefined")&&$(node,{opacity:attrs.opacity});!R.is(attrs["fill-opacity"],"undefined")&&R.is(params["fill-opacity"],"undefined")&&$(node,{"fill-opacity":attrs["fill-opacity"]});}else if((o.type=="circle"||o.type=="ellipse"||Str(value).charAt()!="r")&&addGradientFill(o,value)){if("opacity"in attrs||"fill-opacity"in attrs){var gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E));if(gradient){var stops=gradient.getElementsByTagName("stop");$(stops[stops.length-1],{"stop-opacity":("opacity"in attrs?attrs.opacity:1)*("fill-opacity"in attrs?attrs["fill-opacity"]:1)});}}
attrs.gradient=value;attrs.fill="none";break;}
clr[has]("opacity")&&$(node,{"fill-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});case"stroke":clr=R.getRGB(value);node.setAttribute(att,clr.hex);att=="stroke"&&clr[has]("opacity")&&$(node,{"stroke-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});if(att=="stroke"&&o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}
break;case"gradient":(o.type=="circle"||o.type=="ellipse"||Str(value).charAt()!="r")&&addGradientFill(o,value);break;case"opacity":if(attrs.gradient&&!attrs[has]("stroke-opacity")){$(node,{"stroke-opacity":value>1?value/100:value});}
case"fill-opacity":if(attrs.gradient){gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E));if(gradient){stops=gradient.getElementsByTagName("stop");$(stops[stops.length-1],{"stop-opacity":value});}
break;}
default:att=="font-size"&&(value=toInt(value,10)+"px");var cssrule=att.replace(/(\-.)/g,function(w){return w.substring(1).toUpperCase();});node.style[cssrule]=value;o._.dirty=1;node.setAttribute(att,value);break;}}}
tuneText(o,params);node.style.visibility=vis;},leading=1.2,tuneText=function(el,params){if(el.type!="text"||!(params[has]("text")||params[has]("font")||params[has]("font-size")||params[has]("x")||params[has]("y"))){return;}
var a=el.attrs,node=el.node,fontSize=node.firstChild?toInt(R._g.doc.defaultView.getComputedStyle(node.firstChild,E).getPropertyValue("font-size"),10):10;if(params[has]("text")){a.text=params.text;while(node.firstChild){node.removeChild(node.firstChild);}
var texts=Str(params.text).split("\n"),tspans=[],tspan;for(var i=0,ii=texts.length;i<ii;i++){tspan=$("tspan");i&&$(tspan,{dy:fontSize*leading,x:a.x});tspan.appendChild(R._g.doc.createTextNode(texts[i]));node.appendChild(tspan);tspans[i]=tspan;}}else{tspans=node.getElementsByTagName("tspan");for(i=0,ii=tspans.length;i<ii;i++)if(i){$(tspans[i],{dy:fontSize*leading,x:a.x});}else{$(tspans[0],{dy:0});}}
$(node,{x:a.x,y:a.y});el._.dirty=1;var bb=el._getBBox(),dif=a.y-(bb.y+bb.height/2);dif&&R.is(dif,"finite")&&$(tspans[0],{dy:dif});},Element=function(node,svg){var X=0,Y=0;this[0]=this.node=node;node.raphael=true;this.id=R._oid++;node.raphaelid=this.id;this.matrix=R.matrix();this.realPath=null;this.paper=svg;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!svg.bottom&&(svg.bottom=this);this.prev=svg.top;svg.top&&(svg.top.next=this);svg.top=this;this.next=null;},elproto=R.el;Element.prototype=elproto;elproto.constructor=Element;R._engine.path=function(pathString,SVG){var el=$("path");SVG.canvas&&SVG.canvas.appendChild(el);var p=new Element(el,SVG);p.type="path";setFillAndStroke(p,{fill:"none",stroke:"#000",path:pathString});return p;};elproto.rotate=function(deg,cx,cy){if(this.removed){return this;}
deg=Str(deg).split(separator);if(deg.length-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2;cy=bbox.y+bbox.height/2;}
this.transform(this._.transform.concat([["r",deg,cx,cy]]));return this;};elproto.scale=function(sx,sy,cx,cy){if(this.removed){return this;}
sx=Str(sx).split(separator);if(sx.length-1){sy=toFloat(sx[1]);cx=toFloat(sx[2]);cy=toFloat(sx[3]);}
sx=toFloat(sx[0]);(sy==null)&&(sy=sx);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);}
cx=cx==null?bbox.x+bbox.width/2:cx;cy=cy==null?bbox.y+bbox.height/2:cy;this.transform(this._.transform.concat([["s",sx,sy,cx,cy]]));return this;};elproto.translate=function(dx,dy){if(this.removed){return this;}
dx=Str(dx).split(separator);if(dx.length-1){dy=toFloat(dx[1]);}
dx=toFloat(dx[0])||0;dy=+dy||0;this.transform(this._.transform.concat([["t",dx,dy]]));return this;};elproto.transform=function(tstr){var _=this._;if(tstr==null){return _.transform;}
R._extractTransform(this,tstr);this.clip&&$(this.clip,{transform:this.matrix.invert()});this.pattern&&updatePosition(this);this.node&&$(this.node,{transform:this.matrix});if(_.sx!=1||_.sy!=1){var sw=this.attrs[has]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":sw});}
return this;};elproto.hide=function(){!this.removed&&this.paper.safari(this.node.style.display="none");return this;};elproto.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this;};elproto.remove=function(){if(this.removed){return;}
var paper=this.paper;paper.__set__&&paper.__set__.exclude(this);eve.unbind("*.*."+this.id);if(this.gradient){paper.defs.removeChild(this.gradient);}
R._tear(this,paper);if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.removeChild(this.node.parentNode);}else{this.node.parentNode.removeChild(this.node);}
for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
this.removed=true;};elproto._getBBox=function(){if(this.node.style.display=="none"){this.show();var hide=true;}
var bbox={};try{bbox=this.node.getBBox();}catch(e){}finally{bbox=bbox||{};}
hide&&this.hide();return bbox;};elproto.attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var a in this.attrs)if(this.attrs[has](a)){res[a]=this.attrs[a];}
res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;res.transform=this._.transform;return res;}
if(value==null&&R.is(name,"string")){if(name=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
if(name=="transform"){return this._.transform;}
var names=name.split(separator),out={};for(var i=0,ii=names.length;i<ii;i++){name=names[i];if(name in this.attrs){out[name]=this.attrs[name];}else if(R.is(this.paper.customAttributes[name],"function")){out[name]=this.paper.customAttributes[name].def;}else{out[name]=R._availableAttrs[name];}}
return ii-1?out:out[names[0]];}
if(value==null&&R.is(name,"array")){out={};for(i=0,ii=name.length;i<ii;i++){out[name[i]]=this.attr(name[i]);}
return out;}
if(value!=null){var params={};params[name]=value;}else if(name!=null&&R.is(name,"object")){params=name;}
for(var key in params){eve("attr."+key+"."+this.id,this,params[key]);}
for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
setFillAndStroke(this,params);return this;};elproto.toFront=function(){if(this.removed){return this;}
if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.appendChild(this.node.parentNode);}else{this.node.parentNode.appendChild(this.node);}
var svg=this.paper;svg.top!=this&&R._tofront(this,svg);return this;};elproto.toBack=function(){if(this.removed){return this;}
var parent=this.node.parentNode;if(parent.tagName.toLowerCase()=="a"){parent.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild);}else if(parent.firstChild!=this.node){parent.insertBefore(this.node,this.node.parentNode.firstChild);}
R._toback(this,this.paper);var svg=this.paper;return this;};elproto.insertAfter=function(element){if(this.removed){return this;}
var node=element.node||element[element.length-1].node;if(node.nextSibling){node.parentNode.insertBefore(this.node,node.nextSibling);}else{node.parentNode.appendChild(this.node);}
R._insertafter(this,element,this.paper);return this;};elproto.insertBefore=function(element){if(this.removed){return this;}
var node=element.node||element[0].node;node.parentNode.insertBefore(this.node,node);R._insertbefore(this,element,this.paper);return this;};elproto.blur=function(size){var t=this;if(+size!==0){var fltr=$("filter"),blur=$("feGaussianBlur");t.attrs.blur=size;fltr.id=R.createUUID();$(blur,{stdDeviation:+size||1.5});fltr.appendChild(blur);t.paper.defs.appendChild(fltr);t._blur=fltr;$(t.node,{filter:"url(#"+fltr.id+")"});}else{if(t._blur){t._blur.parentNode.removeChild(t._blur);delete t._blur;delete t.attrs.blur;}
t.node.removeAttribute("filter");}};R._engine.circle=function(svg,x,y,r){var el=$("circle");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,r:r,fill:"none",stroke:"#000"};res.type="circle";$(el,res.attrs);return res;};R._engine.rect=function(svg,x,y,w,h,r){var el=$("rect");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,r:r||0,rx:r||0,ry:r||0,fill:"none",stroke:"#000"};res.type="rect";$(el,res.attrs);return res;};R._engine.ellipse=function(svg,x,y,rx,ry){var el=$("ellipse");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,rx:rx,ry:ry,fill:"none",stroke:"#000"};res.type="ellipse";$(el,res.attrs);return res;};R._engine.image=function(svg,src,x,y,w,h){var el=$("image");$(el,{x:x,y:y,width:w,height:h,preserveAspectRatio:"none"});el.setAttributeNS(xlink,"href",src);svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,src:src};res.type="image";return res;};R._engine.text=function(svg,x,y,text){var el=$("text");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,"text-anchor":"middle",text:text,font:R._availableAttrs.font,stroke:"none",fill:"#000"};res.type="text";setFillAndStroke(res,res.attrs);return res;};R._engine.setSize=function(width,height){this.width=width||this.width;this.height=height||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);if(this._viewBox){this.setViewBox.apply(this,this._viewBox);}
return this;};R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con&&con.container,x=con.x,y=con.y,width=con.width,height=con.height;if(!container){throw new Error("SVG container not found.");}
var cnvs=$("svg"),css="overflow:hidden;",isFloating;x=x||0;y=y||0;width=width||512;height=height||342;$(cnvs,{height:height,version:1.1,width:width,xmlns:"http://www.w3.org/2000/svg"});if(container==1){cnvs.style.cssText=css+"position:absolute;left:"+x+"px;top:"+y+"px";R._g.doc.body.appendChild(cnvs);isFloating=1;}else{cnvs.style.cssText=css+"position:relative";if(container.firstChild){container.insertBefore(cnvs,container.firstChild);}else{container.appendChild(cnvs);}}
container=new R._Paper;container.width=width;container.height=height;container.canvas=cnvs;container.clear();container._left=container._top=0;isFloating&&(container.renderfix=function(){});container.renderfix();return container;};R._engine.setViewBox=function(x,y,w,h,fit){eve("setViewBox",this,this._viewBox,[x,y,w,h,fit]);var size=mmax(w/this.width,h/this.height),top=this.top,aspectRatio=fit?"meet":"xMinYMin",vb,sw;if(x==null){if(this._vbSize){size=1;}
delete this._vbSize;vb="0 0 "+this.width+S+this.height;}else{this._vbSize=size;vb=x+S+y+S+w+S+h;}
$(this.canvas,{viewBox:vb,preserveAspectRatio:aspectRatio});while(size&&top){sw="stroke-width"in top.attrs?top.attrs["stroke-width"]:1;top.attr({"stroke-width":sw});top._.dirty=1;top._.dirtyT=1;top=top.prev;}
this._viewBox=[x,y,w,h,!!fit];return this;};R.prototype.renderfix=function(){var cnvs=this.canvas,s=cnvs.style,pos;try{pos=cnvs.getScreenCTM()||cnvs.createSVGMatrix();}catch(e){pos=cnvs.createSVGMatrix();}
var left=-pos.e%1,top=-pos.f%1;if(left||top){if(left){this._left=(this._left+left)%1;s.left=this._left+"px";}
if(top){this._top=(this._top+top)%1;s.top=this._top+"px";}}};R.prototype.clear=function(){R.eve("clear",this);var c=this.canvas;while(c.firstChild){c.removeChild(c.firstChild);}
this.bottom=this.top=null;(this.desc=$("desc")).appendChild(R._g.doc.createTextNode("Created with Rapha\xebl "+R.version));c.appendChild(this.desc);c.appendChild(this.defs=$("defs"));};R.prototype.remove=function(){eve("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}};var setproto=R.st;for(var method in elproto)if(elproto[has](method)&&!setproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg);});};})(method);}}(window.Raphael);window.Raphael.vml&&function(R){var has="hasOwnProperty",Str=String,toFloat=parseFloat,math=Math,round=math.round,mmax=math.max,mmin=math.min,abs=math.abs,fillString="fill",separator=/[, ]+/,eve=R.eve,ms=" progid:DXImageTransform.Microsoft",S=" ",E="",map={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},bites=/([clmz]),?([^clmz]*)/gi,blurregexp=/ progid:\S+Blur\([^\)]+\)/g,val=/-?[^,\s-]+/g,cssDot="position:absolute;left:0;top:0;width:1px;height:1px",zoom=21600,pathTypes={path:1,rect:1,image:1},ovalTypes={circle:1,ellipse:1},path2vml=function(path){var total=/[ahqstv]/ig,command=R._pathToAbsolute;Str(path).match(total)&&(command=R._path2curve);total=/[clmz]/g;if(command==R._pathToAbsolute&&!Str(path).match(total)){var res=Str(path).replace(bites,function(all,command,args){var vals=[],isMove=command.toLowerCase()=="m",res=map[command];args.replace(val,function(value){if(isMove&&vals.length==2){res+=vals+map[command=="m"?"l":"L"];vals=[];}
vals.push(round(value*zoom));});return res+vals;});return res;}
var pa=command(path),p,r;res=[];for(var i=0,ii=pa.length;i<ii;i++){p=pa[i];r=pa[i][0].toLowerCase();r=="z"&&(r="x");for(var j=1,jj=p.length;j<jj;j++){r+=round(p[j]*zoom)+(j!=jj-1?",":E);}
res.push(r);}
return res.join(S);},compensation=function(deg,dx,dy){var m=R.matrix();m.rotate(-deg,.5,.5);return{dx:m.x(dx,dy),dy:m.y(dx,dy)};},setCoords=function(p,sx,sy,dx,dy,deg){var _=p._,m=p.matrix,fillpos=_.fillpos,o=p.node,s=o.style,y=1,flip="",dxdy,kx=zoom/sx,ky=zoom/sy;s.visibility="hidden";if(!sx||!sy){return;}
o.coordsize=abs(kx)+S+abs(ky);s.rotation=deg*(sx*sy<0?-1:1);if(deg){var c=compensation(deg,dx,dy);dx=c.dx;dy=c.dy;}
sx<0&&(flip+="x");sy<0&&(flip+=" y")&&(y=-1);s.flip=flip;o.coordorigin=(dx*-kx)+S+(dy*-ky);if(fillpos||_.fillsize){var fill=o.getElementsByTagName(fillString);fill=fill&&fill[0];o.removeChild(fill);if(fillpos){c=compensation(deg,m.x(fillpos[0],fillpos[1]),m.y(fillpos[0],fillpos[1]));fill.position=c.dx*y+S+c.dy*y;}
if(_.fillsize){fill.size=_.fillsize[0]*abs(sx)+S+_.fillsize[1]*abs(sy);}
o.appendChild(fill);}
s.visibility="visible";};R.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version;};var addArrow=function(o,value,isEnd){var values=Str(value).toLowerCase().split("-"),se=isEnd?"end":"start",i=values.length,type="classic",w="medium",h="medium";while(i--){switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":case"narrow":h=values[i];break;case"long":case"short":w=values[i];break;}}
var stroke=o.node.getElementsByTagName("stroke")[0];stroke[se+"arrow"]=type;stroke[se+"arrowlength"]=w;stroke[se+"arrowwidth"]=h;},setFillAndStroke=function(o,params){o.attrs=o.attrs||{};var node=o.node,a=o.attrs,s=node.style,xy,newpath=pathTypes[o.type]&&(params.x!=a.x||params.y!=a.y||params.width!=a.width||params.height!=a.height||params.cx!=a.cx||params.cy!=a.cy||params.rx!=a.rx||params.ry!=a.ry||params.r!=a.r),isOval=ovalTypes[o.type]&&(a.cx!=params.cx||a.cy!=params.cy||a.r!=params.r||a.rx!=params.rx||a.ry!=params.ry),res=o;for(var par in params)if(params[has](par)){a[par]=params[par];}
if(newpath){a.path=R._getPath[o.type](o);o._.dirty=1;}
params.href&&(node.href=params.href);params.title&&(node.title=params.title);params.target&&(node.target=params.target);params.cursor&&(s.cursor=params.cursor);"blur"in params&&o.blur(params.blur);if(params.path&&o.type=="path"||newpath){node.path=path2vml(~Str(a.path).toLowerCase().indexOf("r")?R._pathToAbsolute(a.path):a.path);if(o.type=="image"){o._.fillpos=[a.x,a.y];o._.fillsize=[a.width,a.height];setCoords(o,1,1,0,0,0);}}"transform"in params&&o.transform(params.transform);if(isOval){var cx=+a.cx,cy=+a.cy,rx=+a.rx||+a.r||0,ry=+a.ry||+a.r||0;node.path=R.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",round((cx-rx)*zoom),round((cy-ry)*zoom),round((cx+rx)*zoom),round((cy+ry)*zoom),round(cx*zoom));}
if("clip-rect"in params){var rect=Str(params["clip-rect"]).split(separator);if(rect.length==4){rect[2]=+rect[2]+(+rect[0]);rect[3]=+rect[3]+(+rect[1]);var div=node.clipRect||R._g.doc.createElement("div"),dstyle=div.style;dstyle.clip=R.format("rect({1}px {2}px {3}px {0}px)",rect);if(!node.clipRect){dstyle.position="absolute";dstyle.top=0;dstyle.left=0;dstyle.width=o.paper.width+"px";dstyle.height=o.paper.height+"px";node.parentNode.insertBefore(div,node);div.appendChild(node);node.clipRect=div;}}
if(!params["clip-rect"]){node.clipRect&&(node.clipRect.style.clip="auto");}}
if(o.textpath){var textpathStyle=o.textpath.style;params.font&&(textpathStyle.font=params.font);params["font-family"]&&(textpathStyle.fontFamily='"'+params["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,E)+'"');params["font-size"]&&(textpathStyle.fontSize=params["font-size"]);params["font-weight"]&&(textpathStyle.fontWeight=params["font-weight"]);params["font-style"]&&(textpathStyle.fontStyle=params["font-style"]);}
if("arrow-start"in params){addArrow(res,params["arrow-start"]);}
if("arrow-end"in params){addArrow(res,params["arrow-end"],1);}
if(params.opacity!=null||params["stroke-width"]!=null||params.fill!=null||params.src!=null||params.stroke!=null||params["stroke-width"]!=null||params["stroke-opacity"]!=null||params["fill-opacity"]!=null||params["stroke-dasharray"]!=null||params["stroke-miterlimit"]!=null||params["stroke-linejoin"]!=null||params["stroke-linecap"]!=null){var fill=node.getElementsByTagName(fillString),newfill=false;fill=fill&&fill[0];!fill&&(newfill=fill=createNode(fillString));if(o.type=="image"&&params.src){fill.src=params.src;}
params.fill&&(fill.on=true);if(fill.on==null||params.fill=="none"||params.fill===null){fill.on=false;}
if(fill.on&&params.fill){var isURL=Str(params.fill).match(R._ISURL);if(isURL){fill.parentNode==node&&node.removeChild(fill);fill.rotate=true;fill.src=isURL[1];fill.type="tile";var bbox=o.getBBox(1);fill.position=bbox.x+S+bbox.y;o._.fillpos=[bbox.x,bbox.y];R._preload(isURL[1],function(){o._.fillsize=[this.offsetWidth,this.offsetHeight];});}else{fill.color=R.getRGB(params.fill).hex;fill.src=E;fill.type="solid";if(R.getRGB(params.fill).error&&(res.type in{circle:1,ellipse:1}||Str(params.fill).charAt()!="r")&&addGradientFill(res,params.fill,fill)){a.fill="none";a.gradient=params.fill;fill.rotate=false;}}}
if("fill-opacity"in params||"opacity"in params){var opacity=((+a["fill-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+R.getRGB(params.fill).o+1||2)-1);opacity=mmin(mmax(opacity,0),1);fill.opacity=opacity;if(fill.src){fill.color="none";}}
node.appendChild(fill);var stroke=(node.getElementsByTagName("stroke")&&node.getElementsByTagName("stroke")[0]),newstroke=false;!stroke&&(newstroke=stroke=createNode("stroke"));if((params.stroke&&params.stroke!="none")||params["stroke-width"]||params["stroke-opacity"]!=null||params["stroke-dasharray"]||params["stroke-miterlimit"]||params["stroke-linejoin"]||params["stroke-linecap"]){stroke.on=true;}
(params.stroke=="none"||params.stroke===null||stroke.on==null||params.stroke==0||params["stroke-width"]==0)&&(stroke.on=false);var strokeColor=R.getRGB(params.stroke);stroke.on&&params.stroke&&(stroke.color=strokeColor.hex);opacity=((+a["stroke-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+strokeColor.o+1||2)-1);var width=(toFloat(params["stroke-width"])||1)*.75;opacity=mmin(mmax(opacity,0),1);params["stroke-width"]==null&&(width=a["stroke-width"]);params["stroke-width"]&&(stroke.weight=width);width&&width<1&&(opacity*=width)&&(stroke.weight=1);stroke.opacity=opacity;params["stroke-linejoin"]&&(stroke.joinstyle=params["stroke-linejoin"]||"miter");stroke.miterlimit=params["stroke-miterlimit"]||8;params["stroke-linecap"]&&(stroke.endcap=params["stroke-linecap"]=="butt"?"flat":params["stroke-linecap"]=="square"?"square":"round");if(params["stroke-dasharray"]){var dasharray={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};stroke.dashstyle=dasharray[has](params["stroke-dasharray"])?dasharray[params["stroke-dasharray"]]:E;}
newstroke&&node.appendChild(stroke);}
if(res.type=="text"){res.paper.canvas.style.display=E;var span=res.paper.span,m=100,fontSize=a.font&&a.font.match(/\d+(?:\.\d*)?(?=px)/);s=span.style;a.font&&(s.font=a.font);a["font-family"]&&(s.fontFamily=a["font-family"]);a["font-weight"]&&(s.fontWeight=a["font-weight"]);a["font-style"]&&(s.fontStyle=a["font-style"]);fontSize=toFloat(a["font-size"]||fontSize&&fontSize[0])||10;s.fontSize=fontSize*m+"px";res.textpath.string&&(span.innerHTML=Str(res.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var brect=span.getBoundingClientRect();res.W=a.w=(brect.right-brect.left)/m;res.H=a.h=(brect.bottom-brect.top)/m;res.X=a.x;res.Y=a.y+res.H/2;("x"in params||"y"in params)&&(res.path.v=R.format("m{0},{1}l{2},{1}",round(a.x*zoom),round(a.y*zoom),round(a.x*zoom)+1));var dirtyattrs=["x","y","text","font","font-family","font-weight","font-style","font-size"];for(var d=0,dd=dirtyattrs.length;d<dd;d++)if(dirtyattrs[d]in params){res._.dirty=1;break;}
switch(a["text-anchor"]){case"start":res.textpath.style["v-text-align"]="left";res.bbx=res.W/2;break;case"end":res.textpath.style["v-text-align"]="right";res.bbx=-res.W/2;break;default:res.textpath.style["v-text-align"]="center";res.bbx=0;break;}
res.textpath.style["v-text-kern"]=true;}},addGradientFill=function(o,gradient,fill){o.attrs=o.attrs||{};var attrs=o.attrs,pow=Math.pow,opacity,oindex,type="linear",fxfy=".5 .5";o.attrs.gradient=gradient;gradient=Str(gradient).replace(R._radial_gradient,function(all,fx,fy){type="radial";if(fx&&fy){fx=toFloat(fx);fy=toFloat(fy);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*((fy>.5)*2-1)+.5);fxfy=fx+S+fy;}
return E;});gradient=gradient.split(/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}}
var dots=R._parseDots(gradient);if(!dots){return null;}
o=o.shape||o.node;if(dots.length){o.removeChild(fill);fill.on=true;fill.method="none";fill.color=dots[0].color;fill.color2=dots[dots.length-1].color;var clrs=[];for(var i=0,ii=dots.length;i<ii;i++){dots[i].offset&&clrs.push(dots[i].offset+S+dots[i].color);}
fill.colors=clrs.length?clrs.join():"0% "+fill.color;if(type=="radial"){fill.type="gradientTitle";fill.focus="100%";fill.focussize="0 0";fill.focusposition=fxfy;fill.angle=0;}else{fill.type="gradient";fill.angle=(270-angle)%360;}
o.appendChild(fill);}
return 1;},Element=function(node,vml){this[0]=this.node=node;node.raphael=true;this.id=R._oid++;node.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=vml;this.matrix=R.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!vml.bottom&&(vml.bottom=this);this.prev=vml.top;vml.top&&(vml.top.next=this);vml.top=this;this.next=null;};var elproto=R.el;Element.prototype=elproto;elproto.constructor=Element;elproto.transform=function(tstr){if(tstr==null){return this._.transform;}
var vbs=this.paper._viewBoxShift,vbt=vbs?"s"+[vbs.scale,vbs.scale]+"-1-1t"+[vbs.dx,vbs.dy]:E,oldt;if(vbs){oldt=tstr=Str(tstr).replace(/\.{3}|\u2026/g,this._.transform||E);}
R._extractTransform(this,vbt+tstr);var matrix=this.matrix.clone(),skew=this.skew,o=this.node,split,isGrad=~Str(this.attrs.fill).indexOf("-"),isPatt=!Str(this.attrs.fill).indexOf("url(");matrix.translate(-.5,-.5);if(isPatt||isGrad||this.type=="image"){skew.matrix="1 0 0 1";skew.offset="0 0";split=matrix.split();if((isGrad&&split.noRotation)||!split.isSimple){o.style.filter=matrix.toFilter();var bb=this.getBBox(),bbt=this.getBBox(1),dx=bb.x-bbt.x,dy=bb.y-bbt.y;o.coordorigin=(dx*-zoom)+S+(dy*-zoom);setCoords(this,1,1,dx,dy,0);}else{o.style.filter=E;setCoords(this,split.scalex,split.scaley,split.dx,split.dy,split.rotate);}}else{o.style.filter=E;skew.matrix=Str(matrix);skew.offset=matrix.offset();}
oldt&&(this._.transform=oldt);return this;};elproto.rotate=function(deg,cx,cy){if(this.removed){return this;}
if(deg==null){return;}
deg=Str(deg).split(separator);if(deg.length-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2;cy=bbox.y+bbox.height/2;}
this._.dirtyT=1;this.transform(this._.transform.concat([["r",deg,cx,cy]]));return this;};elproto.translate=function(dx,dy){if(this.removed){return this;}
dx=Str(dx).split(separator);if(dx.length-1){dy=toFloat(dx[1]);}
dx=toFloat(dx[0])||0;dy=+dy||0;if(this._.bbox){this._.bbox.x+=dx;this._.bbox.y+=dy;}
this.transform(this._.transform.concat([["t",dx,dy]]));return this;};elproto.scale=function(sx,sy,cx,cy){if(this.removed){return this;}
sx=Str(sx).split(separator);if(sx.length-1){sy=toFloat(sx[1]);cx=toFloat(sx[2]);cy=toFloat(sx[3]);isNaN(cx)&&(cx=null);isNaN(cy)&&(cy=null);}
sx=toFloat(sx[0]);(sy==null)&&(sy=sx);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);}
cx=cx==null?bbox.x+bbox.width/2:cx;cy=cy==null?bbox.y+bbox.height/2:cy;this.transform(this._.transform.concat([["s",sx,sy,cx,cy]]));this._.dirtyT=1;return this;};elproto.hide=function(){!this.removed&&(this.node.style.display="none");return this;};elproto.show=function(){!this.removed&&(this.node.style.display=E);return this;};elproto._getBBox=function(){if(this.removed){return{};}
return{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H};};elproto.remove=function(){if(this.removed){return;}
this.paper.__set__&&this.paper.__set__.exclude(this);R.eve.unbind("*.*."+this.id);R._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
this.removed=true;};elproto.attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var a in this.attrs)if(this.attrs[has](a)){res[a]=this.attrs[a];}
res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;res.transform=this._.transform;return res;}
if(value==null&&R.is(name,"string")){if(name==fillString&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
var names=name.split(separator),out={};for(var i=0,ii=names.length;i<ii;i++){name=names[i];if(name in this.attrs){out[name]=this.attrs[name];}else if(R.is(this.paper.customAttributes[name],"function")){out[name]=this.paper.customAttributes[name].def;}else{out[name]=R._availableAttrs[name];}}
return ii-1?out:out[names[0]];}
if(this.attrs&&value==null&&R.is(name,"array")){out={};for(i=0,ii=name.length;i<ii;i++){out[name[i]]=this.attr(name[i]);}
return out;}
var params;if(value!=null){params={};params[name]=value;}
value==null&&R.is(name,"object")&&(params=name);for(var key in params){eve("attr."+key+"."+this.id,this,params[key]);}
if(params){for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
if(params.text&&this.type=="text"){this.textpath.string=params.text;}
setFillAndStroke(this,params);}
return this;};elproto.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&R._tofront(this,this.paper);return this;};elproto.toBack=function(){if(this.removed){return this;}
if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);R._toback(this,this.paper);}
return this;};elproto.insertAfter=function(element){if(this.removed){return this;}
if(element.constructor==R.st.constructor){element=element[element.length-1];}
if(element.node.nextSibling){element.node.parentNode.insertBefore(this.node,element.node.nextSibling);}else{element.node.parentNode.appendChild(this.node);}
R._insertafter(this,element,this.paper);return this;};elproto.insertBefore=function(element){if(this.removed){return this;}
if(element.constructor==R.st.constructor){element=element[0];}
element.node.parentNode.insertBefore(this.node,element.node);R._insertbefore(this,element,this.paper);return this;};elproto.blur=function(size){var s=this.node.runtimeStyle,f=s.filter;f=f.replace(blurregexp,E);if(+size!==0){this.attrs.blur=size;s.filter=f+S+ms+".Blur(pixelradius="+(+size||1.5)+")";s.margin=R.format("-{0}px 0 0 -{0}px",round(+size||1.5));}else{s.filter=f;s.margin=0;delete this.attrs.blur;}};R._engine.path=function(pathString,vml){var el=createNode("shape");el.style.cssText=cssDot;el.coordsize=zoom+S+zoom;el.coordorigin=vml.coordorigin;var p=new Element(el,vml),attr={fill:"none",stroke:"#000"};pathString&&(attr.path=pathString);p.type="path";p.path=[];p.Path=E;setFillAndStroke(p,attr);vml.canvas.appendChild(el);var skew=createNode("skew");skew.on=true;el.appendChild(skew);p.skew=skew;p.transform(E);return p;};R._engine.rect=function(vml,x,y,w,h,r){var path=R._rectPath(x,y,w,h,r),res=vml.path(path),a=res.attrs;res.X=a.x=x;res.Y=a.y=y;res.W=a.width=w;res.H=a.height=h;a.r=r;a.path=path;res.type="rect";return res;};R._engine.ellipse=function(vml,x,y,rx,ry){var res=vml.path(),a=res.attrs;res.X=x-rx;res.Y=y-ry;res.W=rx*2;res.H=ry*2;res.type="ellipse";setFillAndStroke(res,{cx:x,cy:y,rx:rx,ry:ry});return res;};R._engine.circle=function(vml,x,y,r){var res=vml.path(),a=res.attrs;res.X=x-r;res.Y=y-r;res.W=res.H=r*2;res.type="circle";setFillAndStroke(res,{cx:x,cy:y,r:r});return res;};R._engine.image=function(vml,src,x,y,w,h){var path=R._rectPath(x,y,w,h),res=vml.path(path).attr({stroke:"none"}),a=res.attrs,node=res.node,fill=node.getElementsByTagName(fillString)[0];a.src=src;res.X=a.x=x;res.Y=a.y=y;res.W=a.width=w;res.H=a.height=h;a.path=path;res.type="image";fill.parentNode==node&&node.removeChild(fill);fill.rotate=true;fill.src=src;fill.type="tile";res._.fillpos=[x,y];res._.fillsize=[w,h];node.appendChild(fill);setCoords(res,1,1,0,0,0);return res;};R._engine.text=function(vml,x,y,text){var el=createNode("shape"),path=createNode("path"),o=createNode("textpath");x=x||0;y=y||0;text=text||"";path.v=R.format("m{0},{1}l{2},{1}",round(x*zoom),round(y*zoom),round(x*zoom)+1);path.textpathok=true;o.string=Str(text);o.on=true;el.style.cssText=cssDot;el.coordsize=zoom+S+zoom;el.coordorigin="0 0";var p=new Element(el,vml),attr={fill:"#000",stroke:"none",font:R._availableAttrs.font,text:text};p.shape=el;p.path=path;p.textpath=o;p.type="text";p.attrs.text=Str(text);p.attrs.x=x;p.attrs.y=y;p.attrs.w=1;p.attrs.h=1;setFillAndStroke(p,attr);el.appendChild(o);el.appendChild(path);vml.canvas.appendChild(el);var skew=createNode("skew");skew.on=true;el.appendChild(skew);p.skew=skew;p.transform(E);return p;};R._engine.setSize=function(width,height){var cs=this.canvas.style;this.width=width;this.height=height;width==+width&&(width+="px");height==+height&&(height+="px");cs.width=width;cs.height=height;cs.clip="rect(0 "+width+" "+height+" 0)";if(this._viewBox){R._engine.setViewBox.apply(this,this._viewBox);}
return this;};R._engine.setViewBox=function(x,y,w,h,fit){R.eve("setViewBox",this,this._viewBox,[x,y,w,h,fit]);var width=this.width,height=this.height,size=1/mmax(w/width,h/height),H,W;if(fit){H=height/h;W=width/w;if(w*H<width){x-=(width-w*H)/2/H;}
if(h*W<height){y-=(height-h*W)/2/W;}}
this._viewBox=[x,y,w,h,!!fit];this._viewBoxShift={dx:-x,dy:-y,scale:size};this.forEach(function(el){el.transform("...");});return this;};var createNode;R._engine.initWin=function(win){var doc=win.document;doc.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!doc.namespaces.rvml&&doc.namespaces.add("rvml","urn:schemas-microsoft-com:vml");createNode=function(tagName){return doc.createElement('<rvml:'+tagName+' class="rvml">');};}catch(e){createNode=function(tagName){return doc.createElement('<'+tagName+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');};}};R._engine.initWin(R._g.win);R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con.container,height=con.height,s,width=con.width,x=con.x,y=con.y;if(!container){throw new Error("VML container not found.");}
var res=new R._Paper,c=res.canvas=R._g.doc.createElement("div"),cs=c.style;x=x||0;y=y||0;width=width||512;height=height||342;res.width=width;res.height=height;width==+width&&(width+="px");height==+height&&(height+="px");res.coordsize=zoom*1e3+S+zoom*1e3;res.coordorigin="0 0";res.span=R._g.doc.createElement("span");res.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";c.appendChild(res.span);cs.cssText=R.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",width,height);if(container==1){R._g.doc.body.appendChild(c);cs.left=x+"px";cs.top=y+"px";cs.position="absolute";}else{if(container.firstChild){container.insertBefore(c,container.firstChild);}else{container.appendChild(c);}}
res.renderfix=function(){};return res;};R.prototype.clear=function(){R.eve("clear",this);this.canvas.innerHTML=E;this.span=R._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null;};R.prototype.remove=function(){R.eve("remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
return true;};var setproto=R.st;for(var method in elproto)if(elproto[has](method)&&!setproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg);});};})(method);}}(window.Raphael);;

/* /web_diagram/static/src/js/vec2.js defined in bundle 'web.assets_backend' */
(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;

/* /web_diagram/static/src/js/graph.js defined in bundle 'web.assets_backend' */
(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){$.when(GraphNode.destruction_callback(entity)).done(function(){entity.remove();});}else if(entity_type=="edge"){$.when(GraphEdge.destruction_callback(entity)).done(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;

/* /web_diagram/static/src/js/diagram.js defined in bundle 'web.assets_backend' */
openerp.web_diagram=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t,_lt=instance.web._lt;instance.web.views.add('diagram','instance.web.DiagramView');instance.web.DiagramView=instance.web.View.extend({display_name:_lt('Diagram'),view_type:'diagram',searchable:false,init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.set_default_options(options);this.view_manager=parent;this.dataset=dataset;this.model=this.dataset.model;this.view_id=view_id;this.domain=this.dataset._domain||[];this.context={};this.ids=this.dataset.ids;this.on('pager_action_executed',self,self.pager_action_trigger);},view_loading:function(r){return this.load_diagram(r);},toTitleCase:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});},load_diagram:function(result){var self=this;if(this.ids&&this.ids.length){this.id=this.ids[self.dataset.index||0];}
this.fields_view=result,this.view_id=this.fields_view.view_id,this.fields=this.fields_view.fields,this.nodes=this.fields_view.arch.children[0],this.connectors=this.fields_view.arch.children[1],this.node=this.nodes.attrs.object,this.connector=this.connectors.attrs.object;this.labels=_.filter(this.fields_view.arch.children,function(label){return label.tag=="label";});this.$el.html(QWeb.render("DiagramView",{'widget':self}));this.$el.addClass(this.fields_view.arch.attrs['class']);_.each(self.labels,function(label){html_label='<p style="padding: 4px;">'+label.attrs.string+"</p>";self.$el.find('.oe_diagram_header').append(html_label);})
this.init_pager();this.$el.find('#new_node.oe_diagram_button_new').click(function(){self.add_node();});if(this.id){self.get_diagram_info();}
this.trigger('diagram_view_loaded',result);},get_diagram_info:function(){var self=this;var params={'id':this.id,'model':this.model,'node':this.node,'connector':this.connector,'bgcolor':this.nodes.attrs.bgcolor,'shape':this.nodes.attrs.shape,'src_node':this.connectors.attrs.source,'des_node':this.connectors.attrs.destination,'label':this.connectors.attrs.label||false,'visible_nodes':[],'invisible_nodes':[],'node_fields':[],'connectors':[],'connectors_fields':[]};_.each(this.nodes.children,function(child){if(child.attrs.invisible=='1')
params['invisible_nodes'].push(child.attrs.name);else{params['visible_nodes'].push(child.attrs.name);params['node_fields'].push(self.fields[child.attrs.name]['string']||this.toTitleCase(child.attrs.name));}});_.each(this.connectors.children,function(conn){params['connectors_fields'].push(self.fields[conn.attrs.name]['string']||this.toTitleCase(conn.attrs.name));params['connectors'].push(conn.attrs.name);});this.rpc('/web_diagram/diagram/get_diagram_info',params).done(function(result){self.draw_diagram(result);});},on_diagram_loaded:function(record){var id_record=record['id'];if(id_record){this.id=id_record;this.get_diagram_info();this.do_push_state({id:id_record});}else{this.do_push_state({});}},do_load_state:function(state,warm){if(state&&state.id){if(!this.dataset.get_id_index(state.id)){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);if(warm){this.do_show();}}},draw_diagram:function(result){var self=this;var res_nodes=result['nodes'];var res_edges=result['conn'];this.parent_field=result.parent_field;this.$el.find('h3.oe_diagram_title').text(result.name);var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};var canvas=self.$el.find('div.oe_diagram_diagram').empty().get(0);var r=new Raphael(canvas,'100%','100%');var graph=new CuteGraph(r,style,canvas.parentNode);_.each(res_nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});_.each(res_edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id]);e.id=edge.id;});CuteNode.double_click_callback=function(cutenode){self.edit_node(cutenode.id);};var i=0;CuteNode.destruction_callback=function(cutenode){if(!confirm(_t("Deleting this node cannot be undone.\nIt will also delete all connected transitions.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new instance.web.DataSet(self,self.node).unlink([cutenode.id]);};CuteEdge.double_click_callback=function(cuteedge){self.edit_connector(cuteedge.id);};CuteEdge.creation_callback=function(node_start,node_end){return{label:''};};CuteEdge.new_edge_callback=function(cuteedge){self.add_connector(cuteedge.get_start().id,cuteedge.get_end().id,cuteedge);};CuteEdge.destruction_callback=function(cuteedge){if(!confirm(_t("Deleting this transition cannot be undone.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new instance.web.DataSet(self,self.connector).unlink([cuteedge.id]);};},edit_node:function(node_id){var self=this;var title=_t('Activity');var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.node,node_id,self.context||self.dataset.context,{title:_t("Open: ")+title});pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});var form_fields=[self.parent_field];var form_controller=pop.view_form;form_controller.on("load_record",self,function(){_.each(form_fields,function(fld){if(!(fld in form_controller.fields)){return;}
var field=form_controller.fields[fld];field.$input.prop('disabled',true);field.$drop_down.unbind();});});},add_node:function(){var self=this;var title=_t('Activity');var pop=new instance.web.form.SelectCreatePopup(self);pop.select_element(self.node,{title:_t("Create:")+title,initial_view:'form',disable_multiple_selection:true},self.dataset.domain,self.context||self.dataset.context);pop.on("elements_selected",self,function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});var form_controller=pop.view_form;var form_fields=[this.parent_field];form_controller.on("load_record",self,function(){_.each(form_fields,function(fld){if(!(fld in form_controller.fields)){return;}
var field=form_controller.fields[fld];field.set_value(self.id);field.dirty=true;});});},edit_connector:function(connector_id){var self=this;var title=_t('Transition');var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.connector,parseInt(connector_id,10),self.context||self.dataset.context,{title:_t("Open: ")+title});pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});},add_connector:function(node_source_id,node_dest_id,dummy_cuteedge){var self=this;var title=_t('Transition');var pop=new instance.web.form.SelectCreatePopup(self);pop.select_element(self.connector,{title:_t("Create:")+title,initial_view:'form',disable_multiple_selection:true},this.dataset.domain,this.context||this.dataset.context);pop.on("elements_selected",self,function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});pop.$el.parents('.modal').on('hidden.bs.modal',function(e){if(dummy_cuteedge){dummy_cuteedge.remove();}});var form_controller=pop.view_form;form_controller.on("load_record",self,function(){form_controller.fields[self.connectors.attrs.source].set_value(node_source_id);form_controller.fields[self.connectors.attrs.source].dirty=true;form_controller.fields[self.connectors.attrs.destination].set_value(node_dest_id);form_controller.fields[self.connectors.attrs.destination].dirty=true;});},do_hide:function(){if(this.$pager){this.$pager.hide();}
this._super();},init_pager:function(){var self=this;if(this.$pager)
this.$pager.remove();this.$pager=$(QWeb.render("DiagramView.pager",{'widget':self})).hide();if(this.options.$pager){this.$pager.appendTo(this.options.$pager);}else{this.$el.find('.oe_diagram_pager').replaceWith(this.$pager);}
this.$pager.on('click','a[data-pager-action]',function(){var action=$(this).data('pager-action');self.execute_pager_action(action);});this.do_update_pager();},pager_action_trigger:function(){var loaded=this.dataset.read_index(_.keys(this.fields_view.fields)).then(this.on_diagram_loaded);this.do_update_pager();return loaded;},execute_pager_action:function(action){switch(action){case'first':this.dataset.index=0;break;case'previous':this.dataset.previous();break;case'next':this.dataset.next();break;case'last':this.dataset.index=this.dataset.ids.length-1;break;}
this.trigger('pager_action_executed');},do_update_pager:function(hide_index){this.$pager.toggle(this.dataset.ids.length>1);if(hide_index){$(".oe_diagram_pager_state",this.$pager).html("");}else{$(".oe_diagram_pager_state",this.$pager).html(_.str.sprintf(_t("%d / %d"),this.dataset.index+1,this.dataset.ids.length));}},do_show:function(){this.do_push_state({});return $.when(this._super(),this.execute_pager_action('reload'));}});};;

/* /gantt_improvement/static/src/js/gantt.js defined in bundle 'web.assets_backend' */
openerp.gantt_improvement=function(instance){var _t=instance.web._t,_lt=instance.web._lt,QWeb=instance.web.qweb,attrs=null,last_r=null;instance.web.views.add('gantt','instance.gantt_improvement.GanttView');instance.gantt_improvement.GanttView=instance.web.View.extend({gantt_improvement_id:null,def_already_loaded:false,def_last_domains:null,def_last_contexts:null,def_last_group_bys:null,def_items_ids:null,def_items:null,def_gantt_date_start:new Date(2015,0,1),def_gantt_date_end:new Date(2016,0,1),def_gantt_scale:1,def_lastTaskEvent:null,display_name:_lt('Gantt'),template:"GanttView",view_type:"gantt",events:{'click .gantt_improvement_scale':'reset_scale','click #gantt_i_search_btn':'reload_button'},init:function(){this._super.apply(this,arguments);this.gantt_improvement_id=_.uniqueId();},view_loading:function(r){var self=this;this.last_r=r;this.attrs=r.arch.attrs;},reload:function(){this.view_loading(this.last_r);return this.do_search(this.def_last_domains,this.def_last_contexts,this.def_last_group_bys);},do_search:function(domains,contexts,group_bys){var filter=[],self=this;this.def_last_domains=domains;this.def_last_contexts=contexts;this.def_last_group_bys=group_bys;this.reload_gantt();if(this.attrs.date_stop!==undefined){filter=['&','&','|','|','&',[this.attrs.date_start,'>=',this.def_gantt_date_start],[this.attrs.date_start,'<=',this.def_gantt_date_end],'&',[this.attrs.date_stop,'>=',this.def_gantt_date_start],[this.attrs.date_stop,'<=',this.def_gantt_date_end],'&',[this.attrs.date_start,'<=',this.def_gantt_date_start],[this.attrs.date_stop,'>=',this.def_gantt_date_end],'&',[this.attrs.date_start,'!=',null],[this.attrs.date_stop,'!=',null],];}else if(this.attrs.date_delay!==undefined){filter=[];}
if(domains.length>0)
filter=filter.concat(domains);else
filter.push([this.attrs.date_start,'!=',null]);return(new instance.web.Model(this.dataset.model).query().filter(filter).all().then(function(result){self.def_items=result;self.parse_data(domains,contexts,group_bys);}));},reload_gantt:function(){var label='Name',self=this;if(this.def_already_loaded===true){gantt.clearAll();}else{gantt.config.details_on_dblclick=false;gantt.config.grid_width=200;gantt.config.row_height=20;gantt.config.drag_links=false;gantt.config.drag_progress=false;gantt.config.show_drag_dates=true;gantt.config.drag_label_width=110;gantt.config.drag_date="%Y‐%m‐%d %H:%i";gantt.attachEvent("onGanttReady",function(){gantt.templates.drag_date=gantt.date.date_to_str(gantt.config.drag_date);gantt.addTaskLayer({renderer:function show_dates(task){var sizes=gantt.getTaskPosition(task,task.start_date,task.end_date),wrapper=document.createElement('div');addElement({css:"drag_move_start drag_date",left:sizes.left-gantt.config.drag_label_width+'px',top:sizes.top+'px',width:gantt.config.drag_label_width+'px',height:gantt.config.row_height-1+'px',html:gantt.templates.drag_date(task.start_date),wrapper:wrapper});addElement({css:"drag_move_end drag_date",left:sizes.left+sizes.width+'px',top:sizes.top+'px',width:gantt.config.drag_label_width+'px',height:gantt.config.row_height-1+'px',html:gantt.templates.drag_date(task.end_date),wrapper:wrapper});return wrapper;},filter:function(task){return gantt.config.show_drag_dates&&task.id==gantt.getState().drag_id;}});function addElement(config){var div=document.createElement('div');div.style.position="absolute";div.className=config.css||"";div.style.left=config.left;div.style.width=config.width;div.style.height=config.height;div.style.lineHeight=config.height;div.style.top=config.top;if(config.html)
div.innerHTML=config.html;if(config.wrapper)
config.wrapper.appendChild(div);return div;}});gantt.templates.scale_cell_class=function(date){if(date.getDay()===0||date.getDay()===6){return"weekend";}};gantt.templates.task_cell_class=function(item,date){if(date.getDay()===0||date.getDay()===6){return"weekend";}};gantt.attachEvent("onTaskDblClick",function(id,e){if(id!==undefined&&id.indexOf('p')===-1){self.on_task_display(id);}});gantt.attachEvent("onTaskDrag",function(id,mode,task,original){var lastTaskEvent={};lastTaskEvent.date_start=task.start_date;lastTaskEvent.date_end=task.end_date;lastTaskEvent.odoo_id=task.id;lastTaskEvent.duration=task.duration;self.def_lastTaskEvent=lastTaskEvent;});gantt.attachEvent("onAfterTaskDrag",function(id,mode,task,original){var date_start,date_end;if(self.def_lastTaskEvent!==undefined&&self.def_lastTaskEvent!==null){date_start=new Date.parse(self.def_lastTaskEvent.date_start);date_start.setSeconds(0);self.def_lastTaskEvent.date_start=date_start;date_end=new Date.parse(self.def_lastTaskEvent.date_end);date_end.setSeconds(0);self.def_lastTaskEvent.date_end=date_end;self.saveLastTask(self.def_lastTaskEvent);self.def_lastTaskEvent=null;}});this.$buttons=$(QWeb.render("GanttView.buttons",{'widget':self}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}
document.getElementById('gantt_i_create_button').addEventListener("click",function(){self.create_button(self);});this.$sidebar=this.options.$sidebar||this.$el.find('.oe_form_sidebar');if(!this.sidebar&&this.options.$sidebar){this.sidebar=new instance.web.Sidebar(this);this.sidebar.appendTo(this.$sidebar);}}
if(this.attrs.string!==undefined){label=this.attrs.string;}
gantt.config.columns=[{name:"text",label:label,width:"*",tree:true}];this.def_already_loaded=true;},parse_data:function(domains,contexts,group_bys){var self=this,datas=[],links=[],parents={},i,item,data,start,item_parent_id,item_parent_name;this.def_items_ids=[];if(group_bys[0]===''||group_bys[0]===undefined){if(this.attrs.default_group_by!==undefined){group_bys[0]=this.attrs.default_group_by;}}
for(i in this.def_items){if(this.def_items[i][this.attrs.date_start]!==false&&((this.attrs.date_stop!==undefined&&this.def_items[i][this.attrs.date_stop]!==undefined&&this.def_items[i][this.attrs.date_stop]!==false)||(this.attrs.date_delay!==undefined&&this.def_items[i][this.attrs.date_delay]!==undefined&&this.def_items[i][this.attrs.date_delay]!==false))){item=this.def_items[i];data=null;start=null;item_parent_id='p'+i;item_parent_name='task'+i;this.def_items_ids[item.id]=item;if(group_bys[0]===''||group_bys[0]===undefined||item[group_bys[0]]===undefined||item[group_bys[0]]===false){item_parent_id='p'+0;item_parent_name='Gantt View';}else if(item[group_bys[0]]!==undefined){item_parent_id='p'+item[group_bys][0];item_parent_name=item[group_bys][1];}
if(parents[item_parent_id]===undefined){parents[item_parent_id]=1;datas.push({'id':item_parent_id,'text':item_parent_name,open:true});}
start=instance.web.auto_str_to_date(item[this.attrs.date_start]);data={'id':item.id,'text':item.name,'start_date':start,'parent':item_parent_id,};if(item.sequence!==undefined)
data.order=item.sequence;if(this.attrs.progress!==undefined){data.progress=item[this.attrs.progress]/100.00;}
if(this.attrs.date_stop!==undefined){var end=instance.web.auto_str_to_date(item[this.attrs.date_stop]);data.end_date=end;}else if(this.attrs.date_delay!==undefined){data.duration=(item[this.attrs.date_delay]>0)?item[this.attrs.date_delay]:0.1;}else{console.error('Error gantt_improvement E1');}
datas.push(data);}}
this.draw_gantt(datas,links);},draw_gantt:function(datas,links){var today=new Date();gantt.init(this.gantt_improvement_id,this.def_gantt_date_start,this.def_gantt_date_stop);gantt.parse({'data':datas,'links':links});gantt.config.start_date=this.def_gantt_date_start;gantt.config.end_date=this.def_gantt_date_stop;gantt.addMarker({start_date:today,css:"today",text:_lt("Today"),title:_lt("Today")});},reset_scale:function(){this.set_scale($('.gantt_improvement_scale').val());gantt.render();},reload_button:function(){var date_start,date_stop;date_start=document.getElementById('gantt_improvement_date_start').value;date_stop=document.getElementById('gantt_improvement_date_stop').value;if(date_start!==''&&date_start!==null&&date_stop!==''&&date_stop!==null){this.def_gantt_date_start=new Date(date_start);this.def_gantt_date_stop=new Date(date_stop);gantt.config.start_date=this.def_gantt_date_start;gantt.config.end_date=this.def_gantt_date_stop;}
this.reload();},set_scale:function(value){switch(value){case"1":gantt.config.scale_unit="day";gantt.config.step=1;gantt.config.date_scale="%d %M";gantt.config.subscales=[];gantt.config.scale_height=27;gantt.templates.date_scale=null;break;case"2":var weekScaleTemplate=function(date){var dateToStr=gantt.date.date_to_str("%d %M");var endDate=gantt.date.add(gantt.date.add(date,1,"week"),-1,"day");return dateToStr(date)+" - "+dateToStr(endDate);};gantt.config.scale_unit="week";gantt.config.step=1;gantt.templates.date_scale=weekScaleTemplate;gantt.config.subscales=[{unit:"day",step:1,date:"%D"}];gantt.config.scale_height=50;break;case"3":gantt.config.scale_unit="month";gantt.config.date_scale="%F, %Y";gantt.config.subscales=[{unit:"day",step:1,date:"%j, %D"}];gantt.config.scale_height=50;gantt.templates.date_scale=null;break;case"4":gantt.config.scale_unit="year";gantt.config.step=1;gantt.config.date_scale="%Y";gantt.config.min_column_width=50;gantt.config.scale_height=90;gantt.templates.date_scale=null;gantt.config.subscales=[{unit:"month",step:1,date:"%M"}];break;}},on_task_display:function(id){var self=this;var pop=new instance.web.form.FormOpenPopup(self);pop.on('write_completed',self,self.reload);pop.show_element(self.dataset.model,parseInt(id),null,{});},create_button:function(self){var pop=new instance.web.form.SelectCreatePopup(self);pop.on("elements_selected",self,function(){self.reload();});pop.select_element(self.dataset.model,{initial_view:"form"});},saveLastTask:function(lastTaskEvent){var data={};data[this.attrs.date_start]=lastTaskEvent.date_start;gantt.getTask(lastTaskEvent.odoo_id).start_date=lastTaskEvent.date_start;if(this.attrs.date_stop){data[this.attrs.date_stop]=lastTaskEvent.date_end;gantt.getTask(lastTaskEvent.odoo_id).end_date=lastTaskEvent.date_end;}else{data[this.attrs.date_delay]=lastTaskEvent.duration;gantt.getTask(lastTaskEvent.odoo_id).duration=lastTaskEvent.duration;}
this.dataset.write(lastTaskEvent.odoo_id,data);gantt.updateTask(lastTaskEvent.odoo_id);}});};;

/* /gantt_improvement/static/dhtmlxGantt/sources/dhtmlxgantt.js defined in bundle 'web.assets_backend' */
if(typeof(window.dhx4)=="undefined"){window.dhx4={version:"4.1.3",skin:null,skinDetect:function(comp){return{10:"dhx_skyblue",20:"dhx_web",30:"dhx_terrace"}[this.readFromCss(comp+"_skin_detect")]||null;},readFromCss:function(className,property){var t=document.createElement("DIV");t.className=className;if(document.body.firstChild!=null)document.body.insertBefore(t,document.body.firstChild);else document.body.appendChild(t);var w=t[property||"offsetWidth"];t.parentNode.removeChild(t);t=null;return w;},lastId:1,newId:function(){return this.lastId++;},zim:{data:{},step:5,first:function(){return 100;},last:function(){var t=this.first();for(var a in this.data)t=Math.max(t,this.data[a]);return t;},reserve:function(id){this.data[id]=this.last()+this.step;return this.data[id];},clear:function(id){if(this.data[id]!=null){this.data[id]=null;delete this.data[id];}}},s2b:function(r){if(typeof(r)=="string")r=r.toLowerCase();return(r==true||r==1||r=="true"||r=="1"||r=="yes"||r=="y");},s2j:function(s){var obj=null;dhx4.temp=null;try{eval("dhx4.temp="+s);}catch(e){dhx4.temp=null;}
obj=dhx4.temp;dhx4.temp=null;return obj;},absLeft:function(obj){if(typeof(obj)=="string")obj=document.getElementById(obj);return this.getOffset(obj).left;},absTop:function(obj){if(typeof(obj)=="string")obj=document.getElementById(obj);return this.getOffset(obj).top;},_aOfs:function(elem){var top=0,left=0;while(elem){top=top+parseInt(elem.offsetTop);left=left+parseInt(elem.offsetLeft);elem=elem.offsetParent;}
return{top:top,left:left};},_aOfsRect:function(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)};},getOffset:function(elem){if(elem.getBoundingClientRect){return this._aOfsRect(elem);}else{return this._aOfs(elem);}},_isObj:function(k){return(k!=null&&typeof(k)=="object"&&typeof(k.length)=="undefined");},_copyObj:function(r){if(this._isObj(r)){var t={};for(var a in r){if(typeof(r[a])=="object"&&r[a]!=null)t[a]=this._copyObj(r[a]);else t[a]=r[a];}}else{var t=[];for(var a=0;a<r.length;a++){if(typeof(r[a])=="object"&&r[a]!=null)t[a]=this._copyObj(r[a]);else t[a]=r[a];}}
return t;},screenDim:function(){var isIE=(navigator.userAgent.indexOf("MSIE")>=0);var dim={};dim.left=document.body.scrollLeft;dim.right=dim.left+(window.innerWidth||document.body.clientWidth);dim.top=Math.max((isIE?document.documentElement:document.getElementsByTagName("html")[0]).scrollTop,document.body.scrollTop);dim.bottom=dim.top+(isIE?Math.max(document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0):window.innerHeight);return dim;},selectTextRange:function(inp,start,end){inp=(typeof(inp)=="string"?document.getElementById(inp):inp);var len=inp.value.length;start=Math.max(Math.min(start,len),0);end=Math.min(end,len);if(inp.setSelectionRange){try{inp.setSelectionRange(start,end);}catch(e){};}else if(inp.createTextRange){var range=inp.createTextRange();range.moveStart("character",start);range.moveEnd("character",end-len);try{range.select();}catch(e){};}},transData:null,transDetect:function(){if(this.transData==null){this.transData={transProp:false,transEv:null};var k={"MozTransition":"transitionend","WebkitTransition":"webkitTransitionEnd","OTransition":"oTransitionEnd","msTransition":"transitionend","transition":"transitionend"};for(var a in k){if(this.transData.transProp==false&&document.documentElement.style[a]!=null){this.transData.transProp=a;this.transData.transEv=k[a];}}
k=null;}
return this.transData;},_xmlNodeValue:function(node){var value="";for(var q=0;q<node.childNodes.length;q++){value+=(node.childNodes[q].nodeValue!=null?node.childNodes[q].nodeValue.toString().replace(/^[\n\r\s]{0,}/,"").replace(/[\n\r\s]{0,}$/,""):"");}
return value;}};window.dhx4.isIE=(navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0);window.dhx4.isIE6=(window.XMLHttpRequest==null&&navigator.userAgent.indexOf("MSIE")>=0);window.dhx4.isIE7=(navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0);window.dhx4.isIE8=(navigator.userAgent.indexOf("MSIE 8.0")>=0&&navigator.userAgent.indexOf("Trident")>=0);window.dhx4.isOpera=(navigator.userAgent.indexOf("Opera")>=0);window.dhx4.isChrome=(navigator.userAgent.indexOf("Chrome")>=0);window.dhx4.isKHTML=(navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0);window.dhx4.isFF=(navigator.userAgent.indexOf("Firefox")>=0);window.dhx4.isIPad=(navigator.userAgent.search(/iPad/gi)>=0);};if(typeof(window.dhx4.ajax)=="undefined"){window.dhx4.ajax={cache:false,method:"get",parse:function(data){if(typeof data!=="string")return data;data=data.replace(/^[\s]+/,"");if(window.DOMParser&&!dhx4.isIE){var obj=(new window.DOMParser()).parseFromString(data,"text/xml");}else if(window.ActiveXObject!==window.undefined){var obj=new window.ActiveXObject("Microsoft.XMLDOM");obj.async="false";obj.loadXML(data);}
return obj;},xmltop:function(tagname,xhr,obj){if(typeof xhr.status=="undefined"||xhr.status<400){var xml=(!xhr.responseXML)?dhx4.ajax.parse(xhr.responseText||xhr):(xhr.responseXML||xhr);if(xml&&xml.documentElement!==null&&!xml.getElementsByTagName("parsererror").length){return xml.getElementsByTagName(tagname)[0];}}
if(obj!==-1)dhx4.callEvent("onLoadXMLError",["Incorrect XML",arguments[1],obj]);return document.createElement("DIV");},xpath:function(xpathExp,docObj){if(!docObj.nodeName)docObj=docObj.responseXML||docObj;if(dhx4.isIE){return docObj.selectNodes(xpathExp)||[];}else{var rows=[];var first;var col=(docObj.ownerDocument||docObj).evaluate(xpathExp,docObj,null,XPathResult.ANY_TYPE,null);while(first=col.iterateNext())rows.push(first);return rows;}},query:function(config){dhx4.ajax._call((config.method||"GET"),config.url,config.data||"",(config.async||true),config.callback,null,config.headers);},get:function(url,onLoad){this._call("GET",url,null,true,onLoad);},getSync:function(url){return this._call("GET",url,null,false);},put:function(url,postData,onLoad){this._call("PUT",url,postData,true,onLoad);},del:function(url,postData,onLoad){this._call("DELETE",url,postData,true,onLoad);},post:function(url,postData,onLoad){if(arguments.length==1){postData="";}else if(arguments.length==2&&(typeof(postData)=="function"||typeof(window[postData])=="function")){onLoad=postData;postData="";}else{postData=String(postData);}
this._call("POST",url,postData,true,onLoad);},postSync:function(url,postData){postData=(postData==null?"":String(postData));return this._call("POST",url,postData,false);},getLong:function(url,onLoad){this._call("GET",url,null,true,onLoad,{url:url});},postLong:function(url,postData,onLoad){if(arguments.length==2&&(typeof(postData)=="function"||typeof(window[postData]))){onLoad=postData;postData="";}
this._call("POST",url,postData,true,onLoad,{url:url,postData:postData});},_call:function(method,url,postData,async,onLoad,longParams,headers){var t=(window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"));var isQt=(navigator.userAgent.match(/AppleWebKit/)!=null&&navigator.userAgent.match(/Qt/)!=null&&navigator.userAgent.match(/Safari/)!=null);if(async==true){t.onreadystatechange=function(){if((t.readyState==4)||(isQt==true&&t.readyState==3)){if(t.status!=200||t.responseText=="")
if(!dhx4.callEvent("onAjaxError",[t]))return;window.setTimeout(function(){if(typeof(onLoad)=="function"){onLoad.apply(window,[{xmlDoc:t}]);}
if(longParams!=null){if(typeof(longParams.postData)!="undefined"){dhx4.ajax.postLong(longParams.url,longParams.postData,onLoad);}else{dhx4.ajax.getLong(longParams.url,onLoad);}}
onLoad=null;t=null;},1);}}}
if(method=="GET"&&this.cache!=true){url+=(url.indexOf("?")>=0?"&":"?")+"dhxr"+new Date().getTime()+"=1";}
t.open(method,url,async);if(headers){for(var key in headers)
t.setRequestHeader(key,headers[key]);}else if(method.toUpperCase()=="POST"||method=="PUT"||method=="DELETE"){t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");}else if(method=="GET"){postData=null;}
t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.send(postData);if(!async)return{xmlDoc:t};}};};if(typeof(window.dhx4._eventable)=="undefined"){window.dhx4._eventable=function(obj,mode){if(mode=="clear"){obj.detachAllEvents();obj.dhxevs=null;obj.attachEvent=null;obj.detachEvent=null;obj.checkEvent=null;obj.callEvent=null;obj.detachAllEvents=null;obj=null;return;}
obj.dhxevs={data:{}};obj.attachEvent=function(name,func){name=String(name).toLowerCase();if(!this.dhxevs.data[name])this.dhxevs.data[name]={};var eventId=window.dhx4.newId();this.dhxevs.data[name][eventId]=func;return eventId;}
obj.detachEvent=function(eventId){for(var a in this.dhxevs.data){var k=0;for(var b in this.dhxevs.data[a]){if(b==eventId){this.dhxevs.data[a][b]=null;delete this.dhxevs.data[a][b];}else{k++;}}
if(k==0){this.dhxevs.data[a]=null;delete this.dhxevs.data[a];}}}
obj.checkEvent=function(name){name=String(name).toLowerCase();return(this.dhxevs.data[name]!=null);}
obj.callEvent=function(name,params){name=String(name).toLowerCase();if(this.dhxevs.data[name]==null)return true;var r=true;for(var a in this.dhxevs.data[name]){r=this.dhxevs.data[name][a].apply(this,params)&&r;}
return r;}
obj.detachAllEvents=function(){for(var a in this.dhxevs.data){for(var b in this.dhxevs.data[a]){this.dhxevs.data[a][b]=null;delete this.dhxevs.data[a][b];}
this.dhxevs.data[a]=null;delete this.dhxevs.data[a];}}
obj=null;};dhx4._eventable(dhx4);};if(typeof(window.dhtmlx)=="undefined"){window.dhtmlx={extend:function(a,b){for(var key in b)
if(!a[key])
a[key]=b[key];return a;},extend_api:function(name,map,ext){var t=window[name];if(!t)return;window[name]=function(obj){if(obj&&typeof obj=="object"&&!obj.tagName){var that=t.apply(this,(map._init?map._init(obj):arguments));for(var a in dhtmlx)
if(map[a])this[map[a]](dhtmlx[a]);for(var a in obj){if(map[a])this[map[a]](obj[a]);else if(a.indexOf("on")===0){this.attachEvent(a,obj[a]);}}}else
var that=t.apply(this,arguments);if(map._patch)map._patch(this);return that||this;};window[name].prototype=t.prototype;if(ext)
dhtmlx.extend(window[name].prototype,ext);},url:function(str){if(str.indexOf("?")!=-1)
return"&";else
return"?";}};};_isFF=false;_isIE=false;_isOpera=false;_isKHTML=false;_isMacOS=false;_isChrome=false;_FFrv=false;_KHTMLrv=false;_OperaRv=false;if(navigator.userAgent.indexOf('Macintosh')!=-1)
_isMacOS=true;if(navigator.userAgent.toLowerCase().indexOf('chrome')>-1)
_isChrome=true;if((navigator.userAgent.indexOf('Safari')!=-1)||(navigator.userAgent.indexOf('Konqueror')!=-1)){_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Safari')+7,5));if(_KHTMLrv>525){_isFF=true;_FFrv=1.9;}else
_isKHTML=true;}else if(navigator.userAgent.indexOf('Opera')!=-1){_isOpera=true;_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Opera')+6,3));}
else if(navigator.appName.indexOf("Microsoft")!=-1){_isIE=true;if((navigator.appVersion.indexOf("MSIE 8.0")!=-1||navigator.appVersion.indexOf("MSIE 9.0")!=-1||navigator.appVersion.indexOf("MSIE 10.0")!=-1||document.documentMode>7)&&document.compatMode!="BackCompat"){_isIE=8;}}else if(navigator.appName=='Netscape'&&navigator.userAgent.indexOf("Trident")!=-1){_isIE=8;}else{_isFF=true;_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])}
if(typeof(window.dhtmlxEvent)=="undefined"){function dhtmlxEvent(el,event,handler){if(el.addEventListener)
el.addEventListener(event,handler,false);else if(el.attachEvent)
el.attachEvent("on"+event,handler);}};if(dhtmlxEvent.touchDelay==null){dhtmlxEvent.touchDelay=2000;};if(typeof(dhtmlxEvent.initTouch)=="undefined"){dhtmlxEvent.initTouch=function(){var longtouch;var target;var tx,ty;dhtmlxEvent(document.body,"touchstart",function(ev){target=ev.touches[0].target;tx=ev.touches[0].clientX;ty=ev.touches[0].clientY;longtouch=window.setTimeout(touch_event,dhtmlxEvent.touchDelay);});function touch_event(){if(target){var ev=document.createEvent("HTMLEvents");ev.initEvent("dblclick",true,true);target.dispatchEvent(ev);longtouch=target=null;}};dhtmlxEvent(document.body,"touchmove",function(ev){if(longtouch){if(Math.abs(ev.touches[0].clientX-tx)>50||Math.abs(ev.touches[0].clientY-ty)>50){window.clearTimeout(longtouch);longtouch=target=false;}}});dhtmlxEvent(document.body,"touchend",function(ev){if(longtouch){window.clearTimeout(longtouch);longtouch=target=false;}});dhtmlxEvent.initTouch=function(){};};};if(!window.dhtmlx)
window.dhtmlx={};(function(){var _dhx_msg_cfg=null;function callback(config,result){var usercall=config.callback;modality(false);config.box.parentNode.removeChild(config.box);_dhx_msg_cfg=config.box=null;if(usercall)
usercall(result);}
function modal_key(e){if(_dhx_msg_cfg){e=e||event;var code=e.which||event.keyCode;if(dhtmlx.message.keyboard){if(code==13||code==32)
callback(_dhx_msg_cfg,true);if(code==27)
callback(_dhx_msg_cfg,false);}
if(e.preventDefault)
e.preventDefault();return!(e.cancelBubble=true);}}
if(document.attachEvent)
document.attachEvent("onkeydown",modal_key);else
document.addEventListener("keydown",modal_key,true);function modality(mode){if(!modality.cover){modality.cover=document.createElement("DIV");modality.cover.onkeydown=modal_key;modality.cover.className="dhx_modal_cover";document.body.appendChild(modality.cover);}
var height=document.body.scrollHeight;modality.cover.style.display=mode?"inline-block":"none";}
function button(text,result){var button_css="dhtmlx_"+text.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+button_css+"' result='"+result+"' ><div>"+text+"</div></div>";}
function info(text){if(!t.area){t.area=document.createElement("DIV");t.area.className="dhtmlx_message_area";t.area.style[t.position]="5px";document.body.appendChild(t.area);}
t.hide(text.id);var message=document.createElement("DIV");message.innerHTML="<div>"+text.text+"</div>";message.className="dhtmlx-info dhtmlx-"+text.type;message.onclick=function(){t.hide(text.id);text=null;};if(t.position=="bottom"&&t.area.firstChild)
t.area.insertBefore(message,t.area.firstChild);else
t.area.appendChild(message);if(text.expire>0)
t.timers[text.id]=window.setTimeout(function(){t.hide(text.id);},text.expire);t.pull[text.id]=message;message=null;return text.id;}
function _boxStructure(config,ok,cancel){var box=document.createElement("DIV");box.className=" dhtmlx_modal_box dhtmlx-"+config.type;box.setAttribute("dhxbox",1);var inner='';if(config.width)
box.style.width=config.width;if(config.height)
box.style.height=config.height;if(config.title)
inner+='<div class="dhtmlx_popup_title">'+config.title+'</div>';inner+='<div class="dhtmlx_popup_text"><span>'+(config.content?'':config.text)+'</span></div><div  class="dhtmlx_popup_controls">';if(ok)
inner+=button(config.ok||"OK",true);if(cancel)
inner+=button(config.cancel||"Cancel",false);if(config.buttons){for(var i=0;i<config.buttons.length;i++)
inner+=button(config.buttons[i],i);}
inner+='</div>';box.innerHTML=inner;if(config.content){var node=config.content;if(typeof node=="string")
node=document.getElementById(node);if(node.style.display=='none')
node.style.display="";box.childNodes[config.title?1:0].appendChild(node);}
box.onclick=function(e){e=e||event;var source=e.target||e.srcElement;if(!source.className)source=source.parentNode;if(source.className.split(" ")[0]=="dhtmlx_popup_button"){var result=source.getAttribute("result");result=(result=="true")||(result=="false"?false:result);callback(config,result);}};config.box=box;if(ok||cancel)
_dhx_msg_cfg=config;return box;}
function _createBox(config,ok,cancel){var box=config.tagName?config:_boxStructure(config,ok,cancel);if(!config.hidden)
modality(true);document.body.appendChild(box);var x=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-box.offsetWidth)/2));var y=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-box.offsetHeight)/2));if(config.position=="top")
box.style.top="-3px";else
box.style.top=y+'px';box.style.left=x+'px';box.onkeydown=modal_key;box.focus();if(config.hidden)
dhtmlx.modalbox.hide(box);return box;}
function alertPopup(config){return _createBox(config,true,false);}
function confirmPopup(config){return _createBox(config,true,true);}
function boxPopup(config){return _createBox(config);}
function box_params(text,type,callback){if(typeof text!="object"){if(typeof type=="function"){callback=type;type="";}
text={text:text,type:type,callback:callback};}
return text;}
function params(text,type,expire,id){if(typeof text!="object")
text={text:text,type:type,expire:expire,id:id};text.id=text.id||t.uid();text.expire=text.expire||t.expire;return text;}
dhtmlx.alert=function(){var text=box_params.apply(this,arguments);text.type=text.type||"confirm";return alertPopup(text);};dhtmlx.confirm=function(){var text=box_params.apply(this,arguments);text.type=text.type||"alert";return confirmPopup(text);};dhtmlx.modalbox=function(){var text=box_params.apply(this,arguments);text.type=text.type||"alert";return boxPopup(text);};dhtmlx.modalbox.hide=function(node){while(node&&node.getAttribute&&!node.getAttribute("dhxbox"))
node=node.parentNode;if(node){node.parentNode.removeChild(node);modality(false);}};var t=dhtmlx.message=function(text,type,expire,id){text=params.apply(this,arguments);text.type=text.type||"info";var subtype=text.type.split("-")[0];switch(subtype){case"alert":return alertPopup(text);case"confirm":return confirmPopup(text);case"modalbox":return boxPopup(text);default:return info(text);}};t.seed=(new Date()).valueOf();t.uid=function(){return t.seed++;};t.expire=4000;t.keyboard=true;t.position="top";t.pull={};t.timers={};t.hideAll=function(){for(var key in t.pull)
t.hide(key);};t.hide=function(id){var obj=t.pull[id];if(obj&&obj.parentNode){window.setTimeout(function(){obj.parentNode.removeChild(obj);obj=null;},2000);obj.className+=" hidden";if(t.timers[id])
window.clearTimeout(t.timers[id]);delete t.pull[id];}};})();gantt={version:"3.3.0"};function dhtmlxDetachEvent(el,event,handler){if(el.removeEventListener)
el.removeEventListener(event,handler,false);else if(el.detachEvent)
el.detachEvent("on"+event,handler);}
dhtmlxEventable=function(obj){obj._silent_mode=false;obj._silentStart=function(){this._silent_mode=true;};obj._silentEnd=function(){this._silent_mode=false;};obj.attachEvent=function(name,catcher,callObj){name='ev_'+name.toLowerCase();if(!this[name])
this[name]=new this._eventCatcher(callObj||this);return(name+':'+this[name].addEvent(catcher));};obj.callEvent=function(name,arg0){if(this._silent_mode)return true;name='ev_'+name.toLowerCase();if(this[name])
return this[name].apply(this,arg0);return true;};obj.checkEvent=function(name){return(!!this['ev_'+name.toLowerCase()]);};obj._eventCatcher=function(obj){var dhx_catch=[];var z=function(){var res=true;for(var i=0;i<dhx_catch.length;i++){if(dhx_catch[i]){var zr=dhx_catch[i].apply(obj,arguments);res=res&&zr;}}
return res;};z.addEvent=function(ev){if(typeof(ev)!="function")
ev=eval(ev);if(ev)
return dhx_catch.push(ev)-1;return false;};z.removeEvent=function(id){dhx_catch[id]=null;};return z;};obj.detachEvent=function(id){if(id){var list=id.split(':');this[list[0]].removeEvent(list[1]);}};obj.detachAllEvents=function(){for(var name in this){if(name.indexOf("ev_")===0)
delete this[name];}};obj=null;};dhtmlx.copy=function(object){var i,t,result;if(object&&typeof object=="object"){result={};t=[Array,Date,Number,String,Boolean];for(i=0;i<t.length;i++){if(object instanceof t[i])
result=i?new t[i](object):new t[i]();}
for(i in object){if(Object.prototype.hasOwnProperty.apply(object,[i]))
result[i]=dhtmlx.copy(object[i]);}}
return result||object;};dhtmlx.mixin=function(target,source,force){for(var f in source)
if((!target[f]||force))target[f]=source[f];return target;};dhtmlx.defined=function(obj){return typeof(obj)!="undefined";};dhtmlx.uid=function(){if(!this._seed)
this._seed=(new Date()).valueOf();this._seed++;return this._seed;};dhtmlx.bind=function(functor,object){if(functor.bind)
return functor.bind(object);else
return function(){return functor.apply(object,arguments);};};gantt._get_position=function(elem){var top=0,left=0;if(elem.getBoundingClientRect){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;top=box.top+scrollTop-clientTop;left=box.left+scrollLeft-clientLeft;return{y:Math.round(top),x:Math.round(left),width:elem.offsetWidth,height:elem.offsetHeight};}else{while(elem){top=top+parseInt(elem.offsetTop,10);left=left+parseInt(elem.offsetLeft,10);elem=elem.offsetParent;}
return{y:top,x:left,width:elem.offsetWidth,height:elem.offsetHeight};}};gantt._detectScrollSize=function(){var div=document.createElement("div");div.style.cssText="visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;";document.body.appendChild(div);var width=div.offsetWidth-div.clientWidth;document.body.removeChild(div);return width;};if(window.dhtmlx){if(!dhtmlx.attaches)
dhtmlx.attaches={};dhtmlx.attaches.attachGantt=function(start,end,gantt){var obj=document.createElement("DIV");obj.id="gantt_"+dhtmlx.uid();obj.style.width="100%";obj.style.height="100%";obj.cmp="grid";gantt=gantt||window.gantt;document.body.appendChild(obj);this.attachObject(obj.id);var that=this.vs[this.av];that.grid=gantt;gantt.init(obj.id,start,end);obj.firstChild.style.border="none";that.gridId=obj.id;that.gridObj=obj;var method_name="_viewRestore";return this.vs[this[method_name]()].grid;};}
if(typeof(window.dhtmlXCellObject)!="undefined"){dhtmlXCellObject.prototype.attachGantt=function(start,end,gantt){var obj=document.createElement("DIV");obj.id="gantt_"+dhtmlx.uid();obj.style.width="100%";obj.style.height="100%";obj.cmp="grid";document.body.appendChild(obj);this.attachObject(obj.id);gantt=gantt||window.gantt;gantt.init(obj.id,start,end);obj.firstChild.style.border="none";var method_name="_viewRestore";obj=null;this.callEvent("_onContentAttach",[]);return this.dataObj;};}
dhtmlxEventable(gantt);dhx4.ajax.cache=true;gantt._click={};gantt._dbl_click={};gantt._context_menu={};gantt._on_click=function(e){e=e||window.event;var trg=e.target||e.srcElement;var id=gantt.locate(e);var res=true;if(id!==null){res=!gantt.checkEvent("onTaskClick")||gantt.callEvent("onTaskClick",[id,e]);}else{gantt.callEvent("onEmptyClick",[e]);}
if(res){var default_action=gantt._find_ev_handler(e,trg,gantt._click,id);if(!default_action)
return;if(id&&gantt.getTask(id)&&gantt.config.select_task){gantt.selectTask(id);}}};gantt._on_contextmenu=function(e){e=e||window.event;var src=e.target||e.srcElement,taskId=gantt.locate(src),linkId=gantt.locate(src,gantt.config.link_attribute);var res=!gantt.checkEvent("onContextMenu")||gantt.callEvent("onContextMenu",[taskId,linkId,e]);if(!res){if(e.preventDefault)
e.preventDefault();else
e.returnValue=false;}
return res;};gantt._find_ev_handler=function(e,trg,hash,id){var res=true;while(trg){var css=gantt._getClassName(trg);if(css){css=css.split(" ");for(var i=0;i<css.length;i++){if(!css[i])continue;if(hash[css[i]]){var handler=hash[css[i]].call(gantt,e,id,trg);res=res&&!(typeof handler!="undefined"&&handler!==true);}}}
trg=trg.parentNode;}
return res;};gantt._on_dblclick=function(e){e=e||window.event;var trg=e.target||e.srcElement;var id=gantt.locate(e);var res=!gantt.checkEvent("onTaskDblClick")||gantt.callEvent("onTaskDblClick",[id,e]);if(res){var default_action=gantt._find_ev_handler(e,trg,gantt._dbl_click,id);if(!default_action)
return;if(id!==null&&gantt.getTask(id)){if(res&&gantt.config.details_on_dblclick){gantt.showLightbox(id);}}}};gantt._on_mousemove=function(e){if(gantt.checkEvent("onMouseMove")){var id=gantt.locate(e);gantt._last_move_event=e;gantt.callEvent("onMouseMove",[id,e]);}};function dhtmlxDnD(obj,config){if(config){this._settings=config;}
dhtmlxEventable(this);dhtmlxEvent(obj,"mousedown",dhtmlx.bind(function(e){config.original_target={target:e.target||e.srcElement};this.dragStart(obj,e);},this));}
dhtmlxDnD.prototype={dragStart:function(obj,e){this.config={obj:obj,marker:null,started:false,pos:this.getPosition(e),sensitivity:4};if(this._settings)
dhtmlx.mixin(this.config,this._settings,true);var mousemove=dhtmlx.bind(function(e){return this.dragMove(obj,e);},this);var scroll=dhtmlx.bind(function(e){return this.dragScroll(obj,e);},this);var limited_mousemove=dhtmlx.bind(function(e){if(dhtmlx.defined(this.config.updates_per_second)){if(!gantt._checkTimeout(this,this.config.updates_per_second))
return true;}
return mousemove(e);},this);var mouseup=dhtmlx.bind(function(e){dhtmlxDetachEvent(document.body,"mousemove",limited_mousemove);dhtmlxDetachEvent(document.body,"mouseup",mouseup);return this.dragEnd(obj);},this);dhtmlxEvent(document.body,"mousemove",limited_mousemove);dhtmlxEvent(document.body,"mouseup",mouseup);document.body.className+=" gantt_noselect";},dragMove:function(obj,e){if(!this.config.marker&&!this.config.started){var pos=this.getPosition(e);var diff_x=pos.x-this.config.pos.x;var diff_y=pos.y-this.config.pos.y;var distance=Math.sqrt(Math.pow(Math.abs(diff_x),2)+Math.pow(Math.abs(diff_y),2));if(distance>this.config.sensitivity){this.config.started=true;this.config.ignore=false;if(this.callEvent("onBeforeDragStart",[obj,this.config.original_target])===false){this.config.ignore=true;return true;}
var marker=this.config.marker=document.createElement("div");marker.className="gantt_drag_marker";marker.innerHTML="Dragging object";document.body.appendChild(marker);this.callEvent("onAfterDragStart",[obj,this.config.original_target]);}else
this.config.ignore=true;}
if(!this.config.ignore){e.pos=this.getPosition(e);this.config.marker.style.left=e.pos.x+"px";this.config.marker.style.top=e.pos.y+"px";this.callEvent("onDragMove",[obj,e]);}},dragEnd:function(obj){if(this.config.marker){this.config.marker.parentNode.removeChild(this.config.marker);this.config.marker=null;this.callEvent("onDragEnd",[]);}
document.body.className=document.body.className.replace(" gantt_noselect","");},getPosition:function(e){var x=0,y=0;e=e||window.event;if(e.pageX||e.pageY){x=e.pageX;y=e.pageY;}else if(e.clientX||e.clientY){x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;}
return{x:x,y:y};}};gantt._init_grid=function(){this._click.gantt_close=dhtmlx.bind(function(e,id,trg){this.close(id);return false;},this);this._click.gantt_open=dhtmlx.bind(function(e,id,trg){this.open(id);return false;},this);this._click.gantt_row=dhtmlx.bind(function(e,id,trg){if(id!==null){var task=this.getTask(id);if(this.config.scroll_on_click)
this.showDate(task.start_date);this.callEvent("onTaskRowClick",[id,trg]);}},this);this._click.gantt_grid_head_cell=dhtmlx.bind(function(e,id,trg){var column=trg.getAttribute("column_id");if(!this.callEvent("onGridHeaderClick",[column,e]))
return;if(column=="add"){this._click.gantt_add(e,this.config.root_id);return;}
if(this.config.sort){var sorting_method=column,conf;for(var i=0;this.config.columns.length;i++){if(this.config.columns[i].name==column){conf=this.config.columns[i];break;}}
if(conf&&conf.sort!==undefined&&conf.sort!==true){sorting_method=conf.sort;if(!sorting_method){return;}}
var sort=(this._sort&&this._sort.direction&&this._sort.name==column)?this._sort.direction:"desc";sort=(sort=="desc")?"asc":"desc";this._sort={name:column,direction:sort};this.sort(sorting_method,sort=="desc");}},this);if(!this.config.sort&&this.config.order_branch){this._init_dnd();}
this._click.gantt_add=dhtmlx.bind(function(e,id,trg){if(this.config.readonly)return;var item={};this.createTask(item,id?id:this.config.root_id);return false;},this);if(this._init_resize){this._init_resize();}};gantt._render_grid=function(){if(this._is_grid_visible()){this._calc_grid_width();this._render_grid_header();}};gantt._calc_grid_width=function(){var columns=this.getGridColumns();var cols_width=0;var unknown=[];var width=[];for(var i=0;i<columns.length;i++){var v=parseInt(columns[i].width,10);if(window.isNaN(v)){v=50;unknown.push(i);}
width[i]=v;cols_width+=v;}
if(this.config.autofit||unknown.length){var diff=this._get_grid_width()-cols_width;var step=diff/(unknown.length>0?unknown.length:(width.length>0?width.length:1));if(unknown.length>0){var delta=diff/(unknown.length?unknown.length:1);for(var i=0;i<unknown.length;i++){var index=unknown[i];width[index]+=delta;}}else{var delta=diff/(width.length?width.length:1);for(var i=0;i<width.length;i++)
width[i]+=delta;}
for(var i=0;i<width.length;i++){columns[i].width=width[i];}}else{this.config.grid_width=cols_width;}};gantt._render_grid_header=function(){var columns=this.getGridColumns();var cells=[];var width=0,labels=this.locale.labels;var lineHeigth=this.config.scale_height-2;for(var i=0;i<columns.length;i++){var last=i==columns.length-1;var col=columns[i];if(last&&this._get_grid_width()>width+col.width)
col.width=this._get_grid_width()-width;width+=col.width;var sort=(this._sort&&col.name==this._sort.name)?("<div class='gantt_sort gantt_"+this._sort.direction+"'></div>"):"";var cssClass=["gantt_grid_head_cell",("gantt_grid_head_"+col.name),(last?"gantt_last_cell":""),this.templates.grid_header_class(col.name,col)].join(" ");var style="width:"+(col.width-(last?1:0))+"px;";var label=(col.label||labels["column_"+col.name]);label=label||"";var cell="<div class='"+cssClass+"' style='"+style+"' column_id='"+col.name+"'>"+label+sort+"</div>";cells.push(cell);}
this.$grid_scale.style.height=(this.config.scale_height-1)+"px";this.$grid_scale.style.lineHeight=lineHeigth+"px";this.$grid_scale.style.width=(width-1)+"px";this.$grid_scale.innerHTML=cells.join("");};gantt._render_grid_item=function(item){if(!gantt._is_grid_visible())
return null;var columns=this.getGridColumns();var cells=[];var width=0;for(var i=0;i<columns.length;i++){var last=i==columns.length-1;var col=columns[i];var cell;var value;if(col.name=="add"){value="<div class='gantt_add'></div>";}else{if(col.template)
value=col.template(item);else
value=item[col.name];if(value instanceof Date)
value=this.templates.date_grid(value,item);value="<div class='gantt_tree_content'>"+value+"</div>";}
var css="gantt_cell"+(last?" gantt_last_cell":"");var tree="";if(col.tree){for(var j=0;j<item.$level;j++)
tree+=this.templates.grid_indent(item);var has_child=this._has_children(item.id);if(has_child){tree+=this.templates.grid_open(item);tree+=this.templates.grid_folder(item);}else{tree+=this.templates.grid_blank(item);tree+=this.templates.grid_file(item);}}
var style="width:"+(col.width-(last?1:0))+"px;";if(dhtmlx.defined(col.align))
style+="text-align:"+col.align+";";cell="<div class='"+css+"' style='"+style+"'>"+tree+value+"</div>";cells.push(cell);}
var css=item.$index%2===0?"":" odd";css+=(item.$transparent)?" gantt_transparent":"";css+=(item.$dataprocessor_class?" "+item.$dataprocessor_class:"");if(this.templates.grid_row_class){var css_template=this.templates.grid_row_class.call(this,item.start_date,item.end_date,item);if(css_template)
css+=" "+css_template;}
if(this.getState().selected_task==item.id){css+=" gantt_selected";}
var el=document.createElement("div");el.className="gantt_row"+css;el.style.height=this.config.row_height+"px";el.style.lineHeight=(gantt.config.row_height)+"px";el.setAttribute(this.config.task_attribute,item.id);el.innerHTML=cells.join("");return el;};gantt.open=function(id){gantt._set_item_state(id,true);this.callEvent("onTaskOpened",[id]);};gantt.close=function(id){gantt._set_item_state(id,false);this.callEvent("onTaskClosed",[id]);};gantt._set_item_state=function(id,state){if(id&&this._pull[id]){this._pull[id].$open=state;gantt._refresh_on_toggle_element(id);}};gantt._refresh_on_toggle_element=function(id){this.refreshData();};gantt._is_grid_visible=function(){return(this.config.grid_width&&this.config.show_grid);};gantt._get_grid_width=function(){if(this._is_grid_visible()){if(this._is_chart_visible()){return this.config.grid_width;}else{return this._x;}}else{return 0;}};gantt.moveTask=function(sid,tindex,parent){var id=arguments[3];if(id){if(id===sid)return;parent=this.getParent(id);tindex=this.getTaskIndex(id);}
if(sid==parent){return;}
parent=parent||this.config.root_id;var source=this.getTask(sid);var source_pid=this.getParent(source.id);var sbranch=this.getChildren(this.getParent(source.id));var tbranch=this.getChildren(parent);if(tindex==-1)
tindex=tbranch.length+1;if(source_pid==parent){var sindex=this.getTaskIndex(sid);if(sindex==tindex)return;}
if(this.callEvent("onBeforeTaskMove",[sid,parent,tindex])===false)
return;this._replace_branch_child(source_pid,sid);tbranch=this.getChildren(parent);var tid=tbranch[tindex];if(!tid)
tbranch.push(sid);else
tbranch=tbranch.slice(0,tindex).concat([sid]).concat(tbranch.slice(tindex));this.setParent(source,parent);this._branches[parent]=tbranch;source.$level=this.calculateTaskLevel(source);if(tindex*1>0){if(id){source.$drop_target=(this.getTaskIndex(sid)>this.getTaskIndex(id)?"next:":'')+id;}else{source.$drop_target="next:"+gantt.getPrevSibling(sid);}}else if(tbranch[tindex*1+1]){source.$drop_target=tbranch[tindex*1+1];}else{source.$drop_target=parent;}
if(!this.callEvent("onAfterTaskMove",[sid,parent,tindex]))
return;this.refreshData();};gantt._init_dnd=function(){var dnd=new dhtmlxDnD(this.$grid_data,{updates_per_second:60});if(dhtmlx.defined(this.config.dnd_sensitivity))
dnd.config.sensitivity=this.config.dnd_sensitivity;dnd.attachEvent("onBeforeDragStart",dhtmlx.bind(function(obj,e){var el=this._locateHTML(e);if(!el)return false;if(this.hideQuickInfo)this._hideQuickInfo();var id=this.locate(e);var task=gantt.getTask(id);if(gantt._is_readonly(task))
return false;dnd.config.initial_open_state=task.$open;if(!this.callEvent("onRowDragStart",[id,e.target||e.srcElement,e])){return false;}},this));dnd.attachEvent("onAfterDragStart",dhtmlx.bind(function(obj,e){var el=this._locateHTML(e);dnd.config.marker.innerHTML=el.outerHTML;dnd.config.id=this.locate(e);var task=this.getTask(dnd.config.id);dnd.config.index=this.getTaskIndex(dnd.config.id);dnd.config.parent=task.parent;task.$open=false;task.$transparent=true;this.refreshData();},this));dnd.lastTaskOfLevel=function(level){var ids=gantt._order,pull=gantt._pull,last_item=null;for(var i=0,len=ids.length;i<len;i++){if(pull[ids[i]].$level==level){last_item=pull[ids[i]];}}
return last_item?last_item.id:null;};dnd._getGridPos=dhtmlx.bind(function(e){var pos=this._get_position(this.$grid_data);var x=pos.x;var y=e.pos.y-10;if(y<pos.y)y=pos.y;if(y>pos.y+this.$grid_data.offsetHeight-this.config.row_height)y=pos.y+this.$grid_data.offsetHeight-this.config.row_height;pos.x=x;pos.y=y;return pos;},this);dnd.attachEvent("onDragMove",dhtmlx.bind(function(obj,e){var dd=dnd.config;var pos=dnd._getGridPos(e);dd.marker.style.left=pos.x+10+"px";dd.marker.style.top=pos.y+"px";pos=dnd._getGridPos(e);var x=pos.x,y=pos.y;var target=document.elementFromPoint(pos.x-document.body.scrollLeft+1,y-document.body.scrollTop);var el=this.locate(target);var item=this.getTask(dnd.config.id);if(!this.isTaskExists(el)){el=dnd.lastTaskOfLevel(gantt.config.order_branch_free?item.$level:0);if(el==dnd.config.id){el=null;}}
function allowedLevel(next,item){return(next.$level==item.$level||gantt.config.order_branch_free);}
if(this.isTaskExists(el)){var box=gantt._get_position(target);var over=this.getTask(el);if(box.y+target.offsetHeight/2<y){var index=this.getGlobalTaskIndex(over.id);var next=this._pull[this._order[index+1]];if(next){if(next.id!=item.id)
over=next;else
return;}else{next=this._pull[this._order[index]];if(allowedLevel(next,item)&&next.id!=item.id){this.moveTask(item.id,-1,this.getParent(next.id));return;}}}
var index=this.getGlobalTaskIndex(over.id),prev=this._pull[this._order[index-1]];var shift=1;while((!prev||prev.id==over.id)&&index-shift>=0){prev=this._pull[this._order[index-shift]];shift++;}
if(item.id==over.id)return;if(allowedLevel(over,item)&&item.id!=over.id){this.moveTask(item.id,0,0,over.id);}else if(over.$level==item.$level-1&&!gantt.getChildren(over.id).length){this.moveTask(item.id,0,over.id);}else if(prev&&(allowedLevel(prev,item))&&(item.id!=prev.id)){this.moveTask(item.id,-1,this.getParent(prev.id));}}
return true;},this));dnd.attachEvent("onDragEnd",dhtmlx.bind(function(){var task=this.getTask(dnd.config.id);if(this.callEvent("onBeforeRowDragEnd",[dnd.config.id,dnd.config.parent,dnd.config.index])===false){this.moveTask(dnd.config.id,dnd.config.index,dnd.config.parent);task.$drop_target=null;}else{this.callEvent("onRowDragEnd",[dnd.config.id,task.$drop_target]);}
task.$transparent=false;task.$open=dnd.config.initial_open_state;this.refreshData();},this));};gantt.getGridColumns=function(){return this.config.columns;};gantt._has_children=function(id){return this.getChildren(id).length>0;};gantt._scale_helpers={getSum:function(sizes,from,to){if(to===undefined)
to=sizes.length-1;if(from===undefined)
from=0;var summ=0;for(var i=from;i<=to;i++)
summ+=sizes[i];return summ;},setSumWidth:function(sum_width,scale,from,to){var parts=scale.width;if(to===undefined)
to=parts.length-1;if(from===undefined)
from=0;var length=to-from+1;if(from>parts.length-1||length<=0||to>parts.length-1)
return;var oldWidth=this.getSum(parts,from,to);var diff=sum_width-oldWidth;this.adjustSize(diff,parts,from,to);this.adjustSize(-diff,parts,to+1);scale.full_width=this.getSum(parts);},splitSize:function(width,count){var arr=[];for(var i=0;i<count;i++)arr[i]=0;this.adjustSize(width,arr);return arr;},adjustSize:function(width,parts,from,to){if(!from)
from=0;if(to===undefined)
to=parts.length-1;var length=to-from+1;var full=this.getSum(parts,from,to);var shared=0;for(var i=from;i<=to;i++){var share=Math.floor(width*(full?(parts[i]/full):(1/length)));full-=parts[i];width-=share;length--;parts[i]+=share;shared+=share;}
parts[parts.length-1]+=width;},sortScales:function(scales){function cellSize(unit,step){var d=new Date(1970,0,1);return gantt.date.add(d,step,unit)-d;}
scales.sort(function(a,b){if(cellSize(a.unit,a.step)<cellSize(b.unit,b.step)){return 1;}else if(cellSize(a.unit,a.step)>cellSize(b.unit,b.step)){return-1;}else{return 0;}});},primaryScale:function(){gantt._init_template("date_scale");return{unit:gantt.config.scale_unit,step:gantt.config.step,template:gantt.templates.date_scale,date:gantt.config.date_scale,css:gantt.templates.scale_cell_class};},prepareConfigs:function(scales,min_coll_width,container_width,scale_height){var heights=this.splitSize(scale_height,scales.length);var full_width=container_width;var configs=[];for(var i=scales.length-1;i>=0;i--){var main_scale=(i==scales.length-1);var cfg=this.initScaleConfig(scales[i]);if(main_scale){this.processIgnores(cfg);}
this.initColSizes(cfg,min_coll_width,full_width,heights[i]);this.limitVisibleRange(cfg);if(main_scale){full_width=cfg.full_width;}
configs.unshift(cfg);}
for(var i=0;i<configs.length-1;i++){this.alineScaleColumns(configs[configs.length-1],configs[i]);}
for(var i=0;i<configs.length;i++){this.setPosSettings(configs[i]);}
return configs;},setPosSettings:function(config){for(var i=0,len=config.trace_x.length;i<len;i++){config.left.push((config.width[i-1]||0)+(config.left[i-1]||0));}},_ignore_time_config:function(date){if(this.config.skip_off_time){return!this.isWorkTime(date);}
return false;},processIgnores:function(config){config.ignore_x={};config.display_count=config.count;},initColSizes:function(config,min_col_width,full_width,line_height){var cont_width=full_width;config.height=line_height;var column_count=config.display_count===undefined?config.count:config.display_count;if(!column_count)
column_count=1;config.col_width=Math.floor(cont_width/column_count);if(min_col_width){if(config.col_width<min_col_width){config.col_width=min_col_width;cont_width=config.col_width*column_count;}}
config.width=[];var ignores=config.ignore_x||{};for(var i=0;i<config.trace_x.length;i++){if(ignores[config.trace_x[i].valueOf()]||(config.display_count==config.count)){config.width[i]=0;}else{config.width[i]=1;}}
this.adjustSize(cont_width-this.getSum(config.width),config.width);config.full_width=this.getSum(config.width);},initScaleConfig:function(config){var cfg=dhtmlx.mixin({count:0,col_width:0,full_width:0,height:0,width:[],left:[],trace_x:[]},config);this.eachColumn(config.unit,config.step,function(date){cfg.count++;cfg.trace_x.push(new Date(date));});return cfg;},iterateScales:function(lower_scale,upper_scale,from,to,callback){var upper_dates=upper_scale.trace_x;var lower_dates=lower_scale.trace_x;var prev=from||0;var end=to||(lower_dates.length-1);var prevUpper=0;for(var up=1;up<upper_dates.length;up++){for(var next=prev;next<=end;next++){if(+lower_dates[next]==+upper_dates[up]){if(callback){callback.apply(this,[prevUpper,up,prev,next]);}
prev=next;prevUpper=up;continue;}}}},alineScaleColumns:function(lower_scale,upper_scale,from,to){this.iterateScales(lower_scale,upper_scale,from,to,function(upper_start,upper_end,lower_start,lower_end){var targetWidth=this.getSum(lower_scale.width,lower_start,lower_end-1);var actualWidth=this.getSum(upper_scale.width,upper_start,upper_end-1);if(actualWidth!=targetWidth){this.setSumWidth(targetWidth,upper_scale,upper_start,upper_end-1);}});},eachColumn:function(unit,step,callback){var start=new Date(gantt._min_date),end=new Date(gantt._max_date);if(gantt.date[unit+"_start"]){start=gantt.date[unit+"_start"](start);}
var curr=new Date(start);if(+curr>=+end){end=gantt.date.add(curr,step,unit);}
while(+curr<+end){callback.call(this,new Date(curr));var tzOffset=curr.getTimezoneOffset();curr=gantt.date.add(curr,step,unit);curr=gantt._correct_dst_change(curr,tzOffset,step,unit);if(gantt.date[unit+'_start'])
curr=gantt.date[unit+"_start"](curr);}},limitVisibleRange:function(cfg){var dates=cfg.trace_x;var left=0,right=cfg.width.length-1;var diff=0;if(+dates[0]<+gantt._min_date&&left!=right){var width=Math.floor(cfg.width[0]*((dates[1]-gantt._min_date)/(dates[1]-dates[0])));diff+=cfg.width[0]-width;cfg.width[0]=width;dates[0]=new Date(gantt._min_date);}
var last=dates.length-1;var lastDate=dates[last];var outDate=gantt.date.add(lastDate,cfg.step,cfg.unit);if(+outDate>+gantt._max_date&&last>0){var width=cfg.width[last]-Math.floor(cfg.width[last]*((outDate-gantt._max_date)/(outDate-lastDate)));diff+=cfg.width[last]-width;cfg.width[last]=width;}
if(diff){var full=this.getSum(cfg.width);var shared=0;for(var i=0;i<cfg.width.length;i++){var share=Math.floor(diff*(cfg.width[i]/full));cfg.width[i]+=share;shared+=share;}
this.adjustSize(diff-shared,cfg.width);}}};gantt._tasks_dnd={drag:null,_events:{before_start:{},before_finish:{},after_finish:{}},_handlers:{},init:function(){this.clear_drag_state();var drag=gantt.config.drag_mode;this.set_actions();var evs={"before_start":"onBeforeTaskDrag","before_finish":"onBeforeTaskChanged","after_finish":"onAfterTaskDrag"};for(var stage in this._events){for(var mode in drag){this._events[stage][mode]=evs[stage];}}
this._handlers[drag.move]=this._move;this._handlers[drag.resize]=this._resize;this._handlers[drag.progress]=this._resize_progress;},set_actions:function(){var data=gantt.$task_data;dhtmlxEvent(data,"mousemove",dhtmlx.bind(function(e){this.on_mouse_move(e||event);},this));dhtmlxEvent(data,"mousedown",dhtmlx.bind(function(e){this.on_mouse_down(e||event);},this));dhtmlxEvent(data,"mouseup",dhtmlx.bind(function(e){this.on_mouse_up(e||event);},this));},clear_drag_state:function(){this.drag={id:null,mode:null,pos:null,start_x:null,start_y:null,obj:null,left:null};},_resize:function(ev,shift,drag){var cfg=gantt.config;var coords_x=this._drag_task_coords(ev,drag);if(drag.left){ev.start_date=gantt.dateFromPos(coords_x.start+shift);if(!ev.start_date){ev.start_date=new Date(gantt.getState().min_date);}}else{ev.end_date=gantt.dateFromPos(coords_x.end+shift);if(!ev.end_date){ev.end_date=new Date(gantt.getState().max_date);}}
if(ev.end_date-ev.start_date<cfg.min_duration){if(drag.left)
ev.start_date=gantt.calculateEndDate(ev.end_date,-1);else
ev.end_date=gantt.calculateEndDate(ev.start_date,1);}
gantt._init_task_timing(ev);},_resize_progress:function(ev,shift,drag){var coords_x=this._drag_task_coords(ev,drag);var diff=Math.max(0,drag.pos.x-coords_x.start);ev.progress=Math.min(1,diff/(coords_x.end-coords_x.start));},_move:function(ev,shift,drag){var coords_x=this._drag_task_coords(ev,drag);var new_start=gantt.dateFromPos(coords_x.start+shift),new_end=gantt.dateFromPos(coords_x.end+shift);if(!new_start){ev.start_date=new Date(gantt.getState().min_date);ev.end_date=gantt.dateFromPos(gantt.posFromDate(ev.start_date)+(coords_x.end-coords_x.start));}else if(!new_end){ev.end_date=new Date(gantt.getState().max_date);ev.start_date=gantt.dateFromPos(gantt.posFromDate(ev.end_date)-(coords_x.end-coords_x.start));}else{ev.start_date=new_start;ev.end_date=new_end;}},_drag_task_coords:function(t,drag){var start=drag.obj_s_x=drag.obj_s_x||gantt.posFromDate(t.start_date);var end=drag.obj_e_x=drag.obj_e_x||gantt.posFromDate(t.end_date);return{start:start,end:end};},on_mouse_move:function(e){if(this.drag.start_drag)
this._start_dnd(e);var drag=this.drag;if(drag.mode){if(!gantt._checkTimeout(this,40))
return;this._update_on_move(e);}},_update_on_move:function(e){var drag=this.drag;if(drag.mode){var pos=gantt._get_mouse_pos(e);if(drag.pos&&drag.pos.x==pos.x)
return;drag.pos=pos;var curr_date=gantt.dateFromPos(pos.x);if(!curr_date||isNaN(curr_date.getTime()))
return;var shift=pos.x-drag.start_x;var ev=gantt.getTask(drag.id);if(this._handlers[drag.mode]){var original=dhtmlx.mixin({},ev);var copy=dhtmlx.mixin({},ev);this._handlers[drag.mode].apply(this,[copy,shift,drag]);dhtmlx.mixin(ev,copy,true);gantt._update_parents(drag.id,true);gantt.callEvent("onTaskDrag",[ev.id,drag.mode,copy,original,e]);dhtmlx.mixin(ev,copy,true);gantt._update_parents(drag.id);gantt.refreshTask(drag.id);}}},on_mouse_down:function(e,src){if(e.button==2)
return;var id=gantt.locate(e);var task=null;if(gantt.isTaskExists(id)){task=gantt.getTask(id);}
if(gantt._is_readonly(task)||this.drag.mode)return;this.clear_drag_state();src=src||(e.target||e.srcElement);var className=gantt._getClassName(src);if(!className||!this._get_drag_mode(className)){if(src.parentNode)
return this.on_mouse_down(e,src.parentNode);else
return;}
var drag=this._get_drag_mode(className);if(!drag){if(gantt.checkEvent("onMouseDown")&&gantt.callEvent("onMouseDown",[className.split(" ")[0]])){if(src.parentNode)
return this.on_mouse_down(e,src.parentNode);}}else{if(drag.mode&&drag.mode!=gantt.config.drag_mode.ignore&&gantt.config["drag_"+drag.mode]){id=gantt.locate(src);task=dhtmlx.copy(gantt.getTask(id)||{});if(gantt._is_readonly(task)){this.clear_drag_state();return false;}
if(gantt._is_flex_task(task)&&drag.mode!=gantt.config.drag_mode.progress){this.clear_drag_state();return;}
drag.id=id;var pos=gantt._get_mouse_pos(e);drag.start_x=pos.x;drag.start_y=pos.y;drag.obj=task;this.drag.start_drag=drag;}else
this.clear_drag_state();}},_fix_dnd_scale_time:function(task,drag){var unit=gantt._tasks.unit,step=gantt._tasks.step;if(!gantt.config.round_dnd_dates){unit='minute';step=gantt.config.time_step;}
function fixStart(task){if(!gantt.isWorkTime(task.start_date))
task.start_date=gantt.calculateEndDate(task.start_date,-1,gantt.config.duration_unit);}
function fixEnd(task){if(!gantt.isWorkTime(new Date(task.end_date-1)))
task.end_date=gantt.calculateEndDate(task.end_date,1,gantt.config.duration_unit);}
if(drag.mode==gantt.config.drag_mode.resize){if(drag.left){task.start_date=gantt.roundDate({date:task.start_date,unit:unit,step:step});fixStart(task);}else{task.end_date=gantt.roundDate({date:task.end_date,unit:unit,step:step});fixEnd(task);}}else if(drag.mode==gantt.config.drag_mode.move){task.start_date=gantt.roundDate({date:task.start_date,unit:unit,step:step});fixStart(task);task.end_date=gantt.calculateEndDate(task.start_date,task.duration,gantt.config.duration_unit);}},_fix_working_times:function(task,drag){var drag=drag||{mode:gantt.config.drag_mode.move};if(gantt.config.work_time&&gantt.config.correct_work_time){if(drag.mode==gantt.config.drag_mode.resize){if(drag.left){task.start_date=gantt.getClosestWorkTime({date:task.start_date,dir:'future'});}else{task.end_date=gantt.getClosestWorkTime({date:task.end_date,dir:'past'});}}else if(drag.mode==gantt.config.drag_mode.move){gantt.correctTaskWorkTime(task);}}},on_mouse_up:function(e){var drag=this.drag;if(drag.mode&&drag.id){var ev=gantt.getTask(drag.id);if(gantt.config.work_time&&gantt.config.correct_work_time){this._fix_working_times(ev,drag);}
this._fix_dnd_scale_time(ev,drag);gantt._init_task_timing(ev);if(!this._fireEvent("before_finish",drag.mode,[drag.id,drag.mode,dhtmlx.copy(drag.obj),e])){drag.obj._dhx_changed=false;dhtmlx.mixin(ev,drag.obj,true);gantt.updateTask(ev.id);}else{var drag_id=drag.id;gantt._init_task_timing(ev);this._fireEvent("after_finish",drag.mode,[drag_id,drag.mode,e]);this.clear_drag_state();gantt.updateTask(ev.id);}}
this.clear_drag_state();},_get_drag_mode:function(className){var modes=gantt.config.drag_mode;var classes=(className||"").split(" ");var classname=classes[0];var drag={mode:null,left:null};switch(classname){case"gantt_task_line":case"gantt_task_content":drag.mode=modes.move;break;case"gantt_task_drag":drag.mode=modes.resize;if(classes[1]&&classes[1].indexOf("left",classes[1].length-"left".length)!==-1){drag.left=true;}else{drag.left=false;}
break;case"gantt_task_progress_drag":drag.mode=modes.progress;break;case"gantt_link_control":case"gantt_link_point":drag.mode=modes.ignore;break;default:drag=null;break;}
return drag;},_start_dnd:function(e){var drag=this.drag=this.drag.start_drag;delete drag.start_drag;var cfg=gantt.config;var id=drag.id;if(!cfg["drag_"+drag.mode]||!gantt.callEvent("onBeforeDrag",[id,drag.mode,e])||!this._fireEvent("before_start",drag.mode,[id,drag.mode,e])){this.clear_drag_state();}else{delete drag.start_drag;}},_fireEvent:function(stage,mode,params){dhtmlx.assert(this._events[stage],"Invalid stage:{"+stage+"}");var trigger=this._events[stage][mode];dhtmlx.assert(trigger,"Unknown after drop mode:{"+mode+"}");dhtmlx.assert(params,"Invalid event arguments");if(!gantt.checkEvent(trigger))
return true;return gantt.callEvent(trigger,params);}};gantt.roundTaskDates=function(task){var drag_state=gantt._tasks_dnd.drag;if(!drag_state){drag_state={mode:gantt.config.drag_mode.move};}
gantt._tasks_dnd._fix_dnd_scale_time(task,drag_state);};gantt._render_link=function(id){var link=this.getLink(id);var renders=gantt._get_link_renderers();for(var i=0;i<renders.length;i++)
renders[i].render_item(link);};gantt._get_link_type=function(from_start,to_start){var type=null;if(from_start&&to_start){type=gantt.config.links.start_to_start;}else if(!from_start&&to_start){type=gantt.config.links.finish_to_start;}else if(!from_start&&!to_start){type=gantt.config.links.finish_to_finish;}else if(from_start&&!to_start){type=gantt.config.links.start_to_finish;}
return type;};gantt.isLinkAllowed=function(from,to,from_start,to_start){var link=null;if(typeof(from)=="object"){link=from;}else{link={source:from,target:to,type:this._get_link_type(from_start,to_start)};}
if(!link)return false;if(!(link.source&&link.target&&link.type))return false;if(link.source==link.target)return false;var res=true;if(this.checkEvent("onLinkValidation"))
res=this.callEvent("onLinkValidation",[link]);return res;};gantt._render_link_element=function(link){var dots=this._path_builder.get_points(link);var drawer=gantt._drawer;var lines=drawer.get_lines(dots);var div=document.createElement("div");var css="gantt_task_link";if(link.color){css+=" gantt_link_inline_color";}
var cssTemplate=this.templates.link_class?this.templates.link_class(link):"";if(cssTemplate){css+=" "+cssTemplate;}
if(this.config.highlight_critical_path&&this.isCriticalLink){if(this.isCriticalLink(link))
css+=" gantt_critical_link";}
div.className=css;div.setAttribute(gantt.config.link_attribute,link.id);for(var i=0;i<lines.length;i++){if(i==lines.length-1){lines[i].size-=gantt.config.link_arrow_size;}
var el=drawer.render_line(lines[i],lines[i+1]);if(link.color){el.firstChild.style.backgroundColor=link.color;}
div.appendChild(el);}
var direction=lines[lines.length-1].direction;var endpoint=gantt._render_link_arrow(dots[dots.length-1],direction);if(link.color){endpoint.style.borderColor=link.color;}
div.appendChild(endpoint);return div;};gantt._render_link_arrow=function(point,direction){var div=document.createElement("div");var drawer=gantt._drawer;var top=point.y;var left=point.x;var size=gantt.config.link_arrow_size;var line_width=gantt.config.row_height;var className="gantt_link_arrow gantt_link_arrow_"+direction;switch(direction){case drawer.dirs.right:top-=(size-line_width)/2;left-=size;break;case drawer.dirs.left:top-=(size-line_width)/2;break;case drawer.dirs.up:left-=size;break;case drawer.dirs.down:top+=size*2;left-=size;break;default:break;}
div.style.cssText=["top:"+top+"px","left:"+left+'px'].join(';');div.className=className;return div;};gantt._drawer={current_pos:null,dirs:{"left":'left',"right":'right',"up":'up',"down":'down'},path:[],clear:function(){this.current_pos=null;this.path=[];},point:function(pos){this.current_pos=dhtmlx.copy(pos);},get_lines:function(dots){this.clear();this.point(dots[0]);for(var i=1;i<dots.length;i++){this.line_to(dots[i]);}
return this.get_path();},line_to:function(pos){var next=dhtmlx.copy(pos);var prev=this.current_pos;var line=this._get_line(prev,next);this.path.push(line);this.current_pos=next;},get_path:function(){return this.path;},get_wrapper_sizes:function(v){var res,wrapper_size=gantt.config.link_wrapper_width,line_size=gantt.config.link_line_width,y=v.y+(gantt.config.row_height-wrapper_size)/2;switch(v.direction){case this.dirs.left:res={top:y,height:wrapper_size,lineHeight:wrapper_size,left:v.x-v.size-wrapper_size/2,width:v.size+wrapper_size};break;case this.dirs.right:res={top:y,lineHeight:wrapper_size,height:wrapper_size,left:v.x-wrapper_size/2,width:v.size+wrapper_size};break;case this.dirs.up:res={top:y-v.size,lineHeight:v.size+wrapper_size,height:v.size+wrapper_size,left:v.x-wrapper_size/2,width:wrapper_size};break;case this.dirs.down:res={top:y,lineHeight:v.size+wrapper_size*2,height:v.size+wrapper_size*2,left:v.x-wrapper_size/2,width:wrapper_size};break;default:break;}
return res;},get_line_sizes:function(v){var res,line_size=gantt.config.link_line_width,wrapper_size=gantt.config.link_wrapper_width,size=v.size+line_size;switch(v.direction){case this.dirs.left:case this.dirs.right:res={height:line_size,width:size,marginTop:(wrapper_size-line_size)/2,marginLeft:(wrapper_size-line_size)/2};break;case this.dirs.up:case this.dirs.down:res={height:size,width:line_size,marginTop:(wrapper_size-line_size)/2,marginLeft:(wrapper_size-line_size)/2};break;default:break;}
return res;},render_line:function(v){var pos=this.get_wrapper_sizes(v);var wrapper=document.createElement("div");wrapper.style.cssText=["top:"+pos.top+"px","left:"+pos.left+"px","height:"+pos.height+"px","width:"+pos.width+"px"].join(';');wrapper.className="gantt_line_wrapper";var innerPos=this.get_line_sizes(v);var inner=document.createElement("div");inner.style.cssText=["height:"+innerPos.height+"px","width:"+innerPos.width+"px","margin-top:"+innerPos.marginTop+"px","margin-left:"+innerPos.marginLeft+"px"].join(";");inner.className="gantt_link_line_"+v.direction;wrapper.appendChild(inner);return wrapper;},_get_line:function(from,to){var direction=this.get_direction(from,to);var vect={x:from.x,y:from.y,direction:this.get_direction(from,to)};if(direction==this.dirs.left||direction==this.dirs.right){vect.size=Math.abs(from.x-to.x);}else{vect.size=Math.abs(from.y-to.y);}
return vect;},get_direction:function(from,to){var direction=0;if(to.x<from.x){direction=this.dirs.left;}else if(to.x>from.x){direction=this.dirs.right;}else if(to.y>from.y){direction=this.dirs.down;}else{direction=this.dirs.up;}
return direction;}};gantt._y_from_ind=function(index){return(index)*gantt.config.row_height;};gantt._path_builder={path:[],clear:function(){this.path=[];},current:function(){return this.path[this.path.length-1];},point:function(next){if(!next)
return this.current();this.path.push(dhtmlx.copy(next));return next;},point_to:function(direction,diff,point){if(!point)
point=dhtmlx.copy(this.point());else
point={x:point.x,y:point.y};var dir=gantt._drawer.dirs;switch(direction){case(dir.left):point.x-=diff;break;case(dir.right):point.x+=diff;break;case(dir.up):point.y-=diff;break;case(dir.down):point.y+=diff;break;default:break;}
return this.point(point);},get_points:function(link){var pt=this.get_endpoint(link);var xy=gantt.config;var dy=pt.e_y-pt.y;var dx=pt.e_x-pt.x;var dir=gantt._drawer.dirs;this.clear();this.point({x:pt.x,y:pt.y});var shiftX=2*xy.link_arrow_size;var forward=(pt.e_x>pt.x);if(link.type==gantt.config.links.start_to_start){this.point_to(dir.left,shiftX);if(forward){this.point_to(dir.down,dy);this.point_to(dir.right,dx);}else{this.point_to(dir.right,dx);this.point_to(dir.down,dy);}
this.point_to(dir.right,shiftX);}else if(link.type==gantt.config.links.finish_to_start){forward=(pt.e_x>(pt.x+2*shiftX));this.point_to(dir.right,shiftX);if(forward){dx-=shiftX;this.point_to(dir.down,dy);this.point_to(dir.right,dx);}else{dx-=2*shiftX;var sign=dy>0?1:-1;this.point_to(dir.down,sign*(xy.row_height/2));this.point_to(dir.right,dx);this.point_to(dir.down,sign*(Math.abs(dy)-(xy.row_height/2)));this.point_to(dir.right,shiftX);}}else if(link.type==gantt.config.links.finish_to_finish){this.point_to(dir.right,shiftX);if(forward){this.point_to(dir.right,dx);this.point_to(dir.down,dy);}else{this.point_to(dir.down,dy);this.point_to(dir.right,dx);}
this.point_to(dir.left,shiftX);}else if(link.type==gantt.config.links.start_to_finish){forward=(pt.e_x>(pt.x-2*shiftX));this.point_to(dir.left,shiftX);if(!forward){dx+=shiftX;this.point_to(dir.down,dy);this.point_to(dir.right,dx);}else{dx+=2*shiftX;var sign=dy>0?1:-1;this.point_to(dir.down,sign*(xy.row_height/2));this.point_to(dir.right,dx);this.point_to(dir.down,sign*(Math.abs(dy)-(xy.row_height/2)));this.point_to(dir.left,shiftX);}}
return this.path;},get_endpoint:function(link){var types=gantt.config.links;var from_start=false,to_start=false;if(link.type==types.start_to_start){from_start=to_start=true;}else if(link.type==types.finish_to_finish){from_start=to_start=false;}else if(link.type==types.finish_to_start){from_start=false;to_start=true;}else if(link.type==types.start_to_finish){from_start=true;to_start=false;}else{dhtmlx.assert(false,"Invalid link type");}
var from=gantt._get_task_visible_pos(gantt._pull[link.source],from_start);var to=gantt._get_task_visible_pos(gantt._pull[link.target],to_start);return{x:from.x,e_x:to.x,y:from.y,e_y:to.y};}};gantt._init_links_dnd=function(){var dnd=new dhtmlxDnD(this.$task_bars,{sensitivity:0,updates_per_second:60}),start_marker="task_left",end_marker="task_right",link_edge_marker="gantt_link_point",link_landing_hover_area="gantt_link_control";dnd.attachEvent("onBeforeDragStart",dhtmlx.bind(function(obj,e){var target=(e.target||e.srcElement);resetDndState();if(gantt.getState().drag_id)
return false;if(gantt._locate_css(target,link_edge_marker)){if(gantt._locate_css(target,start_marker))
gantt._link_source_task_start=true;var sid=gantt._link_source_task=this.locate(e);var t=gantt.getTask(sid);if(gantt._is_readonly(t)){resetDndState();return false;}
var shift=0;if(gantt._get_safe_type(t.type)==gantt.config.types.milestone){shift=(gantt._get_visible_milestone_width()-gantt._get_milestone_width())/2;}
this._dir_start=getLinePos(t,!!gantt._link_source_task_start,shift);return true;}else{return false;}},this));dnd.attachEvent("onAfterDragStart",dhtmlx.bind(function(obj,e){updateMarkedHtml(dnd.config.marker);},this));function getLinePos(task,to_start,shift){var pos=gantt._get_task_pos(task,!!to_start);pos.y+=gantt._get_task_height()/2;shift=shift||0;pos.x+=(to_start?-1:1)*shift;return pos;}
dnd.attachEvent("onDragMove",dhtmlx.bind(function(obj,e){var dd=dnd.config;var pos=dnd.getPosition(e);advanceMarker(dd.marker,pos);var landing=gantt._is_link_drop_area(e);var prevTarget=gantt._link_target_task;var prevLanding=gantt._link_landing;var prevToStart=gantt._link_target_task_start;var targ=gantt.locate(e),to_start=true;if(landing){to_start=!gantt._locate_css(e,end_marker);landing=!!targ;}
gantt._link_target_task=targ;gantt._link_landing=landing;gantt._link_target_task_start=to_start;if(landing){var t=gantt.getTask(targ);var node=gantt._locate_css(e,link_landing_hover_area);var shift=0;if(node){shift=Math.floor(node.offsetWidth/2);}
this._dir_end=getLinePos(t,!!gantt._link_target_task_start,shift);}else{this._dir_end=gantt._get_mouse_pos(e);}
var targetChanged=!(prevLanding==landing&&prevTarget==targ&&prevToStart==to_start);if(targetChanged){if(prevTarget)
gantt.refreshTask(prevTarget,false);if(targ)
gantt.refreshTask(targ,false);}
if(targetChanged){updateMarkedHtml(dd.marker);}
showDirectingLine(this._dir_start.x,this._dir_start.y,this._dir_end.x,this._dir_end.y);return true;},this));dnd.attachEvent("onDragEnd",dhtmlx.bind(function(){var drag=getDndState();if(drag.from&&drag.to&&drag.from!=drag.to){var type=gantt._get_link_type(drag.from_start,drag.to_start);var link={source:drag.from,target:drag.to,type:type};if(link.type&&gantt.isLinkAllowed(link))
gantt.addLink(link);}
resetDndState();if(drag.from)
gantt.refreshTask(drag.from,false);if(drag.to)
gantt.refreshTask(drag.to,false);removeDirectionLine();},this));function updateMarkedHtml(marker){var link=getDndState();var css=["gantt_link_tooltip"];if(link.from&&link.to){if(gantt.isLinkAllowed(link.from,link.to,link.from_start,link.to_start)){css.push("gantt_allowed_link");}else{css.push("gantt_invalid_link");}}
var className=gantt.templates.drag_link_class(link.from,link.from_start,link.to,link.to_start);if(className)
css.push(className);var html="<div class='"+className+"'>"+
gantt.templates.drag_link(link.from,link.from_start,link.to,link.to_start)+"</div>";marker.innerHTML=html;}
function advanceMarker(marker,pos){marker.style.left=pos.x+5+"px";marker.style.top=pos.y+5+"px";}
function getDndState(){return{from:gantt._link_source_task,to:gantt._link_target_task,from_start:gantt._link_source_task_start,to_start:gantt._link_target_task_start};}
function resetDndState(){gantt._link_source_task=gantt._link_source_task_start=gantt._link_target_task=null;gantt._link_target_task_start=true;}
function showDirectingLine(s_x,s_y,e_x,e_y){var div=getDirectionLine();var link=getDndState();var css=["gantt_link_direction"];if(gantt.templates.link_direction_class){css.push(gantt.templates.link_direction_class(link.from,link.from_start,link.to,link.to_start));}
var dist=Math.sqrt((Math.pow(e_x-s_x,2))+(Math.pow(e_y-s_y,2)));dist=Math.max(0,dist-3);if(!dist)
return;div.className=css.join(" ");var tan=(e_y-s_y)/(e_x-s_x),angle=Math.atan(tan);if(coordinateCircleQuarter(s_x,e_x,s_y,e_y)==2){angle+=Math.PI;}else if(coordinateCircleQuarter(s_x,e_x,s_y,e_y)==3){angle-=Math.PI;}
var sin=Math.sin(angle),cos=Math.cos(angle),top=Math.round(s_y),left=Math.round(s_x);var style=["-webkit-transform: rotate("+angle+"rad)","-moz-transform: rotate("+angle+"rad)","-ms-transform: rotate("+angle+"rad)","-o-transform: rotate("+angle+"rad)","transform: rotate("+angle+"rad)","width:"+Math.round(dist)+"px"];if(window.navigator.userAgent.indexOf("MSIE 8.0")!=-1){style.push("-ms-filter: \""+ieTransform(sin,cos)+"\"");var shiftLeft=Math.abs(Math.round(s_x-e_x)),shiftTop=Math.abs(Math.round(e_y-s_y));switch(coordinateCircleQuarter(s_x,e_x,s_y,e_y)){case 1:top-=shiftTop;break;case 2:left-=shiftLeft;top-=shiftTop;break;case 3:left-=shiftLeft;break;default:break;}}
style.push("top:"+top+"px");style.push("left:"+left+"px");div.style.cssText=style.join(";");}
function ieTransform(sin,cos){return"progid:DXImageTransform.Microsoft.Matrix("+"M11 = "+cos+","+"M12 = -"+sin+","+"M21 = "+sin+","+"M22 = "+cos+","+"SizingMethod = 'auto expand'"+")";}
function coordinateCircleQuarter(sX,eX,sY,eY){if(eX>=sX){if(eY<=sY){return 1;}else{return 4;}}else{if(eY<=sY){return 2;}else{return 3;}}}
function getDirectionLine(){if(!dnd._direction){dnd._direction=document.createElement("div");gantt.$task_links.appendChild(dnd._direction);}
return dnd._direction;}
function removeDirectionLine(){if(dnd._direction){if(dnd._direction.parentNode)
dnd._direction.parentNode.removeChild(dnd._direction);dnd._direction=null;}}
gantt._is_link_drop_area=function(e){return!!gantt._locate_css(e,link_landing_hover_area);};};gantt._get_link_state=function(){return{link_landing_area:this._link_landing,link_target_id:this._link_target_task,link_target_start:this._link_target_task_start,link_source_id:this._link_source_task,link_source_start:this._link_source_task_start};};gantt._init_tasks=function(){this._tasks={col_width:this.config.columnWidth,width:[],full_width:0,trace_x:[],rendered:{}};this._click.gantt_task_link=dhtmlx.bind(function(e,trg){var id=this.locate(e,gantt.config.link_attribute);if(id){this.callEvent("onLinkClick",[id,e]);}},this);this._click.gantt_scale_cell=dhtmlx.bind(function(e,trg){var pos=gantt._get_mouse_pos(e);var date=gantt.dateFromPos(pos.x);var coll=Math.floor(gantt._day_index_by_date(date));var coll_date=gantt._tasks.trace_x[coll];gantt.callEvent("onScaleClick",[e,coll_date]);},this);this._dbl_click.gantt_task_link=dhtmlx.bind(function(e,id,trg){var id=this.locate(e,gantt.config.link_attribute);this._delete_link_handler(id,e);},this);this._dbl_click.gantt_link_point=dhtmlx.bind(function(e,id,trg){var id=this.locate(e),task=this.getTask(id);var link=null;if(trg.parentNode&&gantt._getClassName(trg.parentNode)){if(gantt._getClassName(trg.parentNode).indexOf("_left")>-1){link=task.$target[0];}else{link=task.$source[0];}}
if(link)
this._delete_link_handler(link,e);return false;},this);this._tasks_dnd.init();this._init_links_dnd();this._link_layers.clear();var links_layer=this.addLinkLayer({renderer:this._render_link_element,container:this.$task_links,filter:gantt._create_filter(['_filter_link','_is_chart_visible'])});this._linkRenderer=this._link_layers.getRenderer(links_layer);this._task_layers.clear();var bar_layer=this.addTaskLayer({renderer:this._render_task_element,container:this.$task_bars,filter:gantt._create_filter(['_filter_task','_is_chart_visible'])});this._taskRenderer=this._task_layers.getRenderer(bar_layer);this.addTaskLayer({renderer:this._render_grid_item,container:this.$grid_data,filter:gantt._create_filter(['_filter_task','_is_grid_visible'])});this.addTaskLayer({renderer:this._render_bg_line,container:this.$task_bg,filter:gantt._create_filter(['_filter_task','_is_chart_visible','_is_std_background'])});function refreshId(renders,oldId,newId,item){for(var i=0;i<renders.length;i++){renders[i].change_id(oldId,newId);renders[i].render_item(item);}}
if(this._onTaskIdChange)
this.detachEvent(this._onTaskIdChange);this._onTaskIdChange=this.attachEvent("onTaskIdChange",function(oldId,newId){var render=this._get_task_renderers();refreshId(render,oldId,newId,this.getTask(newId));});if(this._onLinkIdChange)
this.detachEvent(this._onLinkIdChange);this._onLinkIdChange=this.attachEvent("onLinkIdChange",function(oldId,newId){var render=this._get_link_renderers();refreshId(render,oldId,newId,this.getLink(newId));});};gantt._create_filter=function(filter_methods){if(!(filter_methods instanceof Array)){filter_methods=Array.prototype.slice.call(arguments,0);}
return function(obj){var res=true;for(var i=0,len=filter_methods.length;i<len;i++){var filter_method=filter_methods[i];if(gantt[filter_method]){res=res&&(gantt[filter_method].apply(gantt,[obj.id,obj])!==false);}}
return res;};};gantt._is_chart_visible=function(){return!!this.config.show_chart;};gantt._filter_task=function(id,task){var min=null,max=null;if(this.config.start_date&&this.config.end_date){min=this.config.start_date.valueOf();max=this.config.end_date.valueOf();if(+task.start_date>max||+task.end_date<+min)
return false;}
return true;};gantt._filter_link=function(id,link){if(!this.config.show_links){return false;}
if(!(gantt.isTaskVisible(link.source)&&gantt.isTaskVisible(link.target))||gantt._isAllowedUnscheduledTask(gantt.getTask(link.source))||gantt._isAllowedUnscheduledTask(gantt.getTask(link.target)))
return false;return this.callEvent("onBeforeLinkDisplay",[id,link]);};gantt._is_std_background=function(){return!this.config.static_background;};gantt._delete_link_handler=function(id,e){if(id&&this.callEvent("onLinkDblClick",[id,e])){var link=gantt.getLink(id);if(gantt._is_readonly(link))return;var title="";var question=gantt.locale.labels.link+" "+this.templates.link_description(this.getLink(id))+" "+gantt.locale.labels.confirm_link_deleting;window.setTimeout(function(){gantt._dhtmlx_confirm(question,title,function(){gantt.deleteLink(id);});},(gantt.config.touch?300:1));}};gantt.getTaskNode=function(id){return this._taskRenderer.rendered[id];};gantt.getLinkNode=function(id){return this._linkRenderer.rendered[id];};gantt._get_tasks_data=function(){var rows=[];for(var i=0;i<this._order.length;i++){var item=this._pull[this._order[i]];item.$index=i;this.resetProjectDates(item);rows.push(item);}
return rows;};gantt._get_links_data=function(){var links=[];for(var i in this._lpull)
links.push(this._lpull[i]);return links;};gantt._render_data=function(){this.callEvent("onBeforeDataRender",[]);if(!this._is_render_active())
return;this._sync_order();this._update_layout_sizes();if(this.config.static_background)
this._render_bg_canvas();var data=this._get_tasks_data();var renderers=this._get_task_renderers();for(var i=0;i<renderers.length;i++){renderers[i].render_items(data);}
var links=gantt._get_links_data();renderers=this._get_link_renderers();for(var i=0;i<renderers.length;i++)
renderers[i].render_items(links);this.callEvent("onDataRender",[]);};gantt._update_layout_sizes=function(){var cfg=this._tasks;cfg.bar_height=this._get_task_height();this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+'px';this.$task_bg.style.height="";this.$task_bg.style.backgroundImage="";var data_els=this.$task_data.childNodes;for(var i=0,len=data_els.length;i<len;i++){var el=data_els[i];if(this._is_layer(el)&&el.style)
el.style.width=cfg.full_width+"px";}
if(this._is_grid_visible()){var columns=this.getGridColumns();var width=0;for(var i=0;i<columns.length;i++)
width+=columns[i].width;this.$grid_data.style.width=Math.max(width-1,0)+"px";}};gantt._scale_range_unit=function(){var unit=this.config.scale_unit;if(this.config.scale_offset_minimal){var scales=this._get_scales();unit=scales[scales.length-1].unit;}
return unit;};gantt._init_tasks_range=function(){var unit=this._scale_range_unit();if(this.config.start_date&&this.config.end_date){this._min_date=this.date[unit+"_start"](new Date(this.config.start_date));this._max_date=this.date[unit+"_start"](new Date(this.config.end_date));return;}
this._get_tasks_data();var range=this.getSubtaskDates();this._min_date=range.start_date;this._max_date=range.end_date;if(!(this._max_date&&this._max_date)){this._min_date=new Date();this._max_date=new Date(this._min_date);}
this._min_date=this.date[unit+"_start"](this._min_date);this._min_date=this.calculateEndDate(this.date[unit+"_start"](this._min_date),-1,unit);this._max_date=this.date[unit+"_start"](this._max_date);this._max_date=this.calculateEndDate(this._max_date,2,unit);};gantt._prepare_scale_html=function(config){var cells=[];var date=null,content=null,css=null;if(config.template||config.date){content=config.template||this.date.date_to_str(config.date);}
css=config.css||function(){};if(!config.css&&this.config.inherit_scale_class){css=gantt.templates.scale_cell_class;}
for(var i=0;i<config.count;i++){date=new Date(config.trace_x[i]);var value=content.call(this,date),width=config.width[i],style="",template="",cssclass="";if(width){style="width:"+(width)+"px;";cssclass="gantt_scale_cell"+(i==config.count-1?" gantt_last_cell":"");template=css.call(this,date);if(template)cssclass+=" "+template;var cell="<div class='"+cssclass+"' style='"+style+"'>"+value+"</div>";cells.push(cell);}else{}}
return cells.join("");};gantt._get_scales=function(){var helpers=this._scale_helpers;var scales=[helpers.primaryScale()].concat(this.config.subscales);helpers.sortScales(scales);return scales;};gantt._render_tasks_scales=function(){this._init_tasks_range();this._scroll_resize();this._set_sizes();var scales_html="",outer_width=0,data_width=0,scale_height=0;if(this._is_chart_visible()){var helpers=this._scale_helpers;var scales=this._get_scales();scale_height=(this.config.scale_height-1);var resize=this._get_resize_options();var avail_width=resize.x?Math.max(this.config.autosize_min_width,0):this.$task.offsetWidth;var cfgs=helpers.prepareConfigs(scales,this.config.min_column_width,avail_width,scale_height);var cfg=this._tasks=cfgs[cfgs.length-1];var html=[];var css=this.templates.scale_row_class;for(var i=0;i<cfgs.length;i++){var cssClass="gantt_scale_line";var tplClass=css(cfgs[i]);if(tplClass){cssClass+=" "+tplClass;}
html.push("<div class=\""+cssClass+"\" style=\"height:"+(cfgs[i].height)+"px;line-height:"+(cfgs[i].height)+"px\">"+this._prepare_scale_html(cfgs[i])+"</div>");}
scales_html=html.join("");outer_width=cfg.full_width+this.$scroll_ver.offsetWidth+"px";data_width=cfg.full_width+"px";scale_height+="px";}
if(this._is_chart_visible()){this.$task.style.display="";}else{this.$task.style.display="none";}
this.$task_scale.style.height=scale_height;this.$task_data.style.width=this.$task_scale.style.width=outer_width;this.$task_scale.innerHTML=scales_html;};gantt._render_bg_line=function(item){var cfg=gantt._tasks;var count=cfg.count;var row=document.createElement("div");if(gantt.config.show_task_cells){for(var j=0;j<count;j++){var width=cfg.width[j],cssclass="";if(width>0){var cell=document.createElement("div");cell.style.width=(width)+"px";cssclass="gantt_task_cell"+(j==count-1?" gantt_last_cell":"");cssTemplate=this.templates.task_cell_class(item,cfg.trace_x[j]);if(cssTemplate)
cssclass+=" "+cssTemplate;cell.className=cssclass;row.appendChild(cell);}}}
var odd=item.$index%2!==0;var cssTemplate=gantt.templates.task_row_class(item.start_date,item.end_date,item);var css="gantt_task_row"+(odd?" odd":"")+(cssTemplate?' '+cssTemplate:'');if(this.getState().selected_task==item.id){css+=" gantt_selected";}
row.className=css;row.style.height=(gantt.config.row_height)+"px";row.setAttribute(this.config.task_attribute,item.id);return row;};gantt._render_bg_canvas=function(){};gantt._adjust_scales=function(){if(this.config.fit_tasks){var old_min=+this._min_date,old_max=+this._max_date;this._init_tasks_range();if(+this._min_date!=old_min||+this._max_date!=old_max){this.render();this.callEvent("onScaleAdjusted",[]);return true;}}
return false;};gantt.refreshTask=function(taskId,refresh_links){if(!this._is_render_active())
return;var renders=this._get_task_renderers();var task=this.getTask(taskId);if(task&&this.isTaskVisible(taskId)){for(var i=0;i<renders.length;i++)
renders[i].render_item(task);if(refresh_links!==undefined&&!refresh_links)
return;for(var i=0;i<task.$source.length;i++){gantt.refreshLink(task.$source[i]);}
for(var i=0;i<task.$target.length;i++){gantt.refreshLink(task.$target[i]);}}else{this._render_data();}};gantt.refreshLink=function(linkId){if(!this._is_render_active())
return;if(this.isLinkExists(linkId)){this._render_link(linkId);}else{var renders=this._get_link_renderers();for(var i=0;i<renders.length;i++)
renders[i].remove_item(linkId);}};gantt._combine_item_class=function(basic,template,itemId){var css=[basic];if(template)
css.push(template);var state=gantt.getState();var task=this.getTask(itemId);if(this._get_safe_type(task.type)==this.config.types.milestone){css.push("gantt_milestone");}
if(this._get_safe_type(task.type)==this.config.types.project){css.push("gantt_project");}
if(this._is_flex_task(task))
css.push("gantt_dependent_task");if(this.config.select_task&&itemId==state.selected_task)
css.push("gantt_selected");if(itemId==state.drag_id){css.push("gantt_drag_"+state.drag_mode);if(state.touch_drag){css.push("gantt_touch_"+state.drag_mode);}}
var links=gantt._get_link_state();if(links.link_source_id==itemId)
css.push("gantt_link_source");if(links.link_target_id==itemId)
css.push("gantt_link_target");if(this.config.highlight_critical_path&&this.isCriticalTask){if(this.isCriticalTask(task))
css.push("gantt_critical_task");}
if(links.link_landing_area&&(links.link_target_id&&links.link_source_id)&&(links.link_target_id!=links.link_source_id)){var from_id=links.link_source_id;var from_start=links.link_source_start;var to_start=links.link_target_start;var allowDrag=gantt.isLinkAllowed(from_id,itemId,from_start,to_start);var dragClass="";if(allowDrag){if(to_start)
dragClass="link_start_allow";else
dragClass="link_finish_allow";}else{if(to_start)
dragClass="link_start_deny";else
dragClass="link_finish_deny";}
css.push(dragClass);}
return css.join(" ");};gantt._render_pair=function(parent,css,task,content){var state=gantt.getState();if(+task.end_date<=+state.max_date)
parent.appendChild(content(css+" task_right"));if(+task.start_date>=+state.min_date)
parent.appendChild(content(css+" task_left"));};gantt._get_task_height=function(){var height=this.config.task_height;if(height=="full")
height=this.config.row_height-5;height=Math.min(height,this.config.row_height);return Math.max(height,0);};gantt._get_milestone_width=function(){return this._get_task_height();};gantt._get_visible_milestone_width=function(){var origWidth=gantt._get_task_height();return Math.sqrt(2*origWidth*origWidth);};gantt.getTaskPosition=function(task,start_date,end_date){var x=this.posFromDate(start_date||task.start_date);var x2=this.posFromDate(end_date||task.end_date);x2=Math.max(x,x2);var y=this.getTaskTop(task.id);var height=this.config.task_height;return{left:x,top:y,height:height,width:Math.max((x2-x),0)};};gantt._get_task_width=function(task,start,end){return Math.round(this._get_task_pos(task,false).x-this._get_task_pos(task,true).x);};gantt._is_readonly=function(item){if(item&&item[this.config.editable_property]){return false;}else{return(item&&item[this.config.readonly_property])||this.config.readonly;}};gantt._task_default_render=function(task){if(this._isAllowedUnscheduledTask(task))
return;var pos=this._get_task_pos(task);var cfg=this.config;var height=this._get_task_height();var padd=Math.floor((this.config.row_height-height)/2);if(this._get_safe_type(task.type)==cfg.types.milestone&&cfg.link_line_width>1){padd+=1;}
var div=document.createElement("div");var width=gantt._get_task_width(task);var type=this._get_safe_type(task.type);div.setAttribute(this.config.task_attribute,task.id);if(cfg.show_progress&&type!=this.config.types.milestone){this._render_task_progress(task,div,width);}
var content=gantt._render_task_content(task,width);if(task.textColor){content.style.color=task.textColor;}
div.appendChild(content);var css=this._combine_item_class("gantt_task_line",this.templates.task_class(task.start_date,task.end_date,task),task.id);if(task.color||task.progressColor||task.textColor){css+=" gantt_task_inline_color";}
div.className=css;var styles=["left:"+pos.x+"px","top:"+(padd+pos.y)+'px',"height:"+height+'px',"line-height:"+height+'px',"width:"+width+'px'];if(task.color){styles.push("background-color:"+task.color);}
if(task.textColor){styles.push("color:"+task.textColor);}
div.style.cssText=styles.join(";");var side=this._render_leftside_content(task);if(side)div.appendChild(side);side=this._render_rightside_content(task);if(side)div.appendChild(side);if(!this._is_readonly(task)){if(cfg.drag_resize&&!this._is_flex_task(task)&&type!=this.config.types.milestone){gantt._render_pair(div,"gantt_task_drag",task,function(css){var el=document.createElement("div");el.className=css;return el;});}
if(cfg.drag_links&&this.config.show_links){gantt._render_pair(div,"gantt_link_control",task,function(css){var outer=document.createElement("div");outer.className=css;outer.style.cssText=["height:"+height+'px',"line-height:"+height+'px'].join(";");var inner=document.createElement("div");inner.className="gantt_link_point";outer.appendChild(inner);return outer;});}}
return div;};gantt._render_task_element=function(task){var painters=this.config.type_renderers;var renderer=painters[this._get_safe_type(task.type)],defaultRenderer=this._task_default_render;if(!renderer){renderer=defaultRenderer;}
return renderer.call(this,task,dhtmlx.bind(defaultRenderer,this));};gantt._render_side_content=function(task,template,cssClass){if(!template)return null;var text=template(task.start_date,task.end_date,task);if(!text)return null;var content=document.createElement("div");content.className="gantt_side_content "+cssClass;content.innerHTML=text;return content;};gantt._render_leftside_content=function(task){var css="gantt_left "+gantt._get_link_crossing_css(true,task);return gantt._render_side_content(task,this.templates.leftside_text,css);};gantt._render_rightside_content=function(task){var css="gantt_right "+gantt._get_link_crossing_css(false,task);return gantt._render_side_content(task,this.templates.rightside_text,css);};gantt._get_conditions=function(leftside){if(leftside){return{$source:[gantt.config.links.start_to_start],$target:[gantt.config.links.start_to_start,gantt.config.links.finish_to_start]};}else{return{$source:[gantt.config.links.finish_to_start,gantt.config.links.finish_to_finish],$target:[gantt.config.links.finish_to_finish]};}};gantt._get_link_crossing_css=function(left,task){var cond=gantt._get_conditions(left);for(var i in cond){var links=task[i];for(var ln=0;ln<links.length;ln++){var link=gantt.getLink(links[ln]);for(var tp=0;tp<cond[i].length;tp++){if(link.type==cond[i][tp]){return"gantt_link_crossing";}}}}
return"";};gantt._render_task_content=function(task,width){var content=document.createElement("div");if(this._get_safe_type(task.type)!=this.config.types.milestone)
content.innerHTML=this.templates.task_text(task.start_date,task.end_date,task);content.className="gantt_task_content";return content;};gantt._render_task_progress=function(task,element,maxWidth){var done=task.progress*1||0;maxWidth=Math.max(maxWidth-2,0);var pr=document.createElement("div");var width=Math.round(maxWidth*done);width=Math.min(maxWidth,width);if(task.progressColor){pr.style.backgroundColor=task.progressColor;pr.style.opacity=1;}
pr.style.width=width+'px';pr.className="gantt_task_progress";pr.innerHTML=this.templates.progress_text(task.start_date,task.end_date,task);element.appendChild(pr);if(this.config.drag_progress&&!gantt._is_readonly(task)){var drag=document.createElement("div");drag.style.left=width+'px';drag.className="gantt_task_progress_drag";pr.appendChild(drag);element.appendChild(drag);}};gantt._get_line=function(step){var steps={"second":1,"minute":60,"hour":60*60,"day":60*60*24,"week":60*60*24*7,"month":60*60*24*30,"year":60*60*24*365};return steps[step]||0;};gantt.dateFromPos=function(x){var scale=this._tasks;if(x<0||x>scale.full_width||!scale.full_width){return null;}
var ind=this._findBinary(this._tasks.left,x);var summ=this._tasks.left[ind];var col_width=scale.width[ind]||scale.col_width;var part=0;if(col_width)
part=(x-summ)/col_width;var unit=0;if(part){unit=gantt._get_coll_duration(scale,scale.trace_x[ind]);}
var date=new Date(scale.trace_x[ind].valueOf()+Math.round(part*unit));return date;};gantt.posFromDate=function(date){var ind=gantt._day_index_by_date(date);dhtmlx.assert(ind>=0,"Invalid day index");var wholeCells=Math.floor(ind);var partCell=ind%1;var pos=gantt._tasks.left[Math.min(wholeCells,gantt._tasks.width.length-1)];if(wholeCells==gantt._tasks.width.length)
pos+=gantt._tasks.width[gantt._tasks.width.length-1];if(partCell){if(wholeCells<gantt._tasks.width.length){pos+=gantt._tasks.width[wholeCells]*(partCell%1);}else{pos+=1;}}
return pos;};gantt._day_index_by_date=function(date){var pos=new Date(date).valueOf();var days=gantt._tasks.trace_x,ignores=gantt._tasks.ignore_x;if(pos<=this._min_date)
return 0;if(pos>=this._max_date)
return days.length;var day_ind=gantt._findBinary(days,pos);var day=+gantt._tasks.trace_x[day_ind];while(ignores[day]){day=gantt._tasks.trace_x[++day_ind];}
if(!day)return 0;return day_ind+((date-days[day_ind])/gantt._get_coll_duration(gantt._tasks,days[day_ind]));};gantt._findBinary=function(array,target){var low=0,high=array.length-1,i,item,prev;while(low<=high){i=Math.floor((low+high)/2);item=+array[i];prev=+array[i-1];if(item<target){low=i+1;continue;}
if(item>target){if(!(!isNaN(prev)&&prev<target)){high=i-1;continue;}else{return i-1;}}
return i;}
return array.length-1;};gantt._get_coll_duration=function(scale,date){return gantt.date.add(date,scale.step,scale.unit)-date;};gantt._get_x_pos=function(task,to_start){to_start=to_start!==false;var x=gantt.posFromDate(to_start?task.start_date:task.end_date);};gantt.getTaskTop=function(task_id){return this._y_from_ind(this.getGlobalTaskIndex(task_id));};gantt._get_task_coord=function(task,to_start,x_correction){to_start=to_start!==false;x_correction=x_correction||0;var isMilestone=(this._get_safe_type(task.type)==this.config.types.milestone);var date=null;if(to_start||isMilestone){date=(task.start_date||this._default_task_date(task));}else{date=(task.end_date||this.calculateEndDate(this._default_task_date(task)));}
var x=this.posFromDate(date),y=this.getTaskTop(task.id);if(isMilestone){if(to_start){x-=x_correction;}else{x+=x_correction;}}
return{x:x,y:y};};gantt._get_task_pos=function(task,to_start){to_start=to_start!==false;var mstoneCorrection=gantt._get_milestone_width()/2;return this._get_task_coord(task,to_start,mstoneCorrection);};gantt._get_task_visible_pos=function(task,to_start){to_start=to_start!==false;var mstoneCorrection=gantt._get_visible_milestone_width()/2;return this._get_task_coord(task,to_start,mstoneCorrection);};gantt._correct_shift=function(start,back){return start-=((new Date(gantt._min_date)).getTimezoneOffset()-(new Date(start)).getTimezoneOffset())*60000*(back?-1:1);};gantt._get_mouse_pos=function(ev){if(ev.pageX||ev.pageY)
var pos={x:ev.pageX,y:ev.pageY};var d=_isIE?document.documentElement:document.body;var pos={x:ev.clientX+d.scrollLeft-d.clientLeft,y:ev.clientY+d.scrollTop-d.clientTop};var box=gantt._get_position(gantt.$task_data);pos.x=pos.x-box.x+gantt.$task_data.scrollLeft;pos.y=pos.y-box.y+gantt.$task_data.scrollTop;return pos;};gantt._is_layer=function(dom_element){return(dom_element&&dom_element.hasAttribute&&dom_element.hasAttribute(this.config.layer_attribute));};gantt._task_renderer=function(id,render_one,node,filter){if(!this._task_area_pulls)
this._task_area_pulls={};if(!this._task_area_renderers)
this._task_area_renderers={};if(this._task_area_renderers[id])
return this._task_area_renderers[id];if(!render_one)
dhtmlx.assert(false,"Invalid renderer call");if(node)
node.setAttribute(this.config.layer_attribute,true);this._task_area_renderers[id]={render_item:function(item,container){var pull=gantt._task_area_pulls[id];container=container||node;if(filter){if(!filter(item)){this.remove_item(item.id);return;}}
var dom=render_one.call(gantt,item);if(!dom)return;if(pull[item.id]){this.replace_item(item.id,dom);}else{pull[item.id]=dom;container.appendChild(dom);}},clear:function(container){this.rendered=gantt._task_area_pulls[id]={};container=container||node;if(container)
container.innerHTML="";},render_items:function(items,container){container=container||node;this.clear(container);var buffer=document.createDocumentFragment();for(var i=0,vis=items.length;i<vis;i++){this.render_item(items[i],buffer);}
container.appendChild(buffer);},replace_item:function(item_id,newNode){var item=this.rendered[item_id];if(item&&item.parentNode){item.parentNode.replaceChild(newNode,item);}
this.rendered[item_id]=newNode;},remove_item:function(item_id){var item=this.rendered[item_id];if(item&&item.parentNode){item.parentNode.removeChild(item);}
delete this.rendered[item_id];},change_id:function(oldid,newid){this.rendered[newid]=this.rendered[oldid];delete this.rendered[oldid];},rendered:this._task_area_pulls[id],node:node,unload:function(){this.clear();delete gantt._task_area_renderers[id];delete gantt._task_area_pulls[id];}};return this._task_area_renderers[id];};gantt._clear_renderers=function(){for(var i in this._task_area_renderers){this._task_renderer(i).unload();}};gantt.attachEvent("onGanttReady",function(){gantt._task_layers.add();gantt._link_layers.add();});gantt._layers={prepareConfig:function(config){if(typeof config=="function"){config={renderer:config};}
var id=config.id=dhtmlx.uid();if(!config.container)
config.container=document.createElement("div");return config;},create:function(get_container,rel_root){return{tempCollection:[],renderers:{},container:get_container,getRenderers:function(){var res=[];for(var i in this.renderers){res.push(this.renderers[i]);}
return res;},getRenderer:function(id){return this.renderers[id];},add:function(layer){if(layer)
this.tempCollection.push(layer);if(!this.container())return;var container=this.container();var pending=this.tempCollection;for(var i=0;i<pending.length;i++){var layer=pending[i];var node=layer.container,id=layer.id,topmost=layer.topmost;if(!node.parentNode){if(topmost){container.appendChild(node);}else{var rel=rel_root?rel_root():container.firstChild;if(rel)
container.insertBefore(node,rel);else
container.appendChild(node);}}
this.renderers[id]=gantt._task_renderer(id,layer.renderer,node,layer.filter);this.tempCollection.splice(i,1);i--;}},remove:function(id){this.renderers[id].unload();delete this.renderers[id];},clear:function(){for(var i in this.renderers){this.renderers[i].unload();}
this.renderers={};}};}};gantt._create_filter=function(filter_methods){if(!(filter_methods instanceof Array)){filter_methods=Array.prototype.slice.call(arguments,0);}
return function(obj){var res=true;for(var i=0,len=filter_methods.length;i<len;i++){var filter_method=filter_methods[i];if(gantt[filter_method]){res=res&&(gantt[filter_method].call(gantt,obj.id,obj)!==false);}}
return res;};};gantt._add_generic_layer=function(layersManager,filters){return function(config){if(config.filter===undefined){config.filter=gantt._create_filter(filters);}
config=gantt._layers.prepareConfig(config);layersManager.add(config);return config.id;};};gantt._task_layers=gantt._layers.create(function(){return gantt.$task_data;},function(){return gantt.$task_links;});gantt._link_layers=gantt._layers.create(function(){return gantt.$task_data;});gantt.addTaskLayer=gantt._add_generic_layer(gantt._task_layers,['_filter_task','_is_chart_visible']);gantt.removeTaskLayer=function(id){gantt._task_layers.remove(id);};gantt.addLinkLayer=gantt._add_generic_layer(gantt._link_layers,['_filter_link','_is_chart_visible']);gantt.removeLinkLayer=function(id){gantt._link_layers.remove(id);};gantt._get_task_renderers=function(){return this._task_layers.getRenderers();};gantt._get_link_renderers=function(){return this._link_layers.getRenderers();};gantt._pull={};gantt._branches={};gantt._order=[];gantt._lpull={};gantt._order_full=[];gantt.load=function(url,type,callback){this._load_url=url;dhtmlx.assert(arguments.length,"Invalid load arguments");this.callEvent("onLoadStart",[]);var tp='json',cl=null;if(arguments.length>=3){tp=type;cl=callback;}else{if(typeof arguments[1]=="string")
tp=arguments[1];else if(typeof arguments[1]=="function")
cl=arguments[1];}
this._load_type=tp;dhx4.ajax.get(url,dhtmlx.bind(function(l){this.on_load(l,tp);this.callEvent("onLoadEnd",[]);if(typeof cl=="function")
cl.call(this);},this));};gantt.parse=function(data,type){this.on_load({xmlDoc:{responseText:data}},type);};gantt.serialize=function(type){type=type||"json";return this[type].serialize();};gantt.on_load=function(resp,type){this.callEvent("onBeforeParse",[]);if(!type)
type="json";dhtmlx.assert(this[type],"Invalid data type:'"+type+"'");var raw=resp.xmlDoc.responseText;var data=this[type].parse(raw,resp);this._process_loading(data);};gantt._process_loading=function(data){if(data.collections)
this._load_collections(data.collections);var tasks=data.data;var task;for(var i=0;i<tasks.length;i++){task=tasks[i];this._init_task(task);if(!this.callEvent("onTaskLoading",[task]))continue;this._order_full.push(task.id);this._pull[task.id]=task;}
for(var i in this._pull){task=this._pull[i];this.setParent(task,this.getParent(task)||this.config.root_id);}
for(var i=0;i<this._order_full.length;i++){task=this._pull[this._order_full[i]];this._add_branch(task);task.$level=this.calculateTaskLevel(task);}
this._sync_order();this._init_links(data.links||(data.collections?data.collections.links:[]));this.callEvent("onParse",[]);this.render();if(this.config.initial_scroll){var id=(this._order[0]||this.config.root_id);if(id)
this.showTask(id);}};gantt._init_links=function(links){if(links)
for(var i=0;i<links.length;i++){if(links[i]){var link=this._init_link(links[i]);this._lpull[link.id]=link;}}
this._sync_links();};gantt._load_collections=function(collections){var collections_loaded=false;for(var key in collections){if(collections.hasOwnProperty(key)){collections_loaded=true;var collection=collections[key];var arr=this.serverList[key];if(!arr)continue;arr.splice(0,arr.length);for(var j=0;j<collection.length;j++){var option=collection[j];var obj=dhtmlx.copy(option);obj.key=obj.value;for(var option_key in option){if(option.hasOwnProperty(option_key)){if(option_key=="value"||option_key=="label")
continue;obj[option_key]=option[option_key];}}
arr.push(obj);}}}
if(collections_loaded)
this.callEvent("onOptionsLoad",[]);};gantt._sync_order=function(silent){this._order=[];this._sync_order_item({parent:this.config.root_id,$open:true,$ignore:true,id:this.config.root_id});if(!silent){this._scroll_resize();this._set_sizes();}};gantt.attachEvent("onBeforeTaskDisplay",function(id,task){return!task.$ignore;});gantt._sync_order_item=function(item){if(item.id&&this._filter_task(item.id,item)&&this.callEvent("onBeforeTaskDisplay",[item.id,item])){this._order.push(item.id);}
if(item.$open){var children=this.getChildren(item.id);if(children)
for(var i=0;i<children.length;i++)
this._sync_order_item(this._pull[children[i]]);}};gantt.getTaskCount=function(){return this._order_full.length;};gantt.getVisibleTaskCount=function(){return this._order.length;};gantt.getTaskIndex=function(id){var branch=this.getChildren(this.getParent(id));for(var i=0;i<branch.length;i++)
if(branch[i]==id)
return i;return-1;};gantt.getGlobalTaskIndex=function(id){dhtmlx.assert(id,"Invalid argument");var ord=this._order;for(var i=0,count=ord.length;i<count;i++)
if(ord[i]==id)return i;return-1;};gantt._get_visible_order=gantt.getGlobalTaskIndex;gantt.eachTask=function(code,parent,master){parent=parent||this.config.root_id;master=master||this;var branch=this.getChildren(parent);if(branch)
for(var i=0;i<branch.length;i++){var item=this._pull[branch[i]];code.call(master,item);if(this.hasChild(item.id))
this.eachTask(code,item.id,master);}};gantt.json={parse:function(data){dhtmlx.assert(data,"Invalid data");if(typeof data=="string"){if(window.JSON)
data=JSON.parse(data);else{gantt._temp=eval("("+data+")");data=gantt._temp||{};gantt._temp=null;}}
if(data.dhx_security)
dhtmlx.security_key=data.dhx_security;return data;},_copyLink:function(obj){var copy={};for(var key in obj)
copy[key]=obj[key];return copy;},_copyObject:function(obj){var copy={};for(var key in obj){if(key.charAt(0)=="$")
continue;copy[key]=obj[key];if(copy[key]instanceof Date){copy[key]=gantt.templates.xml_format(copy[key]);}}
return copy;},serialize:function(){var tasks=[];var links=[];gantt.eachTask(function(obj){gantt.resetProjectDates(obj);tasks.push(this._copyObject(obj));},gantt.config.root_id,this);for(var key in gantt._lpull)
links.push(this._copyLink(gantt._lpull[key]));return{data:tasks,links:links};}};gantt.xml={_xmlNodeToJSON:function(node,attrs_only){var t={};for(var i=0;i<node.attributes.length;i++)
t[node.attributes[i].name]=node.attributes[i].value;if(!attrs_only){for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];if(child.nodeType==1)
t[child.tagName]=child.firstChild?child.firstChild.nodeValue:"";}
if(!t.text)t.text=node.firstChild?node.firstChild.nodeValue:"";}
return t;},_getCollections:function(loader){var collection={};var opts=dhx4.ajax.xpath("//coll_options",loader);for(var i=0;i<opts.length;i++){var bind=opts[i].getAttribute("for");var arr=collection[bind]=[];var itms=dhx4.ajax.xpath(".//item",opts[i]);for(var j=0;j<itms.length;j++){var itm=itms[j];var attrs=itm.attributes;var obj={key:itms[j].getAttribute("value"),label:itms[j].getAttribute("label")};for(var k=0;k<attrs.length;k++){var attr=attrs[k];if(attr.nodeName=="value"||attr.nodeName=="label")
continue;obj[attr.nodeName]=attr.nodeValue;}
arr.push(obj);}}
return collection;},_getXML:function(text,loader,toptag){toptag=toptag||"data";if(!loader.getXMLTopNode){loader=dhx4.ajax.parse(loader);}
var xml=dhx4.ajax.xmltop(toptag,loader.xmlDoc);if(xml.tagName!=toptag)throw"Invalid XML data";var skey=xml.getAttribute("dhx_security");if(skey)
dhtmlx.security_key=skey;return xml;},parse:function(text,loader){loader=this._getXML(text,loader);var data={};var evs=data.data=[];var xml=dhx4.ajax.xpath("//task",loader);for(var i=0;i<xml.length;i++)
evs[i]=this._xmlNodeToJSON(xml[i]);data.collections=this._getCollections(loader);return data;},_copyLink:function(obj){return"<item id='"+obj.id+"' source='"+obj.source+"' target='"+obj.target+"' type='"+obj.type+"' />";},_copyObject:function(obj){return"<task id='"+obj.id+"' parent='"+(obj.parent||"")+"' start_date='"+obj.start_date+"' duration='"+obj.duration+"' open='"+(!!obj.open)+"' progress='"+obj.progress+"' end_date='"+obj.end_date+"'><![CDATA["+obj.text+"]]></task>";},serialize:function(){var tasks=[];var links=[];var json=gantt.json.serialize();for(var i=0,len=json.data.length;i<len;i++){tasks.push(this._copyObject(json.data[i]));}
for(var i=0,len=json.links.length;i<len;i++){links.push(this._copyLink(json.links[i]));}
return"<data>"+tasks.join("")+"<coll_options for='links'>"+links.join("")+"</coll_options></data>";}};gantt.oldxml={parse:function(text,loader){loader=gantt.xml._getXML(text,loader,"projects");var data={collections:{links:[]}};var evs=data.data=[];var xml=dhx4.ajax.xpath("//task",loader);for(var i=0;i<xml.length;i++){evs[i]=gantt.xml._xmlNodeToJSON(xml[i]);var parent=xml[i].parentNode;if(parent.tagName=="project")
evs[i].parent="project-"+parent.getAttribute("id");else
evs[i].parent=parent.parentNode.getAttribute("id");}
xml=dhx4.ajax.xpath("//project",loader);for(var i=0;i<xml.length;i++){var ev=gantt.xml._xmlNodeToJSON(xml[i],true);ev.id="project-"+ev.id;evs.push(ev);}
for(var i=0;i<evs.length;i++){var ev=evs[i];ev.start_date=ev.startdate||ev.est;ev.end_date=ev.enddate;ev.text=ev.name;ev.duration=ev.duration/8;ev.open=1;if(!ev.duration&&!ev.end_date)ev.duration=1;if(ev.predecessortasks)
data.collections.links.push({target:ev.id,source:ev.predecessortasks,type:gantt.config.links.finish_to_start});}
return data;},serialize:function(){dhtmlx.message("Serialization to 'old XML' is not implemented");}};gantt.serverList=function(name,array){if(array){this.serverList[name]=array.slice(0);}else if(!this.serverList[name]){this.serverList[name]=[];}
return this.serverList[name];};gantt._working_time_helper={units:["year","month","week","day","hour","minute"],hours:[8,17],dates:{0:false,6:false},_working_units_cache:{_cache:{},get:function(unit,date){if(!unit||!date)return-1;var cache=this._cache;var time=date.getTime();var result=-1;if(cache&&cache[unit]&&cache[unit][time]!==undefined)result=cache[unit][time];return result;},put:function(unit,date,value){if(!unit||!date)return false;var cache=this._cache;var time=date.getTime();value=!!value;if(!cache)return false;if(!cache[unit])cache[unit]={};cache[unit][time]=value;return true;},clear:function(){this._cache={};}},_get_unit_order:function(unit){for(var i=0,len=this.units.length;i<len;i++){if(this.units[i]==unit)
return i;}
dhtmlx.assert(false,"Incorrect duration unit");},_timestamp:function(settings){var timestamp=null;if((settings.day||settings.day===0)){timestamp=settings.day;}else if(settings.date){timestamp=gantt.date.date_part(new Date(settings.date)).valueOf();}
return timestamp;},set_time:function(settings){var hours=settings.hours!==undefined?settings.hours:true;var timestamp=this._timestamp(settings);if(timestamp!==null){this.dates[timestamp]=hours;}else{this.hours=hours;}
this._working_units_cache.clear();},unset_time:function(settings){if(!settings){this.hours=[];}else{var timestamp=this._timestamp(settings);if(timestamp!==null){delete this.dates[timestamp];}}
this._working_units_cache.clear();},is_working_unit:function(date,unit,order){if(!gantt.config.work_time)return true;var is_work_unit=this._working_units_cache.get(unit,date);if(is_work_unit==-1){is_work_unit=this._check_is_working_unit(date,unit,order);this._working_units_cache.put(unit,date,is_work_unit);}
return is_work_unit;},_check_is_working_unit:function(date,unit,order){if(order===undefined){order=this._get_unit_order(unit);}
if(order===undefined){return false;}
if(order){if(!this.is_working_unit(date,this.units[order-1],order-1))
return false;}
if(!this["is_work_"+unit])
return true;return this["is_work_"+unit](date);},is_work_day:function(date){var val=this.get_working_hours(date);if(val instanceof Array){return val.length>0;}
return false;},is_work_hour:function(date){var hours=this.get_working_hours(date);var hour=date.getHours();for(var i=0;i<hours.length;i+=2){if(hours[i+1]===undefined){return hours[i]==hour;}else{if(hour>=hours[i]&&hour<hours[i+1])
return true;}}
return false;},get_working_hours:function(date){var t=this._timestamp({date:date});var hours=true;if(this.dates[t]!==undefined){hours=this.dates[t];}else if(this.dates[date.getDay()]!==undefined){hours=this.dates[date.getDay()];}
if(hours===true){return this.hours;}else if(hours){return hours;}
return[];},get_work_units_between:function(from,to,unit,step){if(!unit){return false;}
var start=new Date(from),end=new Date(to),step=step||1;var units=0;while(start.valueOf()<end.valueOf()){if(this.is_working_unit(start,unit))
units++;start=gantt.date.add(start,step,unit);}
return units;},is_work_units_between:function(from,to,unit,step){if(!unit){return false;}
var start=new Date(from),end=new Date(to),step=step||1;while(start.valueOf()<end.valueOf()){if(this.is_working_unit(start,unit))
return true;start=gantt.date.add(start,step,unit);}
return false;},add_worktime:function(from,duration,unit,step){if(!unit)
return false;var start=new Date(from),added=0,step=step||1,duration=duration*1;if(!gantt.config.work_time){return gantt.date.add(start,step*duration,unit);}else{while(added<duration){var next=gantt.date.add(start,step,unit);if(this.is_working_unit(step>0?start:next,unit))
added++;start=next;}
return start;}},get_closest_worktime:function(settings){if(this.is_working_unit(settings.date,settings.unit))
return settings.date;var unit=settings.unit;var curr=gantt.date[unit+'_start'](settings.date);var future_target=new Date(curr),prev_target=new Date(curr),tick=true,maximum_loop=3000,count=0,both_directins=(settings.dir=='any'||!settings.dir);var inc=1;if(settings.dir=='past')
inc=-1;while(!this.is_working_unit(curr,unit)){if(both_directins){curr=tick?future_target:prev_target;inc=inc*(-1);}
var tzOffset=curr.getTimezoneOffset();curr=gantt.date.add(curr,inc,unit);curr=gantt._correct_dst_change(curr,tzOffset,inc,unit);if(gantt.date[unit+'_start'])
curr=gantt.date[unit+'_start'](curr);if(both_directins){if(tick){future_target=curr;}else{prev_target=curr;}}
tick=!tick;count++;if(count>maximum_loop){dhtmlx.assert(false,"Invalid working time check");return false;}}
if(curr==prev_target||settings.dir=='past'){curr=gantt.date.add(curr,1,unit);}
return curr;}};gantt.getTask=function(id){dhtmlx.assert(id,"Invalid argument for gantt.getTask");dhtmlx.assert(this._pull[id],"Task not found id="+id);return this._pull[id];};gantt.getTaskByTime=function(from,to){var p=this._pull,res=[],pos=0,taken=0;if(!(from||to)){for(var t in p)res.push(p[t]);}else{from=+from||-Infinity;to=+to||Infinity;for(var t in p){var task=p[t];if(+task.start_date<to&&+task.end_date>from)
res.push(task);}}
return res;};gantt.isTaskExists=function(id){return dhtmlx.defined(this._pull[id]);};gantt.isUnscheduledTask=function(task){return(!!task.unscheduled||!task.start_date);};gantt._isAllowedUnscheduledTask=function(task){return(task.unscheduled&&gantt.config.show_unscheduled);};gantt.isTaskVisible=function(id){if(!this._pull[id])
return false;var task=this._pull[id];if(!((+task.start_date<+this._max_date&&+task.end_date>+this._min_date)||gantt._isAllowedUnscheduledTask(task)))
return false;for(var i=0,count=this._order.length;i<count;i++)
if(this._order[i]==id)return true;return false;};gantt.updateTask=function(id,item){if(!dhtmlx.defined(item))item=this.getTask(id);if(this.callEvent("onBeforeTaskUpdate",[id,item])===false)return false;this._pull[item.id]=item;if(!this._is_parent_sync(item)){this._resync_parent(item);}
if(this._isAllowedUnscheduledTask(item)){this._init_task(item);this._sync_links();}
this._update_parents(item.id);this.refreshTask(item.id);this.callEvent("onAfterTaskUpdate",[id,item]);this._sync_order();this._adjust_scales();};gantt._add_branch=function(task,index){var pid=this.getParent(task);if(!this.hasChild(pid))
this._branches[pid]=[];var branch=this.getChildren(pid);var added_already=false;for(var i=0,length=branch.length;i<length;i++){if(branch[i]==task.id){added_already=true;break;}}
if(!added_already){if(index*1==index){branch.splice(index,0,task.id);}else{branch.push(task.id);}}
this._sync_parent(task);};gantt._move_branch=function(task,old_parent,new_parent){this.setParent(task,new_parent);this._sync_parent(task);this._replace_branch_child(old_parent,task.id);if(this.isTaskExists(new_parent)||new_parent==this.config.root_id){this._add_branch(task);}else{delete this._branches[task.id];}
task.$level=this.calculateTaskLevel(task);this._sync_order();};gantt._resync_parent=function(task){this._move_branch(task,task.$rendered_parent,this.getParent(task));};gantt._sync_parent=function(task){task.$rendered_parent=this.getParent(task);};gantt._is_parent_sync=function(task){return(task.$rendered_parent==this.getParent(task));};gantt._replace_branch_child=function(node,old_id,new_id){var branch=this.getChildren(node);if(branch){var newbranch=[];for(var i=0;i<branch.length;i++){if(branch[i]!=old_id)
newbranch.push(branch[i]);else if(new_id)
newbranch.push(new_id);}
this._branches[node]=newbranch;}
this._sync_order();};gantt.addTask=function(item,parent,index){if(!dhtmlx.defined(parent))parent=this.getParent(item)||0;if(!this.isTaskExists(parent))parent=0;this.setParent(item,parent);item=this._init_task(item);if(this.callEvent("onBeforeTaskAdd",[item.id,item])===false)return false;this._pull[item.id]=item;this._add_branch(item,index);this.refreshData();this._adjust_scales();this.callEvent("onAfterTaskAdd",[item.id,item]);return item.id;};gantt._default_task_date=function(item,parent_id){var parent=(parent_id&&parent_id!=this.config.root_id)?this.getTask(parent_id):false,startDate='';if(parent){startDate=parent.start_date;}else{var first=this._order[0];startDate=first?(this.getTask(first).start_date?this.getTask(first).start_date:(this.getTask(first).end_date?this.calculateEndDate(this.getTask(first).end_date,-this.config.duration_step):'')):this.config.start_date||this.getState().min_date;}
dhtmlx.assert(startDate,"Invalid dates");return new Date(startDate);};gantt._set_default_task_timing=function(task){task.start_date=task.start_date||gantt._default_task_date(task,this.getParent(task));task.duration=task.duration||this.config.duration_step;task.end_date=task.end_date||this.calculateEndDate(task.start_date,task.duration);};gantt.createTask=function(item,parent,index){item=item||{};item.id=dhtmlx.uid();if(!item.start_date){item.start_date=gantt._default_task_date(item,parent);}
if(item.text===undefined){item.text=gantt.locale.labels.new_task;}
if(item.duration===undefined){item.duration=1;}
if(parent){this.setParent(item,parent);var parentObj=this.getTask(parent);parentObj.$open=true;}
if(!this.callEvent("onTaskCreated",[item])){return null;}
if(this.config.details_on_create){item.$new=true;this._pull[item.id]=this._init_task(item);this._add_branch(item,index);item.$level=this.calculateTaskLevel(item);this.selectTask(item.id);this.refreshData();this.showLightbox(item.id);}else{if(this.addTask(item,parent,index)){this.showTask(item.id);this.selectTask(item.id);}}
return item.id;};gantt.deleteTask=function(id){return this._deleteTask(id);};gantt._getChildLinks=function(id){var item=this.getTask(id);if(!item){return[];}
var links=item.$source.concat(item.$target);var branches=this.getChildren(item.id);for(var i=0;i<branches.length;i++){links=links.concat(this._getChildLinks(branches[i]));}
var res={};for(var i=0;i<links.length;i++){res[links[i]]=true;}
links=[];for(var i in res){links.push(i);}
return links;};gantt._getTaskTree=function(id){var item=this.getTask(id);if(!item){return[];}
var items=[];var branches=this.getChildren(item.id);for(var i=0;i<branches.length;i++){items.push(branches[i]);items=items.concat(this._getTaskTree(branches[i]));}
return items;};gantt._deleteRelatedLinks=function(links,silent){var use_dp=(this._dp&&!silent);var prev_mode='';var send_changes=use_dp?this._dp.updateMode!='off':false;if(use_dp){prev_mode=this._dp.updateMode;this._dp.setUpdateMode("off");}
for(var i=0;i<links.length;i++){if(use_dp){this._dp.setGanttMode("links");this._dp.setUpdated(links[i],true,"deleted");}
this._deleteLink(links[i],true);}
if(use_dp){this._dp.setUpdateMode(prev_mode);if(send_changes)
this._dp.sendAllData();}};gantt._deleteRelatedTasks=function(id,silent){var use_dp=(this._dp&&!silent);var prev_mode='';if(use_dp){prev_mode=this._dp.updateMode;this._dp.setGanttMode("tasks");this._dp.setUpdateMode("off");}
var tree=this._getTaskTree(id);for(var i=0;i<tree.length;i++){var t_id=tree[i];this._unset_task(t_id);if(use_dp){this._dp.setUpdated(t_id,true,"deleted");}}
if(use_dp){this._dp.setUpdateMode(prev_mode);}};gantt._unset_task=function(id){var item=this.getTask(id);this._update_flags(id,null);delete this._pull[id];this._move_branch(item,this.getParent(item),null);};gantt._deleteTask=function(id,silent){var item=this.getTask(id);if(!silent&&this.callEvent("onBeforeTaskDelete",[id,item])===false)return false;var links=gantt._getChildLinks(id);this._deleteRelatedTasks(id,silent);this._deleteRelatedLinks(links,silent);this._unset_task(id);if(!silent){this.callEvent("onAfterTaskDelete",[id,item]);this.refreshData();}
return true;};gantt.clearAll=function(){this._clear_data();this.callEvent("onClear",[]);this.refreshData();};gantt._clear_data=function(){this._pull={};this._branches={};this._order=[];this._order_full=[];this._lpull={};this._update_flags();this.userdata={};};gantt._update_flags=function(oldid,newid){if(oldid===undefined){this._lightbox_id=this._selected_task=null;if(this._tasks_dnd.drag){this._tasks_dnd.drag.id=null;}}else{if(this._lightbox_id==oldid)
this._lightbox_id=newid;if(this._selected_task==oldid){this._selected_task=newid;}
if(this._tasks_dnd.drag&&this._tasks_dnd.drag.id==oldid){this._tasks_dnd.drag.id=newid;}}};gantt.changeTaskId=function(oldid,newid){var item=this._pull[newid]=this._pull[oldid];this._pull[newid].id=newid;delete this._pull[oldid];for(var id in this._pull){var task=this._pull[id];if(this.getParent(task)==oldid)
this.setParent(task,newid);}
this._update_flags(oldid,newid);this._replace_branch_child(this.getParent(item),oldid,newid);this.callEvent("onTaskIdChange",[oldid,newid]);};gantt._get_duration_unit=function(){return(gantt._get_line(this.config.duration_unit)*1000)||this.config.duration_unit;};gantt._get_safe_type=function(type){return"task";};gantt._get_type_name=function(type_value){for(var i in this.config.types){if(this.config.types[i]==type_value){return i;}}
return"task";};gantt.getWorkHours=function(date){return this._working_time_helper.get_working_hours(date);};gantt.setWorkTime=function(config){this._working_time_helper.set_time(config);};gantt.isWorkTime=function(date,unit){var helper=this._working_time_helper;return helper.is_working_unit(date,unit||this.config.duration_unit);};gantt.correctTaskWorkTime=function(task){if(gantt.config.work_time&&gantt.config.correct_work_time){if(!gantt.isWorkTime(task.start_date)){task.start_date=gantt.getClosestWorkTime({date:task.start_date,dir:'future'});task.end_date=gantt.calculateEndDate(task.start_date,task.duration);}else if(!gantt.isWorkTime(new Date(+task.end_date-1))){task.end_date=gantt.calculateEndDate(task.start_date,task.duration);}}};gantt.getClosestWorkTime=function(config){var helper=this._working_time_helper;if(config instanceof Date){config={date:config};}
config.dir=config.dir||'any';config.unit=config.unit||this.config.duration_unit;return helper.get_closest_worktime(config);};gantt.calculateDuration=function(start_date,end_date){var helper=this._working_time_helper;return helper.get_work_units_between(start_date,end_date,this.config.duration_unit,this.config.duration_step);};gantt._hasDuration=function(start_date,end_date){var helper=this._working_time_helper;return helper.is_work_units_between(start_date,end_date,this.config.duration_unit,this.config.duration_step);};gantt.calculateEndDate=function(start,duration,unit){var helper=this._working_time_helper;var mult=duration>=0?1:-1;return helper.add_worktime(start,Math.abs(duration),unit||this.config.duration_unit,mult*this.config.duration_step);};gantt._init_task=function(task){if(!dhtmlx.defined(task.id))
task.id=dhtmlx.uid();if(task.start_date)
task.start_date=gantt.date.parseDate(task.start_date,"xml_date");if(task.end_date)
task.end_date=gantt.date.parseDate(task.end_date,"xml_date");if(task.start_date){if(!task.end_date&&task.duration){task.end_date=this.calculateEndDate(task.start_date,task.duration);}}else if(task.end_date&&task.duration!==undefined){task.start_date=this.calculateEndDate(task.end_date,-task.duration);}
if(this._isAllowedUnscheduledTask(task)){this._set_default_task_timing(task);}
gantt._init_task_timing(task);if(task.start_date&&task.end_date)
gantt.correctTaskWorkTime(task);task.$source=[];task.$target=[];if(task.parent===undefined){this.setParent(task,this.config.root_id);}
if(!dhtmlx.defined(task.$open)){task.$open=dhtmlx.defined(task.open)?task.open:this.config.open_tree_initially;}
task.$level=this.calculateTaskLevel(task);return task;};gantt._init_task_timing=function(task){var task_type=this._get_safe_type(task.type);if(task.$rendered_type===undefined){task.$rendered_type=task_type;}else if(task.$rendered_type!=task_type){delete task.$no_end;delete task.$no_start;task.$rendered_type=task_type;}
if((task.$no_end===undefined||task.$no_start===undefined)&&task_type!=this.config.types.milestone){if(task_type==this.config.types.project){task.$no_end=task.$no_start=true;this._set_default_task_timing(task);}else{task.$no_end=!(task.end_date||task.duration);task.$no_start=!task.start_date;if(this._isAllowedUnscheduledTask(task)){task.$no_end=task.$no_start=false;}}}
if(task_type==this.config.types.milestone){task.end_date=task.start_date;}
if(task.start_date&&task.end_date){task.duration=this.calculateDuration(task.start_date,task.end_date);}
task.duration=task.duration||0;};gantt._is_flex_task=function(task){return!!(task.$no_end||task.$no_start);};gantt.resetProjectDates=function(task){if(task.$no_end||task.$no_start){var dates=this.getSubtaskDates(task.id);this._assign_project_dates(task,dates.start_date,dates.end_date);}};gantt.getSubtaskDates=function(task_id){var min=null,max=null,root=task_id!==undefined?task_id:gantt.config.root_id;this.eachTask(function(child){if(this._get_safe_type(child.type)==gantt.config.types.project||this.isUnscheduledTask(child))
return;if((child.start_date&&!child.$no_start)&&(!min||min>child.start_date.valueOf()))
min=child.start_date.valueOf();if((child.end_date&&!child.$no_end)&&(!max||max<child.end_date.valueOf()))
max=child.end_date.valueOf();},root);return{start_date:min?new Date(min):null,end_date:max?new Date(max):null};};gantt._assign_project_dates=function(task,from,to){if(task.$no_start){if(from&&from!=Infinity){task.start_date=new Date(from);}else{task.start_date=this._default_task_date(task,this.getParent(task));}}
if(task.$no_end){if(to&&to!=-Infinity){task.end_date=new Date(to);}else{task.end_date=this.calculateEndDate(task.start_date,this.config.duration_step);}}
if(task.$no_start||task.$no_end){this._init_task_timing(task);}};gantt._update_parents=function(taskId,silent){if(!taskId)return;var task=this.getTask(taskId);var pid=this.getParent(task);while(!(task.$no_end||task.$no_start)&&pid&&this.isTaskExists(pid)){task=this.getTask(pid);pid=this.getParent(task);}
if(task.$no_start||task.$no_end){gantt.resetProjectDates(task);if(!silent)
this.refreshTask(task.id,true);}
if(pid&&this.isTaskExists(pid)){this._update_parents(pid,silent);}};gantt.isChildOf=function(child_id,parent_id){if(!this.isTaskExists(child_id))
return false;if(parent_id===this.config.root_id)
return this.isTaskExists(child_id);var task=this.getTask(child_id);var pid=this.getParent(child_id);while(task&&this.isTaskExists(pid)){task=this.getTask(pid);if(task&&task.id==parent_id)
return true;pid=this.getParent(task);}
return false;};gantt.roundDate=function(config){if(config instanceof Date){config={date:config,unit:gantt._tasks.unit,step:gantt._tasks.step};}
var date=config.date,steps=config.step,unit=config.unit;var upper,lower;if(unit==gantt._tasks.unit&&steps==gantt._tasks.step&&+date>=+gantt._min_date&&+date<=+gantt._max_date){var colIndex=Math.floor(gantt._day_index_by_date(date));lower=new Date(gantt._tasks.trace_x[colIndex]);upper=new Date(lower);if(gantt._tasks.trace_x[colIndex+1])
upper=new Date(gantt._tasks.trace_x[colIndex+1]);}else{upper=gantt.date[unit+"_start"](new Date(this._min_date));while(+upper<+date){upper=gantt.date[unit+"_start"](gantt.date.add(upper,steps,unit));var tzOffset=upper.getTimezoneOffset();upper=gantt.date.add(upper,steps,unit);upper=gantt._correct_dst_change(upper,tzOffset,upper,unit);if(gantt.date[unit+'_start'])
upper=gantt.date[unit+'_start'](upper);}
lower=gantt.date.add(upper,-1*steps,unit);}
if(config.dir&&config.dir=='future')
return upper;if(config.dir&&config.dir=='past')
return lower;if(Math.abs(date-lower)<Math.abs(upper-date)){return lower;}else{return upper;}};gantt.attachEvent("onBeforeTaskUpdate",function(id,task){gantt._init_task_timing(task);return true;});gantt.attachEvent("onBeforeTaskAdd",function(id,task){gantt._init_task_timing(task);return true;});gantt.calculateTaskLevel=function(item){var level=0;while(this.getParent(item)){if(!this.isTaskExists(this.getParent(item)))break;item=this.getTask(this.getParent(item));level++;}
return level;};gantt.sort=function(field,desc,parent,silent){var render=!silent;if(!this.isTaskExists(parent)){parent=this.config.root_id;}
if(!field)field="order";var criteria=(typeof(field)=="string")?(function(a,b){if(a[field]==b[field]){return 0;}
var result=a[field]>b[field];return result?1:-1;}):field;if(desc){var original_criteria=criteria;criteria=function(a,b){return original_criteria(b,a)};}
var els=this.getChildren(parent);if(els){var temp=[];for(var i=els.length-1;i>=0;i--)
temp[i]=this._pull[els[i]];temp.sort(criteria);for(var i=0;i<temp.length;i++){els[i]=temp[i].id;this.sort(field,desc,els[i],true);}}
if(render){this.render();}};gantt.getNext=function(id){for(var i=0;i<this._order.length-1;i++){if(this._order[i]==id)
return this._order[i+1];}
return null;};gantt.getPrev=function(id){for(var i=1;i<this._order.length;i++){if(this._order[i]==id)
return this._order[i-1];}
return null;};gantt._get_parent_id=function(task){var parent=this.config.root_id;if(task){parent=task.parent;}
return parent;};gantt.getParent=function(id){var task=null;if(id.id){task=id;}else if(this.isTaskExists(id)){task=gantt.getTask(id);}
return this._get_parent_id(task);};gantt.setParent=function(task,new_pid){task.parent=new_pid;};gantt.getSiblings=function(id){if(!this.isTaskExists(id)){return[];}
var parent=this.getParent(id);return this.getChildren(parent);};gantt.getNextSibling=function(id){var siblings=this.getSiblings(id);for(var i=0,len=siblings.length;i<len;i++){if(siblings[i]==id)
return siblings[i+1]||null;}
return null;};gantt.getPrevSibling=function(id){var siblings=this.getSiblings(id);for(var i=0,len=siblings.length;i<len;i++){if(siblings[i]==id)
return siblings[i-1]||null;}
return null;};gantt._dp_init=function(dp){dp.setTransactionMode("POST",true);dp.serverProcessor+=(dp.serverProcessor.indexOf("?")!=-1?"&":"?")+"editing=true";dp._serverProcessor=dp.serverProcessor;dp.styles={updated:"gantt_updated",inserted:"gantt_inserted",deleted:"gantt_deleted",invalid:"gantt_invalid",error:"gantt_error",clear:""};dp._methods=["_row_style","setCellTextStyle","_change_id","_delete_task"];dp.setGanttMode=function(mode){var modes=dp.modes||{};if(dp._ganttMode){modes[dp._ganttMode]={_in_progress:dp._in_progress,_invalid:dp._invalid,updatedRows:dp.updatedRows};}
var newState=modes[mode];if(!newState){newState=modes[mode]={_in_progress:{},_invalid:{},updatedRows:[]};}
dp._in_progress=newState._in_progress;dp._invalid=newState._invalid;dp.updatedRows=newState.updatedRows;dp.modes=modes;dp._ganttMode=mode;};this._sendTaskOrder=function(id,item){if(item.$drop_target){dp.setGanttMode("tasks");this.getTask(id).target=item.$drop_target;dp.setUpdated(id,true,"order");delete this.getTask(id).$drop_target;}};this.attachEvent("onAfterTaskAdd",function(id,item){dp.setGanttMode("tasks");dp.setUpdated(id,true,"inserted");});this.attachEvent("onAfterTaskUpdate",function(id,item){dp.setGanttMode("tasks");dp.setUpdated(id,true);gantt._sendTaskOrder(id,item);});this.attachEvent("onAfterTaskDelete",function(id,item){dp.setGanttMode("tasks");dp.setUpdated(id,true,"deleted");if(dp.updateMode!='off'&&!dp._tSend){dp.sendAllData();}});this.attachEvent("onAfterLinkUpdate",function(id,item){dp.setGanttMode("links");dp.setUpdated(id,true);});this.attachEvent("onAfterLinkAdd",function(id,item){dp.setGanttMode("links");dp.setUpdated(id,true,"inserted");});this.attachEvent("onAfterLinkDelete",function(id,item){dp.setGanttMode("links");dp.setUpdated(id,true,"deleted");});this.attachEvent("onRowDragEnd",function(id,target){gantt._sendTaskOrder(id,gantt.getTask(id));});dp.attachEvent("onBeforeDataSending",function(){var url=this._serverProcessor;if(this._tMode=="REST"){var mode=this._ganttMode.substr(0,this._ganttMode.length-1);url=url.substring(0,url.indexOf("?")>-1?url.indexOf("?"):url.length);this.serverProcessor=url+(url.slice(-1)=="/"?"":"/")+mode;}else{this.serverProcessor=url+window.dhtmlx.url(url)+"gantt_mode="+this._ganttMode;}
return true;});this._init_dp_live_update_hooks(dp);var afterUpdate=dp.afterUpdate;dp.afterUpdate=function(){var xml;if(arguments.length==3){xml=arguments[1];}else{xml=arguments[4];}
var mode=dp._ganttMode;var reqUrl=xml.filePath;if(this._tMode!="REST"){if(reqUrl.indexOf("gantt_mode=links")!=-1){mode="links";}else{mode="tasks";}}else{if(reqUrl.indexOf("/link")>reqUrl.indexOf("/task")){mode="links";}else{mode="tasks";}}
dp.setGanttMode(mode);var res=afterUpdate.apply(dp,arguments);dp.setGanttMode(mode);return res;};dp._getRowData=dhtmlx.bind(function(id,pref){var task;if(dp._ganttMode=="tasks")
task=this.isTaskExists(id)?this.getTask(id):{id:id};else
task=this.isLinkExists(id)?this.getLink(id):{id:id};task=dhtmlx.copy(task);var data={};for(var key in task){if(key.substr(0,1)=="$")continue;var value=task[key];if(value instanceof Date)
data[key]=this.templates.xml_format(value);else if(value===null)
data[key]="";else
data[key]=value;}
if(task.$no_start){task.start_date="";task.duration="";}
if(task.$no_end){task.end_date="";task.duration="";}
data[dp.action_param]=this.getUserData(id,dp.action_param);return data;},this);this._change_id=dhtmlx.bind(function(oldid,newid){if(dp._ganttMode!="tasks")
this.changeLinkId(oldid,newid);else
this.changeTaskId(oldid,newid);},this);this._row_style=function(row_id,classname){if(dp._ganttMode!="tasks")return;if(!gantt.isTaskExists(row_id))
return;var task=gantt.getTask(row_id);task.$dataprocessor_class=classname;gantt.refreshTask(row_id);};this._delete_task=function(row_id,node){};this._dp=dp;gantt._patch_dhx4_ajax();};gantt._patch_dhx4_ajax=function(){var dhxVersion=parseInt((dhx4.version||"").split(".").join(""),10);if(dhxVersion<=413){window.dhx4.ajax._call=function(method,url,postData,async,onLoad,longParams,headers){var t=(window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"));var isQt=(navigator.userAgent.match(/AppleWebKit/)!=null&&navigator.userAgent.match(/Qt/)!=null&&navigator.userAgent.match(/Safari/)!=null);if(async==true){t.onreadystatechange=function(){if((t.readyState==4)||(isQt==true&&t.readyState==3)){if(t.status!=200||t.responseText=="")
if(!dhx4.callEvent("onAjaxError",[t]))return;window.setTimeout(function(){if(typeof(onLoad)=="function"){onLoad.apply(window,[{xmlDoc:t,filePath:url}]);}
if(longParams!=null){if(typeof(longParams.postData)!="undefined"){dhx4.ajax.postLong(longParams.url,longParams.postData,onLoad);}else{dhx4.ajax.getLong(longParams.url,onLoad);}}
onLoad=null;t=null;},1);}}}
if(method=="GET"&&this.cache!=true){url+=(url.indexOf("?")>=0?"&":"?")+"dhxr"+new Date().getTime()+"=1";}
t.open(method,url,async);if(headers){for(var key in headers)
t.setRequestHeader(key,headers[key]);}else if(method.toUpperCase()=="POST"||method=="PUT"||method=="DELETE"){t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");}else if(method=="GET"){postData=null;}
t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.send(postData);if(!async)return{xmlDoc:t,filePath:url};};}
gantt._patch_dhx4_ajax=function(){};};gantt.getUserData=function(id,name){if(!this.userdata)this.userdata={};if(this.userdata[id]&&this.userdata[id][name])return this.userdata[id][name];return"";};gantt.setUserData=function(id,name,value){if(!this.userdata)this.userdata={};if(!this.userdata[id])this.userdata[id]={};this.userdata[id][name]=value;};gantt._init_link=function(link){if(!dhtmlx.defined(link.id))
link.id=dhtmlx.uid();return link;};gantt._sync_links=function(){for(var id in this._pull){this._pull[id].$source=[];this._pull[id].$target=[];}
for(var id in this._lpull){var link=this._lpull[id];if(this._pull[link.source])
this._pull[link.source].$source.push(id);if(this._pull[link.target])
this._pull[link.target].$target.push(id);}};gantt.getLink=function(id){dhtmlx.assert(this._lpull[id],"Link doesn't exist");return this._lpull[id];};gantt.getLinks=function(){var links=[];for(var key in gantt._lpull)
links.push(gantt._lpull[key]);return links;};gantt.isLinkExists=function(id){return dhtmlx.defined(this._lpull[id]);};gantt.addLink=function(link){link=this._init_link(link);if(this.callEvent("onBeforeLinkAdd",[link.id,link])===false)return false;this._lpull[link.id]=link;this._sync_links();this._render_link(link.id);this.callEvent("onAfterLinkAdd",[link.id,link]);return link.id;};gantt.updateLink=function(id,data){if(!dhtmlx.defined(data))
data=this.getLink(id);if(this.callEvent("onBeforeLinkUpdate",[id,data])===false)return false;this._lpull[id]=data;this._sync_links();this._render_link(id);this.callEvent("onAfterLinkUpdate",[id,data]);return true;};gantt.deleteLink=function(id){return this._deleteLink(id);};gantt._deleteLink=function(id,silent){var link=this.getLink(id);if(!silent&&this.callEvent("onBeforeLinkDelete",[id,link])===false)return false;delete this._lpull[id];this._sync_links();this.refreshLink(id);if(!silent)this.callEvent("onAfterLinkDelete",[id,link]);return true;};gantt.changeLinkId=function(oldid,newid){this._lpull[newid]=this._lpull[oldid];this._lpull[newid].id=newid;delete this._lpull[oldid];this._sync_links();this.callEvent("onLinkIdChange",[oldid,newid]);};gantt.getChildren=function(id){return dhtmlx.defined(this._branches[id])?this._branches[id]:[];};gantt.hasChild=function(id){return(dhtmlx.defined(this._branches[id])&&this._branches[id].length);};gantt.refreshData=function(){this._render_data();};gantt._configure=function(col,data,force){for(var key in data)
if(typeof col[key]=="undefined"||force)
col[key]=data[key];};gantt._init_skin=function(){gantt._get_skin(false);gantt._init_skin=function(){};};gantt._get_skin=function(force){if(!gantt.skin||force){var links=document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var res=links[i].href.match("dhtmlxgantt_([a-z]+).css");if(res){gantt.skin=res[1];break;}}}
if(!gantt.skin)gantt.skin="terrace";var skinset=gantt.skins[gantt.skin];this._configure(gantt.config,skinset.config,force);var config=gantt.getGridColumns();if(config[1]&&typeof config[1].width=="undefined")
config[1].width=skinset._second_column_width;if(config[2]&&typeof config[2].width=="undefined")
config[2].width=skinset._third_column_width;if(skinset._lightbox_template)
gantt._lightbox_template=skinset._lightbox_template;gantt.resetLightbox();};gantt.resetSkin=function(){this.skin="";this._get_skin(true);};gantt.skins={};gantt._lightbox_methods={};gantt._lightbox_template="<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>";gantt.showLightbox=function(id){if(!id||gantt._is_readonly(this.getTask(id)))return;if(!this.callEvent("onBeforeLightbox",[id]))return;var task=this.getTask(id);var box=this.getLightbox(this._get_safe_type(task.type));this._center_lightbox(box);this.showCover();this._fill_lightbox(id,box);this.callEvent("onLightbox",[id]);};gantt._get_timepicker_step=function(){if(this.config.round_dnd_dates){var scale=gantt._tasks,step=(this._get_line(scale.unit)*scale.step)/60;if(step>=60*24||!this._is_chart_visible()){step=this.config.time_step;}
return step;}
return this.config.time_step;};gantt.getLabel=function(property,key){var sections=this._get_typed_lightbox_config();for(var i=0;i<sections.length;i++){if(sections[i].map_to==property){var options=sections[i].options;for(var j=0;j<options.length;j++){if(options[j].key==key){return options[j].label;}}}}
return"";};gantt.updateCollection=function(list_name,collection){collection=collection.slice(0);var list=gantt.serverList(list_name);if(!list)return false;list.splice(0,list.length);list.push.apply(list,collection||[]);gantt.resetLightbox();};gantt.getLightboxType=function(){return this._get_safe_type(this._lightbox_type);};gantt.getLightbox=function(type){if(type===undefined)
type=this.getLightboxType();if(!this._lightbox||this.getLightboxType()!=this._get_safe_type(type)){this._lightbox_type=this._get_safe_type(type);var d=document.createElement("DIV");d.className="gantt_cal_light";var full_width=this._is_lightbox_timepicker();if(gantt.config.wide_form||full_width)
d.className+=" gantt_cal_light_wide";if(full_width){gantt.config.wide_form=true;d.className+=" gantt_cal_light_full";}
d.style.visibility="hidden";var html=this._lightbox_template;var buttons=this.config.buttons_left;for(var i=0;i<buttons.length;i++){var button=this.config._migrate_buttons[buttons[i]]?this.config._migrate_buttons[buttons[i]]:buttons[i];html+="<div class='gantt_btn_set gantt_left_btn_set "+button+"_set'><div dhx_button='1' class='"+button+"'></div><div>"+this.locale.labels[button]+"</div></div>";}
buttons=this.config.buttons_right;for(var i=0;i<buttons.length;i++){var button=this.config._migrate_buttons[buttons[i]]?this.config._migrate_buttons[buttons[i]]:buttons[i];html+="<div class='gantt_btn_set gantt_right_btn_set "+button+"_set' style='float:right;'><div dhx_button='1' class='"+button+"'></div><div>"+this.locale.labels[button]+"</div></div>";}
html+="</div>";d.innerHTML=html;if(gantt.config.drag_lightbox){d.firstChild.onmousedown=gantt._ready_to_dnd;d.firstChild.onselectstart=function(){return false;};d.firstChild.style.cursor="pointer";gantt._init_dnd_events();}
document.body.insertBefore(d,document.body.firstChild);this._lightbox=d;var sns=this._get_typed_lightbox_config(type);html=this._render_sections(sns);var ds=d.getElementsByTagName("div");for(var i=0;i<ds.length;i++){var t_ds=ds[i];if(t_ds.className=="gantt_cal_larea"){t_ds.innerHTML=html;break;}}
this.resizeLightbox();this._init_lightbox_events(this);d.style.display="none";d.style.visibility="visible";}
return this._lightbox;};gantt._render_sections=function(sns){var html="";for(var i=0;i<sns.length;i++){var block=this.form_blocks[sns[i].type];if(!block)continue;sns[i].id="area_"+dhtmlx.uid();var display=sns[i].hidden?" style='display:none'":"";var button="";if(sns[i].button){button="<div class='gantt_custom_button' index='"+i+"'><div class='gantt_custom_button_"+sns[i].button+"'></div><div>"+this.locale.labels["button_"+sns[i].button]+"</div></div>";}
if(this.config.wide_form){html+="<div class='gantt_wrap_section' "+display+">";}
html+="<div id='"+sns[i].id+"' class='gantt_cal_lsection'>"+button+this.locale.labels["section_"+sns[i].name]+"</div>"+block.render.call(this,sns[i]);html+="</div>";}
return html;};gantt.resizeLightbox=function(){var d=this._lightbox;if(!d)return;var con=d.childNodes[1];con.style.height="0px";con.style.height=con.scrollHeight+"px";d.style.height=con.scrollHeight+this.config.lightbox_additional_height+"px";con.style.height=con.scrollHeight+"px";};gantt._center_lightbox=function(box){if(box){box.style.display="block";var scroll_top=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;var scroll_left=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;var view_height=window.innerHeight||document.documentElement.clientHeight;if(scroll_top)
box.style.top=Math.round(scroll_top+Math.max((view_height-box.offsetHeight)/2,0))+"px";else
box.style.top=Math.round(Math.max(((view_height-box.offsetHeight)/2),0)+9)+"px";if(document.documentElement.scrollWidth>document.body.offsetWidth)
box.style.left=Math.round(scroll_left+(document.body.offsetWidth-box.offsetWidth)/2)+"px";else
box.style.left=Math.round((document.body.offsetWidth-box.offsetWidth)/2)+"px";}};gantt.showCover=function(){if(this._cover)return;this._cover=document.createElement("DIV");this._cover.className="gantt_cal_cover";var _document_height=((document.height!==undefined)?document.height:document.body.offsetHeight);var _scroll_height=((document.documentElement)?document.documentElement.scrollHeight:0);this._cover.style.height=Math.max(_document_height,_scroll_height)+'px';document.body.appendChild(this._cover);};gantt._init_lightbox_events=function(){gantt.lightbox_events={};gantt.lightbox_events["gantt_save_btn"]=function(e){gantt._save_lightbox();};gantt.lightbox_events["gantt_delete_btn"]=function(e){if(!gantt.callEvent("onLightboxDelete",[gantt._lightbox_id]))
return;if(gantt.isTaskExists(gantt._lightbox_id)){gantt.$click.buttons["delete"](gantt._lightbox_id);}else{gantt.hideLightbox();}};gantt.lightbox_events["gantt_cancel_btn"]=function(e){gantt._cancel_lightbox();};gantt.lightbox_events["default"]=function(e,src){if(src.getAttribute("dhx_button")){gantt.callEvent("onLightboxButton",[src.className,src,e]);}else{var index,block,sec;var className=gantt._getClassName(src);if(className.indexOf("gantt_custom_button")!=-1){if(className.indexOf("gantt_custom_button_")!=-1){index=src.parentNode.getAttribute("index");sec=src.parentNode.parentNode;}else{index=src.getAttribute("index");sec=src.parentNode;src=src.firstChild;}}
var sections=gantt._get_typed_lightbox_config();if(index){block=gantt.form_blocks[sections[index].type];block.button_click(index,src,sec,sec.nextSibling);}}};dhtmlxEvent(gantt.getLightbox(),"click",function(e){e=e||window.event;var src=e.target?e.target:e.srcElement;var className=gantt._getClassName(src);if(!className){src=src.previousSibling;className=gantt._getClassName(src);}
if(src&&className&&className.indexOf("gantt_btn_set")===0){src=src.firstChild;className=gantt._getClassName(src);}
if(src&&className){var func=dhtmlx.defined(gantt.lightbox_events[src.className])?gantt.lightbox_events[src.className]:gantt.lightbox_events["default"];return func(e,src);}
return false;});gantt.getLightbox().onkeydown=function(e){switch((e||event).keyCode){case gantt.keys.edit_save:if((e||event).shiftKey)return;gantt._save_lightbox();break;case gantt.keys.edit_cancel:gantt._cancel_lightbox();break;default:break;}};};gantt._cancel_lightbox=function(){var task=this.getLightboxValues();this.callEvent("onLightboxCancel",[this._lightbox_id,task.$new]);if(gantt.isTaskExists(task.id)&&task.$new){this._deleteTask(task.id,true);}
this.refreshData();this.hideLightbox();};gantt._save_lightbox=function(){var task=this.getLightboxValues();if(!this.callEvent("onLightboxSave",[this._lightbox_id,task,!!task.$new]))
return;if(task.$new){delete task.$new;this.addTask(task);}else if(this.isTaskExists(task.id)){dhtmlx.mixin(this.getTask(task.id),task,true);this.updateTask(task.id);}
this.refreshData();this.hideLightbox();};gantt._resolve_default_mapping=function(section){var mapping=section.map_to;var time_controls={"time":true,"time_optional":true,"duration":true,"duration_optional":true};if(time_controls[section.type]){if(section.map_to=='auto'){mapping={start_date:"start_date",end_date:"end_date",duration:"duration"};}else if(typeof(section.map_to)==="string"){mapping={start_date:section.map_to};}}
return mapping;};gantt.getLightboxValues=function(){var task={};if(gantt.isTaskExists(this._lightbox_id)){task=dhtmlx.mixin({},this.getTask(this._lightbox_id));}
var sns=this._get_typed_lightbox_config();for(var i=0;i<sns.length;i++){var node=document.getElementById(sns[i].id);node=(node?node.nextSibling:node);var block=this.form_blocks[sns[i].type];if(!block)continue;var res=block.get_value.call(this,node,task,sns[i]);var map_to=gantt._resolve_default_mapping(sns[i]);if(typeof map_to=="string"&&map_to!="auto"){task[map_to]=res;}else if(typeof map_to=="object"){for(var property in map_to){if(map_to[property])
task[map_to[property]]=res[property];}}}
return task;};gantt.hideLightbox=function(){var box=this.getLightbox();if(box)box.style.display="none";this._lightbox_id=null;this.hideCover();this.callEvent("onAfterLightbox",[]);};gantt.hideCover=function(){if(this._cover)
this._cover.parentNode.removeChild(this._cover);this._cover=null;};gantt.resetLightbox=function(){if(gantt._lightbox&&!gantt._custom_lightbox)
gantt._lightbox.parentNode.removeChild(gantt._lightbox);gantt._lightbox=null;};gantt._set_lightbox_values=function(data,box){var task=data;var s=box.getElementsByTagName("span");if(gantt.templates.lightbox_header){s[1].innerHTML="";s[2].innerHTML=gantt.templates.lightbox_header(task.start_date,task.end_date,task);}else{s[1].innerHTML=this.templates.task_time(task.start_date,task.end_date,task);s[2].innerHTML=(this.templates.task_text(task.start_date,task.end_date,task)||"").substr(0,70);}
var sns=this._get_typed_lightbox_config(this.getLightboxType());for(var i=0;i<sns.length;i++){var section=sns[i];if(!this.form_blocks[section.type]){continue;}
var node=document.getElementById(section.id).nextSibling;var block=this.form_blocks[section.type];var map_to=gantt._resolve_default_mapping(sns[i]);var value=dhtmlx.defined(task[map_to])?task[map_to]:section.default_value;block.set_value.call(gantt,node,value,task,section);if(section.focus)
block.focus.call(gantt,node);}
if(data.id)
gantt._lightbox_id=data.id;};gantt._fill_lightbox=function(id,box){var task=this.getTask(id);this._set_lightbox_values(task,box);};gantt.getLightboxSection=function(name){var config=this._get_typed_lightbox_config();var i=0;for(i;i<config.length;i++)
if(config[i].name==name)
break;var section=config[i];if(!section)
return null;if(!this._lightbox)
this.getLightbox();var header=document.getElementById(section.id);var node=header.nextSibling;var result={section:section,header:header,node:node,getValue:function(ev){return gantt.form_blocks[section.type].get_value.call(gantt,node,(ev||{}),section);},setValue:function(value,ev){return gantt.form_blocks[section.type].set_value.call(gantt,node,value,(ev||{}),section);}};var handler=this._lightbox_methods["get_"+section.type+"_control"];return handler?handler(result):result;};gantt._lightbox_methods.get_template_control=function(result){result.control=result.node;return result;};gantt._lightbox_methods.get_select_control=function(result){result.control=result.node.getElementsByTagName('select')[0];return result;};gantt._lightbox_methods.get_textarea_control=function(result){result.control=result.node.getElementsByTagName('textarea')[0];return result;};gantt._lightbox_methods.get_time_control=function(result){result.control=result.node.getElementsByTagName('select');return result;};gantt._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",gantt._move_while_dnd);dhtmlxEvent(document.body,"mouseup",gantt._finish_dnd);gantt._init_dnd_events=function(){};};gantt._move_while_dnd=function(e){if(gantt._dnd_start_lb){if(!document.gantt_unselectable){document.body.className+=" gantt_unselectable";document.gantt_unselectable=true;}
var lb=gantt.getLightbox();var now=(e&&e.target)?[e.pageX,e.pageY]:[event.clientX,event.clientY];lb.style.top=gantt._lb_start[1]+now[1]-gantt._dnd_start_lb[1]+"px";lb.style.left=gantt._lb_start[0]+now[0]-gantt._dnd_start_lb[0]+"px";}};gantt._ready_to_dnd=function(e){var lb=gantt.getLightbox();gantt._lb_start=[parseInt(lb.style.left,10),parseInt(lb.style.top,10)];gantt._dnd_start_lb=(e&&e.target)?[e.pageX,e.pageY]:[event.clientX,event.clientY];};gantt._finish_dnd=function(){if(gantt._lb_start){gantt._lb_start=gantt._dnd_start_lb=false;document.body.className=document.body.className.replace(" gantt_unselectable","");document.gantt_unselectable=false;}};gantt._focus=function(node,select){if(node&&node.focus){if(gantt.config.touch){}else{try{if(select&&node.select)node.select();node.focus();}catch(e){}}}};gantt.form_blocks={getTimePicker:function(sns,hidden){var time_format=sns.time_format;if(!time_format){var time_format=["%d","%m","%Y"];if(gantt._get_line(gantt._tasks.unit)<gantt._get_line("day")){time_format.push("%H:%i");}}
sns._time_format_order={size:0};var cfg=this.config;var dt=this.date.date_part(new Date(gantt._min_date.valueOf()));var last=24*60,first=0;if(gantt.config.limit_time_select){last=60*cfg.last_hour+1;first=60*cfg.first_hour;dt.setHours(cfg.first_hour);}
var html="";for(var p=0;p<time_format.length;p++){var time_option=time_format[p];if(p>0){html+=" ";}
var options='';switch(time_option){case"%Y":sns._time_format_order[2]=p;sns._time_format_order.size++;var range,offset,start_year,end_year;if(sns.year_range){if(!isNaN(sns.year_range)){range=sns.year_range;}else if(sns.year_range.push){start_year=sns.year_range[0];end_year=sns.year_range[1];}}
range=range||10;offset=offset||Math.floor(range/2);start_year=start_year||dt.getFullYear()-offset;end_year=end_year||start_year+range;for(var i=start_year;i<end_year;i++)
options+="<option value='"+(i)+"'>"+(i)+"</option>";break;case"%m":sns._time_format_order[1]=p;sns._time_format_order.size++;for(var i=0;i<12;i++)
options+="<option value='"+i+"'>"+this.locale.date.month_full[i]+"</option>";break;case"%d":sns._time_format_order[0]=p;sns._time_format_order.size++;for(var i=1;i<32;i++)
options+="<option value='"+i+"'>"+i+"</option>";break;case"%H:%i":sns._time_format_order[3]=p;sns._time_format_order.size++;var i=first;var tdate=dt.getDate();sns._time_values=[];while(i<last){var time=this.templates.time_picker(dt);options+="<option value='"+i+"'>"+time+"</option>";sns._time_values.push(i);dt.setTime(dt.valueOf()+this._get_timepicker_step()*60*1000);var diff=(dt.getDate()!=tdate)?1:0;i=diff*24*60+dt.getHours()*60+dt.getMinutes();}
break;default:break;}
if(options){var readonly=sns.readonly?"disabled='disabled'":"";var display=hidden?" style='display:none'":"";html+="<select "+readonly+display+">"+options+"</select>";}}
return html;},_fill_lightbox_select:function(s,i,d,map,cfg){s[i+map[0]].value=d.getDate();s[i+map[1]].value=d.getMonth();s[i+map[2]].value=d.getFullYear();if(dhtmlx.defined(map[3])){var v=d.getHours()*60+d.getMinutes();v=Math.round(v/gantt._get_timepicker_step())*gantt._get_timepicker_step();var input=s[i+map[3]];input.value=v;input.setAttribute('data-value',v);}},template:{render:function(sns){var height=(sns.height||"30")+"px";return"<div class='gantt_cal_ltext gantt_cal_template' style='height:"+height+";'></div>";},set_value:function(node,value,ev,config){node.innerHTML=value||"";},get_value:function(node,ev,config){return node.innerHTML||"";},focus:function(node){}},textarea:{render:function(sns){var height=(sns.height||"130")+"px";return"<div class='gantt_cal_ltext' style='height:"+height+";'><textarea></textarea></div>";},set_value:function(node,value,ev){node.firstChild.value=value||"";},get_value:function(node,ev){return node.firstChild.value;},focus:function(node){var a=node.firstChild;gantt._focus(a,true);}},select:{render:function(sns){var height=(sns.height||"23")+"px";var html="<div class='gantt_cal_ltext' style='height:"+height+";'><select style='width:100%;'>";for(var i=0;i<sns.options.length;i++)
html+="<option value='"+sns.options[i].key+"'>"+sns.options[i].label+"</option>";html+="</select></div>";return html;},set_value:function(node,value,ev,sns){var select=node.firstChild;if(!select._dhx_onchange&&sns.onchange){select.onchange=sns.onchange;select._dhx_onchange=true;}
if(typeof value=="undefined")
value=(select.options[0]||{}).value;select.value=value||"";},get_value:function(node,ev){return node.firstChild.value;},focus:function(node){var a=node.firstChild;gantt._focus(a,true);}},time:{render:function(sns){var time=this.form_blocks.getTimePicker.call(this,sns);var parts=["<div style='height:"+(sns.height||30)+"px;padding-top:0px;font-size:inherit;text-align:center;' class='gantt_section_time'>"];parts.push(time);if(sns.single_date){time=this.form_blocks.getTimePicker.call(this,sns,true);parts.push("<span></span>");}else{parts.push("<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>");}
parts.push(time);parts.push("</div>");return parts.join('');},set_value:function(node,value,ev,config){var cfg=config;var s=node.getElementsByTagName("select");var map=config._time_format_order;var map_size=config._time_format_size;if(cfg.auto_end_date){var _update_lightbox_select=function(){start_date=new Date(s[map[2]].value,s[map[1]].value,s[map[0]].value,0,0);end_date=gantt.calculateEndDate(start_date,1);this.form_blocks._fill_lightbox_select(s,map.size,end_date,map,cfg);};for(var i=0;i<4;i++){s[i].onchange=_update_lightbox_select;}}
var mapping=gantt._resolve_default_mapping(config);if(typeof(mapping)==="string")mapping={start_date:mapping};var start_date=ev[mapping.start_date]||new Date();var end_date=ev[mapping.end_date]||gantt.calculateEndDate(start_date,1);this.form_blocks._fill_lightbox_select(s,0,start_date,map,cfg);this.form_blocks._fill_lightbox_select(s,map.size,end_date,map,cfg);},get_value:function(node,ev,config){var s=node.getElementsByTagName("select");var map=config._time_format_order;var hours=0,minutes=0;if(dhtmlx.defined(map[3])){var time=parseInt(s[map[3]].value,10);hours=Math.floor(time/60);minutes=time%60;}
var start_date=new Date(s[map[2]].value,s[map[1]].value,s[map[0]].value,hours,minutes);hours=minutes=0;if(dhtmlx.defined(map[3])){var time=parseInt(s[map.size+map[3]].value,10);hours=Math.floor(time/60);minutes=time%60;}
var end_date=new Date(s[map[2]+map.size].value,s[map[1]+map.size].value,s[map[0]+map.size].value,hours,minutes);if(end_date<=start_date)
end_date=gantt.date.add(start_date,gantt._get_timepicker_step(),"minute");var mapped_fields=gantt._resolve_default_mapping(config);var res={start_date:new Date(start_date),end_date:new Date(end_date)};if(typeof mapped_fields=="string"){return res.start_date;}else{return res;}},focus:function(node){gantt._focus(node.getElementsByTagName("select")[0]);}},duration:{render:function(sns){var time=this.form_blocks.getTimePicker.call(this,sns);time="<div class='gantt_time_selects'>"+time+"</div>";var label=this.locale.labels[this.config.duration_unit+"s"];var singleDate=sns.single_date?' style="display:none"':"";var readonly=sns.readonly?" disabled='disabled'":"";var duration="<div class='gantt_duration' "+singleDate+">"+"<input type='button' class='gantt_duration_dec' value='-'"+readonly+">"+"<input type='text' value='5' class='gantt_duration_value'"+readonly+">"+"<input type='button' class='gantt_duration_inc' value='+'"+readonly+"> "+label+" <span></span>"+"</div>";var html="<div style='height:"+(sns.height||30)+"px;padding-top:0px;font-size:inherit;' class='gantt_section_time'>"+time+" "+duration+"</div>";return html;},set_value:function(node,value,ev,config){var cfg=config;var s=node.getElementsByTagName("select");var inps=node.getElementsByTagName("input");var duration=inps[1];var btns=[inps[0],inps[2]];var endspan=node.getElementsByTagName("span")[0];var map=config._time_format_order;function _calc_date(){var start_date=gantt.form_blocks.duration._get_start_date.call(gantt,node,config);var duration=gantt.form_blocks.duration._get_duration.call(gantt,node,config);var end_date=gantt.calculateEndDate(start_date,duration);endspan.innerHTML=gantt.templates.task_date(end_date);}
function _change_duration(step){var value=duration.value;value=parseInt(value,10);if(window.isNaN(value))
value=0;value+=step;if(value<1)value=1;duration.value=value;_calc_date();}
btns[0].onclick=dhtmlx.bind(function(){_change_duration(-1*this.config.duration_step);},this);btns[1].onclick=dhtmlx.bind(function(){_change_duration(1*this.config.duration_step);},this);s[0].onchange=_calc_date;s[1].onchange=_calc_date;s[2].onchange=_calc_date;if(s[3])s[3].onchange=_calc_date;duration.onkeydown=dhtmlx.bind(function(e){e=e||window.event;var code=(e.charCode||e.keyCode||e.which);if(code==40){_change_duration(-1*this.config.duration_step);return false;}
if(code==38){_change_duration(1*this.config.duration_step);return false;}
window.setTimeout(function(e){_calc_date();},1);},this);duration.onchange=dhtmlx.bind(function(e){_calc_date();},this);var mapping=gantt._resolve_default_mapping(config);if(typeof(mapping)==="string")mapping={start_date:mapping};var start_date=ev[mapping.start_date]||new Date();var end_date=ev[mapping.end_date]||gantt.calculateEndDate(start_date,1);var duration_val=Math.round(ev[mapping.duration])||gantt.calculateDuration(start_date,end_date);gantt.form_blocks._fill_lightbox_select(s,0,start_date,map,cfg);duration.value=duration_val;_calc_date();},_get_start_date:function(node,config){var s=node.getElementsByTagName("select");var map=config._time_format_order;var hours=0;var minutes=0;if(dhtmlx.defined(map[3])){var input=s[map[3]];var time=parseInt(input.value,10);if(isNaN(time)&&input.hasAttribute("data-value")){time=parseInt(input.getAttribute("data-value"),10);}
hours=Math.floor(time/60);minutes=time%60;}
return new Date(s[map[2]].value,s[map[1]].value,s[map[0]].value,hours,minutes);},_get_duration:function(node,config){var duration=node.getElementsByTagName("input")[1];duration=parseInt(duration.value,10);if(!duration||window.isNaN(duration))duration=1;if(duration<0)duration*=-1;return duration;},get_value:function(node,ev,config){var start_date=gantt.form_blocks.duration._get_start_date(node,config);var duration=gantt.form_blocks.duration._get_duration(node,config);var end_date=gantt.calculateEndDate(start_date,duration);var mapped_fields=gantt._resolve_default_mapping(config);var res={start_date:new Date(start_date),end_date:new Date(end_date),duration:duration};if(typeof mapped_fields=="string"){return res.start_date;}else{return res;}},focus:function(node){gantt._focus(node.getElementsByTagName("select")[0]);}},parent:{_filter:function(options,config,item_id){var filter=config.filter||function(){return true;};options=options.slice(0);for(var i=0;i<options.length;i++){var task=options[i];if(task.id==item_id||gantt.isChildOf(task.id,item_id)||filter(task.id,task)===false){options.splice(i,1);i--;}}
return options;},_display:function(config,item_id){var tasks=[],options=[];if(item_id){tasks=gantt.getTaskByTime();if(config.allow_root){tasks.unshift({id:gantt.config.root_id,text:config.root_label||""});}
tasks=this._filter(tasks,config,item_id);if(config.sort){tasks.sort(config.sort);}}
var text=config.template||gantt.templates.task_text;for(var i=0;i<tasks.length;i++){var label=text.apply(gantt,[tasks[i].start_date,tasks[i].end_date,tasks[i]]);if(label===undefined){label="";}
options.push({key:tasks[i].id,label:label});}
config.options=options;config.map_to=config.map_to||"parent";return gantt.form_blocks.select.render.apply(this,arguments);},render:function(sns){return gantt.form_blocks.parent._display(sns,false);},set_value:function(node,value,ev,config){var tmpDom=document.createElement("div");tmpDom.innerHTML=gantt.form_blocks.parent._display(config,ev.id);var newOptions=tmpDom.removeChild(tmpDom.firstChild);node.onselect=null;node.parentNode.replaceChild(newOptions,node);return gantt.form_blocks.select.set_value.apply(gantt,[newOptions,value,ev,config]);},get_value:function(){return gantt.form_blocks.select.get_value.apply(gantt,arguments);},focus:function(){return gantt.form_blocks.select.focus.apply(gantt,arguments);}}};gantt._is_lightbox_timepicker=function(){var s=this._get_typed_lightbox_config();for(var i=0;i<s.length;i++)
if(s[i].name=="time"&&s[i].type=="time")
return true;return false;};gantt._dhtmlx_confirm=function(message,title,callback,ok){if(!message)
return callback();var opts={text:message};if(title)
opts.title=title;if(ok){opts.ok=ok;}
if(callback){opts.callback=function(result){if(result)
callback();};}
dhtmlx.confirm(opts);};gantt._get_typed_lightbox_config=function(type){if(type===undefined){type=this.getLightboxType();}
var field=this._get_type_name(type);if(gantt.config.lightbox[field+"_sections"]){return gantt.config.lightbox[field+"_sections"];}else{return gantt.config.lightbox.sections;}};gantt._silent_redraw_lightbox=function(type){var oldType=this.getLightboxType();if(this.getState().lightbox){var taskId=this.getState().lightbox;var formData=this.getLightboxValues(),task=dhtmlx.copy(this.getTask(taskId));this.resetLightbox();var updTask=dhtmlx.mixin(task,formData,true);var box=this.getLightbox(type?type:undefined);this._center_lightbox(this.getLightbox());this._set_lightbox_values(updTask,box);}else{this.resetLightbox();this.getLightbox(type?type:undefined);}
this.callEvent("onLightboxChange",[oldType,this.getLightboxType()]);};gantt._extend_to_optional=function(lightbox_block){var duration=lightbox_block;var optional_time={render:duration.render,focus:duration.focus,set_value:function(node,value,task,section){var mapping=gantt._resolve_default_mapping(section);if(!task[mapping.start_date]||(mapping.start_date=="start_date"&&this._isAllowedUnscheduledTask(task))){optional_time.disable(node,section);var val={};for(var i in mapping){val[mapping[i]]=task[i];}
return duration.set_value.call(gantt,node,value,val,section);}else{optional_time.enable(node,section);return duration.set_value.call(gantt,node,value,task,section);}},get_value:function(node,task,section){if(section.disabled){return{start_date:null};}else{return duration.get_value.call(gantt,node,task,section);}},update_block:function(node,section){gantt.callEvent("onSectionToggle",[gantt._lightbox_id,section]);node.style.display=section.disabled?"none":"block";if(section.button){var button=node.previousSibling.firstChild.firstChild,labels=gantt.locale.labels;var button_text=section.disabled?labels[section.name+"_enable_button"]:labels[section.name+"_disable_button"];button.nextSibling.innerHTML=button_text;}
gantt.resizeLightbox();},disable:function(node,section){section.disabled=true;optional_time.update_block(node,section);},enable:function(node,section){section.disabled=false;optional_time.update_block(node,section);},button_click:function(index,el,section,container){if(gantt.callEvent("onSectionButton",[gantt._lightbox_id,section])===false){return;}
var config=gantt._get_typed_lightbox_config()[index];if(config.disabled){optional_time.enable(container,config);}else{optional_time.disable(container,config);}}};return optional_time;};gantt.form_blocks.duration_optional=gantt._extend_to_optional(gantt.form_blocks.duration);gantt.form_blocks.time_optional=gantt._extend_to_optional(gantt.form_blocks.time);function dataProcessor(serverProcessorURL){this.serverProcessor=serverProcessorURL;this.action_param="!nativeeditor_status";this.object=null;this.updatedRows=[];this.autoUpdate=true;this.updateMode="cell";this._tMode="GET";this._headers=null;this._payload=null;this.post_delim="_";this._waitMode=0;this._in_progress={};this._invalid={};this.mandatoryFields=[];this.messages=[];this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"};this.enableUTFencoding(true);dhx4._eventable(this);return this;}
dataProcessor.prototype={setTransactionMode:function(mode,total){if(typeof mode=="object"){this._tMode=mode.mode||this._tMode;this._headers=this._headers||mode.headers;this._payload=this._payload||mode.payload;}else{this._tMode=mode;this._tSend=total;}
if(this._tMode=="REST"){this._tSend=false;this._endnm=true;}},escape:function(data){if(this._utf)
return encodeURIComponent(data);else
return escape(data);},enableUTFencoding:function(mode){this._utf=dhx4.s2b(mode);},setDataColumns:function(val){this._columns=(typeof val=="string")?val.split(","):val;},getSyncState:function(){return!this.updatedRows.length;},enableDataNames:function(mode){this._endnm=dhx4.s2b(mode);},enablePartialDataSend:function(mode){this._changed=dhx4.s2b(mode);},setUpdateMode:function(mode,dnd){this.autoUpdate=(mode=="cell");this.updateMode=mode;this.dnd=dnd;},ignore:function(code,master){this._silent_mode=true;code.call(master||window);this._silent_mode=false;},setUpdated:function(rowId,state,mode){if(this._silent_mode)return;var ind=this.findRow(rowId);mode=mode||"updated";var existing=this.obj.getUserData(rowId,this.action_param);if(existing&&mode=="updated")mode=existing;if(state){this.set_invalid(rowId,false);this.updatedRows[ind]=rowId;this.obj.setUserData(rowId,this.action_param,mode);if(this._in_progress[rowId])
this._in_progress[rowId]="wait";}else{if(!this.is_invalid(rowId)){this.updatedRows.splice(ind,1);this.obj.setUserData(rowId,this.action_param,"");}}
if(!state)
this._clearUpdateFlag(rowId);this.markRow(rowId,state,mode);if(state&&this.autoUpdate)this.sendData(rowId);},_clearUpdateFlag:function(id){},markRow:function(id,state,mode){var str="";var invalid=this.is_invalid(id);if(invalid){str=this.styles[invalid];state=true;}
if(this.callEvent("onRowMark",[id,state,mode,invalid])){str=this.styles[state?mode:"clear"]+str;this.obj[this._methods[0]](id,str);if(invalid&&invalid.details){str+=this.styles[invalid+"_cell"];for(var i=0;i<invalid.details.length;i++)
if(invalid.details[i])
this.obj[this._methods[1]](id,i,str);}}},getState:function(id){return this.obj.getUserData(id,this.action_param);},is_invalid:function(id){return this._invalid[id];},set_invalid:function(id,mode,details){if(details)mode={value:mode,details:details,toString:function(){return this.value.toString();}};this._invalid[id]=mode;},checkBeforeUpdate:function(rowId){return true;},sendData:function(rowId){if(this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2))return;if(this.obj.editStop)this.obj.editStop();if(typeof rowId=="undefined"||this._tSend)return this.sendAllData();if(this._in_progress[rowId])return false;this.messages=[];if(!this.checkBeforeUpdate(rowId)&&this.callEvent("onValidationError",[rowId,this.messages]))return false;this._beforeSendData(this._getRowData(rowId),rowId);},_beforeSendData:function(data,rowId){if(!this.callEvent("onBeforeUpdate",[rowId,this.getState(rowId),data]))return false;this._sendData(data,rowId);},serialize:function(data,id){if(typeof data=="string")
return data;if(typeof id!="undefined")
return this.serialize_one(data,"");else{var stack=[];var keys=[];for(var key in data)
if(data.hasOwnProperty(key)){stack.push(this.serialize_one(data[key],key+this.post_delim));keys.push(key);}
stack.push("ids="+this.escape(keys.join(",")));if(dhtmlx.security_key)
stack.push("dhx_security="+dhtmlx.security_key);return stack.join("&");}},serialize_one:function(data,pref){if(typeof data=="string")
return data;var stack=[];for(var key in data)
if(data.hasOwnProperty(key)){if((key=="id"||key==this.action_param)&&this._tMode=="REST")continue;stack.push(this.escape((pref||"")+key)+"="+this.escape(data[key]));}
return stack.join("&");},_sendData:function(a1,rowId){if(!a1)return;if(!this.callEvent("onBeforeDataSending",rowId?[rowId,this.getState(rowId),a1]:[null,null,a1]))return false;if(rowId)
this._in_progress[rowId]=(new Date()).valueOf();var that=this;var back=function(xml){var ids=[];if(rowId)
ids.push(rowId);else if(a1)
for(var key in a1)
ids.push(key);return that.afterUpdate(that,xml,ids);};var a3=this.serverProcessor+(this._user?(dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&")):"");if(this._tMode=="GET")
dhx4.ajax.get(a3+((a3.indexOf("?")!=-1)?"&":"?")+this.serialize(a1,rowId),back);else if(this._tMode=="POST")
dhx4.ajax.post(a3,this.serialize(a1,rowId),back);else if(this._tMode=="REST"){var state=this.getState(rowId);var url=a3.replace(/(\&|\?)editing\=true/,"");var data="";var method="post";if(state=="inserted"){data=this.serialize(a1,rowId);}else if(state=="deleted"){method="DELETE";url=url+(url.slice(-1)=="/"?"":"/")+rowId;}else{method="PUT";data=this.serialize(a1,rowId);url=url+(url.slice(-1)=="/"?"":"/")+rowId;}
if(this._payload)
for(var key in this._payload)
url=url+dhtmlx.url(url)+this.escape(key)+"="+this.escape(this._payload[key]);dhx4.ajax.query({url:url,method:method,headers:this._headers,data:data,callback:back});}
this._waitMode++;},sendAllData:function(){if(!this.updatedRows.length)return;this.messages=[];var valid=true;for(var i=0;i<this.updatedRows.length;i++)
valid&=this.checkBeforeUpdate(this.updatedRows[i]);if(!valid&&!this.callEvent("onValidationError",["",this.messages]))return false;if(this._tSend)
this._sendData(this._getAllData());else
for(var i=0;i<this.updatedRows.length;i++)
if(!this._in_progress[this.updatedRows[i]]){if(this.is_invalid(this.updatedRows[i]))continue;this._beforeSendData(this._getRowData(this.updatedRows[i]),this.updatedRows[i]);if(this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2))return;}},_getAllData:function(rowId){var out={};var has_one=false;for(var i=0;i<this.updatedRows.length;i++){var id=this.updatedRows[i];if(this._in_progress[id]||this.is_invalid(id))continue;if(!this.callEvent("onBeforeUpdate",[id,this.getState(id),this._getRowData(id)]))continue;out[id]=this._getRowData(id,id+this.post_delim);has_one=true;this._in_progress[id]=(new Date()).valueOf();}
return has_one?out:null;},setVerificator:function(ind,verifFunction){this.mandatoryFields[ind]=verifFunction||(function(value){return(value!=="");});},clearVerificator:function(ind){this.mandatoryFields[ind]=false;},findRow:function(pattern){var i=0;for(i=0;i<this.updatedRows.length;i++)
if(pattern==this.updatedRows[i])break;return i;},defineAction:function(name,handler){if(!this._uActions)this._uActions=[];this._uActions[name]=handler;},afterUpdateCallback:function(sid,tid,action,btag){var marker=sid;var correct=(action!="error"&&action!="invalid");if(!correct)this.set_invalid(sid,action);if((this._uActions)&&(this._uActions[action])&&(!this._uActions[action](btag)))
return(delete this._in_progress[marker]);if(this._in_progress[marker]!="wait")
this.setUpdated(sid,false);var soid=sid;switch(action){case"inserted":case"insert":if(tid!=sid){this.obj[this._methods[2]](sid,tid);sid=tid;}
break;case"delete":case"deleted":this.obj.setUserData(sid,this.action_param,"true_deleted");this.obj[this._methods[3]](sid);delete this._in_progress[marker];return this.callEvent("onAfterUpdate",[sid,action,tid,btag]);break;}
if(this._in_progress[marker]!="wait"){if(correct)this.obj.setUserData(sid,this.action_param,'');delete this._in_progress[marker];}else{delete this._in_progress[marker];this.setUpdated(tid,true,this.obj.getUserData(sid,this.action_param));}
this.callEvent("onAfterUpdate",[soid,action,tid,btag]);},afterUpdate:function(that,xml,id){if(window.JSON){try{var tag=JSON.parse(xml.xmlDoc.responseText);var action=tag.action||this.getState(id)||"updated";var sid=tag.sid||id[0];var tid=tag.tid||id[0];that.afterUpdateCallback(sid,tid,action,tag);that.finalizeUpdate();return;}catch(e){}}
var top=dhx4.ajax.xmltop("data",xml.xmlDoc);if(!top)return this.cleanUpdate(id);var atag=dhx4.ajax.xpath("//data/action",top);if(!atag.length)return this.cleanUpdate(id);for(var i=0;i<atag.length;i++){var btag=atag[i];var action=btag.getAttribute("type");var sid=btag.getAttribute("sid");var tid=btag.getAttribute("tid");that.afterUpdateCallback(sid,tid,action,btag);}
that.finalizeUpdate();},cleanUpdate:function(id){if(id)
for(var i=0;i<id.length;i++)
delete this._in_progress[id[i]];},finalizeUpdate:function(){if(this._waitMode)this._waitMode--;if((this.obj.mytype=="tree"||this.obj._h2)&&this.updatedRows.length)
this.sendData();this.callEvent("onAfterUpdateFinish",[]);if(!this.updatedRows.length)
this.callEvent("onFullSync",[]);},init:function(anObj){this.obj=anObj;if(this.obj._dp_init)
this.obj._dp_init(this);},setOnAfterUpdate:function(ev){this.attachEvent("onAfterUpdate",ev);},enableDebug:function(mode){},setOnBeforeUpdateHandler:function(func){this.attachEvent("onBeforeDataSending",func);},setAutoUpdate:function(interval,user){interval=interval||2000;this._user=user||(new Date()).valueOf();this._need_update=false;this._loader=null;this._update_busy=false;this.attachEvent("onAfterUpdate",function(sid,action,tid,xml_node){this.afterAutoUpdate(sid,action,tid,xml_node);});this.attachEvent("onFullSync",function(){this.fullSync();});var self=this;window.setInterval(function(){self.loadUpdate();},interval);},afterAutoUpdate:function(sid,action,tid,xml_node){if(action=='collision'){this._need_update=true;return false;}else{return true;}},fullSync:function(){if(this._need_update==true){this._need_update=false;this.loadUpdate();}
return true;},getUpdates:function(url,callback){if(this._update_busy)
return false;else
this._update_busy=true;this._loader=this._loader||new dtmlXMLLoaderObject(true);this._loader.async=true;this._loader.waitCall=callback;this._loader.loadXML(url);},_v:function(node){if(node.firstChild)return node.firstChild.nodeValue;return"";},_a:function(arr){var res=[];for(var i=0;i<arr.length;i++){res[i]=this._v(arr[i]);};return res;},loadUpdate:function(){var self=this;var version=this.obj.getUserData(0,"version");var url=this.serverProcessor+dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+version].join("&");url=url.replace("editing=true&","");this.getUpdates(url,function(){var vers=self._loader.doXPath("//userdata");self.obj.setUserData(0,"version",self._v(vers[0]));var upds=self._loader.doXPath("//update");if(upds.length){self._silent_mode=true;for(var i=0;i<upds.length;i++){var status=upds[i].getAttribute('status');var id=upds[i].getAttribute('id');var parent=upds[i].getAttribute('parent');switch(status){case'inserted':self.callEvent("insertCallback",[upds[i],id,parent]);break;case'updated':self.callEvent("updateCallback",[upds[i],id,parent]);break;case'deleted':self.callEvent("deleteCallback",[upds[i],id,parent]);break;}}
self._silent_mode=false;}
self._update_busy=false;self=null;});}};gantt._init_dp_live_update_hooks=function(dp){dp.attachEvent("insertCallback",gantt._insert_callback);dp.attachEvent("updateCallback",gantt._update_callback);dp.attachEvent("deleteCallback",gantt._delete_callback);};gantt._update_callback=function(upd,id){var data=upd.data||gantt.xml._xmlNodeToJSON(upd.firstChild);if(!gantt.isTaskExists(id))
return;var objData=gantt.getTask(id);for(var key in data){var property=data[key];switch(key){case"id":continue;break;case"start_date":case"end_date":property=gantt.templates.xml_date(property);break;case"duration":objData.end_date=gantt.calculateEndDate(objData.start_date,property);break;}
objData[key]=property;}
gantt.updateTask(id);gantt.refreshData();};gantt._insert_callback=function(upd,id,parent,mode){var data=upd.data||gantt.xml._xmlNodeToJSON(upd.firstChild),methods={add:gantt.addTask,isExist:gantt.isTaskExists};if(mode=="links"){methods.add=gantt.addLink;methods.isExist=gantt.isLinkExists;}
if(methods.isExist.call(gantt,id))
return;data.id=id;methods.add.call(gantt,data)};gantt._delete_callback=function(upd,id,parent,mode){var methods={delete:gantt.deleteTask,isExist:gantt.isTaskExists};if(mode=="links"){methods.delete=gantt.deleteLink;methods.isExist=gantt.isLinkExists;}
if(methods.isExist.call(gantt,id))
methods.delete.call(gantt,id);};dhtmlx.assert=function(check,message){if(!check){if(gantt.config.show_errors&&gantt.callEvent("onError",[message])!==false){dhtmlx.message({type:"error",text:message,expire:-1});debugger;}}};gantt.init=function(node,from,to){this.callEvent("onBeforeGanttReady",[]);if(from&&to){this.config.start_date=this._min_date=new Date(from);this.config.end_date=this._max_date=new Date(to);}
this._init_skin();this.date.init();if(!this.config.scroll_size)
this.config.scroll_size=this._detectScrollSize();dhtmlxEvent(window,"resize",this._on_resize);this.init=function(node){if(this.$container&&this.$container.parentNode){this.$container.parentNode.removeChild(this.$container);this.$container=null;}
this._reinit(node);};this._reinit(node);};gantt._reinit=function(node){this._init_html_area(node);this._set_sizes();this._clear_renderers();this.resetLightbox();this._update_flags();this._init_touch_events();this._init_templates();this._init_grid();this._init_tasks();this._set_scroll_events();dhtmlxEvent(this.$container,"click",this._on_click);dhtmlxEvent(this.$container,"dblclick",this._on_dblclick);dhtmlxEvent(this.$container,"mousemove",this._on_mousemove);dhtmlxEvent(this.$container,"contextmenu",this._on_contextmenu);this.callEvent("onGanttReady",[]);this.render();};gantt._init_html_area=function(node){if(typeof node=="string")
this._obj=document.getElementById(node);else
this._obj=node;dhtmlx.assert(this._obj,"Invalid html container: "+node);var html="<div class='gantt_container'><div class='gantt_grid'></div><div class='gantt_task'></div>";html+="<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>";this._obj.innerHTML=html;this.$container=this._obj.firstChild;var childs=this.$container.childNodes;this.$grid=childs[0];this.$task=childs[1];this.$scroll_ver=childs[2];this.$scroll_hor=childs[3];this.$grid.innerHTML="<div class='gantt_grid_scale'></div><div class='gantt_grid_data'></div>";this.$grid_scale=this.$grid.childNodes[0];this.$grid_data=this.$grid.childNodes[1];this.$task.innerHTML="<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>";this.$task_scale=this.$task.childNodes[0];this.$task_data=this.$task.childNodes[1];this.$task_bg=this.$task_data.childNodes[0];this.$task_links=this.$task_data.childNodes[1];this.$task_bars=this.$task_data.childNodes[2];};gantt.$click={buttons:{"edit":function(id){gantt.showLightbox(id);},"delete":function(id){var question=gantt.locale.labels.confirm_deleting;var title=gantt.locale.labels.confirm_deleting_title;gantt._dhtmlx_confirm(question,title,function(){var task=gantt.getTask(id);if(task.$new){gantt._deleteTask(id,true);gantt.refreshData();}else{gantt.deleteTask(id);}
gantt.hideLightbox();});}}};gantt._calculate_content_height=function(){var scale_height=this.config.scale_height,rows_height=this._order.length*this.config.row_height,hor_scroll_height=this._scroll_hor?this.config.scroll_size+1:0;if(!(this._is_grid_visible()||this._is_chart_visible())){return 0;}else{return scale_height+rows_height+2+hor_scroll_height;}};gantt._calculate_content_width=function(){var grid_width=this._get_grid_width(),chart_width=this._tasks?this._tasks.full_width:0,ver_scroll_width=this._scroll_ver?this.config.scroll_size+1:0;if(!this._is_chart_visible()){chart_width=0;}
if(!this._is_grid_visible()){grid_width=0;}
return grid_width+chart_width+1;};gantt._get_resize_options=function(){var res={x:false,y:false};if(this.config.autosize=="xy"){res.x=res.y=true;}else if(this.config.autosize=="y"||this.config.autosize===true){res.y=true;}else if(this.config.autosize=="x"){res.x=true;}
return res;};gantt._clean_el_size=function(value){return((value||"").toString().replace("px","")*1||0);};gantt._get_box_styles=function(){var computed=null;if(window.getComputedStyle){computed=window.getComputedStyle(this._obj,null);}else{computed={"width":this._obj.clientWidth,"height":this._obj.clientHeight};}
var properties=["width","height","paddingTop","paddingBottom","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];var styles={boxSizing:(computed.boxSizing=="border-box")};if(computed.MozBoxSizing){styles.boxSizing=(computed.MozBoxSizing=="border-box");}
for(var i=0;i<properties.length;i++){styles[properties[i]]=computed[properties[i]]?this._clean_el_size(computed[properties[i]]):0;}
var box={horPaddings:(styles.paddingLeft+styles.paddingRight+styles.borderLeftWidth+styles.borderRightWidth),vertPaddings:(styles.paddingTop+styles.paddingBottom+styles.borderTopWidth+styles.borderBottomWidth),borderBox:styles.boxSizing,innerWidth:styles.width,innerHeight:styles.height,outerWidth:styles.width,outerHeight:styles.height};if(box.borderBox){box.innerWidth-=box.horPaddings;box.innerHeight-=box.vertPaddings;}else{box.outerWidth+=box.horPaddings;box.outerHeight+=box.vertPaddings;}
return box;};gantt._do_autosize=function(){var resize=this._get_resize_options();var boxSizes=this._get_box_styles();if(resize.y){var reqHeight=this._calculate_content_height();if(boxSizes.borderBox){reqHeight+=boxSizes.vertPaddings;}
this._obj.style.height=reqHeight+'px';}
if(resize.x){var reqWidth=this._calculate_content_width();if(boxSizes.borderBox){reqWidth+=boxSizes.horPaddings;}
this._obj.style.width=reqWidth+'px';}};gantt._set_sizes=function(){this._do_autosize();var boxSizes=this._get_box_styles();this._y=boxSizes.innerHeight;if(this._y<20)return;this.$grid.style.height=this.$task.style.height=Math.max(this._y-this.$scroll_hor.offsetHeight-2,0)+"px";var dataHeight=Math.max((this._y-(this.config.scale_height||0)-this.$scroll_hor.offsetHeight-2),0);this.$grid_data.style.height=this.$task_data.style.height=dataHeight+"px";var gridWidth=Math.max(this._get_grid_width()-1,0);this.$grid.style.width=gridWidth+"px";this.$grid.style.display=gridWidth===0?'none':'';boxSizes=this._get_box_styles();this._x=boxSizes.innerWidth;if(this._x<20)return;this.$grid_data.style.width=Math.max(this._get_grid_width()-1,0)+"px";this.$task.style.width=Math.max(this._x-this._get_grid_width()-2,0)+"px";};gantt.getScrollState=function(){if(this.$task&&this.$task_data)
return{x:this.$task.scrollLeft,y:this.$task_data.scrollTop};else
return null;};gantt._save_scroll_state=function(x,y){var pos={};this._cached_scroll_pos=this._cached_scroll_pos||{};if(x!==undefined){pos.x=Math.max(x,0);}
if(y!==undefined){pos.y=Math.max(y,0);}
dhtmlx.mixin(this._cached_scroll_pos,pos,true);};gantt._restore_scroll_state=function(){return this._cached_scroll_pos||null;};gantt.scrollTo=function(left,top){if(left*1==left){this.$task.scrollLeft=left;this._save_scroll_state(left,undefined);}
if(top*1==top){this.$task_data.scrollTop=top;this.$grid_data.scrollTop=top;this._save_scroll_state(undefined,top);}
var scroll=gantt._restore_scroll_state()||{x:0,y:0};this.callEvent("onGanttScroll",[scroll.x,scroll.y]);};gantt.showDate=function(date){var date_x=this.posFromDate(date);var scroll_to=Math.max(date_x-this.config.task_scroll_offset,0);this.scrollTo(scroll_to);};gantt.showTask=function(id){var el=this.getTaskNode(id);if(!el)
return;var left=Math.max(el.offsetLeft-this.config.task_scroll_offset,0);var top=el.offsetTop-(this.$task_data.offsetHeight-this.config.row_height)/2;this.scrollTo(left,top);};gantt._on_resize=gantt.setSizes=function(){gantt._set_sizes();gantt._scroll_resize();};gantt.render=function(){if(!this._is_render_active())
return;this.callEvent("onBeforeGanttRender",[]);var pos=dhtmlx.copy(this._restore_scroll_state());var visible_date=null;if(pos){visible_date=gantt.dateFromPos(pos.x+this.config.task_scroll_offset);}
this._render_grid();this._render_tasks_scales();this._scroll_resize();this._on_resize();this._render_data();if(this.config.preserve_scroll&&pos){var new_pos=gantt._restore_scroll_state();var new_date=gantt.dateFromPos(new_pos.x);if(!(+visible_date==+new_date&&new_pos.y==pos.y)){if(visible_date){this.showDate(visible_date);}
gantt.scrollTo(undefined,pos.y);}}
this.callEvent("onGanttRender",[]);};gantt._set_scroll_events=function(){dhtmlxEvent(this.$scroll_hor,"scroll",function(){if((new Date())-(gantt._wheel_time||0)<100)return true;if(gantt._touch_scroll_active)return;var left=gantt.$scroll_hor.scrollLeft;gantt.scrollTo(left);});dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(gantt._touch_scroll_active)return;var top=gantt.$scroll_ver.scrollTop;gantt.$grid_data.scrollTop=top;gantt.scrollTo(null,top);});dhtmlxEvent(this.$task,"scroll",function(){var left=gantt.$task.scrollLeft,barLeft=gantt.$scroll_hor.scrollLeft;if(barLeft!=left)
gantt.$scroll_hor.scrollLeft=left;});dhtmlxEvent(this.$task_data,"scroll",function(){var top=gantt.$task_data.scrollTop,barTop=gantt.$scroll_ver.scrollTop;if(barTop!=top)
gantt.$scroll_ver.scrollTop=top;});var ff=_isFF&&!window._KHTMLrv;function onMouseWheel(e){var res=gantt._get_resize_options();gantt._wheel_time=new Date();var wx=ff?(e.deltaX*-20):e.wheelDeltaX*2;var wy=ff?(e.deltaY*-40):e.wheelDelta;if(wx&&Math.abs(wx)>Math.abs(wy)){if(res.x)return true;var dir=wx/-40;var left=gantt.$task.scrollLeft+dir*30;gantt.scrollTo(left,null);gantt.$scroll_hor.scrollTop=top;}else{if(res.y)return true;var dir=wy/-40;if(typeof wy=="undefined")
dir=e.detail;var top=gantt.$scroll_ver.scrollTop+dir*30;if(!gantt.config.prevent_default_scroll&&gantt._cached_scroll_pos&&gantt._cached_scroll_pos.y==top)return true;gantt.scrollTo(null,top);gantt.$scroll_ver.scrollTop=top;}
if(e.preventDefault)
e.preventDefault();e.cancelBubble=true;return false;}
if(ff)
dhtmlxEvent(gantt.$container,"wheel",onMouseWheel);else
dhtmlxEvent(gantt.$container,"mousewheel",onMouseWheel);};gantt._scroll_resize=function(){if(this._x<20||this._y<20)return;var grid_width=this._get_grid_width();var task_width=Math.max(this._x-grid_width,0);var task_height=Math.max(this._y-this.config.scale_height,0);var scroll_size=this.config.scroll_size+1;var task_data_width=Math.max(this.$task_data.offsetWidth-scroll_size,0);var task_data_height=this.config.row_height*this._order.length;var resize=this._get_resize_options();var scroll_hor=this._scroll_hor=resize.x?false:(task_data_width>task_width);var scroll_ver=this._scroll_ver=resize.y?false:(task_data_height>task_height);this.$scroll_hor.style.display=scroll_hor?"block":"none";this.$scroll_hor.style.height=(scroll_hor?scroll_size:0)+"px";this.$scroll_hor.style.width=Math.max((this._x-(scroll_ver?scroll_size:2)),0)+"px";this.$scroll_hor.firstChild.style.width=(task_data_width+grid_width+scroll_size+2)+"px";this.$scroll_ver.style.display=scroll_ver?"block":"none";this.$scroll_ver.style.width=(scroll_ver?scroll_size:0)+"px";this.$scroll_ver.style.height=Math.max((this._y-(scroll_hor?scroll_size:0)-this.config.scale_height),0)+"px";this.$scroll_ver.style.top=this.config.scale_height+"px";this.$scroll_ver.firstChild.style.height=(this.config.scale_height+task_data_height)+"px";};gantt._getClassName=function(node){if(!node)return"";var className=node.className||"";if(className.baseVal)
className=className.baseVal;if(!className.indexOf)
className='';return gantt._trim(className);};gantt.locate=function(e){var trg=gantt._get_target_node(e);var className=gantt._getClassName(trg);if((className||"").indexOf("gantt_task_cell")>=0)return null;var attribute=arguments[1]||this.config.task_attribute;while(trg){if(trg.getAttribute){var test=trg.getAttribute(attribute);if(test)return test;}
trg=trg.parentNode;}
return null;};gantt._get_target_node=function(e){var trg;if(e.tagName)
trg=e;else{e=e||window.event;trg=e.target||e.srcElement;}
return trg;};gantt._trim=function(str){var func=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"");};return func.apply(str);};gantt._locate_css=function(e,classname,strict){if(strict===undefined)
strict=true;var trg=gantt._get_target_node(e);var css='';var test=false;while(trg){css=gantt._getClassName(trg);if(css){var ind=css.indexOf(classname);if(ind>=0){if(!strict)
return trg;var left=(ind===0)||(!gantt._trim(css.charAt(ind-1)));var right=((ind+classname.length>=css.length))||(!gantt._trim(css.charAt(ind+classname.length)));if(left&&right)
return trg;}}
trg=trg.parentNode;}
return null;};gantt._locateHTML=function(e,attribute){var trg=gantt._get_target_node(e);attribute=attribute||this.config.task_attribute;while(trg){if(trg.getAttribute){var test=trg.getAttribute(attribute);if(test)return trg;}
trg=trg.parentNode;}
return null;};gantt.getTaskRowNode=function(id){var els=this.$grid_data.childNodes;var attribute=this.config.task_attribute;for(var i=0;i<els.length;i++){if(els[i].getAttribute){var value=els[i].getAttribute(attribute);if(value==id)return els[i];}}
return null;};gantt.getState=function(){return{drag_id:this._tasks_dnd.drag.id,drag_mode:this._tasks_dnd.drag.mode,drag_from_start:this._tasks_dnd.drag.left,selected_task:this._selected_task,min_date:new Date(this._min_date),max_date:new Date(this._max_date),lightbox:this._lightbox_id,touch_drag:this._touch_drag};};gantt._checkTimeout=function(host,updPerSecond){if(!updPerSecond)
return true;var timeout=1000/updPerSecond;if(timeout<1)return true;if(host._on_timeout)
return false;setTimeout(function(){delete host._on_timeout;},timeout);host._on_timeout=true;return true;};gantt.selectTask=function(id){if(!this.config.select_task)
return false;if(id){if(this._selected_task==id)
return this._selected_task;if(!this.callEvent("onBeforeTaskSelected",[id])){return false;}
this.unselectTask();this._selected_task=id;this.refreshTask(id);this.callEvent("onTaskSelected",[id]);}
return this._selected_task;};gantt.unselectTask=function(id){var id=id||this._selected_task;if(!id)
return;this._selected_task=null;this.refreshTask(id);this.callEvent("onTaskUnselected",[id]);};gantt.getSelectedId=function(){return dhtmlx.defined(this._selected_task)?this._selected_task:null;};gantt.changeLightboxType=function(type){if(this.getLightboxType()==type)
return true;gantt._silent_redraw_lightbox(type);};gantt._is_render_active=function(){return!this._skip_render;};gantt._correct_dst_change=function(date,prevOffset,step,unit){var time_unit=gantt._get_line(unit)*step;if(time_unit>60*60&&time_unit<60*60*24){var offsetChanged=date.getTimezoneOffset()-prevOffset;if(offsetChanged){date=gantt.date.add(date,offsetChanged,"minute");}}
return date;};gantt.batchUpdate=function(callback){var call_dp=(this._dp&&this._dp.updateMode!="off");var dp_mode;if(call_dp){dp_mode=this._dp.updateMode;this._dp.setUpdateMode("off");}
this._skip_render=true;try{callback();}catch(e){}
this._skip_render=false;this.render();if(call_dp){this._dp.setUpdateMode(dp_mode);this._dp.sendData();}};gantt.date={init:function(){var s=gantt.locale.date.month_short;var t=gantt.locale.date.month_short_hash={};for(var i=0;i<s.length;i++)
t[s[i]]=i;var s=gantt.locale.date.month_full;var t=gantt.locale.date.month_full_hash={};for(var i=0;i<s.length;i++)
t[s[i]]=i;},date_part:function(date){var old=new Date(date);date.setHours(0);this.hour_start(date);if(date.getHours()&&(date.getDate()<old.getDate()||date.getMonth()<old.getMonth()||date.getFullYear()<old.getFullYear()))
date.setTime(date.getTime()+60*60*1000*(24-date.getHours()));return date;},time_part:function(date){return(date.valueOf()/1000-date.getTimezoneOffset()*60)%86400;},week_start:function(date){var shift=date.getDay();if(gantt.config.start_on_monday){if(shift===0)shift=6;else shift--;}
return this.date_part(this.add(date,-1*shift,"day"));},month_start:function(date){date.setDate(1);return this.date_part(date);},year_start:function(date){date.setMonth(0);return this.month_start(date);},day_start:function(date){return this.date_part(date);},hour_start:function(date){if(date.getMinutes())
date.setMinutes(0);this.minute_start(date);return date;},minute_start:function(date){if(date.getSeconds())
date.setSeconds(0);if(date.getMilliseconds())
date.setMilliseconds(0);return date;},_add_days:function(date,inc){var ndate=new Date(date.valueOf());ndate.setDate(ndate.getDate()+inc);if(inc>=0&&(!date.getHours()&&ndate.getHours())&&(ndate.getDate()<=date.getDate()||ndate.getMonth()<date.getMonth()||ndate.getFullYear()<date.getFullYear()))
ndate.setTime(ndate.getTime()+60*60*1000*(24-ndate.getHours()));return ndate;},add:function(date,inc,mode){var ndate=new Date(date.valueOf());switch(mode){case"day":ndate=gantt.date._add_days(ndate,inc);break;case"week":ndate=gantt.date._add_days(ndate,inc*7);break;case"month":ndate.setMonth(ndate.getMonth()+inc);break;case"year":ndate.setYear(ndate.getFullYear()+inc);break;case"hour":ndate.setTime(ndate.getTime()+inc*60*60*1000);break;case"minute":ndate.setTime(ndate.getTime()+inc*60*1000);break;default:return gantt.date["add_"+mode](date,inc,mode);}
return ndate;},to_fixed:function(num){if(num<10)return"0"+num;return num;},copy:function(date){return new Date(date.valueOf());},date_to_str:function(format,utc){format=format.replace(/%[a-zA-Z]/g,function(a){switch(a){case"%d":return"\"+gantt.date.to_fixed(date.getDate())+\"";case"%m":return"\"+gantt.date.to_fixed((date.getMonth()+1))+\"";case"%j":return"\"+date.getDate()+\"";case"%n":return"\"+(date.getMonth()+1)+\"";case"%y":return"\"+gantt.date.to_fixed(date.getFullYear()%100)+\"";case"%Y":return"\"+date.getFullYear()+\"";case"%D":return"\"+gantt.locale.date.day_short[date.getDay()]+\"";case"%l":return"\"+gantt.locale.date.day_full[date.getDay()]+\"";case"%M":return"\"+gantt.locale.date.month_short[date.getMonth()]+\"";case"%F":return"\"+gantt.locale.date.month_full[date.getMonth()]+\"";case"%h":return"\"+gantt.date.to_fixed((date.getHours()+11)%12+1)+\"";case"%g":return"\"+((date.getHours()+11)%12+1)+\"";case"%G":return"\"+date.getHours()+\"";case"%H":return"\"+gantt.date.to_fixed(date.getHours())+\"";case"%i":return"\"+gantt.date.to_fixed(date.getMinutes())+\"";case"%a":return"\"+(date.getHours()>11?\"pm\":\"am\")+\"";case"%A":return"\"+(date.getHours()>11?\"PM\":\"AM\")+\"";case"%s":return"\"+gantt.date.to_fixed(date.getSeconds())+\"";case"%W":return"\"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+\"";default:return a;}});if(utc)format=format.replace(/date\.get/g,"date.getUTC");return new Function("date","return \""+format+"\";");},str_to_date:function(format,utc){var splt="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);";var mask=format.match(/%[a-zA-Z]/g);for(var i=0;i<mask.length;i++){switch(mask[i]){case"%j":case"%d":splt+="set[2]=temp["+i+"]||1;";break;case"%n":case"%m":splt+="set[1]=(temp["+i+"]||1)-1;";break;case"%y":splt+="set[0]=temp["+i+"]*1+(temp["+i+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":splt+="set[3]=temp["+i+"]||0;";break;case"%i":splt+="set[4]=temp["+i+"]||0;";break;case"%Y":splt+="set[0]=temp["+i+"]||0;";break;case"%a":case"%A":splt+="set[3]=set[3]%12+((temp["+i+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":splt+="set[5]=temp["+i+"]||0;";break;case"%M":splt+="set[1]=gantt.locale.date.month_short_hash[temp["+i+"]]||0;";break;case"%F":splt+="set[1]=gantt.locale.date.month_full_hash[temp["+i+"]]||0;";break;default:break;}}
var code="set[0],set[1],set[2],set[3],set[4],set[5]";if(utc)code=" Date.UTC("+code+")";return new Function("date","var set=[0,0,1,0,0,0]; "+splt+" return new Date("+code+");");},getISOWeek:function(ndate){if(!ndate)return false;var nday=ndate.getDay();if(nday===0){nday=7;}
var first_thursday=new Date(ndate.valueOf());first_thursday.setDate(ndate.getDate()+(4-nday));var year_number=first_thursday.getFullYear();var ordinal_date=Math.round((first_thursday.getTime()-new Date(year_number,0,1).getTime())/86400000);var week_number=1+Math.floor(ordinal_date/7);return week_number;},getUTCISOWeek:function(ndate){return this.getISOWeek(ndate);},convert_to_utc:function(date){return new Date(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds());},parseDate:function(date,format){if(typeof(date)=="string"){if(dhtmlx.defined(format)){if(typeof(format)=="string")
format=dhtmlx.defined(gantt.templates[format])?gantt.templates[format]:gantt.date.str_to_date(format);else
format=gantt.templates.xml_date;}
if(date)
date=format(date);else
date=null;}
return date;}};gantt.date.quarter_start=function(date){gantt.date.month_start(date);var m=date.getMonth(),res_month;if(m>=9){res_month=9;}else if(m>=6){res_month=6;}else if(m>=3){res_month=3;}else{res_month=0;}
date.setMonth(res_month);return date;};gantt.date.add_quarter=function(date,inc){return gantt.date.add(date,inc*3,"month");};if(!gantt.config)gantt.config={};if(!gantt.config)gantt.config={};if(!gantt.templates)gantt.templates={};(function(){dhtmlx.mixin(gantt.config,{links:{"finish_to_start":"0","start_to_start":"1","finish_to_finish":"2","start_to_finish":"3"},types:{'task':'task','project':'project','milestone':'milestone'},duration_unit:"day",work_time:false,correct_work_time:false,skip_off_time:false,autosize:false,autosize_min_width:0,show_links:true,show_task_cells:true,static_background:false,branch_loading:false,show_loading:false,show_chart:true,show_grid:true,min_duration:60*60*1000,xml_date:"%d-%m-%Y %H:%i",api_date:"%d-%m-%Y %H:%i",start_on_monday:true,server_utc:false,show_progress:true,fit_tasks:false,select_task:true,scroll_on_click:true,preserve_scroll:true,readonly:false,date_grid:"%Y-%m-%d",drag_links:true,drag_progress:true,drag_resize:true,drag_move:true,drag_mode:{"resize":"resize","progress":"progress","move":"move","ignore":"ignore"},round_dnd_dates:true,link_wrapper_width:20,root_id:0,autofit:false,columns:[{name:"text",tree:true,width:'*',resize:true},{name:"start_date",align:"center",resize:true},{name:"duration",align:"center"},{name:"add",width:'44'}],step:1,scale_unit:"day",scale_offset_minimal:true,subscales:[],inherit_scale_class:false,time_step:60,duration_step:1,date_scale:"%d %M",task_date:"%d %F %Y",time_picker:"%H:%i",task_attribute:"task_id",link_attribute:"link_id",layer_attribute:"data-layer",buttons_left:["gantt_save_btn","gantt_cancel_btn"],_migrate_buttons:{"dhx_save_btn":"gantt_save_btn","dhx_cancel_btn":"gantt_cancel_btn","dhx_delete_btn":"gantt_delete_btn"},buttons_right:["gantt_delete_btn"],lightbox:{sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:true},{name:"time",type:"duration",map_to:"auto"}],project_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:true},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",readonly:true,map_to:"auto"}],milestone_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:true},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",single_date:true,map_to:"auto"}]},drag_lightbox:true,sort:false,details_on_create:true,details_on_dblclick:true,initial_scroll:true,task_scroll_offset:100,order_branch:false,order_branch_free:false,task_height:"full",min_column_width:70,min_grid_column_width:70,grid_resizer_column_attribute:"column_index",grid_resizer_attribute:"grid_resizer",keep_grid_width:false,grid_resize:false,show_unscheduled:true,readonly_property:"readonly",editable_property:"editable",type_renderers:{},open_tree_initially:false,optimize_render:'auto',prevent_default_scroll:false,show_errors:true});gantt.keys={edit_save:13,edit_cancel:27};gantt._init_template=function(name,initial,template_name){var registeredTemplates=this._reg_templates||{};template_name=template_name||name;if(this.config[name]&&registeredTemplates[template_name]!=this.config[name]){if(!(initial&&this.templates[template_name])){this.templates[template_name]=this.date.date_to_str(this.config[name]);registeredTemplates[template_name]=this.config[name];}}
this._reg_templates=registeredTemplates;};gantt._init_templates=function(){var labels=gantt.locale.labels;labels.gantt_save_btn=labels.icon_save;labels.gantt_cancel_btn=labels.icon_cancel;labels.gantt_delete_btn=labels.icon_delete;var d=this.date.date_to_str;var c=this.config;gantt._init_template("date_scale",true);gantt._init_template("date_grid",true,"grid_date_format");gantt._init_template("task_date",true);dhtmlx.mixin(this.templates,{xml_date:this.date.str_to_date(c.xml_date,c.server_utc),xml_format:d(c.xml_date,c.server_utc),api_date:this.date.str_to_date(c.api_date),progress_text:function(start,end,task){return"";},grid_header_class:function(column,config){return"";},task_text:function(start,end,task){return task.text;},task_class:function(start,end,task){return"";},grid_row_class:function(start,end,task){return"";},task_row_class:function(start,end,task){return"";},task_cell_class:function(item,date){return"";},scale_cell_class:function(date){return"";},scale_row_class:function(date){return"";},grid_indent:function(item){return"<div class='gantt_tree_indent'></div>";},grid_folder:function(item){return"<div class='gantt_tree_icon gantt_folder_"+(item.$open?"open":"closed")+"'></div>";},grid_file:function(item){return"<div class='gantt_tree_icon gantt_file'></div>";},grid_open:function(item){return"<div class='gantt_tree_icon gantt_"+(item.$open?"close":"open")+"'></div>";},grid_blank:function(item){return"<div class='gantt_tree_icon gantt_blank'></div>";},date_grid:function(date,item){if(item&&gantt.isUnscheduledTask(item)&&gantt.config.show_unscheduled){return gantt.templates.task_unscheduled_time(item);}else{return gantt.templates.grid_date_format(date);}},task_time:function(start,end,ev){if(gantt.isUnscheduledTask(ev)&&gantt.config.show_unscheduled){return gantt.templates.task_unscheduled_time(ev);}else{return gantt.templates.task_date(start)+" - "+gantt.templates.task_date(end);}},task_unscheduled_time:function(task){return"";},time_picker:d(c.time_picker),link_class:function(link){return"";},link_description:function(link){var from=gantt.getTask(link.source),to=gantt.getTask(link.target);return"<b>"+from.text+"</b> &ndash;  <b>"+to.text+"</b>";},drag_link:function(from,from_start,to,to_start){from=gantt.getTask(from);var labels=gantt.locale.labels;var text="<b>"+from.text+"</b> "+(from_start?labels.link_start:labels.link_end)+"<br/>";if(to){to=gantt.getTask(to);text+="<b> "+to.text+"</b> "+(to_start?labels.link_start:labels.link_end)+"<br/>";}
return text;},drag_link_class:function(from,from_start,to,to_start){var add="";if(from&&to){var allowed=gantt.isLinkAllowed(from,to,from_start,to_start);add=" "+(allowed?"gantt_link_allow":"gantt_link_deny");}
return"gantt_link_tooltip"+add;}});this.callEvent("onTemplatesReady",[]);};})();if(window.jQuery){(function($){var methods=[];$.fn.dhx_gantt=function(config){config=config||{};if(typeof(config)==='string'){if(methods[config]){return methods[config].apply(this,[]);}else{$.error('Method '+config+' does not exist on jQuery.dhx_gantt');}}else{var views=[];this.each(function(){if(this&&this.getAttribute){if(!this.getAttribute("dhxgantt")){for(var key in config)
if(key!="data")
gantt.config[key]=config[key];gantt.init(this);if(config.data)
gantt.parse(config.data);views.push(gantt);}}});if(views.length===1)return views[0];return views;}};})(jQuery);}
if(window.dhtmlx){if(!dhtmlx.attaches)
dhtmlx.attaches={};dhtmlx.attaches.attachGantt=function(start,end){var obj=document.createElement("DIV");obj.id="gantt_"+dhtmlx.uid();obj.style.width="100%";obj.style.height="100%";obj.cmp="grid";document.body.appendChild(obj);this.attachObject(obj.id);var that=this.vs[this.av];that.grid=gantt;gantt.init(obj.id,start,end);obj.firstChild.style.border="none";that.gridId=obj.id;that.gridObj=obj;var method_name="_viewRestore";return this.vs[this[method_name]()].grid;};}
gantt.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{new_task:"New task",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Task will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}};gantt.skins.skyblue={config:{grid_width:350,row_height:27,scale_height:27,link_line_width:1,link_arrow_size:8,lightbox_additional_height:75},_second_column_width:95,_third_column_width:80};gantt.skins.meadow={config:{grid_width:350,row_height:27,scale_height:30,link_line_width:2,link_arrow_size:6,lightbox_additional_height:72},_second_column_width:95,_third_column_width:80};gantt.skins.terrace={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:2,link_arrow_size:6,lightbox_additional_height:75},_second_column_width:90,_third_column_width:70};gantt.skins.broadway={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:1,link_arrow_size:7,lightbox_additional_height:86},_second_column_width:90,_third_column_width:80,_lightbox_template:"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>",_config_buttons_left:{},_config_buttons_right:{"gantt_delete_btn":"icon_delete","gantt_save_btn":"icon_save"}};gantt.config.touch_drag=500;gantt.config.touch=true;gantt.config.touch_feedback=true;gantt._touch_feedback=function(){if(gantt.config.touch_feedback){if(navigator.vibrate)
navigator.vibrate(1);}};gantt._init_touch_events=function(){if(this.config.touch!="force")
this.config.touch=this.config.touch&&((navigator.userAgent.indexOf("Mobile")!=-1)||(navigator.userAgent.indexOf("iPad")!=-1)||(navigator.userAgent.indexOf("Android")!=-1)||(navigator.userAgent.indexOf("Touch")!=-1));if(this.config.touch){if(window.navigator.msPointerEnabled){this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(ev){if(ev.pointerType==ev.MSPOINTER_TYPE_MOUSE)return null;return ev;},function(ev){return(!ev||ev.pointerType==ev.MSPOINTER_TYPE_MOUSE);});}else
this._touch_events(["touchmove","touchstart","touchend"],function(ev){if(ev.touches&&ev.touches.length>1)return null;if(ev.touches[0])
return{target:ev.target,pageX:ev.touches[0].pageX,pageY:ev.touches[0].pageY,clientX:ev.touches[0].clientX,clientY:ev.touches[0].clientY};else
return ev;},function(){return false;});}};gantt._touch_events=function(names,accessor,ignore){var dblclicktime=0;var action_mode=false;var scroll_mode=false;var dblclick_timer=0;var action_start=null;var scroll_state;var long_tap_timer=null;var current_target=null;if(!this._gantt_touch_event_ready){this._gantt_touch_event_ready=1;dhtmlxEvent(gantt.$container,names[0],function(e){if(ignore(e))return;if(!action_mode)return;if(long_tap_timer)clearTimeout(long_tap_timer);var source=accessor(e);if(gantt._tasks_dnd.drag.id||gantt._tasks_dnd.drag.start_drag){gantt._tasks_dnd.on_mouse_move(source);if(e.preventDefault)
e.preventDefault();e.cancelBubble=true;return false;}
if(source&&action_start){var dx=action_start.pageX-source.pageX;var dy=action_start.pageY-source.pageY;if(!scroll_mode&&(Math.abs(dx)>5||Math.abs(dy)>5)){gantt._touch_scroll_active=scroll_mode=true;dblclicktime=0;scroll_state=gantt.getScrollState();}
if(scroll_mode){gantt.scrollTo(scroll_state.x+dx,scroll_state.y+dy);var new_scroll_state=gantt.getScrollState();if((scroll_state.x!=new_scroll_state.x&&dy>2*dx)||(scroll_state.y!=new_scroll_state.y&&dx>2*dy))
{return block_action(e);}}}
return block_action(e);});}
dhtmlxEvent(this.$container,"contextmenu",function(e){if(action_mode)
return block_action(e);});dhtmlxEvent(this.$container,names[1],function(e){if(ignore(e))return;if(e.touches&&e.touches.length>1){action_mode=false;return;}
action_mode=true;action_start=accessor(e);if(action_start&&dblclicktime){var now=new Date();if((now-dblclicktime)<500){gantt._on_dblclick(action_start);block_action(e);}else
dblclicktime=now;}else{dblclicktime=new Date();}
long_tap_timer=setTimeout(function(){var taskId=gantt.locate(action_start);if(taskId&&!gantt._locate_css(action_start,"gantt_link_control")&&!gantt._locate_css(action_start,"gantt_grid_data")){gantt._tasks_dnd.on_mouse_down(action_start);if(gantt._tasks_dnd.drag&&gantt._tasks_dnd.drag.start_drag){cloneTaskRendered(taskId);gantt._tasks_dnd._start_dnd(action_start);gantt._touch_drag=true;gantt.refreshTask(taskId);gantt._touch_feedback();}}
long_tap_timer=null;},gantt.config.touch_drag);});dhtmlxEvent(this.$container,names[2],function(e){if(ignore(e))return;if(long_tap_timer)clearTimeout(long_tap_timer);gantt._touch_drag=false;action_mode=false;var source=accessor(e);gantt._tasks_dnd.on_mouse_up(source);if(current_target){gantt.refreshTask(gantt.locate(current_target));if(current_target.parentNode){current_target.parentNode.removeChild(current_target);gantt._touch_feedback();}}
gantt._touch_scroll_active=action_mode=scroll_mode=false;current_target=null;});function block_action(e){if(e&&e.preventDefault)
e.preventDefault();(e||event).cancelBubble=true;return false;}
function cloneTaskRendered(taskId){var renders=gantt._task_area_pulls;var task=gantt.getTask(taskId);if(task&&gantt.isTaskVisible(taskId)){for(var i in renders){task=renders[i][taskId];if(task&&task.getAttribute("task_id")&&task.getAttribute("task_id")==taskId){var copy=task.cloneNode(true);current_target=task;renders[i][taskId]=copy;task.style.display="none";copy.className+=" gantt_drag_move ";task.parentNode.appendChild(copy);return copy;}}}}};;

/* /gantt_improvement/static/dhtmlxGantt/ext/dhtmlxgantt_marker.js defined in bundle 'web.assets_backend' */
gantt._markers||(gantt._markers={}),gantt.config.show_markers=!0,gantt.attachEvent("onClear",function(){gantt._markers={}}),gantt.attachEvent("onGanttReady",function(){function t(t){if(!gantt.config.show_markers)return!1;if(!t.start_date)return!1;var e=gantt.getState();if(!(+t.start_date>+e.max_date||+t.end_date&&+t.end_date<+e.min_date||+t.start_date<+e.min_date)){var n=document.createElement("div");n.setAttribute("marker_id",t.id);var a="gantt_marker";gantt.templates.marker_class&&(a+=" "+gantt.templates.marker_class(t)),t.css&&(a+=" "+t.css),t.title&&(n.title=t.title),n.className=a;var i=gantt.posFromDate(t.start_date);if(n.style.left=i+"px",n.style.height=Math.max(gantt._y_from_ind(gantt._order.length),0)+"px",t.end_date){var s=gantt.posFromDate(t.end_date);n.style.width=Math.max(s-i,0)+"px"}return t.text&&(n.innerHTML="<div class='gantt_marker_content' >"+t.text+"</div>"),n}}var e=document.createElement("div");e.className="gantt_marker_area",gantt.$task_data.appendChild(e),gantt.$marker_area=e,gantt._markerRenderer=gantt._task_renderer("markers",t,gantt.$marker_area,null);}),gantt.attachEvent("onDataRender",function(){gantt.renderMarkers()}),gantt.getMarker=function(t){return this._markers?this._markers[t]:null},gantt.addMarker=function(t){return t.id=t.id||dhtmlx.uid(),this._markers[t.id]=t,t.id},gantt.deleteMarker=function(t){return this._markers&&this._markers[t]?(delete this._markers[t],!0):!1},gantt.updateMarker=function(t){this._markerRenderer&&this._markerRenderer.render_item(t)},gantt.renderMarkers=function(){if(!this._markers)return!1;if(!this._markerRenderer)return!1;var t=[];for(var e in this._markers)t.push(this._markers[e]);return this._markerRenderer.render_items(t),!0};;

/* /web_gantt/static/lib/dhtmlxGantt/sources/dhtmlxcommon.js defined in bundle 'web.assets_backend' */
dhtmlxAjax={get:function(url,callback){var t=new dtmlXMLLoaderObject(true);t.async=(arguments.length<3);t.waitCall=callback;t.loadXML(url)
return t;},post:function(url,post,callback){var t=new dtmlXMLLoaderObject(true);t.async=(arguments.length<4);t.waitCall=callback;t.loadXML(url,true,post)
return t;},getSync:function(url){return this.get(url,null,true)},postSync:function(url,post){return this.post(url,post,null,true);}}
function dtmlXMLLoaderObject(funcObject,dhtmlObject,async,rSeed){this.xmlDoc="";if(typeof(async)!="undefined")
this.async=async;else
this.async=true;this.onloadAction=funcObject||null;this.mainObject=dhtmlObject||null;this.waitCall=null;this.rSeed=rSeed||false;return this;};dtmlXMLLoaderObject.prototype.waitLoadFunction=function(dhtmlObject){var once=true;this.check=function(){if((dhtmlObject)&&(dhtmlObject.onloadAction!=null)){if((!dhtmlObject.xmlDoc.readyState)||(dhtmlObject.xmlDoc.readyState==4)){if(!once)
return;once=false;if(typeof dhtmlObject.onloadAction=="function")
dhtmlObject.onloadAction(dhtmlObject.mainObject,null,null,null,dhtmlObject);if(dhtmlObject.waitCall){dhtmlObject.waitCall.call(this,dhtmlObject);dhtmlObject.waitCall=null;}}}};return this.check;};dtmlXMLLoaderObject.prototype.getXMLTopNode=function(tagName,oldObj){if(this.xmlDoc.responseXML){var temp=this.xmlDoc.responseXML.getElementsByTagName(tagName);if(temp.length==0&&tagName.indexOf(":")!=-1)
var temp=this.xmlDoc.responseXML.getElementsByTagName((tagName.split(":"))[1]);var z=temp[0];}else
var z=this.xmlDoc.documentElement;if(z){this._retry=false;return z;}
if((_isIE)&&(!this._retry)){var xmlString=this.xmlDoc.responseText;var oldObj=this.xmlDoc;this._retry=true;this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM");this.xmlDoc.async=false;this.xmlDoc["loadXM"+"L"](xmlString);return this.getXMLTopNode(tagName,oldObj);}
dhtmlxError.throwError("LoadXML","Incorrect XML",[(oldObj||this.xmlDoc),this.mainObject]);return document.createElement("DIV");};dtmlXMLLoaderObject.prototype.loadXMLString=function(xmlString){{try{var parser=new DOMParser();this.xmlDoc=parser.parseFromString(xmlString,"text/xml");}
catch(e){this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM");this.xmlDoc.async=this.async;this.xmlDoc["loadXM"+"L"](xmlString);}}
this.onloadAction(this.mainObject,null,null,null,this);if(this.waitCall){this.waitCall();this.waitCall=null;}}
dtmlXMLLoaderObject.prototype.loadXML=function(filePath,postMode,postVars,rpc){if(this.rSeed)
filePath+=((filePath.indexOf("?")!=-1)?"&":"?")+"a_dhx_rSeed="+(new Date()).valueOf();this.filePath=filePath;if((!_isIE)&&(window.XMLHttpRequest))
this.xmlDoc=new XMLHttpRequest();else{if(document.implementation&&document.implementation.createDocument){this.xmlDoc=document.implementation.createDocument("","",null);this.xmlDoc.onload=new this.waitLoadFunction(this);this.xmlDoc.load(filePath);return;}else
this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP");}
if(this.async)
this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this);this.xmlDoc.open(postMode?"POST":"GET",filePath,this.async);if(rpc){this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")");this.xmlDoc.setRequestHeader("Content-type","text/xml");}
else if(postMode)
this.xmlDoc.setRequestHeader('Content-type','application/x-www-form-urlencoded');this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xmlDoc.send(null||postVars);if(!this.async)
(new this.waitLoadFunction(this))();};dtmlXMLLoaderObject.prototype.destructor=function(){this._filterXPath=null;this._getAllNamedChilds=null;this._retry=null;this.async=null;this.rSeed=null;this.filePath=null;this.onloadAction=null;this.mainObject=null;this.xmlDoc=null;this.doXPath=null;this.doXPathOpera=null;this.doXSLTransToObject=null;this.doXSLTransToString=null;this.loadXML=null;this.loadXMLString=null;this.doSerialization=null;this.xmlNodeToJSON=null;this.getXMLTopNode=null;this.setXSLParamValue=null;return null;}
dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(node){var t={};for(var i=0;i<node.attributes.length;i++)
t[node.attributes[i].name]=node.attributes[i].value;t["_tagvalue"]=node.firstChild?node.firstChild.nodeValue:"";for(var i=0;i<node.childNodes.length;i++){var name=node.childNodes[i].tagName;if(name){if(!t[name])t[name]=[];t[name].push(this.xmlNodeToJSON(node.childNodes[i]));}}
return t;}
function callerFunction(funcObject,dhtmlObject){this.handler=function(e){if(!e)
e=window.event;funcObject(e,dhtmlObject);return true;};return this.handler;};function getAbsoluteLeft(htmlObject){return getOffset(htmlObject).left;}
function getAbsoluteTop(htmlObject){return getOffset(htmlObject).top;}
function getOffsetSum(elem){var top=0,left=0;while(elem){top=top+parseInt(elem.offsetTop);left=left+parseInt(elem.offsetLeft);elem=elem.offsetParent;}
return{top:top,left:left};}
function getOffsetRect(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)};}
function getOffset(elem){if(elem.getBoundingClientRect){return getOffsetRect(elem);}else{return getOffsetSum(elem);}}
function convertStringToBoolean(inputString){if(typeof(inputString)=="string")
inputString=inputString.toLowerCase();switch(inputString){case"1":case"true":case"yes":case"y":case 1:case true:return true;break;default:return false;}}
function getUrlSymbol(str){if(str.indexOf("?")!=-1)
return"&"
else
return"?"}
function dhtmlDragAndDropObject(){if(window.dhtmlDragAndDrop)
return window.dhtmlDragAndDrop;this.lastLanding=0;this.dragNode=0;this.dragStartNode=0;this.dragStartObject=0;this.tempDOMU=null;this.tempDOMM=null;this.waitDrag=0;window.dhtmlDragAndDrop=this;return this;};dhtmlDragAndDropObject.prototype.removeDraggableItem=function(htmlNode){htmlNode.onmousedown=null;htmlNode.dragStarter=null;htmlNode.dragLanding=null;}
dhtmlDragAndDropObject.prototype.addDraggableItem=function(htmlNode,dhtmlObject){htmlNode.onmousedown=this.preCreateDragCopy;htmlNode.dragStarter=dhtmlObject;this.addDragLanding(htmlNode,dhtmlObject);}
dhtmlDragAndDropObject.prototype.addDragLanding=function(htmlNode,dhtmlObject){htmlNode.dragLanding=dhtmlObject;}
dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){if((e||window.event)&&(e||event).button==2)
return;if(window.dhtmlDragAndDrop.waitDrag){window.dhtmlDragAndDrop.waitDrag=0;document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU;document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM;return false;}
window.dhtmlDragAndDrop.waitDrag=1;window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup;window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove;window.dhtmlDragAndDrop.dragStartNode=this;window.dhtmlDragAndDrop.dragStartObject=this.dragStarter;document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy;document.body.onmousemove=window.dhtmlDragAndDrop.callDrag;window.dhtmlDragAndDrop.downtime=new Date().valueOf();if((e)&&(e.preventDefault)){e.preventDefault();return false;}
return false;};dhtmlDragAndDropObject.prototype.callDrag=function(e){if(!e)
e=window.event;dragger=window.dhtmlDragAndDrop;if((new Date()).valueOf()-dragger.downtime<100)return;if((e.button==0)&&(_isIE))
return dragger.stopDrag();if(!dragger.dragNode&&dragger.waitDrag){dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,e);if(!dragger.dragNode)
return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return false;}
dragger.gldragNode=dragger.dragNode;document.body.appendChild(dragger.dragNode);document.body.onmouseup=dragger.stopDrag;dragger.waitDrag=0;dragger.dragNode.pWindow=window;dragger.initFrameRoute();}
if(dragger.dragNode.parentNode!=window.document.body){var grd=dragger.gldragNode;if(dragger.gldragNode.old)
grd=dragger.gldragNode.old;grd.parentNode.removeChild(grd);var oldBody=dragger.dragNode.pWindow;if(grd.pWindow&&grd.pWindow.dhtmlDragAndDrop.lastLanding)
grd.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(grd.pWindow.dhtmlDragAndDrop.lastLanding);if(_isIE){var div=document.createElement("Div");div.innerHTML=dragger.dragNode.outerHTML;dragger.dragNode=div.childNodes[0];}else
dragger.dragNode=dragger.dragNode.cloneNode(true);dragger.dragNode.pWindow=window;dragger.gldragNode.old=dragger.dragNode;document.body.appendChild(dragger.dragNode);oldBody.dhtmlDragAndDrop.dragNode=dragger.dragNode;}
dragger.dragNode.style.left=e.clientX+15+(dragger.fx?dragger.fx*(-1):0)
+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px";dragger.dragNode.style.top=e.clientY+3+(dragger.fy?dragger.fy*(-1):0)
+(document.body.scrollTop||document.documentElement.scrollTop)+"px";if(!e.srcElement)
var z=e.target;else
z=e.srcElement;dragger.checkLanding(z,e);}
dhtmlDragAndDropObject.prototype.calculateFramePosition=function(n){if(window.name){var el=parent.frames[window.name].frameElement.offsetParent;var fx=0;var fy=0;while(el){fx+=el.offsetLeft;fy+=el.offsetTop;el=el.offsetParent;}
if((parent.dhtmlDragAndDrop)){var ls=parent.dhtmlDragAndDrop.calculateFramePosition(1);fx+=ls.split('_')[0]*1;fy+=ls.split('_')[1]*1;}
if(n)
return fx+"_"+fy;else
this.fx=fx;this.fy=fy;}
return"0_0";}
dhtmlDragAndDropObject.prototype.checkLanding=function(htmlObject,e){if((htmlObject)&&(htmlObject.dragLanding)){if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding);this.lastLanding=htmlObject;this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,e.clientX,e.clientY,e);this.lastLanding_scr=(_isIE?e.srcElement:e.target);}else{if((htmlObject)&&(htmlObject.tagName!="BODY"))
this.checkLanding(htmlObject.parentNode,e);else{if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding,e.clientX,e.clientY,e);this.lastLanding=0;if(this._onNotFound)
this._onNotFound();}}}
dhtmlDragAndDropObject.prototype.stopDrag=function(e,mode){dragger=window.dhtmlDragAndDrop;if(!mode){dragger.stopFrameRoute();var temp=dragger.lastLanding;dragger.lastLanding=null;if(temp)
temp.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,temp,(_isIE?event.srcElement:e.target));}
dragger.lastLanding=null;if((dragger.dragNode)&&(dragger.dragNode.parentNode==document.body))
dragger.dragNode.parentNode.removeChild(dragger.dragNode);dragger.dragNode=0;dragger.gldragNode=0;dragger.fx=0;dragger.fy=0;dragger.dragStartNode=0;dragger.dragStartObject=0;document.body.onmouseup=dragger.tempDOMU;document.body.onmousemove=dragger.tempDOMM;dragger.tempDOMU=null;dragger.tempDOMM=null;dragger.waitDrag=0;}
dhtmlDragAndDropObject.prototype.stopFrameRoute=function(win){if(win)
window.dhtmlDragAndDrop.stopDrag(1,1);for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
dhtmlDragAndDropObject.prototype.initFrameRoute=function(win,mode){if(win){window.dhtmlDragAndDrop.preCreateDragCopy();window.dhtmlDragAndDrop.dragStartNode=win.dhtmlDragAndDrop.dragStartNode;window.dhtmlDragAndDrop.dragStartObject=win.dhtmlDragAndDrop.dragStartObject;window.dhtmlDragAndDrop.dragNode=win.dhtmlDragAndDrop.dragNode;window.dhtmlDragAndDrop.gldragNode=win.dhtmlDragAndDrop.dragNode;window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag;window.waitDrag=0;if(((!_isIE)&&(mode))&&((!_isFF)||(_FFrv<1.8)))
window.dhtmlDragAndDrop.calculateFramePosition();}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.initFrameRoute(window);}catch(e){}
for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.initFrameRoute(window,((!win||mode)?1:0));}catch(e){}}}
var _isFF=false;var _isIE=false;var _isOpera=false;var _isKHTML=false;var _isMacOS=false;var _isChrome=false;if(navigator.userAgent.indexOf('Macintosh')!=-1)
_isMacOS=true;if(navigator.userAgent.toLowerCase().indexOf('chrome')>-1)
_isChrome=true;if((navigator.userAgent.indexOf('Safari')!=-1)||(navigator.userAgent.indexOf('Konqueror')!=-1)){var _KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Safari')+7,5));if(_KHTMLrv>525){_isFF=true;var _FFrv=1.9;}else
_isKHTML=true;}else if(navigator.userAgent.indexOf('Opera')!=-1){_isOpera=true;_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Opera')+6,3));}
else if(navigator.appName.indexOf("Microsoft")!=-1){_isIE=true;if(navigator.appVersion.indexOf("MSIE 8.0")!=-1&&document.compatMode!="BackCompat")_isIE=8;}else{_isFF=true;var _FFrv=parseFloat(navigator.userAgent.split("rv:")[1])}
dtmlXMLLoaderObject.prototype.doXPath=function(xpathExp,docObj,namespace,result_type){if(_isKHTML||(!_isIE&&!window.XPathResult))
return this.doXPathOpera(xpathExp,docObj);if(_isIE){if(!docObj)
if(!this.xmlDoc.nodeName)
docObj=this.xmlDoc.responseXML
else
docObj=this.xmlDoc;if(!docObj)
dhtmlxError.throwError("LoadXML","Incorrect XML",[(docObj||this.xmlDoc),this.mainObject]);if(namespace!=null)
docObj.setProperty("SelectionNamespaces","xmlns:xsl='"+namespace+"'");if(result_type=='single'){return docObj.selectSingleNode(xpathExp);}
else{return docObj.selectNodes(xpathExp)||new Array(0);}}else{var nodeObj=docObj;if(!docObj){if(!this.xmlDoc.nodeName){docObj=this.xmlDoc.responseXML}
else{docObj=this.xmlDoc;}}
if(!docObj)
dhtmlxError.throwError("LoadXML","Incorrect XML",[(docObj||this.xmlDoc),this.mainObject]);if(docObj.nodeName.indexOf("document")!=-1){nodeObj=docObj;}
else{nodeObj=docObj;docObj=docObj.ownerDocument;}
var retType=XPathResult.ANY_TYPE;if(result_type=='single')
retType=XPathResult.FIRST_ORDERED_NODE_TYPE
var rowsCol=new Array();var col=docObj.evaluate(xpathExp,nodeObj,function(pref){return namespace},retType,null);if(retType==XPathResult.FIRST_ORDERED_NODE_TYPE){return col.singleNodeValue;}
var thisColMemb=col.iterateNext();while(thisColMemb){rowsCol[rowsCol.length]=thisColMemb;thisColMemb=col.iterateNext();}
return rowsCol;}}
function _dhtmlxError(type,name,params){if(!this.catches)
this.catches=new Array();return this;}
_dhtmlxError.prototype.catchError=function(type,func_name){this.catches[type]=func_name;}
_dhtmlxError.prototype.throwError=function(type,name,params){if(this.catches[type])
return this.catches[type](type,name,params);if(this.catches["ALL"])
return this.catches["ALL"](type,name,params);alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]);return null;}
window.dhtmlxError=new _dhtmlxError();dtmlXMLLoaderObject.prototype.doXPathOpera=function(xpathExp,docObj){var z=xpathExp.replace(/[\/]+/gi,"/").split('/');var obj=null;var i=1;if(!z.length)
return[];if(z[0]==".")
obj=[docObj];else if(z[0]==""){obj=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(z[i].replace(/\[[^\]]*\]/g,""));i++;}else
return[];for(i;i<z.length;i++)obj=this._getAllNamedChilds(obj,z[i]);if(z[i-1].indexOf("[")!=-1)
obj=this._filterXPath(obj,z[i-1]);return obj;}
dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){var c=new Array();var b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,"");for(var i=0;i<a.length;i++)
if(a[i].getAttribute(b))
c[c.length]=a[i];return c;}
dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=new Array();if(_isKHTML)
b=b.toUpperCase();for(var i=0;i<a.length;i++)for(var j=0;j<a[i].childNodes.length;j++){if(_isKHTML){if(a[i].childNodes[j].tagName&&a[i].childNodes[j].tagName.toUpperCase()==b)
c[c.length]=a[i].childNodes[j];}
else if(a[i].childNodes[j].tagName==b)
c[c.length]=a[i].childNodes[j];}
return c;}
function dhtmlXHeir(a,b){for(var c in b)
if(typeof(b[c])=="function")
a[c]=b[c];return a;}
function dhtmlxEvent(el,event,handler){if(el.addEventListener)
el.addEventListener(event,handler,false);else if(el.attachEvent)
el.attachEvent("on"+event,handler);}
dtmlXMLLoaderObject.prototype.xslDoc=null;dtmlXMLLoaderObject.prototype.setXSLParamValue=function(paramName,paramValue,xslDoc){if(!xslDoc)
xslDoc=this.xslDoc
if(xslDoc.responseXML)
xslDoc=xslDoc.responseXML;var item=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+paramName+"']",xslDoc,"http:/\/www.w3.org/1999/XSL/Transform","single");if(item!=null)
item.firstChild.nodeValue=paramValue}
dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(xslDoc,xmlDoc){if(!xslDoc)
xslDoc=this.xslDoc;if(xslDoc.responseXML)
xslDoc=xslDoc.responseXML
if(!xmlDoc)
xmlDoc=this.xmlDoc;if(xmlDoc.responseXML)
xmlDoc=xmlDoc.responseXML
if(!_isIE){if(!this.XSLProcessor){this.XSLProcessor=new XSLTProcessor();this.XSLProcessor.importStylesheet(xslDoc);}
var result=this.XSLProcessor.transformToDocument(xmlDoc);}else{var result=new ActiveXObject("Msxml2.DOMDocument.3.0");try{xmlDoc.transformNodeToObject(xslDoc,result);}catch(e){result=xmlDoc.transformNode(xslDoc);}}
return result;}
dtmlXMLLoaderObject.prototype.doXSLTransToString=function(xslDoc,xmlDoc){var res=this.doXSLTransToObject(xslDoc,xmlDoc);if(typeof(res)=="string")
return res;return this.doSerialization(res);}
dtmlXMLLoaderObject.prototype.doSerialization=function(xmlDoc){if(!xmlDoc)
xmlDoc=this.xmlDoc;if(xmlDoc.responseXML)
xmlDoc=xmlDoc.responseXML
if(!_isIE){var xmlSerializer=new XMLSerializer();return xmlSerializer.serializeToString(xmlDoc);}else
return xmlDoc.xml;}
dhtmlxEventable=function(obj){obj.attachEvent=function(name,catcher,callObj){name='ev_'+name.toLowerCase();if(!this[name])
this[name]=new this.eventCatcher(callObj||this);return(name+':'+this[name].addEvent(catcher));}
obj.callEvent=function(name,arg0){name='ev_'+name.toLowerCase();if(this[name])
return this[name].apply(this,arg0);return true;}
obj.checkEvent=function(name){return(!!this['ev_'+name.toLowerCase()])}
obj.eventCatcher=function(obj){var dhx_catch=[];var z=function(){var res=true;for(var i=0;i<dhx_catch.length;i++){if(dhx_catch[i]!=null){var zr=dhx_catch[i].apply(obj,arguments);res=res&&zr;}}
return res;}
z.addEvent=function(ev){if(typeof(ev)!="function")
ev=eval(ev);if(ev)
return dhx_catch.push(ev)-1;return false;}
z.removeEvent=function(id){dhx_catch[id]=null;}
return z;}
obj.detachEvent=function(id){if(id!=false){var list=id.split(':');this[list[0]].removeEvent(list[1]);}}
obj.detachAllEvents=function(){for(var name in this){if(name.indexOf("ev_")==0)
delete this[name];}}};

/* /web_gantt/static/lib/dhtmlxGantt/sources/dhtmlxgantt.js defined in bundle 'web.assets_backend' */
function GanttProjectInfo(id,name,startDate)
{this.Id=id;this.Name=name;this.StartDate=startDate;this.ParentTasks=[];}
GanttProjectInfo.prototype.deleteTask=function(id)
{var task=this.getTaskById(id);if(task){if(!task.ParentTask){for(var i=0;i<this.ParentTasks.length;i++){if(this.ParentTasks[i].Id==id){if(this.ParentTasks[i].nextParentTask){if(this.ParentTasks[i].previousParentTask){this.ParentTasks[i].previousParentTask.nextParentTask=this.ParentTasks[i].nextParentTask;this.ParentTasks[i].nextParentTask.previousParentTask=this.ParentTasks[i].previousParentTask;}else{this.ParentTasks[i].nextParentTask.previousParentTask=null;}}else{if(this.ParentTasks[i].previousParentTask){this.ParentTasks[i].previousParentTask.nextParentTask=null;}}
this.ParentTasks[i]=null;this.ParentTasks.splice(i,1);break;}}}else
{var parentTask=task.ParentTask;for(var i=0;i<parentTask.ChildTasks.length;i++){if(parentTask.ChildTasks[i].Id==id){if(parentTask.ChildTasks[i].nextChildTask){if(parentTask.ChildTasks[i].previousChildTask){parentTask.ChildTasks[i].previousChildTask.nextChildTask=parentTask.ChildTasks[i].nextChildTask;parentTask.ChildTasks[i].nextChildTask.previousChildTask=parentTask.ChildTasks[i].previousChildTask;}else{parentTask.ChildTasks[i].nextChildTask.previousChildTask=null;}}else{if(parentTask.ChildTasks[i].previousChildTask){parentTask.ChildTasks[i].previousChildTask.nextChildTask=null;}}
parentTask.ChildTasks[i]=null;parentTask.ChildTasks.splice(i,1);break;}}}}};GanttProjectInfo.prototype.addTask=function(task)
{this.ParentTasks.push(task);task.setProject(this);};GanttProjectInfo.prototype.getTaskById=function(id)
{for(var j=0;j<this.ParentTasks.length;j++)
{var task=this.getTaskByIdInTree(this.ParentTasks[j],id);if(task)return task;}
return null;};GanttProjectInfo.prototype.getTaskByIdInTree=function(parentTask,id)
{if(parentTask.Id==id)
{return parentTask;}else
{for(var i=0;i<parentTask.ChildTasks.length;i++){if(parentTask.ChildTasks[i].Id==id)
{return parentTask.ChildTasks[i];}
if(parentTask.ChildTasks[i].ChildTasks.length>0)
{if(parentTask.ChildTasks[i].ChildTasks.length>0)
{var cTask=this.getTaskByIdInTree(parentTask.ChildTasks[i],id);if(cTask)return cTask;}}}}
return null;};function GanttTaskInfo(id,name,est,duration,percentCompleted,predecessorTaskId)
{this.Id=id;this.Name=name;this.EST=est;this.Duration=duration;this.PercentCompleted=percentCompleted;this.PredecessorTaskId=predecessorTaskId;this.ChildTasks=[];this.ChildPredTasks=[];this.ParentTask=null;this.PredecessorTask=null;this.Project=null;this.nextChildTask=null;this.previousChildTask=null;this.nextParentTask=null;this.previousParentTask=null;}
GanttTaskInfo.prototype.addChildTask=function(task)
{this.ChildTasks.push(task);task.ParentTask=this;};GanttTaskInfo.prototype.setProject=function(project)
{this.Project=project;for(var j=0;j<this.ChildTasks.length;j++)
{this.ChildTasks[j].setProject(project);}};function GanttTask(taskInfo,project,chart)
{this.isTask=true;this.Chart=chart;this.Project=project;this.TaskInfo=taskInfo;this.checkMove=false;this.checkResize=false;this.moveChild=false;this.maxPosXMove=-1;this.minPosXMove=-1;this.maxWidthResize=-1;this.minWidthResize=-1;this.posX=0;this.posY=0;this.MouseX=0;this.taskItemWidth=0;this.isHide=false;this._heightHideTasks=0;this._isOpen=true;this.descrTask=null;this.cTaskItem=null;this.cTaskNameItem=null;this.parentTask=null;this.predTask=null;this.childTask=[];this.childPredTask=[];this.nextChildTask=null;this.previousChildTask=null;this.nextParentTask=null;this.previousParentTask=null;}
function GanttProject(Chart,projectInfo)
{this.isProject=true;this.nextProject=null;this.previousProject=null;this.arrTasks=[];this.Project=projectInfo;this.Chart=Chart;this.percentCompleted=0;this.Duration=0;this.descrProject=null;this.projectItem=null;this.projectNameItem=null;this.posY=0;this.posX=0;}
GanttProject.prototype.checkWidthProjectNameItem=function()
{if(this.projectNameItem.offsetWidth+this.projectNameItem.offsetLeft>this.Chart.maxWidthPanelNames)
{var width=this.projectNameItem.offsetWidth+this.projectNameItem.offsetLeft-this.Chart.maxWidthPanelNames;var countChar=Math.round(width/(this.projectNameItem.offsetWidth/this.projectNameItem.firstChild.length));var pName=this.Project.Name.substring(0,this.projectNameItem.firstChild.length-countChar-3);pName+="...";this.projectNameItem.innerHTML=pName;}};GanttProject.prototype.create=function()
{var containerTasks=this.Chart.oData.firstChild;this.posX=(this.Project.StartDate-this.Chart.startDate)/(60*60*1000)*this.Chart.hourInPixels;if(this.previousProject)
{if(this.previousProject.arrTasks.length>0){var lastChildTask=this.Chart.getLastChildTask(this.previousProject.arrTasks[this.previousProject.arrTasks.length-1]);this.posY=parseInt(lastChildTask.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;}else{this.posY=parseInt(this.previousProject.projectItem[0].style.top)+this.Chart.heightTaskItem+11;}}else{this.posY=6;}
if(this.Chart._showTreePanel){var containerNames=this.Chart.panelNames.firstChild;this.projectNameItem=this.createProjectNameItem();containerNames.appendChild(this.projectNameItem);this.checkWidthProjectNameItem();}
this.projectItem=[this.createProjectItem(),[]];containerTasks.appendChild(this.projectItem[0]);if(this.Chart.isShowDescProject){containerTasks.appendChild(this.createDescrProject());}
this.addDayInPanelTime();};function GanttChart()
{this.Error=new GanttError();this.dhtmlXMLSenderObject=new dhtmlXMLSenderObject(this);this.heightTaskItem=12;this.dayInPixels=24;this.hoursInDay=8;this._showTreePanel=true;this._showTooltip=true;this.isShowDescTask=false;this.isShowDescProject=false;this.isShowNewProject=true;this.isEditable=false;this.isShowConMenu=false;this.correctError=false;this.maxWidthPanelNames=150;this.minWorkLength=8;this.paramShowTask=[];this.paramShowProject=[];this.savePath=null;this.loadPath=null;this.divTimeInfo=null;this.divInfo=null;this.panelNames=null;this.panelTime=null;this.oData=null;this.content=null;this.panelErrors=null;this.contextMenu=null;this.hourInPixelsWork=this.dayInPixels/this.hoursInDay;this.hourInPixels=this.dayInPixels/24;this.minWidthResize=this.hourInPixels;this.countDays=0;this.startDate=null;this.initialPos=0;this.contentHeight=0;this.contentWidth=0;this._oDataHeight=0;this.Project=[];this.arrProjects=[];this.xmlLoader=null;this._isIE=false;this._isFF=false;this._isOpera=false;this._isMove=false;this._isResize=false;this._isError=false;this.imgs="codebase/imgs/";this.stylePath="codebase/dhtmlxgantt.css";this.shortMonthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this._useShortMonthNames=true;dhtmlxEventable(this);}
GanttChart.prototype.setImagePath=function(newPath)
{this.imgs=newPath;};GanttChart.prototype.setStylePath=function(newPath)
{this.stylePath=newPath;};GanttChart.prototype.setSavePath=function(newPath)
{this.savePath=newPath;};GanttChart.prototype.setLoadPath=function(newPath)
{this.loadPath=newPath;};GanttChart.prototype.setCorrectError=function(isCorrectError)
{this.correctError=isCorrectError;};GanttChart.prototype.showDescTask=function(isShowDescTask,param)
{this.isShowDescTask=isShowDescTask;var arrValues=new Array(5);if(this.isShowDescTask)
{if(param){var arrParam=param.split(",");for(var i=0;i<arrParam.length;i++){var k=this.getParamShowTask(arrParam[i]);arrValues[k]=1;}}else{arrValues[this.getParamShowTask('')]=1;}
this.paramShowTask=this.getValueShowTask(arrValues);}};GanttChart.prototype.showDescProject=function(isShowDescProject,param)
{this.isShowDescProject=isShowDescProject;var arrValues=new Array(4);if(this.isShowDescProject)
{if(param){var arrParam=param.split(",");for(var i=0;i<arrParam.length;i++){var k=this.getParamShowProject(arrParam[i]);arrValues[k]=1;}}else{arrValues[this.getParamShowProject('')]=1;}
this.paramShowProject=this.getValueShowProject(arrValues);}};GanttChart.prototype.showContextMenu=function(show)
{this.isShowConMenu=show;};GanttChart.prototype.setContextMenu=function(menu)
{this.showContextMenu(true);this.contextMenu=menu;};GanttChart.prototype.showNewProject=function(show)
{this.isShowNewProject=show;};GanttChart.prototype.getParamShowTask=function(param)
{switch(param){case'n':return 0;break;case'd':return 1;break;case'e':return 2;break;case'p':return 3;break;case's-f':return 4;break;default:return 0;break;}};GanttChart.prototype.getParamShowProject=function(param)
{switch(param){case'n':return 0;break;case'd':return 1;break;case's':return 2;break;case'p':return 3;break;default:return 0;break;}};GanttChart.prototype.getValueShowTask=function(param)
{var arrValues=[];for(var i=0;i<param.length;i++){if(param[i])
{switch(i){case 0:arrValues.push('Name');break;case 1:arrValues.push('Duration');break;case 2:arrValues.push('EST');break;case 3:arrValues.push('PercentComplete');break;case 4:arrValues.push('S-F');break;default:break;}}}
return arrValues;};GanttChart.prototype.getValueShowProject=function(param)
{var arrValues=[];for(var i=0;i<param.length;i++){if(param[i])
{switch(i){case 0:arrValues.push('Name');break;case 1:arrValues.push('Duration');break;case 2:arrValues.push('StartDate');break;case 3:arrValues.push('PercentComplete');break;default:break;}}}
return arrValues;};GanttChart.prototype.setEditable=function(isEditable)
{this.isEditable=isEditable;};GanttChart.prototype.showTreePanel=function(show)
{this._showTreePanel=show;};GanttChart.prototype.showTooltip=function(show)
{this._showTooltip=show;};GanttChart.prototype.getProjectById=function(id)
{for(var i=0;i<this.arrProjects.length;i++){if(this.arrProjects[i].Project.Id==id)
{return this.arrProjects[i];}}
return null;};GanttChart.prototype.getBrowserType=function()
{if(navigator.appName.indexOf('Explorer')!=-1)
{this._isIE=true;}else if(navigator.userAgent.indexOf('Mozilla')!=-1)
{this._isFF=true;}else if(navigator.userAgent.indexOf('Opera')!=-1)
{this._isOpera=true;}};GanttChart.prototype.addProject=function(projectInfo)
{this.Project.push(projectInfo);};GanttProject.prototype.deleteTask=function(id)
{var task=this.getTaskById(id);if(task){this.deleteChildTask(task);}else{this.Chart.Error.throwError("DATA_INSERT_ERROR",30,[id]);}};GanttChart.prototype.deleteProject=function(id)
{var project=this.getProjectById(id);if(project)
{if(project.arrTasks.length>0)
{while(project.arrTasks.length>0){project.deleteChildTask(project.arrTasks[0]);}}
if(project.nextProject)project.shiftNextProject(project,-23);for(var i=0;i<this.Project.length;i++){if(this.Project[i].Id==project.Project.Id){this.Project.splice(i,1);}}
if((project.previousProject)&&(project.nextProject))
{var previousProject=project.previousProject;previousProject.nextProject=project.nextProject;}
if((project.previousProject)&&!(project.nextProject))
{var previousProject=project.previousProject;previousProject.nextProject=null;}
if(!(project.previousProject)&&(project.nextProject))
{var nextProject=project.nextProject;nextProject.previousProject=null;}
for(var i=0;i<this.arrProjects.length;i++){if(this.arrProjects[i].Project.Id==id)
{this.arrProjects.splice(i,1);}}
project.projectItem[0].parentNode.removeChild(project.projectItem[0]);if(this.isShowDescProject){project.descrProject.parentNode.removeChild(project.descrProject);}
if(this._showTreePanel){project.projectNameItem.parentNode.removeChild(project.projectNameItem);}
this._oDataHeight-=11+this.heightTaskItem;if(this.Project.length==0)
{if(this.isShowNewProject)
{var d=new Date(this.startDate);var t=new Date(d.setDate(d.getDate()+1));var pi=new GanttProjectInfo(1,"New project",t);this.Project.push(pi);var project=new GanttProject(this,pi);project.create();this.arrProjects.push(project);this._oDataHeight+=11+this.heightTaskItem;}}}else{this.Error.throwError("DATA_INSERT_ERROR",31,[id]);}};GanttProject.prototype.setName=function(name)
{if((name!="")&&(name!=null)){this.Project.Name=name;if(this.Chart._showTreePanel)
{this.projectNameItem.innerHTML=name;this.projectNameItem.title=name;this.checkWidthProjectNameItem();}
if(this.Chart.isShowDescProject)this.descrProject.innerHTML=this.getDescStr();this.addDayInPanelTime();}};GanttProject.prototype.setPercentCompleted=function(percentCompleted)
{percentCompleted=parseInt(percentCompleted);if(isNaN(percentCompleted))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",6,null);return false;}
if(percentCompleted>100)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",7,null);return false;}else if(percentCompleted<0)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",8,null);return false;}
if((percentCompleted>0)&&(percentCompleted<100)&&(this.percentCompleted>0)&&(this.percentCompleted<100))
{this.projectItem[0].firstChild.rows[0].cells[0].width=parseInt(percentCompleted)+"%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=(percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";this.projectItem[0].firstChild.rows[0].cells[1].width=(100-parseInt(percentCompleted))+"%";this.projectItem[0].firstChild.rows[0].cells[1].firstChild.style.width=((100-percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";}else if(((percentCompleted==0)||(percentCompleted==100))&&(this.percentCompleted>0)&&(this.percentCompleted<100))
{if(percentCompleted==0)
{this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);this.projectItem[0].firstChild.rows[0].cells[0].width=100+"%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=this.Duration*this.Chart.hourInPixelsWork+"px";}else if(percentCompleted==100)
{this.projectItem[0].firstChild.rows[0].cells[1].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[1]);this.projectItem[0].firstChild.rows[0].cells[0].width=100+"%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=this.Duration*this.Chart.hourInPixelsWork+"px";}}else if(((percentCompleted==0)||(percentCompleted==100))&&((this.percentCompleted==0)||(this.percentCompleted==100)))
{if((percentCompleted==0)&&(this.percentCompleted==100))
{this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_bg.png";}else if((percentCompleted==100)&&(this.percentCompleted==0))
{this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"parentnode_filled.png";}}else if(((percentCompleted>0)||(percentCompleted<100))&&((this.percentCompleted==0)||(this.percentCompleted==100)))
{this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);var cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=percentCompleted+"%";var imgPr=document.createElement("img");imgPr.style.width=(percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"parentnode_filled.png";cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=(100-percentCompleted)+"%";imgPr=document.createElement("img");imgPr.style.width=((100-percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}else if(this.percentCompleted==-1)
{if(percentCompleted==100)
{this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"parentnode_filled.png";}else if(percentCompleted<100&&percentCompleted>0)
{this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);var cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=percentCompleted+"%";var imgPr=document.createElement("img");imgPr.style.width=(percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"parentnode_filled.png";cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=(100-percentCompleted)+"%";imgPr=document.createElement("img");imgPr.style.width=((100-percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}}
this.percentCompleted=percentCompleted;if(this.Chart.isShowDescProject)this.descrProject.innerHTML=this.getDescStr();return true;};GanttProject.prototype.deleteChildTask=function(task)
{if(task)
{if(task.cTaskItem[0].style.display=="none"){this.Chart.openTree(task.parentTask);}
if(task.childPredTask.length>0){for(var i=0;i<task.childPredTask.length;i++)
{for(var t=0;t<task.childPredTask[i].cTaskItem[1].length;t++){task.childPredTask[i].cTaskItem[1][t].parentNode.removeChild(task.childPredTask[i].cTaskItem[1][t]);}
task.childPredTask[i].cTaskItem[1]=[];task.childPredTask[i].predTask=null;}}
if(task.childTask.length>0){while(task.childTask.length>0){this.deleteChildTask(task.childTask[0]);}}
if(task.cTaskItem[0].style.display!="none")task.shiftCurrentTasks(task,-23);this.Project.deleteTask(task.TaskInfo.Id);if(task.cTaskItem[0]){task.cTaskItem[0].parentNode.removeChild(task.cTaskItem[0]);}
if(this.Chart.isShowDescTask){task.descrTask.parentNode.removeChild(task.descrTask);}
if(task.cTaskItem[1].length>0){for(var j=0;j<task.cTaskItem[1].length;j++){task.cTaskItem[1][j].parentNode.removeChild(task.cTaskItem[1][j]);}}
if(task.cTaskNameItem[0]){task.cTaskNameItem[0].parentNode.removeChild(task.cTaskNameItem[0]);}
if(task.cTaskNameItem[1]){for(var j=0;j<task.cTaskNameItem[1].length;j++){task.cTaskNameItem[1][j].parentNode.removeChild(task.cTaskNameItem[1][j]);}}
if(task.cTaskNameItem[2]){task.cTaskNameItem[2].parentNode.removeChild(task.cTaskNameItem[2]);}
if(task.parentTask)
{if(task.previousChildTask){if(task.nextChildTask){task.previousChildTask.nextChildTask=task.nextChildTask;}else{task.previousChildTask.nextChildTask=null;}}
var parentTask=task.parentTask;for(var i=0;i<parentTask.childTask.length;i++)
{if(parentTask.childTask[i].TaskInfo.Id==task.TaskInfo.Id){parentTask.childTask[i]=null;parentTask.childTask.splice(i,1);break;}}
if(parentTask.childTask.length==0){if(parentTask.cTaskNameItem[2]){parentTask.cTaskNameItem[2].parentNode.removeChild(parentTask.cTaskNameItem[2]);parentTask.cTaskNameItem[2]=null;}}}else
{if(task.previousParentTask)
{if(task.nextParentTask){task.previousParentTask.nextParentTask=task.nextParentTask;}else{task.previousParentTask.nextParentTask=null;}}
var project=task.Project;for(var i=0;i<project.arrTasks.length;i++){if(project.arrTasks[i].TaskInfo.Id==task.TaskInfo.Id){project.arrTasks.splice(i,1);}}}
if(task.predTask){var predTask=task.predTask;for(var i=0;i<predTask.childPredTask.length;i++){if(predTask.childPredTask[i].TaskInfo.Id==task.TaskInfo.Id){predTask.childPredTask[i]=null;predTask.childPredTask.splice(i,1);}}}
if(task.Project.arrTasks.length!=0){task.Project.shiftProjectItem();}
else{task.Project.projectItem[0].style.display="none";if(this.Chart.isShowDescProject)this.hideDescrProject();}
this.Chart._oDataHeight-=11+this.Chart.heightTaskItem;}};GanttProject.prototype.insertTask=function(id,name,EST,Duration,PercentCompleted,predecessorTaskId,parentTaskId)
{var task=null;var _task=null;if(this.Project.getTaskById(id)){this.Chart.Error.throwError("DATA_INSERT_ERROR",22,[id]);return false;}
if((!Duration)||(Duration<this.Chart.minWorkLength)){Duration=this.Chart.minWorkLength;}
if((!name)||(name=="")){name=id;}
if((!PercentCompleted)||(PercentCompleted=="")){PercentCompleted=0;}else{PercentCompleted=parseInt(PercentCompleted);if(PercentCompleted<0||PercentCompleted>100){this.Chart.Error.throwError("DATA_INSERT_ERROR",35,null);return false;}}
var sortRequired=false;if((parentTaskId)&&(parentTaskId!="")){var parentTask=this.Project.getTaskById(parentTaskId);if(!parentTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",21,[parentTaskId]);return false;}
EST=EST||parentTask.EST;if(EST<parentTask.EST){this.Chart.Error.throwError("DATA_INSERT_ERROR",20,[id,parentTaskId]);return false;}
task=new GanttTaskInfo(id,name,EST,Duration,PercentCompleted,predecessorTaskId);if(!this.Chart.checkPosParentTask(parentTask,task)){this.Chart.Error.throwError("DATA_INSERT_ERROR",19,[parentTaskId,id]);return false;}
task.ParentTask=parentTask;var _parentTask=this.getTaskById(parentTask.Id);var isHide=false;if(_parentTask.cTaskItem[0].style.display=="none"){isHide=true;}else if(_parentTask.cTaskNameItem[2]){if(!_parentTask._isOpen){isHide=true;}}
if(isHide){if(_parentTask.childTask.length==0){this.Chart.openTree(_parentTask.parentTask);}else{this.Chart.openTree(_parentTask);}}
if(predecessorTaskId!="")
{var predTask=this.Project.getTaskById(predecessorTaskId);if(!predTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[predecessorTaskId]);return false;}
if(predTask.ParentTask){if(predTask.ParentTask.Id!=task.ParentTask.Id){this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[predTask.Id,task.Id]);return false;}}else{this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[predTask.Id,task.Id]);return false;}
if(!this.Chart.checkPosPredecessorTask(predTask,task)){this.Chart.correctPosPredecessorTask(predTask,task);}
task.PredecessorTask=predTask;}
var isAdd=false;if(sortRequired)for(var i=0;i<parentTask.ChildTasks.length;i++){if(task.EST<parentTask.ChildTasks[i].EST)
{parentTask.ChildTasks.splice(i,0,task);if(i>0){parentTask.ChildTasks[i-1].nextChildTask=parentTask.ChildTasks[i];parentTask.ChildTasks[i].previousChildTask=parentTask.ChildTasks[i-1];}
if(parentTask.ChildTasks[i+1]){parentTask.ChildTasks[i+1].previousChildTask=parentTask.ChildTasks[i];parentTask.ChildTasks[i].nextChildTask=parentTask.ChildTasks[i+1];}
isAdd=true;break;}}
if(!isAdd){if(parentTask.ChildTasks.length>0){parentTask.ChildTasks[parentTask.ChildTasks.length-1].nextChildTask=task;task.previousChildTask=parentTask.ChildTasks[parentTask.ChildTasks.length-1];}
parentTask.ChildTasks.push(task);}
if(parentTask.ChildTasks.length==1){_parentTask.cTaskNameItem[2]=_parentTask.createTreeImg();}
_task=new GanttTask(task,this,this.Chart);_task.create();if(task.nextChildTask)_task.nextChildTask=_task.Project.getTaskById(task.nextChildTask.Id);_task.addDayInPanelTime();_task.shiftCurrentTasks(_task,23);}else
{EST=EST||this.Project.StartDate;task=new GanttTaskInfo(id,name,EST,Duration,PercentCompleted,predecessorTaskId);if(task.EST<=this.Chart.startDate){this.Chart.Error.throwError("DATA_INSERT_ERROR",18,[task.Id]);return false;}
if(predecessorTaskId!=""){var predTask=this.Project.getTaskById(predecessorTaskId);if(!predTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[predecessorTaskId]);return false;}
if(!this.Chart.checkPosPredecessorTask(predTask,task)){this.Chart.correctPosPredecessorTask(predTask,task);}
if(predTask.ParentTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",15,[task.Id,predTask.Id]);return false;}
task.PredecessorTask=predTask;}
var isAdd=false;if(sortRequired)for(var i=0;i<this.Project.ParentTasks.length;i++){if(EST<this.Project.ParentTasks[i].EST)
{this.Project.ParentTasks.splice(i,0,task);if(i>0){this.Project.ParentTasks[i-1].nextParentTask=task;task.previousParentTask=this.Project.ParentTasks[i-1];}
if(this.Project.ParentTasks[i+1]){this.Project.ParentTasks[i+1].previousParentTask=task;task.nextParentTask=this.Project.ParentTasks[i+1];}
isAdd=true;break;}}
if(!isAdd){if(this.Project.ParentTasks.length>0){this.Project.ParentTasks[this.Project.ParentTasks.length-1].nextParentTask=task;task.previousParentTask=this.Project.ParentTasks[this.Project.ParentTasks.length-1];}
this.Project.ParentTasks.push(task);}
_task=new GanttTask(task,this,this.Chart);_task.create();if(task.nextParentTask)_task.nextParentTask=_task.Project.getTaskById(task.nextParentTask.Id);_task.addDayInPanelTime();this.arrTasks.push(_task);_task.shiftCurrentTasks(_task,23);this.projectItem[0].style.display="inline";this.setPercentCompleted(this.getPercentCompleted());this.shiftProjectItem();if(this.Chart.isShowDescProject){this.showDescrProject();}}
this.Chart.checkHeighPanelTasks();return _task;};GanttChart.prototype.checkPosPredecessorTask=function(predTask,task)
{var widthPred=this.getWidthOnDuration(predTask.Duration);var posPred=this.getPosOnDate(predTask.EST);var posChild=this.getPosOnDate(task.EST);return(widthPred+posPred)<=posChild;};GanttChart.prototype.correctPosPredecessorTask=function(predTask,ctask,ctaskObj)
{var newDate=new Date(predTask.EST);newDate.setHours(newDate.getHours()+(predTask.Duration/this.hoursInDay*24));if(newDate.getHours()>0){newDate.setHours(0);newDate.setDate(newDate.getDate()+1);}
if(ctaskObj)ctaskObj.setEST(newDate,true);else ctask.EST=newDate;if(ctask.ParentTask)
{if(!this.checkPosParentTask(ctask.ParentTask,ctask))
{var newDate2=new Date(ctask.ParentTask.EST);newDate2.setHours(newDate2.getHours()+(ctask.ParentTask.Duration/this.hoursInDay*24));ctask.Duration=parseInt((parseInt((newDate2-ctask.EST)/(1000*60*60)))*this.hoursInDay/24);}}};GanttChart.prototype.correctPosParentTask=function(parentTask,ctask)
{if(!ctask.PredecessorTask)
{if(parentTask.EST>ctask.EST){ctask.EST=new Date(parentTask.EST);}
if(!this.checkPosParentTask(parentTask,ctask)){ctask.Duration=parentTask.Duration;}}else
{this.correctPosPredecessorTask(ctask.PredecessorTask,ctask);}};GanttChart.prototype.checkPosParentTaskInTree=function(parentTask)
{var isError=false;for(var t=0;t<parentTask.ChildTasks.length;t++)
{if(!this.checkPosParentTask(parentTask,parentTask.ChildTasks[t]))
{if(!this.correctError){this.Error.throwError("DATA_ERROR",28,[parentTask.Id,parentTask.ChildTasks[t].Id]);return true;}else{this.correctPosParentTask(parentTask,parentTask.ChildTasks[t]);}}
if(parentTask.EST>parentTask.ChildTasks[t].EST)
{if(!this.correctError){this.Error.throwError("DATA_ERROR",33,[parentTask.Id,parentTask.ChildTasks[t].Id]);return true;}else{this.correctPosParentTask(parentTask,parentTask.ChildTasks[t]);}}
if(parentTask.ChildTasks[t].ChildTasks.length>0)
{isError=this.checkPosParentTaskInTree(parentTask.ChildTasks[t]);}}
return isError;};GanttChart.prototype.setPredTask=function(project)
{var isError=false;for(var k=0;k<project.ParentTasks.length;k++){if(!this.isEmpty(project.ParentTasks[k].PredecessorTaskId))
{project.ParentTasks[k].PredecessorTask=project.getTaskById(project.ParentTasks[k].PredecessorTaskId);if(!project.ParentTasks[k].PredecessorTask){if(!this.correctError){this.Error.throwError("DATA_ERROR",27,[project.ParentTasks[k].PredecessorTaskId]);return true;}}
project.ParentTasks[k].PredecessorTask.ChildPredTasks.push(project.ParentTasks[k]);}
if(project.ParentTasks[k].PredecessorTask)
{if(!this.checkPosPredecessorTask(project.ParentTasks[k].PredecessorTask,project.ParentTasks[k])){if(!this.correctError){this.Error.throwError("DATA_ERROR",26,[project.ParentTasks[k].PredecessorTask.Id,project.ParentTasks[k].Id]);return true;}else{this.correctPosPredecessorTask(project.ParentTasks[k].PredecessorTask,project.ParentTasks[k]);}}}
isError=this.setPredTaskInTree(project.ParentTasks[k]);if(isError)return isError;}
return isError;};GanttChart.prototype.setPredTaskInTree=function(parentTask)
{var isError=false;for(var t=0;t<parentTask.ChildTasks.length;t++)
{if(!this.isEmpty(parentTask.ChildTasks[t].PredecessorTaskId))
{parentTask.ChildTasks[t].PredecessorTask=parentTask.Project.getTaskById(parentTask.ChildTasks[t].PredecessorTaskId);if(!parentTask.ChildTasks[t].PredecessorTask)
{if(!this.correctError){this.Error.throwError("DATA_ERROR",27,[parentTask.ChildTasks[t].PredecessorTaskId]);return true;}}
if(!this.checkPosPredecessorTask(parentTask.ChildTasks[t].PredecessorTask,parentTask.ChildTasks[t]))
{if(!this.correctError){this.Error.throwError("DATA_ERROR",26,[parentTask.ChildTasks[t].PredecessorTask.Id,parentTask.ChildTasks[t].Id]);return true;}else{this.correctPosPredecessorTask(parentTask.ChildTasks[t].PredecessorTask,parentTask.ChildTasks[t]);}}
parentTask.ChildTasks[t].PredecessorTask.ChildPredTasks.push(parentTask.ChildTasks[t]);}
if(parentTask.ChildTasks[t].ChildTasks.length>0)
{isError=this.setPredTaskInTree(parentTask.ChildTasks[t]);}}
return isError;};GanttChart.prototype.checkPosParentTask=function(parentTask,task)
{var widthParent=this.getWidthOnDuration(parentTask.Duration);var posParent=this.getPosOnDate(parentTask.EST);var posChild=this.getPosOnDate(task.EST);var widthChild=this.getWidthOnDuration(task.Duration);return(widthParent+posParent)>=(posChild+widthChild);};GanttChart.prototype.insertProject=function(id,name,startDate)
{if(this._isError)
{this.clearData();this.clearItems();this.hidePanelErrors();this._isError=false;}
if(this.startDate>=startDate){this.Error.throwError("DATA_INSERT_ERROR",14,null);return false;}
if(this.getProjectById(id)){this.Error.throwError("DATA_INSERT_ERROR",23,[id]);return false;}
this.checkHeighPanelTasks();var project=new GanttProjectInfo(id,name,startDate);this.Project.push(project);var _project=new GanttProject(this,project);for(var i=0;i<this.arrProjects.length;i++){if(startDate<this.arrProjects[i].Project.StartDate){this.arrProjects.splice(i,0,_project);if(i>0){_project.previousProject=this.arrProjects[i-1];this.arrProjects[i-1].nextProject=_project;}
if(i+1<=this.arrProjects.length){_project.nextProject=this.arrProjects[i+1];this.arrProjects[i+1].previousProject=_project;_project.shiftNextProject(_project,23);}
_project.create();if(this.isShowDescProject){_project.hideDescrProject();}
return _project;}}
if(this.arrProjects.length>0){this.arrProjects[this.arrProjects.length-1].nextProject=_project;_project.previousProject=this.arrProjects[this.arrProjects.length-1];}
this.arrProjects.push(_project);_project.create();if(this.isShowDescProject){_project.hideDescrProject();}
return _project;};GanttChart.prototype._showContextMenu=function(event,obj)
{if(this.contextMenu.isDhtmlxMenuObject){var res=this.callEvent("onBeforeContextMenu",[this.contextMenu,obj]);if(res===false)return;var x,y;if(_isIE){var dEl0=window.document.documentElement,dEl1=window.document.body,corrector=new Array((dEl0.scrollLeft||dEl1.scrollLeft),(dEl0.scrollTop||dEl1.scrollTop));x=event.clientX+corrector[0];y=event.clientY+corrector[1];}else{x=event.pageX;y=event.pageY;}
this.contextMenu.showContextMenu(x-1,y-1);}else{var elem=event.srcElement||event.target;this.contextMenu.showContextMenu(elem.style.left,elem.style.top,obj);}};GanttChart.prototype.openTree=function(parentTask)
{var lastParentTask=this.getLastCloseParent(parentTask);if(parentTask.TaskInfo.Id!=lastParentTask.TaskInfo.Id){this.openNode(lastParentTask);this.openTree(parentTask);}else{this.openNode(lastParentTask);}};GanttChart.prototype.openNode=function(parentTask)
{if(!parentTask._isOpen)
{parentTask.cTaskNameItem[2].src=this.imgs+"minus.gif";parentTask._isOpen=true;parentTask.shiftCurrentTasks(parentTask,parentTask._heightHideTasks);parentTask.showChildTasks(parentTask,parentTask._isOpen);parentTask._heightHideTasks=0;}};GanttChart.prototype.getLastCloseParent=function(task)
{if(task.parentTask)
{if((!task.parentTask._isOpen)||(task.parentTask.cTaskNameItem[2].style.display=="none")){return this.getLastCloseParent(task.parentTask);}else{return task;}}else{return task;}};GanttTask.prototype.setPredecessor=function(predecessorTaskId)
{if(predecessorTaskId=="")this.clearPredTask();else
{var task=this.TaskInfo;if(task.Id==predecessorTaskId){this.Chart.Error.throwError("DATA_INSERT_ERROR",36);return false;}
var predTaskObj=this.Project.getTaskById(predecessorTaskId);if(!predTaskObj){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[predecessorTaskId]);return false;}
var predTask=predTaskObj.TaskInfo;var a1=predTask.ParentTask==null,a2=task.ParentTask==null;if(a1&&!a2||!a1&&a2||!a1&&!a2&&(predTask.ParentTask.Id!=task.ParentTask.Id)){this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[predTask.Id,task.Id]);return false;}
this.clearPredTask();if(!this.Chart.checkPosPredecessorTask(predTask,task)){this.Chart.correctPosPredecessorTask(predTask,task,this);}
task.PredecessorTaskId=predecessorTaskId;task.PredecessorTask=predTask;this.predTask=predTaskObj;predTaskObj.childPredTask.push(this);this.cTaskItem[1]=this.createConnectingLinesDS();}
return true;};GanttTask.prototype.clearPredTask=function(){if(this.predTask){var ch=this.predTask.childPredTask;for(var i=0;i<ch.length;i++){if(ch[i]==this){ch.splice(i,1);break;}}
for(var i=0;i<this.cTaskItem[1].length;i++){this.cTaskItem[1][i].parentNode.removeChild(this.cTaskItem[1][i]);}
this.cTaskItem[1]=[];this.TaskInfo.PredecessorTaskId=null;this.TaskInfo.PredecessorTask=null;this.predTask=null;}};GanttTask.prototype.setEST=function(est,shiftChild)
{this.moveChild=shiftChild;this.getMoveInfo();var pos=this.Chart.getPosOnDate(est);if((parseInt(this.cTaskItem[0].firstChild.firstChild.width)+pos>this.maxPosXMove)&&(this.maxPosXMove!=-1))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",12,[this.TaskInfo.Id]);this.maxPosXMove=-1;this.minPosXMove=-1;return false;}
if(pos<this.minPosXMove)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",11,[this.TaskInfo.Id]);this.maxPosXMove=-1;this.minPosXMove=-1;return false;}
this.cTaskItem[0].style.left=pos;var width=pos-this.posX;this.moveCurrentTaskItem(width,shiftChild);this.Project.shiftProjectItem();if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();this.addDayInPanelTime();this.posX=0;this.maxPosXMove=-1;this.minPosXMove=-1;return true;};GanttTask.prototype.setDuration=function(duration)
{this.getResizeInfo();var width=this.Chart.getWidthOnDuration(duration);if((width>this.maxWidthResize)&&(this.maxWidthResize!=-1))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",10,[this.TaskInfo.Id]);return false;}else if(width<this.minWidthResize)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",9,[this.TaskInfo.Id]);return false;}else{this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.resizeTaskItem(width);this.endResizeItem();if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();return true;}};GanttTask.prototype.setPercentCompleted=function(percentCompleted)
{percentCompleted=parseInt(percentCompleted);if(isNaN(percentCompleted))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",6,null);return false;}
if(percentCompleted>100)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",7,null);return false;}
if(percentCompleted<0)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",8,null);return false;}
if((percentCompleted!=0)&&(percentCompleted!=100))
{if((this.TaskInfo.PercentCompleted!=0)&&(this.TaskInfo.PercentCompleted!=100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width=percentCompleted+"%";this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1].width=100-percentCompleted+"%";}else if((this.TaskInfo.PercentCompleted==0)||(this.TaskInfo.PercentCompleted==100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0]);var cellTblTask=document.createElement("td");this.cTaskItem[0].childNodes[0].firstChild.rows[0].appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=percentCompleted+"%";var imgPrF=document.createElement("img");imgPrF.style.width=(percentCompleted*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPrF.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPrF);imgPrF.src=this.Chart.imgs+"progress_filled.png";cellTblTask=document.createElement("td");this.cTaskItem[0].childNodes[0].firstChild.rows[0].appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=(100-percentCompleted)+"%";imgPrF=document.createElement("img");imgPrF.style.width=((100-percentCompleted)*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPrF.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPrF);imgPrF.src=this.Chart.imgs+"progress_bg.png";}}else if(percentCompleted==0)
{if((this.TaskInfo.PercentCompleted!=0)&&(this.TaskInfo.PercentCompleted!=100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0]);this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width=100+"%";}else
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_bg.png";}}else if(percentCompleted==100)
{if((this.TaskInfo.PercentCompleted!=0)&&(this.TaskInfo.PercentCompleted!=100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1]);this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width=100+"%";}else
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_filled.png";}}
this.TaskInfo.PercentCompleted=percentCompleted;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.resizeTaskItem(this.taskItemWidth);this.endResizeItem();if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();return true;};GanttTask.prototype.setName=function(name)
{if((name!="")&&(name!=null)){this.TaskInfo.Name=name;if(this.Chart._showTreePanel)
{this.cTaskNameItem[0].innerHTML=name;this.cTaskNameItem[0].title=name;this.checkWidthTaskNameItem();}
if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();this.addDayInPanelTime();}};GanttChart.prototype.getProjectInfoById=function(id)
{for(var i=0;i<this.Project.length;i++)
{if(this.Project[i].Id==id)
{return this.Project[i];}}
return null;};GanttChart.prototype.loadData=function(content,isFile,isLocal)
{this.clearData();if((isFile==null)||(isFile=='undefined'))
{isFile=false;}
if((isLocal==null)||(isLocal=='undefined'))
{isLocal=false;}
this.loadXML(content,isFile,isLocal);this.Project.sort(this.sort_byStartDate);this.startDate=this.getStartDate();this.clearItems();for(var i=0;i<this.Project.length;i++)
{for(var k=0;k<this.Project[i].ParentTasks.length;k++)
{if((this.Project[i].ParentTasks[k].EST!=null)&&(this.Project[i].ParentTasks[k].EST!='')){this.setESTChild(this.Project[i].ParentTasks[k]);}
else{this.Error.throwError("DATA_ERROR",25,[this.Project[i].ParentTasks[k].Id]);return;}
if(this.setPredTask(this.Project[i]))return;}
for(var k=0;k<this.Project[i].ParentTasks.length;k++){if(this.Project[i].ParentTasks[k].EST<this.Project[i].StartDate){this.Error.throwError("DATA_ERROR",24,[this.Project[i].ParentTasks[k].Id,this.Project[i].Id]);return;}
if(this.checkPosParentTaskInTree(this.Project[i].ParentTasks[k]))return;}
this.sortTasksByEST(this.Project[i]);}
for(var i=0;i<this.Project.length;i++)
{var project=new GanttProject(this,this.Project[i]);if(this.arrProjects.length>0)
{var previousProject=this.arrProjects[this.arrProjects.length-1];project.previousProject=previousProject;previousProject.nextProject=project;}
project.create();this.checkHeighPanelTasks();this.arrProjects.push(project);this.createTasks(project);}};GanttChart.prototype.clearAll=function()
{this._oDataHeight=0;this.startDate=null;this._isError=false;this.hidePanelErrors();this.clearData();this.clearItems();};GanttChart.prototype.clearData=function()
{this._oDataHeight=0;this.startDate=null;this._isError=false;this.hidePanelErrors();this.Project=[];this.arrProjects=[];};GanttChart.prototype.clearItems=function()
{this.oData.removeChild(this.oData.firstChild);this.oData.appendChild(this.createPanelTasks());this.oData.firstChild.appendChild(this.divInfo);this.oData.firstChild.appendChild(this.panelErrors);if(this._showTreePanel)
{this.panelNames.removeChild(this.panelNames.firstChild);this.panelNames.appendChild(this.createPanelNamesTasks());}
this.panelTime.removeChild(this.panelTime.firstChild);this.panelTime.appendChild(this.createPanelTime());};GanttChart.prototype.loadXML=function(content,isFile,isLocal)
{if(isFile&&(content==null||content==""))
{this.Error.throwError("DATA_SEND_ERROR",4,null);return;}
this.xmlLoader=new dtmlXMLLoaderObject(null,this,false);try
{if(!isFile)
try{this.xmlLoader.loadXMLString(content);}catch(e){this.Error.throwError("DATA_LOAD_ERROR",37,[content]);}else
if(!isLocal)
{this.xmlLoader.loadXML(this.loadPath+"?path="+content+"&rnd="+(new Date()-0),false);}else
{this.xmlLoader.loadXML(content+"?rnd="+(new Date()-0),false);}
this.doLoadDetails(isLocal);}catch(e)
{this.Error.throwError("DATA_LOAD_ERROR",5,[content]);}};GanttChart.prototype.doLoadDetails=function(isLocal)
{switch(this.xmlLoader.xmlDoc.status){case 0:if(!isLocal)
{this.Error.throwError("DATA_LOAD_ERROR",1,null);return;}
break;case 404:if(!isLocal)
{this.Error.throwError("DATA_LOAD_ERROR",5,[this.loadPath]);}else
{this.Error.throwError("DATA_LOAD_ERROR",5,[this.xmlLoader.filePath])}
return;break;case 500:this.Error.throwError("DATA_LOAD_ERROR",2,null);return;break;default:break;}
var name=null;var id=null;var est=null;var duration=null;var percentCompleted=null;var predecessorTaskId=null;var projectArr=this.xmlLoader.doXPath("//project");for(var j=0;j<projectArr.length;j++)
{var startDateTemp=projectArr[j].getAttribute("startdate");var startDate=startDateTemp.split(",");var project=new GanttProjectInfo(projectArr[j].getAttribute("id"),projectArr[j].getAttribute("name"),new Date(startDate[0],(parseInt(startDate[1])-1),startDate[2]));var taskArr=this.xmlLoader.doXPath("./task",projectArr[j]);for(var i=0;i<taskArr.length;i++){id=taskArr[i].getAttribute("id");name=(this.xmlLoader.doXPath("./name",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./name",taskArr[i])[0].firstChild.nodeValue;var estTemp=(this.xmlLoader.doXPath("./est",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./est",taskArr[i])[0].firstChild.nodeValue;est=estTemp.split(",");duration=(this.xmlLoader.doXPath("./duration",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./duration",taskArr[i])[0].firstChild.nodeValue;percentCompleted=(this.xmlLoader.doXPath("./percentcompleted",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./percentcompleted",taskArr[i])[0].firstChild.nodeValue;predecessorTaskId=(this.xmlLoader.doXPath("./predecessortasks",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./predecessortasks",taskArr[i])[0].firstChild.nodeValue;var task=new GanttTaskInfo(id,name,new Date(est[0],(parseInt(est[1])-1),est[2]),duration,percentCompleted,predecessorTaskId);var childTasksNode=this.xmlLoader.doXPath("./childtasks",taskArr[i]);var childTasksArr=this.xmlLoader.doXPath("./task",childTasksNode[0]);if(childTasksArr.length!=0)this.readChildTasksXML(task,childTasksArr);project.addTask(task);}
this.addProject(project);}};GanttChart.prototype.readChildTasksXML=function(parentTask,childTasksArrXML)
{var name=null;var id=null;var est=null;var duration=null;var percentCompleted=null;var predecessorTaskId=null;for(var i=0;i<childTasksArrXML.length;i++)
{id=childTasksArrXML[i].getAttribute("id");name=(this.xmlLoader.doXPath("./name",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./name",childTasksArrXML[i])[0].firstChild.nodeValue;var estTemp=(this.xmlLoader.doXPath("./est",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./est",childTasksArrXML[i])[0].firstChild.nodeValue;est=estTemp.split(",");duration=(this.xmlLoader.doXPath("./duration",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./duration",childTasksArrXML[i])[0].firstChild.nodeValue;percentCompleted=(this.xmlLoader.doXPath("./percentcompleted",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./percentcompleted",childTasksArrXML[i])[0].firstChild.nodeValue;predecessorTaskId=(this.xmlLoader.doXPath("./predecessortasks",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./predecessortasks",childTasksArrXML[i])[0].firstChild.nodeValue;var task=new GanttTaskInfo(id,name,new Date(est[0],(parseInt(est[1])-1),est[2]),duration,percentCompleted,predecessorTaskId);task.ParentTask=parentTask;parentTask.addChildTask(task);var childTasksNode=this.xmlLoader.doXPath("./childtasks",childTasksArrXML[i]);var childTasksArr=this.xmlLoader.doXPath("./task",childTasksNode[0]);if(childTasksArr.length!=0)
{this.readChildTasksXML(task,childTasksArr);}}};GanttChart.prototype.getXML=function()
{var strXML="<projects>";for(var i=0;i<this.Project.length;i++)
{strXML+="<project id ='"+this.Project[i].Id+"' name= '"+this.Project[i].Name+"' startdate = '"+this.Project[i].StartDate.getFullYear()+","+(this.Project[i].StartDate.getMonth()+1)+","+this.Project[i].StartDate.getDate()+"'>";for(var j=0;j<this.Project[i].ParentTasks.length;j++)
{strXML+="<task id ='"+this.Project[i].ParentTasks[j].Id+"'>";strXML+="<name>"+this.Project[i].ParentTasks[j].Name+"</name>";strXML+="<est>"+this.Project[i].ParentTasks[j].EST.getFullYear()+","+(this.Project[i].ParentTasks[j].EST.getMonth()+1)+","+this.Project[i].ParentTasks[j].EST.getDate()+"</est>";strXML+="<duration>"+this.Project[i].ParentTasks[j].Duration+"</duration>";strXML+="<percentcompleted>"+this.Project[i].ParentTasks[j].PercentCompleted+"</percentcompleted>";strXML+="<predecessortasks>"+this.Project[i].ParentTasks[j].PredecessorTaskId+"</predecessortasks>";strXML+="<childtasks>";strXML+=this.createChildTasksXML(this.Project[i].ParentTasks[j].ChildTasks);strXML+="</childtasks>";strXML+="</task>";}
strXML+="</project>";}
strXML+="</projects>";return strXML;};GanttChart.prototype.createChildTasksXML=function(childTasks)
{var strXML="";for(var n=0;n<childTasks.length;n++)
{strXML+="<task id='"+childTasks[n].Id+"'>";strXML+="<name>"+childTasks[n].Name+"</name>";strXML+="<est>"+childTasks[n].EST.getFullYear()+","+(childTasks[n].EST.getMonth()+1)+","+childTasks[n].EST.getDate()+"</est>";strXML+="<duration>"+childTasks[n].Duration+"</duration>";strXML+="<percentcompleted>"+childTasks[n].PercentCompleted+"</percentcompleted>";strXML+="<predecessortasks>"+childTasks[n].PredecessorTaskId+"</predecessortasks>";if(childTasks[n].ChildTasks)
{strXML+="<childtasks>";strXML+=this.createChildTasksXML(childTasks[n].ChildTasks);strXML+="</childtasks>";}
strXML+="</task>";}
return strXML;};GanttChart.prototype.sort_byEST=function(a,b)
{if(a.EST<b.EST)return-1;if(a.EST>b.EST)return 1;return 0;};GanttChart.prototype.sort_byStartDate=function(a,b)
{if(a["StartDate"]<b["StartDate"])return-1;if(a["StartDate"]>b["StartDate"])return 1;return 0;};GanttChart.prototype.setESTChild=function(parentTask)
{for(var t=0;t<parentTask.ChildTasks.length;t++)
{if((parentTask.ChildTasks[t].EST==null)||(parentTask.ChildTasks[t].EST==""))
{parentTask.ChildTasks[t].EST=parentTask.EST;}
if(parentTask.ChildTasks[t].ChildTasks.length!=0)this.setESTChild(parentTask.ChildTasks[t]);}};GanttChart.prototype.createPanelTasks=function()
{var divTasks=document.createElement("div");divTasks.className="taskPanel";divTasks.style.cssText="position:relative;";divTasks.style.height=this.contentHeight-63+"px";var w=this.startDate?(this.startDate.getDay()-1):((new Date(0)).getDay()-1);if(w==-1)w=6;divTasks.style.background="url("+this.imgs+"bg_week.png) -"+(w*24)+"px 0px";this.panelTasks=divTasks;return divTasks;};GanttChart.prototype.createPanelNamesTasks=function()
{var divListNames=document.createElement("div");divListNames.innerHTML="&nbsp;";divListNames.style.cssText="position:relative;background:url("+this.imgs+"bg.png)";divListNames.style.height=this.contentHeight-63+"px";divListNames.style.width=this.maxWidthPanelNames+"px";return divListNames;};GanttChart.prototype.createPopUpInfo=function()
{var divTaskInfo=document.createElement("div");divTaskInfo.style.cssText='display: none;';var tblTaskInfo=document.createElement("table");tblTaskInfo.style.cssText="position:absolute;top:0px;left:0px";tblTaskInfo.className="poPupInfo";divTaskInfo.appendChild(tblTaskInfo);var rowTaskInfo=tblTaskInfo.insertRow(tblTaskInfo.rows.length);var cellTaskInfo=document.createElement("td");rowTaskInfo.appendChild(cellTaskInfo);this.divInfo=divTaskInfo;return divTaskInfo;};GanttChart.prototype.createPopUpTimeInfo=function()
{var divTimeInfo=document.createElement("div");divTimeInfo.style.display="none";var tblTimeInfo=document.createElement("table");tblTimeInfo.className="poPupTime";divTimeInfo.appendChild(tblTimeInfo);var rowTimeInfo=tblTimeInfo.insertRow(tblTimeInfo.rows.length);var cellTimeInfo=document.createElement("td");cellTimeInfo.align="center";rowTimeInfo.appendChild(cellTimeInfo);return divTimeInfo;};GanttChart.prototype.createPanelTime=function()
{var panelTime=document.createElement("div");panelTime.style.position="relative";var tblTime=document.createElement("table");panelTime.appendChild(tblTime);tblTime.cellPadding="0px";tblTime.border="0px";tblTime.cellSpacing="0px";tblTime.bgColor="#FFFFFF";tblTime.style.marginTop="0px";var monthRow=tblTime.insertRow(tblTime.rows.length);var newRow=tblTime.insertRow(tblTime.rows.length);for(var i=0;i<this.countDays;i++)
{this.addPointInTimePanel(newRow,panelTime);this.addDayInPanelTime(newRow);}
return panelTime;};GanttChart.prototype.addPointInTimePanel=function(row,panelTime)
{var leftLine=document.createElement("div");leftLine.style.cssText="position:absolute;left:"+(row.cells.length*this.dayInPixels)+"px;top:20px;height:20px;width:1px;font-size:1px;margin-left:0px;margin-right:0px;margin-top:0px;margin-bottom:0px;background:#f1f3f1;";panelTime.appendChild(leftLine);};GanttChart.prototype._calculateMonthColSpan=function(date,maxLen){var m1=date.getMonth();for(var i=1;i<=maxLen;i++){date.setDate(date.getDate()+1);var m2=date.getMonth();if(m2!=m1)return i;}
return maxLen;};GanttChart.prototype.getMonthScaleLabel=function(date){return(this._useShortMonthNames?this.shortMonthNames:this.monthNames)[date.getMonth()]+" '"+(""+date.getFullYear()).substring(2);};GanttChart.prototype.useShortMonthNames=function(flag){this._useShortMonthNames=flag;};GanttChart.prototype.setShortMonthNames=function(names){this.shortMonthNames=names;};GanttChart.prototype.setMonthNames=function(names){this.monthNames=names;};GanttChart.prototype.addDayInPanelTime=function(row)
{var self=this,idx=row.cells.length,date=new Date(this.startDate);var newCell=row.insertCell(idx);newCell.style.height="20px";newCell.style.width=this.dayInPixels+"px";newCell.className="dayNumber";date.setDate(date.getDate()+parseInt(idx));var day=date.getDate()
newCell.innerHTML=day;newCell.setAttribute("idx",idx);var monthRow=row.parentNode.parentNode.rows[0];if(idx==0||day==1){var newCell2=monthRow.insertCell(monthRow.cells.length);newCell2.className="monthName";newCell2.style.height="20px";if(monthRow.cells.length%2==0)newCell2.style.backgroundColor="#f7f8f7";newCell2.colSpan=this._calculateMonthColSpan(new Date(date),Math.max(1,this.countDays-idx));newCell2.innerHTML=this.getMonthScaleLabel(date);}else{var n=monthRow.cells.length,cs=0;for(var i=0;i<n;i++){cs+=monthRow.cells[i].colSpan;}
if(idx>=cs)monthRow.cells[n-1].colSpan+=1;}
var w=date.getDay();if(w==0||w==6)newCell.style.backgroundColor="#f7f8f7";};GanttChart.prototype.incHeightPanelTasks=function(height)
{var containerTasks=this.oData.firstChild;containerTasks.style.height=parseInt(containerTasks.style.height)+height+"px";};GanttChart.prototype.incHeightPanelNames=function(height)
{var containerNames=this.panelNames.firstChild;containerNames.style.height=parseInt(containerNames.style.height)+height+"px";};GanttChart.prototype.checkHeighPanelTasks=function()
{this._oDataHeight+=11+this.heightTaskItem;if((parseInt(this.oData.firstChild.style.height)<=this._oDataHeight)){this.incHeightPanelTasks(this.heightTaskItem+11);if(this._showTreePanel)this.incHeightPanelNames(this.heightTaskItem+11);}};GanttChart.prototype.sortTasksByEST=function(project)
{project.ParentTasks.sort(this.sort_byEST);for(var i=0;i<project.ParentTasks.length;i++)
{project.ParentTasks[i]=this.sortChildTasks(project.ParentTasks[i]);}};GanttChart.prototype.sortChildTasks=function(parenttask)
{parenttask.ChildTasks.sort(this.sort_byEST);for(var i=0;i<parenttask.ChildTasks.length;i++)
{if(parenttask.ChildTasks[i].ChildTasks.length>0)this.sortChildTasks(parenttask.ChildTasks[i]);}
return parenttask;};GanttChart.prototype.errorDataHandler=function(type,descr,params)
{if(!this._isError)
{this.clearData();this.showPanelErrors();this._isError=true;}
this.addErrorInPanelErrors(type,descr);};GanttChart.prototype.createPanelErrors=function()
{var tbl=document.createElement("table");tbl.width="100%";tbl.style.display="none";tbl.className="panelErrors";this.panelErrors=tbl;return tbl;};GanttChart.prototype.showPanelErrors=function()
{this.panelErrors.style.display="inline";};GanttChart.prototype.hidePanelErrors=function()
{for(var i=0;i<this.panelErrors.rows.length;i++){this.panelErrors.rows[i].parentNode.removeChild(this.panelErrors.rows[i]);}
this.panelErrors.style.display="none";};GanttChart.prototype.addErrorInPanelErrors=function(type,descr)
{var row=this.panelErrors.insertRow(this.panelErrors.rows.length);var cell=document.createElement("td");cell.style.height="20px";cell.style.width="100px";cell.innerHTML=type;row.appendChild(cell);cell=document.createElement("td");row.appendChild(cell);cell.innerHTML=descr;};GanttChart.prototype.errorSendDataHandler=function(type,descr,params)
{alert(descr);};GanttChart.prototype.errorLoadDataHandler=function(type,descr,params)
{alert(descr);};GanttChart.prototype.errorAPIHandler=function(type,descr,params)
{alert(descr);};GanttChart.prototype.saveData=function(fileName)
{try{if(!this.dhtmlXMLSenderObject.isProcessed)
{this.dhtmlXMLSenderObject.sendData(fileName,this.savePath,this.getXML());}}catch(e){this.Error.throwError("DATA_SEND_ERROR",e,null);}};GanttChart.prototype.create=function(divId)
{var self=this;var content=document.getElementById(divId);this.content=content;this.getBrowserType();if(this._isIE){document.body.attachEvent('onselectstart',function(){window.event.returnValue=false;});document.body.attachEvent('onkeydown',function(){if(event.keyCode==65&&event.ctrlKey)window.event.returnValue=false;});}else{content.addEventListener('mousedown',function(e){e.preventDefault();},true);document.addEventListener('keydown',function(e){if(e.keyCode==65&&e.ctrlKey)e.preventDefault();},true);}
this.Error.catchError("DATA_ERROR",function(type,descr,params){self.errorDataHandler(type,descr,params)});this.Error.catchError("DATA_SEND_ERROR",function(type,descr,params){self.errorSendDataHandler(type,descr,params)});this.Error.catchError("DATA_INSERT_ERROR",function(type,descr,params){self.errorAPIHandler(type,descr,params)});this.Error.catchError("DATA_LOAD_ERROR",function(type,descr,params){self.errorLoadDataHandler(type,descr,params)});var tableControl=document.createElement("table");tableControl.cellPadding="0";tableControl.cellSpacing="0";tableControl.style.cssText="width: 100%; position: relative;";var newRowTblControl=tableControl.insertRow(tableControl.rows.length);var newCellTblControl;this.contentHeight=content.offsetHeight;this.contentWidth=content.offsetWidth;content.appendChild(tableControl);this.countDays=this.getCountDays();this.Project.sort(this.sort_byStartDate);this.startDate=this.getStartDate();this.panelTime=document.createElement("div");this.panelTime.appendChild(this.createPanelTime());this.panelTime.style.cssText="position:relative;overflow:hidden;height:40px;top:0px;left:1px";this.oData=document.createElement("div");this.oData.appendChild(this.createPanelTasks());this.oData.style.cssText="position:relative;overflow:scroll;height:"+(this.contentHeight-40)+"px;border-left:#f1f3f1 1px solid";this.oData.firstChild.appendChild(this.createPanelErrors());if(this._showTreePanel)
{this.panelNames=document.createElement("div");newCellTblControl=document.createElement("td");newCellTblControl.vAlign="top";this.panelNames.appendChild(this.createPanelNamesTasks());this.panelNames.style.cssText="position:relative;top:40px;overflow:hidden;border-left:#f1f3f1 1px solid;border-bottom:#f1f3f1 1px solid";newCellTblControl.appendChild(this.panelNames);newRowTblControl.appendChild(newCellTblControl);}
newCellTblControl=document.createElement("td");var divCell=document.createElement("div");divCell.style.cssText="position: relative;";divCell.appendChild(this.panelTime);divCell.appendChild(this.oData);newCellTblControl.appendChild(divCell);newRowTblControl.appendChild(newCellTblControl);if(this._showTreePanel){this.panelNames.style.height=(this.contentHeight-56)+"px";this.panelNames.style.width=this.maxWidthPanelNames+"px";this.oData.style.width=(this.contentWidth-this.maxWidthPanelNames)+"px";this.panelTasks.style.width=this.dayInPixels*this.countDays+"px";this.panelTime.style.width=(this.contentWidth-this.maxWidthPanelNames-0*18)+"px";this.panelTime.firstChild.style.width=this.dayInPixels*this.countDays+"px";if(this.isShowConMenu&&this.contextMenu==null)this.contextMenu=new contextMenu(this);}else{this.oData.style.width=this.contentWidth+"px";this.panelTime.style.width=(this.contentWidth-16)+"px";}
if(this._isOpera){this.oData.onmousewheel=function(){return false;}}
this.oData.onscroll=function(){self.panelTime.scrollLeft=this.scrollLeft;if(self.panelNames){self.panelNames.scrollTop=this.scrollTop;if(self.isShowConMenu)self.contextMenu.hideContextMenu();}};this.divTimeInfo=this.createPopUpTimeInfo();divCell.appendChild(this.divTimeInfo);this.oData.firstChild.appendChild(this.createPopUpInfo());for(var i=0;i<this.Project.length;i++)
{for(var k=0;k<this.Project[i].ParentTasks.length;k++)
{if(this.isEmpty(this.Project[i].ParentTasks[k].EST)){this.Project[i].ParentTasks[k].EST=this.Project[i].StartDate;}
this.setESTChild(this.Project[i].ParentTasks[k]);if(this.setPredTask(this.Project[i]))return;}
for(var k=0;k<this.Project[i].ParentTasks.length;k++){if(this.Project[i].ParentTasks[k].EST<this.Project[i].StartDate){if(!this.correctError){this.Error.throwError("DATA_ERROR",24,[this.Project[i].ParentTasks[k].Id,this.Project[i].Id]);return;}else{this.Project[i].ParentTasks[k].EST=this.Project[i].StartDate;}}
if(this.checkPosParentTaskInTree(this.Project[i].ParentTasks[k]))return;}
this.sortTasksByEST(this.Project[i]);}
for(var i=0;i<this.Project.length;i++)
{var project=new GanttProject(this,this.Project[i]);if(this.arrProjects.length>0)
{var previousProject=this.arrProjects[this.arrProjects.length-1];project.previousProject=previousProject;previousProject.nextProject=project;}
project.create();this.checkHeighPanelTasks();this.arrProjects.push(project);this.createTasks(project);}
return this;};GanttChart.prototype.isEmpty=function(value)
{return(value==null||value=='');};GanttChart.prototype.getPrintableHTML=function()
{var w=parseInt(this.oData.firstChild.style.width)-parseInt(this.oData.style.width);var h=parseInt(this.panelTasks.style.height)-parseInt(this.panelTasks.parentNode.style.height);this.oData.setAttribute("id","ganttPrint02");this.panelNames.setAttribute("id","ganttPrint03");var res='<html><head><link type="text/css" rel="stylesheet" href="'+this.stylePath+'"><scr'+'ipt>onload=function(){var w='+w+',h='+h+',c1=document.getElementById("ganttPrint01"),c2=document.getElementById("ganttPrint02"),c3=document.getElementById("ganttPrint03");'+'c2.style.width=parseInt(c2.style.width)+w+"px";c2.previousSibling.style.width=c2.style.width;c1.style.width=parseInt(c1.style.width)+w+"px";c2.style.height=parseInt(c2.style.height)+h+"px";'+'c2.style.overflow="hidden";c3.style.height=c3.firstChild.style.height;c1.style.height=parseInt(c1.style.height)+h+"px";}</scr'+'ipt></head>'+'<body><div id="ganttPrint01" style="'+this.content.style.cssText+'">'+this.content.innerHTML+'</div></body></html>';this.oData.setAttribute("id",null);this.panelNames.setAttribute("id",null);return res;};GanttChart.prototype.printToWindow=function(message)
{var o=window.open();o.document.write(this.getPrintableHTML());o.document.close();if(message!==null){o.alert(message?message:"Use browser's menu \"File->Print preview\" to setup page layout.");}};GanttChart.prototype.getStartDate=function()
{for(var i=0;i<this.Project.length;i++){if(this.startDate){if(this.Project[i].StartDate<this.startDate){this.startDate=new Date(this.Project[i].StartDate);}}
else{this.startDate=new Date(this.Project[i].StartDate);}}
this.initialPos=24*this.hourInPixels;if(this.startDate){return new Date(this.startDate.setHours(this.startDate.getHours()-24));}
else{return new Date();}};GanttChart.prototype.getCountDays=function()
{if(this._showTreePanel){return parseInt((this.contentWidth-this.maxWidthPanelNames)/(this.hourInPixels*24));}else{return parseInt((this.contentWidth)/(this.hourInPixels*24));}};GanttChart.prototype.createTasks=function(project)
{for(var j=0;j<project.Project.ParentTasks.length;j++)
{if(j>0)
{project.Project.ParentTasks[j-1].nextParentTask=project.Project.ParentTasks[j];project.Project.ParentTasks[j].previousParentTask=project.Project.ParentTasks[j-1];}
var task=new GanttTask(project.Project.ParentTasks[j],project,this);project.arrTasks.push(task);task.create();this.checkHeighPanelTasks();if(project.Project.ParentTasks[j].ChildTasks.length>0)
{this.createChildItemControls(project.Project.ParentTasks[j].ChildTasks,project);}}};GanttChart.prototype.createChildItemControls=function(arrChildTasks,project)
{for(var i=0;i<arrChildTasks.length;i++){if(i>0)
{arrChildTasks[i].previousChildTask=arrChildTasks[i-1];arrChildTasks[i-1].nextChildTask=arrChildTasks[i];}
var task=new GanttTask(arrChildTasks[i],project,this);task.create();this.checkHeighPanelTasks();if(arrChildTasks[i].ChildTasks.length>0)
{this.createChildItemControls(arrChildTasks[i].ChildTasks,project);}}};GanttTask.prototype.getPopUpInfo=function(object,event)
{var posY=object.offsetTop+this.Chart.heightTaskItem+6;var posX=object.offsetLeft+((event.layerX==null)?event.offsetX:event.layerX);var tblInfo=this.Chart.divInfo.lastChild;tblInfo.rows[0].cells[0].innerHTML="<div style='font-family: Arial, Helvetica, Sans-serif; font-size: 12px; font-weight: bold; color: #688060; margin: 0 0 4px 0;'>"+this.TaskInfo.Name+"</div>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>EST:&nbsp;</span><span class='ut'>"+this.TaskInfo.EST.getDate()+"."+(this.TaskInfo.EST.getMonth()+1)+"."+this.TaskInfo.EST.getFullYear()+"</span><br/>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Duration:&nbsp;</span><span class='ut'>"+this.TaskInfo.Duration+" hours </span><br/>";if(this.predTask)
{tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Predecessor Task:&nbsp;</span>";tblInfo.rows[0].cells[0].innerHTML+="<span class='lt'>*"+this.TaskInfo.PredecessorTask.Name+"</span>";}
if(this.TaskInfo.ChildTasks.length!=0){tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Child Tasks:&nbsp;</span>";for(var i=0;i<this.TaskInfo.ChildTasks.length;i++)
{tblInfo.rows[0].cells[0].innerHTML+=(i==this.TaskInfo.ChildTasks.length-1)?("<span class='lt'>*"+this.TaskInfo.ChildTasks[i].Name+"</span>"):("<span class='lt'>*"+this.TaskInfo.ChildTasks[i].Name+"</span>");}}
if(this.TaskInfo.ParentTask){tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Parent Task:&nbsp;</span>";tblInfo.rows[0].cells[0].innerHTML+="<span class='lt'>*"+this.TaskInfo.ParentTask.Name+"</span>";}
this.Chart.divInfo.style.cssText="z-index:2;position: absolute;display: inline;";if(posY+this.Chart.divInfo.lastChild.offsetHeight+10>this.Chart.oData.offsetHeight+this.Chart.oData.scrollTop){this.Chart.divInfo.style.top=(posY-this.Chart.divInfo.lastChild.offsetHeight-10-this.Chart.heightTaskItem)+"px";}
else{this.Chart.divInfo.style.top=posY+"px";}
if(this.Chart.divInfo.lastChild.offsetWidth+posX+10>this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft){this.Chart.divInfo.style.left=posX-(this.Chart.divInfo.lastChild.offsetWidth+posX+20-(this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft))+"px";}else{this.Chart.divInfo.style.left=posX+"px";}};GanttTask.prototype.closePopUpInfo=function()
{this.Chart.divInfo.style.display="none";};GanttTask.prototype.createConnectingLinesPN=function()
{var arrConnectingLinesNames=[];return arrConnectingLinesNames;};GanttTask.prototype.createConnectingLinesDS=function()
{var oData=this.Chart.oData.firstChild;var arrLines=[];var arrowImg=new Image();arrowImg.src=this.Chart.imgs+"arr.gif";var lineVerticalRight=document.createElement("div");var lineHorizontal=document.createElement("div");var posXPredecessorTask=parseInt(this.predTask.cTaskItem[0].style.left);var posYPredecessorTask=parseInt(this.predTask.cTaskItem[0].style.top);var posXChildTask=parseInt(this.cTaskItem[0].style.left);var posYChildTask=this.posY+2;var widthChildTask=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);var widthPredecessorTask=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);if(posYPredecessorTask<posYChildTask)
{lineVerticalRight.style.cssText="border-width: 0px 0px 0px 1px; border-style: solid; border-color: #4A8F43;margin: 0px; padding: 0px;z-index:0;font-size: 1px;position: absolute;"+"height:"+(posYChildTask-this.Chart.heightTaskItem/2-posYPredecessorTask-3)+"px;width:"+1+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYPredecessorTask+this.Chart.heightTaskItem)+"px;";lineHorizontal.style.cssText="height:1px;border-color: #4A8F43;border-style: solid;border-width: 1px 0px 0px 0px;margin: 0px; padding: 0px;z-index:0;position: absolute;"+"width:"+(15+(posXChildTask-(widthPredecessorTask+posXPredecessorTask)))+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYChildTask+2)+"px;";arrowImg.style.cssText="margin: 0px; padding: 0px;width:7px;height:14px;position: absolute;left:"+(posXChildTask-7)+"px;top:"+(posYChildTask-1)+"px;";}else{lineVerticalRight.style.cssText="border-width: 0px 0px 0px 1px; border-style: solid; border-color: #4A8F43;margin: 0px; padding: 0px;z-index:0;font-size: 1px;position: absolute;"+"height:"+(posYPredecessorTask+2-posYChildTask)+"px;width:"+1+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYChildTask+2)+"px;";lineHorizontal.style.cssText="height:1px;border-color: #4A8F43;border-style: solid;border-width: 1px 0px 0px 0px;margin: 0px; padding: 0px;z-index:0;position: absolute;"+"width:"+(15+(posXChildTask-(widthPredecessorTask+posXPredecessorTask)))+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYChildTask+2)+"px;";arrowImg.style.cssText="margin: 0px; padding: 0px;width:7px;height:14px;position: absolute;left:"+(posXChildTask-7)+"px;top:"+(posYChildTask-1)+"px;";}
oData.appendChild(lineVerticalRight);oData.appendChild(lineHorizontal);oData.appendChild(arrowImg);arrLines.push(lineVerticalRight);arrLines.push(arrowImg);arrLines.push(lineHorizontal);return arrLines;};GanttTask.prototype.showChildTasks=function(task,isOpen)
{if(isOpen)
{for(var i=0;i<task.childTask.length;i++)
{if(task.childTask[i].cTaskItem[0].style.display=="none"){task.childTask[i].cTaskItem[0].style.display="inline";task.childTask[i].cTaskNameItem[0].style.display="inline";if(this.Chart.isShowDescTask){task.childTask[i].showDescTask();}
task.isHide=false;if(task.childTask[i].cTaskNameItem[2]){task.childTask[i].cTaskNameItem[2].style.display="inline";isOpen=task.childTask[i]._isOpen;}
for(var k=0;k<task.childTask[i].cTaskItem[1].length;k++){task.childTask[i].cTaskItem[1][k].style.display="inline";}
for(var k=0;k<task.childTask[i].cTaskNameItem[1].length;k++){task.childTask[i].cTaskNameItem[1][k].style.display="inline";}
this._heightHideTasks+=this.Chart.heightTaskItem+11;if(task.childTask[i].childTask.length>0){this.showChildTasks(task.childTask[i],isOpen);}}}}};GanttTask.prototype.hideChildTasks=function(task)
{for(var i=0;i<task.childTask.length;i++)
{if(task.childTask[i].cTaskItem[0].style.display!="none")
{task.childTask[i].cTaskItem[0].style.display="none";task.childTask[i].cTaskNameItem[0].style.display="none";if(this.Chart.isShowDescTask){task.childTask[i].hideDescTask();}
task.isHide=true;if(task.childTask[i].cTaskNameItem[2]){task.childTask[i].cTaskNameItem[2].style.display="none";}
for(var k=0;k<task.childTask[i].cTaskItem[1].length;k++){task.childTask[i].cTaskItem[1][k].style.display="none";}
for(var k=0;k<task.childTask[i].cTaskNameItem[1].length;k++){task.childTask[i].cTaskNameItem[1][k].style.display="none";}
this._heightHideTasks+=this.Chart.heightTaskItem+11;if(task.childTask[i].childTask.length>0){this.hideChildTasks(task.childTask[i]);}}}};GanttTask.prototype.shiftCurrentTasks=function(task,height)
{this.shiftNextTask(this,height);task.Project.shiftNextProject(task.Project,height);};GanttProject.prototype.shiftNextProject=function(project,height)
{if(project.nextProject){project.nextProject.shiftProject(height);this.shiftNextProject(project.nextProject,height);}};GanttProject.prototype.shiftProject=function(height)
{this.projectItem[0].style.top=parseInt(this.projectItem[0].style.top)+height+"px";if(this.Chart.isShowDescProject){this.descrProject.style.top=parseInt(this.descrProject.style.top)+height+"px";}
if(this.Chart._showTreePanel){this.projectNameItem.style.top=parseInt(this.projectNameItem.style.top)+height+"px";}
if(this.arrTasks.length>0)
this.shiftNextParentTask(this.arrTasks[0],height);};GanttProject.prototype.shiftTask=function(task,height)
{if(this.Chart._showTreePanel){task.cTaskNameItem[0].style.top=parseInt(task.cTaskNameItem[0].style.top)+height+"px";if(task.cTaskNameItem[2]){task.cTaskNameItem[2].style.top=parseInt(task.cTaskNameItem[2].style.top)+height+"px";}
if(task.parentTask&&task.cTaskNameItem[1][0])
{task.cTaskNameItem[1][0].style.top=parseInt(task.cTaskNameItem[1][0].style.top)+height+"px";task.cTaskNameItem[1][1].style.top=parseInt(task.cTaskNameItem[1][1].style.top)+height+"px";}}
task.cTaskItem[0].style.top=parseInt(task.cTaskItem[0].style.top)+height+"px";if(this.Chart.isShowDescTask){task.descrTask.style.top=parseInt(task.descrTask.style.top)+height+"px";}
if(task.cTaskItem[1][0])
{task.cTaskItem[1][0].style.top=parseInt(task.cTaskItem[1][0].style.top)+height+"px";task.cTaskItem[1][1].style.top=parseInt(task.cTaskItem[1][1].style.top)+height+"px";task.cTaskItem[1][2].style.top=parseInt(task.cTaskItem[1][2].style.top)+height+"px";}};GanttProject.prototype.shiftNextParentTask=function(task,height)
{this.shiftTask(task,height);this.shiftChildTasks(task,height);if(task.nextParentTask){this.shiftNextParentTask(task.nextParentTask,height);}};GanttProject.prototype.shiftChildTasks=function(task,height)
{for(var i=0;i<task.childTask.length;i++)
{this.shiftTask(task.childTask[i],height);if(task.childTask[i].childTask.length>0){this.shiftChildTasks(task.childTask[i],height);}}};GanttTask.prototype.shiftTask=function(task,height)
{if(this.Chart._showTreePanel){task.cTaskNameItem[0].style.top=parseInt(task.cTaskNameItem[0].style.top)+height+"px";if(task.cTaskNameItem[2]){task.cTaskNameItem[2].style.top=parseInt(task.cTaskNameItem[2].style.top)+height+"px";}
if(task.parentTask)
{if(task.cTaskNameItem[1].length>0)if((parseInt(this.cTaskNameItem[0].style.top)>parseInt(task.parentTask.cTaskNameItem[0].style.top))&&(task.cTaskNameItem[1][0].style.display!="none")){task.cTaskNameItem[1][0].style.height=parseInt(task.cTaskNameItem[1][0].style.height)+height+"px";}else{task.cTaskNameItem[1][0].style.top=parseInt(task.cTaskNameItem[1][0].style.top)+height+"px";}
if(task.cTaskNameItem[1].length>1)task.cTaskNameItem[1][1].style.top=parseInt(task.cTaskNameItem[1][1].style.top)+height+"px";}}
task.cTaskItem[0].style.top=parseInt(task.cTaskItem[0].style.top)+height+"px";if(this.Chart.isShowDescTask){task.descrTask.style.top=parseInt(task.descrTask.style.top)+height+"px";}
if(task.predTask)
{if(task.cTaskItem[1].length>0)if(((parseInt(this.cTaskItem[0].style.top)>parseInt(task.predTask.cTaskItem[0].style.top))||(this.cTaskItem[0].id==task.predTask.TaskInfo.Id))&&task.cTaskItem[1][0].style.display!="none"){task.cTaskItem[1][0].style.height=parseInt(task.cTaskItem[1][0].style.height)+height+"px";}else{task.cTaskItem[1][0].style.top=parseInt(task.cTaskItem[1][0].style.top)+height+"px";}
if(task.cTaskItem[1].length>2){task.cTaskItem[1][1].style.top=parseInt(task.cTaskItem[1][1].style.top)+height+"px";task.cTaskItem[1][2].style.top=parseInt(task.cTaskItem[1][2].style.top)+height+"px";}}};GanttTask.prototype.shiftNextTask=function(task,height)
{if(task.nextChildTask){this.shiftTask(task.nextChildTask,height);this.shiftChildTask(task.nextChildTask,height);this.shiftNextTask(task.nextChildTask,height);}else if(task.parentTask){this.shiftNextTask(task.parentTask,height);}else if(task.nextParentTask){this.shiftTask(task.nextParentTask,height);this.shiftChildTask(task.nextParentTask,height);this.shiftNextTask(task.nextParentTask,height);}};GanttTask.prototype.shiftChildTask=function(task,height)
{for(var i=0;i<task.childTask.length;i++)
{this.shiftTask(task.childTask[i],height);if(task.childTask[i].childTask.length>0){this.shiftChildTask(task.childTask[i],height);}}};GanttChart.prototype.getPosOnDate=function(est)
{return(est-this.startDate)/(60*60*1000)*this.hourInPixels;};GanttChart.prototype.getWidthOnDuration=function(duration)
{return Math.round(this.hourInPixelsWork*duration);};GanttTask.prototype.endMove=function()
{var width=parseInt(this.cTaskItem[0].style.left)-this.posX;var est=this.getDateOnPosition(parseInt(this.cTaskItem[0].style.left));est=this.checkPos(est);this.wasMoved=this.TaskInfo.EST.valueOf()!=est.valueOf();if(this.checkMove){width=this.Chart.getPosOnDate(est)-this.posX;this.moveCurrentTaskItem(width,this.moveChild);this.Project.shiftProjectItem();}
this.checkMove=false;this.posX=0;this.maxPosXMove=-1;this.minPosXMove=-1;this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML="";if(this.Chart._isFF)document.body.style.cursor="";if(this.Chart._isIE)this.cTaskItem[0].childNodes[2].childNodes[0].style.cursor="";};GanttTask.prototype.checkPos=function(est)
{var h=est.getHours();if(h>=12)
{est.setDate(est.getDate()+1);est.setHours(0);if((parseInt(this.cTaskItem[0].firstChild.firstChild.width)+this.Chart.getPosOnDate(est)>this.maxPosXMove)&&(this.maxPosXMove!=-1))
{est.setDate(est.getDate()-1);est.setHours(0);}}else if((h<12)&&(h!=0))
{est.setHours(0);if((this.Chart.getPosOnDate(est)<this.minPosXMove))
{est.setDate(est.getDate()+1);}}
this.cTaskItem[0].style.left=this.Chart.getPosOnDate(est)+"px";return est;};GanttTask.prototype.getMaxPosPredChildTaskItem=function()
{var posPredChildTaskItem=0;var nextPosPredChildTaskItem=0;for(var i=0;i<this.childPredTask.length;i++)
{nextPosPredChildTaskItem=this.getMaxPosPredChildTaskItemInTree(this.childPredTask[i]);if(nextPosPredChildTaskItem>posPredChildTaskItem)
{posPredChildTaskItem=nextPosPredChildTaskItem;}}
return posPredChildTaskItem;};GanttTask.prototype.getMaxPosPredChildTaskItemInTree=function(task)
{var currentPos=parseInt(task.cTaskItem[0].firstChild.firstChild.width)+parseInt(task.cTaskItem[0].style.left);var posPredChildTaskItem=0;var nextPosPredChildTaskItem=0;for(var i=0;i<task.childPredTask.length;i++)
{nextPosPredChildTaskItem=this.getMaxPosPredChildTaskItemInTree(task.childPredTask[i]);if(nextPosPredChildTaskItem>posPredChildTaskItem)
{posPredChildTaskItem=nextPosPredChildTaskItem;}}
if(posPredChildTaskItem>currentPos)
{return posPredChildTaskItem;}
else
{return currentPos;}};GanttProject.prototype.getTaskById=function(id)
{for(var i=0;i<this.arrTasks.length;i++)
{var task=this.searchTaskInTree(this.arrTasks[i],id);if(task)return task;}
return null;};GanttProject.prototype.searchTaskInTree=function(task,id)
{if(task.TaskInfo.Id==id)
{return task;}else
{for(var i=0;i<task.childTask.length;i++)
{if(task.childTask[i].TaskInfo.Id==id)
{return task.childTask[i];}
else
{if(task.childTask[i].childTask.length>0)
{var cTask=this.searchTaskInTree(task.childTask[i],id);if(cTask)return cTask;}}}}
return null;};GanttProject.prototype.shiftProjectItem=function()
{var posItemL=null;var posItemR=null;var posProjectItemL=parseInt(this.projectItem[0].style.left);var posProjectItemR=parseInt(this.projectItem[0].firstChild.style.width)+parseInt(this.projectItem[0].style.left);var widthProjectItem=parseInt(this.projectItem[0].firstChild.style.width);for(var t=0;t<this.arrTasks.length;t++)
{var tmpPosItemL=parseInt(this.arrTasks[t].cTaskItem[0].style.left);var tmpPosItemR=parseInt(this.arrTasks[t].cTaskItem[0].style.left)+parseInt(this.arrTasks[t].cTaskItem[0].firstChild.firstChild.width);if(!posItemL){posItemL=tmpPosItemL;}
if(!posItemR){posItemR=tmpPosItemR;}
if(posItemL>tmpPosItemL){posItemL=tmpPosItemL;}
if(posItemR<tmpPosItemR){posItemR=tmpPosItemR;}}
if(posItemL!=posProjectItemL)
{this.Project.StartDate=new Date(this.Chart.startDate);this.Project.StartDate.setHours(this.Project.StartDate.getHours()+(posItemL/this.Chart.hourInPixels));}
this.projectItem[0].style.left=posItemL+"px";this.resizeProjectItem(posItemR-posItemL);this.Duration=Math.round(parseInt(this.projectItem[0].firstChild.width)/(this.Chart.hourInPixelsWork));if(this.Chart.isShowDescProject){this.moveDescrProject();}
this.addDayInPanelTime();};GanttProject.prototype.addDayInPanelTime=function()
{var width=parseInt(this.projectItem[0].style.left)+parseInt(this.projectItem[0].firstChild.style.width)+20;if(this.Chart.isShowDescProject){width+=this.descrProject.offsetWidth;}
var table=this.Chart.panelTime.firstChild,tbody=table.firstChild;if(parseInt(tbody.offsetWidth)<width)
{var countDays=Math.round((width-parseInt(tbody.offsetWidth))/this.Chart.dayInPixels);var row=tbody.rows[1];for(var n=0;n<countDays;n++)
{this.Chart.addPointInTimePanel(row,table);this.Chart.addDayInPanelTime(row);}
var w=this.Chart.dayInPixels*(row.cells.length);tbody.style.width=w+"px";this.Chart.panelTasks.style.width=(w-18)+"px";}};GanttProject.prototype.addEvent=function(elm,evType,fn,useCapture)
{if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}
else if(elm.attachEvent){return elm.attachEvent('on'+evType,fn);}
else{elm['on'+evType]=fn;}};GanttProject.prototype.getPopUpInfo=function(object,event)
{var posX=object.offsetLeft+((event.layerX==null)?event.offsetX:event.layerX);var posY=object.offsetTop+this.Chart.heightTaskItem+6;var tblInfo=this.Chart.divInfo.lastChild;tblInfo.rows[0].cells[0].innerHTML="<div style='font-family: Arial, Helvetica, Sans-serif; font-size: 12px; font-weight: bold; color: #688060; margin:0 0 4px 0;'>"+this.Project.Name+"</div>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Start Date:&nbsp;</span><span class='ut'>"+this.Project.StartDate.getDate()+"."+(this.Project.StartDate.getMonth()+1)+"."+this.Project.StartDate.getFullYear()+"</span><br/>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Duration:&nbsp;</span><span class='ut'>"+this.Duration+" hours</span><br/>";this.Chart.divInfo.style.cssText="z-index:2;position: absolute;display: inline;";if(posY+this.Chart.divInfo.lastChild.offsetHeight+6>this.Chart.oData.offsetHeight+this.Chart.oData.scrollTop)
{this.Chart.divInfo.style.top=(posY-this.Chart.divInfo.lastChild.offsetHeight-10-this.Chart.heightTaskItem)+"px";}
else{this.Chart.divInfo.style.top=posY+"px";}
if(this.Chart.divInfo.lastChild.offsetWidth+posX+10>this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft)
{this.Chart.divInfo.style.left=posX-(this.Chart.divInfo.lastChild.offsetWidth+posX+20-(this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft))+"px";}else{this.Chart.divInfo.style.left=posX+"px";}};GanttProject.prototype.closePopUpInfo=function()
{this.Chart.divInfo.style.display="none";};GanttProject.prototype.resizeProjectItem=function(width)
{var percentCompleted=this.percentCompleted;if(percentCompleted>0&&percentCompleted<100)
{this.projectItem[0].firstChild.style.width=width+"px";this.projectItem[0].firstChild.width=width+"px";this.projectItem[0].style.width=width+"px";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=Math.round(width*percentCompleted/100)+"px";this.projectItem[0].firstChild.rows[0].cells[1].firstChild.style.width=Math.round(width*(100-percentCompleted)/100)+"px";this.projectItem[0].lastChild.firstChild.width=width+"px";}else if(percentCompleted==0||percentCompleted==100)
{this.projectItem[0].firstChild.style.width=width+"px";this.projectItem[0].firstChild.width=width+"px";this.projectItem[0].style.width=width+"px";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=width+"px";this.projectItem[0].lastChild.firstChild.width=width+"px";}};GanttTask.prototype.moveCurrentTaskItem=function(width,moveChild)
{var taskItem=this.cTaskItem[0];this.TaskInfo.EST=new Date(this.Chart.startDate);this.TaskInfo.EST.setHours(this.TaskInfo.EST.getHours()+(parseInt(taskItem.style.left)/this.Chart.hourInPixels));if(this.Chart.isShowDescTask){this.showDescTask();}
if(this.cTaskItem[1].length>0){this.cTaskItem[1][2].style.width=parseInt(this.cTaskItem[1][2].style.width)+width+"px";this.cTaskItem[1][1].style.left=parseInt(this.cTaskItem[1][1].style.left)+width+"px";}
for(var i=0;i<this.childTask.length;i++){if(!this.childTask[i].predTask){this.moveChildTaskItems(this.childTask[i],width,moveChild);}}
for(var i=0;i<this.childPredTask.length;i++){this.moveChildTaskItems(this.childPredTask[i],width,moveChild);}};GanttTask.prototype.moveChildTaskItems=function(task,width,moveChild)
{var taskItem=task.cTaskItem[0];if(moveChild)
{taskItem.style.left=parseInt(taskItem.style.left)+width+"px";task.addDayInPanelTime();task.TaskInfo.EST=new Date(this.Chart.startDate);task.TaskInfo.EST.setHours(task.TaskInfo.EST.getHours()+(parseInt(taskItem.style.left)/this.Chart.hourInPixels));for(var n=0;n<task.cTaskItem[1].length;n++){task.cTaskItem[1][n].style.left=parseInt(task.cTaskItem[1][n].style.left)+width+"px";}
for(var i=0;i<task.childTask.length;i++){if(!task.childTask[i].predTask){this.moveChildTaskItems(task.childTask[i],width,moveChild);}}
for(var i=0;i<task.childPredTask.length;i++){this.moveChildTaskItems(task.childPredTask[i],width,moveChild);}}
else
{if(task.cTaskItem[1].length>0)
{task.cTaskItem[1][2].style.left=parseInt(task.cTaskItem[1][2].style.left)+width+"px";task.cTaskItem[1][2].style.width=parseInt(task.cTaskItem[1][2].style.width)-width+"px";task.cTaskItem[1][0].style.left=parseInt(task.cTaskItem[1][0].style.left)+width+"px";}}
if(this.Chart.isShowDescTask){task.moveDescTask();}};GanttTask.prototype.addDayInPanelTime=function()
{var taskItem=this.cTaskItem[0];var width=parseInt(taskItem.style.left)+parseInt(taskItem.firstChild.firstChild.width)+20;if(this.Chart.isShowDescTask){width+=this.descrTask.offsetWidth;}
var table=this.Chart.panelTime.firstChild,tbody=table.firstChild;if(parseInt(tbody.offsetWidth)<width)
{var row=tbody.rows[1];var countDays=Math.round((width+20-parseInt(tbody.offsetWidth))/this.Chart.dayInPixels);for(var n=0;n<countDays;n++)
{this.Chart.addPointInTimePanel(row,table);this.Chart.addDayInPanelTime(row);}
var w=this.Chart.dayInPixels*(row.cells.length);tbody.style.width=w+"px";this.Chart.panelTasks.style.width=(w-18)+"px";}};GanttTask.prototype.getDateOnPosition=function(position)
{var date=new Date(this.Chart.startDate);date.setHours(date.getHours()+(position/this.Chart.hourInPixels));return date;};GanttTask.prototype.moveItem=function(event)
{var pageX=event.screenX;var posTaskItem=(this.posX+(pageX-this.MouseX));var widthTaskItem=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width);var posTaskItemR=posTaskItem+widthTaskItem;if(this.checkMove)
{var date=this.getDateOnPosition(posTaskItem);var res=this.Chart.callEvent("onTaskDragging",[this,date])!==false;if(res&&((this.minPosXMove<=posTaskItem))&&((posTaskItemR<=this.maxPosXMove)||(this.maxPosXMove==-1)))
{this.moveTaskItem(posTaskItem);}}};GanttTask.prototype.moveTaskItem=function(posX)
{this.addDayInPanelTime();this.cTaskItem[0].style.left=posX+"px";var date=this.getDateOnPosition(posX);this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML=date.getDate()+'.'+(date.getMonth()+1)+'.'+date.getUTCFullYear();};GanttTask.prototype.resizeItem=function(event)
{if(this.checkResize)
{var MouseX=event.screenX;var widthTaskItem=this.taskItemWidth+(MouseX-this.MouseX);var countHours=Math.round(widthTaskItem/this.Chart.hourInPixelsWork);if(this.Chart.callEvent("onTaskResizing",[this,countHours])===false)return;if(widthTaskItem>=this.taskItemWidth)
{if((widthTaskItem<=this.maxWidthResize)||(this.maxWidthResize==-1))
{this.resizeTaskItem(widthTaskItem);this.addDayInPanelTime();}else if((this.maxWidthResize!=-1)&&(widthTaskItem>this.maxWidthResize))
{this.resizeTaskItem(this.maxWidthResize);}}else if(widthTaskItem<=this.taskItemWidth)
{if(widthTaskItem>=this.minWidthResize)
{this.resizeTaskItem(widthTaskItem);}
else if(widthTaskItem<this.minWidthResize)
{this.resizeTaskItem(this.minWidthResize);}}}};GanttTask.prototype.resizeTaskItem=function(width)
{var taskItem=this.cTaskItem[0];var countHours=Math.round(width/this.Chart.hourInPixelsWork);var c=taskItem.childNodes[0].firstChild.rows[0].cells[0];if(c)
{c.firstChild.style.width=parseInt(c.width)*width/100+"px";}
c=taskItem.childNodes[0].firstChild.rows[0].cells[1];if(c)
{c.firstChild.style.width=parseInt(c.width)*width/100+"px";}
taskItem.childNodes[0].firstChild.width=width+"px";taskItem.childNodes[1].firstChild.width=width+"px";this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML=countHours;taskItem.childNodes[2].childNodes[0].style.width=width+"px";taskItem.childNodes[2].childNodes[1].style.left=width-10+"px";};GanttTask.prototype.endResizeItem=function()
{var taskItem=this.cTaskItem[0];this.wasResized=this.taskItemWidth!=parseInt(taskItem.childNodes[0].firstChild.width);if(this.wasResized)
{var posXL=taskItem.offsetLeft;var posXR=taskItem.offsetLeft+parseInt(taskItem.childNodes[0].firstChild.width);this.TaskInfo.Duration=Math.round((posXR-posXL)/this.Chart.hourInPixelsWork);if(this.childPredTask.length>0)
{for(var j=0;j<this.childPredTask.length;j++)
{this.childPredTask[j].cTaskItem[1][2].style.width=parseInt(this.childPredTask[j].cTaskItem[1][2].style.width)-(parseInt(taskItem.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";this.childPredTask[j].cTaskItem[1][2].style.left=parseInt(this.childPredTask[j].cTaskItem[1][2].style.left)+(parseInt(taskItem.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";this.childPredTask[j].cTaskItem[1][0].style.left=parseInt(this.childPredTask[j].cTaskItem[1][0].style.left)+(parseInt(taskItem.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";}}}
this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML="";this.checkResize=false;this.taskItemWidth=0;this.MouseX=0;if(this.Chart.isShowDescTask){this.showDescTask();}
this.Project.shiftProjectItem();if(this.Chart._isFF)document.body.style.cursor="";};GanttProject.prototype.moveDescrProject=function()
{this.descrProject.style.left=(parseInt(this.projectItem[0].style.left)+this.Duration*this.Chart.hourInPixelsWork+10);this.descrProject.innerHTML=this.getDescStr();};GanttProject.prototype.showDescrProject=function()
{var posX=(parseInt(this.projectItem[0].style.left)+this.Duration*this.Chart.hourInPixelsWork+10);this.descrProject.style.left=posX+"px";this.descrProject.style.visibility='visible';this.descrProject.innerHTML=this.getDescStr();};GanttProject.prototype.hideDescrProject=function()
{this.descrProject.style.visibility='hidden';};GanttProject.prototype.getDescStr=function()
{var str='',delim=", ";for(var i=0;i<this.Chart.paramShowProject.length;i++){switch(this.Chart.paramShowProject[i]){case"Name":if(str!="")str+=delim;str+=this.Project[this.Chart.paramShowProject[i]];break;case"StartDate":if(str!="")str+=delim;var d=this.Project[this.Chart.paramShowProject[i]];str+=d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear();break;case"Duration":if(str!="")str+=delim;str+=this[this.Chart.paramShowProject[i]]+"h";break;case"percentCompleted":if(str!="")str+=delim;str+=this[this.Chart.paramShowProject[i]]+"%";break;default:break;}}
return str;};GanttProject.prototype.createDescrProject=function()
{var posX=(this.posX+this.Duration*this.Chart.hourInPixelsWork+10);var divDesc=document.createElement("div");divDesc.style.cssText+=";z-index:1;position:absolute;left:"+posX+"px;top:"+this.posY+"px;";divDesc.innerHTML=this.getDescStr();divDesc.className="descProject";this.descrProject=divDesc;if(this.Project.ParentTasks.length==0){this.descrProject.style.visibility='hidden';}
if(this.Chart._showTooltip)
{var self=this;var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.descrProject,e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divDesc,'mouseover',getPopUpInfo,false);this.addEvent(divDesc,'mouseout',closePopUpInfo,false);}
return divDesc;};GanttProject.prototype.createProjectItem=function()
{var self=this;this.percentCompleted=this.getPercentCompleted();this.Duration=this.getDuration();var projectItem=document.createElement("div");projectItem.id=this.Project.Id;projectItem.style.cssText=";z-index:1;position: absolute;left:"+this.posX+"px;top:"+this.posY+"px;";projectItem.style.width=this.Duration*this.Chart.hourInPixelsWork+"px";var tblProjectItem=document.createElement("table");projectItem.appendChild(tblProjectItem);tblProjectItem.cellPadding="0";tblProjectItem.cellSpacing="0";tblProjectItem.style.cssText="border: solid 1px #BC810D;";var width=this.Duration*this.Chart.hourInPixelsWork;tblProjectItem.width=((width==0)?1:width)+"px";tblProjectItem.style.width=((width==0)?1:width)+"px";var rowprojectItem=tblProjectItem.insertRow(tblProjectItem.rows.length);if(this.percentCompleted!=-1)
{if(this.percentCompleted!=0)
{var cellprojectItem=document.createElement("TD");rowprojectItem.appendChild(cellprojectItem);cellprojectItem.width=this.percentCompleted+"%";cellprojectItem.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width=(this.percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"parentnode_filled.png";}
if(this.percentCompleted!=100)
{var cellprojectItem=document.createElement("TD");rowprojectItem.appendChild(cellprojectItem);cellprojectItem.width=(100-this.percentCompleted)+"%";cellprojectItem.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width=((100-this.percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}}else
{var cellprojectItem=document.createElement("TD");rowprojectItem.appendChild(cellprojectItem);cellprojectItem.width="1px";cellprojectItem.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width="1px";imgPr.style.height=this.Chart.heightTaskItem;cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}
var divTaskInfo=document.createElement("div");divTaskInfo.style.cssText="text-align:center;z-index:2;position:absolute;left:0px;top:0px;";var tblTaskInfo=document.createElement("table");divTaskInfo.appendChild(tblTaskInfo);tblTaskInfo.cellPadding="0";tblTaskInfo.cellSpacing="0";tblTaskInfo.height=this.Chart.heightTaskItem+"px";tblTaskInfo.width=((this.Duration*this.Chart.hourInPixelsWork==0)?1:this.Duration*this.Chart.hourInPixelsWork)+"px";var rowTaskInfo=tblTaskInfo.insertRow(0);var cellTaskInfo=document.createElement("td");cellTaskInfo.align="center";cellTaskInfo.vAlign="top";cellTaskInfo.height=this.Chart.heightTaskItem+"px";cellTaskInfo.className="moveInfo";cellTaskInfo.style.cssText=";white-space:nowrap;";rowTaskInfo.appendChild(cellTaskInfo);projectItem.appendChild(divTaskInfo);if(this.Project.ParentTasks.length==0)
{projectItem.style.display="none";}
if(this.Chart._showTooltip)
{var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.projectItem[0],e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divTaskInfo,'mouseover',getPopUpInfo,false);this.addEvent(divTaskInfo,'mouseout',closePopUpInfo,false);}
return projectItem;};GanttProject.prototype.createProjectNameItem=function()
{var self=this;var divName=document.createElement("div");divName.style.cssText="cursor:pointer;color:#003366;font-weight:bold;font-size:12px;font-family:Tahoma,Arial;white-space:nowrap;height:15px;z-index:1;position:absolute;left:"+5+"px;top:"+this.posY+"px;";divName.innerHTML=this.Project.Name;divName.title=this.Project.Name;if(this.Chart.isShowConMenu)
{var showContMenu=function(event){if(self.Chart.contextMenu.clear)self.Chart.contextMenu.clear();var hideContMenu=null;if(!self.Chart._isIE)
{hideContMenu=function(){self.Chart.contextMenu.hideContextMenu();self.Chart.content.removeEventListener("mousedown",hideContMenu,false);};}else
{hideContMenu=function(){self.Chart.contextMenu.hideContextMenu();self.Chart.content.detachEvent("mousedown",hideContMenu);};}
self.Chart.content.onmousedown=hideContMenu;if(!self.Chart._isIE)
{event.stopPropagation();}else
{event.cancelBubble=true;}
self.Chart._showContextMenu(event,self);};if(this.Chart._isIE)
{this.addEvent(divName,"contextmenu",function(e){showContMenu(e);return false;},false);}else
{this.addEvent(divName,"contextmenu",function(e){e.preventDefault();showContMenu(e);},false);}}
return divName;};GanttProject.prototype.getPercentCompleted=function()
{var sum=0;var percentCompleted=0;for(var i=0;i<this.Project.ParentTasks.length;i++){sum+=parseInt(this.Project.ParentTasks[i].PercentCompleted);}
if(this.Project.ParentTasks.length!=0){return percentCompleted=Math.round(sum/this.Project.ParentTasks.length);}
else{return percentCompleted=-1;}};GanttProject.prototype.getDuration=function()
{var duration=0;var tmpDuration=0;if(this.Project.ParentTasks.length>0)
{for(var i=0;i<this.Project.ParentTasks.length;i++)
{tmpDuration=this.Project.ParentTasks[i].Duration*24/this.Chart.hoursInDay+(this.Project.ParentTasks[i].EST-this.Chart.startDate)/(60*60*1000);if(tmpDuration>duration)
{duration=tmpDuration;}}
return((duration-this.posX)/24)*this.Chart.hoursInDay;}else
{return 0;}};GanttProject.prototype.getId=function()
{return this.Project.Id;};GanttProject.prototype.getName=function()
{return this.Project.Name;};GanttProject.prototype.getStartDate=function()
{return this.Project.StartDate;};GanttTask.prototype.addEvent=function(elm,evType,fn,useCapture)
{if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}
else if(elm.attachEvent){return elm.attachEvent('on'+evType,fn);}
else{elm['on'+evType]=fn;}};GanttTask.prototype.startMove=function(event)
{this.moveChild=event.ctrlKey;this.MouseX=event.screenX;this.getMoveInfo();this.checkMove=true;if(this.Chart.isShowDescTask){this.hideDescTask();}
if(this.Chart._isFF)document.body.style.cursor="move";if(this.Chart._isIE)event.srcElement.style.cursor="move";};GanttTask.prototype.showDescTask=function()
{var posX=(parseInt(this.cTaskItem[0].style.left)+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10);this.descrTask.style.left=posX+"px";this.descrTask.innerHTML=this.getDescStr();this.descrTask.style.visibility='visible';};GanttTask.prototype.hideDescTask=function()
{this.descrTask.style.visibility='hidden';};GanttTask.prototype.getDescStr=function()
{var str='',delim=", ";for(var i=0;i<this.Chart.paramShowTask.length;i++){var prop=this.Chart.paramShowTask[i],propValue=this.TaskInfo[prop];switch(prop){case"Name":if(str!="")str+=delim;str+=propValue;break;case"EST":if(str!="")str+=delim;str+=propValue.getDate()+"."+(propValue.getMonth()+1)+"."+propValue.getFullYear();break;case"S-F":if(str!="")str+=delim;propValue=this.TaskInfo["EST"];str+=propValue.getDate()+"."+(propValue.getMonth()+1)+"."+propValue.getFullYear()+" - ";propValue=this.getFinishDate();str+=propValue.getDate()+"."+(propValue.getMonth()+1)+"."+propValue.getFullYear();break;case"Duration":if(str!="")str+=delim;str+=propValue+"h";break;case"PercentCompleted":if(str!="")str+=delim;str+=propValue+"%";break;default:break;}}
return str;};GanttTask.prototype.getId=function()
{return this.TaskInfo.Id;};GanttTask.prototype.getName=function()
{return this.TaskInfo.Name;};GanttTask.prototype.getDuration=function()
{return this.TaskInfo.Duration;};GanttTask.prototype.getEST=function()
{return this.TaskInfo.EST;};GanttTask.prototype.getFinishDate=function()
{var date=new Date(this.TaskInfo.EST);date.setDate(date.getDate()+parseInt((this.TaskInfo["Duration"]-1)/this.Chart.hoursInDay+1)-1);return date;};GanttTask.prototype.getPercentCompleted=function()
{return this.TaskInfo.PercentCompleted;};GanttTask.prototype.getPredecessorTaskId=function()
{return this.TaskInfo.PredecessorTaskId?this.TaskInfo.PredecessorTaskId:null;};GanttTask.prototype.getParentTaskId=function()
{return this.parentTask?this.parentTask.getId():null;};GanttTask.prototype.moveDescTask=function()
{var posX=(parseInt(this.cTaskItem[0].style.left)+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10);this.descrTask.style.left=posX+"px";};GanttTask.prototype.getMoveInfo=function()
{this.posX=parseInt(this.cTaskItem[0].style.left);var widthTaskItem=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width);var posParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].style.left);var posPredTaskItem=(this.predTask==null)?0:parseInt(this.predTask.cTaskItem[0].style.left)+parseInt(this.predTask.cTaskItem[0].childNodes[0].firstChild.width);var widthParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width);var childPredPosX=0;var childParentPosX=0;var childParentPosXR=0;if(this.childPredTask.length>0)
{var posChildTaskItem=null;for(var n=0;n<this.childPredTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem>parseInt(this.childPredTask[n].cTaskItem[0].style.left))))
{posChildTaskItem=parseInt(this.childPredTask[n].cTaskItem[0].style.left);}}
childPredPosX=posChildTaskItem;}
if(this.childTask.length>0)
{var posChildTaskItemR=null;for(var n=0;n<this.childTask.length;n++)
{if((!posChildTaskItemR)||((posChildTaskItemR)&&(posChildTaskItemR>(parseInt(this.childTask[n].cTaskItem[0].style.left)))))
{posChildTaskItemR=parseInt(this.childTask[n].cTaskItem[0].style.left);}}
childParentPosXR=posChildTaskItemR;var posChildTaskItem=null;for(var n=0;n<this.childTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem<(parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width)))))
{posChildTaskItem=parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width);}}
childParentPosX=posChildTaskItem;}
if(!this.moveChild)
{if(this.childPredTask.length>0){if(this.maxPosXMove<childPredPosX)this.maxPosXMove=childPredPosX;}
if(this.childTask.length>0){if((this.childPredTask.length>0)&&(this.maxPosXMove-widthTaskItem)>childParentPosXR)this.maxPosXMove=this.maxPosXMove-((this.maxPosXMove-widthTaskItem)-childParentPosXR);if(!(this.childPredTask.length>0))this.maxPosXMove=childParentPosXR+widthTaskItem;this.minPosXMove=(childParentPosX-widthTaskItem);}
if(posParentTaskItem>0)
{if((!(this.childPredTask.length>0))&&(this.childTask.length>0)){if(this.maxPosXMove>posParentTaskItem+widthParentTaskItem){this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}}
if(this.minPosXMove<=posParentTaskItem){this.minPosXMove=posParentTaskItem;}
if((!(this.childTask.length>0))&&(!(this.childPredTask.length>0))){this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}else if((!(this.childTask.length>0))&&(this.childPredTask.length>0)){if((posParentTaskItem+widthParentTaskItem)>posPredTaskItem){this.maxPosXMove=childPredPosX;}}}
if(posPredTaskItem>0){if(this.minPosXMove<=posPredTaskItem){this.minPosXMove=posPredTaskItem;}}
if((posPredTaskItem==0)&&(posParentTaskItem==0)){if(this.minPosXMove<=this.Chart.initialPos){this.minPosXMove=this.Chart.initialPos;}}}else
{if((posParentTaskItem>0)&&(posPredTaskItem==0))
{this.minPosXMove=posParentTaskItem;this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}else if((posParentTaskItem==0)&&(posPredTaskItem==0))
{this.minPosXMove=this.Chart.initialPos;this.maxPosXMove=-1;}else if((posParentTaskItem>0)&&(posPredTaskItem>0))
{this.minPosXMove=posPredTaskItem;this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}else if((posParentTaskItem==0)&&(posPredTaskItem>0))
{this.minPosXMove=posPredTaskItem;this.maxPosXMove=-1;}
if((this.parentTask)&&(this.childPredTask.length>0))
{var posChildTaskItem=this.getMaxPosPredChildTaskItem(this);var posParentTaskItem=parseInt(this.parentTask.cTaskItem[0].style.left)+parseInt(this.parentTask.cTaskItem[0].firstChild.firstChild.width);this.maxPosXMove=this.posX+widthTaskItem+posParentTaskItem-posChildTaskItem;}}};GanttTask.prototype.startResize=function(event)
{this.MouseX=event.screenX;this.getResizeInfo();if(this.Chart.isShowDescTask){this.hideDescTask();}
this.checkResize=true;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);if(this.Chart._isFF)document.body.style.cursor="e-resize";};GanttTask.prototype.getResizeInfo=function()
{var taskItem=this.cTaskItem[0];var posParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].style.left);var widthParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width);var posTaskItem=parseInt(this.cTaskItem[0].style.left);var childPredPosX=0;var childParentPosX=0;if(this.childPredTask.length>0)
{var posChildTaskItem=null;for(var n=0;n<this.childPredTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem>parseInt(this.childPredTask[n].cTaskItem[0].style.left))))
{posChildTaskItem=parseInt(this.childPredTask[n].cTaskItem[0].style.left);}}
childPredPosX=posChildTaskItem;}
if(this.childTask.length>0)
{var posChildTaskItem=null;for(var n=0;n<this.childTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem<(parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width)))))
{posChildTaskItem=parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width);}}
childParentPosX=posChildTaskItem;}
this.minWidthResize=this.Chart.minWidthResize;if(this.childTask.length>0)
{this.minWidthResize=childParentPosX-posTaskItem;}
if((this.childPredTask.length>0)&&(!this.parentTask))
{this.maxWidthResize=childPredPosX-posTaskItem;}else if((this.childPredTask.length>0)&&(this.parentTask))
{var w1=posParentTaskItem+widthParentTaskItem-posTaskItem;var w2=childPredPosX-posTaskItem;this.maxWidthResize=Math.min(w1,w2);}else if((this.childPredTask.length==0)&&(this.parentTask))
{this.maxWidthResize=posParentTaskItem+widthParentTaskItem-posTaskItem;}};GanttTask.prototype.createTaskItem=function()
{var self=this;this.posX=this.Chart.getPosOnDate(this.TaskInfo.EST);var itemControl=document.createElement("div");itemControl.id=this.TaskInfo.Id;itemControl.style.cssText=";z-index:1;position:absolute;left:"+this.posX+"px;top:"+this.posY+"px;";var divTaskItem=document.createElement("div");itemControl.appendChild(divTaskItem);divTaskItem.style.cssText="z-index:1;position: absolute;left:0px;top:0px;";var tblTaskItem=document.createElement("table");divTaskItem.appendChild(tblTaskItem);tblTaskItem.cellPadding="0";tblTaskItem.cellSpacing="0";tblTaskItem.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";tblTaskItem.style.cssText="border: solid 1px #6589A9;";var rowTblTask=tblTaskItem.insertRow(tblTaskItem.rows.length);if(this.TaskInfo.PercentCompleted!=0)
{var cellTblTask=document.createElement("td");rowTblTask.appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=this.TaskInfo.PercentCompleted+"%";cellTblTask.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width=(this.TaskInfo.PercentCompleted*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_filled.png";}
if(this.TaskInfo.PercentCompleted!=100)
{var cellTblTask=document.createElement("td");rowTblTask.appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=(100-this.TaskInfo.PercentCompleted)+"%";cellTblTask.style.lineHeight="1px";var imgPrF=document.createElement("img");imgPrF.style.width=((100-this.TaskInfo.PercentCompleted)*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPrF.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPrF);imgPrF.src=this.Chart.imgs+"progress_bg.png";}
if(this.Chart.isEditable)
{var divTaskInfo=document.createElement("div");divTaskInfo.style.cssText="text-align:center;font-size:9px;z-index:2;position: absolute;left:0px;top:0px;";var tblTaskInfo=document.createElement("table");divTaskInfo.appendChild(tblTaskInfo);tblTaskInfo.cellPadding="0";tblTaskInfo.cellSpacing="0";tblTaskInfo.height=this.Chart.heightTaskItem+"px";tblTaskInfo.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";var rowTaskInfo=tblTaskInfo.insertRow(0);var cellTaskInfo=document.createElement("TD");cellTaskInfo.align="center";cellTaskInfo.vAlign="top";cellTaskInfo.height=this.Chart.heightTaskItem+"px";cellTaskInfo.className="moveInfo";cellTaskInfo.style.cssText=";white-space:nowrap;font-size:9px";rowTaskInfo.appendChild(cellTaskInfo);itemControl.appendChild(divTaskInfo);}
var divTaskName=document.createElement("div");itemControl.appendChild(divTaskName);divTaskName.style.cssText=";z-index:2;position: absolute;left:0px;top:0px;";var divMove=document.createElement("div");divMove.innerHTML="<input type='text' style='visibility:hidden;width:1px;height:1px;'/>";if(this.Chart._isIE)
{divMove.style.background="#000000";divMove.style.filter="alpha(opacity=0)";}
divMove.style.height=this.Chart.heightTaskItem+"px";divMove.style.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";divTaskName.appendChild(divMove);if(this.Chart._showTooltip)
{var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.cTaskItem[0],e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divMove,'mouseover',getPopUpInfo,false);this.addEvent(divMove,'mouseout',closePopUpInfo,false);}
var taskClick=function(){self.Chart.callEvent("onTaskClick",[self]);};this.addEvent(divMove,'click',taskClick,false);if(this.Chart.isEditable)
{var divResize=document.createElement("div");divResize.style.cssText=";z-index:10;position: absolute;left:"+(this.TaskInfo.Duration*this.Chart.hourInPixelsWork-10)+"px;top:0px;";divResize.style.height=this.Chart.heightTaskItem+"px";divResize.style.width="10px";divResize.innerHTML="<input type='text' style='visibility:hidden;width:1px;height:1px;'/>";divTaskName.appendChild(divResize);var startMove=function(e){if(self.Chart.callEvent("onTaskStartDrag",[self])===false)return;var moveItem=function(e1){if(self.checkMove)self.moveItem(e1);};var endMove=function(){if(self.checkMove){self.endMove();self.Chart._isMove=false;if(self.Chart._isIE)
{document.body.releaseCapture();document.detachEvent("onmousemove",moveItem);document.detachEvent("onmouseup",endMove);}else{document.removeEventListener("mousemove",moveItem,true);document.removeEventListener("mouseup",endMove,true);}
if(self.wasMoved)self.Chart.callEvent("onTaskEndDrag",[self]);}};self.addEvent(document,'mousemove',moveItem,true);self.addEvent(document,'mouseup',endMove,true);if(self.Chart._showTooltip)self.closePopUpInfo();self.startMove(e);self.Chart._isMove=true;if(self.Chart._isIE)document.body.setCapture(false);};var startResize=function(e){if(self.Chart.callEvent("onTaskStartResize",[self])===false)return;var resizeItem=function(e1){if(self.checkResize)self.resizeItem(e1);};var endResizeItem=function(){if(self.checkResize){self.endResizeItem();self.Chart._isResize=false;if(self.Chart._isIE)
{document.body.releaseCapture();document.detachEvent("onmousemove",resizeItem);document.detachEvent("onmouseup",endResizeItem);}else{document.removeEventListener("mousemove",resizeItem,true);document.removeEventListener("mouseup",endResizeItem,true);}
if(self.wasResized)self.Chart.callEvent("onTaskEndResize",[self]);}};self.addEvent(document,'mousemove',resizeItem,false);self.addEvent(document,'mouseup',endResizeItem,false);self.startResize(e);if(self.Chart._isIE)document.body.setCapture(false);self.Chart._isResize=true;};this.addEvent(divMove,'mousedown',startMove,false);this.addEvent(divResize,'mousedown',startResize,false);var setCursorResize=function(e2){if(!self.Chart._isMove)(e2.srcElement?e2.srcElement:e2.target).style.cursor="e-resize";};var setCursorStandart=function(e3){if(!self.checkResize)(e3.srcElement?e3.srcElement:e3.target).style.cursor="";};this.addEvent(divResize,'mouseover',setCursorResize,false);this.addEvent(divResize,'mouseout',setCursorStandart,false);}
return itemControl;};GanttTask.prototype.createTaskNameItem=function(hasChildren)
{var self=this;var divName=document.createElement("div");divName.id=this.TaskInfo.Id;divName.style.cssText="cursor:pointer;white-space:nowrap;height:15px;z-index:1;position:absolute;left:20px;top: "+this.posY+"px;";if(hasChildren)divName.style.fontWeight="bold";divName.className="taskNameItem";divName.title=this.TaskInfo.Name;divName.innerHTML=this.TaskInfo.Name;if(this.Chart.isShowConMenu)
{var showContMenu=function(event){if(self.Chart.contextMenu.clear)self.Chart.contextMenu.clear();var hideContMenu=function(){self.Chart.contextMenu.hideContextMenu();if(self.Chart._isIE)
self.Chart.content.detachEvent("mousedown",hideContMenu);else
self.Chart.content.removeEventListener("mousedown",hideContMenu,false);};self.Chart.content.onmousedown=hideContMenu;if(!self.Chart._isIE)
{event.stopPropagation();}else
{event.cancelBubble=true;}
self.Chart._showContextMenu(event,self);};if(this.Chart._isIE)
{this.addEvent(divName,"contextmenu",function(e){showContMenu(e);return false;},false);}else
{this.addEvent(divName,"contextmenu",function(e){e.preventDefault();showContMenu(e);},false);}}
return divName;};GanttTask.prototype.createTaskDescItem=function()
{var posX=(this.posX+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10);var divDesc=document.createElement("div");divDesc.style.cssText+=";z-index:1;position:absolute;left:"+posX+"px;top:"+this.posY+"px;";divDesc.innerHTML=this.getDescStr();divDesc.className="descTask";this.descrTask=divDesc;if(this.Chart._showTooltip)
{var self=this;var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.descrTask,e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divDesc,'mouseover',getPopUpInfo,false);this.addEvent(divDesc,'mouseout',closePopUpInfo,false);}
return divDesc;};GanttTask.prototype.checkWidthTaskNameItem=function()
{if(this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft>this.Chart.maxWidthPanelNames)
{var width=this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft-this.Chart.maxWidthPanelNames;var countChar=Math.round(width/(this.cTaskNameItem[0].offsetWidth/this.cTaskNameItem[0].firstChild.length));var tName=this.TaskInfo.Name.substring(0,this.cTaskNameItem[0].firstChild.length-countChar-3);tName+="...";this.cTaskNameItem[0].innerHTML=tName;}};GanttTask.prototype.create=function()
{var containerTasks=this.Chart.oData.firstChild;var containerNames=null;if(this.Chart._showTreePanel)containerNames=this.Chart.panelNames.firstChild;var predecessorTask=this.TaskInfo.PredecessorTask;var parentTask=this.TaskInfo.ParentTask;var isCParentTask=(this.TaskInfo.ChildTasks.length>0);var self=this;this.cTaskItem=[];this.cTaskNameItem=[];if(!parentTask)
{if(this.TaskInfo.previousParentTask){this.previousParentTask=this.Project.getTaskById(this.TaskInfo.previousParentTask.Id);var lastChildTask=this.Chart.getLastChildTask(this.previousParentTask);this.posY=parseInt(lastChildTask.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;this.previousParentTask.nextParentTask=this;}else{this.posY=parseInt(this.Project.projectItem[0].style.top)+this.Chart.heightTaskItem+11;}}
if(parentTask){var task=this.Project.getTaskById(this.TaskInfo.ParentTask.Id);this.parentTask=task;if(this.TaskInfo.previousChildTask){this.previousChildTask=this.Project.getTaskById(this.TaskInfo.previousChildTask.Id);var lastChildTask=this.Chart.getLastChildTask(this.previousChildTask);this.posY=parseInt(lastChildTask.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;this.previousChildTask.nextChildTask=this;}else{this.posY=parseInt(task.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;}
task.childTask.push(this);}
if(predecessorTask){var task=this.Project.getTaskById(predecessorTask.Id);this.predTask=task;task.childPredTask.push(this);}
this.cTaskItem.push(this.createTaskItem());containerTasks.appendChild(this.cTaskItem[0]);if(this.Chart.panelNames){this.cTaskNameItem.push(this.createTaskNameItem(isCParentTask));this.Chart.panelNames.firstChild.appendChild(this.cTaskNameItem[0]);}
if(this.Chart.isShowDescTask){containerTasks.appendChild(this.createTaskDescItem());}
var arrConnectingLines=[];if(predecessorTask)arrConnectingLines=this.createConnectingLinesDS();this.cTaskItem.push(arrConnectingLines);if(this.Chart.panelNames)
{var arrConnectingLinesNames=[];if(parentTask)
{this.cTaskNameItem[0].style.left=parseInt(this.parentTask.cTaskNameItem[0].style.left)+15+"px";arrConnectingLinesNames=this.createConnectingLinesPN();}
this.checkWidthTaskNameItem();var treeImg=null;if(isCParentTask)treeImg=this.createTreeImg();this.cTaskNameItem.push(arrConnectingLinesNames);this.cTaskNameItem.push(treeImg);}
this.addDayInPanelTime();return this;};GanttTask.prototype.createTreeImg=function()
{var self=this;var treeImg=new Image();treeImg.src=this.Chart.imgs+"minus.gif";treeImg.id=this.TaskInfo.Id;treeImg.onclick=function()
{if(self._isOpen)
{this.src=self.Chart.imgs+"plus.gif";self._isOpen=false;self.hideChildTasks(self);self.shiftCurrentTasks(self,-self._heightHideTasks);}
else
{this.src=self.Chart.imgs+"minus.gif";self._isOpen=true;self.shiftCurrentTasks(self,self._heightHideTasks);self.showChildTasks(self,true);self._heightHideTasks=0;}};this.Chart.panelNames.firstChild.appendChild(treeImg);treeImg.style.cssText="cursor:pointer;left:"+(parseInt(this.cTaskNameItem[0].style.left)-12)+"px;top:"+(parseInt(this.cTaskNameItem[0].style.top)+3)+"px;z-index:12;position:absolute;";return treeImg;};GanttChart.prototype.getLastChildTask=function(task)
{if(task.childTask.length>0)
{return this.getLastChildTask(task.childTask[task.childTask.length-1]);}else
{return task;}};dhtmlXMLSenderObject=function(ganttChart)
{this.xmlHttp=this.createXMLHttpRequest();this.isProcessed=false;this.path=null;this.filename=null;this.Chart=ganttChart;};dhtmlXMLSenderObject.prototype.createXMLHttpRequest=function()
{if(window.XMLHttpRequest){return new XMLHttpRequest();}
else if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLHTTP");}};dhtmlXMLSenderObject.prototype.sendData=function(filename,path,xmlData)
{var self=this;this.path=path;this.filename=filename;if((this.path==null)||(this.path==""))
{this.Chart.Error.throwError("DATA_SEND_ERROR",3,null);return;}
if((this.filename==null)||(this.filename==""))
{this.Chart.Error.throwError("DATA_SEND_ERROR",4,null);return;}
this.isProcessed=true;this.xmlHttp.open("POST",this.path,true);if(this.Chart._isFF)
{this.xmlHttp.onerror=function(){self.xmlHttp.onreadystatechange=null;self.xmlHttp.abort();self.isProcessed=false;}}
this.xmlHttp.onreadystatechange=function(){self.getStatus();};this.xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.xmlHttp.send("data="+encodeURI(xmlData)+"&filename="+filename);};dhtmlXMLSenderObject.prototype.getStatus=function()
{if(this.xmlHttp.readyState==4)
{var _status="";try{_status=this.xmlHttp.status;}catch(e){this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);return 0;}
switch(_status){case 0:this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);break;case 404:this.Chart.Error.throwError("DATA_SEND_ERROR",5,[this.path]);break;case 500:this.Chart.Error.throwError("DATA_SEND_ERROR",2,null);break;case 12029:this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);break;default:if(!(_status>=200&&_status<300||_status==304))
{this.Chart.Error.throwError("DATA_SEND_ERROR",0,null);}
break;}
this.isProcessed=false;}};function GanttError(){this.catches=[];this._errors=[];this._init();return this;}
GanttError.prototype._init=function()
{this._errors[0]="Connection error";this._errors[1]="Cannot connect";this._errors[2]="Server error";this._errors[3]="Path is null or empty";this._errors[4]="Filename is null or empty";this._errors[5]="File (%0) is not found";this._errors[6]="Percent Complete  should be a number";this._errors[7]="Percent Complete should be <= 100";this._errors[8]="Percent Complete should be >= 0";this._errors[9]="Increase duration of task(%0)";this._errors[10]="Reduce duration of task(%0)";this._errors[11]="Increase  EST of child task (%0)";this._errors[12]="Reduce EST of task (%0)";this._errors[13]="The project (%0) is added";this._errors[14]="Start Date of the project < start Date of the control";this._errors[15]="Task (%0) cannot be the child of predecessor task(%1)";this._errors[16]="Time of the termination of predecessor task(%0) > EST of child task(%1)";this._errors[17]="The Predecessor (%0) task  does not exist";this._errors[18]="The EST of task (%0) < start date of the control";this._errors[19]="Time of the termination of parent task (%0) < time of the termination of child task(%1)";this._errors[20]="The EST of task (%0) < EST of parent task(%1)";this._errors[21]="The parent task (%0) does not exist";this._errors[22]="The task (%0) is added";this._errors[23]="The project (%0) is added";this._errors[24]="Task (%0) EST < project (%1) startDate";this._errors[25]="Parent task (%0) EST cannot be null";this._errors[26]="Predecessor task (%0) position error. Reduce duration of predecessor task (%0) or increase EST of child task (%1)";this._errors[27]="Predecessor task (%0) does not exist";this._errors[28]="Increase duration of parent task (%0) or reduce EST of child task (%1) or reduce duration of child task(%1)";this._errors[29]="Reduce EST of parent task (%0) or increase  EST of child task (%1)";this._errors[30]="The  task(%0) does not exist";this._errors[31]="The project(%0) does not exist";this._errors[32]="Predecessor task(%0) and child task(%1) should have the same parent";this._errors[33]="Reduce EST of parent task (%0) or increase  EST of child task (%1)";this._errors[34]="EST of task(%0) < start date of the project(%1)";this._errors[35]="Percent Complete should be <= 100 and >= 0";this._errors[36]="You may not connect a task to itself.";this._errors[37]="Cannot parse this XML string.";};GanttError.prototype.catchError=function(type,handler){this.catches[type]=handler;};GanttError.prototype.getErrorString=function(str,params)
{if(!params){return str;}else{for(var i=0;i<params.length;i++){var re=new RegExp("%"+i,"gi");str=str.replace(re,params[i]);}
return str;}};GanttError.prototype.throwError=function(type,description,params){if(this.catches[type])
{var index=parseInt(description);var errorStr=this.getErrorString(this._errors[index],params);return this.catches[type](type,errorStr,params);}
return null;};function contextMenu(chart)
{this.Chart=chart;this.TabContainer=null;this.MenuPanel=null;this.tabPanel=null;this.arrTabs=[];this.isShow=false;this.hideDiv=null;this._init();}
contextMenu.prototype._init=function()
{this.createMenuPanel();this.createHideDiv();this.createTabContainer();this.createTabPanel();var self=this;var arrItems=[];var tab1=this.createTab(1,"Rename task","t",true,this);tab1.addItem(1,"New name",document.createElement("input"),"text",function(){tab1.arrItems[0].control.focus();});tab1.addItem(2,"Rename",document.createElement("input"),"button",function(){var name=tab1.arrItems[0].control.value;try{tab1.object.setName(name);tab1.hide();}catch(e){}});var tab2=this.createTab(2,"Delete task","t",true,this);tab2.addItem(1,"Delete",document.createElement("input"),"button",function()
{try{tab2.object.Project.deleteTask(tab2.object.TaskInfo.Id);tab2.hide();}
catch(e){}});var tab3=this.createTab(3,"Set EST","t",true,this);tab3.addItem(1,"EST",document.createElement("input"),"text",function(){tab3.arrItems[0].control.focus();});tab3.addItem(2,"Move children",document.createElement("input"),"checkbox",function(){tab3.arrItems[1].control.focus();});tab3.addItem(3,"Update",document.createElement("input"),"button",function(){var isMoveChild=tab3.arrItems[1].control.checked;var arr=tab3.arrItems[0].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));try{if(tab3.object.setEST(est,isMoveChild))tab3.hide();}catch(e){}});var tab4=this.createTab(4,"Set duration","t",true,this);tab4.addItem(1,"Duration",document.createElement("input"),"text",function(){tab4.arrItems[0].control.focus();});tab4.addItem(2,"Update",document.createElement("input"),"button",function(){var d=tab4.arrItems[0].control.value;try{if(tab4.object.setDuration(d))tab4.hide();}catch(e){}});var tab5=this.createTab(5,"Set % complete","t",true,this);tab5.addItem(1,"Percent Complete",document.createElement("input"),"text",function(){tab5.arrItems[0].control.focus();});tab5.addItem(2,"Update",document.createElement("input"),"button",function(){var p=tab5.arrItems[0].control.value;try{if(tab5.object.setPercentCompleted(p))tab5.hide();}catch(e){}});var tab13=this.createTab(13,"Set predecessor","t",true,this);tab13.addItem(1,"Predecessor",document.createElement("input"),"text",function(){tab13.arrItems[0].control.focus();});tab13.addItem(2,"Update",document.createElement("input"),"button",function(){var p=tab13.arrItems[0].control.value;try{if(tab13.object.setPredecessor(p))tab13.hide();}catch(e){}});var tab6=this.createTab(6,"Rename project","p",true,this);tab6.addItem(1,"New name",document.createElement("input"),"text",function(){tab6.arrItems[0].control.focus();});tab6.addItem(2,"Rename",document.createElement("input"),"button",function(){var name=tab6.arrItems[0].control.value;try{tab6.object.setName(name);tab6.hide();}catch(e){}});var tab7=this.createTab(7,"Delete project","p",true,this);tab7.addItem(1,"Delete",document.createElement("input"),"button",function(){try{tab7.object.Chart.deleteProject(tab7.object.Project.Id);tab7.hide();}catch(e){}});var tab8=this.createTab(8,"Set % complete","p",true,this);tab8.addItem(1,"Percent Complete",document.createElement("input"),"text",function(){tab8.arrItems[0].control.focus();});tab8.addItem(2,"Update",document.createElement("input"),"button",function(){var p=tab8.arrItems[0].control.value;try{if(tab8.object.setPercentCompleted(p))tab8.hide();}catch(e){}});var tab9=this.createTab(9,"Add new task","p",true,this);tab9.addItem(1,"Id",document.createElement("input"),"text",function(){tab9.arrItems[0].control.focus();});tab9.addItem(2,"Name",document.createElement("input"),"text",function(){tab9.arrItems[1].control.focus();});tab9.addItem(3,"EST",document.createElement("input"),"text",function(){tab9.arrItems[2].control.focus();});tab9.addItem(4,"Duration",document.createElement("input"),"text",function(){tab9.arrItems[3].control.focus();});tab9.addItem(5,"Percent complete",document.createElement("input"),"text",function(){tab9.arrItems[4].control.focus();});tab9.addItem(6,"Parent task id",document.createElement("input"),"text",function(){tab9.arrItems[5].control.focus();});tab9.addItem(7,"Pred task id",document.createElement("input"),"text",function(){tab9.arrItems[6].control.focus();});tab9.addItem(9,"Insert",document.createElement("input"),"button",function(){try{var id=tab9.arrItems[0].control.value;var name=tab9.arrItems[1].control.value;var arr=tab9.arrItems[2].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));var duration=tab9.arrItems[3].control.value;var pc=tab9.arrItems[4].control.value;var parentTaskId=tab9.arrItems[5].control.value;var predTaskId=tab9.arrItems[6].control.value;if(tab9.object.insertTask(id,name,est,duration,pc,predTaskId,parentTaskId))tab9.hide();}catch(e){}});var tab11=this.createTab(11,"Add successor task","t",true,this);tab11.addItem(1,"Id",document.createElement("input"),"text",function(){tab11.arrItems[0].control.focus();});tab11.addItem(2,"Name",document.createElement("input"),"text",function(){tab11.arrItems[1].control.focus();});tab11.addItem(3,"EST",document.createElement("input"),"text",function(){tab11.arrItems[2].control.focus();});tab11.addItem(4,"Duration",document.createElement("input"),"text",function(){tab11.arrItems[3].control.focus();});tab11.addItem(5,"Percent complete",document.createElement("input"),"text",function(){tab11.arrItems[4].control.focus();});tab11.addItem(6,"Insert",document.createElement("input"),"button",function(){try{var pr=tab11.object.Project;var id=tab11.arrItems[0].control.value;var name=tab11.arrItems[1].control.value;var arr=tab11.arrItems[2].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));var duration=tab11.arrItems[3].control.value;var pc=tab11.arrItems[4].control.value;var parentTaskId=(tab11.object.parentTask==null)?"":tab11.object.parentTask.TaskInfo.Id;var predTaskId=tab11.object.TaskInfo.Id;if(pr.insertTask(id,name,est,duration,pc,predTaskId,parentTaskId))tab11.hide();}catch(e){}});var tab10=this.createTab(10,"Add child task","t",true,this);tab10.addItem(1,"Id",document.createElement("input"),"text",function(){tab10.arrItems[0].control.focus();});tab10.addItem(2,"Name",document.createElement("input"),"text",function(){tab10.arrItems[1].control.focus();});tab10.addItem(3,"EST",document.createElement("input"),"text",function(){tab10.arrItems[2].control.focus();});tab10.addItem(4,"Duration",document.createElement("input"),"text",function(){tab10.arrItems[3].control.focus();});tab10.addItem(5,"Percent complete",document.createElement("input"),"text",function(){tab10.arrItems[4].control.focus();});tab10.addItem(6,"Insert",document.createElement("input"),"button",function(){try{var pr=tab10.object.Project;var id=tab10.arrItems[0].control.value;var name=tab10.arrItems[1].control.value;var arr=tab10.arrItems[2].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));var duration=tab10.arrItems[3].control.value;var pc=tab10.arrItems[4].control.value;var parentTaskId=tab10.object.TaskInfo.Id;var predTaskId="";if(pr.insertTask(id,name,est,duration,pc,predTaskId,parentTaskId))tab10.hide();}catch(e){}});var tab12=this.createTab(12,"-Insert new project-","p",false,this);tab12.addItem(1,"Id",document.createElement("input"),"text",function(){tab12.arrItems[0].control.focus();});tab12.addItem(2,"Name",document.createElement("input"),"text",function(){tab12.arrItems[1].control.focus();});tab12.addItem(3,"Start date",document.createElement("input"),"text",function(){tab12.arrItems[2].control.focus();});tab12.addItem(4,"Insert",document.createElement("input"),"button",function(){try{var id=tab12.arrItems[0].control.value;var namePr=tab12.arrItems[1].control.value;var arr=tab12.arrItems[2].control.value.split(".");var startDatePr=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));if(self.Chart.insertProject(id,namePr,startDatePr))tab12.hide();}catch(e){}});};contextMenu.prototype.createHideDiv=function()
{this.hideDiv=document.createElement("div");this.hideDiv.style.position="absolute";this.hideDiv.style.left="0px";this.hideDiv.style.top="0px";this.Chart.content.appendChild(this.hideDiv);this.hideDiv.style.zIndex=12;this.hideDiv.style.display="none";this.hideDiv.style.background="#7D7E7D";this.hideDiv.style.cssText+=";-moz-opacity: 0.5;filter: alpha(opacity=50);opacity:.50;";this.hideDiv.style.width=this.Chart.content.offsetWidth+2+"px";this.hideDiv.style.height=this.Chart.content.offsetHeight+2+"px";};contextMenu.prototype.createMenuPanel=function()
{this.MenuPanel=document.createElement("div");this.MenuPanel.style.visibility="hidden";this.MenuPanel.style.cssText+=";z-index:10;";this.MenuPanel.style.position="absolute";this.Chart.content.appendChild(this.MenuPanel);this.MenuPanel.innerHTML="<table></table>";this.MenuPanel.firstChild.className="contextMenu";this.MenuPanel.firstChild.cellPadding=0;this.MenuPanel.firstChild.cellSpacing=0;this.MenuPanel.firstChild.style.cssText+=";background:url("+this.Chart.imgs+"menu/menu_bg.png);";};contextMenu.prototype.createTabPanel=function()
{this.tabPanel=document.createElement("div");this.tabPanel.style.visibility="hidden";this.tabPanel.style.zIndex="30";this.TabContainer.firstChild.rows[0].cells[0].appendChild(this.tabPanel);this.tabPanel.style.width="385px";this.tabPanel.style.height="290px";this.tabPanel.innerHTML="<table><tr><td></td></tr><tr><td></td></tr></table>";this.tabPanel.firstChild.cellPadding=0;this.tabPanel.firstChild.cellSpacing=0;this.tabPanel.firstChild.style.cssText="width:385px;border: 1px solid #808080;";this.tabPanel.firstChild.rows[0].cells[0].style.cssText=";height:26px;background:url("+this.Chart.imgs+"/menu/window_tr.png);background-repeat: no-repeat;color:#fff;font-size:14px;font-weight: bold;font-family: Tahoma, Arial";this.tabPanel.firstChild.rows[0].cells[0].align="center";this.tabPanel.firstChild.rows[1].cells[0].style.cssText=";height:270px;background:#F7F7F7;";this.tabPanel.firstChild.rows[1].cells[0].innerHTML="<table></table>";this.tabPanel.firstChild.rows[1].cells[0].firstChild.style.cssText="width:250px;font-size:11px;font-family:Tahoma,Arial;";this.tabPanel.firstChild.rows[1].cells[0].align="center";};contextMenu.prototype.addItemMenuPanel=function(tab)
{var self=this;var row=this.MenuPanel.firstChild.insertRow(this.MenuPanel.firstChild.rows.length);var cell=document.createElement('td');cell.innerHTML=tab.Description;cell.style.cssText="padding-left:10px;height:18px;";this.addEvent(cell,"mousedown",function(){tab.show();},false);cell.onmouseover=function(){this.style.background="url("+self.Chart.imgs+"menu/menu_selection.png)";};cell.onmouseout=function(){this.style.background="";};row.appendChild(cell);};contextMenu.prototype.showContextMenu=function(x,y,object)
{if(object.constructor==GanttTask)
{for(var i=0;i<this.arrTabs.length;i++){if(this.arrTabs[i].type=="t")
{this.arrTabs[i].object=object;this.addItemMenuPanel(this.arrTabs[i]);}}}else if(object.constructor==GanttProject)
{for(var i=0;i<this.arrTabs.length;i++){if(this.arrTabs[i].type=="p")
{this.arrTabs[i].object=object;this.addItemMenuPanel(this.arrTabs[i]);}}}
this.isShow=true;this.MenuPanel.style.cssText+=";z-index:15;";this.MenuPanel.style.visibility="visible";this.MenuPanel.style.top=parseInt(y)+this.Chart.heightTaskItem-this.Chart.oData.scrollTop+5+"px";this.MenuPanel.style.left=x;};contextMenu.prototype.hideContextMenu=function()
{this.isShow=false;this.MenuPanel.style.visibility="hidden";};contextMenu.prototype.clear=function()
{this.MenuPanel.removeChild(this.MenuPanel.firstChild);this.MenuPanel.innerHTML="<table></table>";this.MenuPanel.firstChild.className="contextMenu";this.MenuPanel.firstChild.cellPadding=0;this.MenuPanel.firstChild.cellSpacing=0;this.MenuPanel.firstChild.style.cssText+=";background:url("+this.Chart.imgs+"menu/menu_bg.png);";};contextMenu.prototype.createTab=function(id,desc,type,showOInfo,menu)
{var tab=new contextMenuTab(id,desc,type,showOInfo,menu);this.arrTabs.push(tab);return tab;};contextMenu.prototype.createTabContainer=function()
{this.TabContainer=document.createElement("div");this.TabContainer.style.position="absolute";this.TabContainer.style.top="0px";this.TabContainer.style.left="0px";this.TabContainer.style.visibility="hidden";this.TabContainer.style.zIndex="50";this.Chart.content.appendChild(this.TabContainer);this.TabContainer.innerHTML="<table><tr><td></td></tr></table>";this.TabContainer.firstChild.style.cssText=";width:100%;height:100%;";this.TabContainer.firstChild.rows[0].cells[0].align="center";this.TabContainer.style.width=this.Chart.content.offsetWidth+2+"px";this.TabContainer.style.height=this.Chart.content.offsetHeight+2+"px";};contextMenu.prototype.getTabById=function(id)
{for(var i=0;i<this.arrTabs.length;i++){if(this.arrTabs[i].Id==id){return this.arrTabs[i];}}
return null;};function contextMenuTab(id,description,type,showOInfo,contextMenu)
{this.Id=id;this.arrItems=[];this.TabItemContainer=null;this.Description=description;this.contextMenu=contextMenu;this.type=type;this.object=null;this.showObjectInfo=showOInfo;}
contextMenu.prototype.addEvent=function(elm,evType,fn,useCapture)
{if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}
else if(elm.attachEvent){return elm.attachEvent('on'+evType,fn);}
else{elm['on'+evType]=fn;}};contextMenuTab.prototype.addItem=function(id,name,control,type,handler)
{if(handler){control.onclick=handler;}
control.type=type;if(type=="button")
{control.value=name;}
var tabItem=new contextMenuTabItem(id,name,control,this);this.arrItems.push(tabItem);};contextMenuTab.prototype.show=function()
{this.contextMenu.hideDiv.style.display="inline";this.contextMenu.TabContainer.style.visibility="visible";var self=this;this.contextMenu.tabPanel.firstChild.rows[0].cells[0].innerHTML=this.Description;this.contextMenu.tabPanel.style.visibility="visible";var t=this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild;var c,c2,r=null;if(this.showObjectInfo)
{if(this.object){if(this.object.constructor==GanttTask){this.insertData(t,"Id",this.object.TaskInfo.Id);this.insertData(t,"Name",this.object.TaskInfo.Name);this.insertData(t,"Duration",this.object.TaskInfo.Duration+" hrs");this.insertData(t,"Percent complete",this.object.TaskInfo.PercentCompleted+"%");this.insertData(t,"EST",this.object.TaskInfo.EST.getDate()+"."+(this.object.TaskInfo.EST.getMonth()+1)+"."+this.object.TaskInfo.EST.getFullYear());this.insertData(t,"Predecessor",this.object.TaskInfo.PredecessorTaskId);}else
{this.insertData(t,"Id",this.object.Project.Id);this.insertData(t,"Name",this.object.Project.Name);this.insertData(t,"Start date",this.object.Project.StartDate.getDate()+"."+(this.object.Project.StartDate.getMonth()+1)+"."+this.object.Project.StartDate.getFullYear());}}}
var btnCell=null;for(var i=0;i<this.arrItems.length;i++){if(this.arrItems[i].control.type=="button")
{r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);btnCell=r.insertCell(r.cells.length);btnCell.appendChild(this.arrItems[i].control);}else
{r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);c2=r.insertCell(r.cells.length);c.innerHTML=this.arrItems[i].Name;c2.appendChild(this.arrItems[i].control);}}
var b=document.createElement("input");b.type="button";b.value="Cancel";b.onclick=function()
{self.hide();};if(!btnCell){r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);btnCell=r.insertCell(r.cells.length);}else{b.style.marginLeft="10px";}
btnCell.appendChild(b);};contextMenuTab.prototype.hide=function()
{this.contextMenu.tabPanel.style.visibility="hidden";var t=this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild;t.parentNode.removeChild(t);this.contextMenu.tabPanel.firstChild.rows[1].cells[0].innerHTML="<table></table>";this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild.style.cssText="width:250px;font-size:11px;font-family:Tahoma,Arial;";this.contextMenu.hideDiv.style.display="none";this.contextMenu.TabContainer.style.visibility="hidden";};contextMenuTab.prototype.insertData=function(t,name,value)
{var c,c2,r=null;r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);c.style.cssText="width:100px";c.innerHTML=name;c2=r.insertCell(r.cells.length);c2.innerHTML=value;};contextMenuTab.prototype.insertControl=function(t,name,value)
{var c,c2,r=null;r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);c.innerHTML=name;c2=r.insertCell(r.cells.length);c2.appendChild(value);};function contextMenuTabItem(id,name,control,tab)
{this.Id=id;this.Name=name;this.control=control;this.tab=tab;};

/* /web_gantt/static/src/js/gantt.js defined in bundle 'web.assets_backend' */
openerp.web_gantt=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.views.add('gantt','instance.web_gantt.GanttView');instance.web_gantt.GanttView=instance.web.View.extend({display_name:_lt('Gantt'),template:"GanttView",view_type:"gantt",init:function(){var self=this;this._super.apply(this,arguments);this.has_been_loaded=$.Deferred();this.chart_id=_.uniqueId();},view_loading:function(r){return this.load_gantt(r);},load_gantt:function(fields_view_get,fields_get){var self=this;this.fields_view=fields_view_get;this.$el.addClass(this.fields_view.arch.attrs['class']);return self.alive(new instance.web.Model(this.dataset.model).call('fields_get')).then(function(fields){self.fields=fields;self.has_been_loaded.resolve();});},do_search:function(domains,contexts,group_bys){var self=this;self.last_domains=domains;self.last_contexts=contexts;self.last_group_bys=group_bys;var n_group_bys=[];if(this.fields_view.arch.attrs.default_group_by){n_group_bys=this.fields_view.arch.attrs.default_group_by.split(',');}
if(group_bys.length){n_group_bys=group_bys;}
var fields=_.compact(_.map(["date_start","date_delay","date_stop","progress"],function(key){return self.fields_view.arch.attrs[key]||'';}));fields=_.uniq(fields.concat(n_group_bys));return $.when(this.has_been_loaded).then(function(){return self.dataset.read_slice(fields,{domain:domains,context:contexts}).then(function(data){return self.on_data_loaded(data,n_group_bys);});});},reload:function(){if(this.last_domains!==undefined)
return this.do_search(this.last_domains,this.last_contexts,this.last_group_bys);},on_data_loaded:function(tasks,group_bys){var self=this;var ids=_.pluck(tasks,"id");return this.dataset.name_get(ids).then(function(names){var ntasks=_.map(tasks,function(task){return _.extend({__name:_.detect(names,function(name){return name[0]==task.id;})[1]},task);});return self.on_data_loaded_2(ntasks,group_bys);});},on_data_loaded_2:function(tasks,group_bys){var self=this;$(".oe_gantt",this.$el).html("");if(group_bys.length>0){group_bys=[group_bys[0]];}
if(group_bys.length==0){group_bys=["_pseudo_group_by"];_.each(tasks,function(el){el._pseudo_group_by="Gantt View";});this.fields._pseudo_group_by={type:"string"};}
var split_groups=function(tasks,group_bys){if(group_bys.length===0)
return tasks;var groups=[];_.each(tasks,function(task){var group_name=task[_.first(group_bys)];var group=_.find(groups,function(group){return _.isEqual(group.name,group_name);});if(group===undefined){group={name:group_name,tasks:[],__is_group:true};groups.push(group);}
group.tasks.push(task);});_.each(groups,function(group){group.tasks=split_groups(group.tasks,_.rest(group_bys));});return groups;}
var groups=split_groups(tasks,group_bys);var task_ids={};var generate_task_info=function(task,plevel){if(_.isNumber(task[self.fields_view.arch.attrs.progress])){var percent=task[self.fields_view.arch.attrs.progress]||0;}else{var percent=100;}
var level=plevel||0;if(task.__is_group){var task_infos=_.compact(_.map(task.tasks,function(sub_task){return generate_task_info(sub_task,level+1);}));if(task_infos.length==0)
return;var task_start=_.reduce(_.pluck(task_infos,"task_start"),function(date,memo){return memo===undefined||date<memo?date:memo;},undefined);var task_stop=_.reduce(_.pluck(task_infos,"task_stop"),function(date,memo){return memo===undefined||date>memo?date:memo;},undefined);var duration=(task_stop.getTime()-task_start.getTime())/(1000*60*60);var group_name=task.name?instance.web.format_value(task.name,self.fields[group_bys[level]]):"-";if(level==0){var group=new GanttProjectInfo(_.uniqueId("gantt_project_"),group_name,task_start);_.each(task_infos,function(el){group.addTask(el.task_info);});return group;}else{var group=new GanttTaskInfo(_.uniqueId("gantt_project_task_"),group_name,task_start,duration||1,percent);_.each(task_infos,function(el){group.addChildTask(el.task_info);});return{task_info:group,task_start:task_start,task_stop:task_stop};}}else{var task_name=task.__name;var duration_in_business_hours=false;var task_start=instance.web.auto_str_to_date(task[self.fields_view.arch.attrs.date_start]);if(!task_start)
return;var task_stop;if(self.fields_view.arch.attrs.date_stop){task_stop=instance.web.auto_str_to_date(task[self.fields_view.arch.attrs.date_stop]);if(!task_stop)
task_stop=task_start;}else{var tmp=instance.web.format_value(task[self.fields_view.arch.attrs.date_delay],self.fields[self.fields_view.arch.attrs.date_delay]);if(!tmp)
return;task_stop=task_start.clone().addMilliseconds(instance.web.parse_value(tmp,{type:"float"})*60*60*1000);duration_in_business_hours=true;}
var duration=(task_stop.getTime()-task_start.getTime())/(1000*60*60);var id=_.uniqueId("gantt_task_");if(!duration_in_business_hours){duration=(duration/24)*8;}
var task_info=new GanttTaskInfo(id,task_name,task_start,(duration)||1,percent);task_info.internal_task=task;task_ids[id]=task_info;return{task_info:task_info,task_start:task_start,task_stop:task_stop};}}
var gantt=new GanttChart();_.each(_.compact(_.map(groups,function(e){return generate_task_info(e,0);})),function(project){gantt.addProject(project);});gantt.setEditable(true);gantt.setImagePath("/web_gantt/static/lib/dhtmlxGantt/codebase/imgs/");gantt.attachEvent("onTaskEndDrag",function(task){self.on_task_changed(task);});gantt.attachEvent("onTaskEndResize",function(task){self.on_task_changed(task);});gantt.create(this.chart_id);$(".taskNameItem",self.$el).click(function(event){var task_info=task_ids[event.target.id];if(task_info){self.on_task_display(task_info.internal_task);}});if(this.is_action_enabled('create')){var td=$($("table td",self.$el)[0]);var rendered=QWeb.render("GanttView-create-button");$(rendered).prependTo(td);$(".oe_gantt_button_create",this.$el).click(this.on_task_create);}
this.$el.find(".oe_gantt td:first > div, .oe_gantt td:eq(1) > div > div").css("overflow","");},on_task_changed:function(task_obj){var self=this;var itask=task_obj.TaskInfo.internal_task;var start=task_obj.getEST();var duration=task_obj.getDuration();var duration_in_business_hours=!!self.fields_view.arch.attrs.date_delay;if(!duration_in_business_hours){duration=(duration/8)*24;}
var end=start.clone().addMilliseconds(duration*60*60*1000);var data={};data[self.fields_view.arch.attrs.date_start]=instance.web.auto_date_to_str(start,self.fields[self.fields_view.arch.attrs.date_start].type);if(self.fields_view.arch.attrs.date_stop){data[self.fields_view.arch.attrs.date_stop]=instance.web.auto_date_to_str(end,self.fields[self.fields_view.arch.attrs.date_stop].type);}else{data[self.fields_view.arch.attrs.date_delay]=duration;}
this.dataset.write(itask.id,data);},on_task_display:function(task){var self=this;var pop=new instance.web.form.FormOpenPopup(self);pop.on('write_completed',self,self.reload);pop.show_element(self.dataset.model,task.id,null,{});},on_task_create:function(){var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.on("elements_selected",self,function(){self.reload();});pop.select_element(self.dataset.model,{initial_view:"form",});},});};;

/* /web_graph/static/lib/nvd3/d3.v3.js defined in bundle 'web.assets_backend' */
d3=function(){var d3={version:"3.1.5"};if(!Date.now)Date.now=function(){return+new Date();};var d3_document=document,d3_window=window;try{d3_document.createElement("div").style.setProperty("opacity",0,"");}catch(error){var d3_style_prototype=d3_window.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority);};}
d3.ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN;};d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN;};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&((a=array[i])==null||a!=a))a=undefined;while(++i<n)if((b=array[i])!=null&&a>b)a=b;}else{while(++i<n&&((a=f.call(array,array[i],i))==null||a!=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b;}
return a;};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&((a=array[i])==null||a!=a))a=undefined;while(++i<n)if((b=array[i])!=null&&b>a)a=b;}else{while(++i<n&&((a=f.call(array,array[i],i))==null||a!=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b;}
return a;};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n&&((a=c=array[i])==null||a!=a))a=c=undefined;while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b;}}else{while(++i<n&&((a=c=f.call(array,array[i],i))==null||a!=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b;}}
return[a,c];};d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(!isNaN(a=+array[i]))s+=a;}else{while(++i<n)if(!isNaN(a=+f.call(array,array[i],i)))s+=a;}
return s;};function d3_number(x){return x!=null&&!isNaN(x);}
d3.mean=function(array,f){var n=array.length,a,m=0,i=-1,j=0;if(arguments.length===1){while(++i<n)if(d3_number(a=array[i]))m+=(a-m)/++j;}else{while(++i<n)if(d3_number(a=f.call(array,array[i],i)))m+=(a-m)/++j;}
return j?m:undefined;};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v;};d3.median=function(array,f){if(arguments.length>1)array=array.map(f);array=array.filter(d3_number);return array.length?d3.quantile(array.sort(d3.ascending),.5):undefined;};d3.bisector=function(f){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(f.call(a,a[mid],mid)<x)lo=mid+1;else hi=mid;}
return lo;},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(x<f.call(a,a[mid],mid))hi=mid;else lo=mid+1;}
return lo;}};};var d3_bisector=d3.bisector(function(d){return d;});d3.bisectLeft=d3_bisector.left;d3.bisect=d3.bisectRight=d3_bisector.right;d3.shuffle=function(array){var m=array.length,t,i;while(m){i=Math.random()*m--|0;t=array[m],array[m]=array[i],array[i]=t;}
return array;};d3.permute=function(array,indexes){var permutes=[],i=-1,n=indexes.length;while(++i<n)permutes[i]=array[indexes[i]];return permutes;};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i];}}
return zips;};function d3_zipLength(d){return d.length;}
d3.transpose=function(matrix){return d3.zip.apply(d3,matrix);};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys;};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values;};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries;};d3.merge=function(arrays){return Array.prototype.concat.apply([],arrays);};d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0;}}
if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(Math.abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range;};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k;}
function d3_class(ctor,properties){try{for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false});}}catch(e){ctor.prototype=properties;}}
d3.map=function(object){var map=new d3_Map();for(var key in object)map.set(key,object[key]);return map;};function d3_Map(){}
d3_class(d3_Map,{has:function(key){return d3_map_prefix+key in this;},get:function(key){return this[d3_map_prefix+key];},set:function(key,value){return this[d3_map_prefix+key]=value;},remove:function(key){key=d3_map_prefix+key;return key in this&&delete this[key];},keys:function(){var keys=[];this.forEach(function(key){keys.push(key);});return keys;},values:function(){var values=[];this.forEach(function(key,value){values.push(value);});return values;},entries:function(){var entries=[];this.forEach(function(key,value){entries.push({key:key,value:value});});return entries;},forEach:function(f){for(var key in this){if(key.charCodeAt(0)===d3_map_prefixCode){f.call(this,key.substring(1),this[key]);}}}});var d3_map_prefix="\0",d3_map_prefixCode=d3_map_prefix.charCodeAt(0);d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map(),values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object);}else{valuesByKey.set(keyValue,[object]);}}
if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth));};}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth);};}
valuesByKey.forEach(setter);return object;}
function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)});});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key);}):array;}
nest.map=function(array,mapType){return map(mapType,array,0);};nest.entries=function(array){return entries(map(d3.map,array,0),0);};nest.key=function(d){keys.push(d);return nest;};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest;};nest.sortValues=function(order){sortValues=order;return nest;};nest.rollup=function(f){rollup=f;return nest;};return nest;};d3.set=function(array){var set=new d3_Set();if(array)for(var i=0;i<array.length;i++)set.add(array[i]);return set;};function d3_Set(){}
d3_class(d3_Set,{has:function(value){return d3_map_prefix+value in this;},add:function(value){this[d3_map_prefix+value]=true;return value;},remove:function(value){value=d3_map_prefix+value;return value in this&&delete this[value];},values:function(){var values=[];this.forEach(function(value){values.push(value);});return values;},forEach:function(f){for(var value in this){if(value.charCodeAt(0)===d3_map_prefixCode){f.call(this,value.substring(1));}}}});d3.behavior={};d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target;};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value;};}
d3.dispatch=function(){var dispatch=new d3_dispatch(),i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch;};function d3_dispatch(){}
d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.substring(i+1);type=type.substring(0,i);}
if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null);}
return this;}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map();function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch;}
event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name);}
if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch;};return event;}
d3.event=null;function d3_eventCancel(){d3.event.stopPropagation();d3.event.preventDefault();}
function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e;}
function d3_eventSuppress(target,type){function off(){target.on(type,null);}
target.on(type,function(){d3_eventCancel();off();},true);setTimeout(off,0);}
function d3_eventDispatch(target){var dispatch=new d3_dispatch(),i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz);}finally{d3.event=e0;}};};return dispatch;}
d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource());};var d3_mouse_bug44083=/WebKit/.test(d3_window.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0&&(d3_window.scrollX||d3_window.scrollY)){svg=d3.select(d3_document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove();}
if(d3_mouse_bug44083){point.x=e.pageX;point.y=e.pageY;}else{point.x=e.clientX;point.y=e.clientY;}
point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y];}
var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop];}
var d3_array=d3_arraySlice;function d3_arrayCopy(pseudoarray){var i=-1,n=pseudoarray.length,array=[];while(++i<n)array.push(pseudoarray[i]);return array;}
function d3_arraySlice(pseudoarray){return Array.prototype.slice.call(pseudoarray);}
try{d3_array(d3_document.documentElement.childNodes)[0].nodeType;}catch(e){d3_array=d3_arrayCopy;}
var d3_arraySubclass=[].__proto__?function(array,prototype){array.__proto__=prototype;}:function(array,prototype){for(var property in prototype)array[property]=prototype[property];};d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point;}):[];};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null;function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",mousedown);}
function mousedown(){var target=this,event_=event.of(target,arguments),eventTarget=d3.event.target,touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,offset,origin_=point(),moved=0;var w=d3.select(d3_window).on(touchId!=null?"touchmove.drag-"+touchId:"mousemove.drag",dragmove).on(touchId!=null?"touchend.drag-"+touchId:"mouseup.drag",dragend,true);if(origin){offset=origin.apply(target,arguments);offset=[offset.x-origin_[0],offset.y-origin_[1]];}else{offset=[0,0];}
if(touchId==null)d3_eventCancel();event_({type:"dragstart"});function point(){var p=target.parentNode;return touchId!=null?d3.touches(p).filter(function(p){return p.identifier===touchId;})[0]:d3.mouse(p);}
function dragmove(){if(!target.parentNode)return dragend();var p=point(),dx=p[0]-origin_[0],dy=p[1]-origin_[1];moved|=dx|dy;origin_=p;d3_eventCancel();event_({type:"drag",x:p[0]+offset[0],y:p[1]+offset[1],dx:dx,dy:dy});}
function dragend(){event_({type:"dragend"});if(moved){d3_eventCancel();if(d3.event.target===eventTarget)d3_eventSuppress(w,"click");}
w.on(touchId!=null?"touchmove.drag-"+touchId:"mousemove.drag",null).on(touchId!=null?"touchend.drag-"+touchId:"mouseup.drag",null);}}
drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag;};return d3.rebind(drag,event,"on");};function d3_selection(groups){d3_arraySubclass(groups,d3_selectionPrototype);return groups;}
var d3_select=function(s,n){return n.querySelector(s);},d3_selectAll=function(s,n){return n.querySelectorAll(s);},d3_selectRoot=d3_document.documentElement,d3_selectMatcher=d3_selectRoot.matchesSelector||d3_selectRoot.webkitMatchesSelector||d3_selectRoot.mozMatchesSelector||d3_selectRoot.msMatchesSelector||d3_selectRoot.oMatchesSelector,d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s);};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null;};d3_selectAll=function(s,n){return Sizzle.uniqueSort(Sizzle(s,n));};d3_selectMatches=Sizzle.matchesSelector;}
var d3_selectionPrototype=[];d3.selection=function(){return d3_selectionRoot;};d3.selection.prototype=d3_selectionPrototype;d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;if(typeof selector!=="function")selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i));if(subnode&&"__data__"in node)subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};function d3_selection_selector(selector){return function(){return d3_select(selector,this);};}
d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;if(typeof selector!=="function")selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i)));subgroup.parentNode=node;}}}
return d3_selection(subgroups);};function d3_selection_selectorAll(selector){return function(){return d3_selectAll(selector,this);};}
var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.substring(0,i);name=name.substring(i+1);}
return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name;}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name);}
for(value in name)this.each(d3_selection_attr(value,name[value]));return this;}
return this.each(d3_selection_attr(name,value));};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrConstant(){this.setAttribute(name,value);}
function attrConstantNS(){this.setAttributeNS(name.space,name.local,value);}
function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x);}
function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x);}
return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant;}
function d3_collapse(s){return s.trim().replace(/\s+/g," ");}
d3.requote=function(s){return s.replace(d3_requote_re,"\\$&");};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=name.trim().split(/^|\s+/g)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false;}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false;}
return true;}
for(value in name)this.each(d3_selection_classed(value,name[value]));return this;}
return this.each(d3_selection_classed(name,value));};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g");}
function d3_selection_classed(name,value){name=name.trim().split(/\s+/).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value);}
function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x);}
return typeof value==="function"?classedFunction:classedConstant;}
function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name));}else{node.setAttribute("class",d3_collapse(c.replace(re," ")));}};}
d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this;}
if(n<2)return d3_window.getComputedStyle(this.node(),null).getPropertyValue(name);priority="";}
return this.each(d3_selection_style(name,value,priority));};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name);}
function styleConstant(){this.style.setProperty(name,value,priority);}
function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority);}
return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant;}
d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this;}
return this.each(d3_selection_property(name,value));};function d3_selection_property(name,value){function propertyNull(){delete this[name];}
function propertyConstant(){this[name]=value;}
function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x;}
return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant;}
d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v;}:value==null?function(){this.textContent="";}:function(){this.textContent=value;}):this.node().textContent;};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v;}:value==null?function(){this.innerHTML="";}:function(){this.innerHTML=value;}):this.node().innerHTML;};d3_selectionPrototype.append=function(name){name=d3.ns.qualify(name);function append(){return this.appendChild(d3_document.createElementNS(this.namespaceURI,name));}
function appendNS(){return this.appendChild(d3_document.createElementNS(name.space,name.local));}
return this.select(name.local?appendNS:append);};d3_selectionPrototype.insert=function(name,before){name=d3.ns.qualify(name);if(typeof before!=="function")before=d3_selection_selector(before);function insert(d,i){return this.insertBefore(d3_document.createElementNS(this.namespaceURI,name),before.call(this,d,i));}
function insertNS(d,i){return this.insertBefore(d3_document.createElementNS(name.space,name.local),before.call(this,d,i));}
return this.select(name.local?insertNS:insert);};d3_selectionPrototype.remove=function(){return this.each(function(){var parent=this.parentNode;if(parent)parent.removeChild(this);});};d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__;}}
return value;}
function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map(),dataByKeyValue=new d3_Map(),keyValues=[],keyValue;for(i=-1;++i<n;){keyValue=key.call(node=group[i],node.__data__,i);if(nodeByKeyValue.has(keyValue)){exitNodes[i]=node;}else{nodeByKeyValue.set(keyValue,node);}
keyValues.push(keyValue);}
for(i=-1;++i<m;){keyValue=key.call(groupData,nodeData=groupData[i],i);if(node=nodeByKeyValue.get(keyValue)){updateNodes[i]=node;node.__data__=nodeData;}else if(!dataByKeyValue.has(keyValue)){enterNodes[i]=d3_selection_dataNode(nodeData);}
dataByKeyValue.set(keyValue,nodeData);nodeByKeyValue.remove(keyValue);}
for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValues[i])){exitNodes[i]=group[i];}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node;}else{enterNodes[i]=d3_selection_dataNode(nodeData);}}
for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i]);}
for(;i<n;++i){exitNodes[i]=group[i];}}
enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes);}
var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i));}}else{while(++i<n){bind(group=this[i],value);}}
update.enter=function(){return enter;};update.exit=function(){return exit;};return update;};function d3_selection_dataNode(data){return{__data__:data};}
d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__");};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i)){subgroup.push(node);}}}
return d3_selection(subgroups);};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector);};}
d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node;}}}
return this;};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order();};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3.ascending;return function(a,b){return!a-!b||comparator(a.__data__,b.__data__);};}
function d3_noop(){}
d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this;}
if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false;}
return this.each(d3_selection_on(type,listener,capture));};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.substring(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name];}}
function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener;}
function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name];}}}
return i?listener?onAdd:onRemove:listener?d3_noop:removeAll;}
var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k);});function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz);}finally{d3.event=o;}};}
function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e);}};}
d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j);});};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j);}}
return groups;}
d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this;};d3_selectionPrototype.empty=function(){return!this.node();};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node;}}
return null;};function d3_selection_enter(selection){d3_arraySubclass(selection,d3_selection_enterPrototype);return selection;}
var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.insert=d3_selectionPrototype.insert;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i));subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};d3_selectionPrototype.transition=function(){var id=d3_transitionInheritId||++d3_transitionId,subgroups=[],subgroup,node,transition=Object.create(d3_transitionInherit);transition.time=Date.now();for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,id,transition);subgroup.push(node);}}
return d3_transition(subgroups,id);};var d3_selectionRoot=d3_selection([[d3_document]]);d3_selectionRoot[0].parentNode=d3_selectRoot;d3.select=function(selector){return typeof selector==="string"?d3_selectionRoot.select(selector):d3_selection([[selector]]);};d3.selectAll=function(selector){return typeof selector==="string"?d3_selectionRoot.selectAll(selector):d3_selection([d3_array(selector)]);};d3.behavior.zoom=function(){var translate=[0,0],translate0,scale=1,scale0,scaleExtent=d3_behavior_zoomInfinity,event=d3_eventDispatch(zoom,"zoom"),x0,x1,y0,y1,touchtime;function zoom(){this.on("mousedown.zoom",mousedown).on("mousemove.zoom",mousemove).on(d3_behavior_zoomWheel+".zoom",mousewheel).on("dblclick.zoom",dblclick).on("touchstart.zoom",touchstart).on("touchmove.zoom",touchmove).on("touchend.zoom",touchstart);}
zoom.translate=function(x){if(!arguments.length)return translate;translate=x.map(Number);rescale();return zoom;};zoom.scale=function(x){if(!arguments.length)return scale;scale=+x;rescale();return zoom;};zoom.scaleExtent=function(x){if(!arguments.length)return scaleExtent;scaleExtent=x==null?d3_behavior_zoomInfinity:x.map(Number);return zoom;};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();translate=[0,0];scale=1;return zoom;};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();translate=[0,0];scale=1;return zoom;};function location(p){return[(p[0]-translate[0])/scale,(p[1]-translate[1])/scale];}
function point(l){return[l[0]*scale+translate[0],l[1]*scale+translate[1]];}
function scaleTo(s){scale=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s));}
function translateTo(p,l){l=point(l);translate[0]+=p[0]-l[0];translate[1]+=p[1]-l[1];}
function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-translate[0])/scale;}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-translate[1])/scale;}).map(y0.invert));}
function dispatch(event){rescale();d3.event.preventDefault();event({type:"zoom",scale:scale,translate:translate});}
function mousedown(){var target=this,event_=event.of(target,arguments),eventTarget=d3.event.target,moved=0,w=d3.select(d3_window).on("mousemove.zoom",mousemove).on("mouseup.zoom",mouseup),l=location(d3.mouse(target));d3_window.focus();d3_eventCancel();function mousemove(){moved=1;translateTo(d3.mouse(target),l);dispatch(event_);}
function mouseup(){if(moved)d3_eventCancel();w.on("mousemove.zoom",null).on("mouseup.zoom",null);if(moved&&d3.event.target===eventTarget)d3_eventSuppress(w,"click.zoom");}}
function mousewheel(){if(!translate0)translate0=location(d3.mouse(this));scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*scale);translateTo(d3.mouse(this),translate0);dispatch(event.of(this,arguments));}
function mousemove(){translate0=null;}
function dblclick(){var p=d3.mouse(this),l=location(p),k=Math.log(scale)/Math.LN2;scaleTo(Math.pow(2,d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1));translateTo(p,l);dispatch(event.of(this,arguments));}
function touchstart(){var touches=d3.touches(this),now=Date.now();scale0=scale;translate0={};touches.forEach(function(t){translate0[t.identifier]=location(t);});d3_eventCancel();if(touches.length===1){if(now-touchtime<500){var p=touches[0],l=location(touches[0]);scaleTo(scale*2);translateTo(p,l);dispatch(event.of(this,arguments));}
touchtime=now;}}
function touchmove(){var touches=d3.touches(this),p0=touches[0],l0=translate0[p0.identifier];if(p1=touches[1]){var p1,l1=translate0[p1.identifier];p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(d3.event.scale*scale0);}
translateTo(p0,l0);touchtime=null;dispatch(event.of(this,arguments));}
return d3.rebind(zoom,event,"on");};var d3_behavior_zoomInfinity=[0,Infinity];var d3_behavior_zoomDelta,d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1);},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta;},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail;},"MozMousePixelScroll");function d3_Color(){}
d3_Color.prototype.toString=function(){return this.rgb()+"";};d3.hsl=function(h,s,l){return arguments.length===1?h instanceof d3_Hsl?d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):d3_hsl(+h,+s,+l);};function d3_hsl(h,s,l){return new d3_Hsl(h,s,l);}
function d3_Hsl(h,s,l){this.h=h;this.s=s;this.l=l;}
var d3_hslPrototype=d3_Hsl.prototype=new d3_Color();d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,this.l/k);};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,k*this.l);};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l);};function d3_hsl_rgb(h,s,l){var m1,m2;h=h%360;if(h<0)h+=360;s=s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
return d3_rgb(vv(h+120),vv(h),vv(h-120));}
var π=Math.PI,ε=1e-6,d3_radians=π/180,d3_degrees=180/π;function d3_sgn(x){return x>0?1:x<0?-1:0;}
function d3_acos(x){return Math.acos(Math.max(-1,Math.min(1,x)));}
function d3_asin(x){return x>1?π/2:x<-1?-π/2:Math.asin(x);}
function d3_sinh(x){return(Math.exp(x)-Math.exp(-x))/2;}
function d3_cosh(x){return(Math.exp(x)+Math.exp(-x))/2;}
function d3_haversin(x){return(x=Math.sin(x/2))*x;}
d3.hcl=function(h,c,l){return arguments.length===1?h instanceof d3_Hcl?d3_hcl(h.h,h.c,h.l):h instanceof d3_Lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):d3_hcl(+h,+c,+l);};function d3_hcl(h,c,l){return new d3_Hcl(h,c,l);}
function d3_Hcl(h,c,l){this.h=h;this.c=c;this.l=l;}
var d3_hclPrototype=d3_Hcl.prototype=new d3_Color();d3_hclPrototype.brighter=function(k){return d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.darker=function(k){return d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb();};function d3_hcl_lab(h,c,l){return d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c);}
d3.lab=function(l,a,b){return arguments.length===1?l instanceof d3_Lab?d3_lab(l.l,l.a,l.b):l instanceof d3_Hcl?d3_hcl_lab(l.l,l.c,l.h):d3_rgb_lab((l=d3.rgb(l)).r,l.g,l.b):d3_lab(+l,+a,+b);};function d3_lab(l,a,b){return new d3_Lab(l,a,b);}
function d3_Lab(l,a,b){this.l=l;this.a=a;this.b=b;}
var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_Lab.prototype=new d3_Color();d3_labPrototype.brighter=function(k){return d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.darker=function(k){return d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b);};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z));}
function d3_lab_hcl(l,a,b){return d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l);}
function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037;}
function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29;}
function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055));}
d3.rgb=function(r,g,b){return arguments.length===1?r instanceof d3_Rgb?d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):d3_rgb(~~r,~~g,~~b);};function d3_rgb(r,g,b){return new d3_Rgb(r,g,b);}
function d3_Rgb(r,g,b){this.r=r;this.g=g;this.b=b;}
var d3_rgbPrototype=d3_Rgb.prototype=new d3_Color();d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return d3_rgb(Math.min(255,Math.floor(r/k)),Math.min(255,Math.floor(g/k)),Math.min(255,Math.floor(b/k)));};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_rgb(Math.floor(k*this.r),Math.floor(k*this.g),Math.floor(k*this.b));};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b);};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b);};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16);}
function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,name;m1=/([a-z]+)\((.*)\)/i.exec(format);if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);}
case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]));}}}
if(name=d3_rgb_names.get(format))return rgb(name.r,name.g,name.b);if(format!=null&&format.charAt(0)==="#"){if(format.length===4){r=format.charAt(1);r+=r;g=format.charAt(2);g+=g;b=format.charAt(3);b+=b;}else if(format.length===7){r=format.substring(1,3);g=format.substring(3,5);b=format.substring(5,7);}
r=parseInt(r,16);g=parseInt(g,16);b=parseInt(b,16);}
return rgb(r,g,b);}
function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60;}else{s=h=0;}
return d3_hsl(h,s,l);}
function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z));}
function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);}
function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f;}
var d3_rgb_names=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgb_parse(value,d3_rgb,d3_hsl_rgb));});function d3_functor(v){return typeof v==="function"?v:function(){return v;};}
d3.functor=d3_functor;function d3_identity(d){return d;}
d3.xhr=function(url,mimeType,callback){var xhr={},dispatch=d3.dispatch("progress","load","error"),headers={},response=d3_identity,request=new(d3_window.XDomainRequest&&/^(http(s)?:)?\/\//.test(url)?XDomainRequest:XMLHttpRequest)();"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond();};function respond(){var s=request.status;!s&&request.responseText||s>=200&&s<300||s===304?dispatch.load.call(xhr,response.call(xhr,request)):dispatch.error.call(xhr,request);}
request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request);}finally{d3.event=o;}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr;};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr;};xhr.response=function(value){response=value;return xhr;};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)));};});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request);});request.send(data==null?null:data);return xhr;};xhr.abort=function(){request.abort();return xhr;};d3.rebind(xhr,dispatch,"on");if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback));};function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null);}:callback;}
function d3_dsv(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3.xhr(url,mimeType,callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row;};return xhr.row(row);}
function response(request){return dsv.parse(request.responseText);}
function typedResponse(f){return function(request){return dsv.parse(request.responseText,f);};}
dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]";}).join(",")+"}");o=f?function(row,i){return f(a(row),i);}:a;});};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i;}}
I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I;}else if(c===10){eol=true;}
return text.substring(j+1,i).replace(/""/g,'"');}
while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k;}else if(c!==delimiterCode)continue;return text.substring(j,I-k);}
return text.substring(j);}
while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token();}
if(f&&!(a=f(a,n++)))continue;rows.push(a);}
return rows;};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set(),fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field));}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field]);}).join(delimiter);})).join("\n");};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n");};function formatRow(row){return row.map(formatValue).join(delimiter);}
function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text;}
return dsv;}
d3.csv=d3_dsv(",","text/csv");d3.tsv=d3_dsv("	","text/tab-separated-values");var d3_timer_id=0,d3_timer_byId={},d3_timer_queue=null,d3_timer_interval,d3_timer_timeout;d3.timer=function(callback,delay,then){if(arguments.length<3){if(arguments.length<2)delay=0;else if(!isFinite(delay))return;then=Date.now();}
var timer=d3_timer_byId[callback.id];if(timer&&timer.callback===callback){timer.then=then;timer.delay=delay;}else d3_timer_byId[callback.id=++d3_timer_id]=d3_timer_queue={callback:callback,then:then,delay:delay,next:d3_timer_queue};if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step);}};function d3_timer_step(){var elapsed,now=Date.now(),t1=d3_timer_queue;while(t1){elapsed=now-t1.then;if(elapsed>=t1.delay)t1.flush=t1.callback(elapsed);t1=t1.next;}
var delay=d3_timer_flush()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay);}
d3_timer_interval=0;}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step);}}
d3.timer.flush=function(){var elapsed,now=Date.now(),t1=d3_timer_queue;while(t1){elapsed=now-t1.then;if(!t1.delay)t1.flush=t1.callback(elapsed);t1=t1.next;}
d3_timer_flush();};function d3_timer_flush(){var t0=null,t1=d3_timer_queue,then=Infinity;while(t1){if(t1.flush){delete d3_timer_byId[t1.callback.id];t1=t0?t0.next=t1.next:d3_timer_queue=t1.next;}else{then=Math.min(then,t1.then+t1.delay);t1=(t0=t1).next;}}
return then;}
var d3_timer_frame=d3_window.requestAnimationFrame||d3_window.webkitRequestAnimationFrame||d3_window.mozRequestAnimationFrame||d3_window.oRequestAnimationFrame||d3_window.msRequestAnimationFrame||function(callback){setTimeout(callback,17);};var d3_format_decimalPoint=".",d3_format_thousandsSeparator=",",d3_format_grouping=[3,3];var d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i<=0?i+1:i-1)/3)*3));}
return d3_formatPrefixes[8+i/3];};function d3_formatPrefix(d,i){var k=Math.pow(10,Math.abs(8-i)*3);return{scale:i>8?function(d){return d/k;}:function(d){return d*k;},symbol:d};}
d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x);};d3.format=function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"",basePrefix=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,suffix="",integer=false;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="=";if(comma)width-=Math.floor((width-1)/4);}
switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(basePrefix)basePrefix="0"+type.toLowerCase();case"c":case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break;}
if(basePrefix==="#")basePrefix="";if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision));}
type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign;if(scale<0){var prefix=d3.formatPrefix(value,precision);value=prefix.scale(value);suffix=prefix.symbol;}else{value*=scale;}
value=type(value,precision);if(!zfill&&comma)value=d3_format_group(value);var length=basePrefix.length+value.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)value=d3_format_group(padding+value);if(d3_format_decimalPoint)value.replace(".",d3_format_decimalPoint);negative+=basePrefix;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+suffix;};};var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2);},c:function(x){return String.fromCharCode(x);},o:function(x){return x.toString(8);},x:function(x){return x.toString(16);},X:function(x){return x.toString(16).toUpperCase();},g:function(x,p){return x.toPrecision(p);},e:function(x,p){return x.toExponential(p);},f:function(x,p){return x.toFixed(p);},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))));}});function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1);}
function d3_format_typeDefault(x){return x+"";}
var d3_format_group=d3_identity;if(d3_format_grouping){var d3_format_groupingLength=d3_format_grouping.length;d3_format_group=function(value){var i=value.lastIndexOf("."),f=i>=0?"."+value.substring(i+1):(i=value.length,""),t=[],j=0,g=d3_format_grouping[0];while(i>0&&g>0){t.push(value.substring(i-=g,i+g));g=d3_format_grouping[j=(j+1)%d3_format_groupingLength];}
return t.reverse().join(d3_format_thousandsSeparator||"")+f;};}
d3.geo={};d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener);}else{d3_geo_streamGeometry(object,listener);}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener);}}
var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener);},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener);}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere();},Point:function(object,listener){var coordinate=object.coordinates;listener.point(coordinate[0],coordinate[1]);},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length,coordinate;while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1]);},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0);},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0);},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener);},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener);},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener);}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1]);listener.lineEnd();}
function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd();}
d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum;};var d3_geo_areaSum,d3_geo_areaRingU,d3_geo_areaRingV;var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π;},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingU=1,d3_geo_areaRingV=0;d3_geo_area.lineStart=d3_geo_areaRingStart;},polygonEnd:function(){var area=2*Math.atan2(d3_geo_areaRingV,d3_geo_areaRingU);d3_geo_areaSum+=area<0?4*π+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop;}};function d3_geo_areaRingStart(){var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint;λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ);};function nextPoint(λ,φ){λ*=d3_radians;φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u0=d3_geo_areaRingU,v0=d3_geo_areaRingV,u=cosφ0*cosφ+k*Math.cos(dλ),v=k*Math.sin(dλ);d3_geo_areaRingU=u0*u-v0*v;d3_geo_areaRingV=v0*u+u0*v;λ0=λ,cosφ0=cosφ,sinφ0=sinφ;}
d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00);};}
d3.geo.bounds=d3_geo_bounds(d3_identity);function d3_geo_bounds(projectStream){var x0,y0,x1,y1;var bound={point:boundPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){bound.lineEnd=boundPolygonLineEnd;},polygonEnd:function(){bound.point=boundPoint;}};function boundPoint(x,y){if(x<x0)x0=x;if(x>x1)x1=x;if(y<y0)y0=y;if(y>y1)y1=y;}
function boundPolygonLineEnd(){bound.point=bound.lineEnd=d3_noop;}
return function(feature){y1=x1=-(x0=y0=Infinity);d3.geo.stream(feature,projectStream(bound));return[[x0,y0],[x1,y1]];};}
d3.geo.centroid=function(object){d3_geo_centroidDimension=d3_geo_centroidW=d3_geo_centroidX=d3_geo_centroidY=d3_geo_centroidZ=0;d3.geo.stream(object,d3_geo_centroid);var m;if(d3_geo_centroidW&&Math.abs(m=Math.sqrt(d3_geo_centroidX*d3_geo_centroidX+d3_geo_centroidY*d3_geo_centroidY+d3_geo_centroidZ*d3_geo_centroidZ))>ε){return[Math.atan2(d3_geo_centroidY,d3_geo_centroidX)*d3_degrees,Math.asin(Math.max(-1,Math.min(1,d3_geo_centroidZ/m)))*d3_degrees];}};var d3_geo_centroidDimension,d3_geo_centroidW,d3_geo_centroidX,d3_geo_centroidY,d3_geo_centroidZ;var d3_geo_centroid={sphere:function(){if(d3_geo_centroidDimension<2){d3_geo_centroidDimension=2;d3_geo_centroidW=d3_geo_centroidX=d3_geo_centroidY=d3_geo_centroidZ=0;}},point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){if(d3_geo_centroidDimension<2){d3_geo_centroidDimension=2;d3_geo_centroidW=d3_geo_centroidX=d3_geo_centroidY=d3_geo_centroidZ=0;}
d3_geo_centroid.lineStart=d3_geo_centroidRingStart;},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart;}};function d3_geo_centroidPoint(λ,φ){if(d3_geo_centroidDimension)return;++d3_geo_centroidW;λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidX+=(cosφ*Math.cos(λ)-d3_geo_centroidX)/d3_geo_centroidW;d3_geo_centroidY+=(cosφ*Math.sin(λ)-d3_geo_centroidY)/d3_geo_centroidW;d3_geo_centroidZ+=(Math.sin(φ)-d3_geo_centroidZ)/d3_geo_centroidW;}
function d3_geo_centroidRingStart(){var λ00,φ00;d3_geo_centroidDimension=1;d3_geo_centroidLineStart();d3_geo_centroidDimension=2;var linePoint=d3_geo_centroid.point;d3_geo_centroid.point=function(λ,φ){linePoint(λ00=λ,φ00=φ);};d3_geo_centroid.lineEnd=function(){d3_geo_centroid.point(λ00,φ00);d3_geo_centroidLineEnd();d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;};}
function d3_geo_centroidLineStart(){var x0,y0,z0;if(d3_geo_centroidDimension>1)return;if(d3_geo_centroidDimension<1){d3_geo_centroidDimension=1;d3_geo_centroidW=d3_geo_centroidX=d3_geo_centroidY=d3_geo_centroidZ=0;}
d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroid.point=nextPoint;};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW+=w;d3_geo_centroidX+=w*(x0+(x0=x));d3_geo_centroidY+=w*(y0+(y0=y));d3_geo_centroidZ+=w*(z0+(z0=z));}}
function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint;}
function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)];}
function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}
function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}
function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];}
function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k];}
function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l;}
function d3_true(){return true;}
function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),Math.asin(Math.max(-1,Math.min(1,cartesian[2])))];}
function d3_geo_sphericalEqual(a,b){return Math.abs(a[0]-b[0])<ε&&Math.abs(a[1]-b[1])<ε;}
function d3_geo_clipPolygon(segments,compare,inside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return;}
var a={point:p0,points:segment,other:null,visited:false,entry:true,subject:true},b={point:p0,points:[p0],other:a,visited:false,entry:false,subject:false};a.other=b;subject.push(a);clip.push(b);a={point:p1,points:[p1],other:null,visited:false,entry:false,subject:true};b={point:p1,points:[p1],other:a,visited:false,entry:true,subject:false};a.other=b;subject.push(a);clip.push(b);});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;if(inside)for(var i=1,e=!inside(clip[0].point),n=clip.length;i<n;++i){clip[i].entry=e=!e;}
var start=subject[0],current,points,point;while(1){current=start;while(current.visited)if((current=current.next)===start)return;points=current.points;listener.lineStart();do{current.visited=current.other.visited=true;if(current.entry){if(current.subject){for(var i=0;i<points.length;i++)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.point,current.next.point,1,listener);}
current=current.next;}else{if(current.subject){points=current.prev.points;for(var i=points.length;--i>=0;)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.point,current.prev.point,-1,listener);}
current=current.prev;}
current=current.other;points=current.points;}while(!current.visited);listener.lineEnd();}}
function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.next=b=array[i];b.prev=a;a=b;}
a.next=b=array[0];b.prev=a;}
function d3_geo_clip(pointVisible,clipLine,interpolate){return function(listener){var line=clipLine(listener);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;invisible=false;invisibleArea=visibleArea=0;segments=[];listener.polygonStart();},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);if(segments.length){d3_geo_clipPolygon(segments,d3_geo_clipSort,null,interpolate,listener);}else if(visibleArea<-ε||invisible&&invisibleArea<-ε){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
listener.polygonEnd();segments=null;},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd();}};function point(λ,φ){if(pointVisible(λ,φ))listener.point(λ,φ);}
function pointLine(λ,φ){line.point(λ,φ);}
function lineStart(){clip.point=pointLine;line.lineStart();}
function lineEnd(){clip.point=point;line.lineEnd();}
var segments,visibleArea,invisibleArea,invisible;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),ring;function pointRing(λ,φ){ringListener.point(λ,φ);ring.push([λ,φ]);}
function ringStart(){ringListener.lineStart();ring=[];}
function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;if(!n){invisible=true;invisibleArea+=d3_geo_clipAreaRing(ring,-1);ring=null;return;}
ring=null;if(clean&1){segment=ringSegments[0];visibleArea+=d3_geo_clipAreaRing(segment,1);var n=segment.length-1,i=-1,point;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd();return;}
if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1));}
return clip;};}
function d3_geo_clipSegmentLength1(segment){return segment.length>1;}
function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[]);},point:function(λ,φ){line.push([λ,φ]);},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer;},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()));}};}
function d3_geo_clipAreaRing(ring,invisible){if(!(n=ring.length))return 0;var n,i=0,area=0,p=ring[0],λ=p[0],φ=p[1],cosφ=Math.cos(φ),x0=Math.atan2(invisible*Math.sin(λ)*cosφ,Math.sin(φ)),y0=1-invisible*Math.cos(λ)*cosφ,x1=x0,x,y;while(++i<n){p=ring[i];cosφ=Math.cos(φ=p[1]);x=Math.atan2(invisible*Math.sin(λ=p[0])*cosφ,Math.sin(φ));y=1-invisible*Math.cos(λ)*cosφ;if(Math.abs(y0-2)<ε&&Math.abs(y-2)<ε)continue;if(Math.abs(y)<ε||Math.abs(y0)<ε){}else if(Math.abs(Math.abs(x-x0)-π)<ε){if(y+y0>2)area+=4*(x-x0);}else if(Math.abs(y0-2)<ε)area+=4*(x-x1);else area+=((3*π+x-x0)%(2*π)-π)*(y0+y);x1=x0,x0=x,y0=y;}
return area;}
function d3_geo_clipSort(a,b){return((a=a.point)[0]<0?a[1]-π/2-ε:π/2-a[1])-((b=b.point)[0]<0?b[1]-π/2-ε:π/2-b[1]);}
var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate);function d3_geo_clipAntimeridianLine(listener){var λ0=NaN,φ0=NaN,sλ0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1;},point:function(λ1,φ1){var sλ1=λ1>0?π:-π,dλ=Math.abs(λ1-λ0);if(Math.abs(dλ-π)<ε){listener.point(λ0,φ0=(φ0+φ1)/2>0?π/2:-π/2);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);listener.point(λ1,φ0);clean=0;}else if(sλ0!==sλ1&&dλ>=π){if(Math.abs(λ0-sλ0)<ε)λ0-=sλ0*ε;if(Math.abs(λ1-sλ1)<ε)λ1-=sλ1*ε;φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);clean=0;}
listener.point(λ0=λ1,φ0=φ1);sλ0=sλ1;},lineEnd:function(){listener.lineEnd();λ0=φ0=NaN;},clean:function(){return 2-clean;}};}
function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return Math.abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2;}
function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(from==null){φ=direction*π/2;listener.point(-π,φ);listener.point(0,φ);listener.point(π,φ);listener.point(π,0);listener.point(π,-φ);listener.point(0,-φ);listener.point(-π,-φ);listener.point(-π,0);listener.point(-π,φ);}else if(Math.abs(from[0]-to[0])>ε){var s=(from[0]<to[0]?1:-1)*π;φ=direction*s/2;listener.point(-s,φ);listener.point(0,φ);listener.point(s,φ);}else{listener.point(to[0],to[1]);}}
function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=Math.abs(cr)>ε,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate);function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr;}
function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1;},point:function(λ,φ){var point1=[λ,φ],point2,v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(λ<0?π:-π),φ):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=ε;point1[1]+=ε;v=visible(point1[0],point1[1]);}}
if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1]);}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd();}
point0=point2;}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd();}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1]);}}}
if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1]);}
point0=point1,v0=v,c0=c;},lineEnd:function(){if(v0)listener.lineEnd();point0=null;},clean:function(){return clean|(v00&&v0)<<1;}};}
function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1],z;if(λ1<λ0)z=λ0,λ0=λ1,λ1=z;var δλ=λ1-λ0,polar=Math.abs(δλ-π)<ε,meridian=polar||δλ<ε;if(!polar&&φ1<φ0)z=φ0,φ0=φ1,φ1=z;if(meridian?polar?φ0+φ1>0^q[1]<(Math.abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)];}}
function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;if(λ<-r)code|=1;else if(λ>r)code|=2;if(φ<-r)code|=4;else if(φ>r)code|=8;return code;}}
var d3_geo_clipViewMAX=1e9;function d3_geo_clipView(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];},polygonEnd:function(){listener=listener_;if((segments=d3.merge(segments)).length){listener.polygonStart();d3_geo_clipPolygon(segments,compare,inside,interpolate,listener);listener.polygonEnd();}else if(insidePolygon([x0,y0])){listener.polygonStart(),listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd(),listener.polygonEnd();}
segments=polygon=ring=null;}};function inside(point){var a=corner(point,-1),i=insidePolygon([a===0||a===3?x0:x1,a>1?y1:y0]);return i;}
function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0];j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&isLeft(a,b,p)>0)++wn;}else{if(b[1]<=y&&isLeft(a,b,p)<0)--wn;}
a=b;}}
return wn!==0;}
function isLeft(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]);}
function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0);}while((a=(a+direction+4)%4)!==a1);}else{listener.point(to[0],to[1]);}}
function visible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1;}
function point(x,y){if(visible(x,y))listener.point(x,y);}
var x__,y__,v__,x_,y_,v_,first;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN;}
function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer());}
clip.point=point;if(v_)listener.lineEnd();}
function linePoint(x,y){x=Math.max(-d3_geo_clipViewMAX,Math.min(d3_geo_clipViewMAX,x));y=Math.max(-d3_geo_clipViewMAX,Math.min(d3_geo_clipViewMAX,y));var v=visible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y);}}else{if(v&&v_)listener.point(x,y);else{var a=[x_,y_],b=[x,y];if(clipLine(a,b)){if(!v_){listener.lineStart();listener.point(a[0],a[1]);}
listener.point(b[0],b[1]);if(!v)listener.lineEnd();}else{listener.lineStart();listener.point(x,y);}}}
x_=x,y_=y,v_=v;}
return clip;};function corner(p,direction){return Math.abs(p[0]-x0)<ε?direction>0?0:3:Math.abs(p[0]-x1)<ε?direction>0?2:1:Math.abs(p[1]-y0)<ε?direction>0?1:0:direction>0?3:2;}
function compare(a,b){return comparePoints(a.point,b.point);}
function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0];}
function clipLine(a,b){var dx=b[0]-a[0],dy=b[1]-a[1],t=[0,1];if(Math.abs(dx)<ε&&Math.abs(dy)<ε)return x0<=a[0]&&a[0]<=x1&&y0<=a[1]&&a[1]<=y1;if(d3_geo_clipViewT(x0-a[0],dx,t)&&d3_geo_clipViewT(a[0]-x1,-dx,t)&&d3_geo_clipViewT(y0-a[1],dy,t)&&d3_geo_clipViewT(a[1]-y1,-dy,t)){if(t[1]<1){b[0]=a[0]+t[1]*dx;b[1]=a[1]+t[1]*dy;}
if(t[0]>0){a[0]+=t[0]*dx;a[1]+=t[0]*dy;}
return true;}
return false;}}
function d3_geo_clipViewT(num,denominator,t){if(Math.abs(denominator)<ε)return num<=0;var u=num/denominator;if(denominator>0){if(u>t[1])return false;if(u>t[0])t[0]=u;}else{if(u<t[0])return false;if(u<t[1])t[1]=u;}
return true;}
function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1]);}
if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1]);};return compose;}
function d3_geo_resample(project){var δ2=.5,maxDepth=16;function resample(stream){var λ0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=polygonLineStart;},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart;}};function point(x,y){x=project(x,y);stream.point(x[0],x[1]);}
function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart();}
function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0);}
function lineEnd(){resample.point=point;stream.lineEnd();}
function polygonLineStart(){var λ00,φ00,x00,y00,a00,b00,c00;lineStart();resample.point=function(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint;};resample.lineEnd=function(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd();};}
return resample;}
function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=Math.abs(Math.abs(c)-1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>δ2||Math.abs((dx*dx2+dy*dy2)/d2-.5)>.3){resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream);}}}
resample.precision=function(_){if(!arguments.length)return Math.sqrt(δ2);maxDepth=(δ2=_*_)>0&&16;return resample;};return resample;}
d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project;})();}
function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+δx,δy-x[1]*k];}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,δx,δy,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+δx,δy-point[1]*k];}
function invert(point){point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees];}
projection.stream=function(stream){return d3_geo_projectionRadiansRotate(rotate,preclip(projectResample(postclip(stream))));};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return projection;};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_==null?d3_identity:d3_geo_clipView(_[0][0],_[0][1],_[1][0],_[1][1]);return projection;};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset();};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset();};projection.center=function(_){if(!arguments.length)return[λ*d3_degrees,φ*d3_degrees];λ=_[0]%360*d3_radians;φ=_[1]%360*d3_radians;return reset();};projection.rotate=function(_){if(!arguments.length)return[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees];δλ=_[0]%360*d3_radians;δφ=_[1]%360*d3_radians;δγ=_.length>2?_[2]%360*d3_radians:0;return reset();};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);δx=x-center[0]*k;δy=y+center[1]*k;return projection;}
return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset();};}
function d3_geo_projectionRadiansRotate(rotate,stream){return{point:function(x,y){y=rotate(x*d3_radians,y*d3_radians),x=y[0];stream.point(x>π?x-2*π:x<-π?x+2*π:x,y[1]);},sphere:function(){stream.sphere();},lineStart:function(){stream.lineStart();},lineEnd:function(){stream.lineEnd();},polygonStart:function(){stream.polygonStart();},polygonEnd:function(){stream.polygonEnd();}};}
function d3_geo_equirectangular(λ,φ){return[λ,φ];}
(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular);}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;}
forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;};return forward;};function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_equirectangular;}
function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-2*π:λ<-π?λ+2*π:λ,φ];};}
function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);rotation.invert=d3_geo_forwardRotationλ(-δλ);return rotation;}
function d3_geo_rotationφγ(δφ,δγ){var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),Math.asin(Math.max(-1,Math.min(1,k*cosδγ+y*sinδγ)))];}
rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),Math.asin(Math.max(-1,Math.min(1,k*cosδφ-x*sinδφ)))];};return rotation;}
d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees;}});return{type:"Polygon",coordinates:[ring]};}
circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle;};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle;};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle;};return circle.angle(90);};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*2*π;}else{from=radius+direction*2*π;to=radius;}
var point;for(var step=direction*precision,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1]);}};}
function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI);}
d3.geo.distance=function(a,b){var Δλ=(b[0]-a[0])*d3_radians,φ0=a[1]*d3_radians,φ1=b[1]*d3_radians,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1),t;return Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ);};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()};}
function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return Math.abs(x%DX)>ε;}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return Math.abs(y%DY)>ε;}).map(y));}
graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates};});};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]};};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_);};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision);};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision);};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_);};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule;};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule;};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule;};return graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]]);};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y];});};}
function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y];});};}
function d3_source(d){return d.source;}
function d3_target(d){return d.target;}
d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]};}
greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments));};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc;};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc;};greatArc.precision=function(){return arguments.length?greatArc:0;};return greatArc;};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians);};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees];}:function(){return[x0*d3_degrees,y0*d3_degrees];};interpolate.distance=d;return interpolate;}
d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum;};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var λ0,sinφ0,cosφ0;d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ);d3_geo_length.point=nextPoint;};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop;};function nextPoint(λ,φ){var sinφ=Math.sin(φ*=d3_radians),cosφ=Math.cos(φ),t=Math.abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ);λ0=λ,sinφ0=sinφ,cosφ0=cosφ;}}
function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);p.parallels=function(_){if(!arguments.length)return[φ0/π*180,φ1/π*180];return m(φ0=_[0]*π/180,φ1=_[1]*π/180);};return p;}
function d3_geo_conicEqualArea(φ0,φ1){var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)];}
forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,Math.asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))];};return forward;}
(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea);}).raw=d3_geo_conicEqualArea;d3.geo.albersUsa=function(){var lower48=d3.geo.conicEqualArea().rotate([98,0]).center([0,38]).parallels([29.5,45.5]);var alaska=d3.geo.conicEqualArea().rotate([160,0]).center([0,60]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([160,0]).center([0,20]).parallels([8,18]);var puertoRico=d3.geo.conicEqualArea().rotate([60,0]).center([0,10]).parallels([8,18]);var alaskaInvert,hawaiiInvert,puertoRicoInvert;function albersUsa(coordinates){return projection(coordinates)(coordinates);}
function projection(point){var lon=point[0],lat=point[1];return lat>50?alaska:lon<-140?hawaii:lat<21?puertoRico:lower48;}
albersUsa.invert=function(coordinates){return alaskaInvert(coordinates)||hawaiiInvert(coordinates)||puertoRicoInvert(coordinates)||lower48.invert(coordinates);};albersUsa.scale=function(x){if(!arguments.length)return lower48.scale();lower48.scale(x);alaska.scale(x*.6);hawaii.scale(x);puertoRico.scale(x*1.5);return albersUsa.translate(lower48.translate());};albersUsa.translate=function(x){if(!arguments.length)return lower48.translate();var dz=lower48.scale(),dx=x[0],dy=x[1];lower48.translate(x);alaska.translate([dx-.4*dz,dy+.17*dz]);hawaii.translate([dx-.19*dz,dy+.2*dz]);puertoRico.translate([dx+.58*dz,dy+.43*dz]);alaskaInvert=d3_geo_albersUsaInvert(alaska,[[-180,50],[-130,72]]);hawaiiInvert=d3_geo_albersUsaInvert(hawaii,[[-164,18],[-154,24]]);puertoRicoInvert=d3_geo_albersUsaInvert(puertoRico,[[-67.5,17.5],[-65,19]]);return albersUsa;};return albersUsa.scale(1e3);};function d3_geo_albersUsaInvert(projection,extent){var a=projection(extent[0]),b=projection([.5*(extent[0][0]+extent[1][0]),extent[0][1]]),c=projection([extent[1][0],extent[0][1]]),d=projection(extent[1]);var dya=b[1]-a[1],dxa=b[0]-a[0],dyb=c[1]-b[1],dxb=c[0]-b[0];var ma=dya/dxa,mb=dyb/dxb;var cx=.5*(ma*mb*(a[1]-c[1])+mb*(a[0]+b[0])-ma*(b[0]+c[0]))/(mb-ma),cy=(.5*(a[0]+b[0])-cx)/ma+.5*(a[1]+b[1]);var dx0=d[0]-cx,dy0=d[1]-cy,dx1=a[0]-cx,dy1=a[1]-cy,r0=dx0*dx0+dy0*dy0,r1=dx1*dx1+dy1*dy1;var a0=Math.atan2(dy0,dx0),a1=Math.atan2(dy1,dx1);return function(coordinates){var dx=coordinates[0]-cx,dy=coordinates[1]-cy,r=dx*dx+dy*dy,a=Math.atan2(dy,dx);if(r0<r&&r<r1&&a0<a&&a<a1)return projection.invert(coordinates);};}
var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart;},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=Math.abs(d3_geo_pathAreaPolygon/2);}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y;};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y;}
d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00);};}
function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointCircle=d3_geo_pathCircle(_);return stream;},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result;}}};function point(x,y){buffer.push("M",x,",",y,pointCircle);}
function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine;}
function pointLine(x,y){buffer.push("L",x,",",y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){buffer.push("Z");}
return stream;}
var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart;},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd;}};function d3_geo_pathCentroidPoint(x,y){if(d3_geo_centroidDimension)return;d3_geo_centroidX+=x;d3_geo_centroidY+=y;++d3_geo_centroidZ;}
function d3_geo_pathCentroidLineStart(){var x0,y0;if(d3_geo_centroidDimension!==1){if(d3_geo_centroidDimension<1){d3_geo_centroidDimension=1;d3_geo_centroidX=d3_geo_centroidY=d3_geo_centroidZ=0;}else return;}
d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;x0=x,y0=y;};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX+=z*(x0+x)/2;d3_geo_centroidY+=z*(y0+y)/2;d3_geo_centroidZ+=z;x0=x,y0=y;}}
function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;}
function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;if(d3_geo_centroidDimension<2){d3_geo_centroidDimension=2;d3_geo_centroidX=d3_geo_centroidY=d3_geo_centroidZ=0;}
d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;x00=x0=x,y00=y0=y;};function nextPoint(x,y){var z=y0*x-x0*y;d3_geo_centroidX+=z*(x0+x);d3_geo_centroidY+=z*(y0+y);d3_geo_centroidZ+=z*3;x0=x,y0=y;}
d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00);};}
function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointRadius=_;return stream;},result:d3_noop};function point(x,y){context.moveTo(x,y);context.arc(x,y,pointRadius,0,2*π);}
function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine;}
function pointLine(x,y){context.lineTo(x,y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){context.closePath();}
return stream;}
d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream;function path(object){if(object)d3.geo.stream(object,projectStream(contextStream.pointRadius(typeof pointRadius==="function"?+pointRadius.apply(this,arguments):pointRadius)));return contextStream.result();}
path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum;};path.centroid=function(object){d3_geo_centroidDimension=d3_geo_centroidX=d3_geo_centroidY=d3_geo_centroidZ=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ?[d3_geo_centroidX/d3_geo_centroidZ,d3_geo_centroidY/d3_geo_centroidZ]:undefined;};path.bounds=function(object){return d3_geo_bounds(projectStream)(object);};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return path;};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer():new d3_geo_pathContext(_);return path;};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:+_;return path;};return path.projection(d3.geo.albersUsa()).context(null);};function d3_geo_pathCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+ +2*radius+"z";}
function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(λ,φ){return project([λ*d3_degrees,φ*d3_degrees]);});return function(stream){stream=resample(stream);return{point:function(λ,φ){stream.point(λ*d3_radians,φ*d3_radians);},sphere:function(){stream.sphere();},lineStart:function(){stream.lineStart();},lineEnd:function(){stream.lineEnd();},polygonStart:function(){stream.polygonStart();},polygonEnd:function(){stream.polygonEnd();}};};}
d3.geo.albers=function(){return d3.geo.conicEqualArea().parallels([29.5,45.5]).rotate([98,0]).center([0,38]).scale(1e3);};function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var cosλ=Math.cos(λ),cosφ=Math.cos(φ),k=scale(cosλ*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)];}
azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),c=angle(ρ),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)];};return azimuthal;}
var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ));},function(ρ){return 2*Math.asin(ρ/2);});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea);}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(cosλcosφ){var c=Math.acos(cosλcosφ);return c&&c/Math.sin(c);},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant);}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(φ0,φ1){var cosφ0=Math.cos(φ0),t=function(φ){return Math.tan(π/4+φ/2);},n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;if(!n)return d3_geo_mercator;function forward(λ,φ){var ρ=Math.abs(Math.abs(φ)-π/2)<ε?0:F/Math.pow(t(φ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=F-y,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-π/2];};return forward;}
(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal);}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(φ0,φ1){var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;if(Math.abs(n)<ε)return d3_geo_equirectangular;function forward(λ,φ){var ρ=G-φ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=G-y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)];};return forward;}
(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant);}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ;},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic);}).raw=d3_geo_gnomonic;function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))];}
d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-π/2];};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]);}}else if(clipAuto){v=null;}
return v;};return m.clipExtent(null);}
(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator);}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1;},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic);}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ);},function(ρ){return 2*Math.atan(ρ);});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic);}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(λ,φ){var B=Math.cos(φ)*Math.sin(λ);return[Math.log((1+B)/(1-B))/2,Math.atan2(Math.tan(φ),Math.cos(λ))];}
d3_geo_transverseMercator.invert=function(x,y){return[Math.atan2(d3_sinh(x),Math.cos(y)),d3_asin(Math.sin(y)/d3_cosh(x))];};(d3.geo.transverseMercator=function(){return d3_geo_mercatorProjection(d3_geo_transverseMercator);}).raw=d3_geo_transverseMercator;d3.geom={};d3.svg={};function d3_svg_line(projection){var x=d3_svg_lineX,y=d3_svg_lineY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension));}
while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)]);}else if(points.length){segment();points=[];}}
if(points.length)segment();return segments.length?segments.join(""):null;}
line.x=function(_){if(!arguments.length)return x;x=_;return line;};line.y=function(_){if(!arguments.length)return y;y=_;return line;};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line;};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line;};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line;};return line;}
d3.svg.line=function(){return d3_svg_line(d3_identity);};function d3_svg_lineX(d){return d[0];}
function d3_svg_lineY(d){return d[1];}
var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key);});function d3_svg_lineLinear(points){return points.join("L");}
function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z";}
function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("");}
function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("");}
function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,points.length-1),d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension));}
function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points);}
var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2;}
if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];}}
if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1];}
return path;}
function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);}
return tangents;}
function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0];d3_svg_lineBasisBezier(path,px,py);while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
i=-1;while(++i<2){px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1]);}
path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1]);}
path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy);}}
return d3_svg_lineBasis(points);}
function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];}
var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y));}
function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0]);}
function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;}
m[i]=d;return m;}
function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(Math.abs(d)<1e-6){m[i]=m[i+1]=0;}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b;}}}
i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0]);}
return tangents;}
function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points));}
d3.geom.hull=function(vertices){var x=d3_svg_lineX,y=d3_svg_lineY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),n=data.length,vertices,plen=n-1,points=[],stack=[],d,i,j,h=0,x1,y1,x2,y2,u,v,a,sp;if(fx===d3_svg_lineX&&y===d3_svg_lineY)vertices=data;else for(i=0,vertices=[];i<n;++i){vertices.push([+fx.call(this,d=data[i],i),+fy.call(this,d,i)]);}
for(i=1;i<n;++i){if(vertices[i][1]<vertices[h][1]){h=i;}else if(vertices[i][1]==vertices[h][1]){h=vertices[i][0]<vertices[h][0]?i:h;}}
for(i=0;i<n;++i){if(i===h)continue;y1=vertices[i][1]-vertices[h][1];x1=vertices[i][0]-vertices[h][0];points.push({angle:Math.atan2(y1,x1),index:i});}
points.sort(function(a,b){return a.angle-b.angle;});a=points[0].angle;v=points[0].index;u=0;for(i=1;i<plen;++i){j=points[i].index;if(a==points[i].angle){x1=vertices[v][0]-vertices[h][0];y1=vertices[v][1]-vertices[h][1];x2=vertices[j][0]-vertices[h][0];y2=vertices[j][1]-vertices[h][1];if(x1*x1+y1*y1>=x2*x2+y2*y2){points[i].index=-1;}else{points[u].index=-1;a=points[i].angle;u=i;v=j;}}else{a=points[i].angle;u=i;v=j;}}
stack.push(h);for(i=0,j=0;i<2;++j){if(points[j].index!==-1){stack.push(points[j].index);i++;}}
sp=stack.length;for(;j<plen;++j){if(points[j].index===-1)continue;while(!d3_geom_hullCCW(stack[sp-2],stack[sp-1],points[j].index,vertices)){--sp;}
stack[sp++]=points[j].index;}
var poly=[];for(i=0;i<sp;++i){poly.push(data[stack[i]]);}
return poly;}
hull.x=function(_){return arguments.length?(x=_,hull):x;};hull.y=function(_){return arguments.length?(y=_,hull):y;};return hull;};function d3_geom_hullCCW(i1,i2,i3,v){var t,a,b,c,d,e,f;t=v[i1];a=t[0];b=t[1];t=v[i2];c=t[0];d=t[1];t=v[i3];e=t[0];f=t[1];return(f-b)*(c-a)-(d-b)*(e-a)>0;}
d3.geom.polygon=function(coordinates){coordinates.area=function(){var i=0,n=coordinates.length,area=coordinates[n-1][1]*coordinates[0][0]-coordinates[n-1][0]*coordinates[0][1];while(++i<n){area+=coordinates[i-1][1]*coordinates[i][0]-coordinates[i-1][0]*coordinates[i][1];}
return area*.5;};coordinates.centroid=function(k){var i=-1,n=coordinates.length,x=0,y=0,a,b=coordinates[n-1],c;if(!arguments.length)k=-1/(6*coordinates.area());while(++i<n){a=b;b=coordinates[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c;}
return[x*k,y*k];};coordinates.clip=function(subject){var input,i=-1,n=coordinates.length,j,m,a=coordinates[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=coordinates[i];c=input[(m=input.length)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
subject.push(d);}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
c=d;}
a=b;}
return subject;};return coordinates;};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0]);}
function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21];}
d3.geom.delaunay=function(vertices){var edges=vertices.map(function(){return[];}),triangles=[];d3_geom_voronoiTessellate(vertices,function(e){edges[e.region.l.index].push(vertices[e.region.r.index]);});edges.forEach(function(edge,i){var v=vertices[i],cx=v[0],cy=v[1];edge.forEach(function(v){v.angle=Math.atan2(v[0]-cx,v[1]-cy);});edge.sort(function(a,b){return a.angle-b.angle;});for(var j=0,m=edge.length-1;j<m;j++){triangles.push([v,edge[j],edge[j+1]]);}});return triangles;};d3.geom.voronoi=function(points){var size=null,x=d3_svg_lineX,y=d3_svg_lineY,clip;if(arguments.length)return voronoi(points);function voronoi(data){var points,polygons=data.map(function(){return[];}),fx=d3_functor(x),fy=d3_functor(y),d,i,n=data.length,Z=1e6;if(fx===d3_svg_lineX&&fy===d3_svg_lineY)points=data;else for(points=[],i=0;i<n;++i){points.push([+fx.call(this,d=data[i],i),+fy.call(this,d,i)]);}
d3_geom_voronoiTessellate(points,function(e){var s1,s2,x1,x2,y1,y2;if(e.a===1&&e.b>=0){s1=e.ep.r;s2=e.ep.l;}else{s1=e.ep.l;s2=e.ep.r;}
if(e.a===1){y1=s1?s1.y:-Z;x1=e.c-e.b*y1;y2=s2?s2.y:Z;x2=e.c-e.b*y2;}else{x1=s1?s1.x:-Z;y1=e.c-e.a*x1;x2=s2?s2.x:Z;y2=e.c-e.a*x2;}
var v1=[x1,y1],v2=[x2,y2];polygons[e.region.l.index].push(v1,v2);polygons[e.region.r.index].push(v1,v2);});polygons=polygons.map(function(polygon,i){var cx=points[i][0],cy=points[i][1],angle=polygon.map(function(v){return Math.atan2(v[0]-cx,v[1]-cy);}),order=d3.range(polygon.length).sort(function(a,b){return angle[a]-angle[b];});return order.filter(function(d,i){return!i||angle[d]-angle[order[i-1]]>ε;}).map(function(d){return polygon[d];});});polygons.forEach(function(polygon,i){var n=polygon.length;if(!n)return polygon.push([-Z,-Z],[-Z,Z],[Z,Z],[Z,-Z]);if(n>2)return;var p0=points[i],p1=polygon[0],p2=polygon[1],x0=p0[0],y0=p0[1],x1=p1[0],y1=p1[1],x2=p2[0],y2=p2[1],dx=Math.abs(x2-x1),dy=y2-y1;if(Math.abs(dy)<ε){var y=y0<y1?-Z:Z;polygon.push([-Z,y],[Z,y]);}else if(dx<ε){var x=x0<x1?-Z:Z;polygon.push([x,-Z],[x,Z]);}else{var y=(x2-x1)*(y1-y0)<(x1-x0)*(y2-y1)?Z:-Z,z=Math.abs(dy)-dx;if(Math.abs(z)<ε){polygon.push([dy<0?y:-y,y]);}else{if(z>0)y*=-1;polygon.push([-Z,y],[Z,y]);}}});if(clip)for(i=0;i<n;++i)clip(polygons[i]);for(i=0;i<n;++i)polygons[i].point=data[i];return polygons;}
voronoi.x=function(_){return arguments.length?(x=_,voronoi):x;};voronoi.y=function(_){return arguments.length?(y=_,voronoi):y;};voronoi.size=function(_){if(!arguments.length)return size;if(_==null){clip=null;}else{size=[+_[0],+_[1]];clip=d3.geom.polygon([[0,0],[0,size[1]],size,[size[0],0]]).clip;}
return voronoi;};voronoi.links=function(data){var points,graph=data.map(function(){return[];}),links=[],fx=d3_functor(x),fy=d3_functor(y),d,i,n=data.length;if(fx===d3_svg_lineX&&fy===d3_svg_lineY)points=data;else for(i=0;i<n;++i){points.push([+fx.call(this,d=data[i],i),+fy.call(this,d,i)]);}
d3_geom_voronoiTessellate(points,function(e){var l=e.region.l.index,r=e.region.r.index;if(graph[l][r])return;graph[l][r]=graph[r][l]=true;links.push({source:data[l],target:data[r]});});return links;};voronoi.triangles=function(data){if(x===d3_svg_lineX&&y===d3_svg_lineY)return d3.geom.delaunay(data);var points,point,fx=d3_functor(x),fy=d3_functor(y),d,i,n;for(i=0,points=[],n=data.length;i<n;++i){point=[+fx.call(this,d=data[i],i),+fy.call(this,d,i)];point.data=d;points.push(point);}
return d3.geom.delaunay(points).map(function(triangle){return triangle.map(function(point){return point.data;});});};return voronoi;};var d3_geom_voronoiOpposite={l:"r",r:"l"};function d3_geom_voronoiTessellate(points,callback){var Sites={list:points.map(function(v,i){return{index:i,x:v[0],y:v[1]};}).sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:a.x<b.x?-1:a.x>b.x?1:0;}),bottomSite:null};var EdgeList={list:[],leftEnd:null,rightEnd:null,init:function(){EdgeList.leftEnd=EdgeList.createHalfEdge(null,"l");EdgeList.rightEnd=EdgeList.createHalfEdge(null,"l");EdgeList.leftEnd.r=EdgeList.rightEnd;EdgeList.rightEnd.l=EdgeList.leftEnd;EdgeList.list.unshift(EdgeList.leftEnd,EdgeList.rightEnd);},createHalfEdge:function(edge,side){return{edge:edge,side:side,vertex:null,l:null,r:null};},insert:function(lb,he){he.l=lb;he.r=lb.r;lb.r.l=he;lb.r=he;},leftBound:function(p){var he=EdgeList.leftEnd;do{he=he.r;}while(he!=EdgeList.rightEnd&&Geom.rightOf(he,p));he=he.l;return he;},del:function(he){he.l.r=he.r;he.r.l=he.l;he.edge=null;},right:function(he){return he.r;},left:function(he){return he.l;},leftRegion:function(he){return he.edge==null?Sites.bottomSite:he.edge.region[he.side];},rightRegion:function(he){return he.edge==null?Sites.bottomSite:he.edge.region[d3_geom_voronoiOpposite[he.side]];}};var Geom={bisect:function(s1,s2){var newEdge={region:{l:s1,r:s2},ep:{l:null,r:null}};var dx=s2.x-s1.x,dy=s2.y-s1.y,adx=dx>0?dx:-dx,ady=dy>0?dy:-dy;newEdge.c=s1.x*dx+s1.y*dy+(dx*dx+dy*dy)*.5;if(adx>ady){newEdge.a=1;newEdge.b=dy/dx;newEdge.c/=dx;}else{newEdge.b=1;newEdge.a=dx/dy;newEdge.c/=dy;}
return newEdge;},intersect:function(el1,el2){var e1=el1.edge,e2=el2.edge;if(!e1||!e2||e1.region.r==e2.region.r){return null;}
var d=e1.a*e2.b-e1.b*e2.a;if(Math.abs(d)<1e-10){return null;}
var xint=(e1.c*e2.b-e2.c*e1.b)/d,yint=(e2.c*e1.a-e1.c*e2.a)/d,e1r=e1.region.r,e2r=e2.region.r,el,e;if(e1r.y<e2r.y||e1r.y==e2r.y&&e1r.x<e2r.x){el=el1;e=e1;}else{el=el2;e=e2;}
var rightOfSite=xint>=e.region.r.x;if(rightOfSite&&el.side==="l"||!rightOfSite&&el.side==="r"){return null;}
return{x:xint,y:yint};},rightOf:function(he,p){var e=he.edge,topsite=e.region.r,rightOfSite=p.x>topsite.x;if(rightOfSite&&he.side==="l"){return 1;}
if(!rightOfSite&&he.side==="r"){return 0;}
if(e.a===1){var dyp=p.y-topsite.y,dxp=p.x-topsite.x,fast=0,above=0;if(!rightOfSite&&e.b<0||rightOfSite&&e.b>=0){above=fast=dyp>=e.b*dxp;}else{above=p.x+p.y*e.b>e.c;if(e.b<0){above=!above;}
if(!above){fast=1;}}
if(!fast){var dxs=topsite.x-e.region.l.x;above=e.b*(dxp*dxp-dyp*dyp)<dxs*dyp*(1+2*dxp/dxs+e.b*e.b);if(e.b<0){above=!above;}}}else{var yl=e.c-e.a*p.x,t1=p.y-yl,t2=p.x-topsite.x,t3=yl-topsite.y;above=t1*t1>t2*t2+t3*t3;}
return he.side==="l"?above:!above;},endPoint:function(edge,side,site){edge.ep[side]=site;if(!edge.ep[d3_geom_voronoiOpposite[side]])return;callback(edge);},distance:function(s,t){var dx=s.x-t.x,dy=s.y-t.y;return Math.sqrt(dx*dx+dy*dy);}};var EventQueue={list:[],insert:function(he,site,offset){he.vertex=site;he.ystar=site.y+offset;for(var i=0,list=EventQueue.list,l=list.length;i<l;i++){var next=list[i];if(he.ystar>next.ystar||he.ystar==next.ystar&&site.x>next.vertex.x){continue;}else{break;}}
list.splice(i,0,he);},del:function(he){for(var i=0,ls=EventQueue.list,l=ls.length;i<l&&ls[i]!=he;++i){}
ls.splice(i,1);},empty:function(){return EventQueue.list.length===0;},nextEvent:function(he){for(var i=0,ls=EventQueue.list,l=ls.length;i<l;++i){if(ls[i]==he)return ls[i+1];}
return null;},min:function(){var elem=EventQueue.list[0];return{x:elem.vertex.x,y:elem.ystar};},extractMin:function(){return EventQueue.list.shift();}};EdgeList.init();Sites.bottomSite=Sites.list.shift();var newSite=Sites.list.shift(),newIntStar;var lbnd,rbnd,llbnd,rrbnd,bisector;var bot,top,temp,p,v;var e,pm;while(true){if(!EventQueue.empty()){newIntStar=EventQueue.min();}
if(newSite&&(EventQueue.empty()||newSite.y<newIntStar.y||newSite.y==newIntStar.y&&newSite.x<newIntStar.x)){lbnd=EdgeList.leftBound(newSite);rbnd=EdgeList.right(lbnd);bot=EdgeList.rightRegion(lbnd);e=Geom.bisect(bot,newSite);bisector=EdgeList.createHalfEdge(e,"l");EdgeList.insert(lbnd,bisector);p=Geom.intersect(lbnd,bisector);if(p){EventQueue.del(lbnd);EventQueue.insert(lbnd,p,Geom.distance(p,newSite));}
lbnd=bisector;bisector=EdgeList.createHalfEdge(e,"r");EdgeList.insert(lbnd,bisector);p=Geom.intersect(bisector,rbnd);if(p){EventQueue.insert(bisector,p,Geom.distance(p,newSite));}
newSite=Sites.list.shift();}else if(!EventQueue.empty()){lbnd=EventQueue.extractMin();llbnd=EdgeList.left(lbnd);rbnd=EdgeList.right(lbnd);rrbnd=EdgeList.right(rbnd);bot=EdgeList.leftRegion(lbnd);top=EdgeList.rightRegion(rbnd);v=lbnd.vertex;Geom.endPoint(lbnd.edge,lbnd.side,v);Geom.endPoint(rbnd.edge,rbnd.side,v);EdgeList.del(lbnd);EventQueue.del(rbnd);EdgeList.del(rbnd);pm="l";if(bot.y>top.y){temp=bot;bot=top;top=temp;pm="r";}
e=Geom.bisect(bot,top);bisector=EdgeList.createHalfEdge(e,pm);EdgeList.insert(llbnd,bisector);Geom.endPoint(e,d3_geom_voronoiOpposite[pm],v);p=Geom.intersect(llbnd,bisector);if(p){EventQueue.del(llbnd);EventQueue.insert(llbnd,p,Geom.distance(p,bot));}
p=Geom.intersect(bisector,rrbnd);if(p){EventQueue.insert(bisector,p,Geom.distance(p,bot));}}else{break;}}
for(lbnd=EdgeList.right(EdgeList.leftEnd);lbnd!=EdgeList.rightEnd;lbnd=EdgeList.right(lbnd)){callback(lbnd.edge);}}
d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_svg_lineX,y=d3_svg_lineY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0;}
return quadtree(points);}
function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2;}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y);}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_);}}
var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(Math.abs(nx-x)+Math.abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2);}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2);}}else{n.x=x,n.y=y,n.point=d;}}else{insertChild(n,d,x,y,x1,y1,x2,y2);}}
function insertChild(n,d,x,y,x1,y1,x2,y2){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,right=x>=sx,bottom=y>=sy,i=(bottom<<1)+right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=sx;else x2=sx;if(bottom)y1=sy;else y2=sy;insert(n,d,x,y,x1,y1,x2,y2);}
var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_);};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_);};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);}
--i;}else data.forEach(root.add);xs=ys=data=d=null;return root;}
quadtree.x=function(_){return arguments.length?(x=_,quadtree):x;};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y;};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2,y2];if(_==null){x1=y1=x2=y2=null;}else{x1=y1=0;x2=+_[0],y2=+_[1];}
return quadtree;};return quadtree;};function d3_geom_quadtreeCompatX(d){return d.x;}
function d3_geom_quadtreeCompatY(d){return d.y;}
function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null};}
function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2);}}
d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t));};}
d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate();return new d3_transform(t?t.matrix:d3_transformIdentity);})(string);};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1;}
this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0;}
d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1];}
function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k;}
return k;}
function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a;}
var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){b-=a=+a;return function(t){return a+b*t;};}
d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransform(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])});}else if(tb[0]||tb[1]){s.push("translate("+tb+")");}else{s.push("");}
if(ra!=rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)});}else if(rb){s.push(s.pop()+"rotate("+rb+")");}
if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)});}else if(wb){s.push(s.pop()+"skewX("+wb+")");}
if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])});}else if(kb[0]!=1||kb[1]!=1){s.push(s.pop()+"scale("+kb+")");}
n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("");};}
d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolateByName(k)(a[k],b[k]);}else{c[k]=a[k];}}
for(k in b){if(!(k in a)){c[k]=b[k];}}
return function(t){for(k in i)c[k]=i[k](t);return c;};}
d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var m,i,j,s0=0,s1=0,s=[],q=[],n,o;a=a+"",b=b+"";d3_interpolate_number.lastIndex=0;for(i=0;m=d3_interpolate_number.exec(b);++i){if(m.index)s.push(b.substring(s0,s1=m.index));q.push({i:s.length,x:m[0]});s.push(null);s0=d3_interpolate_number.lastIndex;}
if(s0<b.length)s.push(b.substring(s0));for(i=0,n=q.length;(m=d3_interpolate_number.exec(a))&&i<n;++i){o=q[i];if(o.x==m[0]){if(o.i){if(s[o.i+1]==null){s[o.i-1]+=o.x;s.splice(o.i,1);for(j=i+1;j<n;++j)q[j].i--;}else{s[o.i-1]+=o.x+s[o.i+1];s.splice(o.i,2);for(j=i+1;j<n;++j)q[j].i-=2;}}else{if(s[o.i+1]==null){s[o.i]=o.x;}else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1);for(j=i+1;j<n;++j)q[j].i--;}}
q.splice(i,1);n--;i--;}else{o.x=d3_interpolateNumber(parseFloat(m[0]),parseFloat(o.x));}}
while(i<n){o=q.pop();if(s[o.i+1]==null){s[o.i]=o.x;}else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1);}
n--;}
if(s.length===1){return s[0]==null?q[0].x:function(){return b;};}
return function(t){for(i=0;i<n;++i)s[(o=q[i]).i]=o.x(t);return s.join("");};}
var d3_interpolate_number=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f;}
function d3_interpolateByName(name){return name=="transform"?d3_interpolateTransform:d3_interpolate;}
d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"||t!==typeof a?d3_rgb_names.has(b)||/^(#|rgb\(|hsl\()/.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_Color?d3_interpolateRgb:t==="object"?Array.isArray(b)?d3_interpolateArray:d3_interpolateObject:d3_interpolateNumber)(a,b);}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c;};}
var d3_ease_default=function(){return d3_identity;};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad;},cubic:function(){return d3_ease_cubic;},sin:function(){return d3_ease_sin;},exp:function(){return d3_ease_exp;},circle:function(){return d3_ease_circle;},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce;}});var d3_ease_mode=d3.map({"in":d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f));}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.substring(0,i):name,m=i>=0?name.substring(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,Array.prototype.slice.call(arguments,1))));};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t);};}
function d3_ease_reverse(f){return function(t){return 1-f(1-t);};}
function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t));};}
function d3_ease_quad(t){return t*t;}
function d3_ease_cubic(t){return t*t*t;}
function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75);}
function d3_ease_poly(e){return function(t){return Math.pow(t,e);};}
function d3_ease_sin(t){return 1-Math.cos(t*π/2);}
function d3_ease_exp(t){return Math.pow(2,10*(t-1));}
function d3_ease_circle(t){return 1-Math.sqrt(1-t*t);}
function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/(2*π)*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,10*-t)*Math.sin((t-s)*2*π/p);};}
function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+"";};}
d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var h0=a.h,s0=a.s,l0=a.l,h1=b.h-h0,s1=b.s-s0,l1=b.l-l0;if(h1>180)h1-=360;else if(h1<-180)h1+=360;return function(t){return d3_hsl_rgb(h0+h1*t,s0+s1*t,l0+l1*t)+"";};}
d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+"";};}
d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t);};}
function d3_uninterpolateNumber(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return(x-a)*b;};}
function d3_uninterpolateClamp(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return Math.max(0,Math.min(1,(x-a)*b));};}
d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths;};};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start);}
var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent;}
return points;}
function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent;}
ancestors.push(node);return ancestors;}
function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop();}
return sharedNode;}
d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j];}
groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x;}
if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b]);});}
if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b]);});});}
k=(2*π-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v};}
groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding;}
i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target});}}}
if(sortChords)resort();}
function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2);});}
chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord;};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord;};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord;};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord;};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord;};chord.chords=function(){if(!chords)relayout();return chords;};chord.groups=function(){if(!groups)relayout();return groups;};return chord;};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,gravity=.1,theta=.8,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dn=1/Math.sqrt(dx*dx+dy*dy);if((x2-x1)*dn<theta){var k=quad.charge*dn*dn;node.px-=dx*k;node.py-=dy*k;return true;}
if(quad.point&&isFinite(dn)){var k=quad.pointCharge*dn*dn;node.px-=dx*k;node.py-=dy*k;}}
return!quad.charge;};}
force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return true;}
var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k;}}
if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k;}}
if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o));}}}
i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py;}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction;}}
event.tick({type:"tick",alpha:alpha});};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force;};force.links=function(x){if(!arguments.length)return links;links=x;return force;};force.size=function(x){if(!arguments.length)return size;size=x;return force;};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force;};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force;};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force;};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force;};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force;};force.theta=function(x){if(!arguments.length)return theta;theta=+x;return force;};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0)alpha=x;else alpha=0;}else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick);}
return force;};force.start=function(){var i,j,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0;}
for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight;}
for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y;}
distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){var neighbors=neighbor(i),j=-1,m=neighbors.length,x;while(++j<m)if(!isNaN(x=neighbors[j][dimension]))return x;return Math.random()*size;}
function neighbor(){if(!neighbors){neighbors=[];for(j=0;j<n;++j){neighbors[j]=[];}
for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source);}}
return neighbors[i];}
return force.resume();};force.resume=function(){return force.alpha(.1);};force.stop=function(){return force.alpha(0);};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag);};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume();}
return d3.rebind(force,event,"on");};function d3_layout_forceDragstart(d){d.fixed|=2;}
function d3_layout_forceDragend(d){d.fixed&=~6;}
function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y;}
function d3_layout_forceMouseout(d){d.fixed&=~4;}
function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy;}}
if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5;}
var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y;}
quad.cx=cx/quad.charge;quad.cy=cy/quad.charge;}
var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function recurse(node,depth,nodes){var childs=children.call(hierarchy,node,depth);node.depth=depth;nodes.push(node);if(childs&&(n=childs.length)){var i=-1,n,c=node.children=[],v=0,j=depth+1,d;while(++i<n){d=recurse(childs[i],j,nodes);d.parent=node;c.push(d);v+=d.value;}
if(sort)c.sort(sort);if(value)node.value=v;}else if(value){node.value=+value.call(hierarchy,node,depth)||0;}
return node;}
function revalue(node,depth){var children=node.children,v=0;if(children&&(n=children.length)){var i=-1,n,j=depth+1;while(++i<n)v+=revalue(children[i],j);}else if(value){v=+value.call(hierarchy,node,depth)||0;}
if(value)node.value=v;return v;}
function hierarchy(d){var nodes=[];recurse(d,0,nodes);return nodes;}
hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy;};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy;};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy;};hierarchy.revalue=function(root){revalue(root,0);return root;};return hierarchy;};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object;}
function d3_layout_hierarchyChildren(d){return d.children;}
function d3_layout_hierarchyValue(d){return d.value;}
function d3_layout_hierarchySort(a,b){return b.value-a.value;}
function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child};});}));}
d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d;}}}
function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]));}
return 1+d;}
function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes;}
partition.size=function(x){if(!arguments.length)return size;size=x;return partition;};return d3_layout_hierarchyRebind(partition,hierarchy);};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=2*π;function pie(data){var values=data.map(function(d,i){return+value.call(pie,d,i);});var a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle);var k=((typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a)/d3.sum(values);var index=d3.range(data.length);if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i];}:function(i,j){return sort(data[i],data[j]);});var arcs=[];index.forEach(function(i){var d;arcs[i]={data:data[i],value:d=values[i],startAngle:a,endAngle:a+=d*k};});return arcs;}
pie.value=function(x){if(!arguments.length)return value;value=x;return pie;};pie.sort=function(x){if(!arguments.length)return sort;sort=x;return pie;};pie.startAngle=function(x){if(!arguments.length)return startAngle;startAngle=x;return pie;};pie.endAngle=function(x){if(!arguments.length)return endAngle;endAngle=x;return pie;};return pie;};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){var series=data.map(function(d,i){return values.call(stack,d,i);});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)];});});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var n=series.length,m=series[0].length,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);}}
return data;}
stack.values=function(x){if(!arguments.length)return values;values=x;return stack;};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack;};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack;};stack.x=function(z){if(!arguments.length)return x;x=z;return stack;};stack.y=function(z){if(!arguments.length)return y;y=z;return stack;};stack.out=function(z){if(!arguments.length)return out;out=z;return stack;};return stack;};function d3_layout_stackX(d){return d.x;}
function d3_layout_stackY(d){return d.y;}
function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y;}
var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b];}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
return bottoms.reverse().concat(tops);},reverse:function(data){return d3.range(data.length).reverse();},"default":d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o);}
for(j=0;j<m;++j){y0[j]=(max-sums[j])/2;}
return y0;},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx;}
s2+=s3*data[i][j][1];}
y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o;}
for(j=0;j<m;++j)y0[j]-=o0;return y0;},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k;}
for(j=0;j<m;++j)y0[j]=0;return y0;},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length);}
function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0;}
function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k;}}
return j;}
function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0);}
function d3_layout_stackSum(p,d){return p+d[1];}
d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0;}
if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i]);}}}
return bins;}
histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram;};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram;};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x);}:d3_functor(x);return histogram;};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram;};return histogram;};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1));}
function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f;}
function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)];}
d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1];function tree(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0];function firstWalk(node,previousSibling){var children=node.children,layout=node._tree;if(children&&(n=children.length)){var n,firstChild=children[0],previousChild,ancestor=firstChild,child,i=-1;while(++i<n){child=children[i];firstWalk(child,previousChild);ancestor=apportion(child,previousChild,ancestor);previousChild=child;}
d3_layout_treeShift(node);var midpoint=.5*(firstChild._tree.prelim+child._tree.prelim);if(previousSibling){layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling);layout.mod=layout.prelim-midpoint;}else{layout.prelim=midpoint;}}else{if(previousSibling){layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling);}}}
function secondWalk(node,x){node.x=node._tree.prelim+x;var children=node.children;if(children&&(n=children.length)){var i=-1,n;x+=node._tree.mod;while(++i<n){secondWalk(children[i],x);}}}
function apportion(node,previousSibling,ancestor){if(previousSibling){var vip=node,vop=node,vim=previousSibling,vom=node.parent.children[0],sip=vip._tree.mod,sop=vop._tree.mod,sim=vim._tree.mod,som=vom._tree.mod,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop._tree.ancestor=node;shift=vim._tree.prelim+sim-vip._tree.prelim-sip+separation(vim,vip);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,node,ancestor),node,shift);sip+=shift;sop+=shift;}
sim+=vim._tree.mod;sip+=vip._tree.mod;som+=vom._tree.mod;sop+=vop._tree.mod;}
if(vim&&!d3_layout_treeRight(vop)){vop._tree.thread=vim;vop._tree.mod+=sim-sop;}
if(vip&&!d3_layout_treeLeft(vom)){vom._tree.thread=vip;vom._tree.mod+=sip-som;ancestor=node;}}
return ancestor;}
d3_layout_treeVisitAfter(root,function(node,previousSibling){node._tree={ancestor:node,prelim:0,mod:0,change:0,shift:0,number:previousSibling?previousSibling._tree.number+1:0};});firstWalk(root);secondWalk(root,-root._tree.prelim);var left=d3_layout_treeSearch(root,d3_layout_treeLeftmost),right=d3_layout_treeSearch(root,d3_layout_treeRightmost),deep=d3_layout_treeSearch(root,d3_layout_treeDeepest),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2,y1=deep.depth||1;d3_layout_treeVisitAfter(root,function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=node.depth/y1*size[1];delete node._tree;});return nodes;}
tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree;};tree.size=function(x){if(!arguments.length)return size;size=x;return tree;};return d3_layout_hierarchyRebind(tree,hierarchy);};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2;}
function d3_layout_treeLeft(node){var children=node.children;return children&&children.length?children[0]:node._tree.thread;}
function d3_layout_treeRight(node){var children=node.children,n;return children&&(n=children.length)?children[n-1]:node._tree.thread;}
function d3_layout_treeSearch(node,compare){var children=node.children;if(children&&(n=children.length)){var child,n,i=-1;while(++i<n){if(compare(child=d3_layout_treeSearch(children[i],compare),node)>0){node=child;}}}
return node;}
function d3_layout_treeRightmost(a,b){return a.x-b.x;}
function d3_layout_treeLeftmost(a,b){return b.x-a.x;}
function d3_layout_treeDeepest(a,b){return a.depth-b.depth;}
function d3_layout_treeVisitAfter(node,callback){function visit(node,previousSibling){var children=node.children;if(children&&(n=children.length)){var child,previousChild=null,i=-1,n;while(++i<n){child=children[i];visit(child,previousChild);previousChild=child;}}
callback(node,previousSibling);}
visit(node,null);}
function d3_layout_treeShift(node){var shift=0,change=0,children=node.children,i=children.length,child;while(--i>=0){child=children[i]._tree;child.prelim+=shift;child.mod+=shift;shift+=child.shift+(change+=child.change);}}
function d3_layout_treeMove(ancestor,node,shift){ancestor=ancestor._tree;node=node._tree;var change=shift/(node.number-ancestor.number);ancestor.change+=change;node.change-=change;node.shift+=shift;node.prelim+=shift;node.mod+=shift;}
function d3_layout_treeAncestor(vim,node,ancestor){return vim._tree.ancestor.parent==node.parent?vim._tree.ancestor:ancestor;}
d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1];function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0];root.x=0;root.y=0;d3_layout_treeVisitAfter(root,function(d){d.r=Math.sqrt(d.value);});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);var w=size[0],h=size[1],k=Math.max(2*root.r/w,2*root.r/h);if(padding>0){var dr=padding*k/2;d3_layout_treeVisitAfter(root,function(d){d.r+=dr;});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);d3_layout_treeVisitAfter(root,function(d){d.r-=dr;});k=Math.max(2*root.r/w,2*root.r/h);}
d3_layout_packTransform(root,w/2,h/2,1/k);return nodes;}
pack.size=function(x){if(!arguments.length)return size;size=x;return pack;};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack;};return d3_layout_hierarchyRebind(pack,hierarchy);};function d3_layout_packSort(a,b){return a.value-b.value;}
function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b;}
function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a;}
function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return dr*dr-dx*dx-dy*dy>.001;}
function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax);}
nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break;}}}
if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--;}else{d3_layout_packInsert(a,c);b=c;bound(c);}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));}
node.r=cr;nodes.forEach(d3_layout_packUnlink);}
function d3_layout_packLink(node){node._pack_next=node._pack_prev=node;}
function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev;}
function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k);}}
function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx;}else{c.x=a.x+db;c.y=a.y;}}
d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1];function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_treeVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children);}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node;}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_treeVisitAfter(root,function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1];});return nodes;}
cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster;};cluster.size=function(x){if(!arguments.length)return size;size=x;return cluster;};return d3_layout_hierarchyRebind(cluster,hierarchy);};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y;});}
function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x;},0)/children.length;}
function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node;}
function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node;}
d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area;}}
function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score;}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity;}}
if(row.length){position(row,u,rect,true);row.length=row.area=0;}
children.forEach(squarify);}}
function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0;}}
children.forEach(stickify);}}
function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r;}
s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity;}
function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);}
o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v;}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);}
o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v;}}
function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes;}
treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap;};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p);}
function padConstant(node){return d3_layout_treemapPad(node,x);}
var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap;};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap;};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap;};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap;};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap;};return d3_layout_hierarchyRebind(treemap,hierarchy);};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy};}
function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0;}
if(dy<0){y+=dy/2;dy=0;}
return{x:x,y:y,dx:dx,dy:dy};}
d3.random={normal:function(µ,σ){var n=arguments.length;if(n<2)σ=1;if(n<1)µ=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y;}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r);};},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random());};},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s/m;};}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range());}
function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x));};}
function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx;}
if(nice=nice(x1-x0)){domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);}
return domain;}
function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse();}
while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]));}
return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x));};}
d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false);};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale;}
function scale(x){return output(x);}
scale.invert=function(y){return input(y);};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound);};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale();};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale();};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(){d3_scale_nice(domain,d3_scale_linearNice);return rescale();};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp);};return rescale();}
function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_scale_linearNice(dx){dx=Math.pow(10,Math.round(Math.log(dx)/Math.LN10)-1);return dx&&{floor:function(x){return Math.floor(x/dx)*dx;},ceil:function(x){return Math.ceil(x/dx)*dx;}};}
function d3_scale_linearTickRange(domain,m){var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent;}
function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m));}
function d3_scale_linearTickFormat(domain,m,format){var precision=-Math.floor(Math.log(d3_scale_linearTickRange(domain,m)[2])/Math.LN10+.01);return d3.format(format?format.replace(d3_format_re,function(a,b,c,d,e,f,g,h,i,j){return[b,c,d,e,f,g,h,i||"."+(precision-(j==="%")*2),j].join("");}):",."+precision+"f");}
d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,Math.LN10]),10,d3_scale_logp,d3_scale_powp);};function d3_scale_log(linear,base,log,pow){function scale(x){return linear(log(x));}
scale.invert=function(x){return pow(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(pow);if(x[0]<0)log=d3_scale_logn,pow=d3_scale_pown;else log=d3_scale_logp,pow=d3_scale_powp;linear.domain(x.map(log));return scale;};scale.base=function(_){if(!arguments.length)return base;base=+_;return scale;};scale.nice=function(){linear.domain(d3_scale_nice(linear.domain(),d3_scale_logNice(base)));return scale;};scale.ticks=function(){var extent=d3_scaleExtent(linear.domain()),ticks=[];if(extent.every(isFinite)){var b=Math.log(base),i=Math.floor(extent[0]/b),j=Math.ceil(extent[1]/b),u=pow(extent[0]),v=pow(extent[1]),n=base%1?2:base;if(log===d3_scale_logn){ticks.push(-Math.pow(base,-i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(-Math.pow(base,-i)*k);}else{for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(Math.pow(base,i)*k);ticks.push(Math.pow(base,i));}
for(i=0;ticks[i]<u;i++){}
for(j=ticks.length;ticks[j-1]>v;j--){}
ticks=ticks.slice(i,j);}
return ticks;};scale.tickFormat=function(n,format){if(arguments.length<2)format=d3_scale_logFormat;if(!arguments.length)return format;var b=Math.log(base),k=Math.max(.1,n/scale.ticks().length),f=log===d3_scale_logn?(e=-1e-12,Math.floor):(e=1e-12,Math.ceil),e;return function(d){return d/pow(b*f(log(d)/b+e))<=k?format(d):"";};};scale.copy=function(){return d3_scale_log(linear.copy(),base,log,pow);};return d3_scale_linearRebind(scale,linear);}
var d3_scale_logFormat=d3.format(".0e");function d3_scale_logp(x){return Math.log(x<0?0:x);}
function d3_scale_powp(x){return Math.exp(x);}
function d3_scale_logn(x){return-Math.log(x>0?0:-x);}
function d3_scale_pown(x){return-Math.exp(-x);}
function d3_scale_logNice(base){base=Math.log(base);var nice={floor:function(x){return Math.floor(x/base)*base;},ceil:function(x){return Math.ceil(x/base)*base;}};return function(){return nice;};}
d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1);};function d3_scale_pow(linear,exponent){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x));}
scale.invert=function(x){return powb(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(powb);linear.domain(x.map(powp));return scale;};scale.ticks=function(m){return d3_scale_linearTicks(scale.domain(),m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(scale.domain(),m,format);};scale.nice=function(){return scale.domain(d3_scale_nice(scale.domain(),d3_scale_linearNice));};scale.exponent=function(x){if(!arguments.length)return exponent;var domain=scale.domain();powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);return scale.domain(domain);};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent);};return d3_scale_linearRebind(scale,linear);}
function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e);};}
d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5);};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]});};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||index.set(x,domain.push(x)))-1)%range.length];}
function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i;});}
scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map();var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a);};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale;};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=(stop-start)/(Math.max(1,domain.length-1)+padding);range=steps(domain.length<2?(start+stop)/2:start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale;};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale;};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding)),error=stop-start-(domain.length-padding)*step;range=steps(start+Math.round(error/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale;};scale.rangeBand=function(){return rangeBand;};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0]);};scale.copy=function(){return d3_scale_ordinal(domain,ranger);};return scale.domain(domain);}
d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10);};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20);};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b);};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c);};var d3_category10=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];var d3_category20=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];var d3_category20b=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"];var d3_category20c=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return d3_scale_quantile([],[]);};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale;}
function scale(x){if(isNaN(x=+x))return NaN;return range[d3.bisect(thresholds,x)];}
scale.domain=function(x){if(!arguments.length)return domain;domain=x.filter(function(d){return!isNaN(d);}).sort(d3.ascending);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.quantiles=function(){return thresholds;};scale.copy=function(){return d3_scale_quantile(domain,range);};return rescale();}
d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1]);};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))];}
function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale;}
scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.copy=function(){return d3_scale_quantize(x0,x1,range);};return rescale();}
d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1]);};function d3_scale_threshold(domain,range){function scale(x){return range[d3.bisect(domain,x)];}
scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale;};scale.range=function(_){if(!arguments.length)return range;range=_;return scale;};scale.copy=function(){return d3_scale_threshold(domain,range);};return scale;}
d3.scale.identity=function(){return d3_scale_identity([0,1]);};function d3_scale_identity(domain){function identity(x){return+x;}
identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity;};identity.ticks=function(m){return d3_scale_linearTicks(domain,m);};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};identity.copy=function(){return d3_scale_identity(domain);};return identity;}
d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function arc(){var r0=innerRadius.apply(this,arguments),r1=outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)+d3_svg_arcOffset,a1=endAngle.apply(this,arguments)+d3_svg_arcOffset,da=(a1<a0&&(da=a0,a0=a1,a1=da),a1-a0),df=da<π?"0":"1",c0=Math.cos(a0),s0=Math.sin(a0),c1=Math.cos(a1),s1=Math.sin(a1);return da>=d3_svg_arcMax?r0?"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"M0,"+r0+"A"+r0+","+r0+" 0 1,0 0,"+-r0+"A"+r0+","+r0+" 0 1,0 0,"+r0+"Z":"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":r0?"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L"+r0*c1+","+r0*s1+"A"+r0+","+r0+" 0 "+df+",0 "+r0*c0+","+r0*s0+"Z":"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L0,0"+"Z";}
arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc;};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc;};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc;};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc;};arc.centroid=function(){var r=(innerRadius.apply(this,arguments)+outerRadius.apply(this,arguments))/2,a=(startAngle.apply(this,arguments)+endAngle.apply(this,arguments))/2+d3_svg_arcOffset;return[Math.cos(a)*r,Math.sin(a)*r];};return arc;};var d3_svg_arcOffset=-π/2,d3_svg_arcMax=2*π-1e-6;function d3_svg_arcInnerRadius(d){return d.innerRadius;}
function d3_svg_arcOuterRadius(d){return d.outerRadius;}
function d3_svg_arcStartAngle(d){return d.startAngle;}
function d3_svg_arcEndAngle(d){return d.endAngle;}
d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line;};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]+d3_svg_arcOffset;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a);}
return points;}
function d3_svg_area(projection){var x0=d3_svg_lineX,x1=d3_svg_lineX,y0=0,y1=d3_svg_lineY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x;}:d3_functor(x1),fy1=y0===y1?function(){return y;}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z");}
while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)]);}else if(points0.length){segment();points0=[];points1=[];}}
if(points0.length)segment();return segments.length?segments.join(""):null;}
area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area;};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area;};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area;};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area;};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area;};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area;};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area;};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area;};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area;};return area;}
d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity);};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area;};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z";}
function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)+d3_svg_arcOffset,a1=endAngle.call(self,subgroup,i)+d3_svg_arcOffset;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]};}
function equals(a,b){return a.a0==b.a0&&a.a1==b.a1;}
function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>π)+",1 "+p;}
function curve(r0,p0,r1,p1){return"Q 0,0 "+p1;}
chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord;};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord;};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord;};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord;};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord;};return chord;};function d3_svg_chordRadius(d){return d.radius;}
d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3];}
diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal;};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal;};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal;};return diagonal;};function d3_svg_diagonalProjection(d){return[d.x,d.y];}
d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection;};return diagonal;};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]+d3_svg_arcOffset;return[r*Math.cos(a),r*Math.sin(a)];};}
d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i));}
symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol;};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol;};return symbol;};function d3_svg_symbolSize(){return 64;}
function d3_svg_symbolType(){return"circle";}
function d3_svg_symbolCircle(size){var r=Math.sqrt(size/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z";}
var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z";},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z";},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z";},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z";},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z";}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);function d3_transition(groups,id){d3_arraySubclass(groups,d3_transitionPrototype);groups.id=id;return groups;}
var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit={ease:d3_ease_cubicInOut,delay:0,duration:250};d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3.transition=function(selection){return arguments.length?d3_transitionInheritId?selection.transition():selection:d3_selectionRoot.transition();};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,subgroups=[],subgroup,subnode,node;if(typeof selector!=="function")selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,id,node.__transition__[id]);subgroup.push(subnode);}else{subgroup.push(null);}}}
return d3_transition(subgroups,id);};d3_transitionPrototype.selectAll=function(selector){var id=this.id,subgroups=[],subgroup,subnodes,node,subnode,transition;if(typeof selector!=="function")selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node.__transition__[id];subnodes=selector.call(node,node.__data__,i);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){d3_transitionNode(subnode=subnodes[k],k,id,transition);subgroup.push(subnode);}}}}
return d3_transition(subgroups,id);};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i)){subgroup.push(node);}}}
return d3_transition(subgroups,this.id,this.time).ease(this.ease());};d3_transitionPrototype.tween=function(name,tween){var id=this.id;if(arguments.length<2)return this.node().__transition__[id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node.__transition__[id].tween.remove(name);}:function(node){node.__transition__[id].tween.set(name,tween);});};function d3_transition_tween(groups,name,value,tween){var id=groups.id;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node.__transition__[id].tween.set(name,tween(value.call(node,node.__data__,i,j)));}:(value=tween(value),function(node){node.__transition__[id].tween.set(name,value);}));}
d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this;}
var interpolate=d3_interpolateByName(nameNS),name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
return d3_transition_tween(this,"attr."+nameNS,value,function(b){function attrString(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t));});}
function attrStringNS(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t));});}
return b==null?name.local?attrNullNS:attrNull:(b+="",name.local?attrStringNS:attrString);});};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t));};}
function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t));};}
return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this;}
priority="";}
var interpolate=d3_interpolateByName(name);function styleNull(){this.style.removeProperty(name);}
return d3_transition_tween(this,"style."+name,value,function(b){function styleString(){var a=d3_window.getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority);});}
return b==null?styleNull:(b+="",styleString);});};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";return this.tween("style."+name,function(d,i){var f=tween.call(this,d,i,d3_window.getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority);};});};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text);};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b;};}
d3_transitionPrototype.remove=function(){return this.each("end.transition",function(){var p;if(!this.__transition__&&(p=this.parentNode))p.removeChild(this);});};d3_transitionPrototype.ease=function(value){var id=this.id;if(arguments.length<1)return this.node().__transition__[id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node.__transition__[id].ease=value;});};d3_transitionPrototype.delay=function(value){var id=this.id;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.__transition__[id].delay=value.call(node,node.__data__,i,j)|0;}:(value|=0,function(node){node.__transition__[id].delay=value;}));};d3_transitionPrototype.duration=function(value){var id=this.id;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.__transition__[id].duration=Math.max(1,value.call(node,node.__data__,i,j)|0);}:(value=Math.max(1,value|0),function(node){node.__transition__[id].duration=value;}));};d3_transitionPrototype.each=function(type,listener){var id=this.id;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node.__transition__[id];type.call(node,node.__data__,i,j);});d3_transitionInherit=inherit;d3_transitionInheritId=inheritId;}else{d3_selection_each(this,function(node){node.__transition__[id].event.on(type,listener);});}
return this;};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=Object.create(node.__transition__[id0]);transition.delay+=transition.duration;d3_transitionNode(node,i,id1,transition);}
subgroup.push(node);}}
return d3_transition(subgroups,id1);};function d3_transitionNode(node,i,id,inherit){var lock=node.__transition__||(node.__transition__={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map(),event:d3.dispatch("start","end"),time:time,ease:inherit.ease,delay:inherit.delay,duration:inherit.duration};++lock.count;d3.timer(function(elapsed){var d=node.__data__,ease=transition.ease,event=transition.event,delay=transition.delay,duration=transition.duration,tweened=[];return delay<=elapsed?start(elapsed):d3.timer(start,delay,time),1;function start(elapsed){if(lock.active>id)return stop();lock.active=id;event.start.call(node,d,i);transition.tween.forEach(function(key,value){if(value=value.call(node,d,i)){tweened.push(value);}});if(!tick(elapsed))d3.timer(tick,0,time);return 1;}
function tick(elapsed){if(lock.active!==id)return stop();var t=(elapsed-delay)/duration,e=ease(t),n=tweened.length;while(n>0){tweened[--n].call(node,e);}
if(t>=1){stop();event.end.call(node,d,i);return 1;}}
function stop(){if(--lock.count)delete lock[id];else delete node.__transition__;return 1;}},0,time);return transition;}}
d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,tickMajorSize=6,tickMinorSize=6,tickEndSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_,tickSubdivide=0;function axis(g){g.each(function(){var g=d3.select(this);var ticks=tickValues==null?scale.ticks?scale.ticks.apply(scale,tickArguments_):scale.domain():tickValues,tickFormat=tickFormat_==null?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments_):String:tickFormat_;var subticks=d3_svg_axisSubdivide(scale,ticks,tickSubdivide),subtick=g.selectAll(".tick.minor").data(subticks,String),subtickEnter=subtick.enter().insert("line",".tick").attr("class","tick minor").style("opacity",1e-6),subtickExit=d3.transition(subtick.exit()).style("opacity",1e-6).remove(),subtickUpdate=d3.transition(subtick).style("opacity",1);var tick=g.selectAll(".tick.major").data(ticks,String),tickEnter=tick.enter().insert("g","path").attr("class","tick major").style("opacity",1e-6),tickExit=d3.transition(tick.exit()).style("opacity",1e-6).remove(),tickUpdate=d3.transition(tick).style("opacity",1),tickTransform;var range=d3_scaleRange(scale),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));var scale1=scale.copy(),scale0=this.__chart__||scale1;this.__chart__=scale1;tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text");switch(orient){case"bottom":{tickTransform=d3_svg_axisX;subtickEnter.attr("y2",tickMinorSize);subtickUpdate.attr("x2",0).attr("y2",tickMinorSize);lineEnter.attr("y2",tickMajorSize);textEnter.attr("y",Math.max(tickMajorSize,0)+tickPadding);lineUpdate.attr("x2",0).attr("y2",tickMajorSize);textUpdate.attr("x",0).attr("y",Math.max(tickMajorSize,0)+tickPadding);text.attr("dy",".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+tickEndSize+"V0H"+range[1]+"V"+tickEndSize);break;}
case"top":{tickTransform=d3_svg_axisX;subtickEnter.attr("y2",-tickMinorSize);subtickUpdate.attr("x2",0).attr("y2",-tickMinorSize);lineEnter.attr("y2",-tickMajorSize);textEnter.attr("y",-(Math.max(tickMajorSize,0)+tickPadding));lineUpdate.attr("x2",0).attr("y2",-tickMajorSize);textUpdate.attr("x",0).attr("y",-(Math.max(tickMajorSize,0)+tickPadding));text.attr("dy","0em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+-tickEndSize+"V0H"+range[1]+"V"+-tickEndSize);break;}
case"left":{tickTransform=d3_svg_axisY;subtickEnter.attr("x2",-tickMinorSize);subtickUpdate.attr("x2",-tickMinorSize).attr("y2",0);lineEnter.attr("x2",-tickMajorSize);textEnter.attr("x",-(Math.max(tickMajorSize,0)+tickPadding));lineUpdate.attr("x2",-tickMajorSize).attr("y2",0);textUpdate.attr("x",-(Math.max(tickMajorSize,0)+tickPadding)).attr("y",0);text.attr("dy",".32em").style("text-anchor","end");pathUpdate.attr("d","M"+-tickEndSize+","+range[0]+"H0V"+range[1]+"H"+-tickEndSize);break;}
case"right":{tickTransform=d3_svg_axisY;subtickEnter.attr("x2",tickMinorSize);subtickUpdate.attr("x2",tickMinorSize).attr("y2",0);lineEnter.attr("x2",tickMajorSize);textEnter.attr("x",Math.max(tickMajorSize,0)+tickPadding);lineUpdate.attr("x2",tickMajorSize).attr("y2",0);textUpdate.attr("x",Math.max(tickMajorSize,0)+tickPadding).attr("y",0);text.attr("dy",".32em").style("text-anchor","start");pathUpdate.attr("d","M"+tickEndSize+","+range[0]+"H0V"+range[1]+"H"+tickEndSize);break;}}
if(scale.ticks){tickEnter.call(tickTransform,scale0);tickUpdate.call(tickTransform,scale1);tickExit.call(tickTransform,scale1);subtickEnter.call(tickTransform,scale0);subtickUpdate.call(tickTransform,scale1);subtickExit.call(tickTransform,scale1);}else{var dx=scale1.rangeBand()/2,x=function(d){return scale1(d)+dx;};tickEnter.call(tickTransform,x);tickUpdate.call(tickTransform,x);}});}
axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis;};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis;};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis;};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis;};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis;};axis.tickSize=function(x,y){if(!arguments.length)return tickMajorSize;var n=arguments.length-1;tickMajorSize=+x;tickMinorSize=n>1?+y:tickMajorSize;tickEndSize=n>0?+arguments[n]:tickMajorSize;return axis;};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis;};axis.tickSubdivide=function(x){if(!arguments.length)return tickSubdivide;tickSubdivide=+x;return axis;};return axis;};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x){selection.attr("transform",function(d){return"translate("+x(d)+",0)";});}
function d3_svg_axisY(selection,y){selection.attr("transform",function(d){return"translate(0,"+y(d)+")";});}
function d3_svg_axisSubdivide(scale,ticks,m){subticks=[];if(m&&ticks.length>1){var extent=d3_scaleExtent(scale.domain()),subticks,i=-1,n=ticks.length,d=(ticks[1]-ticks[0])/++m,j,v;while(++i<n){for(j=m;--j>0;){if((v=+ticks[i]-j*d)>=extent[0]){subticks.push(v);}}}
for(--i,j=0;++j<m&&(v=+ticks[i]+j*d)<extent[1];){subticks.push(v);}}
return subticks;}
d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,resizes=d3_svg_brushResizes[0],extent=[[0,0],[0,0]],extentDomain;function brush(g){g.each(function(){var g=d3.select(this),bg=g.selectAll(".background").data([0]),fg=g.selectAll(".extent").data([0]),tz=g.selectAll(".resize").data(resizes,String),e;g.style("pointer-events","all").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);bg.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");fg.enter().append("rect").attr("class","extent").style("cursor","move");tz.enter().append("g").attr("class",function(d){return"resize "+d;}).style("cursor",function(d){return d3_svg_brushCursor[d];}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null;}).attr("y",function(d){return/^[ns]/.test(d)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden");tz.style("display",brush.empty()?"none":null);tz.exit().remove();if(x){e=d3_scaleRange(x);bg.attr("x",e[0]).attr("width",e[1]-e[0]);redrawX(g);}
if(y){e=d3_scaleRange(y);bg.attr("y",e[0]).attr("height",e[1]-e[0]);redrawY(g);}
redraw(g);});}
function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+extent[+/e$/.test(d)][0]+","+extent[+/^s/.test(d)][1]+")";});}
function redrawX(g){g.select(".extent").attr("x",extent[0][0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",extent[1][0]-extent[0][0]);}
function redrawY(g){g.select(".extent").attr("y",extent[0][1]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",extent[1][1]-extent[0][1]);}
function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),center,origin=mouse(),offset;var w=d3.select(d3_window).on("mousemove.brush",brushmove).on("mouseup.brush",brushend).on("touchmove.brush",brushmove).on("touchend.brush",brushend).on("keydown.brush",keydown).on("keyup.brush",keyup);if(dragging){origin[0]=extent[0][0]-origin[0];origin[1]=extent[0][1]-origin[1];}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[extent[1-ex][0]-origin[0],extent[1-ey][1]-origin[1]];origin[0]=extent[ex][0];origin[1]=extent[ey][1];}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();d3_eventCancel();function mouse(){var touches=d3.event.changedTouches;return touches?d3.touches(target,touches)[0]:d3.mouse(target);}
function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=extent[1][0];origin[1]-=extent[1][1];dragging=2;}
d3_eventCancel();}}
function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=extent[1][0];origin[1]+=extent[1][1];dragging=0;d3_eventCancel();}}
function brushmove(){var point=mouse(),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1];}
if(!dragging){if(d3.event.altKey){if(!center)center=[(extent[0][0]+extent[1][0])/2,(extent[0][1]+extent[1][1])/2];origin[0]=extent[+(point[0]<center[0])][0];origin[1]=extent[+(point[1]<center[1])][1];}else center=null;}
if(resizingX&&move1(point,x,0)){redrawX(g);moved=true;}
if(resizingY&&move1(point,y,1)){redrawY(g);moved=true;}
if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"});}}
function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],size=extent[1][i]-extent[0][i],min,max;if(dragging){r0-=position;r1-=size+position;}
min=Math.max(r0,Math.min(r1,point[i]));if(dragging){max=(min+=position)+size;}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position;}else{max=position;}}
if(extent[0][i]!==min||extent[1][i]!==max){extentDomain=null;extent[0][i]=min;extent[1][i]=max;return true;}}
function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);event_({type:"brushend"});d3_eventCancel();}}
brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){z=extentDomain||extent;if(x){x0=z[0][0],x1=z[1][0];if(!extentDomain){x0=extent[0][0],x1=extent[1][0];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t;}}
if(y){y0=z[0][1],y1=z[1][1];if(!extentDomain){y0=extent[0][1],y1=extent[1][1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t;}}
return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1];}
extentDomain=[[0,0],[0,0]];if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];extentDomain[0][0]=x0,extentDomain[1][0]=x1;if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;extent[0][0]=x0|0,extent[1][0]=x1|0;}
if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];extentDomain[0][1]=y0,extentDomain[1][1]=y1;if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;extent[0][1]=y0|0,extent[1][1]=y1|0;}
return brush;};brush.clear=function(){extentDomain=null;extent[0][0]=extent[0][1]=extent[1][0]=extent[1][1]=0;return brush;};brush.empty=function(){return x&&extent[0][0]===extent[1][0]||y&&extent[0][1]===extent[1][1];};return d3.rebind(brush,event,"on");};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.time={};var d3_time=Date,d3_time_daySymbols=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function d3_time_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);}
d3_time_utc.prototype={getDate:function(){return this._.getUTCDate();},getDay:function(){return this._.getUTCDay();},getFullYear:function(){return this._.getUTCFullYear();},getHours:function(){return this._.getUTCHours();},getMilliseconds:function(){return this._.getUTCMilliseconds();},getMinutes:function(){return this._.getUTCMinutes();},getMonth:function(){return this._.getUTCMonth();},getSeconds:function(){return this._.getUTCSeconds();},getTime:function(){return this._.getTime();},getTimezoneOffset:function(){return 0;},valueOf:function(){return this._.valueOf();},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments);},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments);},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments);},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments);},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments);},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments);},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments);},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments);}};var d3_time_prototype=Date.prototype;var d3_time_formatDateTime="%a %b %e %X %Y",d3_time_formatDate="%m/%d/%Y",d3_time_formatTime="%H:%M:%S";var d3_time_days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d3_time_dayAbbreviations=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d3_time_months=["January","February","March","April","May","June","July","August","September","October","November","December"],d3_time_monthAbbreviations=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1;}
function ceil(date){step(date=local(new d3_time(date-1)),1);return date;}
function offset(date,k){step(date=new d3_time(+date),k);return date;}
function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1);}}else{while(time<t1)times.push(new Date(+time)),step(time,1);}
return times;}
function range_utc(t0,t1,dt){try{d3_time=d3_time_utc;var utc=new d3_time_utc();utc._=t0;return range(utc,t1,dt);}finally{d3_time=Date;}}
local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local;}
function d3_time_interval_utc(method){return function(date,k){try{d3_time=d3_time_utc;var utc=new d3_time_utc();utc._=date;return method(utc,k)._;}finally{d3_time=Date;}};}
d3.time.year=d3_time_interval(function(date){date=d3.time.day(date);date.setMonth(0,1);return date;},function(date,offset){date.setFullYear(date.getFullYear()+offset);},function(date){return date.getFullYear();});d3.time.years=d3.time.year.range;d3.time.years.utc=d3.time.year.utc.range;d3.time.day=d3_time_interval(function(date){var day=new d3_time(1970,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day;},function(date,offset){date.setDate(date.getDate()+offset);},function(date){return date.getDate()-1;});d3.time.days=d3.time.day.range;d3.time.days.utc=d3.time.day.utc.range;d3.time.dayOfYear=function(date){var year=d3.time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5);};d3_time_daySymbols.forEach(function(day,i){day=day.toLowerCase();i=7-i;var interval=d3.time[day]=d3_time_interval(function(date){(date=d3.time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date;},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7);},function(date){var day=d3.time.year(date).getDay();return Math.floor((d3.time.dayOfYear(date)+(day+i)%7)/7)-(day!==i);});d3.time[day+"s"]=interval.range;d3.time[day+"s"].utc=interval.utc.range;d3.time[day+"OfYear"]=function(date){var day=d3.time.year(date).getDay();return Math.floor((d3.time.dayOfYear(date)+(day+i)%7)/7);};});d3.time.week=d3.time.sunday;d3.time.weeks=d3.time.sunday.range;d3.time.weeks.utc=d3.time.sunday.utc.range;d3.time.weekOfYear=d3.time.sundayOfYear;d3.time.format=function(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.substring(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1;}}
string.push(template.substring(j,i));return string.join("");}
format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var date=new d3_time();date.setFullYear(d.y,d.m,d.d);date.setHours(d.H,d.M,d.S,d.L);return date;};format.toString=function(){return template;};return format;};function d3_time_parse(date,template,string,j){var c,p,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){p=d3_time_parsers[template.charAt(i++)];if(!p||(j=p(date,string,j))<0)return-1;}else if(c!=string.charCodeAt(j++)){return-1;}}
return j;}
function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i");}
function d3_time_formatLookup(names){var map=new d3_Map(),i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map;}
function d3_time_formatPad(value,fill,width){value+="";var length=value.length;return length<width?new Array(width-length+1).join(fill)+value:value;}
var d3_time_dayRe=d3_time_formatRe(d3_time_days),d3_time_dayAbbrevRe=d3_time_formatRe(d3_time_dayAbbreviations),d3_time_monthRe=d3_time_formatRe(d3_time_months),d3_time_monthLookup=d3_time_formatLookup(d3_time_months),d3_time_monthAbbrevRe=d3_time_formatRe(d3_time_monthAbbreviations),d3_time_monthAbbrevLookup=d3_time_formatLookup(d3_time_monthAbbreviations);var d3_time_formatPads={"-":"",_:" ","0":"0"};var d3_time_formats={a:function(d){return d3_time_dayAbbreviations[d.getDay()];},A:function(d){return d3_time_days[d.getDay()];},b:function(d){return d3_time_monthAbbreviations[d.getMonth()];},B:function(d){return d3_time_months[d.getMonth()];},c:d3.time.format(d3_time_formatDateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2);},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2);},j:function(d,p){return d3_time_formatPad(1+d3.time.dayOfYear(d),p,3);},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3);},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2);},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2);},p:function(d){return d.getHours()>=12?"PM":"AM";},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2);},U:function(d,p){return d3_time_formatPad(d3.time.sundayOfYear(d),p,2);},w:function(d){return d.getDay();},W:function(d,p){return d3_time_formatPad(d3.time.mondayOfYear(d),p,2);},x:d3.time.format(d3_time_formatDate),X:d3.time.format(d3_time_formatTime),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2);},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4);},Z:d3_time_zone,"%":function(){return"%";}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.substring(i));return n?i+=n[0].length:-1;}
function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.substring(i));return n?i+=n[0].length:-1;}
function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.substring(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+=n[0].length):-1;}
function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.substring(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+=n[0].length):-1;}
function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i);}
function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i);}
function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i);}
function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+4));return n?(date.y=+n[0],i+=n[0].length):-1;}
function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+=n[0].length):-1;}
function d3_time_expandYear(d){return d+(d>68?1900:2e3);}
function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.m=n[0]-1,i+=n[0].length):-1;}
function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.d=+n[0],i+=n[0].length):-1;}
function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.H=+n[0],i+=n[0].length):-1;}
function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.M=+n[0],i+=n[0].length):-1;}
function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.S=+n[0],i+=n[0].length):-1;}
function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+3));return n?(date.L=+n[0],i+=n[0].length):-1;}
var d3_time_numberRe=/^\s*\d+/;function d3_time_parseAmPm(date,string,i){var n=d3_time_amPmLookup.get(string.substring(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i);}
var d3_time_amPmLookup=d3.map({am:0,pm:1});function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=~~(Math.abs(z)/60),zm=Math.abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2);}
d3.time.format.utc=function(template){var local=d3.time.format(template);function format(date){try{d3_time=d3_time_utc;var utc=new d3_time();utc._=date;return local(utc);}finally{d3_time=Date;}}
format.parse=function(string){try{d3_time=d3_time_utc;var date=local.parse(string);return date&&date._;}finally{d3_time=Date;}};format.toString=local.toString;return format;};var d3_time_formatIso=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString();}
d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date;};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3.time.second=d3_time_interval(function(date){return new d3_time(Math.floor(date/1e3)*1e3);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3);},function(date){return date.getSeconds();});d3.time.seconds=d3.time.second.range;d3.time.seconds.utc=d3.time.second.utc.range;d3.time.minute=d3_time_interval(function(date){return new d3_time(Math.floor(date/6e4)*6e4);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4);},function(date){return date.getMinutes();});d3.time.minutes=d3.time.minute.range;d3.time.minutes.utc=d3.time.minute.utc.range;d3.time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_time((Math.floor(date/36e5-timezone)+timezone)*36e5);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5);},function(date){return date.getHours();});d3.time.hours=d3.time.hour.range;d3.time.hours.utc=d3.time.hour.utc.range;d3.time.month=d3_time_interval(function(date){date=d3.time.day(date);date.setDate(1);return date;},function(date,offset){date.setMonth(date.getMonth()+offset);},function(date){return date.getMonth();});d3.time.months=d3.time.month.range;d3.time.months.utc=d3.time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x);}
scale.invert=function(x){return d3_time_scaleDate(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale;};scale.nice=function(m){return scale.domain(d3_scale_nice(scale.domain(),function(){return m;}));};scale.ticks=function(m,k){var extent=d3_time_scaleExtent(scale.domain());if(typeof m!=="function"){var span=extent[1]-extent[0],target=span/m,i=d3.bisect(d3_time_scaleSteps,target);if(i==d3_time_scaleSteps.length)return methods.year(extent,m);if(!i)return linear.ticks(m).map(d3_time_scaleDate);if(Math.log(target/d3_time_scaleSteps[i-1])<Math.log(d3_time_scaleSteps[i]/target))--i;m=methods[i];k=m[1];m=m[0].range;}
return m(extent[0],new Date(+extent[1]+1),k);};scale.tickFormat=function(){return format;};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format);};return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_time_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_time_scaleDate(t){return new Date(t);}
function d3_time_scaleFormat(formats){return function(date){var i=formats.length-1,f=formats[i];while(!f[1](date))f=formats[--i];return f[0](date);};}
function d3_time_scaleSetYear(y){var d=new Date(y,0,1);d.setFullYear(y);return d;}
function d3_time_scaleGetYear(d){var y=d.getFullYear(),d0=d3_time_scaleSetYear(y),d1=d3_time_scaleSetYear(y+1);return y+(d-d0)/(d1-d0);}
var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]];var d3_time_scaleLocalFormats=[[d3.time.format("%Y"),d3_true],[d3.time.format("%B"),function(d){return d.getMonth();}],[d3.time.format("%b %d"),function(d){return d.getDate()!=1;}],[d3.time.format("%a %d"),function(d){return d.getDay()&&d.getDate()!=1;}],[d3.time.format("%I %p"),function(d){return d.getHours();}],[d3.time.format("%I:%M"),function(d){return d.getMinutes();}],[d3.time.format(":%S"),function(d){return d.getSeconds();}],[d3.time.format(".%L"),function(d){return d.getMilliseconds();}]];var d3_time_scaleLinear=d3.scale.linear(),d3_time_scaleLocalFormat=d3_time_scaleFormat(d3_time_scaleLocalFormats);d3_time_scaleLocalMethods.year=function(extent,m){return d3_time_scaleLinear.domain(extent.map(d3_time_scaleGetYear)).ticks(m).map(d3_time_scaleSetYear);};d3.time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat);};var d3_time_scaleUTCMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]];});var d3_time_scaleUTCFormats=[[d3.time.format.utc("%Y"),d3_true],[d3.time.format.utc("%B"),function(d){return d.getUTCMonth();}],[d3.time.format.utc("%b %d"),function(d){return d.getUTCDate()!=1;}],[d3.time.format.utc("%a %d"),function(d){return d.getUTCDay()&&d.getUTCDate()!=1;}],[d3.time.format.utc("%I %p"),function(d){return d.getUTCHours();}],[d3.time.format.utc("%I:%M"),function(d){return d.getUTCMinutes();}],[d3.time.format.utc(":%S"),function(d){return d.getUTCSeconds();}],[d3.time.format.utc(".%L"),function(d){return d.getUTCMilliseconds();}]];var d3_time_scaleUTCFormat=d3_time_scaleFormat(d3_time_scaleUTCFormats);function d3_time_scaleUTCSetYear(y){var d=new Date(Date.UTC(y,0,1));d.setUTCFullYear(y);return d;}
function d3_time_scaleUTCGetYear(d){var y=d.getUTCFullYear(),d0=d3_time_scaleUTCSetYear(y),d1=d3_time_scaleUTCSetYear(y+1);return y+(d-d0)/(d1-d0);}
d3_time_scaleUTCMethods.year=function(extent,m){return d3_time_scaleLinear.domain(extent.map(d3_time_scaleUTCGetYear)).ticks(m).map(d3_time_scaleUTCSetYear);};d3.time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUTCMethods,d3_time_scaleUTCFormat);};d3.text=function(){return d3.xhr.apply(d3,arguments).response(d3_text);};function d3_text(request){return request.responseText;}
d3.json=function(url,callback){return d3.xhr(url,"application/json",callback).response(d3_json);};function d3_json(request){return JSON.parse(request.responseText);}
d3.html=function(url,callback){return d3.xhr(url,"text/html",callback).response(d3_html);};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText);}
d3.xml=function(){return d3.xhr.apply(d3,arguments).response(d3_xml);};function d3_xml(request){return request.responseXML;}
return d3;}();;

/* /web_graph/static/lib/nvd3/nv.d3.js defined in bundle 'web.assets_backend' */
(function(){var nv=window.nv||{};nv.version='1.1.14b';nv.dev=true
window.nv=nv;nv.tooltip=nv.tooltip||{};nv.utils=nv.utils||{};nv.models=nv.models||{};nv.charts={};nv.graphs=[];nv.logs={};nv.dispatch=d3.dispatch('render_start','render_end');if(nv.dev){nv.dispatch.on('render_start',function(e){nv.logs.startTime=+new Date();});nv.dispatch.on('render_end',function(e){nv.logs.endTime=+new Date();nv.logs.totalTime=nv.logs.endTime-nv.logs.startTime;nv.log('total',nv.logs.totalTime);});}
nv.log=function(){if(nv.dev&&console.log&&console.log.apply)
console.log.apply(console,arguments)
else if(nv.dev&&typeof console.log=="function"&&Function.prototype.bind){var log=Function.prototype.bind.call(console.log,console);log.apply(console,arguments);}
return arguments[arguments.length-1];};nv.render=function render(step){step=step||1;nv.render.active=true;nv.dispatch.render_start();setTimeout(function(){var chart,graph;for(var i=0;i<step&&(graph=nv.render.queue[i]);i++){chart=graph.generate();if(typeof graph.callback==typeof(Function))graph.callback(chart);nv.graphs.push(chart);}
nv.render.queue.splice(0,i);if(nv.render.queue.length)setTimeout(arguments.callee,0);else{nv.render.active=false;nv.dispatch.render_end();}},0);};nv.render.active=false;nv.render.queue=[];nv.addGraph=function(obj){if(typeof arguments[0]===typeof(Function))
obj={generate:arguments[0],callback:arguments[1]};nv.render.queue.push(obj);if(!nv.render.active)nv.render();};nv.identity=function(d){return d;};nv.strip=function(s){return s.replace(/(\s|&)/g,'');};function daysInMonth(month,year){return(new Date(year,month+1,0)).getDate();}
function d3_time_range(floor,step,number){return function(t0,t1,dt){var time=floor(t0),times=[];if(time<t0)step(time);if(dt>1){while(time<t1){var date=new Date(+time);if((number(date)%dt===0))times.push(date);step(time);}}else{while(time<t1){times.push(new Date(+time));step(time);}}
return times;};}
d3.time.monthEnd=function(date){return new Date(date.getFullYear(),date.getMonth(),0);};d3.time.monthEnds=d3_time_range(d3.time.monthEnd,function(date){date.setUTCDate(date.getUTCDate()+1);date.setDate(daysInMonth(date.getMonth()+1,date.getFullYear()));},function(date){return date.getMonth();});nv.interactiveGuideline=function(){"use strict";var tooltip=nv.models.tooltip();var width=null,height=null,margin={left:0,top:0},xScale=d3.scale.linear(),yScale=d3.scale.linear(),dispatch=d3.dispatch('elementMousemove','elementMouseout','elementDblclick'),showGuideLine=true,svgContainer=null;var isMSIE=navigator.userAgent.indexOf("MSIE")!==-1;function layer(selection){selection.each(function(data){var container=d3.select(this);var availableWidth=(width||960),availableHeight=(height||400);var wrap=container.selectAll("g.nv-wrap.nv-interactiveLineLayer").data([data]);var wrapEnter=wrap.enter().append("g").attr("class"," nv-wrap nv-interactiveLineLayer");wrapEnter.append("g").attr("class","nv-interactiveGuideLine");if(!svgContainer){return;}
function mouseHandler(){var d3mouse=d3.mouse(this);var mouseX=d3mouse[0];var mouseY=d3mouse[1];var subtractMargin=true;var mouseOutAnyReason=false;if(isMSIE){mouseX=d3.event.offsetX;mouseY=d3.event.offsetY;if(d3.event.target.tagName!=="svg")
subtractMargin=false;if(d3.event.target.className.baseVal.match("nv-legend"))
mouseOutAnyReason=true;}
if(subtractMargin){mouseX-=margin.left;mouseY-=margin.top;}
if(mouseX<0||mouseY<0||mouseX>availableWidth||mouseY>availableHeight||(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined)||mouseOutAnyReason)
{if(isMSIE){if(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined&&d3.event.relatedTarget.className.match(tooltip.nvPointerEventsClass)){return;}}
dispatch.elementMouseout({mouseX:mouseX,mouseY:mouseY});layer.renderGuideLine(null);return;}
var pointXValue=xScale.invert(mouseX);dispatch.elementMousemove({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});if(d3.event.type==="dblclick"){dispatch.elementDblclick({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}}
svgContainer.on("mousemove",mouseHandler,true).on("mouseout",mouseHandler,true).on("dblclick",mouseHandler);layer.renderGuideLine=function(x){if(!showGuideLine)return;var line=wrap.select(".nv-interactiveGuideLine").selectAll("line").data((x!=null)?[nv.utils.NaNtoZero(x)]:[],String);line.enter().append("line").attr("class","nv-guideline").attr("x1",function(d){return d;}).attr("x2",function(d){return d;}).attr("y1",availableHeight).attr("y2",0);line.exit().remove();}});}
layer.dispatch=dispatch;layer.tooltip=tooltip;layer.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.left=typeof _.left!='undefined'?_.left:margin.left;return layer;};layer.width=function(_){if(!arguments.length)return width;width=_;return layer;};layer.height=function(_){if(!arguments.length)return height;height=_;return layer;};layer.xScale=function(_){if(!arguments.length)return xScale;xScale=_;return layer;};layer.showGuideLine=function(_){if(!arguments.length)return showGuideLine;showGuideLine=_;return layer;};layer.svgContainer=function(_){if(!arguments.length)return svgContainer;svgContainer=_;return layer;};return layer;};nv.interactiveBisect=function(values,searchVal,xAccessor){"use strict";if(!values instanceof Array)return null;if(typeof xAccessor!=='function')xAccessor=function(d,i){return d.x;}
var bisect=d3.bisector(xAccessor).left;var index=d3.max([0,bisect(values,searchVal)-1]);var currentValue=xAccessor(values[index],index);if(typeof currentValue==='undefined')currentValue=index;if(currentValue===searchVal)return index;var nextIndex=d3.min([index+1,values.length-1]);var nextValue=xAccessor(values[nextIndex],nextIndex);if(typeof nextValue==='undefined')nextValue=nextIndex;if(Math.abs(nextValue-searchVal)>=Math.abs(currentValue-searchVal))
return index;else
return nextIndex};nv.nearestValueIndex=function(values,searchVal,threshold){"use strict";var yDistMax=Infinity,indexToHighlight=null;values.forEach(function(d,i){var delta=Math.abs(searchVal-d);if(delta<=yDistMax&&delta<threshold){yDistMax=delta;indexToHighlight=i;}});return indexToHighlight;};(function(){"use strict";window.nv.tooltip={};window.nv.models.tooltip=function(){var content=null,data=null,gravity='w',distance=50,snapDistance=25,fixedTop=null,classes=null,chartContainer=null,tooltipElem=null,position={left:null,top:null},enabled=true,id="nvtooltip-"+Math.floor(Math.random()*100000);var nvPointerEventsClass="nv-pointer-events-none";var valueFormatter=function(d,i){return d;};var headerFormatter=function(d){return d;};var contentGenerator=function(d){if(content!=null)return content;if(d==null)return'';var table=d3.select(document.createElement("table"));var theadEnter=table.selectAll("thead").data([d]).enter().append("thead");theadEnter.append("tr").append("td").attr("colspan",3).append("strong").classed("x-value",true).html(headerFormatter(d.value));var tbodyEnter=table.selectAll("tbody").data([d]).enter().append("tbody");var trowEnter=tbodyEnter.selectAll("tr").data(function(p){return p.series}).enter().append("tr").classed("highlight",function(p){return p.highlight});trowEnter.append("td").classed("legend-color-guide",true).append("div").style("background-color",function(p){return p.color});trowEnter.append("td").classed("key",true).html(function(p){return p.key});trowEnter.append("td").classed("value",true).html(function(p,i){return valueFormatter(p.value,i)});trowEnter.selectAll("td").each(function(p){if(p.highlight){var opacityScale=d3.scale.linear().domain([0,1]).range(["#fff",p.color]);var opacity=0.6;d3.select(this).style("border-bottom-color",opacityScale(opacity)).style("border-top-color",opacityScale(opacity));}});var html=table.node().outerHTML;if(d.footer!==undefined)
html+="<div class='footer'>"+d.footer+"</div>";return html;};var dataSeriesExists=function(d){if(d&&d.series&&d.series.length>0)return true;return false;};function convertViewBoxRatio(){if(chartContainer){var svg=d3.select(chartContainer);if(svg.node().tagName!=="svg"){svg=svg.select("svg");}
var viewBox=(svg.node())?svg.attr('viewBox'):null;if(viewBox){viewBox=viewBox.split(' ');var ratio=parseInt(svg.style('width'))/viewBox[2];position.left=position.left*ratio;position.top=position.top*ratio;}}}
function getTooltipContainer(newContent){var body;if(chartContainer)
body=d3.select(chartContainer);else
body=d3.select("body");var container=body.select(".nvtooltip");if(container.node()===null){container=body.append("div").attr("class","nvtooltip "+(classes?classes:"xy-tooltip")).attr("id",id);}
container.node().innerHTML=newContent;container.style("top",0).style("left",0).style("opacity",0);container.selectAll("div, table, td, tr").classed(nvPointerEventsClass,true)
container.classed(nvPointerEventsClass,true);return container.node();}
function nvtooltip(){if(!enabled)return;if(!dataSeriesExists(data))return;convertViewBoxRatio();var left=position.left;var top=(fixedTop!=null)?fixedTop:position.top;var container=getTooltipContainer(contentGenerator(data));tooltipElem=container;if(chartContainer){var svgComp=chartContainer.getElementsByTagName("svg")[0];var boundRect=(svgComp)?svgComp.getBoundingClientRect():chartContainer.getBoundingClientRect();var svgOffset={left:0,top:0};if(svgComp){var svgBound=svgComp.getBoundingClientRect();var chartBound=chartContainer.getBoundingClientRect();var svgBoundTop=svgBound.top;if(svgBoundTop<0){var containerBound=chartContainer.getBoundingClientRect();svgBoundTop=(Math.abs(svgBoundTop)>containerBound.height)?0:svgBoundTop;}
svgOffset.top=Math.abs(svgBoundTop-chartBound.top);svgOffset.left=Math.abs(svgBound.left-chartBound.left);}
left+=chartContainer.offsetLeft+svgOffset.left-2*chartContainer.scrollLeft;top+=chartContainer.offsetTop+svgOffset.top-2*chartContainer.scrollTop;}
if(snapDistance&&snapDistance>0){top=Math.floor(top/snapDistance)*snapDistance;}
nv.tooltip.calcTooltipPosition([left,top],gravity,distance,container);return nvtooltip;};nvtooltip.nvPointerEventsClass=nvPointerEventsClass;nvtooltip.content=function(_){if(!arguments.length)return content;content=_;return nvtooltip;};nvtooltip.tooltipElem=function(){return tooltipElem;};nvtooltip.contentGenerator=function(_){if(!arguments.length)return contentGenerator;if(typeof _==='function'){contentGenerator=_;}
return nvtooltip;};nvtooltip.data=function(_){if(!arguments.length)return data;data=_;return nvtooltip;};nvtooltip.gravity=function(_){if(!arguments.length)return gravity;gravity=_;return nvtooltip;};nvtooltip.distance=function(_){if(!arguments.length)return distance;distance=_;return nvtooltip;};nvtooltip.snapDistance=function(_){if(!arguments.length)return snapDistance;snapDistance=_;return nvtooltip;};nvtooltip.classes=function(_){if(!arguments.length)return classes;classes=_;return nvtooltip;};nvtooltip.chartContainer=function(_){if(!arguments.length)return chartContainer;chartContainer=_;return nvtooltip;};nvtooltip.position=function(_){if(!arguments.length)return position;position.left=(typeof _.left!=='undefined')?_.left:position.left;position.top=(typeof _.top!=='undefined')?_.top:position.top;return nvtooltip;};nvtooltip.fixedTop=function(_){if(!arguments.length)return fixedTop;fixedTop=_;return nvtooltip;};nvtooltip.enabled=function(_){if(!arguments.length)return enabled;enabled=_;return nvtooltip;};nvtooltip.valueFormatter=function(_){if(!arguments.length)return valueFormatter;if(typeof _==='function'){valueFormatter=_;}
return nvtooltip;};nvtooltip.headerFormatter=function(_){if(!arguments.length)return headerFormatter;if(typeof _==='function'){headerFormatter=_;}
return nvtooltip;};nvtooltip.id=function(){return id;};return nvtooltip;};nv.tooltip.show=function(pos,content,gravity,dist,parentContainer,classes){var container=document.createElement('div');container.className='nvtooltip '+(classes?classes:'xy-tooltip');var body=parentContainer;if(!parentContainer||parentContainer.tagName.match(/g|svg/i)){body=document.getElementsByTagName('body')[0];}
container.style.left=0;container.style.top=0;container.style.opacity=0;container.innerHTML=content;body.appendChild(container);if(parentContainer){pos[0]=pos[0]-parentContainer.scrollLeft;pos[1]=pos[1]-parentContainer.scrollTop;}
nv.tooltip.calcTooltipPosition(pos,gravity,dist,container);};nv.tooltip.findFirstNonSVGParent=function(Elem){while(Elem.tagName.match(/^g|svg$/i)!==null){Elem=Elem.parentNode;}
return Elem;};nv.tooltip.findTotalOffsetTop=function(Elem,initialTop){var offsetTop=initialTop;do{if(!isNaN(Elem.offsetTop)){offsetTop+=(Elem.offsetTop);}}while(Elem=Elem.offsetParent);return offsetTop;};nv.tooltip.findTotalOffsetLeft=function(Elem,initialLeft){var offsetLeft=initialLeft;do{if(!isNaN(Elem.offsetLeft)){offsetLeft+=(Elem.offsetLeft);}}while(Elem=Elem.offsetParent);return offsetLeft;};nv.tooltip.calcTooltipPosition=function(pos,gravity,dist,container){var height=parseInt(container.offsetHeight),width=parseInt(container.offsetWidth),windowWidth=nv.utils.windowSize().width,windowHeight=nv.utils.windowSize().height,scrollTop=window.pageYOffset,scrollLeft=window.pageXOffset,left,top;windowHeight=window.innerWidth>=document.body.scrollWidth?windowHeight:windowHeight-16;windowWidth=window.innerHeight>=document.body.scrollHeight?windowWidth:windowWidth-16;gravity=gravity||'s';dist=dist||20;var tooltipTop=function(Elem){return nv.tooltip.findTotalOffsetTop(Elem,top);};var tooltipLeft=function(Elem){return nv.tooltip.findTotalOffsetLeft(Elem,left);};switch(gravity){case'e':left=pos[0]-width-dist;top=pos[1]-(height/2);var tLeft=tooltipLeft(container);var tTop=tooltipTop(container);if(tLeft<scrollLeft)left=pos[0]+dist>scrollLeft?pos[0]+dist:scrollLeft-tLeft+left;if(tTop<scrollTop)top=scrollTop-tTop+top;if(tTop+height>scrollTop+windowHeight)top=scrollTop+windowHeight-tTop+top-height;break;case'w':left=pos[0]+dist;top=pos[1]-(height/2);var tLeft=tooltipLeft(container);var tTop=tooltipTop(container);if(tLeft+width>windowWidth)left=pos[0]-width-dist;if(tTop<scrollTop)top=scrollTop+5;if(tTop+height>scrollTop+windowHeight)top=scrollTop+windowHeight-tTop+top-height;break;case'n':left=pos[0]-(width/2)-5;top=pos[1]+dist;var tLeft=tooltipLeft(container);var tTop=tooltipTop(container);if(tLeft<scrollLeft)left=scrollLeft+5;if(tLeft+width>windowWidth)left=left-width/2+5;if(tTop+height>scrollTop+windowHeight)top=scrollTop+windowHeight-tTop+top-height;break;case's':left=pos[0]-(width/2);top=pos[1]-height-dist;var tLeft=tooltipLeft(container);var tTop=tooltipTop(container);if(tLeft<scrollLeft)left=scrollLeft+5;if(tLeft+width>windowWidth)left=left-width/2+5;if(scrollTop>tTop)top=scrollTop;break;case'none':left=pos[0];top=pos[1]-dist;var tLeft=tooltipLeft(container);var tTop=tooltipTop(container);break;}
container.style.left=left+'px';container.style.top=top+'px';container.style.opacity=1;container.style.position='absolute';return container;};nv.tooltip.cleanup=function(){var tooltips=document.getElementsByClassName('nvtooltip');var purging=[];while(tooltips.length){purging.push(tooltips[0]);tooltips[0].style.transitionDelay='0 !important';tooltips[0].style.opacity=0;tooltips[0].className='nvtooltip-pending-removal';}
setTimeout(function(){while(purging.length){var removeMe=purging.pop();removeMe.parentNode.removeChild(removeMe);}},500);};})();nv.utils.windowSize=function(){var size={width:640,height:480};if(document.body&&document.body.offsetWidth){size.width=document.body.offsetWidth;size.height=document.body.offsetHeight;}
if(document.compatMode=='CSS1Compat'&&document.documentElement&&document.documentElement.offsetWidth){size.width=document.documentElement.offsetWidth;size.height=document.documentElement.offsetHeight;}
if(window.innerWidth&&window.innerHeight){size.width=window.innerWidth;size.height=window.innerHeight;}
return(size);};nv.utils.windowResize=function(fun){if(fun===undefined)return;var oldresize=window.onresize;window.onresize=function(e){if(typeof oldresize=='function')oldresize(e);fun(e);}}
nv.utils.getColor=function(color){if(!arguments.length)return nv.utils.defaultColor();if(Object.prototype.toString.call(color)==='[object Array]')
return function(d,i){return d.color||color[i%color.length];};else
return color;}
nv.utils.defaultColor=function(){var colors=d3.scale.category20().range();return function(d,i){return d.color||colors[i%colors.length]};}
nv.utils.customTheme=function(dictionary,getKey,defaultColors){getKey=getKey||function(series){return series.key};defaultColors=defaultColors||d3.scale.category20().range();var defIndex=defaultColors.length;return function(series,index){var key=getKey(series);if(!defIndex)defIndex=defaultColors.length;if(typeof dictionary[key]!=="undefined")
return(typeof dictionary[key]==="function")?dictionary[key]():dictionary[key];else
return defaultColors[--defIndex];}}
nv.utils.pjax=function(links,content){d3.selectAll(links).on("click",function(){history.pushState(this.href,this.textContent,this.href);load(this.href);d3.event.preventDefault();});function load(href){d3.html(href,function(fragment){var target=d3.select(content).node();target.parentNode.replaceChild(d3.select(fragment).select(content).node(),target);nv.utils.pjax(links,content);});}
d3.select(window).on("popstate",function(){if(d3.event.state)load(d3.event.state);});}
nv.utils.calcApproxTextWidth=function(svgTextElem){if(svgTextElem instanceof d3.selection){var fontSize=parseInt(svgTextElem.style("font-size").replace("px",""));var textLength=svgTextElem.text().length;return textLength*fontSize*0.5;}
return 0;};nv.utils.NaNtoZero=function(n){if(typeof n!=='number'||isNaN(n)||n===null||n===Infinity)return 0;return n;};nv.utils.optionsFunc=function(args){if(args){d3.map(args).forEach((function(key,value){if(typeof this[key]==="function"){this[key](value);}}).bind(this));}
return this;};nv.models.axis=function(){"use strict";var axis=d3.svg.axis();var margin={top:0,right:0,bottom:0,left:0},width=75,height=60,scale=d3.scale.linear(),axisLabelText=null,showMaxMin=true,highlightZero=true,rotateLabels=0,rotateYLabel=true,staggerLabels=false,isOrdinal=false,ticks=null,axisLabelDistance=12;axis.scale(scale).orient('bottom').tickFormat(function(d){return d});var scale0;function chart(selection){selection.each(function(data){var container=d3.select(this);var wrap=container.selectAll('g.nv-wrap.nv-axis').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-axis');var gEnter=wrapEnter.append('g');var g=wrap.select('g')
if(ticks!==null)
axis.ticks(ticks);else if(axis.orient()=='top'||axis.orient()=='bottom')
axis.ticks(Math.abs(scale.range()[1]-scale.range()[0])/100);g.transition().call(axis);scale0=scale0||axis.scale();var fmt=axis.tickFormat();if(fmt==null){fmt=scale0.tickFormat();}
var axisLabel=g.selectAll('text.nv-axislabel').data([axisLabelText||null]);axisLabel.exit().remove();switch(axis.orient()){case'top':axisLabel.enter().append('text').attr('class','nv-axislabel');var w=(scale.range().length==2)?scale.range()[1]:(scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]));axisLabel.attr('text-anchor','middle').attr('y',0).attr('x',w/2);if(showMaxMin){var axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class','nv-axisMaxMin').append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+scale(d)+',0)'}).select('text').attr('dy','0em').attr('y',-axis.tickPadding()).attr('text-anchor','middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.transition().attr('transform',function(d,i){return'translate('+scale.range()[i]+',0)'});}
break;case'bottom':var xLabelMargin=36;var maxTextWidth=30;var xTicks=g.selectAll('g').select("text");if(rotateLabels%360){xTicks.each(function(d,i){var width=this.getBBox().width;if(width>maxTextWidth)maxTextWidth=width;});var sin=Math.abs(Math.sin(rotateLabels*Math.PI/180));var xLabelMargin=(sin?sin*maxTextWidth:maxTextWidth)+30;xTicks.attr('transform',function(d,i,j){return'rotate('+rotateLabels+' 0,0)'}).style('text-anchor',rotateLabels%360>0?'start':'end');}
axisLabel.enter().append('text').attr('class','nv-axislabel');var w=(scale.range().length==2)?scale.range()[1]:(scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]));axisLabel.attr('text-anchor','middle').attr('y',xLabelMargin).attr('x',w/2);if(showMaxMin){var axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data([scale.domain()[0],scale.domain()[scale.domain().length-1]]);axisMaxMin.enter().append('g').attr('class','nv-axisMaxMin').append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+(scale(d)+(isOrdinal?scale.rangeBand()/2:0))+',0)'}).select('text').attr('dy','.71em').attr('y',axis.tickPadding()).attr('transform',function(d,i,j){return'rotate('+rotateLabels+' 0,0)'}).style('text-anchor',rotateLabels?(rotateLabels%360>0?'start':'end'):'middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.transition().attr('transform',function(d,i){return'translate('+(scale(d)+(isOrdinal?scale.rangeBand()/2:0))+',0)'});}
if(staggerLabels)
xTicks.attr('transform',function(d,i){return'translate(0,'+(i%2==0?'0':'12')+')'});break;case'right':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'begin').attr('transform',rotateYLabel?'rotate(90)':'').attr('y',rotateYLabel?(-Math.max(margin.right,width)+12):-10).attr('x',rotateYLabel?(scale.range()[0]/2):axis.tickPadding());if(showMaxMin){var axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class','nv-axisMaxMin').append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+scale(d)+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',axis.tickPadding()).style('text-anchor','start').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.transition().attr('transform',function(d,i){return'translate(0,'+scale.range()[i]+')'}).select('text').style('opacity',1);}
break;case'left':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'end').attr('transform',rotateYLabel?'rotate(-90)':'').attr('y',rotateYLabel?(-Math.max(margin.left,width)+axisLabelDistance):-10).attr('x',rotateYLabel?(-scale.range()[0]/2):-axis.tickPadding());if(showMaxMin){var axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class','nv-axisMaxMin').append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+scale0(d)+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',-axis.tickPadding()).attr('text-anchor','end').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.transition().attr('transform',function(d,i){return'translate(0,'+scale.range()[i]+')'}).select('text').style('opacity',1);}
break;}
axisLabel.text(function(d){return d});if(showMaxMin&&(axis.orient()==='left'||axis.orient()==='right')){g.selectAll('g').each(function(d,i){d3.select(this).select('text').attr('opacity',1);if(scale(d)<scale.range()[1]+10||scale(d)>scale.range()[0]-10){if(d>1e-10||d<-1e-10)
d3.select(this).attr('opacity',0);d3.select(this).select('text').attr('opacity',0);}});if(scale.domain()[0]==scale.domain()[1]&&scale.domain()[0]==0)
wrap.selectAll('g.nv-axisMaxMin').style('opacity',function(d,i){return!i?1:0});}
if(showMaxMin&&(axis.orient()==='top'||axis.orient()==='bottom')){var maxMinRange=[];wrap.selectAll('g.nv-axisMaxMin').each(function(d,i){try{if(i)
maxMinRange.push(scale(d)-this.getBBox().width-4)
else
maxMinRange.push(scale(d)+this.getBBox().width+4)}catch(err){if(i)
maxMinRange.push(scale(d)-4)
else
maxMinRange.push(scale(d)+4)}});g.selectAll('g').each(function(d,i){if(scale(d)<maxMinRange[0]||scale(d)>maxMinRange[1]){if(d>1e-10||d<-1e-10)
d3.select(this).remove();else
d3.select(this).select('text').remove();}});}
if(highlightZero)
g.selectAll('.tick').filter(function(d){return!parseFloat(Math.round(d.__data__*100000)/1000000)&&(d.__data__!==undefined)}).classed('zero',true);scale0=scale.copy();});return chart;}
chart.axis=axis;d3.rebind(chart,axis,'orient','tickValues','tickSubdivide','tickSize','tickPadding','tickFormat');d3.rebind(chart,scale,'domain','range','rangeBand','rangeBands');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;}
chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.ticks=function(_){if(!arguments.length)return ticks;ticks=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.axisLabel=function(_){if(!arguments.length)return axisLabelText;axisLabelText=_;return chart;}
chart.showMaxMin=function(_){if(!arguments.length)return showMaxMin;showMaxMin=_;return chart;}
chart.highlightZero=function(_){if(!arguments.length)return highlightZero;highlightZero=_;return chart;}
chart.scale=function(_){if(!arguments.length)return scale;scale=_;axis.scale(scale);isOrdinal=typeof scale.rangeBands==='function';d3.rebind(chart,scale,'domain','range','rangeBand','rangeBands');return chart;}
chart.rotateYLabel=function(_){if(!arguments.length)return rotateYLabel;rotateYLabel=_;return chart;}
chart.rotateLabels=function(_){if(!arguments.length)return rotateLabels;rotateLabels=_;return chart;}
chart.staggerLabels=function(_){if(!arguments.length)return staggerLabels;staggerLabels=_;return chart;};chart.axisLabelDistance=function(_){if(!arguments.length)return axisLabelDistance;axisLabelDistance=_;return chart;};return chart;}
nv.models.historicalBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),x=d3.scale.linear(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},forceX=[],forceY=[0],padData=false,clipEdge=true,color=nv.utils.defaultColor(),xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout'),interactive=true;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);x.domain(xDomain||d3.extent(data[0].values.map(getX).concat(forceX)))
if(padData)
x.range(xRange||[availableWidth*.5/data[0].values.length,availableWidth*(data[0].values.length-.5)/data[0].values.length]);else
x.range(xRange||[0,availableWidth]);y.domain(yDomain||d3.extent(data[0].values.map(getY).concat(forceY))).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);var wrap=container.selectAll('g.nv-wrap.nv-historicalBar-'+id).data([data[0].values]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-historicalBar-'+id);var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-bars');wrap.attr('transform','translate('+margin.left+','+margin.top+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});defsEnter.append('clipPath').attr('id','nv-chart-clip-path-'+id).append('rect');wrap.select('#nv-chart-clip-path-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-chart-clip-path-'+id+')':'');var bars=wrap.select('.nv-bars').selectAll('.nv-bar').data(function(d){return d},function(d,i){return getX(d,i)});bars.exit().remove();var barsEnter=bars.enter().append('rect').attr('x',0).attr('y',function(d,i){return nv.utils.NaNtoZero(y(Math.max(0,getY(d,i))))}).attr('height',function(d,i){return nv.utils.NaNtoZero(Math.abs(y(getY(d,i))-y(0)))}).attr('transform',function(d,i){return'translate('+(x(getX(d,i))-availableWidth/data[0].values.length*.45)+',0)';}).on('mouseover',function(d,i){if(!interactive)return;d3.select(this).classed('hover',true);dispatch.elementMouseover({point:d,series:data[0],pos:[x(getX(d,i)),y(getY(d,i))],pointIndex:i,seriesIndex:0,e:d3.event});}).on('mouseout',function(d,i){if(!interactive)return;d3.select(this).classed('hover',false);dispatch.elementMouseout({point:d,series:data[0],pointIndex:i,seriesIndex:0,e:d3.event});}).on('click',function(d,i){if(!interactive)return;dispatch.elementClick({value:getY(d,i),data:d,index:i,pos:[x(getX(d,i)),y(getY(d,i))],e:d3.event,id:id});d3.event.stopPropagation();}).on('dblclick',function(d,i){if(!interactive)return;dispatch.elementDblClick({value:getY(d,i),data:d,index:i,pos:[x(getX(d,i)),y(getY(d,i))],e:d3.event,id:id});d3.event.stopPropagation();});bars.attr('fill',function(d,i){return color(d,i);}).attr('class',function(d,i,j){return(getY(d,i)<0?'nv-bar negative':'nv-bar positive')+' nv-bar-'+j+'-'+i}).transition().attr('transform',function(d,i){return'translate('+(x(getX(d,i))-availableWidth/data[0].values.length*.45)+',0)';}).attr('width',(availableWidth/data[0].values.length)*.9);bars.transition().attr('y',function(d,i){var rval=getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i));return nv.utils.NaNtoZero(rval);}).attr('height',function(d,i){return nv.utils.NaNtoZero(Math.max(Math.abs(y(getY(d,i))-y(0)),1))});});return chart;}
chart.highlightPoint=function(pointIndex,isHoverOver){d3.select(".nv-historicalBar-"+id).select(".nv-bars .nv-bar-0-"+pointIndex).classed("hover",isHoverOver);};chart.clearHighlights=function(){d3.select(".nv-historicalBar-"+id).select(".nv-bars .nv-bar.hover").classed("hover",false);};chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.xRange=function(_){if(!arguments.length)return xRange;xRange=_;return chart;};chart.yRange=function(_){if(!arguments.length)return yRange;yRange=_;return chart;};chart.forceX=function(_){if(!arguments.length)return forceX;forceX=_;return chart;};chart.forceY=function(_){if(!arguments.length)return forceY;forceY=_;return chart;};chart.padData=function(_){if(!arguments.length)return padData;padData=_;return chart;};chart.clipEdge=function(_){if(!arguments.length)return clipEdge;clipEdge=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.interactive=function(_){if(!arguments.length)return interactive;interactive=false;return chart;};return chart;}
nv.models.bullet=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},orient='left',reverse=false,ranges=function(d){return d.ranges},markers=function(d){return d.markers},measures=function(d){return d.measures},rangeLabels=function(d){return d.rangeLabels?d.rangeLabels:[]},markerLabels=function(d){return d.markerLabels?d.markerLabels:[]},measureLabels=function(d){return d.measureLabels?d.measureLabels:[]},forceX=[0],width=380,height=30,tickFormat=null,color=nv.utils.getColor(['#1f77b4']),dispatch=d3.dispatch('elementMouseover','elementMouseout');function chart(selection){selection.each(function(d,i){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);var rangez=ranges.call(this,d,i).slice().sort(d3.descending),markerz=markers.call(this,d,i).slice().sort(d3.descending),measurez=measures.call(this,d,i).slice().sort(d3.descending),rangeLabelz=rangeLabels.call(this,d,i).slice(),markerLabelz=markerLabels.call(this,d,i).slice(),measureLabelz=measureLabels.call(this,d,i).slice();var x1=d3.scale.linear().domain(d3.extent(d3.merge([forceX,rangez]))).range(reverse?[availableWidth,0]:[0,availableWidth]);var x0=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(x1.range());this.__chart__=x1;var rangeMin=d3.min(rangez),rangeMax=d3.max(rangez),rangeAvg=rangez[1];var wrap=container.selectAll('g.nv-wrap.nv-bullet').data([d]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-bullet');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('rect').attr('class','nv-range nv-rangeMax');gEnter.append('rect').attr('class','nv-range nv-rangeAvg');gEnter.append('rect').attr('class','nv-range nv-rangeMin');gEnter.append('rect').attr('class','nv-measure');gEnter.append('path').attr('class','nv-markerTriangle');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var w0=function(d){return Math.abs(x0(d)-x0(0))},w1=function(d){return Math.abs(x1(d)-x1(0))};var xp0=function(d){return d<0?x0(d):x0(0)},xp1=function(d){return d<0?x1(d):x1(0)};g.select('rect.nv-rangeMax').attr('height',availableHeight).attr('width',w1(rangeMax>0?rangeMax:rangeMin)).attr('x',xp1(rangeMax>0?rangeMax:rangeMin)).datum(rangeMax>0?rangeMax:rangeMin)
g.select('rect.nv-rangeAvg').attr('height',availableHeight).attr('width',w1(rangeAvg)).attr('x',xp1(rangeAvg)).datum(rangeAvg)
g.select('rect.nv-rangeMin').attr('height',availableHeight).attr('width',w1(rangeMax)).attr('x',xp1(rangeMax)).attr('width',w1(rangeMax>0?rangeMin:rangeMax)).attr('x',xp1(rangeMax>0?rangeMin:rangeMax)).datum(rangeMax>0?rangeMin:rangeMax)
g.select('rect.nv-measure').style('fill',color).attr('height',availableHeight/3).attr('y',availableHeight/3).attr('width',measurez<0?x1(0)-x1(measurez[0]):x1(measurez[0])-x1(0)).attr('x',xp1(measurez)).on('mouseover',function(){dispatch.elementMouseover({value:measurez[0],label:measureLabelz[0]||'Current',pos:[x1(measurez[0]),availableHeight/2]})}).on('mouseout',function(){dispatch.elementMouseout({value:measurez[0],label:measureLabelz[0]||'Current'})})
var h3=availableHeight/6;if(markerz[0]){g.selectAll('path.nv-markerTriangle').attr('transform',function(d){return'translate('+x1(markerz[0])+','+(availableHeight/2)+')'}).attr('d','M0,'+h3+'L'+h3+','+(-h3)+' '+(-h3)+','+(-h3)+'Z').on('mouseover',function(){dispatch.elementMouseover({value:markerz[0],label:markerLabelz[0]||'Previous',pos:[x1(markerz[0]),availableHeight/2]})}).on('mouseout',function(){dispatch.elementMouseout({value:markerz[0],label:markerLabelz[0]||'Previous'})});}else{g.selectAll('path.nv-markerTriangle').remove();}
wrap.selectAll('.nv-range').on('mouseover',function(d,i){var label=rangeLabelz[i]||(!i?"Maximum":i==1?"Mean":"Minimum");dispatch.elementMouseover({value:d,label:label,pos:[x1(d),availableHeight/2]})}).on('mouseout',function(d,i){var label=rangeLabelz[i]||(!i?"Maximum":i==1?"Mean":"Minimum");dispatch.elementMouseout({value:d,label:label})})});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.orient=function(_){if(!arguments.length)return orient;orient=_;reverse=orient=='right'||orient=='bottom';return chart;};chart.ranges=function(_){if(!arguments.length)return ranges;ranges=_;return chart;};chart.markers=function(_){if(!arguments.length)return markers;markers=_;return chart;};chart.measures=function(_){if(!arguments.length)return measures;measures=_;return chart;};chart.forceX=function(_){if(!arguments.length)return forceX;forceX=_;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.tickFormat=function(_){if(!arguments.length)return tickFormat;tickFormat=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};return chart;};nv.models.bulletChart=function(){"use strict";var bullet=nv.models.bullet();var orient='left',reverse=false,margin={top:5,right:40,bottom:20,left:120},ranges=function(d){return d.ranges},markers=function(d){return d.markers},measures=function(d){return d.measures},width=null,height=55,tickFormat=null,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+x+'</h3>'+'<p>'+y+'</p>'},noData='No Data Available.',dispatch=d3.dispatch('tooltipShow','tooltipHide');var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0)+margin.left,top=e.pos[1]+(offsetElement.offsetTop||0)+margin.top,content=tooltip(e.key,e.label,e.value,e,chart);nv.tooltip.show([left,top],content,e.value<0?'e':'w',null,offsetElement);};function chart(selection){selection.each(function(d,i){var container=d3.select(this);var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,that=this;chart.update=function(){chart(selection)};chart.container=this;if(!d||!ranges.call(this,d,i)){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',18+margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
var rangez=ranges.call(this,d,i).slice().sort(d3.descending),markerz=markers.call(this,d,i).slice().sort(d3.descending),measurez=measures.call(this,d,i).slice().sort(d3.descending);var wrap=container.selectAll('g.nv-wrap.nv-bulletChart').data([d]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-bulletChart');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-bulletWrap');gEnter.append('g').attr('class','nv-titles');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var x1=d3.scale.linear().domain([0,Math.max(rangez[0],markerz[0],measurez[0])]).range(reverse?[availableWidth,0]:[0,availableWidth]);var x0=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(x1.range());this.__chart__=x1;var w0=function(d){return Math.abs(x0(d)-x0(0))},w1=function(d){return Math.abs(x1(d)-x1(0))};var title=gEnter.select('.nv-titles').append('g').attr('text-anchor','end').attr('transform','translate(-6,'+(height-margin.top-margin.bottom)/2+')');title.append('text').attr('class','nv-title').text(function(d){return d.title;});title.append('text').attr('class','nv-subtitle').attr('dy','1em').text(function(d){return d.subtitle;});bullet.width(availableWidth).height(availableHeight)
var bulletWrap=g.select('.nv-bulletWrap');d3.transition(bulletWrap).call(bullet);var format=tickFormat||x1.tickFormat(availableWidth/100);var tick=g.selectAll('g.nv-tick').data(x1.ticks(availableWidth/50),function(d){return this.textContent||format(d);});var tickEnter=tick.enter().append('g').attr('class','nv-tick').attr('transform',function(d){return'translate('+x0(d)+',0)'}).style('opacity',1e-6);tickEnter.append('line').attr('y1',availableHeight).attr('y2',availableHeight*7/6);tickEnter.append('text').attr('text-anchor','middle').attr('dy','1em').attr('y',availableHeight*7/6).text(format);var tickUpdate=d3.transition(tick).attr('transform',function(d){return'translate('+x1(d)+',0)'}).style('opacity',1);tickUpdate.select('line').attr('y1',availableHeight).attr('y2',availableHeight*7/6);tickUpdate.select('text').attr('y',availableHeight*7/6);d3.transition(tick.exit()).attr('transform',function(d){return'translate('+x1(d)+',0)'}).style('opacity',1e-6).remove();dispatch.on('tooltipShow',function(e){e.key=d.title;if(tooltips)showTooltip(e,that.parentNode);});});d3.timer.flush();return chart;}
bullet.dispatch.on('elementMouseover.tooltip',function(e){dispatch.tooltipShow(e);});bullet.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.bullet=bullet;d3.rebind(chart,bullet,'color');chart.options=nv.utils.optionsFunc.bind(chart);chart.orient=function(x){if(!arguments.length)return orient;orient=x;reverse=orient=='right'||orient=='bottom';return chart;};chart.ranges=function(x){if(!arguments.length)return ranges;ranges=x;return chart;};chart.markers=function(x){if(!arguments.length)return markers;markers=x;return chart;};chart.measures=function(x){if(!arguments.length)return measures;measures=x;return chart;};chart.width=function(x){if(!arguments.length)return width;width=x;return chart;};chart.height=function(x){if(!arguments.length)return height;height=x;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.tickFormat=function(x){if(!arguments.length)return tickFormat;tickFormat=x;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};return chart;};nv.models.cumulativeLineChart=function(){"use strict";var lines=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend(),interactiveLayer=nv.interactiveGuideline();var margin={top:30,right:30,bottom:50,left:60},color=nv.utils.defaultColor(),width=null,height=null,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,tooltips=true,showControls=true,useInteractiveGuideline=false,rescaleY=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' at '+x+'</p>'},x,y,id=lines.id(),state={index:0,rescaleY:rescaleY},defaultState=null,noData='No Data Available.',average=function(d){return d.average},dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),transitionDuration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient((rightAlignYAxis)?'right':'left');controls.updateState(false);var dx=d3.scale.linear(),index={i:0,x:0};var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(lines.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(lines.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,null,null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this).classed('nv-chart-'+id,true),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
var indexDrag=d3.behavior.drag().on('dragstart',dragStart).on('drag',dragMove).on('dragend',dragEnd);function dragStart(d,i){d3.select(chart.container).style('cursor','ew-resize');}
function dragMove(d,i){index.x=d3.event.x;index.i=Math.round(dx.invert(index.x));updateZero();}
function dragEnd(d,i){d3.select(chart.container).style('cursor','auto');state.index=index.i;dispatch.stateChange(state);}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();if(!rescaleY){var seriesDomains=data.filter(function(series){return!series.disabled}).map(function(series,i){var initialDomain=d3.extent(series.values,lines.y());if(initialDomain[0]<-.95)initialDomain[0]=-.95;return[(initialDomain[0]-initialDomain[1])/(1+initialDomain[1]),(initialDomain[1]-initialDomain[0])/(1+initialDomain[0])];});var completeDomain=[d3.min(seriesDomains,function(d){return d[0]}),d3.max(seriesDomains,function(d){return d[1]})]
lines.yDomain(completeDomain);}else{lines.yDomain(null);}
dx.domain([0,data[0].values.length-1]).range([0,availableWidth]).clamp(true);var data=indexify(index.i,data);var interactivePointerEvents=(useInteractiveGuideline)?"none":"all";var wrap=container.selectAll('g.nv-wrap.nv-cumulativeLine').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-cumulativeLine').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-interactive');gEnter.append('g').attr('class','nv-x nv-axis').style("pointer-events","none");gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-background');gEnter.append('g').attr('class','nv-linesWrap').style("pointer-events",interactivePointerEvents);gEnter.append('g').attr('class','nv-avgLinesWrap').style("pointer-events","none");gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
g.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
if(showControls){var controlsData=[{key:'Re-scale y-axis',disabled:!rescaleY}];controls.width(140).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
var tempDisabled=data.filter(function(d){return d.tempDisabled});wrap.select('.tempDisabled').remove();if(tempDisabled.length){wrap.append('text').attr('class','tempDisabled').attr('x',availableWidth/2).attr('y','-.71em').style('text-anchor','end').text(tempDisabled.map(function(d){return d.key}).join(', ')+' values cannot be calculated for this time period.');}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
gEnter.select('.nv-background').append('rect');g.select('.nv-background rect').attr('width',availableWidth).attr('height',availableHeight);lines.y(function(d){return d.display.y}).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&!data[i].tempDisabled;}));var linesWrap=g.select('.nv-linesWrap').datum(data.filter(function(d){return!d.disabled&&!d.tempDisabled}));linesWrap.call(lines);data.forEach(function(d,i){d.seriesIndex=i;});var avgLineData=data.filter(function(d){return!d.disabled&&!!average(d);});var avgLines=g.select(".nv-avgLinesWrap").selectAll("line").data(avgLineData,function(d){return d.key;});var getAvgLineY=function(d){var yVal=y(average(d));if(yVal<0)return 0;if(yVal>availableHeight)return availableHeight;return yVal;};avgLines.enter().append('line').style('stroke-width',2).style('stroke-dasharray','10,10').style('stroke',function(d,i){return lines.color()(d,d.seriesIndex);}).attr('x1',0).attr('x2',availableWidth).attr('y1',getAvgLineY).attr('y2',getAvgLineY);avgLines.style('stroke-opacity',function(d){var yVal=y(average(d));if(yVal<0||yVal>availableHeight)return 0;return 1;}).attr('x1',0).attr('x2',availableWidth).attr('y1',getAvgLineY).attr('y2',getAvgLineY);avgLines.exit().remove();var indexLine=linesWrap.selectAll('.nv-indexLine').data([index]);indexLine.enter().append('rect').attr('class','nv-indexLine').attr('width',3).attr('x',-2).attr('fill','red').attr('fill-opacity',.5).style("pointer-events","all").call(indexDrag)
indexLine.attr('transform',function(d){return'translate('+dx(d.i)+',0)'}).attr('height',availableHeight)
if(showXAxis){xAxis.scale(x).ticks(Math.min(data[0].values.length,availableWidth/70)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');d3.transition(g.select('.nv-x.nv-axis')).call(xAxis);}
if(showYAxis){yAxis.scale(y).ticks(availableHeight/36).tickSize(-availableWidth,0);d3.transition(g.select('.nv-y.nv-axis')).call(yAxis);}
function updateZero(){indexLine.data([index]);var oldDuration=chart.transitionDuration();chart.transitionDuration(0);chart.update();chart.transitionDuration(oldDuration);}
g.select('.nv-background rect').on('click',function(){index.x=d3.mouse(this)[0];index.i=Math.round(dx.invert(index.x));state.index=index.i;dispatch.stateChange(state);updateZero();});lines.dispatch.on('elementClick',function(e){index.i=e.pointIndex;index.x=dx(index.i);state.index=index.i;dispatch.stateChange(state);updateZero();});controls.dispatch.on('legendClick',function(d,i){d.disabled=!d.disabled;rescaleY=!d.disabled;state.rescaleY=rescaleY;dispatch.stateChange(state);chart.update();});legend.dispatch.on('stateChange',function(newState){state.disabled=newState.disabled;dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){lines.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());lines.highlightPoint(i,pointIndex,true);var point=series.values[pointIndex];if(typeof point==='undefined')return;if(typeof singlePoint==='undefined')singlePoint=point;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:chart.y()(point,pointIndex),color:color(series,series.seriesIndex)});});if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var domainExtent=Math.abs(chart.yScale().domain()[0]-chart.yScale().domain()[1]);var threshold=0.03*domainExtent;var indexToHighlight=nv.nearestValueIndex(allData.map(function(d){return d.value}),yValue,threshold);if(indexToHighlight!==null)
allData[indexToHighlight].highlight=true;}
var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex),pointIndex);interactiveLayer.tooltip.position({left:pointXLocation+margin.left,top:e.mouseY+margin.top}).chartContainer(that.parentNode).enabled(tooltips).valueFormatter(function(d,i){return yAxis.tickFormat()(d);}).data({value:xValue,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){dispatch.tooltipHide();lines.clearHighlights();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.index!=='undefined'){index.i=e.index;index.x=dx(index.i);state.index=e.index;indexLine.data([index]);}
if(typeof e.rescaleY!=='undefined'){rescaleY=e.rescaleY;}
chart.update();});});return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.lines=lines;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.interactiveLayer=interactiveLayer;d3.rebind(chart,lines,'defined','isArea','x','y','xScale','yScale','size','xDomain','yDomain','xRange','yRange','forceX','forceY','interactive','clipEdge','clipVoronoi','useVoronoi','id');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.rescaleY=function(_){if(!arguments.length)return rescaleY;rescaleY=_;return chart;};chart.showControls=function(_){if(!arguments.length)return showControls;showControls=_;return chart;};chart.useInteractiveGuideline=function(_){if(!arguments.length)return useInteractiveGuideline;useInteractiveGuideline=_;if(_===true){chart.interactive(false);chart.useVoronoi(false);}
return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.average=function(_){if(!arguments.length)return average;average=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};function indexify(idx,data){return data.map(function(line,i){if(!line.values){return line;}
var v=lines.y()(line.values[idx],idx);if(v<-.95){line.tempDisabled=true;return line;}
line.tempDisabled=false;line.values=line.values.map(function(point,pointIndex){point.display={'y':(lines.y()(point,pointIndex)-v)/(1+v)};return point;})
return line;})}
return chart;}
nv.models.discreteBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),x=d3.scale.ordinal(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],color=nv.utils.defaultColor(),showValues=false,valueFormat=d3.format(',.2f'),xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout'),rectClass='discreteBar';var x0,y0;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],.1);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return d.y}).concat(forceY)));if(showValues)y.range(yRange||[availableHeight-(y.domain()[0]<0?12:0),y.domain()[1]>0?12:0]);else y.range(yRange||[availableHeight,0]);x0=x0||x;y0=y0||y.copy().range([y(0),y(0)]);var wrap=container.selectAll('g.nv-wrap.nv-discretebar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discretebar');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().transition().style('stroke-opacity',1e-6).style('fill-opacity',1e-6).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover});groups.transition().style('stroke-opacity',1).style('fill-opacity',.75);var bars=groups.selectAll('g.nv-bar').data(function(d){return d.values});bars.exit().remove();var barsEnter=bars.enter().append('g').attr('transform',function(d,i,j){return'translate('+(x(getX(d,i))+x.rangeBand()*.05)+', '+y(0)+')'}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(d.series+.5)/data.length),y(getY(d,i))],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({value:getY(d,i),point:d,series:data[d.series],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('click',function(d,i){dispatch.elementClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(d.series+.5)/data.length),y(getY(d,i))],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(d.series+.5)/data.length),y(getY(d,i))],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();});barsEnter.append('rect').attr('height',0).attr('width',x.rangeBand()*.9/data.length)
if(showValues){barsEnter.append('text').attr('text-anchor','middle');bars.select('text').text(function(d,i){return valueFormat(getY(d,i))}).transition().attr('x',x.rangeBand()*.9/2).attr('y',function(d,i){return getY(d,i)<0?y(getY(d,i))-y(0)+12:-4});}else{bars.selectAll('text').remove();}
bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).style('fill',function(d,i){return d.color||color(d,i)}).style('stroke',function(d,i){return d.color||color(d,i)}).select('rect').attr('class',rectClass).transition().attr('width',x.rangeBand()*.9/data.length);bars.transition().attr('transform',function(d,i){var left=x(getX(d,i))+x.rangeBand()*.05,top=getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i));return'translate('+left+', '+top+')'}).select('rect').attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y((yDomain&&yDomain[0])||0))||1)});x0=x.copy();y0=y.copy();});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.xRange=function(_){if(!arguments.length)return xRange;xRange=_;return chart;};chart.yRange=function(_){if(!arguments.length)return yRange;yRange=_;return chart;};chart.forceY=function(_){if(!arguments.length)return forceY;forceY=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.showValues=function(_){if(!arguments.length)return showValues;showValues=_;return chart;};chart.valueFormat=function(_){if(!arguments.length)return valueFormat;valueFormat=_;return chart;};chart.rectClass=function(_){if(!arguments.length)return rectClass;rectClass=_;return chart;};return chart;}
nv.models.discreteBarChart=function(){"use strict";var discretebar=nv.models.discreteBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis();var margin={top:15,right:10,bottom:50,left:60},width=null,height=null,color=nv.utils.getColor(),showXAxis=true,showYAxis=true,rightAlignYAxis=false,staggerLabels=false,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+x+'</h3>'+'<p>'+y+'</p>'},x,y,noData="No Data Available.",dispatch=d3.dispatch('tooltipShow','tooltipHide','beforeUpdate'),transitionDuration=250;xAxis.orient('bottom').highlightZero(false).showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(discretebar.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(discretebar.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,e.value<0?'n':'s',null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){dispatch.beforeUpdate();container.transition().duration(transitionDuration).call(chart);};chart.container=this;if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=discretebar.xScale();y=discretebar.yScale().clamp(true);var wrap=container.selectAll('g.nv-wrap.nv-discreteBarWithAxes').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discreteBarWithAxes').append('g');var defsEnter=gEnter.append('defs');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');g.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
discretebar.width(availableWidth).height(availableHeight);var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}))
barsWrap.transition().call(discretebar);defsEnter.append('clipPath').attr('id','nv-x-label-clip-'+discretebar.id()).append('rect');g.select('#nv-x-label-clip-'+discretebar.id()+' rect').attr('width',x.rangeBand()*(staggerLabels?2:1)).attr('height',16).attr('x',-x.rangeBand()/(staggerLabels?1:2));if(showXAxis){xAxis.scale(x).ticks(availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+(y.range()[0]+((discretebar.showValues()&&y.domain()[0]<0)?16:0))+')');g.select('.nv-x.nv-axis').transition().call(xAxis);var xTicks=g.select('.nv-x.nv-axis').selectAll('g');if(staggerLabels){xTicks.selectAll('text').attr('transform',function(d,i,j){return'translate(0,'+(j%2==0?'5':'17')+')'})}}
if(showYAxis){yAxis.scale(y).ticks(availableHeight/36).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').transition().call(yAxis);}
dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});});return chart;}
discretebar.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});discretebar.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.discretebar=discretebar;chart.xAxis=xAxis;chart.yAxis=yAxis;d3.rebind(chart,discretebar,'x','y','xDomain','yDomain','xRange','yRange','forceX','forceY','id','showValues','valueFormat');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);discretebar.color(color);return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.staggerLabels=function(_){if(!arguments.length)return staggerLabels;staggerLabels=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.distribution=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=400,size=8,axis='x',getData=function(d){return d[axis]},color=nv.utils.defaultColor(),scale=d3.scale.linear(),domain;var scale0;function chart(selection){selection.each(function(data){var availableLength=width-(axis==='x'?margin.left+margin.right:margin.top+margin.bottom),naxis=axis=='x'?'y':'x',container=d3.select(this);scale0=scale0||scale;var wrap=container.selectAll('g.nv-distribution').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-distribution');var gEnter=wrapEnter.append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')')
var distWrap=g.selectAll('g.nv-dist').data(function(d){return d},function(d){return d.key});distWrap.enter().append('g');distWrap.attr('class',function(d,i){return'nv-dist nv-series-'+i}).style('stroke',function(d,i){return color(d,i)});var dist=distWrap.selectAll('line.nv-dist'+axis).data(function(d){return d.values})
dist.enter().append('line').attr(axis+'1',function(d,i){return scale0(getData(d,i))}).attr(axis+'2',function(d,i){return scale0(getData(d,i))})
distWrap.exit().selectAll('line.nv-dist'+axis).transition().attr(axis+'1',function(d,i){return scale(getData(d,i))}).attr(axis+'2',function(d,i){return scale(getData(d,i))}).style('stroke-opacity',0).remove();dist.attr('class',function(d,i){return'nv-dist'+axis+' nv-dist'+axis+'-'+i}).attr(naxis+'1',0).attr(naxis+'2',size);dist.transition().attr(axis+'1',function(d,i){return scale(getData(d,i))}).attr(axis+'2',function(d,i){return scale(getData(d,i))})
scale0=scale.copy();});return chart;}
chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.axis=function(_){if(!arguments.length)return axis;axis=_;return chart;};chart.size=function(_){if(!arguments.length)return size;size=_;return chart;};chart.getData=function(_){if(!arguments.length)return getData;getData=d3.functor(_);return chart;};chart.scale=function(_){if(!arguments.length)return scale;scale=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};return chart;}
nv.models.historicalBarChart=function(){"use strict";var bars=nv.models.historicalBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend();var margin={top:30,right:90,bottom:50,left:90},color=nv.utils.defaultColor(),width=null,height=null,showLegend=false,showXAxis=true,showYAxis=true,rightAlignYAxis=false,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' at '+x+'</p>'},x,y,state={},defaultState=null,noData='No Data Available.',dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),transitionDuration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient((rightAlignYAxis)?'right':'left');var showTooltip=function(e,offsetElement){if(offsetElement){var svg=d3.select(offsetElement).select('svg');var viewBox=(svg.node())?svg.attr('viewBox'):null;if(viewBox){viewBox=viewBox.split(' ');var ratio=parseInt(svg.style('width'))/viewBox[2];e.pos[0]=e.pos[0]*ratio;e.pos[1]=e.pos[1]*ratio;}}
var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(bars.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(bars.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,null,null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=bars.xScale();y=bars.yScale();var wrap=container.selectAll('g.nv-wrap.nv-historicalBarChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-historicalBarChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
bars.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}))
barsWrap.transition().call(bars);if(showXAxis){xAxis.scale(x).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').transition().call(xAxis);}
if(showYAxis){yAxis.scale(y).ticks(availableHeight/36).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').transition().call(yAxis);}
legend.dispatch.on('legendClick',function(d,i){d.disabled=!d.disabled;if(!data.filter(function(d){return!d.disabled}).length){data.map(function(d){d.disabled=false;wrap.selectAll('.nv-series').classed('disabled',false);return d;});}
state.disabled=data.map(function(d){return!!d.disabled});dispatch.stateChange(state);selection.transition().call(chart);});legend.dispatch.on('legendDblclick',function(d){data.forEach(function(d){d.disabled=true;});d.disabled=false;state.disabled=data.map(function(d){return!!d.disabled});dispatch.stateChange(state);chart.update();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
selection.call(chart);});});return chart;}
bars.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});bars.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.bars=bars;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;d3.rebind(chart,bars,'defined','isArea','x','y','size','xScale','yScale','xDomain','yDomain','xRange','yRange','forceX','forceY','interactive','clipEdge','clipVoronoi','id','interpolate','highlightPoint','clearHighlights','interactive');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.indentedTree=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,color=nv.utils.defaultColor(),id=Math.floor(Math.random()*10000),header=true,filterZero=false,noData="No Data Available.",childIndent=20,columns=[{key:'key',label:'Name',type:'text'}],tableClass=null,iconOpen='images/grey-plus.png',iconClose='images/grey-minus.png',dispatch=d3.dispatch('elementClick','elementDblclick','elementMouseover','elementMouseout'),getUrl=function(d){return d.url};var idx=0;function chart(selection){selection.each(function(data){var depth=1,container=d3.select(this);var tree=d3.layout.tree().children(function(d){return d.values}).size([height,childIndent]);chart.update=function(){container.transition().duration(600).call(chart)};if(!data[0])data[0]={key:noData};var nodes=tree.nodes(data[0]);var wrap=d3.select(this).selectAll('div').data([[nodes]]);var wrapEnter=wrap.enter().append('div').attr('class','nvd3 nv-wrap nv-indentedtree');var tableEnter=wrapEnter.append('table');var table=wrap.select('table').attr('width','100%').attr('class',tableClass);if(header){var thead=tableEnter.append('thead');var theadRow1=thead.append('tr');columns.forEach(function(column){theadRow1.append('th').attr('width',column.width?column.width:'10%').style('text-align',column.type=='numeric'?'right':'left').append('span').text(column.label);});}
var tbody=table.selectAll('tbody').data(function(d){return d});tbody.enter().append('tbody');depth=d3.max(nodes,function(node){return node.depth});tree.size([height,depth*childIndent]);var node=tbody.selectAll('tr').data(function(d){return d.filter(function(d){return(filterZero&&!d.children)?filterZero(d):true;})},function(d,i){return d.id||(d.id||++idx)});node.exit().remove();node.select('img.nv-treeicon').attr('src',icon).classed('folded',folded);var nodeEnter=node.enter().append('tr');columns.forEach(function(column,index){var nodeName=nodeEnter.append('td').style('padding-left',function(d){return(index?0:d.depth*childIndent+12+(icon(d)?0:16))+'px'},'important').style('text-align',column.type=='numeric'?'right':'left');if(index==0){nodeName.append('img').classed('nv-treeicon',true).classed('nv-folded',folded).attr('src',icon).style('width','14px').style('height','14px').style('padding','0 1px').style('display',function(d){return icon(d)?'inline-block':'none';}).on('click',click);}
nodeName.each(function(d){if(!index&&getUrl(d))
d3.select(this).append('a').attr('href',getUrl).attr('class',d3.functor(column.classes)).append('span')
else
d3.select(this).append('span')
d3.select(this).select('span').attr('class',d3.functor(column.classes)).text(function(d){return column.format?column.format(d):(d[column.key]||'-')});});if(column.showCount){nodeName.append('span').attr('class','nv-childrenCount');node.selectAll('span.nv-childrenCount').text(function(d){return((d.values&&d.values.length)||(d._values&&d._values.length))?'('+((d.values&&(d.values.filter(function(d){return filterZero?filterZero(d):true;}).length))||(d._values&&d._values.filter(function(d){return filterZero?filterZero(d):true;}).length)||0)+')':''});}});node.order().on('click',function(d){dispatch.elementClick({row:this,data:d,pos:[d.x,d.y]});}).on('dblclick',function(d){dispatch.elementDblclick({row:this,data:d,pos:[d.x,d.y]});}).on('mouseover',function(d){dispatch.elementMouseover({row:this,data:d,pos:[d.x,d.y]});}).on('mouseout',function(d){dispatch.elementMouseout({row:this,data:d,pos:[d.x,d.y]});});function click(d,_,unshift){d3.event.stopPropagation();if(d3.event.shiftKey&&!unshift){d3.event.shiftKey=false;d.values&&d.values.forEach(function(node){if(node.values||node._values){click(node,0,true);}});return true;}
if(!hasChildren(d)){return true;}
if(d.values){d._values=d.values;d.values=null;}else{d.values=d._values;d._values=null;}
chart.update();}
function icon(d){return(d._values&&d._values.length)?iconOpen:(d.values&&d.values.length)?iconClose:'';}
function folded(d){return(d._values&&d._values.length);}
function hasChildren(d){var values=d.values||d._values;return(values&&values.length);}});return chart;}
chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);scatter.color(color);return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.header=function(_){if(!arguments.length)return header;header=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.filterZero=function(_){if(!arguments.length)return filterZero;filterZero=_;return chart;};chart.columns=function(_){if(!arguments.length)return columns;columns=_;return chart;};chart.tableClass=function(_){if(!arguments.length)return tableClass;tableClass=_;return chart;};chart.iconOpen=function(_){if(!arguments.length)return iconOpen;iconOpen=_;return chart;}
chart.iconClose=function(_){if(!arguments.length)return iconClose;iconClose=_;return chart;}
chart.getUrl=function(_){if(!arguments.length)return getUrl;getUrl=_;return chart;}
return chart;};nv.models.legend=function(){"use strict";var margin={top:5,right:0,bottom:5,left:0},width=400,height=20,getKey=function(d){return d.key},color=nv.utils.defaultColor(),align=true,rightAlign=true,updateState=true,radioButtonMode=false,dispatch=d3.dispatch('legendClick','legendDblclick','legendMouseover','legendMouseout','stateChange');function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,container=d3.select(this);var wrap=container.selectAll('g.nv-legend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-legend').append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var series=g.selectAll('.nv-series').data(function(d){return d});var seriesEnter=series.enter().append('g').attr('class','nv-series').on('mouseover',function(d,i){dispatch.legendMouseover(d,i);}).on('mouseout',function(d,i){dispatch.legendMouseout(d,i);}).on('click',function(d,i){dispatch.legendClick(d,i);if(updateState){if(radioButtonMode){data.forEach(function(series){series.disabled=true});d.disabled=false;}
else{d.disabled=!d.disabled;if(data.every(function(series){return series.disabled})){data.forEach(function(series){series.disabled=false});}}
dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled})});}}).on('dblclick',function(d,i){dispatch.legendDblclick(d,i);if(updateState){data.forEach(function(series){series.disabled=true;});d.disabled=false;dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled})});}});seriesEnter.append('circle').style('stroke-width',2).attr('class','nv-legend-symbol').attr('r',5);seriesEnter.append('text').attr('text-anchor','start').attr('class','nv-legend-text').attr('dy','.32em').attr('dx','8');series.classed('disabled',function(d){return d.disabled});series.exit().remove();series.select('circle').style('fill',function(d,i){return d.color||color(d,i)}).style('stroke',function(d,i){return d.color||color(d,i)});series.select('text').text(getKey);if(align){var seriesWidths=[];series.each(function(d,i){var legendText=d3.select(this).select('text');var nodeTextLength;try{nodeTextLength=legendText.node().getComputedTextLength();}
catch(e){nodeTextLength=nv.utils.calcApproxTextWidth(legendText);}
seriesWidths.push(nodeTextLength+28);});var seriesPerRow=0;var legendWidth=0;var columnWidths=[];while(legendWidth<availableWidth&&seriesPerRow<seriesWidths.length){columnWidths[seriesPerRow]=seriesWidths[seriesPerRow];legendWidth+=seriesWidths[seriesPerRow++];}
if(seriesPerRow===0)seriesPerRow=1;while(legendWidth>availableWidth&&seriesPerRow>1){columnWidths=[];seriesPerRow--;for(var k=0;k<seriesWidths.length;k++){if(seriesWidths[k]>(columnWidths[k%seriesPerRow]||0))
columnWidths[k%seriesPerRow]=seriesWidths[k];}
legendWidth=columnWidths.reduce(function(prev,cur,index,array){return prev+cur;});}
var xPositions=[];for(var i=0,curX=0;i<seriesPerRow;i++){xPositions[i]=curX;curX+=columnWidths[i];}
series.attr('transform',function(d,i){return'translate('+xPositions[i%seriesPerRow]+','+(5+Math.floor(i/seriesPerRow)*20)+')';});if(rightAlign){g.attr('transform','translate('+(width-margin.right-legendWidth)+','+margin.top+')');}
else{g.attr('transform','translate(0'+','+margin.top+')');}
height=margin.top+margin.bottom+(Math.ceil(seriesWidths.length/seriesPerRow)*20);}else{var ypos=5,newxpos=5,maxwidth=0,xpos;series.attr('transform',function(d,i){var length=d3.select(this).select('text').node().getComputedTextLength()+28;xpos=newxpos;if(width<margin.left+margin.right+xpos+length){newxpos=xpos=5;ypos+=20;}
newxpos+=length;if(newxpos>maxwidth)maxwidth=newxpos;return'translate('+xpos+','+ypos+')';});g.attr('transform','translate('+(width-margin.right-maxwidth)+','+margin.top+')');height=margin.top+margin.bottom+ypos+15;}});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.key=function(_){if(!arguments.length)return getKey;getKey=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.align=function(_){if(!arguments.length)return align;align=_;return chart;};chart.rightAlign=function(_){if(!arguments.length)return rightAlign;rightAlign=_;return chart;};chart.updateState=function(_){if(!arguments.length)return updateState;updateState=_;return chart;};chart.radioButtonMode=function(_){if(!arguments.length)return radioButtonMode;radioButtonMode=_;return chart;};return chart;}
nv.models.line=function(){"use strict";var scatter=nv.models.scatter();var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,color=nv.utils.defaultColor(),getX=function(d){return d.x},getY=function(d){return d.y},defined=function(d,i){return!isNaN(getY(d,i))&&getY(d,i)!==null},isArea=function(d){return d.area},clipEdge=false,x,y,interpolate="linear";scatter.size(16).sizeDomain([16,256]);var x0,y0;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);x=scatter.xScale();y=scatter.yScale();x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-line').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-line');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g')
gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-scatterWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');scatter.width(availableWidth).height(availableHeight)
var scatterWrap=wrap.select('.nv-scatterWrap');scatterWrap.transition().call(scatter);defsEnter.append('clipPath').attr('id','nv-edge-clip-'+scatter.id()).append('rect');wrap.select('#nv-edge-clip-'+scatter.id()+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');scatterWrap.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().transition().style('stroke-opacity',1e-6).style('fill-opacity',1e-6).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.transition().style('stroke-opacity',1).style('fill-opacity',.5);var areaPaths=groups.selectAll('path.nv-area').data(function(d){return isArea(d)?[d]:[]});areaPaths.enter().append('path').attr('class','nv-area').attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}).y1(function(d,i){return y0(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});groups.exit().selectAll('path.nv-area').remove();areaPaths.transition().attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}).y1(function(d,i){return y(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});var linePaths=groups.selectAll('path.nv-line').data(function(d){return[d.values]});linePaths.enter().append('path').attr('class','nv-line').attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}));groups.exit().selectAll('path.nv-line').transition().attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}));linePaths.transition().attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}));x0=x.copy();y0=y.copy();});return chart;}
chart.dispatch=scatter.dispatch;chart.scatter=scatter;d3.rebind(chart,scatter,'id','interactive','size','xScale','yScale','zScale','xDomain','yDomain','xRange','yRange','sizeDomain','forceX','forceY','forceSize','clipVoronoi','useVoronoi','clipRadius','padData','highlightPoint','clearHighlights');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.x=function(_){if(!arguments.length)return getX;getX=_;scatter.x(_);return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;scatter.y(_);return chart;};chart.clipEdge=function(_){if(!arguments.length)return clipEdge;clipEdge=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);scatter.color(color);return chart;};chart.interpolate=function(_){if(!arguments.length)return interpolate;interpolate=_;return chart;};chart.defined=function(_){if(!arguments.length)return defined;defined=_;return chart;};chart.isArea=function(_){if(!arguments.length)return isArea;isArea=d3.functor(_);return chart;};return chart;}
nv.models.lineChart=function(){"use strict";var lines=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),interactiveLayer=nv.interactiveGuideline();var margin={top:30,right:20,bottom:50,left:60},color=nv.utils.defaultColor(),width=null,height=null,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,useInteractiveGuideline=false,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' at '+x+'</p>'},x,y,state={},defaultState=null,noData='No Data Available.',dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),transitionDuration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient((rightAlignYAxis)?'right':'left');var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(lines.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(lines.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,null,null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();var wrap=container.selectAll('g.nv-wrap.nv-lineChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-lineChart').append('g');var g=wrap.select('g');gEnter.append("rect").style("opacity",0);gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-linesWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-interactive');g.select("rect").attr("width",availableWidth).attr("height",availableHeight);if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
lines.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var linesWrap=g.select('.nv-linesWrap').datum(data.filter(function(d){return!d.disabled}))
linesWrap.transition().call(lines);if(showXAxis){xAxis.scale(x).ticks(availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').transition().call(xAxis);}
if(showYAxis){yAxis.scale(y).ticks(availableHeight/36).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').transition().call(yAxis);}
legend.dispatch.on('stateChange',function(newState){state=newState;dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){lines.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());lines.highlightPoint(i,pointIndex,true);var point=series.values[pointIndex];if(typeof point==='undefined')return;if(typeof singlePoint==='undefined')singlePoint=point;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:chart.y()(point,pointIndex),color:color(series,series.seriesIndex)});});if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var domainExtent=Math.abs(chart.yScale().domain()[0]-chart.yScale().domain()[1]);var threshold=0.03*domainExtent;var indexToHighlight=nv.nearestValueIndex(allData.map(function(d){return d.value}),yValue,threshold);if(indexToHighlight!==null)
allData[indexToHighlight].highlight=true;}
var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex));interactiveLayer.tooltip.position({left:pointXLocation+margin.left,top:e.mouseY+margin.top}).chartContainer(that.parentNode).enabled(tooltips).valueFormatter(function(d,i){return yAxis.tickFormat()(d);}).data({value:xValue,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){dispatch.tooltipHide();lines.clearHighlights();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.lines=lines;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.interactiveLayer=interactiveLayer;d3.rebind(chart,lines,'defined','isArea','x','y','size','xScale','yScale','xDomain','yDomain','xRange','yRange','forceX','forceY','interactive','clipEdge','clipVoronoi','useVoronoi','id','interpolate');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.useInteractiveGuideline=function(_){if(!arguments.length)return useInteractiveGuideline;useInteractiveGuideline=_;if(_===true){chart.interactive(false);chart.useVoronoi(false);}
return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.linePlusBarChart=function(){"use strict";var lines=nv.models.line(),bars=nv.models.historicalBar(),xAxis=nv.models.axis(),y1Axis=nv.models.axis(),y2Axis=nv.models.axis(),legend=nv.models.legend();var margin={top:30,right:60,bottom:50,left:60},width=null,height=null,getX=function(d){return d.x},getY=function(d){return d.y},color=nv.utils.defaultColor(),showLegend=true,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' at '+x+'</p>';},x,y1,y2,state={},defaultState=null,noData="No Data Available.",dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState');bars.padData(true);lines.clipEdge(false).padData(true);xAxis.orient('bottom').tickPadding(7).highlightZero(false);y1Axis.orient('left');y2Axis.orient('right');var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(lines.x()(e.point,e.pointIndex)),y=(e.series.bar?y1Axis:y2Axis).tickFormat()(lines.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,e.value<0?'n':'s',null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().call(chart);};state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
var dataBars=data.filter(function(d){return!d.disabled&&d.bar});var dataLines=data.filter(function(d){return!d.bar});x=dataLines.filter(function(d){return!d.disabled;}).length&&dataLines.filter(function(d){return!d.disabled;})[0].values.length?lines.xScale():bars.xScale();y1=bars.yScale();y2=lines.yScale();var wrap=d3.select(this).selectAll('g.nv-wrap.nv-linePlusBar').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-linePlusBar').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y1 nv-axis');gEnter.append('g').attr('class','nv-y2 nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-linesWrap');gEnter.append('g').attr('class','nv-legendWrap');if(showLegend){legend.width(availableWidth/2);g.select('.nv-legendWrap').datum(data.map(function(series){series.originalKey=series.originalKey===undefined?series.key:series.originalKey;series.key=series.originalKey+(series.bar?' (left axis)':' (right axis)');return series;})).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
g.select('.nv-legendWrap').attr('transform','translate('+(availableWidth/2)+','+(-margin.top)+')');}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');lines.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&!data[i].bar}))
bars.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&data[i].bar}))
var barsWrap=g.select('.nv-barsWrap').datum(dataBars.length?dataBars:[{values:[]}])
var linesWrap=g.select('.nv-linesWrap').datum(dataLines[0]&&!dataLines[0].disabled?dataLines:[{values:[]}]);d3.transition(barsWrap).call(bars);d3.transition(linesWrap).call(lines);xAxis.scale(x).ticks(availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y1.range()[0]+')');d3.transition(g.select('.nv-x.nv-axis')).call(xAxis);y1Axis.scale(y1).ticks(availableHeight/36).tickSize(-availableWidth,0);d3.transition(g.select('.nv-y1.nv-axis')).style('opacity',dataBars.length?1:0).call(y1Axis);y2Axis.scale(y2).ticks(availableHeight/36).tickSize(dataBars.length?0:-availableWidth,0);g.select('.nv-y2.nv-axis').style('opacity',dataLines.length?1:0).attr('transform','translate('+availableWidth+',0)');d3.transition(g.select('.nv-y2.nv-axis')).call(y2Axis);legend.dispatch.on('stateChange',function(newState){state=newState;dispatch.stateChange(state);chart.update();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});bars.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});bars.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.legend=legend;chart.lines=lines;chart.bars=bars;chart.xAxis=xAxis;chart.y1Axis=y1Axis;chart.y2Axis=y2Axis;d3.rebind(chart,lines,'defined','size','clipVoronoi','interpolate');chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;lines.x(_);bars.x(_);return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;lines.y(_);bars.y(_);return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};return chart;}
nv.models.lineWithFocusChart=function(){"use strict";var lines=nv.models.line(),lines2=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),x2Axis=nv.models.axis(),y2Axis=nv.models.axis(),legend=nv.models.legend(),brush=d3.svg.brush();var margin={top:30,right:30,bottom:30,left:60},margin2={top:0,right:30,bottom:20,left:60},color=nv.utils.defaultColor(),width=null,height=null,height2=100,x,y,x2,y2,showLegend=true,brushExtent=null,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' at '+x+'</p>'},noData="No Data Available.",dispatch=d3.dispatch('tooltipShow','tooltipHide','brush'),transitionDuration=250;lines.clipEdge(true);lines2.interactive(false);xAxis.orient('bottom').tickPadding(5);yAxis.orient('left');x2Axis.orient('bottom').tickPadding(5);y2Axis.orient('left');var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(lines.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(lines.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,null,null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight1=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom-height2,availableHeight2=height2-margin2.top-margin2.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight1/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();x2=lines2.xScale();y2=lines2.yScale();var wrap=container.selectAll('g.nv-wrap.nv-lineWithFocusChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-lineWithFocusChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-legendWrap');var focusEnter=gEnter.append('g').attr('class','nv-focus');focusEnter.append('g').attr('class','nv-x nv-axis');focusEnter.append('g').attr('class','nv-y nv-axis');focusEnter.append('g').attr('class','nv-linesWrap');var contextEnter=gEnter.append('g').attr('class','nv-context');contextEnter.append('g').attr('class','nv-x nv-axis');contextEnter.append('g').attr('class','nv-y nv-axis');contextEnter.append('g').attr('class','nv-linesWrap');contextEnter.append('g').attr('class','nv-brushBackground');contextEnter.append('g').attr('class','nv-x nv-brush');if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight1=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom-height2;}
g.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');lines.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));lines2.defined(lines.defined()).width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));g.select('.nv-context').attr('transform','translate(0,'+(availableHeight1+margin.bottom+margin2.top)+')')
var contextLinesWrap=g.select('.nv-context .nv-linesWrap').datum(data.filter(function(d){return!d.disabled}))
d3.transition(contextLinesWrap).call(lines2);xAxis.scale(x).ticks(availableWidth/100).tickSize(-availableHeight1,0);yAxis.scale(y).ticks(availableHeight1/36).tickSize(-availableWidth,0);g.select('.nv-focus .nv-x.nv-axis').attr('transform','translate(0,'+availableHeight1+')');brush.x(x2).on('brush',function(){var oldTransition=chart.transitionDuration();chart.transitionDuration(0);onBrush();chart.transitionDuration(oldTransition);});if(brushExtent)brush.extent(brushExtent);var brushBG=g.select('.nv-brushBackground').selectAll('g').data([brushExtent||brush.extent()])
var brushBGenter=brushBG.enter().append('g');brushBGenter.append('rect').attr('class','left').attr('x',0).attr('y',0).attr('height',availableHeight2);brushBGenter.append('rect').attr('class','right').attr('x',0).attr('y',0).attr('height',availableHeight2);var gBrush=g.select('.nv-x.nv-brush').call(brush);gBrush.selectAll('rect').attr('height',availableHeight2);gBrush.selectAll('.resize').append('path').attr('d',resizePath);onBrush();x2Axis.scale(x2).ticks(availableWidth/100).tickSize(-availableHeight2,0);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');d3.transition(g.select('.nv-context .nv-x.nv-axis')).call(x2Axis);y2Axis.scale(y2).ticks(availableHeight2/36).tickSize(-availableWidth,0);d3.transition(g.select('.nv-context .nv-y.nv-axis')).call(y2Axis);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');legend.dispatch.on('stateChange',function(newState){chart.update();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});function resizePath(d){var e=+(d=='e'),x=e?1:-1,y=availableHeight2/3;return'M'+(.5*x)+','+y
+'A6,6 0 0 '+e+' '+(6.5*x)+','+(y+6)
+'V'+(2*y-6)
+'A6,6 0 0 '+e+' '+(.5*x)+','+(2*y)
+'Z'
+'M'+(2.5*x)+','+(y+8)
+'V'+(2*y-8)
+'M'+(4.5*x)+','+(y+8)
+'V'+(2*y-8);}
function updateBrushBG(){if(!brush.empty())brush.extent(brushExtent);brushBG.data([brush.empty()?x2.domain():brushExtent]).each(function(d,i){var leftWidth=x2(d[0])-x.range()[0],rightWidth=x.range()[1]-x2(d[1]);d3.select(this).select('.left').attr('width',leftWidth<0?0:leftWidth);d3.select(this).select('.right').attr('x',x2(d[1])).attr('width',rightWidth<0?0:rightWidth);});}
function onBrush(){brushExtent=brush.empty()?null:brush.extent();var extent=brush.empty()?x2.domain():brush.extent();if(Math.abs(extent[0]-extent[1])<=1){return;}
dispatch.brush({extent:extent,brush:brush});updateBrushBG();var focusLinesWrap=g.select('.nv-focus .nv-linesWrap').datum(data.filter(function(d){return!d.disabled}).map(function(d,i){return{key:d.key,values:d.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];})}}));focusLinesWrap.transition().duration(transitionDuration).call(lines);g.select('.nv-focus .nv-x.nv-axis').transition().duration(transitionDuration).call(xAxis);g.select('.nv-focus .nv-y.nv-axis').transition().duration(transitionDuration).call(yAxis);}});return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.legend=legend;chart.lines=lines;chart.lines2=lines2;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.x2Axis=x2Axis;chart.y2Axis=y2Axis;d3.rebind(chart,lines,'defined','isArea','size','xDomain','yDomain','xRange','yRange','forceX','forceY','interactive','clipEdge','clipVoronoi','id');chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return lines.x;lines.x(_);lines2.x(_);return chart;};chart.y=function(_){if(!arguments.length)return lines.y;lines.y(_);lines2.y(_);return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.margin2=function(_){if(!arguments.length)return margin2;margin2=_;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.height2=function(_){if(!arguments.length)return height2;height2=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.interpolate=function(_){if(!arguments.length)return lines.interpolate();lines.interpolate(_);lines2.interpolate(_);return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.xTickFormat=function(_){if(!arguments.length)return xAxis.tickFormat();xAxis.tickFormat(_);x2Axis.tickFormat(_);return chart;};chart.yTickFormat=function(_){if(!arguments.length)return yAxis.tickFormat();yAxis.tickFormat(_);y2Axis.tickFormat(_);return chart;};chart.brushExtent=function(_){if(!arguments.length)return brushExtent;brushExtent=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.linePlusBarWithFocusChart=function(){"use strict";var lines=nv.models.line(),lines2=nv.models.line(),bars=nv.models.historicalBar(),bars2=nv.models.historicalBar(),xAxis=nv.models.axis(),x2Axis=nv.models.axis(),y1Axis=nv.models.axis(),y2Axis=nv.models.axis(),y3Axis=nv.models.axis(),y4Axis=nv.models.axis(),legend=nv.models.legend(),brush=d3.svg.brush();var margin={top:30,right:30,bottom:30,left:60},margin2={top:0,right:30,bottom:20,left:60},width=null,height=null,height2=100,getX=function(d){return d.x},getY=function(d){return d.y},color=nv.utils.defaultColor(),showLegend=true,extent,brushExtent=null,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' at '+x+'</p>';},x,x2,y1,y2,y3,y4,noData="No Data Available.",dispatch=d3.dispatch('tooltipShow','tooltipHide','brush'),transitionDuration=0;lines.clipEdge(true);lines2.interactive(false);xAxis.orient('bottom').tickPadding(5);y1Axis.orient('left');y2Axis.orient('right');x2Axis.orient('bottom').tickPadding(5);y3Axis.orient('left');y4Axis.orient('right');var showTooltip=function(e,offsetElement){if(extent){e.pointIndex+=Math.ceil(extent[0]);}
var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(lines.x()(e.point,e.pointIndex)),y=(e.series.bar?y1Axis:y2Axis).tickFormat()(lines.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,e.value<0?'n':'s',null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight1=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom-height2,availableHeight2=height2-margin2.top-margin2.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart);};chart.container=this;if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight1/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
var dataBars=data.filter(function(d){return!d.disabled&&d.bar});var dataLines=data.filter(function(d){return!d.bar});x=bars.xScale();x2=x2Axis.scale();y1=bars.yScale();y2=lines.yScale();y3=bars2.yScale();y4=lines2.yScale();var series1=data.filter(function(d){return!d.disabled&&d.bar}).map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i)}})});var series2=data.filter(function(d){return!d.disabled&&!d.bar}).map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i)}})});x.range([0,availableWidth]);x2.domain(d3.extent(d3.merge(series1.concat(series2)),function(d){return d.x})).range([0,availableWidth]);var wrap=container.selectAll('g.nv-wrap.nv-linePlusBar').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-linePlusBar').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-legendWrap');var focusEnter=gEnter.append('g').attr('class','nv-focus');focusEnter.append('g').attr('class','nv-x nv-axis');focusEnter.append('g').attr('class','nv-y1 nv-axis');focusEnter.append('g').attr('class','nv-y2 nv-axis');focusEnter.append('g').attr('class','nv-barsWrap');focusEnter.append('g').attr('class','nv-linesWrap');var contextEnter=gEnter.append('g').attr('class','nv-context');contextEnter.append('g').attr('class','nv-x nv-axis');contextEnter.append('g').attr('class','nv-y1 nv-axis');contextEnter.append('g').attr('class','nv-y2 nv-axis');contextEnter.append('g').attr('class','nv-barsWrap');contextEnter.append('g').attr('class','nv-linesWrap');contextEnter.append('g').attr('class','nv-brushBackground');contextEnter.append('g').attr('class','nv-x nv-brush');if(showLegend){legend.width(availableWidth/2);g.select('.nv-legendWrap').datum(data.map(function(series){series.originalKey=series.originalKey===undefined?series.key:series.originalKey;series.key=series.originalKey+(series.bar?' (left axis)':' (right axis)');return series;})).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight1=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom-height2;}
g.select('.nv-legendWrap').attr('transform','translate('+(availableWidth/2)+','+(-margin.top)+')');}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');bars2.width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&data[i].bar}));lines2.width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&!data[i].bar}));var bars2Wrap=g.select('.nv-context .nv-barsWrap').datum(dataBars.length?dataBars:[{values:[]}]);var lines2Wrap=g.select('.nv-context .nv-linesWrap').datum(!dataLines[0].disabled?dataLines:[{values:[]}]);g.select('.nv-context').attr('transform','translate(0,'+(availableHeight1+margin.bottom+margin2.top)+')')
bars2Wrap.transition().call(bars2);lines2Wrap.transition().call(lines2);brush.x(x2).on('brush',onBrush);if(brushExtent)brush.extent(brushExtent);var brushBG=g.select('.nv-brushBackground').selectAll('g').data([brushExtent||brush.extent()])
var brushBGenter=brushBG.enter().append('g');brushBGenter.append('rect').attr('class','left').attr('x',0).attr('y',0).attr('height',availableHeight2);brushBGenter.append('rect').attr('class','right').attr('x',0).attr('y',0).attr('height',availableHeight2);var gBrush=g.select('.nv-x.nv-brush').call(brush);gBrush.selectAll('rect').attr('height',availableHeight2);gBrush.selectAll('.resize').append('path').attr('d',resizePath);x2Axis.ticks(availableWidth/100).tickSize(-availableHeight2,0);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y3.range()[0]+')');g.select('.nv-context .nv-x.nv-axis').transition().call(x2Axis);y3Axis.scale(y3).ticks(availableHeight2/36).tickSize(-availableWidth,0);g.select('.nv-context .nv-y1.nv-axis').style('opacity',dataBars.length?1:0).attr('transform','translate(0,'+x2.range()[0]+')');g.select('.nv-context .nv-y1.nv-axis').transition().call(y3Axis);y4Axis.scale(y4).ticks(availableHeight2/36).tickSize(dataBars.length?0:-availableWidth,0);g.select('.nv-context .nv-y2.nv-axis').style('opacity',dataLines.length?1:0).attr('transform','translate('+x2.range()[1]+',0)');g.select('.nv-context .nv-y2.nv-axis').transition().call(y4Axis);legend.dispatch.on('stateChange',function(newState){chart.update();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});function resizePath(d){var e=+(d=='e'),x=e?1:-1,y=availableHeight2/3;return'M'+(.5*x)+','+y
+'A6,6 0 0 '+e+' '+(6.5*x)+','+(y+6)
+'V'+(2*y-6)
+'A6,6 0 0 '+e+' '+(.5*x)+','+(2*y)
+'Z'
+'M'+(2.5*x)+','+(y+8)
+'V'+(2*y-8)
+'M'+(4.5*x)+','+(y+8)
+'V'+(2*y-8);}
function updateBrushBG(){if(!brush.empty())brush.extent(brushExtent);brushBG.data([brush.empty()?x2.domain():brushExtent]).each(function(d,i){var leftWidth=x2(d[0])-x2.range()[0],rightWidth=x2.range()[1]-x2(d[1]);d3.select(this).select('.left').attr('width',leftWidth<0?0:leftWidth);d3.select(this).select('.right').attr('x',x2(d[1])).attr('width',rightWidth<0?0:rightWidth);});}
function onBrush(){brushExtent=brush.empty()?null:brush.extent();extent=brush.empty()?x2.domain():brush.extent();dispatch.brush({extent:extent,brush:brush});updateBrushBG();bars.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&data[i].bar}));lines.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&!data[i].bar}));var focusBarsWrap=g.select('.nv-focus .nv-barsWrap').datum(!dataBars.length?[{values:[]}]:dataBars.map(function(d,i){return{key:d.key,values:d.values.filter(function(d,i){return bars.x()(d,i)>=extent[0]&&bars.x()(d,i)<=extent[1];})}}));var focusLinesWrap=g.select('.nv-focus .nv-linesWrap').datum(dataLines[0].disabled?[{values:[]}]:dataLines.map(function(d,i){return{key:d.key,values:d.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];})}}));if(dataBars.length){x=bars.xScale();}else{x=lines.xScale();}
xAxis.scale(x).ticks(availableWidth/100).tickSize(-availableHeight1,0);xAxis.domain([Math.ceil(extent[0]),Math.floor(extent[1])]);g.select('.nv-x.nv-axis').transition().duration(transitionDuration).call(xAxis);focusBarsWrap.transition().duration(transitionDuration).call(bars);focusLinesWrap.transition().duration(transitionDuration).call(lines);g.select('.nv-focus .nv-x.nv-axis').attr('transform','translate(0,'+y1.range()[0]+')');y1Axis.scale(y1).ticks(availableHeight1/36).tickSize(-availableWidth,0);g.select('.nv-focus .nv-y1.nv-axis').style('opacity',dataBars.length?1:0);y2Axis.scale(y2).ticks(availableHeight1/36).tickSize(dataBars.length?0:-availableWidth,0);g.select('.nv-focus .nv-y2.nv-axis').style('opacity',dataLines.length?1:0).attr('transform','translate('+x.range()[1]+',0)');g.select('.nv-focus .nv-y1.nv-axis').transition().duration(transitionDuration).call(y1Axis);g.select('.nv-focus .nv-y2.nv-axis').transition().duration(transitionDuration).call(y2Axis);}
onBrush();});return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});bars.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});bars.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.legend=legend;chart.lines=lines;chart.lines2=lines2;chart.bars=bars;chart.bars2=bars2;chart.xAxis=xAxis;chart.x2Axis=x2Axis;chart.y1Axis=y1Axis;chart.y2Axis=y2Axis;chart.y3Axis=y3Axis;chart.y4Axis=y4Axis;d3.rebind(chart,lines,'defined','size','clipVoronoi','interpolate');chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;lines.x(_);bars.x(_);return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;lines.y(_);bars.y(_);return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.brushExtent=function(_){if(!arguments.length)return brushExtent;brushExtent=_;return chart;};return chart;}
nv.models.multiBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,x=d3.scale.ordinal(),y=d3.scale.linear(),id=Math.floor(Math.random()*10000),getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],clipEdge=true,stacked=false,stackOffset='zero',color=nv.utils.defaultColor(),hideable=false,barColor=null,disabled,delay=1200,xDomain,yDomain,xRange,yRange,groupSpacing=0.1,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout');var x0,y0;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);if(hideable&&data.length)hideable=[{values:data[0].values.map(function(d){return{x:d.x,y:0,series:d.series,size:0.01};})}];if(stacked)
data=d3.layout.stack().offset(stackOffset).values(function(d){return d.values}).y(getY)
(!data.length&&hideable?hideable:data);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});if(stacked)
data[0].values.map(function(d,i){var posBase=0,negBase=0;data.map(function(d){var f=d.values[i]
f.size=Math.abs(f.y);if(f.y<0){f.y1=negBase;negBase=negBase-f.size;}else
{f.y1=f.size+posBase;posBase=posBase+f.size;}});});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0,y1:d.y1}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],groupSpacing);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return stacked?(d.y>0?d.y1:d.y1+d.y):d.y}).concat(forceY))).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-multibar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multibar');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g')
gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d,i){return i});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().transition().selectAll('rect.nv-bar').delay(function(d,i){return i*delay/data[0].values.length;}).attr('y',function(d){return stacked?y0(d.y0):y0(0)}).attr('height',0).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.transition().style('stroke-opacity',1).style('fill-opacity',.75);var bars=groups.selectAll('rect.nv-bar').data(function(d){return(hideable&&!data.length)?hideable.values:d.values});bars.exit().remove();var barsEnter=bars.enter().append('rect').attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).attr('x',function(d,i,j){return stacked?0:(j*x.rangeBand()/data.length)}).attr('y',function(d){return y0(stacked?d.y0:0)}).attr('height',0).attr('width',x.rangeBand()/(stacked?1:data.length)).attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';});bars.style('fill',function(d,i,j){return color(d,j,i);}).style('stroke',function(d,i,j){return color(d,j,i);}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(stacked?data.length/2:d.series+.5)/data.length),y(getY(d,i)+(stacked?d.y0:0))],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({value:getY(d,i),point:d,series:data[d.series],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('click',function(d,i){dispatch.elementClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(stacked?data.length/2:d.series+.5)/data.length),y(getY(d,i)+(stacked?d.y0:0))],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(stacked?data.length/2:d.series+.5)/data.length),y(getY(d,i)+(stacked?d.y0:0))],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();});bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).transition().attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';})
if(barColor){if(!disabled)disabled=data.map(function(){return true});bars.style('fill',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();}).style('stroke',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();});}
if(stacked)
bars.transition().delay(function(d,i){return i*delay/data[0].values.length;}).attr('y',function(d,i){return y((stacked?d.y1:0));}).attr('height',function(d,i){return Math.max(Math.abs(y(d.y+(stacked?d.y0:0))-y((stacked?d.y0:0))),1);}).attr('x',function(d,i){return stacked?0:(d.series*x.rangeBand()/data.length)}).attr('width',x.rangeBand()/(stacked?1:data.length));else
bars.transition().delay(function(d,i){return i*delay/data[0].values.length;}).attr('x',function(d,i){return d.series*x.rangeBand()/data.length}).attr('width',x.rangeBand()/data.length).attr('y',function(d,i){return getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i))||0;}).attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)||0;});x0=x.copy();y0=y.copy();});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.xRange=function(_){if(!arguments.length)return xRange;xRange=_;return chart;};chart.yRange=function(_){if(!arguments.length)return yRange;yRange=_;return chart;};chart.forceY=function(_){if(!arguments.length)return forceY;forceY=_;return chart;};chart.stacked=function(_){if(!arguments.length)return stacked;stacked=_;return chart;};chart.stackOffset=function(_){if(!arguments.length)return stackOffset;stackOffset=_;return chart;};chart.clipEdge=function(_){if(!arguments.length)return clipEdge;clipEdge=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.barColor=function(_){if(!arguments.length)return barColor;barColor=nv.utils.getColor(_);return chart;};chart.disabled=function(_){if(!arguments.length)return disabled;disabled=_;return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.hideable=function(_){if(!arguments.length)return hideable;hideable=_;return chart;};chart.delay=function(_){if(!arguments.length)return delay;delay=_;return chart;};chart.groupSpacing=function(_){if(!arguments.length)return groupSpacing;groupSpacing=_;return chart;};return chart;}
nv.models.multiBarChart=function(){"use strict";var multibar=nv.models.multiBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend();var margin={top:30,right:20,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,reduceXTicks=true,staggerLabels=false,rotateLabels=0,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' on '+x+'</p>'},x,y,state={stacked:false},defaultState=null,noData="No Data Available.",dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),controlWidth=function(){return showControls?180:0},transitionDuration=250;multibar.stacked(false);xAxis.orient('bottom').tickPadding(7).highlightZero(true).showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));controls.updateState(false);var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(multibar.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(multibar.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,e.value<0?'n':'s',null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=multibar.xScale();y=multibar.yScale();var wrap=container.selectAll('g.nv-wrap.nv-multiBarWithLegend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multiBarWithLegend').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');if(showLegend){legend.width(availableWidth-controlWidth());if(multibar.barColor())
data.forEach(function(series,i){series.color=d3.rgb('#ccc').darker(i*1.5).toString();})
g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
g.select('.nv-legendWrap').attr('transform','translate('+controlWidth()+','+(-margin.top)+')');}
if(showControls){var controlsData=[{key:'Grouped',disabled:multibar.stacked()},{key:'Stacked',disabled:!multibar.stacked()}];controls.width(controlWidth()).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
multibar.disabled(data.map(function(series){return series.disabled})).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}))
var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}))
barsWrap.transition().call(multibar);if(showXAxis){xAxis.scale(x).ticks(availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').transition().call(xAxis);var xTicks=g.select('.nv-x.nv-axis > g').selectAll('g');xTicks.selectAll('line, text').style('opacity',1)
if(staggerLabels){var getTranslate=function(x,y){return"translate("+x+","+y+")";};var staggerUp=5,staggerDown=17;xTicks.selectAll("text").attr('transform',function(d,i,j){return getTranslate(0,(j%2==0?staggerUp:staggerDown));});var totalInBetweenTicks=d3.selectAll(".nv-x.nv-axis .nv-wrap g g text")[0].length;g.selectAll(".nv-x.nv-axis .nv-axisMaxMin text").attr("transform",function(d,i){return getTranslate(0,(i===0||totalInBetweenTicks%2!==0)?staggerDown:staggerUp);});}
if(reduceXTicks)
xTicks.filter(function(d,i){return i%Math.ceil(data[0].values.length/(availableWidth/100))!==0;}).selectAll('text, line').style('opacity',0);if(rotateLabels)
xTicks.selectAll('.tick text').attr('transform','rotate('+rotateLabels+' 0,0)').style('text-anchor',rotateLabels>0?'start':'end');g.select('.nv-x.nv-axis').selectAll('g.nv-axisMaxMin text').style('opacity',1);}
if(showYAxis){yAxis.scale(y).ticks(availableHeight/36).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').transition().call(yAxis);}
legend.dispatch.on('stateChange',function(newState){state=newState;dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;switch(d.key){case'Grouped':multibar.stacked(false);break;case'Stacked':multibar.stacked(true);break;}
state.stacked=multibar.stacked();dispatch.stateChange(state);chart.update();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode)});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.stacked!=='undefined'){multibar.stacked(e.stacked);state.stacked=e.stacked;}
chart.update();});});return chart;}
multibar.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});multibar.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.multibar=multibar;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;d3.rebind(chart,multibar,'x','y','xDomain','yDomain','xRange','yRange','forceX','forceY','clipEdge','id','stacked','stackOffset','delay','barColor','groupSpacing');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.showControls=function(_){if(!arguments.length)return showControls;showControls=_;return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.reduceXTicks=function(_){if(!arguments.length)return reduceXTicks;reduceXTicks=_;return chart;};chart.rotateLabels=function(_){if(!arguments.length)return rotateLabels;rotateLabels=_;return chart;}
chart.staggerLabels=function(_){if(!arguments.length)return staggerLabels;staggerLabels=_;return chart;};chart.tooltip=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.multiBarHorizontal=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),x=d3.scale.ordinal(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],color=nv.utils.defaultColor(),barColor=null,disabled,stacked=false,showValues=false,valuePadding=60,valueFormat=d3.format(',.2f'),delay=1200,xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout');var x0,y0;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);if(stacked)
data=d3.layout.stack().offset('zero').values(function(d){return d.values}).y(getY)
(data);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});if(stacked)
data[0].values.map(function(d,i){var posBase=0,negBase=0;data.map(function(d){var f=d.values[i]
f.size=Math.abs(f.y);if(f.y<0){f.y1=negBase-f.size;negBase=negBase-f.size;}else
{f.y1=posBase;posBase=posBase+f.size;}});});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0,y1:d.y1}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableHeight],.1);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return stacked?(d.y>0?d.y1+d.y:d.y1):d.y}).concat(forceY)))
if(showValues&&!stacked)
y.range(yRange||[(y.domain()[0]<0?valuePadding:0),availableWidth-(y.domain()[1]>0?valuePadding:0)]);else
y.range(yRange||[0,availableWidth]);x0=x0||x;y0=y0||d3.scale.linear().domain(y.domain()).range([y(0),y(0)]);var wrap=d3.select(this).selectAll('g.nv-wrap.nv-multibarHorizontal').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multibarHorizontal');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d,i){return i});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().transition().style('stroke-opacity',1e-6).style('fill-opacity',1e-6).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.transition().style('stroke-opacity',1).style('fill-opacity',.75);var bars=groups.selectAll('g.nv-bar').data(function(d){return d.values});bars.exit().remove();var barsEnter=bars.enter().append('g').attr('transform',function(d,i,j){return'translate('+y0(stacked?d.y0:0)+','+(stacked?0:(j*x.rangeBand()/data.length)+x(getX(d,i)))+')'});barsEnter.append('rect').attr('width',0).attr('height',x.rangeBand()/(stacked?1:data.length))
bars.on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({value:getY(d,i),point:d,series:data[d.series],pos:[y(getY(d,i)+(stacked?d.y0:0)),x(getX(d,i))+(x.rangeBand()*(stacked?data.length/2:d.series+.5)/data.length)],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({value:getY(d,i),point:d,series:data[d.series],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('click',function(d,i){dispatch.elementClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(stacked?data.length/2:d.series+.5)/data.length),y(getY(d,i)+(stacked?d.y0:0))],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(stacked?data.length/2:d.series+.5)/data.length),y(getY(d,i)+(stacked?d.y0:0))],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();});barsEnter.append('text');if(showValues&&!stacked){bars.select('text').attr('text-anchor',function(d,i){return getY(d,i)<0?'end':'start'}).attr('y',x.rangeBand()/(data.length*2)).attr('dy','.32em').text(function(d,i){return valueFormat(getY(d,i))})
bars.transition().select('text').attr('x',function(d,i){return getY(d,i)<0?-4:y(getY(d,i))-y(0)+4})}else{bars.selectAll('text').text('');}
bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'})
if(barColor){if(!disabled)disabled=data.map(function(){return true});bars.style('fill',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();}).style('stroke',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();});}
if(stacked)
bars.transition().attr('transform',function(d,i){return'translate('+y(d.y1)+','+x(getX(d,i))+')'}).select('rect').attr('width',function(d,i){return Math.abs(y(getY(d,i)+d.y0)-y(d.y0))}).attr('height',x.rangeBand());else
bars.transition().attr('transform',function(d,i){return'translate('+
(getY(d,i)<0?y(getY(d,i)):y(0))
+','+
(d.series*x.rangeBand()/data.length
+
x(getX(d,i)))
+')'}).select('rect').attr('height',x.rangeBand()/data.length).attr('width',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)});x0=x.copy();y0=y.copy();});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.xRange=function(_){if(!arguments.length)return xRange;xRange=_;return chart;};chart.yRange=function(_){if(!arguments.length)return yRange;yRange=_;return chart;};chart.forceY=function(_){if(!arguments.length)return forceY;forceY=_;return chart;};chart.stacked=function(_){if(!arguments.length)return stacked;stacked=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.barColor=function(_){if(!arguments.length)return barColor;barColor=nv.utils.getColor(_);return chart;};chart.disabled=function(_){if(!arguments.length)return disabled;disabled=_;return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.delay=function(_){if(!arguments.length)return delay;delay=_;return chart;};chart.showValues=function(_){if(!arguments.length)return showValues;showValues=_;return chart;};chart.valueFormat=function(_){if(!arguments.length)return valueFormat;valueFormat=_;return chart;};chart.valuePadding=function(_){if(!arguments.length)return valuePadding;valuePadding=_;return chart;};return chart;}
nv.models.multiBarHorizontalChart=function(){"use strict";var multibar=nv.models.multiBarHorizontal(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend().height(30),controls=nv.models.legend().height(30);var margin={top:30,right:20,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,showLegend=true,stacked=false,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+' - '+x+'</h3>'+'<p>'+y+'</p>'},x,y,state={stacked:stacked},defaultState=null,noData='No Data Available.',dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),controlWidth=function(){return showControls?180:0},transitionDuration=250;multibar.stacked(stacked);xAxis.orient('left').tickPadding(5).highlightZero(false).showMaxMin(false).tickFormat(function(d){return d});yAxis.orient('bottom').tickFormat(d3.format(',.1f'));controls.updateState(false);var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(multibar.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(multibar.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,e.value<0?'e':'w',null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=multibar.xScale();y=multibar.yScale();var wrap=container.selectAll('g.nv-wrap.nv-multiBarHorizontalChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multiBarHorizontalChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');if(showLegend){legend.width(availableWidth-controlWidth());if(multibar.barColor())
data.forEach(function(series,i){series.color=d3.rgb('#ccc').darker(i*1.5).toString();})
g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
g.select('.nv-legendWrap').attr('transform','translate('+controlWidth()+','+(-margin.top)+')');}
if(showControls){var controlsData=[{key:'Grouped',disabled:multibar.stacked()},{key:'Stacked',disabled:!multibar.stacked()}];controls.width(controlWidth()).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');multibar.disabled(data.map(function(series){return series.disabled})).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}))
var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}))
barsWrap.transition().call(multibar);xAxis.scale(x).ticks(availableHeight/24).tickSize(-availableWidth,0);g.select('.nv-x.nv-axis').transition().call(xAxis);var xTicks=g.select('.nv-x.nv-axis').selectAll('g');xTicks.selectAll('line, text').style('opacity',1)
yAxis.scale(y).ticks(availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-y.nv-axis').attr('transform','translate(0,'+availableHeight+')');g.select('.nv-y.nv-axis').transition().call(yAxis);legend.dispatch.on('stateChange',function(newState){state=newState;dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;switch(d.key){case'Grouped':multibar.stacked(false);break;case'Stacked':multibar.stacked(true);break;}
state.stacked=multibar.stacked();dispatch.stateChange(state);chart.update();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.stacked!=='undefined'){multibar.stacked(e.stacked);state.stacked=e.stacked;}
selection.call(chart);});});return chart;}
multibar.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});multibar.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.multibar=multibar;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;d3.rebind(chart,multibar,'x','y','xDomain','yDomain','xRange','yRange','forceX','forceY','clipEdge','id','delay','showValues','valueFormat','stacked','barColor');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);return chart;};chart.showControls=function(_){if(!arguments.length)return showControls;showControls=_;return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.tooltip=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.multiChart=function(){"use strict";var margin={top:30,right:20,bottom:50,left:60},color=d3.scale.category20().range(),width=null,height=null,showLegend=true,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' at '+x+'</p>'},x,y,yDomain1,yDomain2;var x=d3.scale.linear(),yScale1=d3.scale.linear(),yScale2=d3.scale.linear(),lines1=nv.models.line().yScale(yScale1),lines2=nv.models.line().yScale(yScale2),bars1=nv.models.multiBar().stacked(false).yScale(yScale1),bars2=nv.models.multiBar().stacked(false).yScale(yScale2),stack1=nv.models.stackedArea().yScale(yScale1),stack2=nv.models.stackedArea().yScale(yScale2),xAxis=nv.models.axis().scale(x).orient('bottom').tickPadding(5),yAxis1=nv.models.axis().scale(yScale1).orient('left'),yAxis2=nv.models.axis().scale(yScale2).orient('right'),legend=nv.models.legend().height(30),dispatch=d3.dispatch('tooltipShow','tooltipHide');var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(lines1.x()(e.point,e.pointIndex)),y=((e.series.yAxis==2)?yAxis2:yAxis1).tickFormat()(lines1.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,undefined,undefined,offsetElement.offsetParent);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;chart.update=function(){container.transition().call(chart);};chart.container=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;var dataLines1=data.filter(function(d){return!d.disabled&&d.type=='line'&&d.yAxis==1})
var dataLines2=data.filter(function(d){return!d.disabled&&d.type=='line'&&d.yAxis==2})
var dataBars1=data.filter(function(d){return!d.disabled&&d.type=='bar'&&d.yAxis==1})
var dataBars2=data.filter(function(d){return!d.disabled&&d.type=='bar'&&d.yAxis==2})
var dataStack1=data.filter(function(d){return!d.disabled&&d.type=='area'&&d.yAxis==1})
var dataStack2=data.filter(function(d){return!d.disabled&&d.type=='area'&&d.yAxis==2})
var series1=data.filter(function(d){return!d.disabled&&d.yAxis==1}).map(function(d){return d.values.map(function(d,i){return{x:d.x,y:d.y}})})
var series2=data.filter(function(d){return!d.disabled&&d.yAxis==2}).map(function(d){return d.values.map(function(d,i){return{x:d.x,y:d.y}})})
x.domain(d3.extent(d3.merge(series1.concat(series2)),function(d){return d.x})).range([0,availableWidth]);var wrap=container.selectAll('g.wrap.multiChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','wrap nvd3 multiChart').append('g');gEnter.append('g').attr('class','x axis');gEnter.append('g').attr('class','y1 axis');gEnter.append('g').attr('class','y2 axis');gEnter.append('g').attr('class','lines1Wrap');gEnter.append('g').attr('class','lines2Wrap');gEnter.append('g').attr('class','bars1Wrap');gEnter.append('g').attr('class','bars2Wrap');gEnter.append('g').attr('class','stack1Wrap');gEnter.append('g').attr('class','stack2Wrap');gEnter.append('g').attr('class','legendWrap');var g=wrap.select('g');if(showLegend){legend.width(availableWidth/2);g.select('.legendWrap').datum(data.map(function(series){series.originalKey=series.originalKey===undefined?series.key:series.originalKey;series.key=series.originalKey+(series.yAxis==1?'':' (right axis)');return series;})).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
g.select('.legendWrap').attr('transform','translate('+(availableWidth/2)+','+(-margin.top)+')');}
lines1.width(availableWidth).height(availableHeight).interpolate("monotone").color(data.map(function(d,i){return d.color||color[i%color.length];}).filter(function(d,i){return!data[i].disabled&&data[i].yAxis==1&&data[i].type=='line'}));lines2.width(availableWidth).height(availableHeight).interpolate("monotone").color(data.map(function(d,i){return d.color||color[i%color.length];}).filter(function(d,i){return!data[i].disabled&&data[i].yAxis==2&&data[i].type=='line'}));bars1.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color[i%color.length];}).filter(function(d,i){return!data[i].disabled&&data[i].yAxis==1&&data[i].type=='bar'}));bars2.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color[i%color.length];}).filter(function(d,i){return!data[i].disabled&&data[i].yAxis==2&&data[i].type=='bar'}));stack1.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color[i%color.length];}).filter(function(d,i){return!data[i].disabled&&data[i].yAxis==1&&data[i].type=='area'}));stack2.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color[i%color.length];}).filter(function(d,i){return!data[i].disabled&&data[i].yAxis==2&&data[i].type=='area'}));g.attr('transform','translate('+margin.left+','+margin.top+')');var lines1Wrap=g.select('.lines1Wrap').datum(dataLines1)
var bars1Wrap=g.select('.bars1Wrap').datum(dataBars1)
var stack1Wrap=g.select('.stack1Wrap').datum(dataStack1)
var lines2Wrap=g.select('.lines2Wrap').datum(dataLines2)
var bars2Wrap=g.select('.bars2Wrap').datum(dataBars2)
var stack2Wrap=g.select('.stack2Wrap').datum(dataStack2)
var extraValue1=dataStack1.length?dataStack1.map(function(a){return a.values}).reduce(function(a,b){return a.map(function(aVal,i){return{x:aVal.x,y:aVal.y+b[i].y}})}).concat([{x:0,y:0}]):[]
var extraValue2=dataStack2.length?dataStack2.map(function(a){return a.values}).reduce(function(a,b){return a.map(function(aVal,i){return{x:aVal.x,y:aVal.y+b[i].y}})}).concat([{x:0,y:0}]):[]
yScale1.domain(yDomain1||d3.extent(d3.merge(series1).concat(extraValue1),function(d){return d.y})).range([0,availableHeight])
yScale2.domain(yDomain2||d3.extent(d3.merge(series2).concat(extraValue2),function(d){return d.y})).range([0,availableHeight])
lines1.yDomain(yScale1.domain())
bars1.yDomain(yScale1.domain())
stack1.yDomain(yScale1.domain())
lines2.yDomain(yScale2.domain())
bars2.yDomain(yScale2.domain())
stack2.yDomain(yScale2.domain())
if(dataStack1.length){d3.transition(stack1Wrap).call(stack1);}
if(dataStack2.length){d3.transition(stack2Wrap).call(stack2);}
if(dataBars1.length){d3.transition(bars1Wrap).call(bars1);}
if(dataBars2.length){d3.transition(bars2Wrap).call(bars2);}
if(dataLines1.length){d3.transition(lines1Wrap).call(lines1);}
if(dataLines2.length){d3.transition(lines2Wrap).call(lines2);}
xAxis.ticks(availableWidth/100).tickSize(-availableHeight,0);g.select('.x.axis').attr('transform','translate(0,'+availableHeight+')');d3.transition(g.select('.x.axis')).call(xAxis);yAxis1.ticks(availableHeight/36).tickSize(-availableWidth,0);d3.transition(g.select('.y1.axis')).call(yAxis1);yAxis2.ticks(availableHeight/36).tickSize(-availableWidth,0);d3.transition(g.select('.y2.axis')).call(yAxis2);g.select('.y2.axis').style('opacity',series2.length?1:0).attr('transform','translate('+x.range()[1]+',0)');legend.dispatch.on('stateChange',function(newState){chart.update();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});});return chart;}
lines1.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines1.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});lines2.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines2.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});bars1.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});bars1.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});bars2.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});bars2.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});stack1.dispatch.on('tooltipShow',function(e){if(!Math.round(stack1.y()(e.point)*100)){setTimeout(function(){d3.selectAll('.point.hover').classed('hover',false)},0);return false;}
e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top],dispatch.tooltipShow(e);});stack1.dispatch.on('tooltipHide',function(e){dispatch.tooltipHide(e);});stack2.dispatch.on('tooltipShow',function(e){if(!Math.round(stack2.y()(e.point)*100)){setTimeout(function(){d3.selectAll('.point.hover').classed('hover',false)},0);return false;}
e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top],dispatch.tooltipShow(e);});stack2.dispatch.on('tooltipHide',function(e){dispatch.tooltipHide(e);});lines1.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines1.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});lines2.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});lines2.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.lines1=lines1;chart.lines2=lines2;chart.bars1=bars1;chart.bars2=bars2;chart.stack1=stack1;chart.stack2=stack2;chart.xAxis=xAxis;chart.yAxis1=yAxis1;chart.yAxis2=yAxis2;chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;lines1.x(_);bars1.x(_);return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;lines1.y(_);bars1.y(_);return chart;};chart.yDomain1=function(_){if(!arguments.length)return yDomain1;yDomain1=_;return chart;};chart.yDomain2=function(_){if(!arguments.length)return yDomain2;yDomain2=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin=_;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=_;legend.color(_);return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};return chart;}
nv.models.ohlcBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),x=d3.scale.linear(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getOpen=function(d){return d.open},getClose=function(d){return d.close},getHigh=function(d){return d.high},getLow=function(d){return d.low},forceX=[],forceY=[],padData=false,clipEdge=true,color=nv.utils.defaultColor(),xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout');function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);x.domain(xDomain||d3.extent(data[0].values.map(getX).concat(forceX)));if(padData)
x.range(xRange||[availableWidth*.5/data[0].values.length,availableWidth*(data[0].values.length-.5)/data[0].values.length]);else
x.range(xRange||[0,availableWidth]);y.domain(yDomain||[d3.min(data[0].values.map(getLow).concat(forceY)),d3.max(data[0].values.map(getHigh).concat(forceY))]).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);var wrap=d3.select(this).selectAll('g.nv-wrap.nv-ohlcBar').data([data[0].values]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-ohlcBar');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-ticks');wrap.attr('transform','translate('+margin.left+','+margin.top+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});defsEnter.append('clipPath').attr('id','nv-chart-clip-path-'+id).append('rect');wrap.select('#nv-chart-clip-path-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-chart-clip-path-'+id+')':'');var ticks=wrap.select('.nv-ticks').selectAll('.nv-tick').data(function(d){return d});ticks.exit().remove();var ticksEnter=ticks.enter().append('path').attr('class',function(d,i,j){return(getOpen(d,i)>getClose(d,i)?'nv-tick negative':'nv-tick positive')+' nv-tick-'+j+'-'+i}).attr('d',function(d,i){var w=(availableWidth/data[0].values.length)*.9;return'm0,0l0,'
+(y(getOpen(d,i))
-y(getHigh(d,i)))
+'l'
+(-w/2)
+',0l'
+(w/2)
+',0l0,'
+(y(getLow(d,i))-y(getOpen(d,i)))
+'l0,'
+(y(getClose(d,i))
-y(getLow(d,i)))
+'l'
+(w/2)
+',0l'
+(-w/2)
+',0z';}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+','+y(getHigh(d,i))+')';}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({point:d,series:data[0],pos:[x(getX(d,i)),y(getY(d,i))],pointIndex:i,seriesIndex:0,e:d3.event});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({point:d,series:data[0],pointIndex:i,seriesIndex:0,e:d3.event});}).on('click',function(d,i){dispatch.elementClick({value:getY(d,i),data:d,index:i,pos:[x(getX(d,i)),y(getY(d,i))],e:d3.event,id:id});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({value:getY(d,i),data:d,index:i,pos:[x(getX(d,i)),y(getY(d,i))],e:d3.event,id:id});d3.event.stopPropagation();});ticks.attr('class',function(d,i,j){return(getOpen(d,i)>getClose(d,i)?'nv-tick negative':'nv-tick positive')+' nv-tick-'+j+'-'+i})
d3.transition(ticks).attr('transform',function(d,i){return'translate('+x(getX(d,i))+','+y(getHigh(d,i))+')';}).attr('d',function(d,i){var w=(availableWidth/data[0].values.length)*.9;return'm0,0l0,'
+(y(getOpen(d,i))
-y(getHigh(d,i)))
+'l'
+(-w/2)
+',0l'
+(w/2)
+',0l0,'
+(y(getLow(d,i))
-y(getOpen(d,i)))
+'l0,'
+(y(getClose(d,i))
-y(getLow(d,i)))
+'l'
+(w/2)
+',0l'
+(-w/2)
+',0z';})});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=_;return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;return chart;};chart.open=function(_){if(!arguments.length)return getOpen;getOpen=_;return chart;};chart.close=function(_){if(!arguments.length)return getClose;getClose=_;return chart;};chart.high=function(_){if(!arguments.length)return getHigh;getHigh=_;return chart;};chart.low=function(_){if(!arguments.length)return getLow;getLow=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.xRange=function(_){if(!arguments.length)return xRange;xRange=_;return chart;};chart.yRange=function(_){if(!arguments.length)return yRange;yRange=_;return chart;};chart.forceX=function(_){if(!arguments.length)return forceX;forceX=_;return chart;};chart.forceY=function(_){if(!arguments.length)return forceY;forceY=_;return chart;};chart.padData=function(_){if(!arguments.length)return padData;padData=_;return chart;};chart.clipEdge=function(_){if(!arguments.length)return clipEdge;clipEdge=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};return chart;}
nv.models.pie=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=500,height=500,getX=function(d){return d.x},getY=function(d){return d.y},getDescription=function(d){return d.description},id=Math.floor(Math.random()*10000),color=nv.utils.defaultColor(),valueFormat=d3.format(',.2f'),showLabels=true,pieLabelsOutside=true,donutLabelsOutside=false,labelType="key",labelThreshold=.02,donut=false,labelSunbeamLayout=false,startAngle=false,endAngle=false,donutRatio=0.5,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout');function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,radius=Math.min(availableWidth,availableHeight)/2,arcRadius=radius-(radius/5),container=d3.select(this);var wrap=container.selectAll('.nv-wrap.nv-pie').data(data);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pie nv-chart-'+id);var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-pie');wrap.attr('transform','translate('+margin.left+','+margin.top+')');g.select('.nv-pie').attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});var arc=d3.svg.arc().outerRadius(arcRadius);if(startAngle)arc.startAngle(startAngle)
if(endAngle)arc.endAngle(endAngle);if(donut)arc.innerRadius(radius*donutRatio);var pie=d3.layout.pie().sort(null).value(function(d){return d.disabled?0:getY(d)});var slices=wrap.select('.nv-pie').selectAll('.nv-slice').data(pie);slices.exit().remove();var ae=slices.enter().append('g').attr('class','nv-slice').on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({label:getX(d.data),value:getY(d.data),point:d.data,pointIndex:i,pos:[d3.event.pageX,d3.event.pageY],id:id});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({label:getX(d.data),value:getY(d.data),point:d.data,index:i,id:id});}).on('click',function(d,i){dispatch.elementClick({label:getX(d.data),value:getY(d.data),point:d.data,index:i,pos:d3.event,id:id});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({label:getX(d.data),value:getY(d.data),point:d.data,index:i,pos:d3.event,id:id});d3.event.stopPropagation();});slices.attr('fill',function(d,i){return color(d,i);}).attr('stroke',function(d,i){return color(d,i);});var paths=ae.append('path').each(function(d){this._current=d;});d3.transition(slices.select('path')).attr('d',arc).attrTween('d',arcTween);if(showLabels){var labelsArc=d3.svg.arc().innerRadius(0);if(pieLabelsOutside){labelsArc=arc;}
if(donutLabelsOutside){labelsArc=d3.svg.arc().outerRadius(arc.outerRadius());}
ae.append("g").classed("nv-label",true).each(function(d,i){var group=d3.select(this);group.attr('transform',function(d){if(labelSunbeamLayout){d.outerRadius=arcRadius+10;d.innerRadius=arcRadius+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc.centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;return'translate('+labelsArc.centroid(d)+')'}});group.append('rect').style('stroke','#fff').style('fill','#fff').attr("rx",3).attr("ry",3);group.append('text').style('text-anchor',labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle').style('fill','#000')});slices.select(".nv-label").transition().attr('transform',function(d){if(labelSunbeamLayout){d.outerRadius=arcRadius+10;d.innerRadius=arcRadius+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc.centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;return'translate('+labelsArc.centroid(d)+')'}});slices.each(function(d,i){var slice=d3.select(this);slice.select(".nv-label text").style('text-anchor',labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle').text(function(d,i){var percent=(d.endAngle-d.startAngle)/(2*Math.PI);var labelTypes={"key":getX(d.data),"value":getY(d.data),"percent":d3.format('%')(percent)};return(d.value&&percent>labelThreshold)?labelTypes[labelType]:'';});var textBox=slice.select('text').node().getBBox();slice.select(".nv-label rect").attr("width",textBox.width+10).attr("height",textBox.height+10).attr("transform",function(){return"translate("+[textBox.x-5,textBox.y-5]+")";});});}
function angle(d){var a=(d.startAngle+d.endAngle)*90/Math.PI-90;return a>90?a-180:a;}
function arcTween(a){a.endAngle=isNaN(a.endAngle)?0:a.endAngle;a.startAngle=isNaN(a.startAngle)?0:a.startAngle;if(!donut)a.innerRadius=0;var i=d3.interpolate(this._current,a);this._current=i(0);return function(t){return arc(i(t));};}
function tweenPie(b){b.innerRadius=0;var i=d3.interpolate({startAngle:0,endAngle:0},b);return function(t){return arc(i(t));};}});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.values=function(_){nv.log("pie.values() is no longer supported.");return chart;};chart.x=function(_){if(!arguments.length)return getX;getX=_;return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=d3.functor(_);return chart;};chart.description=function(_){if(!arguments.length)return getDescription;getDescription=_;return chart;};chart.showLabels=function(_){if(!arguments.length)return showLabels;showLabels=_;return chart;};chart.labelSunbeamLayout=function(_){if(!arguments.length)return labelSunbeamLayout;labelSunbeamLayout=_;return chart;};chart.donutLabelsOutside=function(_){if(!arguments.length)return donutLabelsOutside;donutLabelsOutside=_;return chart;};chart.pieLabelsOutside=function(_){if(!arguments.length)return pieLabelsOutside;pieLabelsOutside=_;return chart;};chart.labelType=function(_){if(!arguments.length)return labelType;labelType=_;labelType=labelType||"key";return chart;};chart.donut=function(_){if(!arguments.length)return donut;donut=_;return chart;};chart.donutRatio=function(_){if(!arguments.length)return donutRatio;donutRatio=_;return chart;};chart.startAngle=function(_){if(!arguments.length)return startAngle;startAngle=_;return chart;};chart.endAngle=function(_){if(!arguments.length)return endAngle;endAngle=_;return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.valueFormat=function(_){if(!arguments.length)return valueFormat;valueFormat=_;return chart;};chart.labelThreshold=function(_){if(!arguments.length)return labelThreshold;labelThreshold=_;return chart;};return chart;}
nv.models.pieChart=function(){"use strict";var pie=nv.models.pie(),legend=nv.models.legend();var margin={top:30,right:20,bottom:20,left:20},width=null,height=null,showLegend=true,color=nv.utils.defaultColor(),tooltips=true,tooltip=function(key,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+'</p>'},state={},defaultState=null,noData="No Data Available.",dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState');var showTooltip=function(e,offsetElement){var tooltipLabel=pie.description()(e.point)||pie.x()(e.point)
var left=e.pos[0]+((offsetElement&&offsetElement.offsetLeft)||0),top=e.pos[1]+((offsetElement&&offsetElement.offsetTop)||0),y=pie.valueFormat()(pie.y()(e.point)),content=tooltip(tooltipLabel,y,e,chart);nv.tooltip.show([left,top],content,e.value<0?'n':'s',null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().call(chart);};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
var wrap=container.selectAll('g.nv-wrap.nv-pieChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pieChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-pieWrap');gEnter.append('g').attr('class','nv-legendWrap');if(showLegend){legend.width(availableWidth).key(pie.x());wrap.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')');}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');pie.width(availableWidth).height(availableHeight);var pieWrap=g.select('.nv-pieWrap').datum([data]);d3.transition(pieWrap).call(pie);legend.dispatch.on('stateChange',function(newState){state=newState;dispatch.stateChange(state);chart.update();});pie.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});return chart;}
pie.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.legend=legend;chart.dispatch=dispatch;chart.pie=pie;d3.rebind(chart,pie,'valueFormat','values','x','y','description','id','showLabels','donutLabelsOutside','pieLabelsOutside','labelType','donut','donutRatio','labelThreshold');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);pie.color(color);return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};return chart;}
nv.models.scatter=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,color=nv.utils.defaultColor(),id=Math.floor(Math.random()*100000),x=d3.scale.linear(),y=d3.scale.linear(),z=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getSize=function(d){return d.size||1},getShape=function(d){return d.shape||'circle'},onlyCircles=true,forceX=[],forceY=[],forceSize=[],interactive=true,pointKey=null,pointActive=function(d){return!d.notActive},padData=false,padDataOuter=.1,clipEdge=false,clipVoronoi=true,clipRadius=function(){return 25},xDomain=null,yDomain=null,xRange=null,yRange=null,sizeDomain=null,sizeRange=null,singlePoint=false,dispatch=d3.dispatch('elementClick','elementMouseover','elementMouseout'),useVoronoi=true;var x0,y0,z0,timeoutID,needsUpdate=false;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var seriesData=(xDomain&&yDomain&&sizeDomain)?[]:d3.merge(data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),size:getSize(d,i)}})}));x.domain(xDomain||d3.extent(seriesData.map(function(d){return d.x;}).concat(forceX)))
if(padData&&data[0])
x.range(xRange||[(availableWidth*padDataOuter+availableWidth)/(2*data[0].values.length),availableWidth-availableWidth*(1+padDataOuter)/(2*data[0].values.length)]);else
x.range(xRange||[0,availableWidth]);y.domain(yDomain||d3.extent(seriesData.map(function(d){return d.y}).concat(forceY))).range(yRange||[availableHeight,0]);z.domain(sizeDomain||d3.extent(seriesData.map(function(d){return d.size}).concat(forceSize))).range(sizeRange||[16,256]);if(x.domain()[0]===x.domain()[1]||y.domain()[0]===y.domain()[1])singlePoint=true;if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]-y.domain()[0]*0.01,y.domain()[1]+y.domain()[1]*0.01]):y.domain([-1,1]);if(isNaN(x.domain()[0])){x.domain([-1,1]);}
if(isNaN(y.domain()[0])){y.domain([-1,1]);}
x0=x0||x;y0=y0||y;z0=z0||z;var wrap=container.selectAll('g.nv-wrap.nv-scatter').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-scatter nv-chart-'+id+(singlePoint?' nv-single-point':''));var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-point-paths');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');function updateInteractiveLayer(){if(!interactive)return false;var eventElements;var vertices=d3.merge(data.map(function(group,groupIndex){return group.values.map(function(point,pointIndex){var pX=getX(point,pointIndex);var pY=getY(point,pointIndex);return[x(pX)+Math.random()*1e-7,y(pY)+Math.random()*1e-7,groupIndex,pointIndex,point];}).filter(function(pointArray,pointIndex){return pointActive(pointArray[4],pointIndex);})}));if(useVoronoi===true){if(clipVoronoi){var pointClipsEnter=wrap.select('defs').selectAll('.nv-point-clips').data([id]).enter();pointClipsEnter.append('clipPath').attr('class','nv-point-clips').attr('id','nv-points-clip-'+id);var pointClips=wrap.select('#nv-points-clip-'+id).selectAll('circle').data(vertices);pointClips.enter().append('circle').attr('r',clipRadius);pointClips.exit().remove();pointClips.attr('cx',function(d){return d[0]}).attr('cy',function(d){return d[1]});wrap.select('.nv-point-paths').attr('clip-path','url(#nv-points-clip-'+id+')');}
if(vertices.length){vertices.push([x.range()[0]-20,y.range()[0]-20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]+20,null,null]);vertices.push([x.range()[0]-20,y.range()[0]+20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]-20,null,null]);}
var bounds=d3.geom.polygon([[-10,-10],[-10,height+10],[width+10,height+10],[width+10,-10]]);var voronoi=d3.geom.voronoi(vertices).map(function(d,i){return{'data':bounds.clip(d),'series':vertices[i][2],'point':vertices[i][3]}});var pointPaths=wrap.select('.nv-point-paths').selectAll('path').data(voronoi);pointPaths.enter().append('path').attr('class',function(d,i){return'nv-path-'+i;});pointPaths.exit().remove();pointPaths.attr('d',function(d){if(d.data.length===0)
return'M 0 0'
else
return'M'+d.data.join('L')+'Z';});var mouseEventCallback=function(d,mDispatch){if(needsUpdate)return 0;var series=data[d.series];if(typeof series==='undefined')return;var point=series.values[d.point];mDispatch({point:point,series:series,pos:[x(getX(point,d.point))+margin.left,y(getY(point,d.point))+margin.top],seriesIndex:d.series,pointIndex:d.point});};pointPaths.on('click',function(d){mouseEventCallback(d,dispatch.elementClick);}).on('mouseover',function(d){mouseEventCallback(d,dispatch.elementMouseover);}).on('mouseout',function(d,i){mouseEventCallback(d,dispatch.elementMouseout);});}else{wrap.select('.nv-groups').selectAll('.nv-group').selectAll('.nv-point').on('click',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementClick({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('mouseover',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseover({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('mouseout',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseout({point:point,series:series,seriesIndex:d.series,pointIndex:i});});}
needsUpdate=false;}
needsUpdate=true;var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover});groups.transition().style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)}).style('stroke-opacity',1).style('fill-opacity',.5);if(onlyCircles){var points=groups.selectAll('circle.nv-point').data(function(d){return d.values},pointKey);points.enter().append('circle').style('fill',function(d,i){return d.color}).style('stroke',function(d,i){return d.color}).attr('cx',function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).attr('cy',function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}).attr('r',function(d,i){return Math.sqrt(z(getSize(d,i))/Math.PI)});points.exit().remove();groups.exit().selectAll('path.nv-point').transition().attr('cx',function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).attr('cy',function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}).remove();points.each(function(d,i){d3.select(this).classed('nv-point',true).classed('nv-point-'+i,true).classed('hover',false);});points.transition().attr('cx',function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).attr('cy',function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}).attr('r',function(d,i){return Math.sqrt(z(getSize(d,i))/Math.PI)});}else{var points=groups.selectAll('path.nv-point').data(function(d){return d.values});points.enter().append('path').style('fill',function(d,i){return d.color}).style('stroke',function(d,i){return d.color}).attr('transform',function(d,i){return'translate('+x0(getX(d,i))+','+y0(getY(d,i))+')'}).attr('d',d3.svg.symbol().type(getShape).size(function(d,i){return z(getSize(d,i))}));points.exit().remove();groups.exit().selectAll('path.nv-point').transition().attr('transform',function(d,i){return'translate('+x(getX(d,i))+','+y(getY(d,i))+')'}).remove();points.each(function(d,i){d3.select(this).classed('nv-point',true).classed('nv-point-'+i,true).classed('hover',false);});points.transition().attr('transform',function(d,i){return'translate('+x(getX(d,i))+','+y(getY(d,i))+')'}).attr('d',d3.svg.symbol().type(getShape).size(function(d,i){return z(getSize(d,i))}));}
clearTimeout(timeoutID);timeoutID=setTimeout(updateInteractiveLayer,300);x0=x.copy();y0=y.copy();z0=z.copy();});return chart;}
chart.clearHighlights=function(){d3.selectAll(".nv-chart-"+id+" .nv-point.hover").classed("hover",false);};chart.highlightPoint=function(seriesIndex,pointIndex,isHoverOver){d3.select(".nv-chart-"+id+" .nv-series-"+seriesIndex+" .nv-point-"+pointIndex).classed("hover",isHoverOver);};dispatch.on('elementMouseover.point',function(d){if(interactive)chart.highlightPoint(d.seriesIndex,d.pointIndex,true);});dispatch.on('elementMouseout.point',function(d){if(interactive)chart.highlightPoint(d.seriesIndex,d.pointIndex,false);});chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=d3.functor(_);return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=d3.functor(_);return chart;};chart.size=function(_){if(!arguments.length)return getSize;getSize=d3.functor(_);return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.zScale=function(_){if(!arguments.length)return z;z=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.sizeDomain=function(_){if(!arguments.length)return sizeDomain;sizeDomain=_;return chart;};chart.xRange=function(_){if(!arguments.length)return xRange;xRange=_;return chart;};chart.yRange=function(_){if(!arguments.length)return yRange;yRange=_;return chart;};chart.sizeRange=function(_){if(!arguments.length)return sizeRange;sizeRange=_;return chart;};chart.forceX=function(_){if(!arguments.length)return forceX;forceX=_;return chart;};chart.forceY=function(_){if(!arguments.length)return forceY;forceY=_;return chart;};chart.forceSize=function(_){if(!arguments.length)return forceSize;forceSize=_;return chart;};chart.interactive=function(_){if(!arguments.length)return interactive;interactive=_;return chart;};chart.pointKey=function(_){if(!arguments.length)return pointKey;pointKey=_;return chart;};chart.pointActive=function(_){if(!arguments.length)return pointActive;pointActive=_;return chart;};chart.padData=function(_){if(!arguments.length)return padData;padData=_;return chart;};chart.padDataOuter=function(_){if(!arguments.length)return padDataOuter;padDataOuter=_;return chart;};chart.clipEdge=function(_){if(!arguments.length)return clipEdge;clipEdge=_;return chart;};chart.clipVoronoi=function(_){if(!arguments.length)return clipVoronoi;clipVoronoi=_;return chart;};chart.useVoronoi=function(_){if(!arguments.length)return useVoronoi;useVoronoi=_;if(useVoronoi===false){clipVoronoi=false;}
return chart;};chart.clipRadius=function(_){if(!arguments.length)return clipRadius;clipRadius=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.shape=function(_){if(!arguments.length)return getShape;getShape=_;return chart;};chart.onlyCircles=function(_){if(!arguments.length)return onlyCircles;onlyCircles=_;return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.singlePoint=function(_){if(!arguments.length)return singlePoint;singlePoint=_;return chart;};return chart;}
nv.models.scatterChart=function(){"use strict";var scatter=nv.models.scatter(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend(),distX=nv.models.distribution(),distY=nv.models.distribution();var margin={top:30,right:20,bottom:50,left:75},width=null,height=null,color=nv.utils.defaultColor(),x=d3.fisheye?d3.fisheye.scale(d3.scale.linear).distortion(0):scatter.xScale(),y=d3.fisheye?d3.fisheye.scale(d3.scale.linear).distortion(0):scatter.yScale(),xPadding=0,yPadding=0,showDistX=false,showDistY=false,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,showControls=!!d3.fisheye,fisheye=0,pauseFisheye=false,tooltips=true,tooltipX=function(key,x,y){return'<strong>'+x+'</strong>'},tooltipY=function(key,x,y){return'<strong>'+y+'</strong>'},tooltip=null,state={},defaultState=null,dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),noData="No Data Available.",transitionDuration=250;scatter.xScale(x).yScale(y);xAxis.orient('bottom').tickPadding(10);yAxis.orient((rightAlignYAxis)?'right':'left').tickPadding(10);distX.axis('x');distY.axis('y');controls.updateState(false);var x0,y0;var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),leftX=e.pos[0]+(offsetElement.offsetLeft||0),topX=y.range()[0]+margin.top+(offsetElement.offsetTop||0),leftY=x.range()[0]+margin.left+(offsetElement.offsetLeft||0),topY=e.pos[1]+(offsetElement.offsetTop||0),xVal=xAxis.tickFormat()(scatter.x()(e.point,e.pointIndex)),yVal=yAxis.tickFormat()(scatter.y()(e.point,e.pointIndex));if(tooltipX!=null)
nv.tooltip.show([leftX,topX],tooltipX(e.series.key,xVal,yVal,e,chart),'n',1,offsetElement,'x-nvtooltip');if(tooltipY!=null)
nv.tooltip.show([leftY,topY],tooltipY(e.series.key,xVal,yVal,e,chart),'e',1,offsetElement,'y-nvtooltip');if(tooltip!=null)
nv.tooltip.show([left,top],tooltip(e.series.key,xVal,yVal,e,chart),e.value<0?'n':'s',null,offsetElement);};var controlsData=[{key:'Magnify',disabled:true}];function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart);};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-scatterChart').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-scatterChart nv-chart-'+scatter.id());var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('rect').attr('class','nvd3 nv-background');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-scatterWrap');gEnter.append('g').attr('class','nv-distWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');if(showLegend){var legendWidth=(showControls)?availableWidth/2:availableWidth;legend.width(legendWidth);wrap.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
wrap.select('.nv-legendWrap').attr('transform','translate('+(availableWidth-legendWidth)+','+(-margin.top)+')');}
if(showControls){controls.width(180).color(['#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
scatter.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));if(xPadding!==0)
scatter.xDomain(null);if(yPadding!==0)
scatter.yDomain(null);wrap.select('.nv-scatterWrap').datum(data.filter(function(d){return!d.disabled})).call(scatter);if(xPadding!==0){var xRange=x.domain()[1]-x.domain()[0];scatter.xDomain([x.domain()[0]-(xPadding*xRange),x.domain()[1]+(xPadding*xRange)]);}
if(yPadding!==0){var yRange=y.domain()[1]-y.domain()[0];scatter.yDomain([y.domain()[0]-(yPadding*yRange),y.domain()[1]+(yPadding*yRange)]);}
if(yPadding!==0||xPadding!==0){wrap.select('.nv-scatterWrap').datum(data.filter(function(d){return!d.disabled})).call(scatter);}
if(showXAxis){xAxis.scale(x).ticks(xAxis.ticks()&&xAxis.ticks().length?xAxis.ticks():availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')').call(xAxis);}
if(showYAxis){yAxis.scale(y).ticks(yAxis.ticks()&&yAxis.ticks().length?yAxis.ticks():availableHeight/36).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
if(showDistX){distX.getData(scatter.x()).scale(x).width(availableWidth).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));gEnter.select('.nv-distWrap').append('g').attr('class','nv-distributionX');g.select('.nv-distributionX').attr('transform','translate(0,'+y.range()[0]+')').datum(data.filter(function(d){return!d.disabled})).call(distX);}
if(showDistY){distY.getData(scatter.y()).scale(y).width(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));gEnter.select('.nv-distWrap').append('g').attr('class','nv-distributionY');g.select('.nv-distributionY').attr('transform','translate('+(rightAlignYAxis?availableWidth:-distY.size())+',0)').datum(data.filter(function(d){return!d.disabled})).call(distY);}
if(d3.fisheye){g.select('.nv-background').attr('width',availableWidth).attr('height',availableHeight);g.select('.nv-background').on('mousemove',updateFisheye);g.select('.nv-background').on('click',function(){pauseFisheye=!pauseFisheye;});scatter.dispatch.on('elementClick.freezeFisheye',function(){pauseFisheye=!pauseFisheye;});}
function updateFisheye(){if(pauseFisheye){g.select('.nv-point-paths').style('pointer-events','all');return false;}
g.select('.nv-point-paths').style('pointer-events','none');var mouse=d3.mouse(this);x.distortion(fisheye).focus(mouse[0]);y.distortion(fisheye).focus(mouse[1]);g.select('.nv-scatterWrap').call(scatter);if(showXAxis)
g.select('.nv-x.nv-axis').call(xAxis);if(showYAxis)
g.select('.nv-y.nv-axis').call(yAxis);g.select('.nv-distributionX').datum(data.filter(function(d){return!d.disabled})).call(distX);g.select('.nv-distributionY').datum(data.filter(function(d){return!d.disabled})).call(distY);}
controls.dispatch.on('legendClick',function(d,i){d.disabled=!d.disabled;fisheye=d.disabled?0:2.5;g.select('.nv-background').style('pointer-events',d.disabled?'none':'all');g.select('.nv-point-paths').style('pointer-events',d.disabled?'all':'none');if(d.disabled){x.distortion(fisheye).focus(0);y.distortion(fisheye).focus(0);g.select('.nv-scatterWrap').call(scatter);g.select('.nv-x.nv-axis').call(xAxis);g.select('.nv-y.nv-axis').call(yAxis);}else{pauseFisheye=false;}
chart.update();});legend.dispatch.on('stateChange',function(newState){state.disabled=newState.disabled;dispatch.stateChange(state);chart.update();});scatter.dispatch.on('elementMouseover.tooltip',function(e){d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-distx-'+e.pointIndex).attr('y1',function(d,i){return e.pos[1]-availableHeight;});d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-disty-'+e.pointIndex).attr('x2',e.pos[0]+distX.size());e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});x0=x.copy();y0=y.copy();});return chart;}
scatter.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-distx-'+e.pointIndex).attr('y1',0);d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-disty-'+e.pointIndex).attr('x2',distY.size());});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.scatter=scatter;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.distX=distX;chart.distY=distY;d3.rebind(chart,scatter,'id','interactive','pointActive','x','y','shape','size','xScale','yScale','zScale','xDomain','yDomain','xRange','yRange','sizeDomain','sizeRange','forceX','forceY','forceSize','clipVoronoi','clipRadius','useVoronoi');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);distX.color(color);distY.color(color);return chart;};chart.showDistX=function(_){if(!arguments.length)return showDistX;showDistX=_;return chart;};chart.showDistY=function(_){if(!arguments.length)return showDistY;showDistY=_;return chart;};chart.showControls=function(_){if(!arguments.length)return showControls;showControls=_;return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.fisheye=function(_){if(!arguments.length)return fisheye;fisheye=_;return chart;};chart.xPadding=function(_){if(!arguments.length)return xPadding;xPadding=_;return chart;};chart.yPadding=function(_){if(!arguments.length)return yPadding;yPadding=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.tooltipXContent=function(_){if(!arguments.length)return tooltipX;tooltipX=_;return chart;};chart.tooltipYContent=function(_){if(!arguments.length)return tooltipY;tooltipY=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.scatterPlusLineChart=function(){"use strict";var scatter=nv.models.scatter(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend(),distX=nv.models.distribution(),distY=nv.models.distribution();var margin={top:30,right:20,bottom:50,left:75},width=null,height=null,color=nv.utils.defaultColor(),x=d3.fisheye?d3.fisheye.scale(d3.scale.linear).distortion(0):scatter.xScale(),y=d3.fisheye?d3.fisheye.scale(d3.scale.linear).distortion(0):scatter.yScale(),showDistX=false,showDistY=false,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,showControls=!!d3.fisheye,fisheye=0,pauseFisheye=false,tooltips=true,tooltipX=function(key,x,y){return'<strong>'+x+'</strong>'},tooltipY=function(key,x,y){return'<strong>'+y+'</strong>'},tooltip=function(key,x,y,date){return'<h3>'+key+'</h3>'
+'<p>'+date+'</p>'},state={},defaultState=null,dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),noData="No Data Available.",transitionDuration=250;scatter.xScale(x).yScale(y);xAxis.orient('bottom').tickPadding(10);yAxis.orient((rightAlignYAxis)?'right':'left').tickPadding(10);distX.axis('x');distY.axis('y');controls.updateState(false);var x0,y0;var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),leftX=e.pos[0]+(offsetElement.offsetLeft||0),topX=y.range()[0]+margin.top+(offsetElement.offsetTop||0),leftY=x.range()[0]+margin.left+(offsetElement.offsetLeft||0),topY=e.pos[1]+(offsetElement.offsetTop||0),xVal=xAxis.tickFormat()(scatter.x()(e.point,e.pointIndex)),yVal=yAxis.tickFormat()(scatter.y()(e.point,e.pointIndex));if(tooltipX!=null)
nv.tooltip.show([leftX,topX],tooltipX(e.series.key,xVal,yVal,e,chart),'n',1,offsetElement,'x-nvtooltip');if(tooltipY!=null)
nv.tooltip.show([leftY,topY],tooltipY(e.series.key,xVal,yVal,e,chart),'e',1,offsetElement,'y-nvtooltip');if(tooltip!=null)
nv.tooltip.show([left,top],tooltip(e.series.key,xVal,yVal,e.point.tooltip,e,chart),e.value<0?'n':'s',null,offsetElement);};var controlsData=[{key:'Magnify',disabled:true}];function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart);};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=scatter.xScale();y=scatter.yScale();x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-scatterChart').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-scatterChart nv-chart-'+scatter.id());var gEnter=wrapEnter.append('g');var g=wrap.select('g')
gEnter.append('rect').attr('class','nvd3 nv-background').style("pointer-events","none");gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-scatterWrap');gEnter.append('g').attr('class','nv-regressionLinesWrap');gEnter.append('g').attr('class','nv-distWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(showLegend){legend.width(availableWidth/2);wrap.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
wrap.select('.nv-legendWrap').attr('transform','translate('+(availableWidth/2)+','+(-margin.top)+')');}
if(showControls){controls.width(180).color(['#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
scatter.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}))
wrap.select('.nv-scatterWrap').datum(data.filter(function(d){return!d.disabled})).call(scatter);wrap.select('.nv-regressionLinesWrap').attr('clip-path','url(#nv-edge-clip-'+scatter.id()+')');var regWrap=wrap.select('.nv-regressionLinesWrap').selectAll('.nv-regLines').data(function(d){return d});regWrap.enter().append('g').attr('class','nv-regLines');var regLine=regWrap.selectAll('.nv-regLine').data(function(d){return[d]});var regLineEnter=regLine.enter().append('line').attr('class','nv-regLine').style('stroke-opacity',0);regLine.transition().attr('x1',x.range()[0]).attr('x2',x.range()[1]).attr('y1',function(d,i){return y(x.domain()[0]*d.slope+d.intercept)}).attr('y2',function(d,i){return y(x.domain()[1]*d.slope+d.intercept)}).style('stroke',function(d,i,j){return color(d,j)}).style('stroke-opacity',function(d,i){return(d.disabled||typeof d.slope==='undefined'||typeof d.intercept==='undefined')?0:1});if(showXAxis){xAxis.scale(x).ticks(xAxis.ticks()?xAxis.ticks():availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')').call(xAxis);}
if(showYAxis){yAxis.scale(y).ticks(yAxis.ticks()?yAxis.ticks():availableHeight/36).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
if(showDistX){distX.getData(scatter.x()).scale(x).width(availableWidth).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));gEnter.select('.nv-distWrap').append('g').attr('class','nv-distributionX');g.select('.nv-distributionX').attr('transform','translate(0,'+y.range()[0]+')').datum(data.filter(function(d){return!d.disabled})).call(distX);}
if(showDistY){distY.getData(scatter.y()).scale(y).width(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));gEnter.select('.nv-distWrap').append('g').attr('class','nv-distributionY');g.select('.nv-distributionY').attr('transform','translate('+(rightAlignYAxis?availableWidth:-distY.size())+',0)').datum(data.filter(function(d){return!d.disabled})).call(distY);}
if(d3.fisheye){g.select('.nv-background').attr('width',availableWidth).attr('height',availableHeight);g.select('.nv-background').on('mousemove',updateFisheye);g.select('.nv-background').on('click',function(){pauseFisheye=!pauseFisheye;});scatter.dispatch.on('elementClick.freezeFisheye',function(){pauseFisheye=!pauseFisheye;});}
function updateFisheye(){if(pauseFisheye){g.select('.nv-point-paths').style('pointer-events','all');return false;}
g.select('.nv-point-paths').style('pointer-events','none');var mouse=d3.mouse(this);x.distortion(fisheye).focus(mouse[0]);y.distortion(fisheye).focus(mouse[1]);g.select('.nv-scatterWrap').datum(data.filter(function(d){return!d.disabled})).call(scatter);if(showXAxis)
g.select('.nv-x.nv-axis').call(xAxis);if(showYAxis)
g.select('.nv-y.nv-axis').call(yAxis);g.select('.nv-distributionX').datum(data.filter(function(d){return!d.disabled})).call(distX);g.select('.nv-distributionY').datum(data.filter(function(d){return!d.disabled})).call(distY);}
controls.dispatch.on('legendClick',function(d,i){d.disabled=!d.disabled;fisheye=d.disabled?0:2.5;g.select('.nv-background').style('pointer-events',d.disabled?'none':'all');g.select('.nv-point-paths').style('pointer-events',d.disabled?'all':'none');if(d.disabled){x.distortion(fisheye).focus(0);y.distortion(fisheye).focus(0);g.select('.nv-scatterWrap').call(scatter);g.select('.nv-x.nv-axis').call(xAxis);g.select('.nv-y.nv-axis').call(yAxis);}else{pauseFisheye=false;}
chart.update();});legend.dispatch.on('stateChange',function(newState){state=newState;dispatch.stateChange(state);chart.update();});scatter.dispatch.on('elementMouseover.tooltip',function(e){d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-distx-'+e.pointIndex).attr('y1',e.pos[1]-availableHeight);d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-disty-'+e.pointIndex).attr('x2',e.pos[0]+distX.size());e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top];dispatch.tooltipShow(e);});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});x0=x.copy();y0=y.copy();});return chart;}
scatter.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-distx-'+e.pointIndex).attr('y1',0);d3.select('.nv-chart-'+scatter.id()+' .nv-series-'+e.seriesIndex+' .nv-disty-'+e.pointIndex).attr('x2',distY.size());});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.scatter=scatter;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.distX=distX;chart.distY=distY;d3.rebind(chart,scatter,'id','interactive','pointActive','x','y','shape','size','xScale','yScale','zScale','xDomain','yDomain','xRange','yRange','sizeDomain','sizeRange','forceX','forceY','forceSize','clipVoronoi','clipRadius','useVoronoi');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);distX.color(color);distY.color(color);return chart;};chart.showDistX=function(_){if(!arguments.length)return showDistX;showDistX=_;return chart;};chart.showDistY=function(_){if(!arguments.length)return showDistY;showDistY=_;return chart;};chart.showControls=function(_){if(!arguments.length)return showControls;showControls=_;return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.fisheye=function(_){if(!arguments.length)return fisheye;fisheye=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.tooltipXContent=function(_){if(!arguments.length)return tooltipX;tooltipX=_;return chart;};chart.tooltipYContent=function(_){if(!arguments.length)return tooltipY;tooltipY=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};return chart;}
nv.models.sparkline=function(){"use strict";var margin={top:2,right:0,bottom:2,left:0},width=400,height=32,animate=true,x=d3.scale.linear(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},color=nv.utils.getColor(['#000']),xDomain,yDomain,xRange,yRange;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);x.domain(xDomain||d3.extent(data,getX)).range(xRange||[0,availableWidth]);y.domain(yDomain||d3.extent(data,getY)).range(yRange||[availableHeight,0]);var wrap=container.selectAll('g.nv-wrap.nv-sparkline').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-sparkline');var gEnter=wrapEnter.append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')')
var paths=wrap.selectAll('path').data(function(d){return[d]});paths.enter().append('path');paths.exit().remove();paths.style('stroke',function(d,i){return d.color||color(d,i)}).attr('d',d3.svg.line().x(function(d,i){return x(getX(d,i))}).y(function(d,i){return y(getY(d,i))}));var points=wrap.selectAll('circle.nv-point').data(function(data){var yValues=data.map(function(d,i){return getY(d,i);});function pointIndex(index){if(index!=-1){var result=data[index];result.pointIndex=index;return result;}else{return null;}}
var maxPoint=pointIndex(yValues.lastIndexOf(y.domain()[1])),minPoint=pointIndex(yValues.indexOf(y.domain()[0])),currentPoint=pointIndex(yValues.length-1);return[minPoint,maxPoint,currentPoint].filter(function(d){return d!=null;});});points.enter().append('circle');points.exit().remove();points.attr('cx',function(d,i){return x(getX(d,d.pointIndex))}).attr('cy',function(d,i){return y(getY(d,d.pointIndex))}).attr('r',2).attr('class',function(d,i){return getX(d,d.pointIndex)==x.domain()[1]?'nv-point nv-currentValue':getY(d,d.pointIndex)==y.domain()[0]?'nv-point nv-minValue':'nv-point nv-maxValue'});});return chart;}
chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.x=function(_){if(!arguments.length)return getX;getX=d3.functor(_);return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=d3.functor(_);return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.xRange=function(_){if(!arguments.length)return xRange;xRange=_;return chart;};chart.yRange=function(_){if(!arguments.length)return yRange;yRange=_;return chart;};chart.animate=function(_){if(!arguments.length)return animate;animate=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};return chart;}
nv.models.sparklinePlus=function(){"use strict";var sparkline=nv.models.sparkline();var margin={top:15,right:100,bottom:10,left:50},width=null,height=null,x,y,index=[],paused=false,xTickFormat=d3.format(',r'),yTickFormat=d3.format(',.2f'),showValue=true,alignValue=true,rightAlignValue=false,noData="No Data Available.";function chart(selection){selection.each(function(data){var container=d3.select(this);var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){chart(selection)};chart.container=this;if(!data||!data.length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
var currentValue=sparkline.y()(data[data.length-1],data.length-1);x=sparkline.xScale();y=sparkline.yScale();var wrap=container.selectAll('g.nv-wrap.nv-sparklineplus').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-sparklineplus');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-sparklineWrap');gEnter.append('g').attr('class','nv-valueWrap');gEnter.append('g').attr('class','nv-hoverArea');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var sparklineWrap=g.select('.nv-sparklineWrap');sparkline.width(availableWidth).height(availableHeight);sparklineWrap.call(sparkline);var valueWrap=g.select('.nv-valueWrap');var value=valueWrap.selectAll('.nv-currentValue').data([currentValue]);value.enter().append('text').attr('class','nv-currentValue').attr('dx',rightAlignValue?-8:8).attr('dy','.9em').style('text-anchor',rightAlignValue?'end':'start');value.attr('x',availableWidth+(rightAlignValue?margin.right:0)).attr('y',alignValue?function(d){return y(d)}:0).style('fill',sparkline.color()(data[data.length-1],data.length-1)).text(yTickFormat(currentValue));gEnter.select('.nv-hoverArea').append('rect').on('mousemove',sparklineHover).on('click',function(){paused=!paused}).on('mouseout',function(){index=[];updateValueLine();});g.select('.nv-hoverArea rect').attr('transform',function(d){return'translate('+-margin.left+','+-margin.top+')'}).attr('width',availableWidth+margin.left+margin.right).attr('height',availableHeight+margin.top);function updateValueLine(){if(paused)return;var hoverValue=g.selectAll('.nv-hoverValue').data(index)
var hoverEnter=hoverValue.enter().append('g').attr('class','nv-hoverValue').style('stroke-opacity',0).style('fill-opacity',0);hoverValue.exit().transition().duration(250).style('stroke-opacity',0).style('fill-opacity',0).remove();hoverValue.attr('transform',function(d){return'translate('+x(sparkline.x()(data[d],d))+',0)'}).transition().duration(250).style('stroke-opacity',1).style('fill-opacity',1);if(!index.length)return;hoverEnter.append('line').attr('x1',0).attr('y1',-margin.top).attr('x2',0).attr('y2',availableHeight);hoverEnter.append('text').attr('class','nv-xValue').attr('x',-6).attr('y',-margin.top).attr('text-anchor','end').attr('dy','.9em')
g.select('.nv-hoverValue .nv-xValue').text(xTickFormat(sparkline.x()(data[index[0]],index[0])));hoverEnter.append('text').attr('class','nv-yValue').attr('x',6).attr('y',-margin.top).attr('text-anchor','start').attr('dy','.9em')
g.select('.nv-hoverValue .nv-yValue').text(yTickFormat(sparkline.y()(data[index[0]],index[0])));}
function sparklineHover(){if(paused)return;var pos=d3.mouse(this)[0]-margin.left;function getClosestIndex(data,x){var distance=Math.abs(sparkline.x()(data[0],0)-x);var closestIndex=0;for(var i=0;i<data.length;i++){if(Math.abs(sparkline.x()(data[i],i)-x)<distance){distance=Math.abs(sparkline.x()(data[i],i)-x);closestIndex=i;}}
return closestIndex;}
index=[getClosestIndex(data,Math.round(x.invert(pos)))];updateValueLine();}});return chart;}
chart.sparkline=sparkline;d3.rebind(chart,sparkline,'x','y','xScale','yScale','color');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xTickFormat=function(_){if(!arguments.length)return xTickFormat;xTickFormat=_;return chart;};chart.yTickFormat=function(_){if(!arguments.length)return yTickFormat;yTickFormat=_;return chart;};chart.showValue=function(_){if(!arguments.length)return showValue;showValue=_;return chart;};chart.alignValue=function(_){if(!arguments.length)return alignValue;alignValue=_;return chart;};chart.rightAlignValue=function(_){if(!arguments.length)return rightAlignValue;rightAlignValue=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};return chart;}
nv.models.stackedArea=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,color=nv.utils.defaultColor(),id=Math.floor(Math.random()*100000),getX=function(d){return d.x},getY=function(d){return d.y},style='stack',offset='zero',order='default',interpolate='linear',clipEdge=false,x,y,scatter=nv.models.scatter(),dispatch=d3.dispatch('tooltipShow','tooltipHide','areaClick','areaMouseover','areaMouseout');scatter.size(2.2).sizeDomain([2.2,2.2]);function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this);x=scatter.xScale();y=scatter.yScale();var dataRaw=data;data.forEach(function(aseries,i){aseries.seriesIndex=i;aseries.values=aseries.values.map(function(d,j){d.index=j;d.seriesIndex=i;return d;});});var dataFiltered=data.filter(function(series){return!series.disabled;});data=d3.layout.stack().order(order).offset(offset).values(function(d){return d.values}).x(getX).y(getY).out(function(d,y0,y){var yHeight=(getY(d)===0)?0:y;d.display={y:yHeight,y0:y0};})
(dataFiltered);var wrap=container.selectAll('g.nv-wrap.nv-stackedarea').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-stackedarea');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-areaWrap');gEnter.append('g').attr('class','nv-scatterWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');scatter.width(availableWidth).height(availableHeight).x(getX).y(function(d){return d.display.y+d.display.y0}).forceY([0]).color(data.map(function(d,i){return d.color||color(d,d.seriesIndex);}));var scatterWrap=g.select('.nv-scatterWrap').datum(data);scatterWrap.call(scatter);defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');var area=d3.svg.area().x(function(d,i){return x(getX(d,i))}).y0(function(d){return y(d.display.y0)}).y1(function(d){return y(d.display.y+d.display.y0)}).interpolate(interpolate);var zeroArea=d3.svg.area().x(function(d,i){return x(getX(d,i))}).y0(function(d){return y(d.display.y0)}).y1(function(d){return y(d.display.y0)});var path=g.select('.nv-areaWrap').selectAll('path.nv-area').data(function(d){return d});path.enter().append('path').attr('class',function(d,i){return'nv-area nv-area-'+i}).attr('d',function(d,i){return zeroArea(d.values,d.seriesIndex);}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.areaMouseover({point:d,series:d.key,pos:[d3.event.pageX,d3.event.pageY],seriesIndex:i});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.areaMouseout({point:d,series:d.key,pos:[d3.event.pageX,d3.event.pageY],seriesIndex:i});}).on('click',function(d,i){d3.select(this).classed('hover',false);dispatch.areaClick({point:d,series:d.key,pos:[d3.event.pageX,d3.event.pageY],seriesIndex:i});})
path.exit().transition().attr('d',function(d,i){return zeroArea(d.values,i)}).remove();path.style('fill',function(d,i){return d.color||color(d,d.seriesIndex)}).style('stroke',function(d,i){return d.color||color(d,d.seriesIndex)});path.transition().attr('d',function(d,i){return area(d.values,i)});scatter.dispatch.on('elementMouseover.area',function(e){g.select('.nv-chart-'+id+' .nv-area-'+e.seriesIndex).classed('hover',true);});scatter.dispatch.on('elementMouseout.area',function(e){g.select('.nv-chart-'+id+' .nv-area-'+e.seriesIndex).classed('hover',false);});chart.d3_stackedOffset_stackPercent=function(stackData){var n=stackData.length,m=stackData[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<dataRaw.length;i++)
o+=getY(dataRaw[i].values[j])
if(o)for(i=0;i<n;i++)
stackData[i][j][1]/=o;else
for(i=0;i<n;i++)
stackData[i][j][1]=k;}
for(j=0;j<m;++j)y0[j]=0;return y0;};});return chart;}
scatter.dispatch.on('elementClick.area',function(e){dispatch.areaClick(e);})
scatter.dispatch.on('elementMouseover.tooltip',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top],dispatch.tooltipShow(e);});scatter.dispatch.on('elementMouseout.tooltip',function(e){dispatch.tooltipHide(e);});chart.dispatch=dispatch;chart.scatter=scatter;d3.rebind(chart,scatter,'interactive','size','xScale','yScale','zScale','xDomain','yDomain','xRange','yRange','sizeDomain','forceX','forceY','forceSize','clipVoronoi','useVoronoi','clipRadius','highlightPoint','clearHighlights');chart.options=nv.utils.optionsFunc.bind(chart);chart.x=function(_){if(!arguments.length)return getX;getX=d3.functor(_);return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=d3.functor(_);return chart;}
chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.clipEdge=function(_){if(!arguments.length)return clipEdge;clipEdge=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.offset=function(_){if(!arguments.length)return offset;offset=_;return chart;};chart.order=function(_){if(!arguments.length)return order;order=_;return chart;};chart.style=function(_){if(!arguments.length)return style;style=_;switch(style){case'stack':chart.offset('zero');chart.order('default');break;case'stream':chart.offset('wiggle');chart.order('inside-out');break;case'stream-center':chart.offset('silhouette');chart.order('inside-out');break;case'expand':chart.offset('expand');chart.order('default');break;case'stack_percent':chart.offset(chart.d3_stackedOffset_stackPercent);chart.order('default');break;}
return chart;};chart.interpolate=function(_){if(!arguments.length)return interpolate;interpolate=_;return chart;};return chart;}
nv.models.stackedAreaChart=function(){"use strict";var stacked=nv.models.stackedArea(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend(),interactiveLayer=nv.interactiveGuideline();var margin={top:30,right:25,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,useInteractiveGuideline=false,tooltips=true,tooltip=function(key,x,y,e,graph){return'<h3>'+key+'</h3>'+'<p>'+y+' on '+x+'</p>'},x,y,yAxisTickFormat=d3.format(',.2f'),state={style:stacked.style()},defaultState=null,noData='No Data Available.',dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState'),controlWidth=250,cData=['Stacked','Stream','Expanded'],controlLabels={},transitionDuration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient((rightAlignYAxis)?'right':'left');controls.updateState(false);var showTooltip=function(e,offsetElement){var left=e.pos[0]+(offsetElement.offsetLeft||0),top=e.pos[1]+(offsetElement.offsetTop||0),x=xAxis.tickFormat()(stacked.x()(e.point,e.pointIndex)),y=yAxis.tickFormat()(stacked.y()(e.point,e.pointIndex)),content=tooltip(e.series.key,x,y,e,chart);nv.tooltip.show([left,top],content,e.value<0?'n':'s',null,offsetElement);};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart);};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=stacked.xScale();y=stacked.yScale();var wrap=container.selectAll('g.nv-wrap.nv-stackedAreaChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-stackedAreaChart').append('g');var g=wrap.select('g');gEnter.append("rect").style("opacity",0);gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-stackedWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');gEnter.append('g').attr('class','nv-interactive');g.select("rect").attr("width",availableWidth).attr("height",availableHeight);if(showLegend){var legendWidth=(showControls)?availableWidth-controlWidth:availableWidth;legend.width(legendWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
g.select('.nv-legendWrap').attr('transform','translate('+(availableWidth-legendWidth)+','+(-margin.top)+')');}
if(showControls){var controlsData=[{key:controlLabels.stacked||'Stacked',metaKey:'Stacked',disabled:stacked.style()!='stack',style:'stack'},{key:controlLabels.stream||'Stream',metaKey:'Stream',disabled:stacked.style()!='stream',style:'stream'},{key:controlLabels.expanded||'Expanded',metaKey:'Expanded',disabled:stacked.style()!='expand',style:'expand'},{key:controlLabels.stack_percent||'Stack %',metaKey:'Stack_Percent',disabled:stacked.style()!='stack_percent',style:'stack_percent'}];controlWidth=(cData.length/3)*260;controlsData=controlsData.filter(function(d){return cData.indexOf(d.metaKey)!==-1;})
controls.width(controlWidth).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).call(controls);if(margin.top!=Math.max(controls.height(),legend.height())){margin.top=Math.max(controls.height(),legend.height());availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;}
g.select('.nv-controlsWrap').attr('transform','translate(0,'+(-margin.top)+')');}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
stacked.width(availableWidth).height(availableHeight)
var stackedWrap=g.select('.nv-stackedWrap').datum(data);stackedWrap.transition().call(stacked);if(showXAxis){xAxis.scale(x).ticks(availableWidth/100).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+availableHeight+')');g.select('.nv-x.nv-axis').transition().duration(0).call(xAxis);}
if(showYAxis){yAxis.scale(y).ticks(stacked.offset()=='wiggle'?0:availableHeight/36).tickSize(-availableWidth,0).setTickFormat((stacked.style()=='expand'||stacked.style()=='stack_percent')?d3.format('%'):yAxisTickFormat);g.select('.nv-y.nv-axis').transition().duration(0).call(yAxis);}
stacked.dispatch.on('areaClick.toggle',function(e){if(data.filter(function(d){return!d.disabled}).length===1)
data.forEach(function(d){d.disabled=false;});else
data.forEach(function(d,i){d.disabled=(i!=e.seriesIndex);});state.disabled=data.map(function(d){return!!d.disabled});dispatch.stateChange(state);chart.update();});legend.dispatch.on('stateChange',function(newState){state.disabled=newState.disabled;dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;stacked.style(d.style);state.style=stacked.style();dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){stacked.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());stacked.highlightPoint(i,pointIndex,true);var point=series.values[pointIndex];if(typeof point==='undefined')return;if(typeof singlePoint==='undefined')singlePoint=point;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));var tooltipValue=(stacked.style()=='expand')?point.display.y:chart.y()(point,pointIndex);allData.push({key:series.key,value:tooltipValue,color:color(series,series.seriesIndex),stackedValue:point.display});});allData.reverse();if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var yDistMax=Infinity,indexToHighlight=null;allData.forEach(function(series,i){if(yValue>=series.stackedValue.y0&&yValue<=(series.stackedValue.y0+series.stackedValue.y))
{indexToHighlight=i;return;}});if(indexToHighlight!=null)
allData[indexToHighlight].highlight=true;}
var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex));var valueFormatter=(stacked.style()=='expand')?function(d,i){return d3.format(".1%")(d);}:function(d,i){return yAxis.tickFormat()(d);};interactiveLayer.tooltip.position({left:pointXLocation+margin.left,top:e.mouseY+margin.top}).chartContainer(that.parentNode).enabled(tooltips).valueFormatter(valueFormatter).data({value:xValue,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){dispatch.tooltipHide();stacked.clearHighlights();});dispatch.on('tooltipShow',function(e){if(tooltips)showTooltip(e,that.parentNode);});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.style!=='undefined'){stacked.style(e.style);}
chart.update();});});return chart;}
stacked.dispatch.on('tooltipShow',function(e){e.pos=[e.pos[0]+margin.left,e.pos[1]+margin.top],dispatch.tooltipShow(e);});stacked.dispatch.on('tooltipHide',function(e){dispatch.tooltipHide(e);});dispatch.on('tooltipHide',function(){if(tooltips)nv.tooltip.cleanup();});chart.dispatch=dispatch;chart.stacked=stacked;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.interactiveLayer=interactiveLayer;d3.rebind(chart,stacked,'x','y','size','xScale','yScale','xDomain','yDomain','xRange','yRange','sizeDomain','interactive','useVoronoi','offset','order','style','clipEdge','forceX','forceY','forceSize','interpolate');chart.options=nv.utils.optionsFunc.bind(chart);chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);legend.color(color);stacked.color(color);return chart;};chart.showControls=function(_){if(!arguments.length)return showControls;showControls=_;return chart;};chart.showLegend=function(_){if(!arguments.length)return showLegend;showLegend=_;return chart;};chart.showXAxis=function(_){if(!arguments.length)return showXAxis;showXAxis=_;return chart;};chart.showYAxis=function(_){if(!arguments.length)return showYAxis;showYAxis=_;return chart;};chart.rightAlignYAxis=function(_){if(!arguments.length)return rightAlignYAxis;rightAlignYAxis=_;yAxis.orient((_)?'right':'left');return chart;};chart.useInteractiveGuideline=function(_){if(!arguments.length)return useInteractiveGuideline;useInteractiveGuideline=_;if(_===true){chart.interactive(false);chart.useVoronoi(false);}
return chart;};chart.tooltip=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.tooltips=function(_){if(!arguments.length)return tooltips;tooltips=_;return chart;};chart.tooltipContent=function(_){if(!arguments.length)return tooltip;tooltip=_;return chart;};chart.state=function(_){if(!arguments.length)return state;state=_;return chart;};chart.defaultState=function(_){if(!arguments.length)return defaultState;defaultState=_;return chart;};chart.noData=function(_){if(!arguments.length)return noData;noData=_;return chart;};chart.transitionDuration=function(_){if(!arguments.length)return transitionDuration;transitionDuration=_;return chart;};chart.controlsData=function(_){if(!arguments.length)return cData;cData=_;return chart;};chart.controlLabels=function(_){if(!arguments.length)return controlLabels;if(typeof _!=='object')return controlLabels;controlLabels=_;return chart;};yAxis.setTickFormat=yAxis.tickFormat;yAxis.tickFormat=function(_){if(!arguments.length)return yAxisTickFormat;yAxisTickFormat=_;return yAxis;};return chart;}})();;

/* /web_graph/static/src/js/graph_view.js defined in bundle 'web.assets_backend' */
openerp.web_graph=function(instance){'use strict';var _lt=instance.web._lt;var _t=instance.web._t;instance.web.views.add('graph','instance.web_graph.GraphView');instance.web_graph.GraphView=instance.web.View.extend({display_name:_lt('Graph'),view_type:'graph',init:function(parent,dataset,view_id,options){var self=this;this._super(parent,dataset,view_id,options);this.dataset=dataset;this.model=new instance.web.Model(dataset.model,{group_by_no_leaf:true});this.search_view=parent.searchview;this.col_search_field={get_context:function(){return{col_group_by:self.graph_widget.get_col_groupbys(),measures:self.graph_widget.get_current_measures()};},get_domain:function(){},get_groupby:function(){},};},view_loading:function(fields_view_get){var self=this,arch=fields_view_get.arch;this.widget_config={title:arch.attrs.string,stacked:(arch.attrs.stacked==='True'),mode:arch.attrs.type||'bar',measures:[],row_groupby:[],col_groupby:[],graph_view:this,};_.each(arch.children,function(field){var field_name=field.attrs.name;if(_.has(field.attrs,'interval')){field_name=field.attrs.name+':'+field.attrs.interval;}
switch(field.attrs.type){case'measure':self.widget_config.measures.push(field_name);break;case'col':self.widget_config.col_groupby.push(field_name);break;default:if('operator'in field.attrs){self.widget_config.measures.push(field_name);break;}
case'row':self.widget_config.row_groupby.push(field_name);}});if(self.widget_config.measures.length===0){self.widget_config.measures.push('__count');}},do_search:function(domain,context,group_by){if(this.ignore_do_search){this.ignore_do_search=false;return;}
var self=this,groupbys=this.get_groupbys_from_searchview(),col_group_by=groupbys.col_group_by,measures=groupbys.measures;if(!this.graph_widget){this.widget_config.context=_.clone(context);this.widget_config.context.group_by_no_leaf=true;if(group_by.length){this.widget_config.row_groupby=group_by;}
if(col_group_by.length){this.widget_config.col_groupby=col_group_by;}
if(measures.length){this.widget_config.measures=measures;}
this.graph_widget=new openerp.web_graph.Graph(this,this.model,domain,this.widget_config);this.graph_widget.appendTo(this.$el);this.ViewManager.on('switch_mode',this,function(e){if(e==='graph'){var group_bys=self.get_groupbys_from_searchview();this.graph_widget.set(domain,group_bys.group_by,group_bys.col_group_by,group_bys.measures);}});return;}
this.graph_widget.set(domain,group_by,col_group_by,measures);},get_groupbys_from_searchview:function(){var result={group_by:[],col_group_by:[],measures:[]},searchdata=this.search_view.build_search_data();_.each(searchdata.groupbys,function(data){data=(_.isString(data))?py.eval(data):data;result.group_by=result.group_by.concat(data.group_by);if(data.col_group_by){result.col_group_by=result.col_group_by.concat(data.col_group_by);}
if(data.measures){result.measures=result.measures.concat(data.measures);}});if(result.col_group_by.length){return result;}
_.each(searchdata.contexts,function(context){if(context.col_group_by){result.col_group_by=result.col_group_by.concat(context.col_group_by);}
if(context.measures){result.measures=result.measures.concat(context.measures);}});return result;},do_show:function(){this.do_push_state({});return this._super();},register_groupby:function(row_groupby,col_groupby){var query=this.search_view.query,groupbys=this.get_groupbys_from_searchview(),search_row_groupby=groupbys.group_by,search_col_groupby=groupbys.col_group_by,search_measures=groupbys.measures,row_gb_changed=!_.isEqual(_.pluck(row_groupby,'field'),search_row_groupby),col_gb_changed=!_.isEqual(_.pluck(col_groupby,'field'),search_col_groupby),measures_gb_changed=!_.isEqual(_.pluck(col_groupby,'field'),search_col_groupby);if(!_.has(this.search_view,'_s_groupby')){return;}
if(!row_gb_changed&&!col_gb_changed){return;}
var custom_groups=this.get_custom_filter_groupbys();row_groupby=row_groupby.slice(custom_groups.groupby.length);col_groupby=col_groupby.slice(custom_groups.col_groupby.length);if(row_gb_changed&&col_gb_changed){this.ignore_do_search=true;}
if(row_gb_changed){var row_facet=this.make_row_groupby_facets(row_groupby),row_search_facet=query.findWhere({category:'GroupBy'});if(row_search_facet){row_search_facet.values.reset(row_facet.values,{focus_input:false});}else{if(row_groupby.length){query.add(row_facet);}}}
if(col_gb_changed){var col_facet=this.make_col_groupby_facets(col_groupby),col_search_facet=query.findWhere({category:'ColGroupBy'});if(col_search_facet){col_search_facet.values.reset(col_facet.values,{focus_input:false});}else{if(col_groupby.length){query.add(col_facet);}}}},make_row_groupby_facets:function(groupbys){return{category:'GroupBy',values:this.make_groupby_values(groupbys,'group_by'),icon:'w',field:this.search_view._s_groupby};},make_col_groupby_facets:function(groupbys){return{category:'ColGroupBy',values:this.make_groupby_values(groupbys,'col_group_by'),icon:'f',field:this.col_search_field};},make_groupby_values:function(groupbys,category){return _.map(groupbys,function(groupby){var context={};context[category]=groupby.field;var value;if(category==='group_by'&&groupby.type!=='date'&&groupby.type!=='datetime'){value=groupby.filter||{attrs:{domain:[],context:context}};}else{value={attrs:{domain:[],context:context}};}
return{label:groupby.string,value:value};});},get_custom_filter_groupbys:function(){var gb=[],col_gb=[];var facet=this.search_view.query.at(0);if(facet){if(facet.get('category')!=='GroupBy'&&facet.get('category')!=='ColGroupBy'){gb=get_groupby(facet);col_gb=get_col_groupby(facet);}}
return{groupby:gb,col_groupby:col_gb,}}});function get_groupby(facet){var field=facet.get('field'),result=[];if('get_groupby'in field){result=instance.web.pyeval.sync_eval_domains_and_contexts({group_by_seq:field.get_groupby(facet)}).group_by;}
return result;}
function get_col_groupby(facet){var field=facet.get('field'),result=[];if('get_context'in field){result=instance.web.pyeval.sync_eval_domains_and_contexts({contexts:field.get_context(facet)}).context.col_group_by||[];}
return result;}};;

/* /web_graph/static/src/js/pivot_table.js defined in bundle 'web.assets_backend' */
(function(){'use strict';var _lt=openerp.web._lt;var _t=openerp.web._t;openerp.web_graph.PivotTable=openerp.web.Class.extend({init:function(model,domain,fields,options){this.cells=[];this.domain=domain;this.context=options.context;this.no_data=true;this.updating=false;this.model=model;this.fields=fields;this.fields.__count={type:'integer',string:_t('Count')};this.measures=options.measures||[];this.rows={groupby:options.row_groupby,headers:null};this.cols={groupby:options.col_groupby,headers:null};},set_measures:function(measures){this.measures=measures;return this.update_data();},toggle_measure:function(measure){var current_measure=_.findWhere(this.measures,measure);if(current_measure){var index=this.measures.indexOf(current_measure);this.measures=_.without(this.measures,current_measure);if(this.measures.length===0){this.no_data=true;}else{_.each(this.cells,function(cell){cell.values.splice(index,1);});}
return $.Deferred().resolve();}else{this.measures.push(measure);return this.update_data();}},set:function(domain,row_groupby,col_groupby,measures_groupby){var self=this;if(this.updating){return this.updating.then(function(){self.updating=false;return self.set(domain,row_groupby,col_groupby,measures_groupby);});}
var row_gb_changed=!_.isEqual(row_groupby,this.rows.groupby),col_gb_changed=!_.isEqual(col_groupby,this.cols.groupby),measures_gb_changed=!_.isEqual(measures_groupby,this.measures);this.domain=domain;this.rows.groupby=row_groupby;this.cols.groupby=col_groupby;if(measures_groupby.length){this.measures=measures_groupby;}
if(row_gb_changed){this.rows.headers=null;}
if(col_gb_changed){this.cols.headers=null;}
if(measures_gb_changed&&measures_groupby.length){this.set_measures(measures_groupby);}
return this.update_data();},add_cell:function(id1,id2,values){this.cells.push({x:Math.min(id1,id2),y:Math.max(id1,id2),values:values});},get_values:function(id1,id2,default_values){var cells=this.cells,x=Math.min(id1,id2),y=Math.max(id1,id2);for(var i=0;i<cells.length;i++){if(cells[i].x==x&&cells[i].y==y){return cells[i].values;}}
return(default_values||new Array(this.measures.length));},is_row:function(id){return!!_.findWhere(this.rows.headers,{id:id});},is_col:function(id){return!!_.findWhere(this.cols.headers,{id:id});},get_header:function(id){return _.findWhere(this.rows.headers.concat(this.cols.headers),{id:id});},_get_headers_with_depth:function(headers,depth){return _.filter(headers,function(header){return header.path.length===depth;});},get_cols_with_depth:function(depth){return this._get_headers_with_depth(this.cols.headers,depth);},get_rows_with_depth:function(depth){return this._get_headers_with_depth(this.rows.headers,depth);},get_ancestor_leaves:function(header){return _.where(this.get_ancestors_and_self(header),{expanded:false});},get_rows_leaves:function(){return _.where(this.rows.headers,{expanded:false});},get_cols_leaves:function(){return _.where(this.cols.headers,{expanded:false});},get_ancestors:function(header){var self=this;if(!header.children)return[];return[].concat.apply([],_.map(header.children,function(c){return self.get_ancestors_and_self(c);}));},get_ancestors_and_self:function(header){var self=this;return[].concat.apply([header],_.map(header.children,function(c){return self.get_ancestors_and_self(c);}));},get_total:function(header){return(header)?this.get_values(header.id,this.get_other_root(header).headers[0].id):this.get_values(this.rows.headers[0].id,this.cols.headers[0].id);},get_other_root:function(header){return(header.root===this.rows)?this.cols:this.rows;},main_row:function(){return this.rows.headers[0];},main_col:function(){return this.cols.headers[0];},fold:function(header){var ancestors=this.get_ancestors(header),removed_ids=_.pluck(ancestors,'id');header.root.headers=_.difference(header.root.headers,ancestors);header.children=[];header.expanded=false;this.cells=_.reject(this.cells,function(cell){return(_.contains(removed_ids,cell.x)||_.contains(removed_ids,cell.y));});var new_groupby_length=_.max(_.pluck(_.pluck(header.root.headers,'path'),'length'));if(new_groupby_length<header.root.groupby.length){header.root.groupby.splice(new_groupby_length);return true;}
return false;},fold_with_depth:function(root,depth){var self=this;_.each(this._get_headers_with_depth(root.headers,depth),function(header){self.fold(header);});},expand_all:function(){this.rows.headers=null;this.cols.headers=null;return this.update_data();},expand:function(header_id,groupby){var self=this,header=this.get_header(header_id),other_root=this.get_other_root(header),this_gb=[groupby.field],other_gbs=_.pluck(other_root.groupby,'field');if(header.path.length===header.root.groupby.length){header.root.groupby.push(groupby);}
return this.perform_requests(this_gb,other_gbs,header.domain).then(function(){var data=Array.prototype.slice.call(arguments).slice(other_gbs.length+1);_.each(data,function(data_pt){self.make_headers_and_cell(data_pt,header.root.headers,other_root.headers,1,header.path,true);});header.expanded=true;header.children.forEach(function(child){child.expanded=false;child.root=header.root;});});},swap_axis:function(){var temp=this.rows;this.rows=this.cols;this.cols=temp;},update_data:function(){var self=this;this.updating=this.perform_requests().then(function(){var data=Array.prototype.slice.call(arguments);self.no_data=!data[0].length;if(self.no_data){return;}
var row_headers=[],col_headers=[];self.cells=[];var dim_col=self.cols.groupby.length,i,j,index;for(i=0;i<self.rows.groupby.length+1;i++){for(j=0;j<dim_col+1;j++){index=i*(dim_col+1)+j;self.make_headers_and_cell(data[index],row_headers,col_headers,i);}}
self.set_headers(row_headers,self.rows);self.set_headers(col_headers,self.cols);});return this.updating;},make_headers_and_cell:function(data_pts,row_headers,col_headers,index,prefix,expand){var self=this;data_pts.forEach(function(data_pt){var row_value=(prefix||[]).concat(data_pt.attributes.value.slice(0,index));var col_value=data_pt.attributes.value.slice(index);if(expand&&!_.find(col_headers,function(hdr){return self.isEqual(col_value,hdr.path);})){return;}
var row=self.find_or_create_header(row_headers,row_value,data_pt);var col=self.find_or_create_header(col_headers,col_value,data_pt);var cell_value=_.map(self.measures,function(m){return data_pt.attributes.aggregates[m.field];});self.cells.push({x:Math.min(row.id,col.id),y:Math.max(row.id,col.id),values:cell_value});});},make_header:function(values){return _.extend({children:[],domain:this.domain,expanded:undefined,id:_.uniqueId(),path:[],root:undefined,title:undefined},values||{});},find_or_create_header:function(headers,path,data_pt){var self=this;var hdr=_.find(headers,function(header){return self.isEqual(path,header.path);});if(hdr){return hdr;}
if(!path.length){hdr=this.make_header({title:_t('Total')});headers.push(hdr);return hdr;}
hdr=this.make_header({path:path,domain:data_pt.model._domain,title:_t(_.last(path))});var parent=_.find(headers,function(header){return self.isEqual(header.path,_.initial(path,1));});var previous=parent.children.length?_.last(parent.children):parent;headers.splice(headers.indexOf(previous)+1,0,hdr);parent.children.push(hdr);return hdr;},perform_requests:function(group1,group2,domain){var self=this,requests=[],row_gbs=_.pluck(this.rows.groupby,'field'),col_gbs=_.pluck(this.cols.groupby,'field'),field_list=row_gbs.concat(col_gbs,_.pluck(this.measures,'field')),fields=field_list.map(function(f){return self.raw_field(f);});group1=group1||row_gbs;group2=group2||col_gbs;var i,j,groupbys;for(i=0;i<group1.length+1;i++){for(j=0;j<group2.length+1;j++){groupbys=group1.slice(0,i).concat(group2.slice(0,j));requests.push(self.get_groups(groupbys,fields,domain||self.domain));}}
return $.when.apply(null,requests);},set_headers:function(new_headers,root){var self=this;if(root.headers){_.each(root.headers,function(header){var corresponding_header=_.find(new_headers,function(h){return self.isEqual(h.path,header.path);});if(corresponding_header&&header.expanded){corresponding_header.expanded=true;_.each(corresponding_header.children,function(c){c.expanded=false;});}
if(corresponding_header&&(!header.expanded)){corresponding_header.expanded=false;corresponding_header.children=[];}});var updated_headers=_.filter(new_headers,function(header){return(header.expanded!==undefined);});_.each(updated_headers,function(header){header.root=root;});root.headers=updated_headers;}else{root.headers=new_headers;_.each(root.headers,function(header){header.root=root;header.expanded=(header.children.length>0);});}
return new_headers;},get_groups:function(groupbys,fields,domain){var self=this;return this.model.query(_.without(fields,'__count')).filter(domain).context(this.context).lazy(false).group_by(groupbys).then(function(groups){return groups.filter(function(group){return group.attributes.length>0;}).map(function(group){var attrs=group.attributes,grouped_on=attrs.grouped_on instanceof Array?attrs.grouped_on:[attrs.grouped_on],raw_grouped_on=grouped_on.map(function(f){return self.raw_field(f);});if(grouped_on.length===1){attrs.value=[attrs.value];}
attrs.value=_.range(grouped_on.length).map(function(i){var grp=grouped_on[i],field=self.fields[grp];if(attrs.value[i]===false){return _t('Undefined');}else if(attrs.value[i]instanceof Array){return attrs.value[i][1];}else if(field&&field.type==='selection'){var selected=_.where(field.selection,{0:attrs.value[i]})[0];return selected?selected[1]:attrs.value[i];}
return attrs.value[i];});attrs.aggregates.__count=group.attributes.length;attrs.grouped_on=raw_grouped_on;return group;});});},raw_field:function(field){return field.split(':')[0];},isEqual:function(path1,path2){if(path1.length!==path2.length){return false;}
for(var i=0;i<path1.length;i++){if(path1[i]!==path2[i]){return false;}}
return true;},});})();;

/* /web_graph/static/src/js/graph_widget.js defined in bundle 'web.assets_backend' */
(function(){'use strict';var QWeb=openerp.web.qweb;var _lt=openerp.web._lt;var _t=openerp.web._t;nv.dev=false;openerp.web_graph.Graph=openerp.web.Widget.extend({template:'GraphWidget',init:function(parent,model,domain,options){this._super(parent);this.model=model;this.domain=domain;this.mode=options.mode||'pivot';this.heatmap_mode=options.heatmap_mode||'none';this.visible_ui=options.visible_ui||true;this.bar_ui=options.bar_ui||'group';this.graph_view=options.graph_view||null;this.pivot_options=options;this.title=options.title||'Data';},start:function(){var self=this;this.table=$('<table>');this.$('.graph_main_content').append(this.table);var indexes={'pivot':0,'bar':1,'line':2,'chart':3};this.$('.graph_mode_selection label').eq(indexes[this.mode]).addClass('active');if(this.mode!=='pivot'){this.$('.graph_heatmap label').addClass('disabled');this.$('.graph_main_content').addClass('graph_chart_mode');}else{this.$('.graph_main_content').addClass('graph_pivot_mode');}
var parent=this.getParent();while(!(parent instanceof openerp.web.ViewManager)){parent=parent.getParent();}
this.search_view=parent.searchview;openerp.session.rpc('/web_graph/check_xlwt').then(function(result){self.$('.graph_options_selection label').last().toggle(result);});return this.model.call('fields_get',{context:this.graph_view.dataset.context}).then(function(f){self.fields=f;self.fields.__count={field:'__count',type:'integer',string:_t('Count')};self.groupby_fields=self.get_groupby_fields();self.measure_list=self.get_measures();self.add_measures_to_options();self.pivot_options.row_groupby=self.create_field_values(self.pivot_options.row_groupby||[]);self.pivot_options.col_groupby=self.create_field_values(self.pivot_options.col_groupby||[]);self.pivot_options.measures=self.create_field_values(self.pivot_options.measures||[{field:'__count',type:'integer',string:'Count'}]);self.pivot=new openerp.web_graph.PivotTable(self.model,self.domain,self.fields,self.pivot_options);self.pivot.update_data().then(function(){self.display_data();if(self.graph_view){self.graph_view.register_groupby(self.pivot.rows.groupby,self.pivot.cols.groupby);}});openerp.web.bus.on('click',self,function(event){if(self.dropdown){self.$row_clicked=$(event.target).closest('tr');self.dropdown.remove();self.dropdown=null;}});self.put_measure_checkmarks();});},get_groupby_fields:function(){var search_fields=this.get_search_fields(),search_field_names=_.pluck(search_fields,'field'),other_fields=[],groupable_types=['many2one','char','boolean','selection','date','datetime'];_.each(this.fields,function(val,key){if(!_.contains(search_field_names,key)&&_.contains(groupable_types,val.type)&&val.store===true){other_fields.push({field:key,string:val.string,});}});return search_fields.concat(other_fields);},get_search_fields:function(){var self=this;var groupbygroups=_(this.search_view.drawer.inputs).select(function(g){return g instanceof openerp.web.search.GroupbyGroup;});var filters=_.flatten(_.pluck(groupbygroups,'filters'),true),groupbys=_.flatten(_.map(filters,function(filter){var groupby=py.eval(filter.attrs.context).group_by;if(!(groupby instanceof Array)){groupby=[groupby];}
return _.map(groupby,function(g){return{field:g,filter:filter};});}));return _.uniq(_.map(groupbys,function(groupby){var field=groupby.field,filter=groupby.filter,raw_field=field.split(':')[0],string=(field===raw_field)?filter.attrs.string:self.fields[raw_field].string;filter=(field===raw_field)?filter:undefined;return{field:raw_field,string:string,filter:filter};}),false,function(filter){return filter.field;});},get_measures:function(){return _.compact(_.map(this.fields,function(f,id){if(((f.type==='integer')||(f.type==='float'))&&(id!=='id')&&(f.store!==false)){return{field:id,type:f.type,string:f.string};}}));},add_measures_to_options:function(){this.$('.graph_measure_selection').append(_.map(this.measure_list,function(measure){return $('<li>').append($('<a>').attr('data-choice',measure.field).attr('href','#').text(measure.string));}));},set:function(domain,row_groupby,col_groupby,measures_groupby){if(!this.pivot){this.pivot_options.domain=domain;this.pivot_options.row_groupby=row_groupby;this.pivot_options.col_groupby=col_groupby;this.pivot_options.measures_groupby=measures_groupby;return;}
var row_gbs=this.create_field_values(row_groupby),col_gbs=this.create_field_values(col_groupby),measures_gbs=this.create_field_values(measures_groupby),dom_changed=!_.isEqual(this.pivot.domain,domain),row_gb_changed=!_.isEqual(row_gbs,this.pivot.rows.groupby),col_gb_changed=!_.isEqual(col_gbs,this.pivot.cols.groupby),measures_gb_changed=!_.isEqual(measures_gbs,this.pivot.measures),row_reduced=is_strict_beginning_of(row_gbs,this.pivot.rows.groupby),col_reduced=is_strict_beginning_of(col_gbs,this.pivot.cols.groupby),measures_reduced=is_strict_beginning_of(measures_gbs,this.pivot.measures);if(!dom_changed&&row_reduced&&!col_gb_changed&&!measures_gb_changed){this.pivot.fold_with_depth(this.pivot.rows,row_gbs.length);this.display_data();return;}
if(!dom_changed&&col_reduced&&!row_gb_changed&&!measures_gb_changed){this.pivot.fold_with_depth(this.pivot.cols,col_gbs.length);this.display_data();return;}
if(!dom_changed&&col_reduced&&row_reduced&&!measures_gb_changed){this.pivot.fold_with_depth(this.pivot.rows,row_gbs.length);this.pivot.fold_with_depth(this.pivot.cols,col_gbs.length);this.display_data();return;}
if(dom_changed||row_gb_changed||col_gb_changed||measures_gb_changed){this.pivot.set(domain,row_gbs,col_gbs,measures_gbs).then(this.proxy('display_data'));}
if(measures_gb_changed){this.put_measure_checkmarks();}},set_mode:function(mode){this.mode=mode;if(mode==='pivot'){this.$('.graph_heatmap label').removeClass('disabled');this.$('.graph_main_content').removeClass('graph_chart_mode').addClass('graph_pivot_mode');}else{this.$('.graph_heatmap label').addClass('disabled');this.$('.graph_main_content').removeClass('graph_pivot_mode').addClass('graph_chart_mode');}
this.display_data();},set_heatmap_mode:function(mode){this.heatmap_mode=mode;if(mode==='none'){this.$('.graph_heatmap label').removeClass('disabled');this.$('.graph_heatmap label').removeClass('active');}
this.display_data();},create_field_value:function(f){var field=(_.contains(f,':'))?f.split(':')[0]:f,groupby_field=_.findWhere(this.groupby_fields,{field:field}),string=groupby_field?groupby_field.string:this.fields[field].string,result={field:f,string:string,type:this.fields[field].type,digits:this.fields[field].digits};if(groupby_field){result.filter=groupby_field.filter;}
return result;},create_field_values:function(field_ids){return _.map(field_ids,this.proxy('create_field_value'));},get_col_groupbys:function(){return _.pluck(this.pivot.cols.groupby,'field');},get_current_measures:function(){return _.pluck(this.pivot.measures,'field');},events:{'click .graph_mode_selection label':'mode_selection','click .graph_measure_selection li':'measure_selection','click .graph_options_selection label':'option_selection','click .graph_heatmap label':'heatmap_mode_selection','click .web_graph_click':'header_cell_clicked','click a.field-selection':'field_selection',},mode_selection:function(event){event.preventDefault();var mode=event.currentTarget.getAttribute('data-mode');this.set_mode(mode);},measure_selection:function(event){event.preventDefault();event.stopPropagation();var measure_field=event.target.getAttribute('data-choice');var measure=this.create_field_value(measure_field);this.pivot.toggle_measure(measure).then(this.proxy('display_data'));this.put_measure_checkmarks();},put_measure_checkmarks:function(){var self=this,measures_li=this.$('.graph_measure_selection a');measures_li.removeClass('oe_selected');_.each(this.measure_list,function(measure,index){if(_.findWhere(self.pivot.measures,measure)){measures_li.eq(index).addClass('oe_selected');}});},option_selection:function(event){event.preventDefault();switch(event.currentTarget.getAttribute('data-choice')){case'swap_axis':this.swap_axis();break;case'expand_all':this.pivot.expand_all().then(this.proxy('display_data'));break;case'update_values':this.pivot.update_data().then(this.proxy('display_data'));break;case'export_data':this.export_xls();break;}},heatmap_mode_selection:function(event){event.preventDefault();var mode=event.currentTarget.getAttribute('data-mode');if(this.heatmap_mode===mode){event.stopPropagation();this.set_heatmap_mode('none');}else{this.set_heatmap_mode(mode);}},header_cell_clicked:function(event){event.preventDefault();event.stopPropagation();var id=event.target.getAttribute('data-id'),header=this.pivot.get_header(id),self=this;if(header.expanded){if(header.root===this.pivot.rows){this.fold_row(header,event);}else{this.fold_col(header);}
return;}
if(header.path.length<header.root.groupby.length){this.$row_clicked=$(event.target).closest('tr');this.expand(id);return;}
if(!this.groupby_fields.length){return;}
var fields=_.map(this.groupby_fields,function(field){return{id:field.field,value:field.string,type:self.fields[field.field.split(':')[0]].type};});if(this.dropdown){this.dropdown.remove();}
this.dropdown=$(QWeb.render('field_selection',{fields:fields,header_id:id}));$(event.target).after(this.dropdown);this.dropdown.css({position:'absolute',left:event.originalEvent.layerX,});this.$('.field-selection').next('.dropdown-menu').first().toggle();},field_selection:function(event){var id=event.target.getAttribute('data-id'),field_id=event.target.getAttribute('data-field-id'),interval,groupby=this.create_field_value(field_id);event.preventDefault();if(this.fields[field_id].type==='date'||this.fields[field_id].type==='datetime'){interval=event.target.getAttribute('data-interval');groupby.field=groupby.field+':'+interval;}
this.expand(id,groupby);},expand:function(header_id,groupby){var self=this,header=this.pivot.get_header(header_id),update_groupby=!!groupby;groupby=groupby||header.root.groupby[header.path.length];this.pivot.expand(header_id,groupby).then(function(){if(header.root===self.pivot.rows){var rows=self.build_rows(header.children);var doc_fragment=$(document.createDocumentFragment());rows.map(function(row){doc_fragment.append(self.draw_row(row,0));});self.$row_clicked.after(doc_fragment);}else{self.display_data();}
if(update_groupby&&self.graph_view){self.graph_view.register_groupby(self.pivot.rows.groupby,self.pivot.cols.groupby);}});},fold_row:function(header,event){var rows_before=this.pivot.rows.headers.length,update_groupby=this.pivot.fold(header),rows_after=this.pivot.rows.headers.length,rows_removed=rows_before-rows_after;if(rows_after===1){this.display_data();}else{var $row=$(event.target).parent().parent();$row.nextAll().slice(0,rows_removed).remove();}
if(update_groupby&&this.graph_view){this.graph_view.register_groupby(this.pivot.rows.groupby,this.pivot.cols.groupby);}},fold_col:function(header){var update_groupby=this.pivot.fold(header);this.display_data();if(update_groupby&&this.graph_view){this.graph_view.register_groupby(this.pivot.rows.groupby,this.pivot.cols.groupby);}},swap_axis:function(){this.pivot.swap_axis();this.display_data();this.graph_view.register_groupby(this.pivot.rows.groupby,this.pivot.cols.groupby);},build_table:function(raw){return{headers:this.build_headers(),measure_row:this.build_measure_row(),rows:this.build_rows(this.pivot.rows.headers,raw),nbr_measures:this.pivot.measures.length,title:this.title,};},build_headers:function(){var pivot=this.pivot,nbr_measures=pivot.measures.length,height=_.max(_.map(pivot.cols.headers,function(g){return g.path.length;}))+1,rows=[];_.each(pivot.cols.headers,function(col){var cell_width=nbr_measures*(col.expanded?pivot.get_ancestor_leaves(col).length:1),cell_height=col.expanded?1:height-col.path.length,cell={width:cell_width,height:cell_height,title:col.title,id:col.id,expanded:col.expanded};if(rows[col.path.length]){rows[col.path.length].push(cell);}else{rows[col.path.length]=[cell];}});if(pivot.get_cols_leaves().length>1){rows[0].push({width:nbr_measures,height:height,title:' ',id:pivot.main_col().id});}
if(pivot.cols.headers.length===1){rows=[[{width:nbr_measures,height:1,title:_t('Total'),id:pivot.main_col().id,expanded:false}]];}
return rows;},build_measure_row:function(){var nbr_leaves=this.pivot.get_cols_leaves().length,nbr_cols=nbr_leaves+((nbr_leaves>1)?1:0),result=[],add_total=this.pivot.get_cols_leaves().length>1,i,m;for(i=0;i<nbr_cols;i++){for(m=0;m<this.pivot.measures.length;m++){result.push({text:this.pivot.measures[m].string,is_bold:add_total&&(i===nbr_cols-1)});}}
return result;},make_cell:function(row,col,value,index,raw){var formatted_value=raw&&!_.isUndefined(value)?value:openerp.web.format_value(value,this.pivot.measures[index]),cell={value:formatted_value};if(this.heatmap_mode==='none'){return cell;}
var total=(this.heatmap_mode==='both')?this.pivot.get_total()[index]:(this.heatmap_mode==='row')?this.pivot.get_total(row)[index]:this.pivot.get_total(col)[index];var color=Math.floor(90+165*(total-Math.abs(value))/total);if(color<255){cell.color=color;}
return cell;},build_rows:function(headers,raw){var self=this,pivot=this.pivot,m,i,j,k,cell,row;var rows=[];var cells,pivot_cells,values;var nbr_of_rows=headers.length;var col_headers=pivot.get_cols_leaves();for(i=0;i<nbr_of_rows;i++){row=headers[i];cells=[];pivot_cells=[];for(j=0;j<pivot.cells.length;j++){if(pivot.cells[j].x==row.id||pivot.cells[j].y==row.id){pivot_cells.push(pivot.cells[j]);}}
for(j=0;j<col_headers.length;j++){values=undefined;for(k=0;k<pivot_cells.length;k++){if(pivot_cells[k].x==col_headers[j].id||pivot_cells[k].y==col_headers[j].id){values=pivot_cells[k].values;break;}}
if(!values){values=new Array(pivot.measures.length);}
for(m=0;m<pivot.measures.length;m++){cells.push(self.make_cell(row,col_headers[j],values[m],m,raw));}}
if(col_headers.length>1){var totals=pivot.get_total(row);for(m=0;m<pivot.measures.length;m++){cell=self.make_cell(row,pivot.cols.headers[0],totals[m],m,raw);cell.is_bold='true';cells.push(cell);}}
rows.push({id:row.id,indent:row.path.length,title:row.title,expanded:row.expanded,cells:cells,});}
return rows;},display_data:function(){var scroll=$(window).scrollTop();this.$('.graph_main_content svg').remove();this.$('.graph_main_content div').remove();this.table.empty();this.table.toggleClass('heatmap',this.heatmap_mode!=='none');this.$('.graph_options_selection label').last().toggleClass('disabled',this.pivot.no_data);this.width=this.$el.width();this.height=Math.min(Math.max(document.documentElement.clientHeight-116-60,250),Math.round(0.8*this.$el.width()));this.$('.graph_header').toggle(this.visible_ui);if(this.pivot.no_data){this.$('.graph_main_content').append($(QWeb.render('graph_no_data')));}else{if(this.mode==='pivot'){this.draw_table();$(window).scrollTop(scroll);}else{this.$('.graph_main_content').append($('<div><svg>'));this.svg=this.$('.graph_main_content svg')[0];this[this.mode]();}}},draw_table:function(){var custom_gbs=this.graph_view.get_custom_filter_groupbys(),frozen_rows=custom_gbs.groupby.length,frozen_cols=custom_gbs.col_groupby.length;var table=this.build_table();var doc_fragment=$(document.createDocumentFragment());this.draw_headers(table.headers,doc_fragment,frozen_cols);this.draw_measure_row(table.measure_row,doc_fragment);this.draw_rows(table.rows,doc_fragment,frozen_rows);this.table.append(doc_fragment);},make_header_cell:function(header,frozen){var cell=(_.has(header,'cells')?$('<td>'):$('<th>')).addClass('graph_border').attr('rowspan',header.height).attr('colspan',header.width);var $content=$('<span>').attr('href','#').text(' '+(header.title||_t('Undefined'))).css('margin-left',header.indent*30+'px').attr('data-id',header.id);if(_.has(header,'expanded')){if(('indent'in header)&&header.indent>=frozen){$content.addClass(header.expanded?'fa fa-minus-square':'fa fa-plus-square');$content.addClass('web_graph_click');}
if(!('indent'in header)&&header.lvl>=frozen){$content.addClass(header.expanded?'fa fa-minus-square':'fa fa-plus-square');$content.addClass('web_graph_click');}}else{$content.css('font-weight','bold');}
return cell.append($content);},draw_headers:function(headers,doc_fragment,frozen_cols){var make_cell=this.make_header_cell,$empty_cell=$('<th>').attr('rowspan',headers.length),$thead=$('<thead>');_.each(headers,function(row,lvl){var $row=$('<tr>');_.each(row,function(header){header.lvl=lvl;$row.append(make_cell(header,frozen_cols));});$thead.append($row);});$thead.children(':first').prepend($empty_cell);doc_fragment.append($thead);this.$thead=$thead;},draw_measure_row:function(measure_row){var $row=$('<tr>').append('<th>');_.each(measure_row,function(cell){var $cell=$('<th>').addClass('measure_row').text(cell.text);if(cell.is_bold){$cell.css('font-weight','bold');}
$row.append($cell);});this.$thead.append($row);},draw_row:function(row,frozen_rows){var $row=$('<tr>').attr('data-indent',row.indent).append(this.make_header_cell(row,frozen_rows));var cells_length=row.cells.length;var cells_list=[];var cell,hcell;for(var j=0;j<cells_length;j++){cell=row.cells[j];hcell='<td';if(cell.is_bold||cell.color){hcell+=' style="';if(cell.is_bold)hcell+='font-weight: bold;';if(cell.color)hcell+='background-color:'+$.Color(255,cell.color,cell.color)+';';hcell+='"';}
hcell+='>'+cell.value+'</td>';cells_list[j]=hcell;}
return $row.append(cells_list.join(''));},draw_rows:function(rows,doc_fragment,frozen_rows){var rows_length=rows.length,$tbody=$('<tbody>');doc_fragment.append($tbody);for(var i=0;i<rows_length;i++){$tbody.append(this.draw_row(rows[i],frozen_rows));}},bar:function(){var self=this,dim_x=this.pivot.rows.groupby.length,dim_y=this.pivot.cols.groupby.length,show_controls=(this.width>400&&this.height>300&&dim_x+dim_y>=2),data;if((dim_x===0)&&(dim_y===0)){data=[{key:_t('Total'),values:[{x:_t('Total'),y:this.pivot.get_total()[0],}]}];}else if((dim_x===0)&&(dim_y>=1)){data=_.map(this.pivot.get_cols_with_depth(1),function(header){return{key:header.title,values:[{x:header.title,y:self.pivot.get_total(header)[0]}]};});}else if((dim_x===1)&&(dim_y===0)){data=_.map(this.pivot.main_row().children,function(pt){var value=self.pivot.get_total(pt)[0],title=(pt.title!==undefined)?pt.title:_t('Undefined');return{x:title,y:value};});data=[{key:self.pivot.measures[0].string,values:data}];}else if((dim_x===1)&&(dim_y>=1)){data=_.map(this.pivot.get_cols_with_depth(1),function(colhdr){var values=_.map(self.pivot.get_rows_with_depth(1),function(header){return{x:header.title||_t('Undefined'),y:self.pivot.get_values(header.id,colhdr.id)[0]||0};});return{key:colhdr.title||_t('Undefined'),values:values};});}else{var keys=_.uniq(_.map(this.pivot.get_rows_with_depth(2),function(hdr){return hdr.title||_t('Undefined');}));data=_.map(keys,function(key){var values=_.map(self.pivot.get_rows_with_depth(1),function(hdr){var subhdr=_.find(hdr.children,function(child){return((child.title===key)||((child.title===undefined)&&(key===_t('Undefined'))));});return{x:hdr.title||_t('Undefined'),y:(subhdr)?self.pivot.get_total(subhdr)[0]:0};});return{key:key,values:values};});}
nv.addGraph(function(){var chart=nv.models.multiBarChart().reduceXTicks(false).stacked(self.bar_ui==='stack').showControls(show_controls);if(self.width/data[0].values.length<80){chart.rotateLabels(-15);chart.reduceXTicks(true);chart.margin({bottom:40});}
d3.select(self.svg).datum(data).attr('width',self.width).attr('height',self.height).call(chart);nv.utils.windowResize(chart.update);return chart;});},line:function(){var self=this,dim_x=this.pivot.rows.groupby.length,dim_y=this.pivot.cols.groupby.length;var rows=this.pivot.get_rows_with_depth(dim_x),labels=_.pluck(rows,'title');var data=_.map(this.pivot.get_cols_leaves(),function(col){var values=_.map(rows,function(row,index){return{x:index,y:self.pivot.get_values(row.id,col.id)[0]||0};});var title=_.map(col.path,function(p){return p||_t('Undefined');}).join('/');if(dim_y===0){title=self.pivot.measures[0].string;}
return{values:values,key:title};});nv.addGraph(function(){var chart=nv.models.lineChart().x(function(d,u){return u;});chart.xAxis.tickFormat(function(d,u){return labels[d];});d3.select(self.svg).attr('width',self.width).attr('height',self.height).datum(data).call(chart);return chart;});},pie:function(){var self=this,dim_x=this.pivot.rows.groupby.length;var data=_.map(this.pivot.get_rows_leaves(),function(row){var title=_.map(row.path,function(p){return p||_t('Undefined');}).join('/');if(dim_x===0){title=self.measure_label;}
return{x:title,y:self.pivot.get_total(row)[0]};});nv.addGraph(function(){var chart=nv.models.pieChart().width(self.width).height(self.height).color(d3.scale.category10().range());d3.select(self.svg).datum(data).transition().duration(1200).attr('width',self.width).attr('height',self.height).call(chart);nv.utils.windowResize(chart.update);return chart;});},export_xls:function(){var c=openerp.webclient.crashmanager;openerp.web.blockUI();this.session.get_file({url:'/web_graph/export_xls',data:{data:JSON.stringify(this.build_table(true))},complete:openerp.web.unblockUI,error:c.rpc_error.bind(c)});},});function is_strict_beginning_of(array1,array2){if(array1.length>=array2.length){return false;}
var result=true;for(var i=0;i<array1.length;i++){if(!_.isEqual(array1[i],array2[i])){return false;}}
return result;}})();;

/* /web_kanban/static/src/js/kanban.js defined in bundle 'web.assets_backend' */
openerp.web_kanban=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.views.add('kanban','instance.web_kanban.KanbanView');instance.web_kanban.KanbanView=instance.web.View.extend({template:"KanbanView",display_name:_lt('Kanban'),default_nr_columns:1,view_type:"kanban",quick_create_class:"instance.web_kanban.QuickCreate",number_of_color_schemes:10,init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,options);var self=this;_.defaults(this.options,{"quick_creatable":true,"creatable":true,"create_text":undefined,"read_only_mode":false,"confirm_on_delete":true,});this.fields_view={};this.fields_keys=[];this.group_by=null;this.group_by_field={};this.grouped_by_m2o=false;this.many2manys=[];this.state={groups:{},records:{}};this.groups=[];this.aggregates={};this.group_operators=['avg','max','min','sum','count'];this.qweb=new QWeb2.Engine();this.qweb.debug=instance.session.debug;this.qweb.default_dict=_.clone(QWeb.default_dict);this.has_been_loaded=$.Deferred();this.search_domain=this.search_context=this.search_group_by=null;this.currently_dragging={};this.limit=options.limit||40;this.add_group_mutex=new $.Mutex();},view_loading:function(r){return this.load_kanban(r);},start:function(){var self=this;this._super.apply(this,arguments);this.$el.on('click','.oe_kanban_dummy_cell',function(){if(self.$buttons){self.$buttons.find('.oe_kanban_add_column').openerpBounce();}});},destroy:function(){this._super.apply(this,arguments);$('html').off('click.kanban');},load_kanban:function(data){this.fields_view=data;var default_order=this.fields_view.arch.attrs.default_order,unsorted=!this.dataset._sort.length;if(unsorted&&default_order){this.dataset.set_sort(default_order.split(','));}
this.$el.addClass(this.fields_view.arch.attrs['class']);this.$buttons=$(QWeb.render("KanbanView.buttons",{'widget':this}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}else{this.$el.find('.oe_kanban_buttons').replaceWith(this.$buttons);}
this.$buttons.on('click','button.oe_kanban_button_new',this.do_add_record).on('click','.oe_kanban_add_column',this.do_add_group);this.$groups=this.$el.find('.oe_kanban_groups tr');this.fields_keys=_.keys(this.fields_view.fields);this.add_qweb_template();this.has_been_loaded.resolve();this.trigger('kanban_view_loaded',data);return $.when();},_is_quick_create_enabled:function(){if(!this.options.quick_creatable||!this.is_action_enabled('create'))
return false;if(this.fields_view.arch.attrs.quick_create!==undefined)
return JSON.parse(this.fields_view.arch.attrs.quick_create);return!!this.group_by;},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable)
return false;return this._super(action);},add_qweb_template:function(){for(var i=0,ii=this.fields_view.arch.children.length;i<ii;i++){var child=this.fields_view.arch.children[i];if(child.tag==="templates"){this.transform_qweb_template(child);this.qweb.add_template(instance.web.json_node_to_xml(child));break;}else if(child.tag==='field'){this.extract_aggregates(child);}}},extract_aggregates:function(node){for(var j=0,jj=this.group_operators.length;j<jj;j++){if(node.attrs[this.group_operators[j]]){this.aggregates[node.attrs.name]=node.attrs[this.group_operators[j]];break;}}},transform_qweb_template:function(node){var qweb_add_if=function(node,condition){if(node.attrs[QWeb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[QWeb.prefix+'-if'],condition);}
node.attrs[QWeb.prefix+'-if']=condition;};if(node.tag&&node.attrs.modifiers){var modifiers=JSON.parse(node.attrs.modifiers||'{}');if(modifiers.invisible){qweb_add_if(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'field':var ftype=this.fields_view.fields[node.attrs.name].type;ftype=node.attrs.widget?node.attrs.widget:ftype;if(ftype==='many2many'){if(_.indexOf(this.many2manys,node.attrs.name)<0){this.many2manys.push(node.attrs.name);}
node.tag='div';node.attrs['class']=(node.attrs['class']||'')+' oe_form_field oe_tags';}else if(instance.web_kanban.fields_registry.contains(ftype)){}else{node.tag=QWeb.prefix;node.attrs[QWeb.prefix+'-esc']='record.'+node.attrs['name']+'.value';}
break;case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!=-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.attrs['data-icon']){node.children=[{tag:'img',attrs:{src:instance.session.prefix+'/web/static/src/img/icons/'+node.attrs['data-icon']+'.png',width:'16',height:'16'}}];}
if(node.tag=='a'){node.attrs.href='#';}else{node.attrs.type='button';}
node.attrs['class']=(node.attrs['class']||'')+' oe_kanban_action oe_kanban_action_'+node.tag;}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){this.transform_qweb_template(node.children[i]);}}},do_add_record:function(){this.dataset.index=null;this.do_switch_view('form');},do_add_group:function(){var self=this;self.do_action({name:_t("Add column"),res_model:self.group_by_field.relation,views:[[false,'form']],type:'ir.actions.act_window',target:"new",context:self.dataset.get_context(),flags:{action_buttons:true,}});var am=instance.webclient.action_manager;var form=am.dialog_widget.views.form.controller;form.on("on_button_cancel",am.dialog,am.dialog.close);form.on('record_created',self,function(r){(new instance.web.DataSet(self,self.group_by_field.relation)).name_get([r]).done(function(new_record){am.dialog.close();var domain=self.dataset.domain.slice(0);domain.push([self.group_by,'=',new_record[0][0]]);var dataset=new instance.web.DataSetSearch(self,self.dataset.model,self.dataset.get_context(),domain);var datagroup={get:function(key){return this[key];},value:new_record[0],length:0,aggregates:{},};var new_group=new instance.web_kanban.KanbanGroup(self,[],datagroup,dataset);self.do_add_groups([new_group]).done(function(){$(window).scrollTo(self.groups.slice(-1)[0].$el,{axis:'x'});});});});},do_search:function(domain,context,group_by){var self=this;this.search_domain=domain;this.search_context=context;this.search_group_by=group_by;return $.when(this.has_been_loaded).then(function(){self.group_by=group_by.length?group_by[0]:self.fields_view.arch.attrs.default_group_by;self.group_by_field=self.fields_view.fields[self.group_by]||{};self.grouped_by_m2o=(self.group_by_field.type==='many2one');self.$buttons.find('.oe_alternative').toggle(self.grouped_by_m2o);self.$el.toggleClass('oe_kanban_grouped_by_m2o',self.grouped_by_m2o);var grouping_fields=self.group_by?[self.group_by].concat(_.keys(self.aggregates)):undefined;if(!_.isEmpty(grouping_fields)){self.fields_keys=_.unique(self.fields_keys.concat(grouping_fields));}
var grouping=new instance.web.Model(self.dataset.model,context,domain).query(self.fields_keys).group_by(grouping_fields);return self.alive($.when(grouping)).done(function(groups){self.remove_no_result();if(groups){self.do_process_groups(groups);}else{self.do_process_dataset();}});});},do_process_groups:function(groups){var self=this;this.$el.find('table:first').show();this.$el.removeClass('oe_kanban_ungrouped').addClass('oe_kanban_grouped');this.add_group_mutex.exec(function(){self.do_clear_groups();self.dataset.ids=[];if(!groups.length){self.no_result();return false;}
self.nb_records=0;var groups_array=[];return $.when.apply(null,_.map(groups,function(group,index){var def=$.when([]);var dataset=new instance.web.DataSetSearch(self,self.dataset.model,new instance.web.CompoundContext(self.dataset.get_context(),group.model.context()),group.model.domain());if(self.dataset._sort){dataset.set_sort(self.dataset._sort);}
if(group.attributes.length>=1){def=dataset.read_slice(self.fields_keys.concat(['__last_update']),{'limit':self.limit});}
return def.then(function(records){self.nb_records+=records.length;self.dataset.ids.push.apply(self.dataset.ids,dataset.ids);groups_array[index]=new instance.web_kanban.KanbanGroup(self,records,group,dataset);});})).then(function(){if(!self.nb_records){self.no_result();}
if(self.dataset.index>=self.nb_records){self.dataset.index=self.dataset.size()?0:null;}
return self.do_add_groups(groups_array);});});},do_process_dataset:function(){var self=this;this.$el.find('table:first').show();this.$el.removeClass('oe_kanban_grouped').addClass('oe_kanban_ungrouped');this.add_group_mutex.exec(function(){var def=$.Deferred();self.do_clear_groups();self.dataset.read_slice(self.fields_keys.concat(['__last_update']),{'limit':self.limit}).done(function(records){var kgroup=new instance.web_kanban.KanbanGroup(self,records,null,self.dataset);if(!_.isEmpty(self.dataset.ids)&&(self.dataset.index===null||self.dataset.index>=self.dataset.ids.length)){self.dataset.index=0;}else if(_.isEmpty(self.dataset.ids)){self.dataset.index=null;}
self.do_add_groups([kgroup]).done(function(){if(_.isEmpty(records)){self.no_result();}
def.resolve();});}).done(null,function(){def.reject();});return def;});},do_reload:function(){this.do_search(this.search_domain,this.search_context,this.search_group_by);},do_clear_groups:function(){var groups=this.groups.slice(0);this.groups=[];_.each(groups,function(group){group.destroy();});},do_add_groups:function(groups){var self=this;var $parent=this.$el.parent();this.$el.detach();_.each(groups,function(group){self.groups[group.undefined_title?'unshift':'push'](group);});var $last_td=self.$el.find('.oe_kanban_groups_headers td:last');var groups_started=_.map(this.groups,function(group){if(!group.is_started){group.on("add_record",self,function(){self.remove_no_result();});return group.insertBefore($last_td);}});return $.when.apply(null,groups_started).done(function(){self.on_groups_started();self.$el.appendTo($parent);_.each(self.groups,function(group){group.compute_cards_auto_height();});});},on_groups_started:function(){var self=this;if(this.group_by||this.fields_keys.indexOf("sequence")!==-1){var prev_widget,is_folded,record,$columns;if(this.group_by){$columns=this.$el.find('.oe_kanban_column .oe_kanban_column_cards, .oe_kanban_column .oe_kanban_folded_column_cards');}else{$columns=this.$el.find('.oe_kanban_column_cards');}
$columns.sortable({handle:'.oe_kanban_draghandle',start:function(event,ui){self.currently_dragging.index=ui.item.parent().children('.oe_kanban_record').index(ui.item);self.currently_dragging.group=prev_widget=ui.item.parents('.oe_kanban_column:first').data('widget');ui.item.find('*').on('click.prevent',function(ev){return false;});record=ui.item.data('widget');record.$el.bind('mouseup',function(ev,ui){if(is_folded){record.$el.hide();}
record.$el.unbind('mouseup');})
ui.placeholder.height(ui.item.height());},over:function(event,ui){var parent=$(event.target).parent();prev_widget.highlight(false);is_folded=parent.hasClass('oe_kanban_group_folded');if(is_folded){var widget=parent.data('widget');widget.highlight(true);prev_widget=widget;}},revert:150,stop:function(event,ui){prev_widget.highlight(false);var old_index=self.currently_dragging.index;var new_index=ui.item.parent().children('.oe_kanban_record').index(ui.item);var old_group=self.currently_dragging.group;var new_group=ui.item.parents('.oe_kanban_column:first').data('widget');if(!(old_group.title===new_group.title&&old_group.value===new_group.value&&old_index==new_index)){self.on_record_moved(record,old_group,old_index,new_group,new_index);}
setTimeout(function(){ui.item.find('*').off('click.prevent');},0);},scroll:false});$columns.sortable({connectWith:$columns});var start_index;if(this.grouped_by_m2o){this.$('.oe_kanban_groups_headers').sortable({items:'.oe_kanban_group_header',helper:'clone',axis:'x',opacity:0.5,scroll:false,start:function(event,ui){start_index=ui.item.index();self.$('.oe_kanban_record, .oe_kanban_quick_create').css({visibility:'hidden'});},stop:function(event,ui){var stop_index=ui.item.index();if(start_index!==stop_index){var $start_column=self.$('.oe_kanban_groups_records .oe_kanban_column').eq(start_index);var $stop_column=self.$('.oe_kanban_groups_records .oe_kanban_column').eq(stop_index);var method=(start_index>stop_index)?'insertBefore':'insertAfter';$start_column[method]($stop_column);var tmp_group=self.groups.splice(start_index,1)[0];self.groups.splice(stop_index,0,tmp_group);var new_sequence=_.pluck(self.groups,'value');(new instance.web.DataSet(self,self.group_by_field.relation)).resequence(new_sequence).done(function(r){if(r===false){console.error("Kanban: could not resequence model '%s'. Probably no 'sequence' field.",self.group_by_field.relation);}});}
self.$('.oe_kanban_record, .oe_kanban_quick_create').css({visibility:'visible'});}});}}else{this.$el.find('.oe_kanban_draghandle').removeClass('oe_kanban_draghandle');}
this.postprocess_m2m_tags();},on_record_moved:function(record,old_group,old_index,new_group,new_index){var self=this;record.$el.find('[title]').tooltip('destroy');$(old_group.$el).add(new_group.$el).find('.oe_kanban_aggregates, .oe_kanban_group_length').hide();if(old_group===new_group){new_group.records.splice(old_index,1);new_group.records.splice(new_index,0,record);new_group.do_save_sequences();}else{old_group.records.splice(old_index,1);new_group.records.splice(new_index,0,record);record.group=new_group;var data={};data[this.group_by]=new_group.value;this.dataset.write(record.id,data,{}).done(function(){record.do_reload();new_group.do_save_sequences();if(new_group.state.folded){new_group.do_action_toggle_fold();record.prependTo(new_group.$records.find('.oe_kanban_column_cards'));}}).fail(function(error,evt){evt.preventDefault();alert(_t("An error has occured while moving the record to this group: ")+error.data.message);self.do_reload();});}},do_show:function(){if(this.$buttons){this.$buttons.show();}
this.do_push_state({});return this._super();},do_hide:function(){if(this.$buttons){this.$buttons.hide();}
return this._super();},open_record:function(id,editable){if(this.dataset.select_id(id)){this.do_switch_view('form',null,{mode:editable?"edit":undefined});}else{this.do_warn("Kanban: could not find id#"+id);}},no_result:function(){var self=this;if(this.groups.group_by||!this.options.action||(!this.options.action.help&&!this.options.action.get_empty_list_help)){return;}
this.$el.css("position","relative");$(QWeb.render('KanbanView.nocontent',{content:this.options.action.get_empty_list_help||this.options.action.help})).insertBefore(this.$('table:first'));this.$el.find('.oe_view_nocontent').click(function(){self.$buttons.openerpBounce();});},remove_no_result:function(){this.$el.css("position","");this.$el.find('.oe_view_nocontent').remove();},postprocess_m2m_tags:function(){var self=this;if(!this.many2manys.length){return;}
var relations={};this.groups.forEach(function(group){group.records.forEach(function(record){self.many2manys.forEach(function(name){var field=record.record[name];var $el=record.$('.oe_form_field.oe_tags[name='+name+']').empty();if(!relations[field.relation]){relations[field.relation]={ids:[],elements:{}};}
var rel=relations[field.relation];field.raw_value.forEach(function(id){rel.ids.push(id);if(!rel.elements[id]){rel.elements[id]=[];}
rel.elements[id].push($el[0]);});});});});_.each(relations,function(rel,rel_name){var dataset=new instance.web.DataSetSearch(self,rel_name,self.dataset.get_context());dataset.name_get(_.uniq(rel.ids)).done(function(result){result.forEach(function(nameget){$(rel.elements[nameget[0]]).append('<span class="oe_tag">'+_.str.escapeHTML(nameget[1])+'</span>');});});});}});function get_class(name){return new instance.web.Registry({'tmp':name}).get_object("tmp");}
instance.web_kanban.KanbanGroup=instance.web.Widget.extend({template:'KanbanView.group_header',init:function(parent,records,group,dataset){var self=this;this._super(parent);this.$has_been_started=$.Deferred();this.view=parent;this.group=group;this.dataset=dataset;this.dataset_offset=0;this.aggregates={};this.value=this.title=null;if(this.group){this.value=group.get('value');this.title=group.get('value');if(this.value instanceof Array){this.title=this.value[1];this.value=this.value[0];}
var field=this.view.group_by_field;if(!_.isEmpty(field)){try{this.title=instance.web.format_value(group.get('value'),field,false);}catch(e){}}
_.each(this.view.aggregates,function(value,key){self.aggregates[value]=instance.web.format_value(group.get('aggregates')[key],{type:'float'});});}
if(this.title===false){this.title=_t('Undefined');this.undefined_title=true;}
var key=this.view.group_by+'-'+this.value;if(!this.view.state.groups[key]){this.view.state.groups[key]={folded:group?group.get('folded'):false};}
this.state=this.view.state.groups[key];this.$records=null;this.records=[];this.$has_been_started.done(function(){self.do_add_records(records);});},start:function(){var self=this;if(!self.view.group_by){self.$el.addClass("oe_kanban_no_group");self.quick=new(get_class(self.view.quick_create_class))(this,self.dataset,{},false).on('added',self,self.proxy('quick_created'));self.quick.replace($(".oe_kanban_no_group_qc_placeholder"));}
this.$records=$(QWeb.render('KanbanView.group_records_container',{widget:this}));this.$records.insertBefore(this.view.$el.find('.oe_kanban_groups_records td:last'));this.$el.on('click','.oe_kanban_group_dropdown li a',function(ev){var fn='do_action_'+$(ev.target).data().action;if(typeof(self[fn])==='function'){self[fn]($(ev.target));}});this.$el.find('.oe_kanban_add').click(function(){if(self.view.quick){self.view.quick.trigger('close');}
if(self.quick){return false;}
self.view.$el.find('.oe_view_nocontent').hide();var ctx={};ctx['default_'+self.view.group_by]=self.value;self.quick=new(get_class(self.view.quick_create_class))(this,self.dataset,ctx,true).on('added',self,self.proxy('quick_created')).on('close',self,function(){self.view.$el.find('.oe_view_nocontent').show();this.quick.destroy();delete self.view.quick;delete this.quick;});self.quick.appendTo($(".oe_kanban_group_list_header",self.$records));self.quick.focus();self.view.quick=self.quick;});this.$records.on('click','.oe_kanban_show_more',this.do_show_more);if(this.state.folded){this.do_toggle_fold();}
this.$el.data('widget',this);this.$records.data('widget',this);this.$has_been_started.resolve();var add_btn=this.$el.find('.oe_kanban_add');add_btn.tooltip({delay:{show:500,hide:1000}});this.$records.find(".oe_kanban_column_cards").click(function(ev){if(ev.target==ev.currentTarget){if(!self.state.folded){add_btn.openerpBounce();}}});this.is_started=true;var def_tooltip=this.fetch_tooltip();return $.when(def_tooltip);},fetch_tooltip:function(){if(!this.group)
return;var field_name=this.view.group_by;var field=this.view.group_by_field;var field_desc=null;var recurse=function(node){if(node.tag==="field"&&node.attrs.name===field_name){field_desc=node;return;}
_.each(node.children,function(child){if(field_desc===null)
recurse(child);});};recurse(this.view.fields_view.arch);if(!field_desc)
return;var options=instance.web.py_eval(field_desc.attrs.options||'{}')
if(!options.tooltip_on_group_by)
return;var self=this;if(this.value){return(new instance.web.Model(field.relation)).query([options.tooltip_on_group_by]).filter([["id","=",this.value]]).first().then(function(res){self.tooltip=res[options.tooltip_on_group_by];self.$(".oe_kanban_group_title_text").attr("title",self.tooltip||self.title||"").tooltip();});}},compute_cards_auto_height:function(){if(!this.view.group_by){var min_height=0;var els=[];_.each(this.records,function(r){var $e=r.$el.children(':first:not(.oe_kanban_no_auto_height)').css('min-height',0);if($e.length){els.push($e[0]);min_height=Math.max(min_height,$e.outerHeight());}});$(els).css('min-height',min_height);}},destroy:function(){this._super();if(this.$records){this.$records.remove();}},do_show_more:function(evt){var self=this;var ids=self.view.dataset.ids.splice(0);return this.dataset.read_slice(this.view.fields_keys.concat(['__last_update']),{'limit':self.view.limit,'offset':self.dataset_offset+=self.view.limit}).then(function(records){self.view.dataset.ids=ids.concat(self.dataset.ids);self.do_add_records(records);self.compute_cards_auto_height();self.view.postprocess_m2m_tags();return records;});},do_add_records:function(records,prepend){var self=this;var $list_header=this.$records.find('.oe_kanban_group_list_header');var $show_more=this.$records.find('.oe_kanban_show_more');var $cards=this.$records.find('.oe_kanban_column_cards');_.each(records,function(record){var rec=new instance.web_kanban.KanbanRecord(self,record);if(!prepend){rec.appendTo($cards);self.records.push(rec);}else{rec.prependTo($cards);self.records.unshift(rec);}});if($show_more.length){var size=this.dataset.size();$show_more.toggle(this.records.length<size).find('.oe_kanban_remaining').text(size-this.records.length);}},remove_record:function(id,remove_from_dataset){for(var i=0;i<this.records.length;i++){if(this.records[i]['id']===id){this.records.splice(i,1);i--;}}},do_toggle_fold:function(compute_width){this.$el.add(this.$records).toggleClass('oe_kanban_group_folded');this.state.folded=this.$el.is('.oe_kanban_group_folded');this.$("ul.oe_kanban_group_dropdown li a[data-action=toggle_fold]").text((this.state.folded)?_t("Unfold"):_t("Fold"));},do_action_toggle_fold:function(){this.do_toggle_fold();},do_action_edit:function(){var self=this;self.do_action({res_id:this.value,name:_t("Edit column"),res_model:self.view.group_by_field.relation,views:[[false,'form']],type:'ir.actions.act_window',target:"new",flags:{action_buttons:true,}});var am=instance.webclient.action_manager;var form=am.dialog_widget.views.form.controller;form.on("on_button_cancel",am.dialog,function(){return am.dialog.$dialog_box.modal('hide');});form.on('record_saved',self,function(){am.dialog.$dialog_box.modal('hide');self.view.do_reload();});},do_action_delete:function(){var self=this;if(confirm(_t("Are you sure to remove this column ?"))){(new instance.web.DataSet(self,self.view.group_by_field.relation)).unlink([self.value]).done(function(r){self.view.do_reload();});}},do_save_sequences:function(){var self=this;if(_.indexOf(this.view.fields_keys,'sequence')>-1){var new_sequence=_.pluck(this.records,'id');self.view.dataset.resequence(new_sequence);}},quick_created:function(record){var id=record,self=this;self.view.remove_no_result();self.trigger("add_record");this.dataset.read_ids([id],this.view.fields_keys).done(function(records){self.view.dataset.ids.push(id);self.do_add_records(records,true);});},highlight:function(show){if(show){this.$el.addClass('oe_kanban_column_higlight');this.$records.addClass('oe_kanban_column_higlight');}else{this.$el.removeClass('oe_kanban_column_higlight');this.$records.removeClass('oe_kanban_column_higlight');}}});instance.web_kanban.KanbanRecord=instance.web.Widget.extend({template:'KanbanView.record',init:function(parent,record){this._super(parent);this.group=parent;this.view=parent.view;this.id=null;this.set_record(record);if(!this.view.state.records[this.id]){this.view.state.records[this.id]={folded:false};}
this.state=this.view.state.records[this.id];this.fields={};},set_record:function(record){var self=this;this.id=record.id;this.values={};_.each(record,function(v,k){self.values[k]={value:v};});this.record=this.transform_record(record);},start:function(){var self=this;this._super();this.init_content();},init_content:function(){var self=this;self.sub_widgets=[];this.$("[data-field_id]").each(function(){self.add_widget($(this));});this.$el.data('widget',this);this.bind_events();},transform_record:function(record){var self=this,new_record={};_.each(record,function(value,name){var r=_.clone(self.view.fields_view.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=instance.web.auto_str_to_date(value);}else{r.raw_value=value;}
r.value=instance.web.format_value(value,r);new_record[name]=r;});return new_record;},renderElement:function(){this.qweb_context={instance:instance,record:this.record,widget:this,read_only_mode:this.view.options.read_only_mode,};for(var p in this){if(_.str.startsWith(p,'kanban_')){this.qweb_context[p]=_.bind(this[p],this);}}
var $el=instance.web.qweb.render(this.template,{'widget':this,'content':this.view.qweb.render('kanban-box',this.qweb_context)});this.replaceElement($el);this.replace_fields();},replace_fields:function(){var self=this;this.$("field").each(function(){var $field=$(this);var $nfield=$("<span></span");var id=_.uniqueId("kanbanfield");self.fields[id]=$field;$nfield.attr("data-field_id",id);$field.replaceWith($nfield);});},add_widget:function($node){var $orig=this.fields[$node.data("field_id")];var field=this.record[$orig.attr("name")];var type=field.type;type=$orig.attr("widget")?$orig.attr("widget"):type;var obj=instance.web_kanban.fields_registry.get_object(type);var widget=new obj(this,field,$orig);this.sub_widgets.push(widget);widget.replace($node);},bind_events:function(){var self=this;this.setup_color_picker();this.$el.find('[title]').each(function(){$(this).tooltip({delay:{show:500,hide:0},title:function(){var template=$(this).attr('tooltip');if(!self.view.qweb.has_template(template)){return false;}
return self.view.qweb.render(template,self.qweb_context);},});});if(!this.$el.find('.oe_kanban_draghandle').length){this.$el.children(':first').toggleClass('oe_kanban_draghandle',this.view.is_action_enabled('edit'));}
this.$el.find('.oe_kanban_action').click(function(ev){ev.preventDefault();var $action=$(this),type=$action.data('type')||'button',method='do_action_'+(type==='action'?'object':type);if((type==='edit'||type==='delete')&&!self.view.is_action_enabled(type)){self.view.open_record(self.id,true);}else if(_.str.startsWith(type,'switch_')){self.view.do_switch_view(type.substr(7));}else if(typeof self[method]==='function'){self[method]($action);}else{self.do_warn("Kanban: no action for type : "+type);}});if(this.$el.find('.oe_kanban_global_click,.oe_kanban_global_click_edit').length){this.$el.on('click',function(ev){if(!ev.isTrigger&&!$._data(ev.target,'events')){var trigger=true;var elem=ev.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem==ev.currentTarget){ischild=false;}
if(ischild){children.push(elem);if(events&&events.click){trigger=false;}}
if(trigger&&events&&events.click){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){self.on_card_clicked(ev);}}});}},on_card_clicked:function(ev){if(this.$el.find('.oe_kanban_global_click_edit').size()>0)
this.do_action_edit();else
this.do_action_open();},setup_color_picker:function(){var self=this;var $el=this.$el.find('ul.oe_kanban_colorpicker');if($el.length){$el.html(QWeb.render('KanbanColorPicker',{widget:this}));$el.on('click','a',function(ev){ev.preventDefault();var color_field=$(this).parents('.oe_kanban_colorpicker').first().data('field')||'color';var data={};data[color_field]=$(this).data('color');self.view.dataset.write(self.id,data,{}).done(function(){self.record[color_field]=$(this).data('color');self.do_reload();});});}},do_action_delete:function($action){var self=this;function do_it(){return $.when(self.view.dataset.unlink([self.id])).done(function(){self.group.remove_record(self.id);self.destroy();});}
if(this.view.options.confirm_on_delete){if(confirm(_t("Are you sure you want to delete this record ?"))){return do_it();}}else
return do_it();},do_action_edit:function($action){this.view.open_record(this.id,true);},do_action_open:function($action){this.view.open_record(this.id);},do_action_object:function($action){var button_attrs=$action.data();this.view.do_execute_action(button_attrs,this.view.dataset,this.id,this.do_reload);},do_reload:function(){var self=this;this.view.dataset.read_ids([this.id],this.view.fields_keys.concat(['__last_update'])).done(function(records){_.each(self.sub_widgets,function(el){el.destroy();});self.sub_widgets=[];if(records.length){self.set_record(records[0]);self.renderElement();self.init_content();self.group.compute_cards_auto_height();self.view.postprocess_m2m_tags();}else{self.destroy();}});},kanban_getcolor:function(variable){var index=0;switch(typeof(variable)){case'string':for(var i=0,ii=variable.length;i<ii;i++){index+=variable.charCodeAt(i);}
break;case'number':index=Math.round(variable);break;default:return'';}
var color=(index%this.view.number_of_color_schemes);return color;},kanban_color:function(variable){var color=this.kanban_getcolor(variable);return color===''?'':'oe_kanban_color_'+color;},kanban_image:function(model,field,id,cache,options){options=options||{};var url;if(this.record[field]&&this.record[field].value&&!instance.web.form.is_bin_size(this.record[field].value)){url='data:image/png;base64,'+this.record[field].value;}else if(this.record[field]&&!this.record[field].value){url="/web/static/src/img/placeholder.png";}else{id=JSON.stringify(id);if(options.preview_image)
field=options.preview_image;url=this.session.url('/web/binary/image',{model:model,field:field,id:id});if(cache!==undefined){url+='&cache='+parseInt(cache,10);}}
return url;},kanban_text_ellipsis:function(s,size){size=size||160;if(!s){return'';}else if(s.length<=size){return s;}else{return s.substr(0,size)+'...';}},kanban_compute_domain:function(domain){return instance.web.form.compute_domain(domain,this.values);}});instance.web_kanban.QuickCreate=instance.web.Widget.extend({template:'KanbanView.quick_create',init:function(parent,dataset,context,buttons){this._super(parent);this._dataset=dataset;this._buttons=buttons||false;this._context=context||{};},start:function(){var self=this;self.$input=this.$el.find('input');self.$input.keyup(function(event){if(event.keyCode==13){self.quick_add();}});$(".oe_kanban_quick_create").focusout(function(e){var val=self.$el.find('input').val();if(/^\s*$/.test(val)){self.trigger('close');}
e.stopImmediatePropagation();});$(".oe_kanban_quick_create_add",this.$el).click(function(){self.quick_add();self.focus();});$(".oe_kanban_quick_create_close",this.$el).click(function(ev){ev.preventDefault();self.trigger('close');});self.$input.keyup(function(e){if(e.keyCode==27&&self._buttons){self.trigger('close');}});},focus:function(){this.$el.find('input').focus();},quick_add:function(){var self=this;var val=this.$input.val();if(/^\s*$/.test(val)){this.$el.remove();return;}
this._dataset.call('name_create',[val,new instance.web.CompoundContext(this._dataset.get_context(),this._context)]).then(function(record){self.$input.val("");self.trigger('added',record[0]);},function(error,event){event.preventDefault();return self.slow_create();});},slow_create:function(){var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(self._dataset.model,{title:_t("Create: ")+(this.string||this.name),initial_view:"form",disable_multiple_selection:true},[],{"default_name":self.$input.val()});pop.on("elements_selected",self,function(element_ids){self.$input.val("");self.trigger('added',element_ids[0]);});}});instance.web_kanban.FieldInterface={init:function(parent,field,$node){},};instance.web_kanban.AbstractField=instance.web.Widget.extend(instance.web_kanban.FieldInterface,{init:function(parent,field,$node){this._super(parent);this.field=field;this.$node=$node;this.options=instance.web.py_eval(this.$node.attr("options")||'{}');this.set("value",field.raw_value);},});instance.web_kanban.Priority=instance.web_kanban.AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name')
this.parent=parent;},prepare_priority:function(){var self=this;var selection=this.field.selection||[];var init_value=selection&&selection[0][0]||0;var data=_.map(selection.slice(1),function(element,index){var value={'value':element[0],'name':element[1],'click_value':element[0],}
if(index==0&&self.get('value')==element[0]){value['click_value']=init_value;}
return value;});return data;},renderElement:function(){var self=this;this.record_id=self.parent.id;this.priorities=self.prepare_priority();this.$el=$(QWeb.render("Priority",{'widget':this}));this.$el.find('li').click(self.do_action.bind(self));},do_action:function(e){var self=this;var li=$(e.target).closest("li");if(li.length){var value={};value[self.name]=String(li.data('value'));return self.parent.view.dataset._model.call('write',[[self.record_id],value,self.parent.view.dataset.get_context()]).done(self.reload_record.bind(self.parent));}},reload_record:function(){this.do_reload();},});instance.web_kanban.KanbanSelection=instance.web_kanban.AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name')
this.parent=parent;},prepare_dropdown_selection:function(){var data=[];_.map(this.field.selection||[],function(res){var value={'name':res[0],'tooltip':res[1],'state_name':res[1],}
if(res[0]=='normal'){value['state_class']='oe_kanban_status';}
else if(res[0]=='done'){value['state_class']='oe_kanban_status oe_kanban_status_green';}
else{value['state_class']='oe_kanban_status oe_kanban_status_red';}
data.push(value);});return data;},renderElement:function(){var self=this;this.record_id=self.parent.id;this.states=self.prepare_dropdown_selection();;this.$el=$(QWeb.render("KanbanSelection",{'widget':self}));this.$el.find('li').click(self.do_action.bind(self));},do_action:function(e){var self=this;var li=$(e.target).closest("li");if(li.length){var value={};value[self.name]=String(li.data('value'));return self.parent.view.dataset._model.call('write',[[self.record_id],value,self.parent.view.dataset.get_context()]).done(self.reload_record.bind(self.parent));}},reload_record:function(){this.do_reload();},});instance.web_kanban.fields_registry=new instance.web.Registry({});instance.web_kanban.fields_registry.add('priority','instance.web_kanban.Priority');instance.web_kanban.fields_registry.add('kanban_state_selection','instance.web_kanban.KanbanSelection');};;

/* /web_kanban_gauge/static/lib/justgage/justgage.js defined in bundle 'web.assets_backend' */
JustGage=function(config){var obj=this;obj.config={id:config.id,parentNode:(config.parentNode)?config.parentNode:null,width:(config.width)?config.width:null,height:(config.height)?config.height:null,title:(config.title)?config.title:"",titleFontColor:(config.titleFontColor)?config.titleFontColor:"#999999",value:(config.value)?config.value:0,valueFontColor:(config.valueFontColor)?config.valueFontColor:"#010101",symbol:(config.symbol)?config.symbol:"",min:(config.min!==undefined)?parseFloat(config.min):0,max:(config.max!==undefined)?parseFloat(config.max):100,humanFriendlyDecimal:(config.humanFriendlyDecimal)?config.humanFriendlyDecimal:0,textRenderer:(config.textRenderer)?config.textRenderer:null,gaugeWidthScale:(config.gaugeWidthScale)?config.gaugeWidthScale:1.0,gaugeColor:(config.gaugeColor)?config.gaugeColor:"#edebeb",label:(config.label)?config.label:"",labelFontColor:(config.labelFontColor)?config.labelFontColor:"#b3b3b3",shadowOpacity:(config.shadowOpacity)?config.shadowOpacity:0.2,shadowSize:(config.shadowSize)?config.shadowSize:5,shadowVerticalOffset:(config.shadowVerticalOffset)?config.shadowVerticalOffset:3,levelColors:(config.levelColors)?config.levelColors:["#a9d70b","#f9c802","#ff0000"],startAnimationTime:(config.startAnimationTime)?config.startAnimationTime:700,startAnimationType:(config.startAnimationType)?config.startAnimationType:">",refreshAnimationTime:(config.refreshAnimationTime)?config.refreshAnimationTime:700,refreshAnimationType:(config.refreshAnimationType)?config.refreshAnimationType:">",donutStartAngle:(config.donutStartAngle)?config.donutStartAngle:90,valueMinFontSize:config.valueMinFontSize||16,titleMinFontSize:config.titleMinFontSize||10,labelMinFontSize:config.labelMinFontSize||10,minLabelMinFontSize:config.minLabelMinFontSize||10,maxLabelMinFontSize:config.maxLabelMinFontSize||10,hideValue:(config.hideValue)?config.hideValue:false,hideMinMax:(config.hideMinMax)?config.hideMinMax:false,hideInnerShadow:(config.hideInnerShadow)?config.hideInnerShadow:false,humanFriendly:(config.humanFriendly)?config.humanFriendly:false,noGradient:(config.noGradient)?config.noGradient:false,donut:(config.donut)?config.donut:false,relativeGaugeSize:(config.relativeGaugeSize)?config.relativeGaugeSize:false,counter:(config.counter)?config.counter:false,decimals:(config.decimals)?config.decimals:0,customSectors:(config.customSectors)?config.customSectors:[]};var
canvasW,canvasH,widgetW,widgetH,aspect,dx,dy,titleFontSize,titleX,titleY,valueFontSize,valueX,valueY,labelFontSize,labelX,labelY,minFontSize,minX,minY,maxFontSize,maxX,maxY;if(obj.config.value>obj.config.max)obj.config.value=obj.config.max;if(obj.config.value<obj.config.min)obj.config.value=obj.config.min;obj.originalValue=config.value;if(obj.config.id!==null&&(document.getElementById(obj.config.id))!==null){obj.canvas=Raphael(obj.config.id,"100%","100%");}else if(obj.config.parentNode!==null){obj.canvas=Raphael(obj.config.parentNode,"100%","100%");}
if(obj.config.relativeGaugeSize===true){obj.canvas.setViewBox(0,0,200,150,false);}
if(obj.config.relativeGaugeSize===true){canvasW=200;canvasH=150;}else if(obj.config.width!==null&&obj.config.height!==null){canvasW=obj.config.width;canvasH=obj.config.height;}else if(obj.config.parentNode!==null){obj.canvas.setViewBox(0,0,200,150,false);canvasW=200;canvasH=150;}else{canvasW=getStyle(document.getElementById(obj.config.id),"width").slice(0,-2)*1;canvasH=getStyle(document.getElementById(obj.config.id),"height").slice(0,-2)*1;}
if(obj.config.donut===true){if(canvasW>canvasH){widgetH=canvasH;widgetW=widgetH;}else if(canvasW<canvasH){widgetW=canvasW;widgetH=widgetW;if(widgetH>canvasH){aspect=widgetH/canvasH;widgetH=widgetH/aspect;widgetW=widgetH/aspect;}}else{widgetW=canvasW;widgetH=widgetW;}
dx=(canvasW-widgetW)/2;dy=(canvasH-widgetH)/2;titleFontSize=((widgetH/8)>10)?(widgetH/10):10;titleX=dx+widgetW/2;titleY=dy+widgetH/11;valueFontSize=((widgetH/6.4)>16)?(widgetH/5.4):18;valueX=dx+widgetW/2;if(obj.config.label!==''){valueY=dy+widgetH/1.85;}else{valueY=dy+widgetH/1.7;}
labelFontSize=((widgetH/16)>10)?(widgetH/16):10;labelX=dx+widgetW/2;labelY=valueY+labelFontSize;minFontSize=((widgetH/16)>10)?(widgetH/16):10;minX=dx+(widgetW/10)+(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;minY=labelY;maxFontSize=((widgetH/16)>10)?(widgetH/16):10;maxX=dx+widgetW-(widgetW/10)-(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;maxY=labelY;}else{if(canvasW>canvasH){widgetH=canvasH;widgetW=widgetH*1.25;if(widgetW>canvasW){aspect=widgetW/canvasW;widgetW=widgetW/aspect;widgetH=widgetH/aspect;}}else if(canvasW<canvasH){widgetW=canvasW;widgetH=widgetW/1.25;if(widgetH>canvasH){aspect=widgetH/canvasH;widgetH=widgetH/aspect;widgetW=widgetH/aspect;}}else{widgetW=canvasW;widgetH=widgetW*0.75;}
dx=(canvasW-widgetW)/2;dy=(canvasH-widgetH)/2;titleFontSize=((widgetH/8)>obj.config.titleMinFontSize)?(widgetH/10):obj.config.titleMinFontSize;titleX=dx+widgetW/2;titleY=dy+widgetH/6.4;valueFontSize=((widgetH/6.5)>obj.config.valueMinFontSize)?(widgetH/6.5):obj.config.valueMinFontSize;valueX=dx+widgetW/2;valueY=dy+widgetH/1.275;labelFontSize=((widgetH/16)>obj.config.labelMinFontSize)?(widgetH/16):obj.config.labelMinFontSize;labelX=dx+widgetW/2;labelY=valueY+valueFontSize/2+5;minFontSize=((widgetH/16)>obj.config.minLabelMinFontSize)?(widgetH/16):obj.config.minLabelMinFontSize;minX=dx+(widgetW/10)+(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;minY=labelY;maxFontSize=((widgetH/16)>obj.config.maxLabelMinFontSize)?(widgetH/16):obj.config.maxLabelMinFontSize;maxX=dx+widgetW-(widgetW/10)-(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;maxY=labelY;}
obj.params={canvasW:canvasW,canvasH:canvasH,widgetW:widgetW,widgetH:widgetH,dx:dx,dy:dy,titleFontSize:titleFontSize,titleX:titleX,titleY:titleY,valueFontSize:valueFontSize,valueX:valueX,valueY:valueY,labelFontSize:labelFontSize,labelX:labelX,labelY:labelY,minFontSize:minFontSize,minX:minX,minY:minY,maxFontSize:maxFontSize,maxX:maxX,maxY:maxY};canvasW,canvasH,widgetW,widgetH,aspect,dx,dy,titleFontSize,titleX,titleY,valueFontSize,valueX,valueY,labelFontSize,labelX,labelY,minFontSize,minX,minY,maxFontSize,maxX,maxY=null
obj.canvas.customAttributes.pki=function(value,min,max,w,h,dx,dy,gws,donut){var alpha,Ro,Ri,Cx,Cy,Xo,Yo,Xi,Yi,path;if(donut){alpha=(1-2*(value-min)/(max-min))*Math.PI;Ro=w/2-w/7;Ri=Ro-w/6.666666666666667*gws;Cx=w/2+dx;Cy=h/1.95+dy;Xo=w/2+dx+Ro*Math.cos(alpha);Yo=h-(h-Cy)+0-Ro*Math.sin(alpha);Xi=w/2+dx+Ri*Math.cos(alpha);Yi=h-(h-Cy)+0-Ri*Math.sin(alpha);path+="M"+(Cx-Ri)+","+Cy+" ";path+="L"+(Cx-Ro)+","+Cy+" ";if(value>((max-min)/2)){path+="A"+Ro+","+Ro+" 0 0 1 "+(Cx+Ro)+","+Cy+" ";}
path+="A"+Ro+","+Ro+" 0 0 1 "+Xo+","+Yo+" ";path+="L"+Xi+","+Yi+" ";if(value>((max-min)/2)){path+="A"+Ri+","+Ri+" 0 0 0 "+(Cx+Ri)+","+Cy+" ";}
path+="A"+Ri+","+Ri+" 0 0 0 "+(Cx-Ri)+","+Cy+" ";path+="Z ";return{path:path};}else{alpha=(1-(value-min)/(max-min))*Math.PI;Ro=w/2-w/10;Ri=Ro-w/6.666666666666667*gws;Cx=w/2+dx;Cy=h/1.25+dy;Xo=w/2+dx+Ro*Math.cos(alpha);Yo=h-(h-Cy)+0-Ro*Math.sin(alpha);Xi=w/2+dx+Ri*Math.cos(alpha);Yi=h-(h-Cy)+0-Ri*Math.sin(alpha);path+="M"+(Cx-Ri)+","+Cy+" ";path+="L"+(Cx-Ro)+","+Cy+" ";path+="A"+Ro+","+Ro+" 0 0 1 "+Xo+","+Yo+" ";path+="L"+Xi+","+Yi+" ";path+="A"+Ri+","+Ri+" 0 0 0 "+(Cx-Ri)+","+Cy+" ";path+="Z ";return{path:path};}
alpha,Ro,Ri,Cx,Cy,Xo,Yo,Xi,Yi,path=null;};obj.gauge=obj.canvas.path().attr({"stroke":"none","fill":obj.config.gaugeColor,pki:[obj.config.max,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut]});obj.level=obj.canvas.path().attr({"stroke":"none","fill":getColor(obj.config.value,(obj.config.value-obj.config.min)/(obj.config.max-obj.config.min),obj.config.levelColors,obj.config.noGradient,obj.config.customSectors),pki:[obj.config.min,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut]});if(obj.config.donut){obj.level.transform("r"+obj.config.donutStartAngle+", "+(obj.params.widgetW/2+obj.params.dx)+", "+(obj.params.widgetH/1.95+obj.params.dy));}
obj.txtTitle=obj.canvas.text(obj.params.titleX,obj.params.titleY,obj.config.title);obj.txtTitle.attr({"font-size":obj.params.titleFontSize,"font-weight":"bold","font-family":"Arial","fill":obj.config.titleFontColor,"fill-opacity":"1"});setDy(obj.txtTitle,obj.params.titleFontSize,obj.params.titleY);obj.txtValue=obj.canvas.text(obj.params.valueX,obj.params.valueY,0);obj.txtValue.attr({"font-size":obj.params.valueFontSize,"font-weight":"bold","font-family":"Arial","fill":obj.config.valueFontColor,"fill-opacity":"0"});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);obj.txtLabel=obj.canvas.text(obj.params.labelX,obj.params.labelY,obj.config.label);obj.txtLabel.attr({"font-size":obj.params.labelFontSize,"font-weight":"normal","font-family":"Arial","fill":obj.config.labelFontColor,"fill-opacity":"0"});setDy(obj.txtLabel,obj.params.labelFontSize,obj.params.labelY);obj.txtMinimum=obj.config.min;if(obj.config.humanFriendly)obj.txtMinimum=humanFriendlyNumber(obj.config.min,obj.config.humanFriendlyDecimal);obj.txtMin=obj.canvas.text(obj.params.minX,obj.params.minY,obj.txtMinimum);obj.txtMin.attr({"font-size":obj.params.minFontSize,"font-weight":"normal","font-family":"Arial","fill":obj.config.labelFontColor,"fill-opacity":(obj.config.hideMinMax||obj.config.donut)?"0":"1"});setDy(obj.txtMin,obj.params.minFontSize,obj.params.minY);obj.txtMaximum=obj.config.max;if(obj.config.humanFriendly)obj.txtMaximum=humanFriendlyNumber(obj.config.max,obj.config.humanFriendlyDecimal);obj.txtMax=obj.canvas.text(obj.params.maxX,obj.params.maxY,obj.txtMaximum);obj.txtMax.attr({"font-size":obj.params.maxFontSize,"font-weight":"normal","font-family":"Arial","fill":obj.config.labelFontColor,"fill-opacity":(obj.config.hideMinMax||obj.config.donut)?"0":"1"});setDy(obj.txtMax,obj.params.maxFontSize,obj.params.maxY);var defs=obj.canvas.canvas.childNodes[1];var svg="http://www.w3.org/2000/svg";if(ie<9){onCreateElementNsReady(function(){obj.generateShadow(svg,defs);});}else{obj.generateShadow(svg,defs);}
defs,svg=null;if(obj.config.textRenderer){obj.originalValue=obj.config.textRenderer(obj.originalValue);}else if(obj.config.humanFriendly){obj.originalValue=humanFriendlyNumber(obj.originalValue,obj.config.humanFriendlyDecimal)+obj.config.symbol;}else{obj.originalValue=(obj.originalValue*1).toFixed(obj.config.decimals)+obj.config.symbol;}
if(obj.config.counter===true){eve.on("raphael.anim.frame."+(obj.level.id),function(){var currentValue=obj.level.attr("pki");if(obj.config.textRenderer){obj.txtValue.attr("text",obj.config.textRenderer(Math.floor(currentValue[0])));}else if(obj.config.humanFriendly){obj.txtValue.attr("text",humanFriendlyNumber(Math.floor(currentValue[0]),obj.config.humanFriendlyDecimal)+obj.config.symbol);}else{obj.txtValue.attr("text",(currentValue[0]*1).toFixed(obj.config.decimals)+obj.config.symbol);}
setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);currentValue=null;});eve.on("raphael.anim.finish."+(obj.level.id),function(){obj.txtValue.attr({"text":obj.originalValue});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);});}else{eve.on("raphael.anim.start."+(obj.level.id),function(){obj.txtValue.attr({"text":obj.originalValue});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);});}
obj.level.animate({pki:[obj.config.value,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut]},obj.config.startAnimationTime,obj.config.startAnimationType);obj.txtValue.animate({"fill-opacity":(obj.config.hideValue)?"0":"1"},obj.config.startAnimationTime,obj.config.startAnimationType);obj.txtLabel.animate({"fill-opacity":"1"},obj.config.startAnimationTime,obj.config.startAnimationType);};JustGage.prototype.refresh=function(val,max){var obj=this;var displayVal,color,max=max||null;if(max!==null){obj.config.max=max;obj.txtMaximum=obj.config.max;if(obj.config.humanFriendly)obj.txtMaximum=humanFriendlyNumber(obj.config.max,obj.config.humanFriendlyDecimal);obj.txtMax.attr({"text":obj.txtMaximum});setDy(obj.txtMax,obj.params.maxFontSize,obj.params.maxY);}
displayVal=val;if((val*1)>(obj.config.max*1)){val=(obj.config.max*1);}
if((val*1)<(obj.config.min*1)){val=(obj.config.min*1);}
color=getColor(val,(val-obj.config.min)/(obj.config.max-obj.config.min),obj.config.levelColors,obj.config.noGradient,obj.config.customSectors);if(obj.config.textRenderer){displayVal=obj.config.textRenderer(displayVal);}else if(obj.config.humanFriendly){displayVal=humanFriendlyNumber(displayVal,obj.config.humanFriendlyDecimal)+obj.config.symbol;}else{displayVal=(displayVal*1).toFixed(obj.config.decimals)+obj.config.symbol;}
obj.originalValue=displayVal;obj.config.value=val*1;if(!obj.config.counter){obj.txtValue.attr({"text":displayVal});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);}
obj.level.animate({pki:[obj.config.value,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut],"fill":color},obj.config.refreshAnimationTime,obj.config.refreshAnimationType);obj,displayVal,color,max=null;};JustGage.prototype.generateShadow=function(svg,defs){var obj=this;var gaussFilter,feOffset,feGaussianBlur,feComposite1,feFlood,feComposite2,feComposite3;gaussFilter=document.createElementNS(svg,"filter");gaussFilter.setAttribute("id","inner-shadow");defs.appendChild(gaussFilter);feOffset=document.createElementNS(svg,"feOffset");feOffset.setAttribute("dx",0);feOffset.setAttribute("dy",obj.config.shadowVerticalOffset);gaussFilter.appendChild(feOffset);feGaussianBlur=document.createElementNS(svg,"feGaussianBlur");feGaussianBlur.setAttribute("result","offset-blur");feGaussianBlur.setAttribute("stdDeviation",obj.config.shadowSize);gaussFilter.appendChild(feGaussianBlur);feComposite1=document.createElementNS(svg,"feComposite");feComposite1.setAttribute("operator","out");feComposite1.setAttribute("in","SourceGraphic");feComposite1.setAttribute("in2","offset-blur");feComposite1.setAttribute("result","inverse");gaussFilter.appendChild(feComposite1);feFlood=document.createElementNS(svg,"feFlood");feFlood.setAttribute("flood-color","black");feFlood.setAttribute("flood-opacity",obj.config.shadowOpacity);feFlood.setAttribute("result","color");gaussFilter.appendChild(feFlood);feComposite2=document.createElementNS(svg,"feComposite");feComposite2.setAttribute("operator","in");feComposite2.setAttribute("in","color");feComposite2.setAttribute("in2","inverse");feComposite2.setAttribute("result","shadow");gaussFilter.appendChild(feComposite2);feComposite3=document.createElementNS(svg,"feComposite");feComposite3.setAttribute("operator","over");feComposite3.setAttribute("in","shadow");feComposite3.setAttribute("in2","SourceGraphic");gaussFilter.appendChild(feComposite3);if(!obj.config.hideInnerShadow){obj.canvas.canvas.childNodes[2].setAttribute("filter","url(#inner-shadow)");obj.canvas.canvas.childNodes[3].setAttribute("filter","url(#inner-shadow)");}
gaussFilter,feOffset,feGaussianBlur,feComposite1,feFlood,feComposite2,feComposite3=null;};function getColor(val,pct,col,noGradient,custSec){var no,inc,colors,percentage,rval,gval,bval,lower,upper,range,rangePct,pctLower,pctUpper,color;var noGradient=noGradient||custSec.length>0;if(custSec.length>0){for(var i=0;i<custSec.length;i++){if(val>custSec[i].lo&&val<=custSec[i].hi){return custSec[i].color;}}}
no=col.length;if(no===1)return col[0];inc=(noGradient)?(1/no):(1/(no-1));colors=[];for(var i=0;i<col.length;i++){percentage=(noGradient)?(inc*(i+1)):(inc*i);rval=parseInt((cutHex(col[i])).substring(0,2),16);gval=parseInt((cutHex(col[i])).substring(2,4),16);bval=parseInt((cutHex(col[i])).substring(4,6),16);colors[i]={pct:percentage,color:{r:rval,g:gval,b:bval}};}
if(pct===0){return'rgb('+[colors[0].color.r,colors[0].color.g,colors[0].color.b].join(',')+')';}
for(var j=0;j<colors.length;j++){if(pct<=colors[j].pct){if(noGradient){return'rgb('+[colors[j].color.r,colors[j].color.g,colors[j].color.b].join(',')+')';}else{lower=colors[j-1];upper=colors[j];range=upper.pct-lower.pct;rangePct=(pct-lower.pct)/range;pctLower=1-rangePct;pctUpper=rangePct;color={r:Math.floor(lower.color.r*pctLower+upper.color.r*pctUpper),g:Math.floor(lower.color.g*pctLower+upper.color.g*pctUpper),b:Math.floor(lower.color.b*pctLower+upper.color.b*pctUpper)};return'rgb('+[color.r,color.g,color.b].join(',')+')';}}}}
function setDy(elem,fontSize,txtYpos){if((!ie||ie>9)&&elem.node.firstChild.attributes.dy){elem.node.firstChild.attributes.dy.value=0;}}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function cutHex(str){return(str.charAt(0)=="#")?str.substring(1,7):str;}
function humanFriendlyNumber(n,d){var p,d2,i,s;p=Math.pow;d2=p(10,d);i=7;while(i){s=p(10,i--*3);if(s<=n){n=Math.round(n*d2/s)/d2+"KMGTPE"[i];}}
return n;}
function getStyle(oElm,strCssRule){var strValue="";if(document.defaultView&&document.defaultView.getComputedStyle){strValue=document.defaultView.getComputedStyle(oElm,"").getPropertyValue(strCssRule);}
else if(oElm.currentStyle){strCssRule=strCssRule.replace(/\-(\w)/g,function(strMatch,p1){return p1.toUpperCase();});strValue=oElm.currentStyle[strCssRule];}
return strValue;}
function onCreateElementNsReady(func){if(document.createElementNS!==undefined){func();}else{setTimeout(function(){onCreateElementNsReady(func);},100);}}
var ie=(function(){var undef,v=3,div=document.createElement('div'),all=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->',all[0]);return v>4?v:undef;}());;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
openerp.web_kanban_gauge=function(instance){var _t=instance.web._t,_lt=instance.web._lt;instance.web_kanban.GaugeWidget=instance.web_kanban.AbstractField.extend({className:"oe_gauge",start:function(){var self=this;var parent=this.getParent();var max_value=this.options.max_value||100;if(this.options.max_field){max_value=this.getParent().record[this.options.max_field].raw_value;}
var label=this.options.label||"";if(this.options.label_field){label=this.getParent().record[this.options.label_field].raw_value;}
var title=this.$node.html()||this.field.string;var val=this.field.raw_value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var value=_.isArray(val)&&val.length?val[val.length-1]['value']:val;var gauge_value=value;if(this.options.gauge_value_field){gauge_value=this.getParent().record[this.options.gauge_value_field].raw_value;}
this.$el.empty().attr('style',this.$node.attr('style')+';position:relative; display:inline-block;');this.gage=new JustGage({parentNode:this.$el[0],value:value,title:title,min:0,max:max_value,relativeGaugeSize:true,humanFriendly:true,titleFontColor:'#333333',valueFontColor:'#333333',labelFontColor:'#000',label:label,levelColors:self.options.levelcolors||["#ff0000","#f9c802","#a9d70b"],});this.gage.refresh(value,max_value);var flag_open=false;if(this.options.on_change){var $svg=this.$el.find('svg');this.$el.click(function(event){event.stopPropagation();flag_open=false;if(!parent.view.is_action_enabled('edit')){return;}
$svg.fadeTo(0,0.2);if(!self.$el.find(".oe_justgage_edit").size()){var $div=$('<div class="oe_justgage_edit" style="z-index:1"/>');$div.css({'text-align':'center','position':'absolute','width':self.$el.outerWidth()+'px','top':(self.$el.outerHeight()/2-5)+'px'});var $input=$('<input/>').val(gauge_value);$input.css({'text-align':'center','margin':'auto','width':($svg.outerWidth()-40)+'px'});$div.append($input);if(self.options.on_click_label){var $post_input=$('<span style="color: #000000;">'+self.options.on_click_label+'</span>');$div.append($post_input);}
self.$el.prepend($div);$input.focus().keydown(function(event){event.stopPropagation();if(isNaN($input.val())){self.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));$div.remove();$svg.fadeTo(0,1);}else{if(event.keyCode==13||event.keyCode==9){if($input.val()!=value){$svg.fadeTo(0,1);parent.view.dataset.call(self.options.on_change,[parent.id,$input.val()]).then(function(){parent.do_reload();});}else{$svg.fadeTo(0,1);$div.remove();}}}}).click(function(event){event.stopPropagation();flag_open=false;}).blur(function(event){if(!flag_open){self.$el.find(".oe_justgage_edit").remove();$svg.fadeTo(0,1);}else{$svg.fadeTo(0,1);flag_open=false;setTimeout(function(){$input.focus();},0);}});}}).mousedown(function(){flag_open=true;});if(this.options.force_set&&!+input_value){$svg.fadeTo(0,0.3);var $div=$('<div/>').text(_t("Click to change value"));$div.css(css);this.$el.append($div);}}},});instance.web_kanban.fields_registry.add("gauge","instance.web_kanban.GaugeWidget");};

/* /web_kanban_sparkline/static/lib/jquery.sparkline/jquery.sparkline.js defined in bundle 'web.assets_backend' */
(function(document,Math,undefined){(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(jQuery&&!jQuery.fn.sparkline){factory(jQuery);}}
(function($){'use strict';var UNSET_OPTION={},getDefaults,createClass,SPFormat,clipval,quartile,normalizeValue,normalizeValues,remove,isNumber,all,sum,addCSS,ensureArray,formatNumber,RangeMap,MouseHandler,Tooltip,barHighlightMixin,line,bar,tristate,discrete,bullet,pie,box,defaultStyles,initStyles,VShape,VCanvas_base,VCanvas_canvas,VCanvas_vml,pending,shapeCount=0;getDefaults=function(){return{common:{type:'line',lineColor:'#00f',fillColor:'#cdf',defaultPixelsPerValue:3,width:'auto',height:'auto',composite:false,tagValuesAttribute:'values',tagOptionsPrefix:'spark',enableTagOptions:false,enableHighlight:true,highlightLighten:1.4,tooltipSkipNull:true,tooltipPrefix:'',tooltipSuffix:'',disableHiddenCheck:false,numberFormatter:false,numberDigitGroupCount:3,numberDigitGroupSep:',',numberDecimalMark:'.',disableTooltips:false,disableInteraction:false},line:{spotColor:'#f80',highlightSpotColor:'#5f5',highlightLineColor:'#f22',spotRadius:1.5,minSpotColor:'#f80',maxSpotColor:'#f80',lineWidth:1,normalRangeMin:undefined,normalRangeMax:undefined,normalRangeColor:'#ccc',drawNormalOnTop:false,chartRangeMin:undefined,chartRangeMax:undefined,chartRangeMinX:undefined,chartRangeMaxX:undefined,tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:'#3366cc',negBarColor:'#f44',stackedBarColor:['#3366cc','#dc3912','#ff9900','#109618','#66aa00','#dd4477','#0099c6','#990099'],zeroColor:undefined,nullColor:undefined,zeroAxis:true,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false,colorMap:undefined,tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:'#6f6',negBarColor:'#f44',zeroBarColor:'#999',colorMap:{},tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{'-1':'Loss','0':'Draw','1':'Win'}}},discrete:{lineHeight:'auto',thresholdColor:undefined,thresholdValue:0,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false,tooltipFormat:new SPFormat('{{prefix}}{{value}}{{suffix}}')},bullet:{targetColor:'#f33',targetWidth:3,performanceColor:'#33f',rangeColors:['#d3dafe','#a8b6ff','#7f94ff'],base:undefined,tooltipFormat:new SPFormat('{{fieldkey:fields}} - {{value}}'),tooltipValueLookups:{fields:{r:'Range',p:'Performance',t:'Target'}}},pie:{offset:0,sliceColors:['#3366cc','#dc3912','#ff9900','#109618','#66aa00','#dd4477','#0099c6','#990099'],borderWidth:0,borderColor:'#000',tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:false,boxLineColor:'#000',boxFillColor:'#cdf',whiskerColor:'#000',outlierLineColor:'#333',outlierFillColor:'#fff',medianColor:'#f00',showOutliers:true,outlierIQR:1.5,spotRadius:1.5,target:undefined,targetColor:'#4a2',chartRangeMax:undefined,chartRangeMin:undefined,tooltipFormat:new SPFormat('{{field:fields}}: {{value}}'),tooltipFormatFieldlistKey:'field',tooltipValueLookups:{fields:{lq:'Lower Quartile',med:'Median',uq:'Upper Quartile',lo:'Left Outlier',ro:'Right Outlier',lw:'Left Whisker',rw:'Right Whisker'}}}};};defaultStyles='.jqstooltip { '+'position: absolute;'+'left: 0px;'+'top: 0px;'+'visibility: hidden;'+'background: rgb(0, 0, 0) transparent;'+'background-color: rgba(0,0,0,0.6);'+'filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);'+'-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";'+'color: white;'+'font: 10px arial, san serif;'+'text-align: left;'+'white-space: nowrap;'+'padding: 5px;'+'border: 1px solid white;'+'z-index: 10000;'+'}'+'.jqsfield { '+'color: white;'+'font: 10px arial, san serif;'+'text-align: left;'+'}';createClass=function(){var Class,args;Class=function(){this.init.apply(this,arguments);};if(arguments.length>1){if(arguments[0]){Class.prototype=$.extend(new arguments[0](),arguments[arguments.length-1]);Class._super=arguments[0].prototype;}else{Class.prototype=arguments[arguments.length-1];}
if(arguments.length>2){args=Array.prototype.slice.call(arguments,1,-1);args.unshift(Class.prototype);$.extend.apply($,args);}}else{Class.prototype=arguments[0];}
Class.prototype.cls=Class;return Class;};$.SPFormatClass=SPFormat=createClass({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(format,fclass){this.format=format;this.fclass=fclass;},render:function(fieldset,lookups,options){var self=this,fields=fieldset,match,token,lookupkey,fieldvalue,prec;return this.format.replace(this.fre,function(){var lookup;token=arguments[1];lookupkey=arguments[3];match=self.precre.exec(token);if(match){prec=match[2];token=match[1];}else{prec=false;}
fieldvalue=fields[token];if(fieldvalue===undefined){return'';}
if(lookupkey&&lookups&&lookups[lookupkey]){lookup=lookups[lookupkey];if(lookup.get){return lookups[lookupkey].get(fieldvalue)||fieldvalue;}else{return lookups[lookupkey][fieldvalue]||fieldvalue;}}
if(isNumber(fieldvalue)){if(options.get('numberFormatter')){fieldvalue=options.get('numberFormatter')(fieldvalue);}else{fieldvalue=formatNumber(fieldvalue,prec,options.get('numberDigitGroupCount'),options.get('numberDigitGroupSep'),options.get('numberDecimalMark'));}}
return fieldvalue;});}});$.spformat=function(format,fclass){return new SPFormat(format,fclass);};clipval=function(val,min,max){if(val<min){return min;}
if(val>max){return max;}
return val;};quartile=function(values,q){var vl;if(q===2){vl=Math.floor(values.length/2);return values.length%2?values[vl]:(values[vl-1]+values[vl])/2;}else{if(values.length%2){vl=(values.length*q+q)/4;return vl%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1];}else{vl=(values.length*q+2)/4;return vl%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1];}}};normalizeValue=function(val){var nf;switch(val){case'undefined':val=undefined;break;case'null':val=null;break;case'true':val=true;break;case'false':val=false;break;default:nf=parseFloat(val);if(val==nf){val=nf;}}
return val;};normalizeValues=function(vals){var i,result=[];for(i=vals.length;i--;){result[i]=normalizeValue(vals[i]);}
return result;};remove=function(vals,filter){var i,vl,result=[];for(i=0,vl=vals.length;i<vl;i++){if(vals[i]!==filter){result.push(vals[i]);}}
return result;};isNumber=function(num){return!isNaN(parseFloat(num))&&isFinite(num);};formatNumber=function(num,prec,groupsize,groupsep,decsep){var p,i;num=(prec===false?parseFloat(num).toString():num.toFixed(prec)).split('');p=(p=$.inArray('.',num))<0?num.length:p;if(p<num.length){num[p]=decsep;}
for(i=p-groupsize;i>0;i-=groupsize){num.splice(i,0,groupsep);}
return num.join('');};all=function(val,arr,ignoreNull){var i;for(i=arr.length;i--;){if(ignoreNull&&arr[i]===null)continue;if(arr[i]!==val){return false;}}
return true;};sum=function(vals){var total=0,i;for(i=vals.length;i--;){total+=typeof vals[i]==='number'?vals[i]:0;}
return total;};ensureArray=function(val){return $.isArray(val)?val:[val];};addCSS=function(css){var tag;if(document.createStyleSheet){try{document.createStyleSheet().cssText=css;}catch(err){console.log('Failed - IE9 limit 31 sheets CSS');}}else{tag=document.createElement('style');tag.type='text/css';document.getElementsByTagName('head')[0].appendChild(tag);tag[(typeof document.body.style.WebkitAppearance=='string')?'innerText':'innerHTML']=css;}};$.fn.simpledraw=function(width,height,useExisting,interact){var target,mhandler;if(useExisting&&(target=this.data('_jqs_vcanvas'))){return target;}
if($.fn.sparkline.canvas===false){return false;}else if($.fn.sparkline.canvas===undefined){var el=document.createElement('canvas');if(!!(el.getContext&&el.getContext('2d'))){$.fn.sparkline.canvas=function(width,height,target,interact){return new VCanvas_canvas(width,height,target,interact);};}else if(document.namespaces&&!document.namespaces.v){document.namespaces.add('v','urn:schemas-microsoft-com:vml','#default#VML');$.fn.sparkline.canvas=function(width,height,target,interact){return new VCanvas_vml(width,height,target);};}else{$.fn.sparkline.canvas=false;return false;}}
if(width===undefined){width=$(this).innerWidth();}
if(height===undefined){height=$(this).innerHeight();}
target=$.fn.sparkline.canvas(width,height,this,interact);mhandler=$(this).data('_jqs_mhandler');if(mhandler){mhandler.registerCanvas(target);}
return target;};$.fn.cleardraw=function(){var target=this.data('_jqs_vcanvas');if(target){target.reset();}};$.RangeMapClass=RangeMap=createClass({init:function(map){var key,range,rangelist=[];for(key in map){if(map.hasOwnProperty(key)&&typeof key==='string'&&key.indexOf(':')>-1){range=key.split(':');range[0]=range[0].length===0?-Infinity:parseFloat(range[0]);range[1]=range[1].length===0?Infinity:parseFloat(range[1]);range[2]=map[key];rangelist.push(range);}}
this.map=map;this.rangelist=rangelist||false;},get:function(value){var rangelist=this.rangelist,i,range,result;if((result=this.map[value])!==undefined){return result;}
if(rangelist){for(i=rangelist.length;i--;){range=rangelist[i];if(range[0]<=value&&range[1]>=value){return range[2];}}}
return undefined;}});$.range_map=function(map){return new RangeMap(map);};MouseHandler=createClass({init:function(el,options){var $el=$(el);this.$el=$el;this.options=options;this.currentPageX=0;this.currentPageY=0;this.el=el;this.splist=[];this.tooltip=null;this.over=false;this.displayTooltips=!options.get('disableTooltips');this.highlightEnabled=!options.get('disableHighlight');},registerSparkline:function(sp){this.splist.push(sp);if(this.over){this.updateDisplay();}},registerCanvas:function(canvas){var $canvas=$(canvas.canvas);this.canvas=canvas;this.$canvas=$canvas;$canvas.mouseenter($.proxy(this.mouseenter,this));$canvas.mouseleave($.proxy(this.mouseleave,this));$canvas.click($.proxy(this.mouseclick,this));},reset:function(removeTooltip){this.splist=[];if(this.tooltip&&removeTooltip){this.tooltip.remove();this.tooltip=undefined;}},mouseclick:function(e){var clickEvent=$.Event('sparklineClick');clickEvent.originalEvent=e;clickEvent.sparklines=this.splist;this.$el.trigger(clickEvent);},mouseenter:function(e){$(document.body).unbind('mousemove.jqs');$(document.body).bind('mousemove.jqs',$.proxy(this.mousemove,this));this.over=true;this.currentPageX=e.pageX;this.currentPageY=e.pageY;this.currentEl=e.target;if(!this.tooltip&&this.displayTooltips){this.tooltip=new Tooltip(this.options);this.tooltip.updatePosition(e.pageX,e.pageY);}
this.updateDisplay();},mouseleave:function(){$(document.body).unbind('mousemove.jqs');var splist=this.splist,spcount=splist.length,needsRefresh=false,sp,i;this.over=false;this.currentEl=null;if(this.tooltip){this.tooltip.remove();this.tooltip=null;}
for(i=0;i<spcount;i++){sp=splist[i];if(sp.clearRegionHighlight()){needsRefresh=true;}}
if(needsRefresh){this.canvas.render();}},mousemove:function(e){this.currentPageX=e.pageX;this.currentPageY=e.pageY;this.currentEl=e.target;if(this.tooltip){this.tooltip.updatePosition(e.pageX,e.pageY);}
this.updateDisplay();},updateDisplay:function(){var splist=this.splist,spcount=splist.length,needsRefresh=false,offset=this.$canvas.offset(),localX=this.currentPageX-offset.left,localY=this.currentPageY-offset.top,tooltiphtml,sp,i,result,changeEvent;if(!this.over){return;}
for(i=0;i<spcount;i++){sp=splist[i];result=sp.setRegionHighlight(this.currentEl,localX,localY);if(result){needsRefresh=true;}}
if(needsRefresh){changeEvent=$.Event('sparklineRegionChange');changeEvent.sparklines=this.splist;this.$el.trigger(changeEvent);if(this.tooltip){tooltiphtml='';for(i=0;i<spcount;i++){sp=splist[i];tooltiphtml+=sp.getCurrentRegionTooltip();}
this.tooltip.setContent(tooltiphtml);}
if(!this.disableHighlight){this.canvas.render();}}
if(result===null){this.mouseleave();}}});Tooltip=createClass({sizeStyle:'position: static !important;'+'display: block !important;'+'visibility: hidden !important;'+'float: left !important;',init:function(options){var tooltipClassname=options.get('tooltipClassname','jqstooltip'),sizetipStyle=this.sizeStyle,offset;this.container=options.get('tooltipContainer')||document.body;this.tooltipOffsetX=options.get('tooltipOffsetX',10);this.tooltipOffsetY=options.get('tooltipOffsetY',12);$('#jqssizetip').remove();$('#jqstooltip').remove();this.sizetip=$('<div/>',{id:'jqssizetip',style:sizetipStyle,'class':tooltipClassname});this.tooltip=$('<div/>',{id:'jqstooltip','class':tooltipClassname}).appendTo(this.container);offset=this.tooltip.offset();this.offsetLeft=offset.left;this.offsetTop=offset.top;this.hidden=true;$(window).unbind('resize.jqs scroll.jqs');$(window).bind('resize.jqs scroll.jqs',$.proxy(this.updateWindowDims,this));this.updateWindowDims();},updateWindowDims:function(){this.scrollTop=$(window).scrollTop();this.scrollLeft=$(window).scrollLeft();this.scrollRight=this.scrollLeft+$(window).width();this.updatePosition();},getSize:function(content){this.sizetip.html(content).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove();},setContent:function(content){if(!content){this.tooltip.css('visibility','hidden');this.hidden=true;return;}
this.getSize(content);this.tooltip.html(content).css({'width':this.width,'height':this.height,'visibility':'visible'});if(this.hidden){this.hidden=false;this.updatePosition();}},updatePosition:function(x,y){if(x===undefined){if(this.mousex===undefined){return;}
x=this.mousex-this.offsetLeft;y=this.mousey-this.offsetTop;}else{this.mousex=x=x-this.offsetLeft;this.mousey=y=y-this.offsetTop;}
if(!this.height||!this.width||this.hidden){return;}
y-=this.height+this.tooltipOffsetY;x+=this.tooltipOffsetX;if(y<this.scrollTop){y=this.scrollTop;}
if(x<this.scrollLeft){x=this.scrollLeft;}else if(x+this.width>this.scrollRight){x=this.scrollRight-this.width;}
this.tooltip.css({'left':x,'top':y});},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=undefined;$(window).unbind('resize.jqs scroll.jqs');}});initStyles=function(){addCSS(defaultStyles);};$(initStyles);pending=[];$.fn.sparkline=function(userValues,userOptions){return this.each(function(){var options=new $.fn.sparkline.options(this,userOptions),$this=$(this),render,i;render=function(){var values,width,height,tmp,mhandler,sp,vals;if(userValues==='html'||userValues===undefined){vals=this.getAttribute(options.get('tagValuesAttribute'));if(vals===undefined||vals===null){vals=$this.html();}
values=vals.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,'').split(',');}else{values=userValues;}
width=options.get('width')==='auto'?values.length*options.get('defaultPixelsPerValue'):options.get('width');if(options.get('height')==='auto'){if(!options.get('composite')||!$.data(this,'_jqs_vcanvas')){tmp=document.createElement('span');tmp.innerHTML='a';$this.html(tmp);height=$(tmp).innerHeight()||$(tmp).height();$(tmp).remove();tmp=null;}}else{height=options.get('height');}
if(!options.get('disableInteraction')){mhandler=$.data(this,'_jqs_mhandler');if(!mhandler){mhandler=new MouseHandler(this,options);$.data(this,'_jqs_mhandler',mhandler);}else if(!options.get('composite')){mhandler.reset();}}else{mhandler=false;}
if(options.get('composite')&&!$.data(this,'_jqs_vcanvas')){if(!$.data(this,'_jqs_errnotify')){alert('Attempted to attach a composite sparkline to an element with no existing sparkline');$.data(this,'_jqs_errnotify',true);}
return;}
sp=new $.fn.sparkline[options.get('type')](this,values,options,width,height);sp.render();if(mhandler){mhandler.registerSparkline(sp);}};if(($(this).html()&&!options.get('disableHiddenCheck')&&$(this).is(':hidden'))||!$(this).parents('body').length){if(!options.get('composite')&&$.data(this,'_jqs_pending')){for(i=pending.length;i;i--){if(pending[i-1][0]==this){pending.splice(i-1,1);}}}
pending.push([this,render]);$.data(this,'_jqs_pending',true);}else{render.call(this);}});};$.fn.sparkline.defaults=getDefaults();$.sparkline_display_visible=function(){var el,i,pl;var done=[];for(i=0,pl=pending.length;i<pl;i++){el=pending[i][0];if($(el).is(':visible')&&!$(el).parents().is(':hidden')){pending[i][1].call(el);$.data(pending[i][0],'_jqs_pending',false);done.push(i);}else if(!$(el).closest('html').length&&!$.data(el,'_jqs_pending')){$.data(pending[i][0],'_jqs_pending',false);done.push(i);}}
for(i=done.length;i;i--){pending.splice(done[i-1],1);}};$.fn.sparkline.options=createClass({init:function(tag,userOptions){var extendedOptions,defaults,base,tagOptionType;this.userOptions=userOptions=userOptions||{};this.tag=tag;this.tagValCache={};defaults=$.fn.sparkline.defaults;base=defaults.common;this.tagOptionsPrefix=userOptions.enableTagOptions&&(userOptions.tagOptionsPrefix||base.tagOptionsPrefix);tagOptionType=this.getTagSetting('type');if(tagOptionType===UNSET_OPTION){extendedOptions=defaults[userOptions.type||base.type];}else{extendedOptions=defaults[tagOptionType];}
this.mergedOptions=$.extend({},base,extendedOptions,userOptions);},getTagSetting:function(key){var prefix=this.tagOptionsPrefix,val,i,pairs,keyval;if(prefix===false||prefix===undefined){return UNSET_OPTION;}
if(this.tagValCache.hasOwnProperty(key)){val=this.tagValCache.key;}else{val=this.tag.getAttribute(prefix+key);if(val===undefined||val===null){val=UNSET_OPTION;}else if(val.substr(0,1)==='['){val=val.substr(1,val.length-2).split(',');for(i=val.length;i--;){val[i]=normalizeValue(val[i].replace(/(^\s*)|(\s*$)/g,''));}}else if(val.substr(0,1)==='{'){pairs=val.substr(1,val.length-2).split(',');val={};for(i=pairs.length;i--;){keyval=pairs[i].split(':',2);val[keyval[0].replace(/(^\s*)|(\s*$)/g,'')]=normalizeValue(keyval[1].replace(/(^\s*)|(\s*$)/g,''));}}else{val=normalizeValue(val);}
this.tagValCache.key=val;}
return val;},get:function(key,defaultval){var tagOption=this.getTagSetting(key),result;if(tagOption!==UNSET_OPTION){return tagOption;}
return(result=this.mergedOptions[key])===undefined?defaultval:result;}});$.fn.sparkline._base=createClass({disabled:false,init:function(el,values,options,width,height){this.el=el;this.$el=$(el);this.values=values;this.options=options;this.width=width;this.height=height;this.currentRegion=undefined;},initTarget:function(){var interactive=!this.options.get('disableInteraction');if(!(this.target=this.$el.simpledraw(this.width,this.height,this.options.get('composite'),interactive))){this.disabled=true;}else{this.canvasWidth=this.target.pixelWidth;this.canvasHeight=this.target.pixelHeight;}},render:function(){if(this.disabled){this.el.innerHTML='';return false;}
return true;},getRegion:function(x,y){},setRegionHighlight:function(el,x,y){var currentRegion=this.currentRegion,highlightEnabled=!this.options.get('disableHighlight'),newRegion;if(x>this.canvasWidth||y>this.canvasHeight||x<0||y<0){return null;}
newRegion=this.getRegion(el,x,y);if(currentRegion!==newRegion){if(currentRegion!==undefined&&highlightEnabled){this.removeHighlight();}
this.currentRegion=newRegion;if(newRegion!==undefined&&highlightEnabled){this.renderHighlight();}
return true;}
return false;},clearRegionHighlight:function(){if(this.currentRegion!==undefined){this.removeHighlight();this.currentRegion=undefined;return true;}
return false;},renderHighlight:function(){this.changeHighlight(true);},removeHighlight:function(){this.changeHighlight(false);},changeHighlight:function(highlight){},getCurrentRegionTooltip:function(){var options=this.options,header='',entries=[],fields,formats,formatlen,fclass,text,i,showFields,showFieldsKey,newFields,fv,formatter,format,fieldlen,j;if(this.currentRegion===undefined){return'';}
fields=this.getCurrentRegionFields();formatter=options.get('tooltipFormatter');if(formatter){return formatter(this,options,fields);}
if(options.get('tooltipChartTitle')){header+='<div class="jqs jqstitle">'+options.get('tooltipChartTitle')+'</div>\n';}
formats=this.options.get('tooltipFormat');if(!formats){return'';}
if(!$.isArray(formats)){formats=[formats];}
if(!$.isArray(fields)){fields=[fields];}
showFields=this.options.get('tooltipFormatFieldlist');showFieldsKey=this.options.get('tooltipFormatFieldlistKey');if(showFields&&showFieldsKey){newFields=[];for(i=fields.length;i--;){fv=fields[i][showFieldsKey];if((j=$.inArray(fv,showFields))!=-1){newFields[j]=fields[i];}}
fields=newFields;}
formatlen=formats.length;fieldlen=fields.length;for(i=0;i<formatlen;i++){format=formats[i];if(typeof format==='string'){format=new SPFormat(format);}
fclass=format.fclass||'jqsfield';for(j=0;j<fieldlen;j++){if(!fields[j].isNull||!options.get('tooltipSkipNull')){$.extend(fields[j],{prefix:options.get('tooltipPrefix'),suffix:options.get('tooltipSuffix')});text=format.render(fields[j],options.get('tooltipValueLookups'),options);entries.push('<div class="'+fclass+'">'+text+'</div>');}}}
if(entries.length){return header+entries.join('\n');}
return'';},getCurrentRegionFields:function(){},calcHighlightColor:function(color,options){var highlightColor=options.get('highlightColor'),lighten=options.get('highlightLighten'),parse,mult,rgbnew,i;if(highlightColor){return highlightColor;}
if(lighten){parse=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(color)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(color);if(parse){rgbnew=[];mult=color.length===4?16:1;for(i=0;i<3;i++){rgbnew[i]=clipval(Math.round(parseInt(parse[i+1],16)*mult*lighten),0,255);}
return'rgb('+rgbnew.join(',')+')';}}
return color;}});barHighlightMixin={changeHighlight:function(highlight){var currentRegion=this.currentRegion,target=this.target,shapeids=this.regionShapes[currentRegion],newShapes;if(shapeids){newShapes=this.renderRegion(currentRegion,highlight);if($.isArray(newShapes)||$.isArray(shapeids)){target.replaceWithShapes(shapeids,newShapes);this.regionShapes[currentRegion]=$.map(newShapes,function(newShape){return newShape.id;});}else{target.replaceWithShape(shapeids,newShapes);this.regionShapes[currentRegion]=newShapes.id;}}},render:function(){var values=this.values,target=this.target,regionShapes=this.regionShapes,shapes,ids,i,j;if(!this.cls._super.render.call(this)){return;}
for(i=values.length;i--;){shapes=this.renderRegion(i);if(shapes){if($.isArray(shapes)){ids=[];for(j=shapes.length;j--;){shapes[j].append();ids.push(shapes[j].id);}
regionShapes[i]=ids;}else{shapes.append();regionShapes[i]=shapes.id;}}else{regionShapes[i]=null;}}
target.render();}};$.fn.sparkline.line=line=createClass($.fn.sparkline._base,{type:'line',init:function(el,values,options,width,height){line._super.init.call(this,el,values,options,width,height);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;this.initTarget();},getRegion:function(el,x,y){var i,regionMap=this.regionMap;for(i=regionMap.length;i--;){if(regionMap[i]!==null&&x>=regionMap[i][0]&&x<=regionMap[i][1]){return regionMap[i][2];}}
return undefined;},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:this.yvalues[currentRegion]===null,x:this.xvalues[currentRegion],y:this.yvalues[currentRegion],color:this.options.get('lineColor'),fillColor:this.options.get('fillColor'),offset:currentRegion};},renderHighlight:function(){var currentRegion=this.currentRegion,target=this.target,vertex=this.vertices[currentRegion],options=this.options,spotRadius=options.get('spotRadius'),highlightSpotColor=options.get('highlightSpotColor'),highlightLineColor=options.get('highlightLineColor'),highlightSpot,highlightLine;if(!vertex){return;}
if(spotRadius&&highlightSpotColor){highlightSpot=target.drawCircle(vertex[0],vertex[1],spotRadius,undefined,highlightSpotColor);this.highlightSpotId=highlightSpot.id;target.insertAfterShape(this.lastShapeId,highlightSpot);}
if(highlightLineColor){highlightLine=target.drawLine(vertex[0],this.canvasTop,vertex[0],this.canvasTop+this.canvasHeight,highlightLineColor);this.highlightLineId=highlightLine.id;target.insertAfterShape(this.lastShapeId,highlightLine);}},removeHighlight:function(){var target=this.target;if(this.highlightSpotId){target.removeShapeId(this.highlightSpotId);this.highlightSpotId=null;}
if(this.highlightLineId){target.removeShapeId(this.highlightLineId);this.highlightLineId=null;}},scanValues:function(){var values=this.values,valcount=values.length,xvalues=this.xvalues,yvalues=this.yvalues,yminmax=this.yminmax,i,val,isStr,isArray,sp;for(i=0;i<valcount;i++){val=values[i];isStr=typeof(values[i])==='string';isArray=typeof(values[i])==='object'&&values[i]instanceof Array;sp=isStr&&values[i].split(':');if(isStr&&sp.length===2){xvalues.push(Number(sp[0]));yvalues.push(Number(sp[1]));yminmax.push(Number(sp[1]));}else if(isArray){xvalues.push(val[0]);yvalues.push(val[1]);yminmax.push(val[1]);}else{xvalues.push(i);if(values[i]===null||values[i]==='null'){yvalues.push(null);}else{yvalues.push(Number(val));yminmax.push(Number(val));}}}
if(this.options.get('xvalues')){xvalues=this.options.get('xvalues');}
this.maxy=this.maxyorg=Math.max.apply(Math,yminmax);this.miny=this.minyorg=Math.min.apply(Math,yminmax);this.maxx=Math.max.apply(Math,xvalues);this.minx=Math.min.apply(Math,xvalues);this.xvalues=xvalues;this.yvalues=yvalues;this.yminmax=yminmax;},processRangeOptions:function(){var options=this.options,normalRangeMin=options.get('normalRangeMin'),normalRangeMax=options.get('normalRangeMax');if(normalRangeMin!==undefined){if(normalRangeMin<this.miny){this.miny=normalRangeMin;}
if(normalRangeMax>this.maxy){this.maxy=normalRangeMax;}}
if(options.get('chartRangeMin')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMin')<this.miny)){this.miny=options.get('chartRangeMin');}
if(options.get('chartRangeMax')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMax')>this.maxy)){this.maxy=options.get('chartRangeMax');}
if(options.get('chartRangeMinX')!==undefined&&(options.get('chartRangeClipX')||options.get('chartRangeMinX')<this.minx)){this.minx=options.get('chartRangeMinX');}
if(options.get('chartRangeMaxX')!==undefined&&(options.get('chartRangeClipX')||options.get('chartRangeMaxX')>this.maxx)){this.maxx=options.get('chartRangeMaxX');}},drawNormalRange:function(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey){var normalRangeMin=this.options.get('normalRangeMin'),normalRangeMax=this.options.get('normalRangeMax'),ytop=canvasTop+Math.round(canvasHeight-(canvasHeight*((normalRangeMax-this.miny)/rangey))),height=Math.round((canvasHeight*(normalRangeMax-normalRangeMin))/rangey);this.target.drawRect(canvasLeft,ytop,canvasWidth,height,undefined,this.options.get('normalRangeColor')).append();},render:function(){var options=this.options,target=this.target,canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight,vertices=this.vertices,spotRadius=options.get('spotRadius'),regionMap=this.regionMap,rangex,rangey,yvallast,canvasTop,canvasLeft,vertex,path,paths,x,y,xnext,xpos,xposnext,last,next,yvalcount,lineShapes,fillShapes,plen,valueSpots,hlSpotsEnabled,color,xvalues,yvalues,i;if(!line._super.render.call(this)){return;}
this.scanValues();this.processRangeOptions();xvalues=this.xvalues;yvalues=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){return;}
canvasTop=canvasLeft=0;rangex=this.maxx-this.minx===0?1:this.maxx-this.minx;rangey=this.maxy-this.miny===0?1:this.maxy-this.miny;yvallast=this.yvalues.length-1;if(spotRadius&&(canvasWidth<(spotRadius*4)||canvasHeight<(spotRadius*4))){spotRadius=0;}
if(spotRadius){hlSpotsEnabled=options.get('highlightSpotColor')&&!options.get('disableInteraction');if(hlSpotsEnabled||options.get('minSpotColor')||(options.get('spotColor')&&yvalues[yvallast]===this.miny)){canvasHeight-=Math.ceil(spotRadius);}
if(hlSpotsEnabled||options.get('maxSpotColor')||(options.get('spotColor')&&yvalues[yvallast]===this.maxy)){canvasHeight-=Math.ceil(spotRadius);canvasTop+=Math.ceil(spotRadius);}
if(hlSpotsEnabled||((options.get('minSpotColor')||options.get('maxSpotColor'))&&(yvalues[0]===this.miny||yvalues[0]===this.maxy))){canvasLeft+=Math.ceil(spotRadius);canvasWidth-=Math.ceil(spotRadius);}
if(hlSpotsEnabled||options.get('spotColor')||(options.get('minSpotColor')||options.get('maxSpotColor')&&(yvalues[yvallast]===this.miny||yvalues[yvallast]===this.maxy))){canvasWidth-=Math.ceil(spotRadius);}}
canvasHeight--;if(options.get('normalRangeMin')!==undefined&&!options.get('drawNormalOnTop')){this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey);}
path=[];paths=[path];last=next=null;yvalcount=yvalues.length;for(i=0;i<yvalcount;i++){x=xvalues[i];xnext=xvalues[i+1];y=yvalues[i];xpos=canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex));xposnext=i<yvalcount-1?canvasLeft+Math.round((xnext-this.minx)*(canvasWidth/rangex)):canvasWidth;next=xpos+((xposnext-xpos)/2);regionMap[i]=[last||0,next,i];last=next;if(y===null){if(i){if(yvalues[i-1]!==null){path=[];paths.push(path);}
vertices.push(null);}}else{if(y<this.miny){y=this.miny;}
if(y>this.maxy){y=this.maxy;}
if(!path.length){path.push([xpos,canvasTop+canvasHeight]);}
vertex=[xpos,canvasTop+Math.round(canvasHeight-(canvasHeight*((y-this.miny)/rangey)))];path.push(vertex);vertices.push(vertex);}}
lineShapes=[];fillShapes=[];plen=paths.length;for(i=0;i<plen;i++){path=paths[i];if(path.length){if(options.get('fillColor')){path.push([path[path.length-1][0],(canvasTop+canvasHeight)]);fillShapes.push(path.slice(0));path.pop();}
if(path.length>2){path[0]=[path[0][0],path[1][1]];}
lineShapes.push(path);}}
plen=fillShapes.length;for(i=0;i<plen;i++){target.drawShape(fillShapes[i],options.get('fillColor'),options.get('fillColor')).append();}
if(options.get('normalRangeMin')!==undefined&&options.get('drawNormalOnTop')){this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey);}
plen=lineShapes.length;for(i=0;i<plen;i++){target.drawShape(lineShapes[i],options.get('lineColor'),undefined,options.get('lineWidth')).append();}
if(spotRadius&&options.get('valueSpots')){valueSpots=options.get('valueSpots');if(valueSpots.get===undefined){valueSpots=new RangeMap(valueSpots);}
for(i=0;i<yvalcount;i++){color=valueSpots.get(yvalues[i]);if(color){target.drawCircle(canvasLeft+Math.round((xvalues[i]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-(canvasHeight*((yvalues[i]-this.miny)/rangey))),spotRadius,undefined,color).append();}}}
if(spotRadius&&options.get('spotColor')&&yvalues[yvallast]!==null){target.drawCircle(canvasLeft+Math.round((xvalues[xvalues.length-1]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-(canvasHeight*((yvalues[yvallast]-this.miny)/rangey))),spotRadius,undefined,options.get('spotColor')).append();}
if(this.maxy!==this.minyorg){if(spotRadius&&options.get('minSpotColor')){x=xvalues[$.inArray(this.minyorg,yvalues)];target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-(canvasHeight*((this.minyorg-this.miny)/rangey))),spotRadius,undefined,options.get('minSpotColor')).append();}
if(spotRadius&&options.get('maxSpotColor')){x=xvalues[$.inArray(this.maxyorg,yvalues)];target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-(canvasHeight*((this.maxyorg-this.miny)/rangey))),spotRadius,undefined,options.get('maxSpotColor')).append();}}
this.lastShapeId=target.getLastShapeId();this.canvasTop=canvasTop;target.render();}});$.fn.sparkline.bar=bar=createClass($.fn.sparkline._base,barHighlightMixin,{type:'bar',init:function(el,values,options,width,height){var barWidth=parseInt(options.get('barWidth'),10),barSpacing=parseInt(options.get('barSpacing'),10),chartRangeMin=options.get('chartRangeMin'),chartRangeMax=options.get('chartRangeMax'),chartRangeClip=options.get('chartRangeClip'),stackMin=Infinity,stackMax=-Infinity,isStackString,groupMin,groupMax,stackRanges,numValues,i,vlen,range,zeroAxis,xaxisOffset,min,max,clipMin,clipMax,stacked,vlist,j,slen,svals,val,yoffset,yMaxCalc,canvasHeightEf;bar._super.init.call(this,el,values,options,width,height);for(i=0,vlen=values.length;i<vlen;i++){val=values[i];isStackString=typeof(val)==='string'&&val.indexOf(':')>-1;if(isStackString||$.isArray(val)){stacked=true;if(isStackString){val=values[i]=normalizeValues(val.split(':'));}
val=remove(val,null);groupMin=Math.min.apply(Math,val);groupMax=Math.max.apply(Math,val);if(groupMin<stackMin){stackMin=groupMin;}
if(groupMax>stackMax){stackMax=groupMax;}}}
this.stacked=stacked;this.regionShapes={};this.barWidth=barWidth;this.barSpacing=barSpacing;this.totalBarWidth=barWidth+barSpacing;this.width=width=(values.length*barWidth)+((values.length-1)*barSpacing);this.initTarget();if(chartRangeClip){clipMin=chartRangeMin===undefined?-Infinity:chartRangeMin;clipMax=chartRangeMax===undefined?Infinity:chartRangeMax;}
numValues=[];stackRanges=stacked?[]:numValues;var stackTotals=[];var stackRangesNeg=[];for(i=0,vlen=values.length;i<vlen;i++){if(stacked){vlist=values[i];values[i]=svals=[];stackTotals[i]=0;stackRanges[i]=stackRangesNeg[i]=0;for(j=0,slen=vlist.length;j<slen;j++){val=svals[j]=chartRangeClip?clipval(vlist[j],clipMin,clipMax):vlist[j];if(val!==null){if(val>0){stackTotals[i]+=val;}
if(stackMin<0&&stackMax>0){if(val<0){stackRangesNeg[i]+=Math.abs(val);}else{stackRanges[i]+=val;}}else{stackRanges[i]+=Math.abs(val-(val<0?stackMax:stackMin));}
numValues.push(val);}}}else{val=chartRangeClip?clipval(values[i],clipMin,clipMax):values[i];val=values[i]=normalizeValue(val);if(val!==null){numValues.push(val);}}}
this.max=max=Math.max.apply(Math,numValues);this.min=min=Math.min.apply(Math,numValues);this.stackMax=stackMax=stacked?Math.max.apply(Math,stackTotals):max;this.stackMin=stackMin=stacked?Math.min.apply(Math,numValues):min;if(options.get('chartRangeMin')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMin')<min)){min=options.get('chartRangeMin');}
if(options.get('chartRangeMax')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMax')>max)){max=options.get('chartRangeMax');}
this.zeroAxis=zeroAxis=options.get('zeroAxis',true);if(min<=0&&max>=0&&zeroAxis){xaxisOffset=0;}else if(zeroAxis==false){xaxisOffset=min;}else if(min>0){xaxisOffset=min;}else{xaxisOffset=max;}
this.xaxisOffset=xaxisOffset;range=stacked?(Math.max.apply(Math,stackRanges)+Math.max.apply(Math,stackRangesNeg)):max-min;this.canvasHeightEf=(zeroAxis&&min<0)?this.canvasHeight-2:this.canvasHeight-1;if(min<xaxisOffset){yMaxCalc=(stacked&&max>=0)?stackMax:max;yoffset=(yMaxCalc-xaxisOffset)/range*this.canvasHeight;if(yoffset!==Math.ceil(yoffset)){this.canvasHeightEf-=2;yoffset=Math.ceil(yoffset);}}else{yoffset=this.canvasHeight;}
this.yoffset=yoffset;if($.isArray(options.get('colorMap'))){this.colorMapByIndex=options.get('colorMap');this.colorMapByValue=null;}else{this.colorMapByIndex=null;this.colorMapByValue=options.get('colorMap');if(this.colorMapByValue&&this.colorMapByValue.get===undefined){this.colorMapByValue=new RangeMap(this.colorMapByValue);}}
this.range=range;},getRegion:function(el,x,y){var result=Math.floor(x/this.totalBarWidth);return(result<0||result>=this.values.length)?undefined:result;},getCurrentRegionFields:function(){var currentRegion=this.currentRegion,values=ensureArray(this.values[currentRegion]),result=[],value,i;for(i=values.length;i--;){value=values[i];result.push({isNull:value===null,value:value,color:this.calcColor(i,value,currentRegion),offset:currentRegion});}
return result;},calcColor:function(stacknum,value,valuenum){var colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,options=this.options,color,newColor;if(this.stacked){color=options.get('stackedBarColor');}else{color=(value<0)?options.get('negBarColor'):options.get('barColor');}
if(value===0&&options.get('zeroColor')!==undefined){color=options.get('zeroColor');}
if(colorMapByValue&&(newColor=colorMapByValue.get(value))){color=newColor;}else if(colorMapByIndex&&colorMapByIndex.length>valuenum){color=colorMapByIndex[valuenum];}
return $.isArray(color)?color[stacknum%color.length]:color;},renderRegion:function(valuenum,highlight){var vals=this.values[valuenum],options=this.options,xaxisOffset=this.xaxisOffset,result=[],range=this.range,stacked=this.stacked,target=this.target,x=valuenum*this.totalBarWidth,canvasHeightEf=this.canvasHeightEf,yoffset=this.yoffset,y,height,color,isNull,yoffsetNeg,i,valcount,val,minPlotted,allMin;vals=$.isArray(vals)?vals:[vals];valcount=vals.length;val=vals[0];isNull=all(null,vals);allMin=all(xaxisOffset,vals,true);if(isNull){if(options.get('nullColor')){color=highlight?options.get('nullColor'):this.calcHighlightColor(options.get('nullColor'),options);y=(yoffset>0)?yoffset-1:yoffset;return target.drawRect(x,y,this.barWidth-1,0,color,color);}else{return undefined;}}
yoffsetNeg=yoffset;for(i=0;i<valcount;i++){val=vals[i];if(stacked&&val===xaxisOffset){if(!allMin||minPlotted){continue;}
minPlotted=true;}
if(range>0){height=Math.floor(canvasHeightEf*((Math.abs(val-xaxisOffset)/range)))+1;}else{height=1;}
if(val<xaxisOffset||(val===xaxisOffset&&yoffset===0)){y=yoffsetNeg;yoffsetNeg+=height;}else{y=yoffset-height;yoffset-=height;}
color=this.calcColor(i,val,valuenum);if(highlight){color=this.calcHighlightColor(color,options);}
result.push(target.drawRect(x,y,this.barWidth-1,height-1,color,color));}
if(result.length===1){return result[0];}
return result;}});$.fn.sparkline.tristate=tristate=createClass($.fn.sparkline._base,barHighlightMixin,{type:'tristate',init:function(el,values,options,width,height){var barWidth=parseInt(options.get('barWidth'),10),barSpacing=parseInt(options.get('barSpacing'),10);tristate._super.init.call(this,el,values,options,width,height);this.regionShapes={};this.barWidth=barWidth;this.barSpacing=barSpacing;this.totalBarWidth=barWidth+barSpacing;this.values=$.map(values,Number);this.width=width=(values.length*barWidth)+((values.length-1)*barSpacing);if($.isArray(options.get('colorMap'))){this.colorMapByIndex=options.get('colorMap');this.colorMapByValue=null;}else{this.colorMapByIndex=null;this.colorMapByValue=options.get('colorMap');if(this.colorMapByValue&&this.colorMapByValue.get===undefined){this.colorMapByValue=new RangeMap(this.colorMapByValue);}}
this.initTarget();},getRegion:function(el,x,y){return Math.floor(x/this.totalBarWidth);},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],color:this.calcColor(this.values[currentRegion],currentRegion),offset:currentRegion};},calcColor:function(value,valuenum){var values=this.values,options=this.options,colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,color,newColor;if(colorMapByValue&&(newColor=colorMapByValue.get(value))){color=newColor;}else if(colorMapByIndex&&colorMapByIndex.length>valuenum){color=colorMapByIndex[valuenum];}else if(values[valuenum]<0){color=options.get('negBarColor');}else if(values[valuenum]>0){color=options.get('posBarColor');}else{color=options.get('zeroBarColor');}
return color;},renderRegion:function(valuenum,highlight){var values=this.values,options=this.options,target=this.target,canvasHeight,height,halfHeight,x,y,color;canvasHeight=target.pixelHeight;halfHeight=Math.round(canvasHeight/2);x=valuenum*this.totalBarWidth;if(values[valuenum]<0){y=halfHeight;height=halfHeight-1;}else if(values[valuenum]>0){y=0;height=halfHeight-1;}else{y=halfHeight-1;height=2;}
color=this.calcColor(values[valuenum],valuenum);if(color===null){return;}
if(highlight){color=this.calcHighlightColor(color,options);}
return target.drawRect(x,y,this.barWidth-1,height-1,color,color);}});$.fn.sparkline.discrete=discrete=createClass($.fn.sparkline._base,barHighlightMixin,{type:'discrete',init:function(el,values,options,width,height){discrete._super.init.call(this,el,values,options,width,height);this.regionShapes={};this.values=values=$.map(values,Number);this.min=Math.min.apply(Math,values);this.max=Math.max.apply(Math,values);this.range=this.max-this.min;this.width=width=options.get('width')==='auto'?values.length*2:this.width;this.interval=Math.floor(width/values.length);this.itemWidth=width/values.length;if(options.get('chartRangeMin')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMin')<this.min)){this.min=options.get('chartRangeMin');}
if(options.get('chartRangeMax')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMax')>this.max)){this.max=options.get('chartRangeMax');}
this.initTarget();if(this.target){this.lineHeight=options.get('lineHeight')==='auto'?Math.round(this.canvasHeight*0.3):options.get('lineHeight');}},getRegion:function(el,x,y){return Math.floor(x/this.itemWidth);},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],offset:currentRegion};},renderRegion:function(valuenum,highlight){var values=this.values,options=this.options,min=this.min,max=this.max,range=this.range,interval=this.interval,target=this.target,canvasHeight=this.canvasHeight,lineHeight=this.lineHeight,pheight=canvasHeight-lineHeight,ytop,val,color,x;val=clipval(values[valuenum],min,max);x=valuenum*interval;ytop=Math.round(pheight-pheight*((val-min)/range));color=(options.get('thresholdColor')&&val<options.get('thresholdValue'))?options.get('thresholdColor'):options.get('lineColor');if(highlight){color=this.calcHighlightColor(color,options);}
return target.drawLine(x,ytop,x,ytop+lineHeight,color);}});$.fn.sparkline.bullet=bullet=createClass($.fn.sparkline._base,{type:'bullet',init:function(el,values,options,width,height){var min,max,vals;bullet._super.init.call(this,el,values,options,width,height);this.values=values=normalizeValues(values);vals=values.slice();vals[0]=vals[0]===null?vals[2]:vals[0];vals[1]=values[1]===null?vals[2]:vals[1];min=Math.min.apply(Math,values);max=Math.max.apply(Math,values);if(options.get('base')===undefined){min=min<0?min:0;}else{min=options.get('base');}
this.min=min;this.max=max;this.range=max-min;this.shapes={};this.valueShapes={};this.regiondata={};this.width=width=options.get('width')==='auto'?'4.0em':width;this.target=this.$el.simpledraw(width,height,options.get('composite'));if(!values.length){this.disabled=true;}
this.initTarget();},getRegion:function(el,x,y){var shapeid=this.target.getShapeAt(el,x,y);return(shapeid!==undefined&&this.shapes[shapeid]!==undefined)?this.shapes[shapeid]:undefined;},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{fieldkey:currentRegion.substr(0,1),value:this.values[currentRegion.substr(1)],region:currentRegion};},changeHighlight:function(highlight){var currentRegion=this.currentRegion,shapeid=this.valueShapes[currentRegion],shape;delete this.shapes[shapeid];switch(currentRegion.substr(0,1)){case'r':shape=this.renderRange(currentRegion.substr(1),highlight);break;case'p':shape=this.renderPerformance(highlight);break;case't':shape=this.renderTarget(highlight);break;}
this.valueShapes[currentRegion]=shape.id;this.shapes[shape.id]=currentRegion;this.target.replaceWithShape(shapeid,shape);},renderRange:function(rn,highlight){var rangeval=this.values[rn],rangewidth=Math.round(this.canvasWidth*((rangeval-this.min)/this.range)),color=this.options.get('rangeColors')[rn-2];if(highlight){color=this.calcHighlightColor(color,this.options);}
return this.target.drawRect(0,0,rangewidth-1,this.canvasHeight-1,color,color);},renderPerformance:function(highlight){var perfval=this.values[1],perfwidth=Math.round(this.canvasWidth*((perfval-this.min)/this.range)),color=this.options.get('performanceColor');if(highlight){color=this.calcHighlightColor(color,this.options);}
return this.target.drawRect(0,Math.round(this.canvasHeight*0.3),perfwidth-1,Math.round(this.canvasHeight*0.4)-1,color,color);},renderTarget:function(highlight){var targetval=this.values[0],x=Math.round(this.canvasWidth*((targetval-this.min)/this.range)-(this.options.get('targetWidth')/2)),targettop=Math.round(this.canvasHeight*0.10),targetheight=this.canvasHeight-(targettop*2),color=this.options.get('targetColor');if(highlight){color=this.calcHighlightColor(color,this.options);}
return this.target.drawRect(x,targettop,this.options.get('targetWidth')-1,targetheight-1,color,color);},render:function(){var vlen=this.values.length,target=this.target,i,shape;if(!bullet._super.render.call(this)){return;}
for(i=2;i<vlen;i++){shape=this.renderRange(i).append();this.shapes[shape.id]='r'+i;this.valueShapes['r'+i]=shape.id;}
if(this.values[1]!==null){shape=this.renderPerformance().append();this.shapes[shape.id]='p1';this.valueShapes.p1=shape.id;}
if(this.values[0]!==null){shape=this.renderTarget().append();this.shapes[shape.id]='t0';this.valueShapes.t0=shape.id;}
target.render();}});$.fn.sparkline.pie=pie=createClass($.fn.sparkline._base,{type:'pie',init:function(el,values,options,width,height){var total=0,i;pie._super.init.call(this,el,values,options,width,height);this.shapes={};this.valueShapes={};this.values=values=$.map(values,Number);if(options.get('width')==='auto'){this.width=this.height;}
if(values.length>0){for(i=values.length;i--;){total+=values[i];}}
this.total=total;this.initTarget();this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2);},getRegion:function(el,x,y){var shapeid=this.target.getShapeAt(el,x,y);return(shapeid!==undefined&&this.shapes[shapeid]!==undefined)?this.shapes[shapeid]:undefined;},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],percent:this.values[currentRegion]/this.total*100,color:this.options.get('sliceColors')[currentRegion%this.options.get('sliceColors').length],offset:currentRegion};},changeHighlight:function(highlight){var currentRegion=this.currentRegion,newslice=this.renderSlice(currentRegion,highlight),shapeid=this.valueShapes[currentRegion];delete this.shapes[shapeid];this.target.replaceWithShape(shapeid,newslice);this.valueShapes[currentRegion]=newslice.id;this.shapes[newslice.id]=currentRegion;},renderSlice:function(valuenum,highlight){var target=this.target,options=this.options,radius=this.radius,borderWidth=options.get('borderWidth'),offset=options.get('offset'),circle=2*Math.PI,values=this.values,total=this.total,next=offset?(2*Math.PI)*(offset/360):0,start,end,i,vlen,color;vlen=values.length;for(i=0;i<vlen;i++){start=next;end=next;if(total>0){end=next+(circle*(values[i]/total));}
if(valuenum===i){color=options.get('sliceColors')[i%options.get('sliceColors').length];if(highlight){color=this.calcHighlightColor(color,options);}
return target.drawPieSlice(radius,radius,radius-borderWidth,start,end,undefined,color);}
next=end;}},render:function(){var target=this.target,values=this.values,options=this.options,radius=this.radius,borderWidth=options.get('borderWidth'),shape,i;if(!pie._super.render.call(this)){return;}
if(borderWidth){target.drawCircle(radius,radius,Math.floor(radius-(borderWidth/2)),options.get('borderColor'),undefined,borderWidth).append();}
for(i=values.length;i--;){if(values[i]){shape=this.renderSlice(i).append();this.valueShapes[i]=shape.id;this.shapes[shape.id]=i;}}
target.render();}});$.fn.sparkline.box=box=createClass($.fn.sparkline._base,{type:'box',init:function(el,values,options,width,height){box._super.init.call(this,el,values,options,width,height);this.values=$.map(values,Number);this.width=options.get('width')==='auto'?'4.0em':width;this.initTarget();if(!this.values.length){this.disabled=1;}},getRegion:function(){return 1;},getCurrentRegionFields:function(){var result=[{field:'lq',value:this.quartiles[0]},{field:'med',value:this.quartiles[1]},{field:'uq',value:this.quartiles[2]}];if(this.loutlier!==undefined){result.push({field:'lo',value:this.loutlier});}
if(this.routlier!==undefined){result.push({field:'ro',value:this.routlier});}
if(this.lwhisker!==undefined){result.push({field:'lw',value:this.lwhisker});}
if(this.rwhisker!==undefined){result.push({field:'rw',value:this.rwhisker});}
return result;},render:function(){var target=this.target,values=this.values,vlen=values.length,options=this.options,canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight,minValue=options.get('chartRangeMin')===undefined?Math.min.apply(Math,values):options.get('chartRangeMin'),maxValue=options.get('chartRangeMax')===undefined?Math.max.apply(Math,values):options.get('chartRangeMax'),canvasLeft=0,lwhisker,loutlier,iqr,q1,q2,q3,rwhisker,routlier,i,size,unitSize;if(!box._super.render.call(this)){return;}
if(options.get('raw')){if(options.get('showOutliers')&&values.length>5){loutlier=values[0];lwhisker=values[1];q1=values[2];q2=values[3];q3=values[4];rwhisker=values[5];routlier=values[6];}else{lwhisker=values[0];q1=values[1];q2=values[2];q3=values[3];rwhisker=values[4];}}else{values.sort(function(a,b){return a-b;});q1=quartile(values,1);q2=quartile(values,2);q3=quartile(values,3);iqr=q3-q1;if(options.get('showOutliers')){lwhisker=rwhisker=undefined;for(i=0;i<vlen;i++){if(lwhisker===undefined&&values[i]>q1-(iqr*options.get('outlierIQR'))){lwhisker=values[i];}
if(values[i]<q3+(iqr*options.get('outlierIQR'))){rwhisker=values[i];}}
loutlier=values[0];routlier=values[vlen-1];}else{lwhisker=values[0];rwhisker=values[vlen-1];}}
this.quartiles=[q1,q2,q3];this.lwhisker=lwhisker;this.rwhisker=rwhisker;this.loutlier=loutlier;this.routlier=routlier;unitSize=canvasWidth/(maxValue-minValue+1);if(options.get('showOutliers')){canvasLeft=Math.ceil(options.get('spotRadius'));canvasWidth-=2*Math.ceil(options.get('spotRadius'));unitSize=canvasWidth/(maxValue-minValue+1);if(loutlier<lwhisker){target.drawCircle((loutlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get('spotRadius'),options.get('outlierLineColor'),options.get('outlierFillColor')).append();}
if(routlier>rwhisker){target.drawCircle((routlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get('spotRadius'),options.get('outlierLineColor'),options.get('outlierFillColor')).append();}}
target.drawRect(Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(canvasHeight*0.1),Math.round((q3-q1)*unitSize),Math.round(canvasHeight*0.8),options.get('boxLineColor'),options.get('boxFillColor')).append();target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get('lineColor')).append();target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get('whiskerColor')).append();target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q3-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get('lineColor')).append();target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get('whiskerColor')).append();target.drawLine(Math.round((q2-minValue)*unitSize+canvasLeft),Math.round(canvasHeight*0.1),Math.round((q2-minValue)*unitSize+canvasLeft),Math.round(canvasHeight*0.9),options.get('medianColor')).append();if(options.get('target')){size=Math.ceil(options.get('spotRadius'));target.drawLine(Math.round((options.get('target')-minValue)*unitSize+canvasLeft),Math.round((canvasHeight/2)-size),Math.round((options.get('target')-minValue)*unitSize+canvasLeft),Math.round((canvasHeight/2)+size),options.get('targetColor')).append();target.drawLine(Math.round((options.get('target')-minValue)*unitSize+canvasLeft-size),Math.round(canvasHeight/2),Math.round((options.get('target')-minValue)*unitSize+canvasLeft+size),Math.round(canvasHeight/2),options.get('targetColor')).append();}
target.render();}});VShape=createClass({init:function(target,id,type,args){this.target=target;this.id=id;this.type=type;this.args=args;},append:function(){this.target.appendShape(this);return this;}});VCanvas_base=createClass({_pxregex:/(\d+)(px)?\s*$/i,init:function(width,height,target){if(!width){return;}
this.width=width;this.height=height;this.target=target;this.lastShapeId=null;if(target[0]){target=target[0];}
$.data(target,'_jqs_vcanvas',this);},drawLine:function(x1,y1,x2,y2,lineColor,lineWidth){return this.drawShape([[x1,y1],[x2,y2]],lineColor,lineWidth);},drawShape:function(path,lineColor,fillColor,lineWidth){return this._genShape('Shape',[path,lineColor,fillColor,lineWidth]);},drawCircle:function(x,y,radius,lineColor,fillColor,lineWidth){return this._genShape('Circle',[x,y,radius,lineColor,fillColor,lineWidth]);},drawPieSlice:function(x,y,radius,startAngle,endAngle,lineColor,fillColor){return this._genShape('PieSlice',[x,y,radius,startAngle,endAngle,lineColor,fillColor]);},drawRect:function(x,y,width,height,lineColor,fillColor){return this._genShape('Rect',[x,y,width,height,lineColor,fillColor]);},getElement:function(){return this.canvas;},getLastShapeId:function(){return this.lastShapeId;},reset:function(){alert('reset not implemented');},_insert:function(el,target){$(target).html(el);},_calculatePixelDims:function(width,height,canvas){var match;match=this._pxregex.exec(height);if(match){this.pixelHeight=match[1];}else{this.pixelHeight=$(canvas).height();}
match=this._pxregex.exec(width);if(match){this.pixelWidth=match[1];}else{this.pixelWidth=$(canvas).width();}},_genShape:function(shapetype,shapeargs){var id=shapeCount++;shapeargs.unshift(id);return new VShape(this,id,shapetype,shapeargs);},appendShape:function(shape){alert('appendShape not implemented');},replaceWithShape:function(shapeid,shape){alert('replaceWithShape not implemented');},insertAfterShape:function(shapeid,shape){alert('insertAfterShape not implemented');},removeShapeId:function(shapeid){alert('removeShapeId not implemented');},getShapeAt:function(el,x,y){alert('getShapeAt not implemented');},render:function(){alert('render not implemented');}});VCanvas_canvas=createClass(VCanvas_base,{init:function(width,height,target,interact){VCanvas_canvas._super.init.call(this,width,height,target);this.canvas=document.createElement('canvas');if(target[0]){target=target[0];}
$.data(target,'_jqs_vcanvas',this);$(this.canvas).css({display:'inline-block',width:width,height:height,verticalAlign:'top'});this._insert(this.canvas,target);this._calculatePixelDims(width,height,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=interact;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined;$(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight});},_getContext:function(lineColor,fillColor,lineWidth){var context=this.canvas.getContext('2d');if(lineColor!==undefined){context.strokeStyle=lineColor;}
context.lineWidth=lineWidth===undefined?1:lineWidth;if(fillColor!==undefined){context.fillStyle=fillColor;}
return context;},reset:function(){var context=this._getContext();context.clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined;},_drawShape:function(shapeid,path,lineColor,fillColor,lineWidth){var context=this._getContext(lineColor,fillColor,lineWidth),i,plen;context.beginPath();context.moveTo(path[0][0]+0.5,path[0][1]+0.5);for(i=1,plen=path.length;i<plen;i++){context.lineTo(path[i][0]+0.5,path[i][1]+0.5);}
if(lineColor!==undefined){context.stroke();}
if(fillColor!==undefined){context.fill();}
if(this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=shapeid;}},_drawCircle:function(shapeid,x,y,radius,lineColor,fillColor,lineWidth){var context=this._getContext(lineColor,fillColor,lineWidth);context.beginPath();context.arc(x,y,radius,0,2*Math.PI,false);if(this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=shapeid;}
if(lineColor!==undefined){context.stroke();}
if(fillColor!==undefined){context.fill();}},_drawPieSlice:function(shapeid,x,y,radius,startAngle,endAngle,lineColor,fillColor){var context=this._getContext(lineColor,fillColor);context.beginPath();context.moveTo(x,y);context.arc(x,y,radius,startAngle,endAngle,false);context.lineTo(x,y);context.closePath();if(lineColor!==undefined){context.stroke();}
if(fillColor){context.fill();}
if(this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=shapeid;}},_drawRect:function(shapeid,x,y,width,height,lineColor,fillColor){return this._drawShape(shapeid,[[x,y],[x+width,y],[x+width,y+height],[x,y+height],[x,y]],lineColor,fillColor);},appendShape:function(shape){this.shapes[shape.id]=shape;this.shapeseq.push(shape.id);this.lastShapeId=shape.id;return shape.id;},replaceWithShape:function(shapeid,shape){var shapeseq=this.shapeseq,i;this.shapes[shape.id]=shape;for(i=shapeseq.length;i--;){if(shapeseq[i]==shapeid){shapeseq[i]=shape.id;}}
delete this.shapes[shapeid];},replaceWithShapes:function(shapeids,shapes){var shapeseq=this.shapeseq,shapemap={},sid,i,first;for(i=shapeids.length;i--;){shapemap[shapeids[i]]=true;}
for(i=shapeseq.length;i--;){sid=shapeseq[i];if(shapemap[sid]){shapeseq.splice(i,1);delete this.shapes[sid];first=i;}}
for(i=shapes.length;i--;){shapeseq.splice(first,0,shapes[i].id);this.shapes[shapes[i].id]=shapes[i];}},insertAfterShape:function(shapeid,shape){var shapeseq=this.shapeseq,i;for(i=shapeseq.length;i--;){if(shapeseq[i]===shapeid){shapeseq.splice(i+1,0,shape.id);this.shapes[shape.id]=shape;return;}}},removeShapeId:function(shapeid){var shapeseq=this.shapeseq,i;for(i=shapeseq.length;i--;){if(shapeseq[i]===shapeid){shapeseq.splice(i,1);break;}}
delete this.shapes[shapeid];},getShapeAt:function(el,x,y){this.targetX=x;this.targetY=y;this.render();return this.currentTargetShapeId;},render:function(){var shapeseq=this.shapeseq,shapes=this.shapes,shapeCount=shapeseq.length,context=this._getContext(),shapeid,shape,i;context.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(i=0;i<shapeCount;i++){shapeid=shapeseq[i];shape=shapes[shapeid];this['_draw'+shape.type].apply(this,shape.args);}
if(!this.interact){this.shapes={};this.shapeseq=[];}}});VCanvas_vml=createClass(VCanvas_base,{init:function(width,height,target){var groupel;VCanvas_vml._super.init.call(this,width,height,target);if(target[0]){target=target[0];}
$.data(target,'_jqs_vcanvas',this);this.canvas=document.createElement('span');$(this.canvas).css({display:'inline-block',position:'relative',overflow:'hidden',width:width,height:height,margin:'0px',padding:'0px',verticalAlign:'top'});this._insert(this.canvas,target);this._calculatePixelDims(width,height,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;groupel='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+' '+this.pixelHeight+'"'+' style="position:absolute;top:0;left:0;width:'+this.pixelWidth+'px;height='+this.pixelHeight+'px;"></v:group>';this.canvas.insertAdjacentHTML('beforeEnd',groupel);this.group=$(this.canvas).children()[0];this.rendered=false;this.prerender='';},_drawShape:function(shapeid,path,lineColor,fillColor,lineWidth){var vpath=[],initial,stroke,fill,closed,vel,plen,i;for(i=0,plen=path.length;i<plen;i++){vpath[i]=''+(path[i][0])+','+(path[i][1]);}
initial=vpath.splice(0,1);lineWidth=lineWidth===undefined?1:lineWidth;stroke=lineColor===undefined?' stroked="false" ':' strokeWeight="'+lineWidth+'px" strokeColor="'+lineColor+'" ';fill=fillColor===undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';closed=vpath[0]===vpath[vpath.length-1]?'x ':'';vel='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+' '+this.pixelHeight+'" '+' id="jqsshape'+shapeid+'" '+
stroke+
fill+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+'px;width:'+this.pixelWidth+'px;padding:0px;margin:0px;" '+' path="m '+initial+' l '+vpath.join(', ')+' '+closed+'e">'+' </v:shape>';return vel;},_drawCircle:function(shapeid,x,y,radius,lineColor,fillColor,lineWidth){var stroke,fill,vel;x-=radius;y-=radius;stroke=lineColor===undefined?' stroked="false" ':' strokeWeight="'+lineWidth+'px" strokeColor="'+lineColor+'" ';fill=fillColor===undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';vel='<v:oval '+' id="jqsshape'+shapeid+'" '+
stroke+
fill+' style="position:absolute;top:'+y+'px; left:'+x+'px; width:'+(radius*2)+'px; height:'+(radius*2)+'px"></v:oval>';return vel;},_drawPieSlice:function(shapeid,x,y,radius,startAngle,endAngle,lineColor,fillColor){var vpath,startx,starty,endx,endy,stroke,fill,vel;if(startAngle===endAngle){return'';}
if((endAngle-startAngle)===(2*Math.PI)){startAngle=0.0;endAngle=(2*Math.PI);}
startx=x+Math.round(Math.cos(startAngle)*radius);starty=y+Math.round(Math.sin(startAngle)*radius);endx=x+Math.round(Math.cos(endAngle)*radius);endy=y+Math.round(Math.sin(endAngle)*radius);if(startx===endx&&starty===endy){if((endAngle-startAngle)<Math.PI){return'';}
startx=endx=x+radius;starty=endy=y;}
if(startx===endx&&starty===endy&&(endAngle-startAngle)<Math.PI){return'';}
vpath=[x-radius,y-radius,x+radius,y+radius,startx,starty,endx,endy];stroke=lineColor===undefined?' stroked="false" ':' strokeWeight="1px" strokeColor="'+lineColor+'" ';fill=fillColor===undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';vel='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+' '+this.pixelHeight+'" '+' id="jqsshape'+shapeid+'" '+
stroke+
fill+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+'px;width:'+this.pixelWidth+'px;padding:0px;margin:0px;" '+' path="m '+x+','+y+' wa '+vpath.join(', ')+' x e">'+' </v:shape>';return vel;},_drawRect:function(shapeid,x,y,width,height,lineColor,fillColor){return this._drawShape(shapeid,[[x,y],[x,y+height],[x+width,y+height],[x+width,y],[x,y]],lineColor,fillColor);},reset:function(){this.group.innerHTML='';},appendShape:function(shape){var vel=this['_draw'+shape.type].apply(this,shape.args);if(this.rendered){this.group.insertAdjacentHTML('beforeEnd',vel);}else{this.prerender+=vel;}
this.lastShapeId=shape.id;return shape.id;},replaceWithShape:function(shapeid,shape){var existing=$('#jqsshape'+shapeid),vel=this['_draw'+shape.type].apply(this,shape.args);existing[0].outerHTML=vel;},replaceWithShapes:function(shapeids,shapes){var existing=$('#jqsshape'+shapeids[0]),replace='',slen=shapes.length,i;for(i=0;i<slen;i++){replace+=this['_draw'+shapes[i].type].apply(this,shapes[i].args);}
existing[0].outerHTML=replace;for(i=1;i<shapeids.length;i++){$('#jqsshape'+shapeids[i]).remove();}},insertAfterShape:function(shapeid,shape){var existing=$('#jqsshape'+shapeid),vel=this['_draw'+shape.type].apply(this,shape.args);existing[0].insertAdjacentHTML('afterEnd',vel);},removeShapeId:function(shapeid){var existing=$('#jqsshape'+shapeid);this.group.removeChild(existing[0]);},getShapeAt:function(el,x,y){var shapeid=el.id.substr(8);return shapeid;},render:function(){if(!this.rendered){this.group.innerHTML=this.prerender;this.rendered=true;}}});}))}(document,Math));;

/* /web_kanban_sparkline/static/src/js/kanban_sparkline.js defined in bundle 'web.assets_backend' */
openerp.web_kanban_sparkline=function(instance){instance.web_kanban.SparklineBarWidget=instance.web_kanban.AbstractField.extend({className:"oe_sparkline_bar",start:function(){var self=this;var title=this.$node.html()||this.field.string;setTimeout(function(){var field_value=JSON.parse(self.field.value);var value=_.pluck(field_value,'value');var tooltips=_.pluck(field_value,'tooltip');var suffix=self.options.tooltip_suffix||"";var tooltipFormat=self.options.type=='tristate'&&'{{offset:offset}}'+suffix||'{{offset:offset}} {{value:value}}'+suffix
var sparkline_options=_.extend({type:'bar',barWidth:5,height:'20px',barWidth:4,barSpacing:1,barColor:'#96d854',tooltipFormat:tooltipFormat,chartRangeMin:0,tooltipValueLookups:{'offset':tooltips}},self.options);self.$el.sparkline(value,sparkline_options);self.$el.tooltip({delay:{show:self.options.delayIn||0,hide:0},title:function(){return title}});},0);},});instance.web_kanban.fields_registry.add("sparkline_bar","instance.web_kanban.SparklineBarWidget");};

/* /web_menu/static/src/js/web_menu.js defined in bundle 'web.assets_backend' */
openerp.web_menu=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.Menu=instance.web.Widget.extend({init:function(){var self=this;this._super.apply(this,arguments);this.has_been_loaded=$.Deferred();this.is_bound=$.Deferred();this.click_on_main_menu=false
this.maximum_visible_links='auto';this.data={data:{children:[]}};if(window.localStorage){this.folded=localStorage.getItem('oe_menu_folded')==='true';}
this.on("menu_bound",this,function(menu_data){self.reflow();var $all_menus=self.$el.parents('body').find('.oe_webclient').find('[data-menu]');var all_menu_ids=_.map($all_menus,function(menu){return parseInt($(menu).attr('data-menu'),10);});if(!_.isEmpty(all_menu_ids)){this.do_load_needaction(all_menu_ids);}});},start:function(){this._super.apply(this,arguments);return this.bind_menu();},do_reload:function(){var self=this;self.bind_menu();},bind_menu:function(){var self=this;this.$secondary_menus=this.$el.parents().find('.oe_secondary_menus_container')
this.$secondary_menus.addClass(this.folded?'oe_folded':'oe_unfolded');this.$secondary_menus.on('click','a[data-menu]',this.on_menu_click);this.$el.parents().find(".oe_toggle_secondary_menu").on('click',this.on_toggle_fold);this.$el.on('click','a[data-menu]',this.on_top_menu_click);$(".oe_menu_unfold").hide()
$(document).click(function(e){if(!$(e.target).hasClass("oe_menu_text")&&!$(e.target).hasClass("oe_menu_toggler")&&!$(e.target).hasClass("oe_secondary_submenu")&&!$(e.target).hasClass("oe_secondary_menu_section")&&!$(e.target).hasClass("oe_secondary_menu")&&self.folded){self.$secondary_menus.hide();}});this.$secondary_menus.find('.oe_menu_toggler').siblings('.oe_secondary_submenu').hide();if(self.current_menu){self.open_menu(self.current_menu);}
this.trigger('menu_bound');var lazyreflow=_.debounce(this.reflow.bind(this),200);instance.web.bus.on('resize',this,function(){if(parseInt(self.$el.parent().css('width'))<=768){lazyreflow('all_outside');}else{lazyreflow();}});instance.web.bus.trigger('resize');this.is_bound.resolve();},do_load_needaction:function(menu_ids){var self=this;menu_ids=_.compact(menu_ids);if(_.isEmpty(menu_ids)){return $.when();}
return this.rpc("/web/menu/load_needaction",{'menu_ids':menu_ids}).done(function(r){self.on_needaction_loaded(r);});},on_needaction_loaded:function(data){var self=this;this.needaction_data=data;_.each(this.needaction_data,function(item,menu_id){var $item=self.$secondary_menus.find('a[data-menu="'+menu_id+'"]');$item.find('.badge').remove();if(item.needaction_counter&&item.needaction_counter>0){$item.append(QWeb.render("Menu.needaction_counter",{widget:item}));}});},reflow:function(behavior){var self=this;var $more_container=this.$('#menu_more_container').hide();var $more=this.$('#menu_more');var $systray=this.$el.parents().find('.oe_systray');$more.children('li').insertBefore($more_container);if(behavior==='all_outside'){this.$el.find('li').show();$more_container.hide();return;}
var $toplevel_items=this.$el.find('li').not($more_container).not($systray.find('li')).hide();$toplevel_items.each(function(){if(behavior==='all_inside'){return false;}
var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>remaining_space){return false;}
$(this).show();});$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length||behavior==='all_inside');var $toplevel=this.$el.children("li:visible");if($toplevel.length===1&&behavior!='all_inside'){$toplevel.hide();}},on_toggle_fold:function(e){this.$secondary_menus.toggleClass('oe_folded').toggleClass('oe_unfolded');$(".oe_secondary_submenu").find('.active a').click();if($(".oe_toggle_secondary_menu .oe_menu_fold").css("display")=='none'){this.folded=true
this.$secondary_menus.find('.oe_secondary_menu.active_menu').show();$('.oe_logo').show();$(".oe_leftbar").show()
$(".oe_menu_fold").show()
$(".oe_menu_unfold").hide()
this.$secondary_menus.css("display","block")
this.$secondary_menus.removeClass("active_menu")
this.$secondary_menus.css("margin-left",0)
this.$secondary_menus.removeClass("active_menu")
$(this.$secondary_menus.parents('.oe_leftbar > div')[0]).removeClass("set_width")}else{this.folded=false
this.$secondary_menus.find('.oe_secondary_menu').hide();$('.oe_logo').hide();$(".oe_leftbar").hide()
$(".oe_menu_fold").hide()
$(".oe_menu_unfold").show()}
this.folded=!this.folded;if(window.localStorage){localStorage.setItem('oe_menu_folded',this.folded.toString());}},open_menu:function(id){this.current_menu=id;this.session.active_id=id;var $clicked_menu,$sub_menu,$main_menu;this.$el.add(this.$secondary_menus).find('.active_menu').removeClass('active');this.$secondary_menus.find('> .oe_secondary_menu').hide();$clicked_menu=this.$el.add(this.$secondary_menus).find('a[data-menu='+id+']');this.trigger('open_menu',id,$clicked_menu);if(this.$secondary_menus.has($clicked_menu).length){$sub_menu=$clicked_menu.parents('.oe_secondary_menu');$main_menu=this.$el.find('a[data-menu='+$sub_menu.data('menu-parent')+']').parent();}else{$sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+$clicked_menu.attr('data-menu')+']');$main_menu=$clicked_menu;}
if(this.folded){var margin_left=$main_menu.position()
this.$secondary_menus.addClass("active_menu")
this.$secondary_menus.css("margin-left",margin_left.left)
this.$secondary_menus.css("display","table")
this.$secondary_menus.find('.oe_secondary_menu').hide();if(this.$secondary_menus.parents('.oe_leftbar').length){$(this.$secondary_menus.parents('.oe_leftbar > div')[0]).addClass("set_width")}
$('.oe_logo').hide();$('.oe_footer').hide();$(".oe_menu_fold").hide()
$(".oe_menu_unfold").show()}else{this.$secondary_menus.css("display","block")
if(this.$secondary_menus.parents('.oe_leftbar').length){$(this.$secondary_menus.parents('.oe_leftbar > div')[0]).removeClass("set_width")}
this.$secondary_menus.removeClass("active_menu")
this.$secondary_menus.css("margin-left",0)
this.$secondary_menus.removeClass("active_menu")}
this.$el.find('.active').removeClass('active');$main_menu.parent().addClass('active');this.$secondary_menus.find('.oe_secondary_menu').hide();$sub_menu.show();this.$secondary_menus.parent('.oe_leftbar').toggle(!!$sub_menu.children().length);this.$secondary_menus.find('.active').removeClass('active');if($main_menu!==$clicked_menu){$clicked_menu.parents().show();if($clicked_menu.is('.oe_menu_toggler')){$clicked_menu.toggleClass('oe_menu_opened').siblings('.oe_secondary_submenu:first').toggle();}else{if(this.folded&&this.click_on_main_menu==false){$(".oe_secondary_menus_container,oe_folded,active_menu").hide()}
$clicked_menu.parent().addClass('active');}}
this.$secondary_menus.find('.oe_secondary_submenu li a span').each(function(){$(this).tooltip(this.scrollWidth>this.clientWidth?{title:$(this).text().trim(),placement:'right'}:'destroy');});},open_action:function(id){var $menu=this.$el.add(this.$secondary_menus).find('a[data-action-id="'+id+'"]');var menu_id=$menu.data('menu');if(menu_id){this.open_menu(menu_id);}},menu_click:function(id,needaction){if(!id){return;}
var $item=this.$el.find('a[data-menu='+id+']');if(!$item.length){$item=this.$secondary_menus.find('a[data-menu='+id+']');}
var action_id=$item.data('action-id');if(!action_id){if(this.$el.has($item).length){var $sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+id+']');var $items=$sub_menu.find('a[data-action-id]').filter('[data-action-id!=""]');if($items.length){action_id=$items.data('action-id');id=$items.data('menu');}}}
if(action_id){if(this.folded){$(".oe_secondary_menus_container").hide()
$(".oe_leftbar").hide()
$(".active_menu").hide()}else{$(".oe_secondary_menus_container").show()}
if(!this.click_on_main_menu){this.trigger('menu_click',{action_id:action_id,needaction:needaction,id:id,previous_menu_id:this.current_menu},$item);}}else{console.log('Menu no action found web test 04 will fail');}
this.open_menu(id);},do_reload_needaction:function(){var self=this;if(self.current_menu){self.do_load_needaction([self.current_menu]).then(function(){self.trigger("need_action_reloaded");});}},on_top_menu_click:function(ev){ev.preventDefault();var self=this;var id=$(ev.currentTarget).data('menu');var $secondary_menu=this.$el.parents().find('.oe_secondary_menu[data-menu-parent='+id+']');var $menu_leaves=$secondary_menu.children().find('.oe_menu_leaf');var menu_ids=_.map($menu_leaves,function(leave){return parseInt($(leave).attr('data-menu'),10);});self.do_load_needaction(menu_ids).then(function(){self.trigger("need_action_reloaded");});this.$el.parents().find(".oe_secondary_menus_container").scrollTop(0,0);this.on_menu_click(ev);},on_menu_click:function(ev){if($(ev.currentTarget).closest("li").closest("ul").attr("main")&&$(ev.currentTarget).attr("main")){if($(".oe_toggle_secondary_menu .oe_menu_fold").css("display")=='none'){this.click_on_main_menu=true}else{this.click_on_main_menu=false}}else{this.click_on_main_menu=false}
ev.preventDefault();var needaction=$(ev.target).is('div#menu_counter');this.menu_click($(ev.currentTarget).data('menu'),needaction);},});};

/* /website/static/src/js/website.backend.js defined in bundle 'web.assets_backend' */
openerp.website=function(instance){var _t=instance.web._t;instance.web.form.WidgetWebsiteButton=instance.web.form.AbstractField.extend({template:'WidgetWebsiteButton',render_value:function(){this._super();this.$("button:first").toggleClass("btn-success",this.get_value()).toggleClass("btn-danger",!this.get_value());this.$("a:first").attr("href",this.view.datarecord.website_url||"/");if(this.node.attrs.class){this.$el.addClass(this.node.attrs.class);}},start:function(){var self=this;this._super.apply(this,arguments);this.$("button:first").on("click",function(){console.log("click",!!$(this).hasClass("btn-danger"));self.set_value(!!$(this).hasClass("btn-danger"));return self.view.recursive_save();});},});instance.web.form.widgets=instance.web.form.widgets.extend({'website_button':'instance.web.form.WidgetWebsiteButton',});};;

/* /web_tests/static/src/js/web_tests.js defined in bundle 'web.assets_backend' */
openerp.web_tests=function(instance){instance.web.client_actions.add('buncha-forms','instance.web_tests.BunchaForms');instance.web_tests={};instance.web_tests.BunchaForms=instance.web.Widget.extend({init:function(parent){this._super(parent);this.dataset=new instance.web.DataSetSearch(this,'test.listview.relations');this.form=new instance.web.FormView(this,this.dataset,false,{action_buttons:false,pager:false});this.form.registry=instance.web.form.readonly;},render:function(){return'<div class="oe_bunchaforms"></div>';},start:function(){$.when(this.dataset.read_slice(),this.form.appendTo(this.$el)).done(this.on_everything_loaded);},on_everything_loaded:function(slice){var records=slice[0].records;if(!records.length){this.form.trigger("load_record",{});return;}
this.form.trigger("load_record",records[0]);_(records.slice(1)).each(function(record,index){this.dataset.index=index+1;this.form.reposition($('<div>').appendTo(this.$el));this.form.trigger("load_record",record);},this);}});};;

/* /web_view_editor/static/src/js/view_editor.js defined in bundle 'web.assets_backend' */
openerp.web_view_editor=function(instance){var _t=instance.web._t;var QWeb=instance.web.qweb;instance.web.ViewManagerAction.include({on_debug_changed:function(evt){var val=$(evt.currentTarget).find('option:selected').val(),current_view=this.views[this.active_view].controller;if(val==="manage_views"){if(current_view.fields_view&&current_view.fields_view.arch){var view_editor=new instance.web_view_editor.ViewEditor(current_view,current_view.$el,this.dataset,current_view.fields_view.arch);view_editor.start();}else{this.do_warn(_t("Manage Views"),_t("Could not find current view declaration"));}
evt.currentTarget.selectedIndex=0;}else{return this._super.apply(this,arguments);}}});instance.web_view_editor.ViewEditor=instance.web.Widget.extend({init:function(parent,element_id,dataset,view,options){this._super(parent);this.parent=parent;this.dataset=new instance.web.DataSetSearch(this,'ir.ui.view',null,null),this.model=dataset.model;this.xml_element_id=0;this.property=instance.web_view_editor.ViewEditor.property_widget;this.one_object=false;},start:function(){this.init_view_editor();},init_view_editor:function(){var self=this,action_title=_.str.sprintf(_t("Manage Views (%s)"),this.model);var action={name:action_title,context:this.session.user_context,domain:[["model","=",this.model]],res_model:'ir.ui.view',views:[[false,'list']],type:'ir.actions.act_window',target:"current",limit:this.dataset.limit||80,auto_search:true,flags:{sidebar:false,deletable:false,views_switcher:false,action_buttons:false,search_view:false,pager:false,radio:true,select_view_id:self.parent.fields_view.view_id}};this.view_edit_dialog=new instance.web.Dialog(this,{title:action_title,buttons:[{text:_t("Create"),click:function(){self.on_create_view();}},{text:_t("Edit"),click:function(){self.xml_element_id=0;self.get_arch();}},{text:_t("Remove"),click:function(){self.do_delete_view();}},{text:_t("Close"),click:function(){self.view_edit_dialog.close();window.location.reload();}}]}).open();this.view_edit_dialog.on("closing",this,function(){window.location.reload();});this.main_view_id=this.parent.fields_view.view_id;this.action_manager=new instance.web.ActionManager(this);this.action_manager.appendTo(this.view_edit_dialog.$el);$.when(this.action_manager.do_action(action)).done(function(){var viewmanager=self.action_manager.inner_widget;var controller=viewmanager.views[viewmanager.active_view].controller;$(controller.groups).bind({'selected':function(e,ids,records,deselected){self.main_view_id=ids[0];}});});},on_create_view:function(){var self=this;this.create_view_dialog=new instance.web.Dialog(this,{title:_.str.sprintf(_t("Create a view (%s)"),self.model),buttons:[{text:_t("Save"),click:function(){var view_values={};var warn=false;_.each(self.create_view_widget,function(widget){if(widget.is_invalid){warn=true;return false;}
if(widget.dirty&&!widget.is_invalid){view_values[widget.name]=widget.get_value();}});if(warn){self.on_valid_create_view(self.create_view_widget);}else{$.when(self.do_save_view(view_values)).done(function(){self.create_view_dialog.close();var controller=self.action_manager.inner_widget.views[self.action_manager.inner_widget.active_view].controller;controller.reload_content();});}}},{text:_t("Cancel"),click:function(){self.create_view_dialog.close();}}]}).open();var view_widget=[{'name':'view_name','string':'View Name','type':'char','required':true,'value':this.model+'.custom_'+Math.round(Math.random()*1000)},{'name':'view_type','string':'View Type','type':'selection','required':true,'value':'Form','selection':[['',''],['tree','Tree'],['form','Form'],['graph','Graph'],['calendar','Calender']]},{'name':'proirity','string':'Priority','type':'float','required':true,'value':'16'}];this.create_view_dialog.$el.append('<table id="create_view"  style="width:400px" class="oe_form"></table>');this.create_view_widget=[];_.each(view_widget,function(widget){var type_widget=new(self.property.get_any([widget.type]))(self.create_view_dialog,widget);self.create_view_dialog.$el.find('table[id=create_view]').append('<tr><td width="100px" align="right">'+widget.string+':</td>'+type_widget.render()+'</tr>');var value=null;if(widget.value){value=widget.value;type_widget.dirty=true;}
type_widget.start();type_widget.set_value(value);self.create_view_widget.push(type_widget);});},do_save_view:function(values){def=$.Deferred();var field_dataset=new instance.web.DataSetSearch(this,this.model,null,null);var model_dataset=new instance.web.DataSetSearch(this,'ir.model',null,null);var view_string="",field_name=false,self=this;field_dataset.call('fields_get',[]).done(function(fields){_.each(['name','x_name'],function(value){if(_.include(_.keys(fields),value)){field_name=value;return false;}});if(field_name){model_dataset.read_slice(['name','field_id'],{"domain":[['model','=',self.model]]}).done(function(records){if(records){view_string=records[0].name;}
var arch=_.str.sprintf("<?xml version='1.0'?>\n<%s string='%s'>\n\t<field name='%s'/>\n</%s>",values.view_type,view_string,field_name,values.view_type);var vals={'model':self.model,'name':values.view_name,'priority':values.priority,'type':values.view_type,'arch':arch};def=self.dataset.create(vals);});}});return def.promise();},on_valid_create_view:function(widgets){var msg="<ul>";_.each(widgets,function(widget){if(widget.is_invalid){msg+="<li>"+widget.name+"</li>";}});msg+="</ul>";this.do_warn(_t("The following fields are invalid :"),msg);},add_node_name:function(node){if(node.tagName.toLowerCase()=="button"||node.tagName.toLowerCase()=="field"){return(node.getAttribute('name'))?_.str.sprintf("<%s name='%s'>",node.tagName.toLowerCase(),node.getAttribute('name')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}else if(node.tagName.toLowerCase()=="group"){return(node.getAttribute('string'))?_.str.sprintf("<%s>",node.getAttribute('string')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}else{return(node.getAttribute('string'))?_.str.sprintf("<%s string='%s'>",node.tagName.toLowerCase(),node.getAttribute('string')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}},do_delete_view:function(){var self=this;if(confirm(_t("Do you really want to remove this view?"))){var controller=this.action_manager.inner_widget.views[this.action_manager.inner_widget.active_view].controller;this.dataset.unlink([this.main_view_id]).done(function(){controller.reload_content();self.main_view_id=self.parent.fields_view.view_id;});}},create_View_Node:function(node){ViewNode={'level':($(node).parents()).length+1,'id':this.xml_element_id+=1,'att_list':[],'name':this.add_node_name(node),'child_id':[]};ViewNode.att_list.push(node.tagName.toLowerCase());_.each(node.attributes,function(att){ViewNode.att_list.push([att.nodeName,att.nodeValue]);});return ViewNode;},append_child_object:function(main_object,parent_id,child_obj_list){var self=this;if(main_object.id==parent_id){main_object.child_id=child_obj_list;return main_object;}else{_.each(main_object.child_id,function(child_object){self.append_child_object(child_object,parent_id,child_obj_list);});}},convert_arch_to_obj:function(xml_Node,main_object,parent_id){var self=this;var child_obj_list=[];_.each(xml_Node,function(element){child_obj_list.push(self.create_View_Node(element));});this.append_child_object(main_object,parent_id,child_obj_list);var obj_xml_list=_.zip(xml_Node,child_obj_list);_.each(obj_xml_list,function(node){var children=_.filter(node[0].childNodes,function(child){return child.nodeType==1;});if(children){self.convert_arch_to_obj(children,main_object,node[1].id);}});return main_object;},parse_xml:function(arch,view_id){main_object={'level':0,'id':this.xml_element_id+=1,'att_list':["view"],'name':_.str.sprintf("<view view_id = %s>",view_id),'child_id':[]};var xml_arch=QWeb.load_xml(arch);return[this.convert_arch_to_obj(xml_arch.childNodes,main_object,this.xml_element_id)];},get_arch:function(){var self=this;var view_arch_list=[];this.dataset.read_ids([parseInt(self.main_view_id)],['arch','type','priority']).done(function(arch){if(arch.length){var arch_object=self.parse_xml(arch[0].arch,self.main_view_id);self.main_view_type=arch[0].type=='tree'?'list':arch[0].type;view_arch_list.push({"view_id":self.main_view_id,"arch":arch[0].arch,"priority":arch[0].priority});self.dataset.read_slice([],{domain:[['inherit_id','=',parseInt(self.main_view_id)]]}).done(function(result){_.each(result,function(res){view_arch_list.push({"view_id":res.id,"arch":res.arch,"priority":res.priority});self.inherit_view(arch_object,res);});return self.edit_view({"main_object":arch_object,"parent_child_id":self.parent_child_list(arch_object,[]),"arch":view_arch_list});});}else{self.do_warn(_t("Please select view in list :"));}});},parent_child_list:function(one_object,parent_list){var self=this;_.each(one_object,function(element){if(element.child_id.length!=0){parent_list.push({"key":element.id,"value":_.pluck(element.child_id,'id')});self.parent_child_list(element.child_id,parent_list);}});return parent_list;},inherit_view:function(arch_object,result){var self=this,xml_list=[],xml_arch=QWeb.load_xml(result.arch);if(xml_arch.childNodes[0].tagName=="data"){xml_list=_.filter(xml_arch.childNodes[0].childNodes,function(child){return child.nodeType==1;});}else{xml_list.push(xml_arch.childNodes[0]);}
_.each(xml_list,function(xml){var expr_to_list=[],xpath_arch_object=self.parse_xml(QWeb.tools.xml_node_to_string(xml),result.id);if(xml.tagName=="xpath"){var part_expr=_.without(xml.getAttribute('expr').split("/"),"");_.each(part_expr,function(part){expr_to_list.push(_.without($.trim(part.replace(/[^a-zA-Z 0-9 _]+/g,'!')).split("!"),""));});}else{var temp=_.reject(xpath_arch_object[0].child_id[0].att_list,function(list){return list instanceof Array?_.include(list,"position"):false;});expr_to_list=[_.flatten(temp)];}
self.inherit_apply(expr_to_list,arch_object,xpath_arch_object);});},inherit_apply:function(expr_list,arch_object,xpath_arch_object){var self=this;if(xpath_arch_object.length){var check=expr_list[0],obj=false;switch(check.length){case 2:if(parseInt(check[1])){var temp_list=_.select(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});obj=arch_object[_.indexOf(arch_object,temp_list[parseInt(check[1])-1])];}else{obj=_.detect(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});}
break;case 3:obj=_.detect(arch_object,function(element){if((_.intersection(_.flatten(element.att_list),_.uniq(check))).length==_.uniq(check).length){return element;}});break;case 1:var temp_list=_.select(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});if(temp_list.length!=0){expr_list.length==1?obj=temp_list[0]:expr_list.shift();}
break;}
if(obj){expr_list.shift();if(expr_list.length){self.inherit_apply(expr_list,obj.child_id,xpath_arch_object);}else{self.increase_level(xpath_arch_object[0],obj.level+1);obj.child_id.push(xpath_arch_object[0]);xpath_arch_object.pop();}}else{_.each(arch_object,function(element){self.inherit_apply(expr_list,element.child_id,xpath_arch_object);});}}},increase_level:function(val,level){var self=this;val.level=level;_.each(val.child_id,function(val,key){self.increase_level(val,level+1);});},do_select_row:function(row_id){this.edit_xml_dialog.$el.find("tr[id^='viewedit-']").removeClass('ui-selected');this.edit_xml_dialog.$el.find("tr[id=viewedit-"+row_id+"]").addClass('ui-selected');},do_parent_img_hide_show:function(img){if(_.str.include($(img).attr('src'),'/web/static/src/img/collapse.gif')){$(img).attr('src','/web/static/src/img/expand.gif');this.on_expand(img);}else{$(img).attr('src','/web/static/src/img/collapse.gif');this.on_collapse(img);}},edit_view:function(one_object){var self=this;this.one_object=one_object;this.edit_xml_dialog=new instance.web.Dialog(this,{title:_.str.sprintf(_t("View Editor %d - %s"),self.main_view_id,self.model),buttons:[{text:_t("Inherited View"),click:function(){var selected_row=self.edit_xml_dialog.$el.find('.ui-selected');if(selected_row.length){if(selected_row.find('a').text().search("field")!=-1){if(confirm(_t("Do you really wants to create an inherited view here?"))){self.inherited_view(selected_row);}}else{alert(_t("Can't Update View"));}}else{alert(_t("Select an element"));}}},{text:_t("Preview"),click:function(){var action={context:self.session.user_context,res_model:self.model,views:[[self.main_view_id,self.main_view_type]],type:'ir.actions.act_window',target:"new",auto_search:true,flags:{sidebar:false,views_switcher:false,action_buttons:false}};var action_manager=new instance.web.ActionManager(self);action_manager.do_action(action);}},{text:_t("Close"),click:function(){self.action_manager.inner_widget.views[self.action_manager.inner_widget.active_view].controller.reload_content();self.edit_xml_dialog.close();}}]}).open();var no_property_att=[];_.each(_PROPERTIES,function(val,key){if(!val.length)no_property_att.push(key);});this.edit_xml_dialog.$el.html(QWeb.render('view_editor',{'data':one_object['main_object'],'no_properties':no_property_att}));this.edit_xml_dialog.$el.find("tr[id^='viewedit-']").click(function(){self.do_select_row(this.id.split('-')[1]);});this.edit_xml_dialog.$el.find("img[id^='parentimg-']").click(function(){self.do_parent_img_hide_show(this);});this.edit_xml_dialog.$el.find("img[id^='side-']").click(function(){self.on_select_img(this);});},inherited_view:function(selected_row){var self=this;var row_id=parseInt((selected_row.attr('id')).split('-')[1]);var obj=self.get_object_by_id(row_id,self.one_object['main_object'],[])[0];var view_name=this.model+'.inherit_'+Math.round(Math.random()*1000);var view_find=selected_row;var view_id;var min_level=parseInt(selected_row.attr('level'));while(1){view_find=view_find.prev();if(view_find.length==0||self.edit_xml_dialog.$el.find(view_find).find('a').text().search("view_id")!=-1&&parseInt(view_find.attr('level'))<min_level){view_id=parseInt($(view_find).find('a').text().replace(/[^0-9]+/g,''));break;}
if(view_find.attr('level')<min_level){min_level=parseInt(view_find.attr('level'));}}
var val=_.detect(obj.att_list,function(val){return val[0]=="name";});var priority=_.detect(self.one_object['arch'],function(val){return val.view_id==view_id;});var arch=_.str.sprintf("<?xml version='1.0'?>\n\t <field name='%s' position='after'> </field>",val[1]);var vals={'model':self.model,'name':view_name,'priority':priority.priority+1,'type':"form",'arch':arch,'inherit_id':self.main_view_id};this.dataset.create(vals).done(function(id){var arch_to_obj=self.parse_xml(arch,id);obj.child_id.push(arch_to_obj[0]);self.one_object['parent_child_id']=self.parent_child_list(self.one_object['main_object'],[]);self.one_object['arch'].push({'view_id':id,"arch":arch,'priority':priority.priority+1});self.increase_level(arch_to_obj[0],obj.level+1);self.render_inherited_view(selected_row,arch_to_obj[0]);});},render_inherited_view:function(selected_row,obj){var self=this,row_id=parseInt((selected_row.attr('id')).split('-')[1]);var clone=this.create_clone(selected_row.clone(),obj);if(selected_row.find("img[id^='parentimg-']").length==0){($(selected_row.find('a').parent()).siblings('td')).append($('<img width="16" height="16"></img>').attr('src','/web/static/src/img/collapse.gif').attr('id','parentimg-'+row_id).click(function(){self.do_parent_img_hide_show(this);}));}
self.edit_xml_dialog.$el.find("tr[id='viewedit-"+row_id+"']").after(clone.removeClass('ui-selected'));_.each(obj.child_id,function(obj){self.render_inherited_view(clone,obj);});},on_select_img:function(element_img){var self=this;var side=$(element_img).closest("tr[id^='viewedit-']");this.one_object.clicked_tr_id=parseInt((side.attr('id')).split('-')[1]);this.one_object.clicked_tr_level=parseInt(side.attr('level'));var img=side.find("img[id='parentimg-"+this.one_object.clicked_tr_id+"']").attr('src');var view_id=0,view_xml_id=0,view_find=side;var min_level=this.one_object.clicked_tr_id;if(($(side).find('a').text()).search("view_id")!=-1){view_id=parseInt(($(view_find).find('a').text()).replace(/[^0-9]+/g,''));view_xml_id=(view_find.attr('id')).split('-')[1];this.one_object.clicked_tr_id+=1;this.one_object.clicked_tr_level+=1;}else{while(1){view_find=view_find.prev();if(view_find.length==0||(self.edit_xml_dialog.$el.find(view_find).find('a').text()).search("view_id")!=-1&&parseInt(view_find.attr('level'))<min_level){view_id=parseInt(($(view_find).find('a').text()).replace(/[^0-9]+/g,''));view_xml_id=parseInt((view_find.attr('id')).split('-')[1]);break;}
if(view_find.attr('level')<min_level){min_level=parseInt(view_find.attr('level'));}}}
this.one_object.clicked_tr_view=[view_id,view_xml_id];switch(element_img.id){case"side-add":self.do_node_add(side);break;case"side-remove":if(confirm(_t("Do you really want to remove this node?"))){self.do_save_update_arch("remove_node");}
break;case"side-edit":self.do_node_edit(side);break;case"side-up":self.do_node_up(side,img);break;case"side-down":self.do_node_down(side,img);break;}},do_node_add:function(side){var self=this,property_to_check=[];var tr=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object['main_object'],[])[0].att_list[0];var parent_tr=($(side).prevAll("tr[level="+String(this.one_object.clicked_tr_level-1)+"]"))[0];var field_dataset=new instance.web.DataSetSearch(this,this.model,null,null);parent_tr=self.get_object_by_id(parseInt($(parent_tr).attr('id').replace(/[^0-9]+/g,'')),this.one_object['main_object'],[])[0].att_list[0];_.each([tr,parent_tr],function(element){var value=_.has(_CHILDREN,element)?element:_.str.include(html_tag,element)?"html_tag":false;property_to_check.push(value);});field_dataset.call('fields_get',[]).done(function(result){var fields=_.keys(result);fields.push(" "),fields.sort();self.on_add_node(property_to_check,fields,self.inject_position(parent_tr,tr));});},inject_position:function(parent_tag,current_tag){if(parent_tag=="view")
return['Inside'];if(current_tag=="field")
return['After','Before'];return['After','Before','Inside'];},do_node_edit:function(side){var self=this;var result=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object['main_object'],[]);if(result.length&&result[0]&&result[0].att_list){var properties=_PROPERTIES[result[0].att_list[0]];self.on_edit_node(properties);}},do_node_down:function(cur_tr,img){var self=this,next_tr,last_tr,tr_to_move=[];tr_to_move.push(cur_tr);if(img){while(1){next_tr=cur_tr.next();if(parseInt(next_tr.attr('level'))<=this.one_object.clicked_tr_level||next_tr.length==0){last_tr=next_tr;break;}else{tr_to_move.push(next_tr);cur_tr=next_tr;}}}else{last_tr=cur_tr.next();}
if((self.edit_xml_dialog.$el.find(last_tr).find('a').text()).search("view_id")!=-1){return false;}
if(last_tr.length!=0&&parseInt(last_tr.attr('level'))==this.one_object.clicked_tr_level){var last_tr_id=(last_tr.attr('id')).split('-')[1];img=last_tr.find("img[id='parentimg-"+last_tr_id+"']").attr('src');if(img){self.edit_xml_dialog.$el.find("img[id='parentimg-"+last_tr_id+"']").attr('src','/web/static/src/img/expand.gif');while(1){var next_tr=last_tr.next();if(next_tr.attr('level')<=this.one_object.clicked_tr_level||next_tr.length==0)break;next_tr.hide();last_tr=next_tr;}}
tr_to_move.reverse();_.each(tr_to_move,function(rec){$(last_tr).after(rec);});self.do_save_update_arch("down");}},do_node_up:function(cur_tr,img){var self=this,side=cur_tr,tr_to_move=[];tr_to_move.push(side);while(1){var prev_tr=cur_tr.prev();if(this.one_object.clicked_tr_level>=parseInt(prev_tr.attr('level'))||prev_tr.length==0){last_tr=prev_tr;break;}
cur_tr=prev_tr;}
if(img){self.edit_xml_dialog.$el.find("img[id='parentimg-"+this.one_object.clicked_tr_id+"']").attr('src','/web/static/src/img/expand.gif');while(1){next_tr=side.next();if(parseInt(next_tr.attr('level'))<=this.one_object.clicked_tr_level||next_tr.length==0){break;}else{next_tr.hide();tr_to_move.push(next_tr);side=next_tr;}}}
if(last_tr.length!=0&&parseInt(last_tr.attr('level'))==this.one_object.clicked_tr_level&&(self.edit_xml_dialog.$el.find(last_tr).find('a').text()).search("view_id")==-1){_.each(tr_to_move,function(rec){$(last_tr).before(rec);});self.do_save_update_arch("up");}},do_save_update_arch:function(move_direct,update_values){var self=this;var arch=_.detect(self.one_object['arch'],function(element)
{return element.view_id==self.one_object.clicked_tr_view[0]});var obj=self.get_object_by_id(this.one_object.clicked_tr_view[1],this.one_object['main_object'],[]);var xml_arch=QWeb.load_xml(arch.arch);if(xml_arch.childNodes[0].tagName=="data"){var check_list=_.flatten(obj[0].child_id[0].att_list);var children=_.filter(xml_arch.childNodes[0].childNodes,function(child){return child.nodeType==1;});var inherited_view=_.detect(children,function(xml_child){var temp_obj=self.create_View_Node(xml_child),insert=_.intersection(_.flatten(temp_obj.att_list),_.uniq(check_list));if(insert.length==_.uniq(check_list).length){return xml_child;}});xml_arch=QWeb.load_xml(instance.web.xml_to_str(inherited_view));}
return self.do_save_xml(xml_arch.documentElement,obj[0].child_id[0],obj[0].child_id,move_direct,update_values,arch);},get_object_by_id:function(id,one_object,result){var self=this;if(result.length==0){var check=_.detect(one_object,function(obj){return id==obj.id;});if(check){result.push(check);}
_.each(one_object,function(obj){self.get_object_by_id(id,obj.child_id,result);});}
return result;},create_clone:function(clone,new_node_obj){var self=this;clone.find('a').text(new_node_obj.name);($(clone.find('a').parent()).siblings('td')).css("padding-left",20*new_node_obj.level);clone.attr("id","viewedit-"+new_node_obj.id);clone.attr("level",new_node_obj.level);clone.find("img[id^='parentimg-']").remove();clone.bind("click",function(){self.do_select_row(this.id.split('-')[1]);});clone.find("img[id^='side-']").click(function(){self.on_select_img(this);});return clone;},do_save_xml:function(arch1,obj,child_list,move_direct,update_values,arch){var self=this,children_list=$(arch1).children(),list_obj_xml;try{list_obj_xml=_.zip(children_list,obj.child_id);}catch(err){return;}
if(this.one_object.clicked_tr_id){if(obj.id==this.one_object.clicked_tr_id){var parent=false,index=_.indexOf(child_list,obj);if(move_direct=="down"){var next=$(arch1).next();$(next).after(arch1);var re_insert_obj=child_list.splice(index,1);child_list.splice(index+1,0,re_insert_obj[0]);parent=$(arch1).parents();}else if(move_direct=="up"){var prev=$(arch1).prev();$(prev).before(arch1);var re_insert_obj=child_list.splice(index,1);child_list.splice(index-1,0,re_insert_obj[0]);parent=$(arch1).parents();}else if(move_direct=="update_node"){_.each(update_values,function(val){if(val[1])$(arch1)[0].setAttribute(val[0],val[1]);else $(arch1)[0].removeAttribute(val[0]);});var new_obj=self.create_View_Node(arch1);new_obj.id=obj.id,new_obj.child_id=obj.child_id;self.edit_xml_dialog.$el.find("tr[id='viewedit-"+this.one_object.clicked_tr_id+"']").find('a').text(new_obj.name);child_list.splice(index,1,new_obj);parent=$(arch1).parents();}else if(move_direct=="add_node"){var tr_click=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+self.one_object.clicked_tr_id+"']"),temp_xml=QWeb.load_xml(update_values[0]),object_xml=self.create_View_Node(temp_xml.childNodes[0]);(update_values[1]=="Inside")?object_xml.level=obj.level+1:object_xml.level=obj.level;var clone=self.create_clone(tr_click.clone(),object_xml),after_append=_.detect(self.one_object['parent_child_id'],function(ele){return self.one_object.clicked_tr_id==ele.key;});after_append=(after_append)?_.last(after_append.value):self.one_object.clicked_tr_id;switch(update_values[1]){case"After":self.edit_xml_dialog.$el.find("tr[id='viewedit-"+after_append+"']").after(clone);$(arch1).after($(update_values[0]));child_list.splice(index+1,0,object_xml);break;case"Before":tr_click.before(clone);$(arch1).before($(update_values[0]));child_list.splice(index-1,0,object_xml);break;case"Inside":if(tr_click.find("img[id^='parentimg-']").length==0){($(tr_click.find('a').parent()).siblings('td')).append($('<img width="16" height="16"></img>').attr('src','/web/static/src/img/collapse.gif').attr('id','parentimg-'+self.one_object.clicked_tr_id).click(function(){self.do_parent_img_hide_show(this);}));}
$(arch1).append($(update_values[0]));self.edit_xml_dialog.$el.find("tr[id='viewedit-"+after_append+"']").after(clone);obj.child_id.push(object_xml);break;}
self.edit_xml_dialog.$el.find("tr[id='viewedit-"+object_xml.id+"']").removeClass('ui-selected');parent=$(arch1).parents();}else if(move_direct=="remove_node"){parent=$(arch1).parents();if(parent.length==0||(parent[0].tagName.toLowerCase()=="data")){self.one_object.clicked_tr_id=self.one_object.clicked_tr_id-1;self.one_object.clicked_tr_level=self.one_object.clicked_tr_level-1;(parent.length==0)?parent.push("remove_view"):false;}
$(arch1).remove();child_list.splice(index,1);var cur_tr=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+self.one_object.clicked_tr_id+"']");_.each(self.get_list_tr(cur_tr,self.one_object.clicked_tr_level),function(tr_element){tr_element.remove();});cur_tr.remove();var parent_img=_.detect(self.one_object['parent_child_id'],function(element){return _.include(element.value,self.one_object.clicked_tr_id);});if(parent_img.value.length==1){self.edit_xml_dialog.$el.find("tr[id='viewedit-"+parent_img.key+"']").find("img[id^='parentimg-']").remove();}
self.one_object['parent_child_id']=self.parent_child_list(self.one_object['main_object'],[]);}
var convert_to_utf=(parent.length!=0)?parent[parent.length-1]:arch1;if(convert_to_utf!="remove_view"){convert_to_utf=QWeb.tools.xml_node_to_string(convert_to_utf);convert_to_utf=convert_to_utf.replace('xmlns="http://www.w3.org/1999/xhtml"',"");convert_to_utf='<?xml version="1.0"?>'+convert_to_utf;arch.arch=convert_to_utf;this.dataset.write(this.one_object.clicked_tr_view[0],{"arch":convert_to_utf});}else{this.dataset.unlink([this.one_object.clicked_tr_view[0]]);}
if(move_direct=="add_node"){self.add_node_dialog.close();self.on_select_img(clone.find("img[id='side-edit']")[0]);self.one_object['parent_child_id']=self.parent_child_list(self.one_object['main_object'],[]);}}
if(obj.level<=this.one_object.clicked_tr_level){_.each(list_obj_xml,function(child_node){self.do_save_xml(child_node[0],child_node[1],obj.child_id,move_direct,update_values,arch);});}}},on_expand:function(expand_img){var level=parseInt($(expand_img).closest("tr[id^='viewedit-']").attr('level'));var cur_tr=$(expand_img).closest("tr[id^='viewedit-']");_.each(this.get_list_tr(cur_tr,level),function(tr_element){tr_element.hide();});},get_list_tr:function(cur_tr,level){tr_list=[];while(1){var nxt_tr=cur_tr.next();if(parseInt(nxt_tr.attr('level'))>level){cur_tr=nxt_tr;tr_list.push(nxt_tr);}else return tr_list;}},on_collapse:function(collapse_img){var self=this,id=collapse_img.id.split('-')[1];var datas=_.detect(self.one_object['parent_child_id'],function(res){return res.key==id;});_.each(datas.value,function(rec){var tr=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+rec+"']");tr.find("img[id='parentimg-"+rec+"']").attr('src','/web/static/src/img/expand.gif');tr.show();});},on_edit_node:function(properties){var self=this;this.edit_node_dialog=new instance.web.Dialog(this,{title:_t("Properties"),size:'medium',buttons:[{text:_t("Update"),click:function(){var warn=false,update_values=[];_.each(self.edit_widget,function(widget){if(widget.is_invalid){warn=true;return false;}
if(widget.dirty&&!widget.is_invalid){update_values.push([widget.name,widget.get_value()]);}});if(warn){self.on_valid_create_view(self.edit_widget);}else{self.do_save_update_arch("update_node",update_values);self.edit_node_dialog.close();}}},{text:_t("Cancel"),click:function(){self.edit_node_dialog.close();}}]}).open();var _PROPERTIES_ATTRIBUTES={'name':{'name':'name','string':'Name','type':'char'},'string':{'name':'string','string':'String','type':'char'},'required':{'name':'required','string':'Required','type':'boolean'},'readonly':{'name':'readonly','string':'Readonly','type':'boolean'},'invisible':{'name':'invisible','string':'Invisible','type':'boolean'},'domain':{'name':'domain','string':'Domain','type':'char'},'context':{'name':'context','string':'Context','type':'char'},'limit':{'name':'limit','string':'Limit','type':'float'},'min_rows':{'name':'min_rows','string':'Minimum rows','type':'float'},'date_start':{'name':'date_start','string':'Start date','type':'char'},'date_delay':{'name':'date_delay','string':'Delay date','type':'char'},'day_length':{'name':'day_length','string':'Day length','type':'char'},'mode':{'name':'mode','string':'Mode','type':'char'},'align':{'name':'align','string':'Alignment ','type':'selection','selection':[['',''],['0.0','Left'],['0.5','Center'],['1.0','Right']]},'icon':{'name':'icon','string':'Icon','type':'selection','selection':_ICONS},'type':{'name':'type','string':'Type','type':'selection','selection':[['',''],['action','Action'],['object','Object'],['workflow','Workflow'],['server_action','Server Action']]},'special':{'name':'special','string':'Special','type':'selection','selection':[['',''],['save','Save Button'],['cancel','Cancel Button'],['open','Open Button']]},'target':{'name':'target','string':'Target','type':'selection','selection':[['',''],['new','New Window']]},'confirm':{'name':'confirm','string':'Confirm','type':'char'},'style':{'name':'style','string':'Style','type':'selection','selection':[["",""],["1","1"],["1-1","1-1"],["1-2","1-2"],["2-1","2-1"],["1-1-1","1-1-1"]]},'filename':{'name':'filename','string':'File Name','type':'char'},'width':{'name':'width','string':'Width','type':'float'},'height':{'name':'height','string':'Height','type':'float'},'attrs':{'name':'attrs','string':'Attrs','type':'char'},'col':{'name':'col','string':'col','type':'float'},'link':{'name':'link','string':'Link','type':'char'},'position':{'name':'position','string':'Position','type':'selection','selection':[['',''],['after','After'],['before','Before'],['inside','Inside'],['replace','Replace']]},'states':{'name':'states','string':'states','type':'char'},'eval':{'name':'eval','string':'Eval','type':'char'},'ref':{'name':'ref','string':'Ref','type':'char'},'on_change':{'name':'on_change','string':'On change','type':'char'},'nolabel':{'name':'nolabel','string':'No label','type':'boolean'},'completion':{'name':'completion','string':'Completion','type':'boolean'},'colspan':{'name':'colspan','string':'Colspan','type':'float'},'widget':{'name':'widget','string':'widget','type':'selection'},'colors':{'name':'colors','string':'Colors','type':'char'},'editable':{'name':'editable','string':'Editable','type':'selection','selection':[["",""],["top","Top"],["bottom","Bottom"]]},'groups':{'name':'groups','string':'Groups','type':'selection_multi'},'fonts':{'name':'fonts','string':'fonts','type':'char'},};var arch_val=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object['main_object'],[]);this.edit_node_dialog.$el.append('<table id="rec_table"  style="width:400px" class="oe_form"></table>');this.edit_widget=[];self.ready=$.when(self.on_groups(properties)).done(function(){_PROPERTIES_ATTRIBUTES['groups']['selection']=self.groups;var values=_.keys(instance.web.form.widgets.map);values.push('');values.sort();_PROPERTIES_ATTRIBUTES['widget']['selection']=values;var widgets=_.filter(_PROPERTIES_ATTRIBUTES,function(property){return _.include(properties,property.name)});_.each(widgets,function(widget){var type_widget=new(self.property.get_any([widget.type]))(self.edit_node_dialog,widget);var value=_.detect(arch_val[0]['att_list'],function(res){return res instanceof Array?_.include(res,widget.name):false;});value=value instanceof Array?value[1]:value;self.edit_node_dialog.$el.find('table[id=rec_table]').append('<tr><td align="right">'+widget.string+':</td>'+type_widget.render()+'</tr>');type_widget.start();type_widget.set_value(value);self.edit_widget.push(type_widget);});});},on_groups:function(properties){var self=this,def=$.Deferred();if(!_.include(properties,'groups')){self.groups=false;def.resolve();}
var group_ids=[],group_names={},groups=[];var res_groups=new instance.web.DataSetSearch(this,'res.groups',null,null),model_data=new instance.web.DataSetSearch(self,'ir.model.data',null,null);res_groups.read_slice([],{}).done(function(res_grp){_.each(res_grp,function(res){var key=res.id;group_names[key]=res.full_name;group_ids.push(res.id);});model_data.read_slice([],{domain:[['res_id','in',group_ids],['model','=','res.groups']]}).done(function(model_grp){_.each(model_grp,function(res_group){groups.push([res_group.module+"."+res_group.name,group_names[res_group.res_id]]);});self.groups=groups;def.resolve();});});return def.promise();},on_add_node:function(properties,fields,position){var self=this;var render_list=[{'name':'node_type','selection':_.keys(_CHILDREN).sort(),'value':'field','string':'Node Type','type':'selection'},{'name':'field_value','selection':fields,'value':false,'string':'','type':'selection'},{'name':'position','selection':position,'value':false,'string':'Position','type':'selection'}];this.add_widget=[];this.add_node_dialog=new instance.web.Dialog(this,{title:_t("Properties"),size:'medium',buttons:[{text:_t("Update"),click:function(){var check_add_node=true,values={};_.each(self.add_widget,function(widget){values[widget.name]=widget.get_value()||false;});(values.position=="Inside")?check_add_node=(_.include(_CHILDREN[properties[0]],values.node_type))?true:false:check_add_node=(_.include(_CHILDREN[properties[1]],values.node_type))?true:false;if(values.node_type=="field"&&check_add_node)
{check_add_node=(values.field_value!=" ")?true:false;}
if(check_add_node){var tag=(values.node_type=="field")?_.str.sprintf("<%s name='%s'> </%s>",values.node_type,values.field_value,values.node_type):_.str.sprintf("<%s> </%s>",values.node_type,values.node_type);self.do_save_update_arch("add_node",[tag,values.position]);}else{alert("Can't Update View");}}},{text:_t("Cancel"),click:function(){self.add_node_dialog.close();}}]}).open();this.add_node_dialog.$el.append('<table id="rec_table"  style="width:420px" class="oe_form"><tbody><tr></tbody></table>');var table_selector=self.add_node_dialog.$el.find('table[id=rec_table] tbody');_.each(render_list,function(node){type_widget=new(self.property.get_any([node.type]))(self.add_node_dialog,node);if(node.name=="position"){table_selector.append('</tr><tr><td align="right" width="100px">'+node.string+'</td>'+type_widget.render()+'</tr>');}else{table_selector.append('<td align="right">'+node.string+'</td>'+type_widget.render());if(node.name=="field_value"){table_selector.append('<td id="new_field" align="right"  width="100px"> <button>'+_.str.escapeHTML(_t("New Field"))+'</button></td>');}}
type_widget.start();type_widget.set_value(node.value);self.add_widget.push(type_widget);});table_selector.find("td[id^=]").attr("width","100px");self.add_node_dialog.$el.find('#new_field').click(function(){model_data=new instance.web.DataSetSearch(self,'ir.model',null,null);model_data.read_slice([],{domain:[['model','=',self.model]]}).done(function(result){self.render_new_field(result[0]);});});},render_new_field:function(result){var self=this;var action={context:{'default_model_id':result.id,'manual':true,'module':result.model},res_model:"ir.model.fields",views:[[false,'form']],type:'ir.actions.act_window',target:"new",flags:{action_buttons:true}};var action_manager=new instance.web.ActionManager(self);$.when(action_manager.do_action(action)).done(function(){var controller=action_manager.dialog_widget.views['form'].controller;controller.on("on_button_cancel",self,function(){action_manager.destroy();});controller.on("save",self,function(){action_manager.destroy();var value=controller.fields.name.get('value');self.add_node_dialog.$el.find('select[id=field_value]').append($("<option selected></option>").attr("value",value).text(value));_.detect(self.add_widget,function(widget){widget.name=="field_value"?widget.selection.push(value):false;});});});}});instance.web_view_editor.ViewEditor.Field=instance.web.Class.extend({init:function(view,widget){this.$el=view.$el;this.dirty=false;this.name=widget.name;this.selection=widget.selection||[];this.required=widget.required||false;this.string=widget.string||"";this.type=widget.type;this.is_invalid=false;},start:function(){this.update_dom();},update_dom:function(){this.$el.find("td[id="+this.name+"]").toggleClass('invalid',this.is_invalid);this.$el.find("td[id="+this.name+"]").toggleClass('required',this.required);},on_ui_change:function(){this.validate();this.dirty=true;this.update_dom();},validate:function(){this.is_invalid=false;try{var value=instance.web.parse_value(this.get_value(),this,'');this.is_invalid=this.required&&value==='';}catch(e){this.is_invalid=true;}},render:function(){return _.str.sprintf("<td id = %s>%s</td>",this.name,QWeb.render(this.template,{widget:this}))}});instance.web_view_editor.ViewEditor.FieldBoolean=instance.web_view_editor.ViewEditor.Field.extend({template:"vieweditor_boolean",start:function(){var self=this;this._super();this.$el.find("input[id="+self.name+"]").change(function(){self.on_ui_change();});},set_value:function(value){if(value){this.$el.find("input[id="+this.name+"]").attr('checked',true);}},get_value:function(){return this.$el.find("input[id="+this.name+"]").is(':checked')?"1":null;}});instance.web_view_editor.ViewEditor.FieldChar=instance.web_view_editor.ViewEditor.Field.extend({template:"vieweditor_char",start:function(){var self=this;this._super();this.$el.find("input[id="+this.name+"]").css('width','100%').change(function(){self.on_ui_change();});},set_value:function(value){this.$el.find("input[id="+this.name+"]").val(value);},get_value:function(){return this.$el.find("input[id="+this.name+"]").val();}});instance.web_view_editor.ViewEditor.FieldSelect=instance.web_view_editor.ViewEditor.Field.extend({template:"vieweditor_selection",start:function(){var self=this;this._super();this.$el.find("select[id="+this.name+"]").css('width','100%').change(function(){self.on_ui_change();if(self.name=="node_type"){if(self.get_value()=="field"){self.$el.find('#new_field').show();self.$el.find("select[id=field_value]").show();}else{self.$el.find('#new_field').hide();self.$el.find("select[id=field_value]").hide();}}});},set_value:function(value){var index=0;value=value===null?false:value;for(var i=0,ii=this.selection.length;i<ii;i++){if((this.selection[i]instanceof Array&&this.selection[i][0]===value)||this.selection[i]===value)index=i;}
this.$el.find("select[id="+this.name+"]")[0].selectedIndex=index;},get_value:function(){return this.$el.find("select[id="+this.name+"]").val();}});instance.web_view_editor.ViewEditor.FieldSelectMulti=instance.web_view_editor.ViewEditor.FieldSelect.extend({start:function(){this._super();this.$el.find("select[id="+this.name+"]").css('height','100px').attr("multiple",true);},set_value:function(value){var self=this;self.$el.find("#groups option").attr("selected",false);if(!value)return false;_.each(this.selection,function(item){if(_.include(value.split(','),item[0])){self.$el.find("select[id="+self.name+"] option[value='"+item[0]+"']").attr("selected",1)}});}});instance.web_view_editor.ViewEditor.FieldFloat=instance.web_view_editor.ViewEditor.FieldChar.extend({});var _PROPERTIES={'field':['name','string','required','readonly','invisible','domain','context','nolabel','completion','colspan','widget','eval','ref','on_change','attrs','groups'],'form':['string','col','link'],'notebook':['colspan','position','groups'],'page':['string','states','attrs','groups'],'group':['string','col','colspan','invisible','states','attrs','groups'],'image':['filename','width','height','groups'],'separator':['string','colspan','groups'],'label':['string','align','colspan','groups'],'button':['name','string','icon','type','states','readonly','special','target','confirm','context','attrs','colspan','groups'],'newline':[],'board':['style'],'column':[],'action':['name','string','colspan','groups'],'tree':['string','colors','editable','link','limit','min_rows','fonts'],'graph':['string','type'],'calendar':['string','date_start','date_stop','date_delay','day_length','color','mode']};var _CHILDREN={'form':['notebook','group','field','label','button','board','newline','separator'],'tree':['field'],'graph':['field'],'calendar':['field'],'notebook':['page'],'page':['notebook','group','field','label','button','newline','separator'],'group':['field','label','button','separator','newline','group'],'board':['column'],'action':[],'field':['form','tree','graph','field'],'label':[],'button':[],'newline':[],'separator':[],'sheet':['group','field','notebook','label','separator','div','page'],'kanban':['field'],'html_tag':['notebook','group','field','label','button','board','newline','separator']};var html_tag=['div','h1','h2','h3','h4','h5','h6','td','tr'];var _ICONS=['','STOCK_ABOUT','STOCK_ADD','STOCK_APPLY','STOCK_BOLD','STOCK_CANCEL','STOCK_CDROM','STOCK_CLEAR','STOCK_CLOSE','STOCK_COLOR_PICKER','STOCK_CONNECT','STOCK_CONVERT','STOCK_COPY','STOCK_CUT','STOCK_DELETE','STOCK_DIALOG_AUTHENTICATION','STOCK_DIALOG_ERROR','STOCK_DIALOG_INFO','STOCK_DIALOG_QUESTION','STOCK_DIALOG_WARNING','STOCK_DIRECTORY','STOCK_DISCONNECT','STOCK_DND','STOCK_DND_MULTIPLE','STOCK_EDIT','STOCK_EXECUTE','STOCK_FILE','STOCK_FIND','STOCK_FIND_AND_REPLACE','STOCK_FLOPPY','STOCK_GOTO_BOTTOM','STOCK_GOTO_FIRST','STOCK_GOTO_LAST','STOCK_GOTO_TOP','STOCK_GO_BACK','STOCK_GO_DOWN','STOCK_GO_FORWARD','STOCK_GO_UP','STOCK_HARDDISK','STOCK_HELP','STOCK_HOME','STOCK_INDENT','STOCK_INDEX','STOCK_ITALIC','STOCK_JUMP_TO','STOCK_JUSTIFY_CENTER','STOCK_JUSTIFY_FILL','STOCK_JUSTIFY_LEFT','STOCK_JUSTIFY_RIGHT','STOCK_MEDIA_FORWARD','STOCK_MEDIA_NEXT','STOCK_MEDIA_PAUSE','STOCK_MEDIA_PLAY','STOCK_MEDIA_PREVIOUS','STOCK_MEDIA_RECORD','STOCK_MEDIA_REWIND','STOCK_MEDIA_STOP','STOCK_MISSING_IMAGE','STOCK_NETWORK','STOCK_NEW','STOCK_NO','STOCK_OK','STOCK_OPEN','STOCK_PASTE','STOCK_PREFERENCES','STOCK_PRINT','STOCK_PRINT_PREVIEW','STOCK_PROPERTIES','STOCK_QUIT','STOCK_REDO','STOCK_REFRESH','STOCK_REMOVE','STOCK_REVERT_TO_SAVED','STOCK_SAVE','STOCK_SAVE_AS','STOCK_SELECT_COLOR','STOCK_SELECT_FONT','STOCK_SORT_ASCENDING','STOCK_SORT_DESCENDING','STOCK_SPELL_CHECK','STOCK_STOP','STOCK_STRIKETHROUGH','STOCK_UNDELETE','STOCK_UNDERLINE','STOCK_UNDO','STOCK_UNINDENT','STOCK_YES','STOCK_ZOOM_100','STOCK_ZOOM_FIT','STOCK_ZOOM_IN','STOCK_ZOOM_OUT','terp-account','terp-crm','terp-mrp','terp-product','terp-purchase','terp-sale','terp-tools','terp-administration','terp-hr','terp-partner','terp-project','terp-report','terp-stock','terp-calendar','terp-graph'];instance.web_view_editor.ViewEditor.property_widget=new instance.web.Registry({'boolean':'instance.web_view_editor.ViewEditor.FieldBoolean','selection_multi':'instance.web_view_editor.ViewEditor.FieldSelectMulti','selection':'instance.web_view_editor.ViewEditor.FieldSelect','char':'instance.web_view_editor.ViewEditor.FieldChar','float':'instance.web_view_editor.ViewEditor.FieldFloat'});};